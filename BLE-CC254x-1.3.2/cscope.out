cscope 16 $HOME\Documents\Study\BLE\Work\BLE-CC254x-1.3.2"               0001722185
	@Components/ble/controller/include/ll.h

45 #i‚de‡
LL_H


46 
	#LL_H


	)

48 #ifde‡
__˝lu•lus


56 
	~"bcomdef.h
"

63 
	#LL_INVALID_CONN_TIME_PARAM
–
ciMö
, 
ciMax
, 
¶
, 
l°o
 ) \

64 (((
ciMö
Ë< 
LL_CONN_INTERVAL_MIN
) || \

65 ((
ciMö
Ë> 
LL_CONN_INTERVAL_MAX
) || \

66 ((
ciMax
Ë< 
LL_CONN_INTERVAL_MIN
) || \

67 ((
ciMax
Ë> 
LL_CONN_INTERVAL_MAX
) || \

68 ((
ciMax
Ë< (
ciMö
)) || \

69 ((
¶
Ë> 
LL_SLAVE_LATENCY_MAX
) || \

70 ((
l°o
Ë< 
LL_CONN_TIMEOUT_MIN
) || \

71 ((
l°o
Ë> 
LL_CONN_TIMEOUT_MAX
))

	)

77 
	#LL_INVALID_CONN_TIME_PARAM_COMBO
–
ci
, 
¶
, 
l°o
 ) \

78 ((
uöt32
)((
l°o
)*8Ë<((uöt32)(1+(
¶
)Ë* (uöt32)((
ci
)*2)))

	)

90 
	#LL_STATUS_SUCCESS
 0x00

91 
	#LL_STATUS_ERROR_UNKNOWN_CONN_HANDLE
 0x02

92 
	#LL_STATUS_ERROR_INACTIVE_CONNECTION
 0x02

93 
	#LL_STATUS_ERROR_AUTH_FAILURE
 0x05

94 
	#LL_STATUS_ERROR_PIN_OR_KEY_MISSING
 0x06

95 
	#LL_STATUS_ERROR_OUT_OF_CONN_RESOURCES
 0x07

96 
	#LL_STATUS_ERROR_OUT_OF_TX_MEM
 0x07

97 
	#LL_STATUS_ERROR_OUT_OF_RX_MEM
 0x07

98 
	#LL_STATUS_ERROR_OUT_OF_HEAP
 0x07

99 
	#LL_STATUS_ERROR_WL_TABLE_FULL
 0x07

100 
	#LL_STATUS_ERROR_CONNECTION_TIMEOUT
 0x08

101 
	#LL_STATUS_ERROR_CONNECTION_LIMIT_EXCEEDED
 0x09

102 
	#LL_STATUS_ERROR_COMMAND_DISALLOWED
 0x0C

103 
	#LL_STATUS_ERROR_DUE_TO_LIMITED_RESOURCES
 0x0D

104 
	#LL_STATUS_ERROR_DUE_TO_DELAYED_RESOURCES
 0x0D

105 
	#LL_STATUS_ERROR_FEATURE_NOT_SUPPORTED
 0x11

106 
	#LL_STATUS_ERROR_UNEXPECTED_PARAMETER
 0x12

107 
	#LL_STATUS_ERROR_ILLEGAL_PARAM_COMBINATION
 0x12

108 
	#LL_STATUS_ERROR_BAD_PARAMETER
 0x12

109 
	#LL_STATUS_ERROR_UNKNOWN_ADV_EVT_TYPE
 0x12

110 
	#LL_STATUS_ERROR_PEER_TERM
 0x13

111 
	#LL_STATUS_ERROR_PEER_DEVICE_TERM_LOW_RESOURCES
 0x14

112 
	#LL_STATUS_ERROR_PEER_DEVICE_TERM_POWER_OFF
 0x15

113 
	#LL_STATUS_ERROR_HOST_TERM
 0x16

114 
	#LL_STATUS_ERROR_UNSUPPORTED_REMOTE_FEATURE
 0x1A

115 
	#LL_STATUS_ERROR_WL_ENTRY_NOT_FOUND
 0x1F

116 
	#LL_STATUS_ERROR_WL_TABLE_EMPTY
 0x1F

117 
	#LL_STATUS_ERROR_RNG_FAILURE
 0x1F

118 
	#LL_STATUS_ERROR_DISCONNECT_IMMEDIATE
 0x1F

119 
	#LL_STATUS_ERROR_UNEXPECTED_STATE_ROLE
 0x21

120 
	#LL_STATUS_ERROR_LL_TIMEOUT
 0x22

121 
	#LL_STATUS_ERROR_LL_TIMEOUT_HOST
 0x22

122 
	#LL_STATUS_ERROR_LL_TIMEOUT_PEER
 0x22

123 
	#LL_STATUS_ERROR_INSTANT_PASSED
 0x28

124 
	#LL_STATUS_ERROR_INSTANT_PASSED_HOST
 0x28

125 
	#LL_STATUS_ERROR_INSTANT_PASSED_PEER
 0x28

126 
	#LL_STATUS_ERROR_KEY_PAIRING_NOT_SUPPORTED
 0x29

127 
	#LL_STATUS_ERROR_NO_ADV_CHAN_FOUND
 0x30

128 
	#LL_STATUS_ERROR_PARAM_OUT_OF_RANGE
 0x30

129 
	#LL_STATUS_ERROR_UPDATE_CTRL_PROC_PENDING
 0x3A

130 
	#LL_STATUS_ERROR_CTRL_PROC_ALREADY_ACTIVE
 0x3A

131 
	#LL_STATUS_ERROR_VER_INFO_REQ_ALREADY_PENDING
 0x3A

132 
	#LL_STATUS_ERROR_UNACCEPTABLE_CONN_INTERVAL
 0x3B

133 
	#LL_STATUS_ERROR_DIRECTED_ADV_TIMEOUT
 0x3C

134 
	#LL_STATUS_ERROR_CONN_TERM_DUE_TO_MIC_FAILURE
 0x3D

135 
	#LL_STATUS_ERROR_CONN_FAILED_TO_BE_ESTABLISHED
 0x3E

136 
	#LL_STATUS_ERROR_CONN_TIMING_FAILURE
 0x3F

138 
	#LL_STATUS_WARNING_TX_DISABLED
 0xFF

139 
	#LL_STATUS_WARNING_FLAG_UNCHANGED
 0xFF

140 

	)

142 
	#LL_ENC_KEY_REQ_ACCEPTED
 
LL_STATUS_SUCCESS


	)

143 
	#LL_ENC_KEY_REQ_REJECTED
 
LL_STATUS_ERROR_PIN_OR_KEY_MISSING


	)

144 
	#LL_ENC_KEY_REQ_UNSUPPORTED_FEATURE
 
LL_STATUS_ERROR_UNSUPPORTED_REMOTE_FEATURE


	)

147 
	#LL_SUPERVISION_TIMEOUT_TERM
 
LL_STATUS_ERROR_CONNECTION_TIMEOUT


	)

148 
	#LL_PEER_REQUESTED_TERM
 
LL_STATUS_ERROR_PEER_TERM


	)

149 
	#LL_PEER_REQUESTED_LOW_RESOURCES_TERM
 
LL_STATUS_ERROR_PEER_DEVICE_TERM_LOW_RESOURCES


	)

150 
	#LL_PEER_REQUESTED_POWER_OFF_TERM
 
LL_STATUS_ERROR_PEER_DEVICE_TERM_POWER_OFF


	)

151 
	#LL_HOST_REQUESTED_TERM
 
LL_STATUS_ERROR_HOST_TERM


	)

152 
	#LL_CTRL_PKT_TIMEOUT_TERM
 
LL_STATUS_ERROR_LL_TIMEOUT


	)

153 
	#LL_CTRL_PKT_TIMEOUT_HOST_TERM
 
LL_STATUS_ERROR_LL_TIMEOUT_HOST


	)

154 
	#LL_CTRL_PKT_TIMEOUT_PEER_TERM
 
LL_STATUS_ERROR_LL_TIMEOUT_PEER


	)

155 
	#LL_CTRL_PKT_INSTANT_PASSED_TERM
 
LL_STATUS_ERROR_INSTANT_PASSED


	)

156 
	#LL_CTRL_PKT_INSTANT_PASSED_HOST_TERM
 
LL_STATUS_ERROR_INSTANT_PASSED_HOST


	)

157 
	#LL_CTRL_PKT_INSTANT_PASSED_PEER_TERM
 
LL_STATUS_ERROR_INSTANT_PASSED_PEER


	)

158 
	#LL_UNACCEPTABLE_CONN_INTERVAL_TERM
 
LL_STATUS_ERROR_UNACCEPTABLE_CONN_INTERVAL


	)

159 
	#LL_MIC_FAILURE_TERM
 
LL_STATUS_ERROR_CONN_TERM_DUE_TO_MIC_FAILURE


	)

160 
	#LL_CONN_ESTABLISHMENT_FAILED_TERM
 
LL_STATUS_ERROR_CONN_FAILED_TO_BE_ESTABLISHED


	)

163 
	#LL_DISCONNECT_AUTH_FAILURE
 
LL_STATUS_ERROR_AUTH_FAILURE


	)

164 
	#LL_DISCONNECT_REMOTE_USER_TERM
 
LL_STATUS_ERROR_PEER_TERM


	)

165 
	#LL_DISCONNECT_REMOTE_DEV_LOW_RESOURCES
 
LL_STATUS_ERROR_PEER_DEVICE_TERM_LOW_RESOURCES


	)

166 
	#LL_DISCONNECT_REMOTE_DEV_POWER_OFF
 
LL_STATUS_ERROR_PEER_DEVICE_TERM_POWER_OFF


	)

167 
	#LL_DISCONNECT_UNSUPPORTED_REMOTE_FEATURE
 
LL_STATUS_ERROR_UNSUPPORTED_REMOTE_FEATURE


	)

168 
	#LL_DISCONNECT_KEY_PAIRING_NOT_SUPPORTED
 
LL_STATUS_ERROR_KEY_PAIRING_NOT_SUPPORTED


	)

169 
	#LL_DISCONNECT_UNACCEPTABLE_CONN_INTERVAL
 
LL_STATUS_ERROR_UNACCEPTABLE_CONN_INTERVAL


	)

176 
	#LL_ADV_CONN_INTERVAL_MIN
 32

177 
	#LL_ADV_CONN_INTERVAL_MAX
 16384

178 
	#LL_ADV_NONCONN_INTERVAL_MIN
 160

179 
	#LL_ADV_NONCONN_INTERVAL_MAX
 16384

180 
	#LL_ADV_DELAY_MIN
 0

181 
	#LL_ADV_DELAY_MAX
 10

182 
	#LL_SCAN_INTERVAL_MIN
 4

183 
	#LL_SCAN_INTERVAL_MAX
 16384

184 
	#LL_SCAN_WINDOW_MIN
 4

185 
	#LL_SCAN_WINDOW_MAX
 16384

186 
	#LL_CONN_INTERVAL_MIN
 6

187 
	#LL_CONN_INTERVAL_MAX
 3200

188 
	#LL_CONN_TIMEOUT_MIN
 10

189 
	#LL_CONN_TIMEOUT_MAX
 3200

190 
	#LL_SLAVE_LATENCY_MIN
 0

	)

191 
	#LL_SLAVE_LATENCY_MAX
 499

	)

192 
	#LL_HOP_LENGTH_MIN
 5

	)

193 
	#LL_HOP_LENGTH_MAX
 16

	)

194 
	#LL_INSTANT_NUMBER_MIN
 6

	)

197 
	#LL_ADV_CHAN_37
 1

	)

198 
	#LL_ADV_CHAN_38
 2

	)

199 
	#LL_ADV_CHAN_39
 4

	)

200 
	#LL_ADV_CHAN_ALL
 (
LL_ADV_CHAN_37
 | 
LL_ADV_CHAN_38
 | 
LL_ADV_CHAN_39
)

	)

203 
	#LL_ADV_CONNECTABLE_UNDIRECTED_EVT
 0

	)

204 
	#LL_ADV_CONNECTABLE_DIRECTED_EVT
 1

	)

205 
	#LL_ADV_SCANNABLE_UNDIRECTED_EVT
 2

	)

206 
	#LL_ADV_NONCONNECTABLE_UNDIRECTED_EVT
 3

	)

209 
	#LL_DEV_ADDR_TYPE_PUBLIC
 0

	)

210 
	#LL_DEV_ADDR_TYPE_RANDOM
 1

	)

213 
	#LL_ADV_WL_POLICY_ANY_REQ
 0

214 
	#LL_ADV_WL_POLICY_WL_SCAN_REQ
 1

215 
	#LL_ADV_WL_POLICY_WL_CONNECT_REQ
 2

216 
	#LL_ADV_WL_POLICY_WL_ALL_REQ
 3

217 

	)

219 
	#LL_SCAN_WL_POLICY_ANY_ADV_PKTS
 0

	)

220 
	#LL_SCAN_WL_POLICY_USE_WHITE_LIST
 1

	)

223 
	#LL_INIT_WL_POLICY_USE_PEER_ADDR
 0

	)

224 
	#LL_INIT_WL_POLICY_USE_WHITE_LIST
 1

	)

227 
	#LL_SET_BLACKLIST_DISABLE
 0

	)

228 
	#LL_SET_BLACKLIST_ENABLE
 1

	)

231 
	#LL_ADV_MODE_OFF
 0

	)

232 
	#LL_ADV_MODE_ON
 1

	)

233 
	#LL_ADV_MODE_RESERVED
 2

	)

236 
	#LL_SCAN_STOP
 0

	)

237 
	#LL_SCAN_START
 1

	)

240 
	#LL_FILTER_REPORTS_DISABLE
 0

	)

241 
	#LL_FILTER_REPORTS_ENABLE
 1

	)

244 
	#LL_SCAN_PASSIVE
 0

	)

245 
	#LL_SCAN_ACTIVE
 1

	)

248 
	#LL_READ_CURRENT_TX_POWER_LEVEL
 0

	)

249 
	#LL_READ_MAX_TX_POWER_LEVEL
 1

	)

252 
	#LL_DATA_FIRST_PKT_HOST_TO_CTRL
 0

	)

253 
	#LL_DATA_CONTINUATION_PKT
 1

	)

254 
	#LL_DATA_FIRST_PKT_CTRL_TO_HOST
 2

	)

257 
	#LL_LINK_CONNECT_COMPLETE_MASTER
 0

	)

258 
	#LL_LINK_CONNECT_COMPLETE_SLAVE
 1

	)

261 
	#LL_ENCRYPTION_OFF
 0

	)

262 
	#LL_ENCRYPTION_ON
 1

	)

265 
	#LL_MAX_FEATURE_SET_SIZE
 8

267 
	#LL_FEATURE_RFU
 0

268 
	#LL_FEATURE_ENCRYPTION
 1

269 

	)

271 
	#LL_DISABLE_RX_FLOW_CONTROL
 0

	)

272 
	#LL_ENABLE_RX_FLOW_CONTROL
 1

	)

275 
	#LL_DIRECT_TEST_NUM_RF_CHANS
 40

276 
	#LL_DIRECT_TEST_MAX_PAYLOAD_LEN
 37

	)

278 
	#LL_DIRECT_TEST_PAYLOAD_PRBS9
 0

	)

279 
	#LL_DIRECT_TEST_PAYLOAD_0x0F
 1

	)

280 
	#LL_DIRECT_TEST_PAYLOAD_0x55
 2

	)

281 
	#LL_DIRECT_TEST_PAYLOAD_PRBS15
 3

	)

282 
	#LL_DIRECT_TEST_PAYLOAD_0xFF
 4

	)

283 
	#LL_DIRECT_TEST_PAYLOAD_0x00
 5

	)

284 
	#LL_DIRECT_TEST_PAYLOAD_0xF0
 6

	)

285 
	#LL_DIRECT_TEST_PAYLOAD_0xAA
 7

	)

286 
	#LL_DIRECT_TEST_PAYLOAD_UNDEFINED
 0xFF

	)

288 
	#LL_DIRECT_TEST_MODE_TX
 0

	)

289 
	#LL_DIRECT_TEST_MODE_RX
 1

	)

291 
	#LL_RF_RSSI_UNDEFINED
 
PHY_RSSI_VALUE_INVALID


	)

294 
	#LL_EXT_RX_GAIN_STD
 0

	)

295 
	#LL_EXT_RX_GAIN_HIGH
 1

	)

297 
	#LL_EXT_TX_POWER_MINUS_23_DBM
 0

	)

298 
	#LL_EXT_TX_POWER_MINUS_6_DBM
 1

	)

299 
	#LL_EXT_TX_POWER_0_DBM
 2

	)

300 
	#LL_EXT_TX_POWER_4_DBM
 3

	)

302 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

304 
	#LL_EXT_MAX_TX_POWER
 
LL_EXT_TX_POWER_0_DBM


	)

308 
	#LL_EXT_MAX_TX_POWER
 
LL_EXT_TX_POWER_4_DBM


	)

313 
	#LL_EXT_DISABLE_ONE_PKT_PER_EVT
 0

	)

314 
	#LL_EXT_ENABLE_ONE_PKT_PER_EVT
 1

	)

316 
	#LL_EXT_DISABLE_CLK_DIVIDE_ON_HALT
 0

	)

317 
	#LL_EXT_ENABLE_CLK_DIVIDE_ON_HALT
 1

	)

319 
	#LL_EXT_NV_NOT_IN_USE
 0

	)

320 
	#LL_EXT_NV_IN_USE
 1

	)

322 
	#LL_EXT_DISABLE_FAST_TX_RESP_TIME
 0

	)

323 
	#LL_EXT_ENABLE_FAST_TX_RESP_TIME
 1

	)

325 
	#LL_EXT_DISABLE_SL_OVERRIDE
 0

	)

326 
	#LL_EXT_ENABLE_SL_OVERRIDE
 1

	)

328 
	#LL_EXT_TX_MODULATED_CARRIER
 0

	)

329 
	#LL_EXT_TX_UNMODULATED_CARRIER
 1

	)

331 
	#LL_EXT_SET_FREQ_TUNE_DOWN
 0

	)

332 
	#LL_EXT_SET_FREQ_TUNE_UP
 1

	)

334 
	#LL_EXT_PM_IO_PORT_P0
 0

	)

335 
	#LL_EXT_PM_IO_PORT_P1
 1

	)

336 
	#LL_EXT_PM_IO_PORT_P2
 2

	)

337 
	#LL_EXT_PM_IO_PORT_NONE
 0xFF

	)

338 
	#LL_EXT_PM_IO_DISABLE
 
LL_EXT_PM_IO_PORT_NONE


	)

340 
	#LL_EXT_PM_IO_PORT_PIN0
 0

	)

341 
	#LL_EXT_PM_IO_PORT_PIN1
 1

	)

342 
	#LL_EXT_PM_IO_PORT_PIN2
 2

	)

343 
	#LL_EXT_PM_IO_PORT_PIN3
 3

	)

344 
	#LL_EXT_PM_IO_PORT_PIN4
 4

	)

345 
	#LL_EXT_PM_IO_PORT_PIN5
 5

	)

346 
	#LL_EXT_PM_IO_PORT_PIN6
 6

	)

347 
	#LL_EXT_PM_IO_PORT_PIN7
 7

	)

349 
	#LL_EXT_PER_RESET
 0

	)

350 
	#LL_EXT_PER_READ
 1

	)

352 
	#LL_EXT_HALT_DURING_RF_DISABLE
 0

	)

353 
	#LL_EXT_HALT_DURING_RF_ENABLE
 1

	)

355 
	#LL_EXT_SET_USER_REVISION
 0

	)

356 
	#LL_EXT_READ_BUILD_REVISION
 1

	)

359 
	#LL_DEVICE_ADDR_LEN
 6

	)

360 
	#LL_MAX_ADV_DATA_LEN
 31

	)

361 
	#LL_MAX_ADV_PAYLOAD_LEN
 (
LL_DEVICE_ADDR_LEN
 + 
LL_MAX_ADV_DATA_LEN
)

	)

362 
	#LL_MAX_SCAN_DATA_LEN
 31

	)

363 
	#LL_MAX_SCAN_PAYLOAD_LEN
 (
LL_DEVICE_ADDR_LEN
 + 
LL_MAX_SCAN_DATA_LEN
)

	)

364 
	#LL_MAX_LINK_DATA_LEN
 27

	)

371 
	#LL_ADV_RPT_ADV_IND
 
LL_ADV_CONNECTABLE_UNDIRECTED_EVT


	)

372 
	#LL_ADV_RPT_ADV_DIRECT_IND
 
LL_ADV_CONNECTABLE_DIRECTED_EVT


	)

373 
	#LL_ADV_RPT_ADV_SCANNABLE_IND
 
LL_ADV_SCANNABLE_UNDIRECTED_EVT


	)

374 
	#LL_ADV_RPT_ADV_NONCONN_IND
 
LL_ADV_NONCONNECTABLE_UNDIRECTED_EVT


	)

375 
	#LL_ADV_RPT_SCAN_RSP
 (
LL_ADV_NONCONNECTABLE_UNDIRECTED_EVT
 + 1)

	)

376 
	#LL_ADV_RPT_INVALID
 0xFF

	)

378 
	#LL_RSSI_NOT_AVAILABLE
 127

	)

381 
	#LL_SCA_500_PPM
 0

	)

382 
	#LL_SCA_250_PPM
 1

	)

383 
	#LL_SCA_150_PPM
 2

	)

384 
	#LL_SCA_100_PPM
 3

	)

385 
	#LL_SCA_75_PPM
 4

	)

386 
	#LL_SCA_50_PPM
 5

	)

387 
	#LL_SCA_30_PPM
 6

	)

388 
	#LL_SCA_20_PPM
 7

	)

394 
	#LL_MAX_NUM_DATA_CHAN
 37

395 

	)

400 
uöt8
 
	tŒSètus_t
;

405 
uöt16
 
numPkts
[ 
LL_MAX_NUM_DATA_CHAN
 ];

406 
uöt16
 
numCrcEº
[ 
LL_MAX_NUM_DATA_CHAN
 ];

407 } 
	t≥rByCh™_t
;

438 
LL_Inô
–
uöt8
 
èskId
 );

457 
uöt16
 
LL_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

480 
ŒSètus_t
 
LL_Re£t
( );

501 
ŒSètus_t
 
LL_RódBDADDR
–
uöt8
 *
bdAddr
 );

523 
ŒSètus_t
 
LL_SëR™domAddªss
–
uöt8
 *
devAddr
 );

545 
ŒSètus_t
 
LL_CÀ¨WhôeLi°
( );

566 
ŒSètus_t
 
LL_AddWhôeLi°Devi˚
–
uöt8
 *
devAddr
,

567 
uöt8
 
addrTy≥
 );

588 
ŒSètus_t
 
LL_RemoveWhôeLi°Devi˚
–
uöt8
 *
devAddr
,

589 
uöt8
 
addrTy≥
 );

608 
ŒSètus_t
 
LL_RódWlSize
–
uöt8
 *
numE¡rõs
 );

627 
ŒSètus_t
 
LL_NumEm±yWlE¡rõs
–
uöt8
 *
numEm±yE¡rõs
 );

652 
ŒSètus_t
 
LL_En¸y±
–
uöt8
 *
key
,

653 
uöt8
 *
∂aöãxtD©a
,

654 
uöt8
 *
í¸y±edD©a
 );

680 
ŒSètus_t
 
LL_R™d
–
uöt8
 *
øndD©a
,

681 
uöt8
 
d©aLí
 );

700 
ŒSètus_t
 
LL_RódSuµ‹ãdSèãs
–
uöt8
 *
°©es
 );

722 
ŒSètus_t
 
LL_RódLoˇlSuµ‹ãdFótuªs
–
uöt8
 *
„©uªSë
 );

745 
ŒSètus_t
 
LL_RódLoˇlVîsi⁄Info
–
uöt8
 *
vîNum
,

746 
uöt16
 *
comId
,

747 
uöt16
 *
subvîNum
 );

750 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

768 
ŒSètus_t
 
LL_CålToHo°FlowC⁄åﬁ
–
uöt8
 
mode
 );

772 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

797 
ŒSètus_t
 
LL_RódRemŸeVîsi⁄Info
–
uöt16
 
c⁄nId
 );

801 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

823 
ŒSètus_t
 
LL_RódTxPowîLevñ
–
uöt8
 
c⁄nId
,

824 
uöt8
 
ty≥
,

825 
öt8
 *
txPowî
 );

829 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

849 
ŒSètus_t
 
LL_RódCh™M≠
–
uöt8
 
c⁄nId
,

850 
uöt8
 *
ch™M≠
 );

876 
ŒSètus_t
 
LL_RódRssi
–
uöt16
 
c⁄nId
,

877 
öt8
 *
œ°Rssi
 );

880 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

899 
ŒSètus_t
 
LL_Disc⁄√˘
–
uöt16
 
c⁄nId
,

900 
uöt8
 
ªas⁄
 );

904 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

959 
ŒSètus_t
 
LL_TxD©a
–
uöt16
 
c⁄nId
,

960 
uöt8
 *
pBuf
,

961 
uöt8
 
Àn
,

962 
uöt8
 
‰agFœg
 );

990 
ŒSètus_t
 
LL_Dúe˘Te°TxTe°
–
uöt8
 
txFªq
,

991 
uöt8
 
∑ylﬂdLí
,

992 
uöt8
 
∑ylﬂdTy≥
 );

1017 
ŒSètus_t
 
LL_Dúe˘Te°RxTe°
–
uöt8
 
rxFªq
 );

1041 
ŒSètus_t
 
LL_Dúe˘Te°End
( );

1044 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1072 
ŒSètus_t
 
LL_SëAdvP¨am
–
uöt16
 
advI¡îvÆMö
,

1073 
uöt16
 
advI¡îvÆMax
,

1074 
uöt8
 
advEvtTy≥
,

1075 
uöt8
 
ownAddrTy≥
,

1076 
uöt8
 
dúe˘AddrTy≥
,

1077 
uöt8
 *
dúe˘Addr
,

1078 
uöt8
 
advCh™M≠
,

1079 
uöt8
 
advWlPﬁicy
 );

1083 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1107 
ŒSètus_t
 
LL_SëAdvD©a
–
uöt8
 
advD©aLí
,

1108 
uöt8
 *
advD©a
 );

1112 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1134 
ŒSètus_t
 
LL_SëSˇnR•D©a
–
uöt8
 
sˇnR•Lí
,

1135 
uöt8
 *
sˇnR•D©a
 );

1139 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1159 
ŒSètus_t
 
LL_SëAdvC⁄åﬁ
–
uöt8
 
advMode
 );

1163 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1182 
ŒSètus_t
 
LL_RódAdvCh™TxPowî
–
öt8
 *
txPowî
 );

1186 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
SCAN_CFG
)

1209 
ŒSètus_t
 
LL_SëSˇnP¨am
–
uöt8
 
sˇnTy≥
,

1210 
uöt16
 
sˇnI¡îvÆ
,

1211 
uöt16
 
sˇnWödow
,

1212 
uöt8
 
ownAddrTy≥
,

1213 
uöt8
 
advWlPﬁicy
 );

1217 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
SCAN_CFG
)

1241 
ŒSètus_t
 
LL_SëSˇnC⁄åﬁ
–
uöt8
 
sˇnMode
,

1242 
uöt8
 
fûãrRï‹ts
 );

1246 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

1269 
ŒSètus_t
 
LL_EncLtkRïly
–
uöt16
 
c⁄nId
,

1270 
uöt8
 *
key
 );

1274 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

1299 
ŒSètus_t
 
LL_EncLtkNegRïly
–
uöt16
 
c⁄nId
 );

1303 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1332 
ŒSètus_t
 
LL_Cª©eC⁄n
–
uöt16
 
sˇnI¡îvÆ
,

1333 
uöt16
 
sˇnWödow
,

1334 
uöt8
 
öôWlPﬁicy
,

1335 
uöt8
 
≥îAddrTy≥
,

1336 
uöt8
 *
≥îAddr
,

1337 
uöt8
 
ownAddrTy≥
,

1338 
uöt16
 
c⁄nI¡îvÆMö
,

1339 
uöt16
 
c⁄nI¡îvÆMax
,

1340 
uöt16
 
c⁄nL©ícy
,

1341 
uöt16
 
c⁄nTimeout
,

1342 
uöt16
 
möLígth
,

1343 
uöt16
 
maxLígth
 );

1347 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1366 
ŒSètus_t
 
LL_Cª©eC⁄nC™˚l
( );

1370 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

1388 
ŒSètus_t
 
LL_C⁄nA˘ive
–
uöt16
 
c⁄nId
 );

1392 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1418 
ŒSètus_t
 
LL_C⁄nUpd©e
–
uöt16
 
c⁄nId
,

1419 
uöt16
 
c⁄nI¡îvÆMö
,

1420 
uöt16
 
c⁄nI¡îvÆMax
,

1421 
uöt16
 
c⁄nL©ícy
,

1422 
uöt16
 
c⁄nTimeout
,

1423 
uöt16
 
möLígth
,

1424 
uöt16
 
maxLígth
 );

1428 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1452 
ŒSètus_t
 
LL_Ch™M≠Upd©e
–
uöt8
 *
ch™M≠
 );

1456 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1481 
ŒSètus_t
 
LL_SèπEn¸y±
–
uöt16
 
c⁄nId
,

1482 
uöt8
 *
ønd
,

1483 
uöt8
 *
eDiv
,

1484 
uöt8
 *
…k
 );

1488 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1505 
ŒSètus_t
 
LL_RódRemŸeU£dFótuªs
–
uöt16
 
c⁄nId
 );

1528 
ŒSètus_t
 
LL_EXT_SëRxGaö
–
uöt8
 
rxGaö
,

1529 
uöt8
 *
cmdCom∂ëe
 );

1547 
ŒSètus_t
 
LL_EXT_SëTxPowî
–
uöt8
 
txPowî
,

1548 
uöt8
 *
cmdCom∂ëe
 );

1551 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

1569 
ŒSètus_t
 
LL_EXT_O√PackëPîEvít
–
uöt8
 
c⁄åﬁ
 );

1592 
ŒSètus_t
 
LL_EXT_ClkDivOnHÆt
–
uöt8
 
c⁄åﬁ
 );

1613 
ŒSètus_t
 
LL_EXT_De˛¨eNvUßge
–
uöt8
 
mode
 );

1638 
ŒSètus_t
 
LL_EXT_De¸y±
–
uöt8
 *
key
,

1639 
uöt8
 *
í¸y±edD©a
,

1640 
uöt8
 *
∂aöãxtD©a
 );

1664 
ŒSètus_t
 
LL_EXT_SëLoˇlSuµ‹ãdFótuªs
–
uöt8
 *
„©uªSë
 );

1667 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

1691 
ŒSètus_t
 
LL_EXT_SëFa°TxRe•⁄£Time
–
uöt8
 
c⁄åﬁ
 );

1695 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

1716 
ŒSètus_t
 
LL_EXT_SëSœveL©ícyOvîride
–
uöt8
 
c⁄åﬁ
 );

1746 
ŒSètus_t
 
LL_EXT_ModemTe°Tx
–
uöt8
 
cwMode
,

1747 
uöt8
 
txFªq
 );

1775 
ŒSètus_t
 
LL_EXT_ModemH›Te°Tx
( );

1803 
ŒSètus_t
 
LL_EXT_ModemTe°Rx
–
uöt8
 
rxFªq
 );

1822 
ŒSètus_t
 
LL_EXT_EndModemTe°
( );

1846 
ŒSètus_t
 
LL_EXT_SëBDADDR
–
uöt8
 *
bdAddr
 );

1849 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

1877 
ŒSètus_t
 
LL_EXT_SëSCA
–
uöt16
 
sˇInPPM
 );

1900 
ŒSètus_t
 
LL_EXT_SëFªqTu√
–
uöt8
 
°ï
 );

1921 
ŒSètus_t
 
LL_EXT_SaveFªqTu√
( );

1943 
ŒSètus_t
 
LL_EXT_SëMaxDtmTxPowî
–
uöt8
 
txPowî
 );

1998 
ŒSètus_t
 
LL_EXT_M≠PmIoP‹t
–
uöt8
 
ioP‹t
, uöt8 
ioPö
 );

2001 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2021 
ŒSètus_t
 
LL_EXT_Disc⁄√˘Immed
–
uöt16
 
c⁄nId
 );

2025 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2049 
ŒSètus_t
 
LL_EXT_PackëEº‹R©e
–
uöt16
 
c⁄nId
, 
uöt8
 
comm™d
 );

2053 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2081 
ŒSètus_t
 
LL_EXT_PERbyCh™
–
uöt16
 
c⁄nId
, 
≥rByCh™_t
 *
≥rByCh™
 );

2101 
ŒSètus_t
 
LL_EXT_ExãndRfR™ge
–
uöt8
 *
cmdCom∂ëe
 );

2122 
ŒSètus_t
 
LL_EXT_HÆtDurögRf
–
uöt8
 
mode
 );

2125 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

2145 
ŒSètus_t
 
LL_EXT_AdvEvítNŸi˚
–
uöt8
 
èskID
, 
uöt16
 
èskEvít
 );

2149 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

2173 
ŒSètus_t
 
LL_EXT_C⁄nEvítNŸi˚
–
uöt8
 
èskID
, 
uöt16
 
èskEvít
 );

2196 
ŒSètus_t
 
LL_EXT_BuûdRevisi⁄
–
uöt8
 
mode
, 
uöt16
 
u£rRevNum
, uöt8 *
buûdRev
 );

2203 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2233 
LL_C⁄√˘i⁄Com∂ëeCback
–
uöt8
 
ªas⁄Code
,

2234 
uöt16
 
c⁄nId
,

2235 
uöt8
 
rﬁe
,

2236 
uöt8
 
≥îAddrTy≥
,

2237 
uöt8
 *
≥îAddr
,

2238 
uöt16
 
c⁄nI¡îvÆ
,

2239 
uöt16
 
¶aveL©ícy
,

2240 
uöt16
 
c⁄nTimeout
,

2241 
uöt8
 
˛ockAccuøcy
 );

2245 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2264 
LL_Disc⁄√˘Cback
–
uöt16
 
c⁄nId
,

2265 
uöt8
 
ªas⁄
 );

2269 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2293 
LL_C⁄nP¨amUpd©eCback
–
uöt16
 
c⁄nId
,

2294 
uöt16
 
c⁄nI¡îvÆ
,

2295 
uöt16
 
c⁄nL©ícy
,

2296 
uöt16
 
c⁄nTimeout
 );

2300 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2323 
LL_RódRemŸeVîsi⁄InfoCback
–
uöt8
 
°©us
,

2324 
uöt16
 
c⁄nId
,

2325 
uöt8
 
vîNum
,

2326 
uöt16
 
comId
,

2327 
uöt16
 
subvîNum
 );

2331 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2355 
LL_EncCh™geCback
–
uöt16
 
c⁄nId
,

2356 
uöt8
 
ªas⁄
,

2357 
uöt8
 
ícE«b
 );

2361 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2381 
LL_EncKeyRe‰eshCback
–
uöt16
 
c⁄nId
,

2382 
uöt8
 
ªas⁄
 );

2386 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
SCAN_CFG
)

2409 
LL_AdvRï‹tCback
–
uöt8
 
evítTy≥
,

2410 
uöt8
 
advAddrTy≥
,

2411 
uöt8
 *
advAddr
,

2412 
uöt8
 
d©aLí
,

2413 
uöt8
 *
d©a
,

2414 
öt8
 
rssi
 );

2418 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

2437 
LL_RódRemŸeU£dFótuªsCom∂ëeCback
–
uöt8
 
°©us
,

2438 
uöt16
 
c⁄nId
,

2439 
uöt8
 *
„©uªSë
 );

2443 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

2463 
LL_EncLtkReqCback
–
uöt16
 
c⁄nId
,

2464 
uöt8
 *
øndNum
,

2465 
uöt8
 *
ícDiv
 );

2487 
LL_Dúe˘Te°EndD⁄eCback
–
uöt16
 
numPackës
,

2488 
uöt8
 
mode
 );

2491 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2509 
LL_TxD©aCom∂ëeCback
–
uöt16
 
c⁄nId
,

2510 
uöt8
 *
pBuf
 );

2514 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2531 
uöt8
 *
LL_RxReqD©aBufCback
–uöt8 
size
 );

2535 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2563 
LL_RxD©aCom∂ëeCback
–
uöt16
 
c⁄nId
,

2564 
uöt8
 *
µBuf
,

2565 
uöt8
 
Àn
,

2566 
uöt8
 
‰agFœg
,

2567 
öt8
 
rssi
 );

2589 
LL_R™dCback
–
uöt8
 *
øndD©a
 );

2608 
LL_EXT_SëRxGaöCback
( );

2627 
LL_EXT_SëTxPowîCback
( );

2652 
LL_EXT_PackëEº‹R©eCback
–
uöt16
 
numPkts
,

2653 
uöt16
 
numCrcEº
,

2654 
uöt16
 
numEvíts
,

2655 
uöt16
 
numMis£dEvts
 );

2674 
LL_EXT_ExãndRfR™geCback
( );

2677 #ifde‡
__˝lu•lus


	@Components/ble/controller/include/ll_math.h

40 #i‚de‡
LL_MATH_H


41 
	#LL_MATH_H


	)

43 #ifde‡
__˝lu•lus


76 
NEAR_FUNC
 
uöt32
 
ŒDivide31By16To16
–uöt32 
dividíd
,

77 
uöt16
 
divis‹
 );

80 #ifde‡
__˝lu•lus


	@Components/ble/controller/include/ll_sleep.h

41 #i‚de‡
LL_SLEEP_H


42 
	#LL_SLEEP_H


	)

44 #ifde‡
__˝lu•lus


52 
	~"bcomdef.h
"

63 
	#LL_NR_STATE_IDLE
 0

	)

64 
	#LL_NR_STATE_RUNNING
 1

	)

67 
	#LL_SLEEP_REQUEST_ALLOWED
 0

	)

68 
	#LL_SLEEP_REQUEST_DENIED
 1

	)

82 vﬁ©ûê
DATA
 
phySèã
;

83 vﬁ©ûê
DATA
 
˛kSèã
;

89 
NEAR_FUNC
 
HÆtMcuUsögPhyFœg
();

91 
NEAR_FUNC
 
LL_TimeToNextRfEvít
–
uöt32
 *
¶ìpTimî
, uöt32 *
timeout
 );

92 
NEAR_FUNC
 
uöt8
 
LL_PowîOffReq
–uöt8 
mode
 );

93 
NEAR_FUNC
 
LL_PowîOnReq
–
uöt8
 
wakeFromPM3
, uöt8 
wakeF‹RF
 );

95 #ifde‡
__˝lu•lus


	@Components/ble/controller/include/ll_timer2.h

40 #i‚de‡
LL_TIMER2_H


41 
	#LL_TIMER2_H


	)

43 #ifde‡
__˝lu•lus


56 
	#ŒDißbÀT2Evít1
(Ë(
T2CSPCFG
 |
LL_T2_DISABLE_EVENT1
;)

	)

57 
	#ŒDißbÀT2Evít2
(Ë(
T2CSPCFG
 |
LL_T2_DISABLE_EVENT2
;)

	)

58 
	#ŒAddTime
–
time
, 
vÆ
 ) ((—imeË+ (vÆ)Ë& 
LL_T2OVF_PERIOD_VALUE
)

	)

59 
	#ŒSubTime
–
time
, 
vÆ
 ) ((—imeË- (vÆ)Ë& 
LL_T2OVF_PERIOD_VALUE
)

	)

66 
	#LL_T2_CTRL_INIT_NO_SYNCH
 0x08

	)

67 
	#LL_T2_CTRL_INIT_SYNCH
 0x0A

	)

72 
	#LL_T2_TIMER_SEL
 0x00

	)

73 
	#LL_T2_CAPTURE_SEL
 0x01

	)

74 
	#LL_T2_PERIOD_SEL
 0x02

	)

75 
	#LL_T2_COMPARE1_SEL
 0x03

	)

76 
	#LL_T2_COMPARE2_SEL
 0x04

	)

78 
	#LL_T2OVF_TIMER_SEL
 0x00

	)

79 
	#LL_T2OVF_CAPTURE_SEL
 0x10

	)

80 
	#LL_T2OVF_PERIOD_SEL
 0x20

	)

81 
	#LL_T2OVF_COMPARE1_SEL
 0x30

	)

82 
	#LL_T2OVF_COMPARE2_SEL
 0x40

	)

87 
	#LL_T2_PERIOD_FLAG
 0x01

	)

88 
	#LL_T2_COMPARE1_FLAG
 0x02

	)

89 
	#LL_T2_COMPARE2_FLAG
 0x04

	)

91 
	#LL_T2OVF_PERIOD_FLAG
 0x08

	)

92 
	#LL_T2OVF_COMPARE1_FLAG
 0x10

	)

93 
	#LL_T2OVF_COMPARE2_FLAG
 0x20

	)

95 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

96 
	#LL_T2_LONG_COMPARE1_FLAG
 0x40

	)

97 
	#LL_T2_LONG_COMPARE2_FLAG
 0x80

	)

103 
	#LL_T2_PERIOD_MASK
 0x01

	)

104 
	#LL_T2_COMPARE1_MASK
 0x02

	)

105 
	#LL_T2_COMPARE2_MASK
 0x04

	)

107 
	#LL_T2OVF_PERIOD_MASK
 0x08

	)

108 
	#LL_T2OVF_COMPARE1_MASK
 0x10

	)

109 
	#LL_T2OVF_COMPARE2_MASK
 0x20

	)

111 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

112 
	#LL_T2_LONG_COMPARE1_MASK
 0x40

	)

113 
	#LL_T2_LONG_COMPARE2_MASK
 0x80

	)

119 
	#LL_T2_PERIOD_EVENT1
 0x00

	)

120 
	#LL_T2_COMPARE1_EVENT1
 0x01

	)

121 
	#LL_T2_COMPARE2_EVENT1
 0x02

	)

123 
	#LL_T2OVF_PERIOD_EVENT1
 0x03

	)

124 
	#LL_T2OVF_COMPARE1_EVENT1
 0x04

	)

125 
	#LL_T2OVF_COMPARE2_EVENT1
 0x05

	)

127 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

128 
	#LL_T2OVF_LONG_CMP1_EVENT1
 0x08

	)

129 
	#LL_T2OVF_LONG_CMP2_EVENT1
 0x09

	)

130 
	#LL_T2_DISABLE_EVENT1
 0x0F

	)

132 
	#LL_T2_DISABLE_EVENT1
 0x07

	)

135 
	#LL_T2_PERIOD_EVENT2
 0x00

	)

136 
	#LL_T2_COMPARE1_EVENT2
 0x10

	)

137 
	#LL_T2_COMPARE2_EVENT2
 0x20

	)

139 
	#LL_T2OVF_PERIOD_EVENT2
 0x30

	)

140 
	#LL_T2OVF_COMPARE1_EVENT2
 0x40

	)

141 
	#LL_T2OVF_COMPARE2_EVENT2
 0x50

	)

143 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

144 
	#LL_T2OVF_LONG_CMP1_EVENT2
 0x80

	)

145 
	#LL_T2OVF_LONG_CMP2_EVENT2
 0x90

	)

146 
	#LL_T2_DISABLE_EVENT2
 0xF0

	)

148 
	#LL_T2_DISABLE_EVENT2
 0x70

	)

155 
	#LL_T2_RUN_BIT
 0x01

156 
	#LL_T2_SYNCH_BIT
 0x02

157 
	#LL_T2_STATE_BIT
 0x04

	)

158 
	#LL_T2_PERIOD_VALUE
 0x4E20

159 
	#LL_T2_PERIOD_1US_VALUE
 0x20

160 
	#LL_T2OVF_PERIOD_VALUE
 0x00FFFFFF

161 
	#LL_T2_MAX_VALUE
 0x01000000

162 

	)

172 
uöt32
 
cﬂr£
;

173 
uöt16
 
föe
;

174 } 
	tsysTime_t
;

188 
ŒInôTimî2
( );

189 
ŒSt›Timî2
( );

190 
ŒSèπTimî2
( );

191 
ŒSëT2C1Timeout
–
uöt16
 
timeout
 );

192 
ŒSëT2C2Timeout
–
uöt16
 
timeout
 );

193 
ŒSëT2OVFC1Timeout
–
uöt32
 
timeout
 );

194 
ŒSëT2OVFC2Timeout
–
uöt32
 
timeout
 );

195 
ŒSëT2L⁄gC1Timeout
–
uöt32
 
timeout1
, 
uöt16
 
timeout2
 );

196 
ŒSëT2L⁄gC2Timeout
–
uöt32
 
timeout1
, 
uöt16
 
timeout2
 );

197 
ŒSëT2C1Evít1
–
uöt16
 
timeout
 );

198 
ŒSëT2OVFC1Evít1
–
uöt32
 
timeout
 );

199 
ŒSëT2L⁄gC1Evít1
–
uöt32
 
timeout1
, 
uöt16
 
timeout2
 );

200 
ŒSëT2OVFC2Evít2
–
uöt32
 
timeout
 );

201 
ŒSëT2Dñè
–
uöt16
 
cou¡
 );

202 
ŒDißbÀT2I¡s
( );

203 
ŒDißbÀT2I¡sEvts
( );

204 
ŒDißbÀT2E1
( );

205 
ŒGëTimî2C≠tuª
–
uöt32
 *
cﬂr£Time
, 
uöt16
 *
föeTime
 );

206 
uöt32
 
ŒGëCuºítTime
( );

207 
uöt16
 
ŒGëCuºítFöeTime
( );

208 
ŒGëFuŒCuºítTime
–
uöt32
 *
cﬂr£
, 
uöt16
 *
föe
 );

210 
ŒGëFuŒCT™dST
–
sysTime_t
 *
curTime
, 
uöt32
 *
¶ìpTime
 );

211 
uöt32
 
ŒGëT2OVFC1
( );

212 
uöt32
 
ŒGëT2OVFC2
( );

213 
uöt16
 
Œ_McuPªcisi⁄Cou¡
( );

215 
NEAR_FUNC
 
uöt8
 
Œ24BôTimeCom∑ª
–
uöt32
 
time1
, uöt32 
time2
 );

216 
NEAR_FUNC
 
uöt32
 
Œ24BôTimeDñè
–uöt32 
time1
, uöt32 
time2
 );

217 
NEAR_FUNC
 
uöt32
 
Œ24BôAbsTimeDñè
–uöt32 
time1
, uöt32 
time2
 );

218 
NEAR_FUNC
 
ŒAdju°TimeF‹w¨d
–
sysTime_t
 *
curTime
, sysTime_à*
adjTime
 );

219 
NEAR_FUNC
 
ŒAdju°TimeBackw¨d
–
sysTime_t
 *
curTime
, sysTime_à*
adjTime
 );

221 #ifde‡
__˝lu•lus


	@Components/ble/controller/include/phy.h

39 #i‚de‡
PHY_H


40 
	#PHY_H


	)

42 #ifde‡
__˝lu•lus


50 
	~"bcomdef.h
"

51 
	~"hÆ_ty≥s.h
"

52 
	~"hÆ_defs.h
"

53 
	~"hÆ_mcu.h
"

55 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

56 
	~"ioCC2541_exåa.h
"

58 
	~"ioCC2540_exåa.h
"

65 #i‡!
deföed
(
USE_PHY_FUNCS
)

69 
	#PHY_GET_CHIP_ID
(Ë(*(
P_INFOPAGE
+3))

	)

71 
	#PHY_WRITE_BYTE
–
d©a
, 
Àn
 ) \

73 
uöt8
 
z
; \

74 
z
=0; z<(
Àn
); z++Ë{ 
RFD
 = (
d©a
)[z]; } \

75 }

	)

77 
	#PHY_WRITE_BYTE_VAL
–
vÆue
 ) (
RFD
 = (vÆue))

	)

79 
	#PHY_READ_BYTE
–
±r
, 
Àn
 ) \

80 
	`°
–
uöt8
 
z
; \

81 i‡–(
±r
Ë=
NULL
 ) \

83 
z
=0; z<(
Àn
); z++) \

84 { 
RFD
; } \

88 
z
=0; z<(
Àn
); z++) \

89 { (
±r
)[
z
] = 
RFD
; } \

91 )

	)

93 
	#PHY_READ_BYTE_VAL
(Ë(
RFD
)

	)

95 
	#PHY_RESET_TX_FIFO
(Ë(
RFST
 = 
PHY_FIFO_TX_RESET
)

	)

97 
	#PHY_RESET_RX_FIFO
(Ë(
RFST
 = 
PHY_FIFO_RX_RESET
)

	)

99 
	#PHY_RESET_TXRX_FIFO
(Ë(
RFST
 = 
PHY_FIFO_RESET
)

	)

101 
	#PHY_COMMAND
–
cmd
 ) \

102 
	`°
– 
RFST
 != 0 ); \

103 i‡–(
cmd
Ë!
PHY_CMD_INVALID
 ) \

105 
RFST
 = (
cmd
); \

107 )

	)

109 
	#PHY_CLEAR_COUNTERS
() \

110 
	`°
–
BLE_NTXDONE
 = 0; \

111 
BLE_NTXACK
 = 0; \

112 
BLE_NTXCTRLACK
 = 0; \

113 
BLE_NTXCTRL
 = 0; \

114 
BLE_NTXRETRANS
 = 0; \

115 
BLE_NTX
 = 0; \

116 
BLE_NRXOK
 = 0; \

117 
BLE_NRXCTRL
 = 0; \

118 
BLE_NRXNOK
 = 0; \

119 
BLE_NRXIGNORED
 = 0; \

120 
BLE_NRXEMPTY
 = 0; \

121 
BLE_NRXFIFOFULL
 = 0; \

122 )

	)

124 
	#PHY_READ_COUNTERS
–
±r
 ) \

125 
	`°
–(*((
±r
)+0)Ë
BLE_NTXDONE
; \

126 (*((
±r
)+1)Ë
BLE_NTXACK
; \

127 (*((
±r
)+2)Ë
BLE_NTXCTRLACK
; \

128 (*((
±r
)+3)Ë
BLE_NTXCTRL
; \

129 (*((
±r
)+4)Ë
BLE_NTXRETRANS
; \

130 (*((
±r
)+5)Ë
BLE_NTX
; \

131 (*((
±r
)+6)Ë
BLE_NRXOK
; \

132 (*((
±r
)+7)Ë
BLE_NRXCTRL
; \

133 (*((
±r
)+8)Ë
BLE_NRXNOK
; \

134 (*((
±r
)+9)Ë
BLE_NRXIGNORED
; \

135 (*((
±r
)+10)Ë
BLE_NRXEMPTY
; \

136 (*((
±r
)+11)Ë
BLE_NRXFIFOFULL
; \

137 )

	)

139 
	#PHY_TX_FIFO_LEN
(Ë(
RFTXFLEN
)

	)

141 
	#PHY_RX_FIFO_LEN
(Ë(
RFRXFLEN
)

	)

143 
	#PHY_INIT_LAST_RSSI
(Ë(
BLE_LAST_RSSI
 = 
PHY_RSSI_VALUE_INVALID
)

	)

145 
	#PHY_GET_LAST_RSSI
(Ë(
BLE_LAST_RSSI
)

	)

147 
	#PHY_GET_RSSI
(Ë(
RSSI
)

	)

149 
	#PHY_CLR_WINCONF
(Ë(
BLE_WINCONF
 = 0);

	)

151 
	#PHY_SET_DYN_WINOFFSET
–
wöOff£t
, 
c⁄nI¡îvÆ
 ) \

152 
	`°
–
BLE_WINOFFSET_0
 = (
wöOff£t
) & 0xFF; \

153 
BLE_WINOFFSET_1
 = (
wöOff£t
) >> 8; \

154 
BLE_WINMOD_0
 = (
c⁄nI¡îvÆ
) & 0xFF; \

155 
BLE_WINMOD_1
 = (
c⁄nI¡îvÆ
) >> 8; \

156 
BLE_WINCONF
 = 0xC1; \

157 )

	)

159 
	#PHY_TX_FIFO_BYTES_FREE
(Ë(
PHY_FIFO_SIZE
 - 
RFTXFLEN
)

	)

161 
	#PHY_COMMIT_TX_FIFO
(Ë(
RFST
 = 
PHY_FIFO_TX_COMMIT
)

	)

163 
	#PHY_ANCHOR_VALID
(Ë(
BLE_ANCHOR_VALID
)

	)

165 
	#PHY_GET_DATA_CHAN
(Ë(
BLE_CHAN
)

	)

170 
	#PHY_GET_CHIP_ID
(Ë
	`PHY_GëChùID
()

	)

171 
	#PHY_WRITE_BYTE
–
d©a
, 
Àn
 ) 
	`PHY_WrôeByã
–(d©a), (ÀnË)

	)

172 
	#PHY_WRITE_BYTE_VAL
–
vÆue
 ) 
	`PHY_WrôeByãVÆ
–(vÆueË)

	)

173 
	#PHY_READ_BYTE
–
±r
, 
Àn
 ) 
	`PHY_RódByã
–’å), (ÀnË)

	)

174 
	#PHY_READ_BYTE_VAL
(Ë
	`PHY_RódByãVÆ
()

	)

175 
	#PHY_RESET_TX_FIFO
(Ë
	`PHY_Re£tTxFifo
()

	)

176 
	#PHY_RESET_RX_FIFO
(Ë
	`PHY_Re£tRxFifo
()

	)

177 
	#PHY_RESET_TXRX_FIFO
(Ë
	`PHY_Re£tTxRxFifo
()

	)

178 
	#PHY_COMMAND
–
cmd
 ) 
	`PHY_Comm™d
–(cmdË)

	)

179 
	#PHY_CLEAR_COUNTERS
(Ë
	`PHY_CÀ¨Cou¡îs
()

	)

180 
	#PHY_READ_COUNTERS
–
±r
 ) 
	`PHY_RódCou¡îs
–’åË)

	)

181 
	#PHY_TX_FIFO_LEN
(Ë
	`PHY_TxFifoLí
()

	)

182 
	#PHY_RX_FIFO_LEN
(Ë
	`PHY_RxFifoLí
()

	)

183 
	#PHY_INIT_LAST_RSSI
(Ë
	`PHY_InôLa°Rssi
()

	)

184 
	#PHY_GET_LAST_RSSI
(Ë
	`PHY_GëLa°Rssi
()

	)

185 
	#PHY_GET_RSSI
(Ë
	`PHY_GëRssi
()

	)

186 
	#PHY_CLR_WINCONF
(Ë
	`PHY_CÀ¨WödowC⁄fig
()

	)

187 
	#PHY_SET_DYN_WINOFFSET
–
wöOff
, 
ci
 ) 
	`PHY_SëDy«micWöOff£t
–(wöOff), (ciË)

	)

188 
	#PHY_TX_FIFO_BYTES_FREE
(Ë
	`PHY_TxFifoByãsFªe
()

	)

189 
	#PHY_COMMIT_TX_FIFO
(Ë
	`PHY_CommôTxFifo
()

	)

190 
	#PHY_GET_DATA_CHAN
(Ë
	`PHY_GëD©aCh™
()

	)

199 
	#PHY_CHIP_ID_CC2540
 0x8D

	)

200 
	#PHY_CHIP_ID_CC2541
 0x41

	)

201 
	#PHY_CHIP_ID_CC2541S
 0x42

	)

204 
	#PHY_DATA_BANK_PTR
 
RFCORE_RAM


	)

205 
	#PHY_RX_FIFO_PTR
 
RXFIFO


	)

206 
	#PHY_TX_FIFO_PTR
 
TXFIFO


	)

209 
	#BLE_REG_BASE_ADDR
 (0x6000)

	)

210 
	#BLE_RX_FIFO_BASE_ADDR
 (0x6080)

	)

211 
	#BLE_TX_FIFO_BASE_ADDR
 (0x6100)

	)

212 
	#BLE_BANK_SIZE
 128

	)

213 
	#BLE_MAX_TX_FIFO_SIZE
 128

	)

214 
	#BLE_MAX_RX_FIFO_SIZE
 128

	)

216 
	#BLE_CHAN
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 0))

217 
	#BLE_CHANMAP
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 1))

218 
	#BLE_FIFO_CONF
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 2))

219 
	#BLE_CONF
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 3))

220 
	#BLE_MAXNACK
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 4))

221 

	)

222 
	#BLE_CRCINIT_0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 5))

223 
	#BLE_CRCINIT_1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 6))

224 
	#BLE_CRCINIT_2
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 7))

225 

	)

226 
	#BLE_SEQSTAT
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 8))

227 

	)

228 
	#BLE_BLACKLIST
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 9))

229 

	)

230 
	#BLE_BACKOFFCNT_0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 10))

231 
	#BLE_BACKOFFCNT_1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 11))

232 

	)

233 
	#BLE_SCANCONF
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 12))

234 

	)

235 
	#BLE_WINCONF
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 13))

236 

	)

237 
	#BLE_WINOFFSET_0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 14))

238 
	#BLE_WINOFFSET_1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 15))

239 

	)

240 
	#BLE_WINMOD_0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 16))

241 
	#BLE_WINMOD_1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 17))

242 

	)

243 
	#BLE_MAX_LEN
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 18))

244 
	#BLE_LEN_BIT_MASK
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 19))

245 

	)

246 
	#BLE_WLPOLICY
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 20))

247 
	#BLE_ADDRTYPE
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 21))

248 

	)

249 
	#BLE_OWNADDR_0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 22))

250 
	#BLE_OWNADDR_1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 23))

251 
	#BLE_OWNADDR_2
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 24))

252 
	#BLE_OWNADDR_3
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 25))

253 
	#BLE_OWNADDR_4
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 26))

254 
	#BLE_OWNADDR_5
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 27))

255 

	)

256 
	#BLE_PEERADDR_0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 28))

257 
	#BLE_PEERADDR_1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 29))

258 
	#BLE_PEERADDR_2
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 30))

259 
	#BLE_PEERADDR_3
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 31))

260 
	#BLE_PEERADDR_4
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 32))

261 
	#BLE_PEERADDR_5
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 33))

262 

	)

263 
	#BLE_WLVALID
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 34))

264 
	#BLE_WLADDRTYPE
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 35))

265 
	#BLE_WL_PTR
 
	`PXREG
((
BLE_REG_BASE_ADDR
 + 36))

266 

	)

267 
	#BLE_NTXDONE
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 84))

268 
	#BLE_NTXACK
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 85))

269 
	#BLE_NTXCTRLACK
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 86))

270 
	#BLE_NTXCTRL
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 87))

271 
	#BLE_NTXRETRANS
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 88))

272 
	#BLE_NTX
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 89))

273 
	#BLE_NRXOK
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 90))

274 
	#BLE_NRXCTRL
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 91))

275 
	#BLE_NRXNOK
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 92))

276 
	#BLE_NRXIGNORED
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 93))

277 
	#BLE_NRXEMPTY
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 94))

278 
	#BLE_NRXFIFOFULL
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 95))

279 

	)

286 
	#BLE_RAW_CONF
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 81))

287 
	#BLE_RAW_FIFOCMD
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 82))

288 
	#BLE_RAW_WINIT
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 83))

289 
	#BLE_RAW_CRCINIT0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 84))

290 
	#BLE_RAW_CRCINIT1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 85))

291 
	#BLE_RAW_CRCINIT2
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 86))

292 
	#BLE_RAW_CRCINIT3
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 87))

294 
	#BLE_RAW_NTX0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 88))

295 
	#BLE_RAW_NTX1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 89))

296 
	#BLE_RAW_NRXOK0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 90))

297 
	#BLE_RAW_NRXOK1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 91))

298 
	#BLE_RAW_NRXNOK0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 92))

299 
	#BLE_RAW_NRXNOK1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 93))

301 
	#BLE_RAW_TX_CRC_LEN
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 94))

302 
	#BLE_RAW_RX_LEN
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 95))

305 

	)

306 
	#BLE_LAST_RSSI
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 96))

307 
	#BLE_ENDCAUSE
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 97))

308 
	#BLE_ANCHOR_VALID
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 98))

309 
	#BLE_DF_BYTES
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 99))

310 
	#BLE_RX_TIMEOUT0
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 100))

311 
	#BLE_RX_TIMEOUT1
 
	`XREG
((
BLE_REG_BASE_ADDR
 + 101))

312 

	)

314 
	#PHY_SCAN_WL
 0

	)

315 
	#PHY_HOST_WL
 1

	)

318 
	#PHY_FIFO_SIZE
 0x80

	)

319 
	#PHY_RSSI_VALUE_INVALID
 0x80

	)

320 
	#PHY_NUM_RF_CHANS
 40

	)

321 
	#PHY_FIRST_RF_CHAN
 0

	)

322 
	#PHY_LAST_RF_CHAN
 (
PHY_NUM_RF_CHANS
-1)

	)

325 
	#PHY_FIFO_RX_RESET
 0x81

	)

326 
	#PHY_FIFO_RX_DEALLOC
 0x82

	)

327 
	#PHY_FIFO_RX_RETRY
 0x83

	)

328 
	#PHY_FIFO_RX_DISCARD
 0x84

	)

329 
	#PHY_FIFO_RX_COMMIT
 0x85

	)

331 
	#PHY_FIFO_TX_RESET
 0x91

	)

332 
	#PHY_FIFO_TX_DEALLOC
 0x92

	)

333 
	#PHY_FIFO_TX_RETRY
 0x93

	)

334 
	#PHY_FIFO_TX_DISCARD
 0x94

	)

335 
	#PHY_FIFO_TX_COMMIT
 0x95

	)

337 
	#PHY_FIFO_RESET
 0xF1

	)

338 
	#PHY_FIFO_DEALLOC
 0xF2

	)

339 
	#PHY_FIFO_RETRY
 0xF3

	)

340 
	#PHY_FIFO_DISCARD
 0xF4

	)

341 
	#PHY_FIFO_COMMIT
 0xF5

	)

344 
	#PHY_PN7_WHITENER_BIT
 
	`BV
(0)

	)

345 
	#PHY_PN9_WHITENER_BIT
 
	`BV
(1)

	)

347 
	#PHY_MOD_NO_TONE
 0x04

	)

348 
	#PHY_MOD_GFSK_250KHZ_1MBPS_TONE
 0x24

	)

349 
	#PHY_MOD_GFSK_156KHZ_250KBPS_TONE
 0x28

	)

350 
	#PHY_MOD_GFSK_156KHZ_1MBPS_TONE
 0x2C

	)

351 
	#PHY_MOD_MSK_250KBPS_TONE
 0x30

	)

352 
	#PHY_MOD_MSK_500KBPS_TONE
 0x32

	)

353 
	#PHY_MOD_MSK_1MBPS_TONE
 0x34

	)

355 
	#PHY_CORRELATION_THRESHOLD
 0x48

	)

356 
	#PHY_FREQ_OFFSET
 0x40

	)

358 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

359 
	#PHY_TX_FILTER_CONFIG
 0x03

	)

360 
	#PHY_TX_CTRL_DAC_CURRENT
 0x19

	)

361 
	#PHY_TX_IV_CTRL
 0x1B

	)

362 
	#PHY_PREAMBLE_SYNC
 0x02

	)

363 
	#PHY_RX_CHARGE_PUMP
 0x0D

	)

365 
	#PHY_TX_FILTER_CONFIG
 0x07

	)

366 
	#PHY_TX_CTRL_DAC_CURRENT
 0x69

	)

367 
	#PHY_TX_IV_CTRL
 0xFF

368 
	#PHY_PREAMBLE_SYNC
 0x00

	)

369 
	#PHY_COMP_QUAD_SKEW
 0x16

	)

373 
	#PHY_FREQ_TUNE_NO_CAP_LOAD
 0x0F

	)

376 
	#PHY_RX_LNA_GAIN_STD
 0x3A

	)

377 
	#PHY_RX_LNA_GAIN_HIGH
 0x7F

	)

378 
	#PHY_RX_CTRL_STD
 0x33

	)

379 
	#PHY_RX_CTRL_HIGH
 0x3F

	)

380 
	#PHY_RX_FSCTRL_STD
 0x55

	)

381 
	#PHY_RX_FSCTRL_HIGH
 0x5A

	)

383 
	#PHY_CC2590_HGM_LOW
 0x00

	)

384 
	#PHY_CC2590_HGM_HIGH
 0x01

	)

387 
	#PHY_RSSI_DB2DBM_STD_GAIN
 0x61

	)

388 
	#PHY_RSSI_DB2DBM_HIGH_GAIN
 0x6A

	)

391 
	#PHY_RSSI_DB2DBM_STD_GAIN_CC2590
 0x67

	)

392 
	#PHY_RSSI_DB2DBM_HIGH_GAIN_CC2590
 0x71

	)

395 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

396 
	#PHY_TX_POWER_REG_MINUS_23_DBM
 0x31

	)

397 
	#PHY_TX_POWER_REG_MINUS_6_DBM
 0xB1

	)

398 
	#PHY_TX_POWER_REG_0_DBM
 0xE1

	)

399 
	#PHY_TX_POWER_REG_4_DBM
 0xFF

400 #ñ£ // CC2540

	)

401 
	#PHY_TX_POWER_REG_MINUS_23_DBM
 0x05

	)

402 
	#PHY_TX_POWER_REG_MINUS_6_DBM
 0x95

	)

403 
	#PHY_TX_POWER_REG_0_DBM
 0xD5

	)

404 
	#PHY_TX_POWER_REG_4_DBM
 0xF5

	)

408 
	#PHY_RFIRQ0_TXTHSHDN_BIT
 
	`BV
(0)

	)

409 
	#PHY_RFIRQ0_RXTHSHDN_BIT
 
	`BV
(1)

	)

410 
	#PHY_RFIRQ0_TXTHSHUP_BIT
 
	`BV
(2)

	)

411 
	#PHY_RFIRQ0_RXTHSHUP_BIT
 
	`BV
(3)

	)

413 
	#PHY_RFIRQ1_RXOK_BIT
 
	`BV
(0)

	)

414 
	#PHY_RFIRQ1_RXCTRL_BIT
 
	`BV
(1)

	)

415 
	#PHY_RFIRQ1_RXNOK_BIT
 
	`BV
(2)

	)

416 
	#PHY_RFIRQ1_RXIGNORED_BIT
 
	`BV
(3)

	)

417 
	#PHY_RFIRQ1_RXEMPTY_BIT
 
	`BV
(4)

	)

418 
	#PHY_RFIRQ1_TXDONE_BIT
 
	`BV
(5)

	)

419 
	#PHY_RFIRQ1_TASKDONE_BIT
 
	`BV
(6)

	)

420 
	#PHY_RFIRQ1_PINGRSP_BIT
 
	`BV
(7)

	)

423 
	#PHY_RFERR_TXUNDERF_BIT
 
	`BV
(0)

	)

424 
	#PHY_RFERR_RXUNDERF_BIT
 
	`BV
(1)

	)

425 
	#PHY_RFERR_TXOVERF_BIT
 
	`BV
(2)

	)

426 
	#PHY_RFERR_RXOVERF_BIT
 
	`BV
(3)

	)

427 
	#PHY_RFERR_RXTXABO_BIT
 
	`BV
(4)

	)

428 
	#PHY_RFERR_NRERR_BIT
 
	`BV
(5)

	)

429 
	#PHY_RFERR_RXFIFOFULL_BIT
 
	`BV
(6)

	)

435 vﬁ©ûê
	t__xd©a
 * 
	tphyXRegPå_t
;

436 vﬁ©ûê
	t__xd©a
 * 
	tphyXD©aPå_t
;

440 
PHY_STATUS_SUCCESS
,

441 
PHY_STATUS_FAILURE
,

442 
PHY_STATUS_ERROR_BL_CKSUM_FAILURE
,

443 
PHY_STATUS_WL_FULL
,

444 
PHY_STATUS_WL_EMPTY
,

445 
PHY_STATUS_WL_ENTRY_NOT_FOUND
,

446 
PHY_STATUS_WL_ENTRY_FOUND


448 
uöt8
 
	tphySètus_t
;

452 
PHY_SEM_0
,

453 
PHY_SEM_1
,

454 
PHY_SEM_2


456 
uöt8
 
	tphySemId_t
;

461 
PHY_ADDR_TYPE_PUBLIC
,

462 
PHY_ADDR_TYPE_RANDOM


464 
uöt8
 
	tphyAddrTy≥_t
;

469 
PHY_ADV_CHANNEL_37
 = 
BV
(0),

470 
PHY_ADV_CHANNEL_38
 = 
BV
(1),

471 
PHY_ADV_CHANNEL_39
 = 
BV
(2)

473 
uöt8
 
	tphyCh™M≠_t
;

478 
PHY_SCAN_MODE_PASSIVE
,

479 
PHY_SCAN_MODE_ACTIVE


481 
uöt8
 
	tphySˇnMode_t
;

485 
PHY_SCAN_END_ON_ADV_REPORT_DISABLED
,

486 
PHY_SCAN_END_ON_ADV_REPORT_ENABLED


488 
uöt8
 
	tphySˇnEnd_t
;

492 
PHY_END_CONN_CONTINUE
,

493 
PHY_END_CONN_AFTER_NEXT_PKT


495 
uöt8
 
	tphyEndC⁄n_t
;

499 
PHY_MD_BIT_FROM_FIFO_ENTRY
 = (0 << 1),

500 
PHY_MD_BIT_BASED_ON_FIFO_CONTENTS
 = (1 << 1),

501 
PHY_MD_BIT_ALWAYS_ZERO
 = (2 << 1),

502 
PHY_MD_BIT_ALWAYS_ONE
 = (3 << 1)

504 
uöt8
 
	tphyC⁄fMD_t
;

508 
PHY_FIFO_DATA_DIABLE_ALL
 = 0,

509 
PHY_FIFO_DATA_AUTO_FLUSH_IGNORED
 = 
BV
(0),

510 
PHY_FIFO_DATA_AUTO_FLUSH_CRC_ERROR
 = 
BV
(1),

511 
PHY_FIFO_DATA_AUTO_FLUSH_EMPTY_PKT
 = 
BV
(2),

512 
PHY_FIFO_DATA_APPEND_RX_STATUS
 = 
BV
(3)

514 
uöt8
 
	tphyFifoD©a_t
;

518 
PHY_FIFO_CONFIG_DISABLE_ALL
 = 0,

519 
PHY_FIFO_CONFIG_AUTO_DEALLOC_RX
 = 
BV
(0),

520 
PHY_FIFO_CONFIG_AUTO_COMMIT_RX
 = 
BV
(1),

521 
PHY_FIFO_CONFIG_AUTO_DEALLOC_TX
 = 
BV
(4),

522 
PHY_FIFO_CONFIG_AUTO_COMMIT_TX
 = 
BV
(5)

524 
uöt8
 
	tphyFifoC⁄fig_t
;

528 
PHY_ADVERTISER_WHITE_LIST_NONE
,

529 
PHY_ADVERTISER_WHITE_LIST_SCAN_REQ
,

530 
PHY_ADVERTISER_WHITE_LIST_CONNECT_REQ
,

531 
PHY_ADVERTISER_WHITE_LIST_ALL


533 
uöt8
 
	tphyAdvWlPﬁicy_t
;

537 
PHY_SCANNER_ALLOW_ALL_ADV_PKTS
,

538 
PHY_SCANNER_USE_WHITE_LIST


540 
uöt8
 
	tphySˇnWlPﬁicy_t
;

544 
PHY_INITIATOR_USE_PEER_ADDR
,

545 
PHY_INITIATOR_USE_WL


547 
uöt8
 
	tphyInôWlPﬁicy_t
;

551 
PHY_SET_BLACKLIST_DISABLE
,

552 
PHY_SET_BLACKLIST_ENABLE


554 
uöt8
 
	tphyBœckli°_t
;

558 
PHY_DISABLE_ALL_WHITENER
,

559 
PHY_ENABLE_BLE_WHITENER
,

560 
PHY_DISABLE_BLE_WHITENER
,

561 
PHY_ENABLE_PN9_WHITENER
,

562 
PHY_DISABLE_PN9_WHITENER
,

563 
PHY_ENABLE_ONLY_BLE_WHITENER
,

564 
PHY_ENABLE_ONLY_PN9_WHITENER
,

565 
PHY_ENABLE_ALL_WHITENER


567 
uöt8
 
	tphyWhôíî_t
;

571 
PHY_ENABLE_APPEND_RF_STATUS
,

572 
PHY_DISABLE_APPEND_RF_STATUS


574 
uöt8
 
	tphyAµídRfSètus_t
;

578 
PHY_RF_RAM_BANK_0
,

579 
PHY_RF_RAM_BANK_1
,

580 
PHY_RF_RAM_BANK_2
,

581 
PHY_RF_RAM_BANK_3
,

582 
PHY_RF_RAM_BANK_4
,

583 
PHY_RF_RAM_BANK_5
,

584 
PHY_RF_RAM_RX_FIFO
,

585 
PHY_RF_RAM_TX_FIFO


587 
uöt8
 
	tphyRfRamB™k_t
;

591 
PHY_CMD_SHUTDOWN
 = 1,

592 
PHY_CMD_DEMOD_TEST
 = 2,

593 
PHY_CMD_RX_TEST
 = 3,

594 
PHY_CMD_TX_TEST
 = 4,

595 
PHY_CMD_TX_CAL_TEST
 = 5,

596 
PHY_CMD_PING
 = 6,

598 
PHY_CMD_BLE_SLAVE
 = 16,

599 
PHY_CMD_BLE_MASTER
 = 17,

601 
PHY_CMD_BLE_ADV
 = 18,

602 
PHY_CMD_BLE_ADV_DIR
 = 19,

603 
PHY_CMD_BLE_ADV_NC
 = 20,

604 
PHY_CMD_BLE_ADV_DISC
 = 21,

606 
PHY_CMD_BLE_SCAN
 = 22,

607 
PHY_CMD_BLE_INITIATOR
 = 23,

609 
PHY_CMD_BLE_RX_RAW
 = 24,

610 
PHY_CMD_BLE_TX_RAW
 = 25,

612 
PHY_CMD_SEND_EVENT1
 = 33,

613 
PHY_CMD_SEND_EVENT2
 = 34,

615 
PHY_CMD_INVALID
 = 0xFF

617 
uöt8
 
	tphyCmd_t
;

621 
PHY_TASK_ENDOK
 = 0,

622 
PHY_TASK_RXTIMEOUT
 = 1,

623 
PHY_TASK_NOSYNC
 = 2,

624 
PHY_TASK_RXERR
 = 3,

625 
PHY_TASK_CONNECT
 = 4,

626 
PHY_TASK_MAXNACK
 = 5,

627 
PHY_TASK_ABORT
 = 6,

633 
PHY_TASKERR_RXFIFO
 = 250,

634 
PHY_TASKERR_TXFIFO
 = 251,

635 
PHY_TASKERR_PAR
 = 252,

636 
PHY_TASKERR_SEM
 = 253,

637 
PHY_TASKERR_CMD
 = 254,

638 
PHY_TASKERR_INTERNAL
 = 255

643 
PHY_FREQ_MODE_MODULATED_CW
,

644 
PHY_FREQ_MODE_UNMODULATED_CW


646 
uöt8
 
	tphyFªqMode_t
;

650 
PHY_RAW_RUN_ONCE
,

651 
PHY_RAW_RUN_REPEAT


653 
uöt8
 
	tphyRawRunMode_t
;

657 
PHY_RAW_START_IMMEDIATE
,

658 
PHY_RAW_START_ON_TIMER_EVENT


660 
uöt8
 
	tphyRawSèπMode_t
;

691 
PHY_Inô
( );

711 
PHY_Re£t
( );

732 
PHY_LﬂdNR
( );

752 
phySètus_t
 
PHY_VîifyNR
( );

770 
PHY_CÀ¨AŒRegsAndFifos
( );

789 
phySètus_t
 
PHY_GëSem
–
phySemId_t
 
£mId
 );

808 
phySètus_t
 
PHY_Rñó£Sem
–
phySemId_t
 
£mId
 );

827 
PHY_SëOwnAddr
–
uöt8
 *
addr
,

828 
phyAddrTy≥_t
 
addrTy≥
);

847 
PHY_SëPìrAddr
–
uöt8
 *
addr
,

848 
phyAddrTy≥_t
 
addrTy≥
);

866 
PHY_SëCRCInô
–
uöt32
 
¸cInô
 );

885 
phyCh™M≠_t
 
PHY_GëAdvCh™s
( );

905 
PHY_SëAdvCh™s
–
uöt8
 
advCh™M≠
 );

925 
NEAR_FUNC
 
PHY_SëD©aCh™
–
uöt8
 
d©aCh™
 );

944 
NEAR_FUNC
 
uöt8
 
PHY_GëD©aCh™
( );

963 
PHY_SëEndC⁄√˘i⁄
–
phyEndC⁄n_t
 
ídC⁄n
 );

985 
PHY_C⁄figuªMD
–
phyC⁄fMD_t
 
m‹eD©a
 );

1003 
PHY_SëBackoffC¡
–
uöt16
 
cou¡
 );

1021 
PHY_SëSˇnMode
–
phySˇnMode_t
 
sˇnMode
 );

1041 
PHY_SëSˇnEnd
–
phySˇnEnd_t
 
sˇnEnd
 );

1059 
uöt8
 
PHY_GëEndCau£
( );

1078 
uöt8
 
PHY_Anch‹VÆid
( );

1097 
PHY_InôSeqSèt
( );

1119 
uöt8
 
PHY_Fú°PktRe˚ived
( );

1139 
uöt8
 
PHY_CålAckPídög
( );

1159 
PHY_SëSyncW‹d
–
uöt32
 
syncW‹d
 );

1178 
PHY_SëMaxNack
–
uöt8
 
maxNackCou¡
 );

1196 
PHY_CÀ¨Whôñi°
( );

1214 
PHY_CÀ¨WlE¡ry
–
uöt8
 
wlE¡ryIndex
 );

1233 
PHY_CÀ¨WlBa£dOnBl
( );

1251 
uöt8
 
PHY_GëNumFªeWlE¡rõs
( );

1269 
uöt8
 
PHY_GëWlSize
( );

1291 
phySètus_t
 
PHY_AddWlE¡ry
–
uöt8
 *
addr
,

1292 
phyAddrTy≥_t
 
addrTy≥
,

1293 
phyBœckli°_t
 
£tBœckli°
 );

1316 
phySètus_t
 
PHY_RemoveWlE¡ry
–
uöt8
 *
addr
,

1317 
phyAddrTy≥_t
 
addrTy≥
 );

1338 
PHY_SëAdvWlPﬁicy
–
phyAdvWlPﬁicy_t
 
wlPﬁicy
 );

1357 
PHY_SëSˇnWlPﬁicy
–
phySˇnWlPﬁicy_t
 
wlPﬁicy
 );

1376 
PHY_SëInôWlPﬁicy
–
phyInôWlPﬁicy_t
 
wlPﬁicy
 );

1398 
PHY_SëBœckli°Index
–
uöt8
 
bœckLi°Index
 );

1420 
phySètus_t
 
PHY_SëBœckli°E¡ry
–
uöt8
 *
addr
,

1421 
phyAddrTy≥_t
 
addrTy≥
 );

1439 
PHY_CÀ¨Bœckli°Index
–
uöt8
 
bœckLi°Index
 );

1460 
PHY_CÀ¨Bœckli°
( );

1480 
PHY_SaveWhôeLi°
–
uöt8
 
wlOw√r
 );

1500 
PHY_Re°‹eWhôeLi°
–
uöt8
 
wlOw√r
 );

1520 
PHY_CÀ¨SavedWhôeLi°
–
uöt8
 
wlOw√r
 );

1538 
PHY_Comm™d
–
phyCmd_t
 
cmd
 );

1556 
PHY_CÀ¨Cou¡îs
( );

1574 
PHY_RódCou¡îs
–
uöt8
 *
˙tPå
 );

1601 
PHY_C⁄figuªFifoD©aPro˚ssög
–
phyFifoD©a_t
 
fifoD©aC⁄f
 );

1621 
PHY_C⁄figuªAµídRfSètus
–
phyAµídRfSètus_t
 
≠≥ndRfSètus
 );

1647 
PHY_SëFifoC⁄fig
–
phyFifoC⁄fig_t
 
fifoC⁄fig
 );

1665 
PHY_InôLa°Rssi
( );

1687 
uöt8
 
PHY_GëLa°Rssi
( );

1710 
uöt8
 
PHY_GëRssi
( );

1729 
PHY_CÀ¨WöC⁄fig
( );

1756 
PHY_SëDy«micWöOff£t
–
uöt16
 
wöOff£t
,

1757 
uöt16
 
c⁄nI¡îvÆ
 );

1783 
PHY_C⁄figWhôíî
–
phyWhôíî_t
 
whôíî
 );

1801 
PHY_Re£tTxFifo
( );

1819 
PHY_Re£tRxFifo
( );

1837 
PHY_Re£tTxRxFifo
( );

1855 
uöt8
 
PHY_TxFifoByãsFªe
( );

1873 
uöt8
 
PHY_TxFifoLí
( );

1891 
uöt8
 
PHY_RxFifoLí
( );

1913 
PHY_RëryTxFifo
( );

1931 
PHY_RëryRxFifo
( );

1949 
PHY_CommôTxFifo
( );

1967 
PHY_CommôRxFifo
( );

1985 
PHY_DisˇrdTxFifo
( );

2003 
PHY_DóŒoˇãRxFifo
( );

2021 
PHY_SëRxFifoThªshﬁd
–
uöt8
 
thªsLí
 );

2039 
uöt8
 *
PHY_GëTxSWP
( );

2057 
uöt8
 *
PHY_GëRxSRP
( );

2079 
PHY_WrôeByã
–
uöt8
 *
d©a
,

2080 
uöt8
 
Àn
 );

2101 
PHY_WrôeByãVÆ
–
uöt8
 
vÆue
 );

2125 
PHY_RódByã
–
uöt8
 *
±r
,

2126 
uöt8
 
Àn
 );

2147 
uöt8
 
PHY_RódByãVÆ
( );

2173 
PHY_M≠D©aB™k
–
phyRfRamB™k_t
 
b™kNum
 );

2197 
PHY_SaveRe°‹eC⁄n
–
uöt8
 
ßveC⁄nId
,

2198 
uöt8
 
ª°‹eC⁄nId
 );

2218 
PHY_Re°‹eC⁄n
–
uöt8
 
c⁄nId
 );

2240 
PHY_RawTxInô
–
phyRawSèπMode_t
 
°¨tMode
,

2241 
phyRawRunMode_t
 
runMode
 );

2263 
PHY_RawRxInô
–
phyRawSèπMode_t
 
°¨tMode
,

2264 
phyRawRunMode_t
 
runMode
 );

2282 
PHY_RawGëNumTxPkts
–
uöt16
 *
numTxPkts
 );

2300 
PHY_RawGëNumRxPkts
–
uöt16
 *
numRxPkts
 );

2322 
PHY_RawGëRxD©a
–
uöt16
 *
numRxPkts
,

2323 
uöt16
 *
numRxEºPkts
,

2324 
uöt8
 *
rxRSSI
 );

2347 
PHY_SëRfFªq
–
uöt8
 
rfCh™
,

2348 
phyFªqMode_t
 
‰eqMode
 );

2351 #ifde‡
__˝lu•lus


	@Components/ble/controller/include/phy_image.h

53 #i‚de‡
PHY_IMAGE_H


54 
	#PHY_IMAGE_H


	)

56 #ifde‡
__˝lu•lus


73 
	#NR_IMAGE_SIZE
 3582

	)

79 c⁄° 
	tƒImage_t
;

89 
ƒImage_t
 
N™oRiscImage
[];

91 #ifde‡
__˝lu•lus


	@Components/ble/hci/hci_data.h

39 #i‚de‡
HCI_C_DATA_H


40 
	#HCI_C_DATA_H


	)

42 #ifde‡
__˝lu•lus


50 
	~"oßl_bufmgr.h
"

56 
	#HCI_Re£tC⁄åﬁÀrBuf„rs
(Ë
	`HCI_TxD©aBuf„rInô
()

	)

62 
	#UNDEFINED_CONN_HANDLE
 0xFFFF

	)

65 
	#DATA_BUF_FREE
 0

	)

66 
	#DATA_BUF_IN_USE
 1

	)

67 
	#DATA_BUF_PENDING
 2

	)

75 
uöt8
 
°©e
;

76 
uöt16
 
c⁄nH™dÀ
;

77 
uöt8
 
‰agFœg
;

78 
uöt16
 
Àn
;

79 
uöt8
 *
pD©a
;

80 } 
	thciTxD©a_t
;

107 
HCI_TxD©aBuf„rInô
( );

110 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

130 
hciSètus_t
 
HCI_TxD©aBuf„rIn£π
–
uöt16
 
c⁄nH™dÀ
,

131 
uöt8
 
pbFœg
,

132 
uöt16
 
pktLí
,

133 
uöt8
 *
pD©a
 );

137 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

159 
HCI_TxD©aSíd
–
uöt8
 
c⁄nH™dÀ
 );

184 
HCI_Revî£Byãs
–
uöt8
 *
buf
,

185 
uöt8
 
Àn
 );

188 #ifde‡
__˝lu•lus


	@Components/ble/hci/hci_event.h

40 #i‚de‡
HCI_C_EVENT_H


41 
	#HCI_C_EVENT_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"hci_é.h
"

53 
uöt8
 
bÀEvtMask
;

54 
uöt8
 
pHciEvtMask
[];

65 
	#BT_EVT_MASK_BYTE0
 0xFF

	)

66 
	#BT_EVT_MASK_BYTE1
 0xFF

	)

67 
	#BT_EVT_MASK_BYTE2
 0xFF

	)

68 
	#BT_EVT_MASK_BYTE3
 0xFF

	)

69 
	#BT_EVT_MASK_BYTE4
 0xFF

	)

70 
	#BT_EVT_MASK_BYTE5
 0x9F

	)

71 
	#BT_EVT_MASK_BYTE6
 0x00

	)

72 
	#BT_EVT_MASK_BYTE7
 0x20

	)

74 
	#LE_EVT_MASK_DEFAULT
 0x1F

	)

92 
hciInôEvítMasks
( );

114 
HCI_D©aBuf„rOvîÊowEvít
–
uöt8
 
lökTy≥
 );

138 
HCI_NumOfCom∂ëedPackësEvít
–
uöt8
 
numH™dÀs
,

139 
uöt16
 *
h™dÀrs
,

140 
uöt16
 *
numCom∂ëedPackës
 );

160 
HCI_Comm™dCom∂ëeEvít
–
uöt16
 
›code
,

161 
uöt8
 
numP¨am
,

162 
uöt8
 *
∑øm
 );

183 
HCI_Víd‹S≥cifcComm™dCom∂ëeEvít
–
uöt16
 
›code
,

184 
uöt8
 
Àn
,

185 
uöt8
 *
∑øm
 );

204 
HCI_Comm™dSètusEvít
–
uöt8
 
°©us
,

205 
uöt16
 
›code
 );

223 
HCI_H¨dw¨eEº‹Evít
–
uöt8
 
hwEº‹Code
 );

244 
HCI_SídComm™dSètusEvít
 ( 
uöt8
 
evítCode
,

245 
uöt16
 
°©us
,

246 
uöt16
 
›code
 );

268 
HCI_SídComm™dCom∂ëeEvít
 ( 
uöt8
 
evítCode
,

269 
uöt16
 
›code
,

270 
uöt8
 
numP¨am
,

271 
uöt8
 *
∑øm
 );

291 
HCI_SídC⁄åﬁÀrToHo°Evít
–
uöt8
 
evítCode
,

292 
uöt8
 
d©aLí
,

293 
uöt8
 *
pD©a
 );

295 #ifde‡
__˝lu•lus


	@Components/ble/hci/hci_tl.h

40 #i‚de‡
HCI_TL_H


41 
	#HCI_TL_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"hci.h
"

53 
	~"OSAL.h
"

54 
	~"hÆ_u¨t.h
"

55 
	~"hci_d©a.h
"

56 
	~"hci_evít.h
"

58 
uöt8
 
hciTaskID
;

60 
uöt8
 
hciTe°TaskID
;

61 
uöt8
 
hciG≠TaskID
;

62 
uöt8
 
hciL2ˇpTaskID
;

63 
uöt8
 
hciSmpTaskID
;

69 
	#HCI_ASSERT
(
c⁄dôi⁄
Ë
	`HAL_ASSERT
(c⁄dôi⁄)

	)

76 
	#HCI_TX_PROCESS_EVENT
 0x0001

	)

77 
	#HCI_TEST_UART_SEND_EVENT
 0x0002

	)

78 
	#HCI_BDADDR_UPDATED_EVENT
 0x4000

	)

79 
	#HCI_OSAL_MSG_EVENT
 
SYS_EVENT_MSG


	)

82 
	#HCI_CONTROLLER_TO_HOST_EVENT
 0x01

	)

83 
	#HCI_HOST_TO_CTRL_CMD_EVENT
 0x02

	)

84 
	#HCI_HOST_TO_CTRL_DATA_EVENT
 0x03

	)

86 
	#HCI_BDADDR_LEN
 6

	)

89 
	#HCI_MAX_NUM_DATA_BUFFERS
 0x04

	)

90 
	#HCI_MAX_NUM_CMD_BUFFERS
 0x01

	)

93 
	#HCI_MAX_CMD_PKT_SIZE
 0xFF

	)

94 
	#HCI_MAX_DATA_PKT_SIZE
 0xFFFF

	)

97 
	#HCI_DATA_MAX_DATA_LENGTH
 27

	)

103 
	#HCI_CMD_MIN_LENGTH
 4

	)

109 
	#HCI_EVENT_MIN_LENGTH
 3

	)

115 
	#HCI_DATA_MIN_LENGTH
 5

	)

118 
	#HCI_MAX_NUM_CONNECTIONS
 0x03

	)

120 
	#HCI_TX_DATA_ANY_CONNECTION
 0xFF

	)

123 
	#HCI_CMD_PACKET
 0x01

	)

124 
	#HCI_ACL_DATA_PACKET
 0x02

	)

125 
	#HCI_SCO_DATA_PACKET
 0x03

	)

126 
	#HCI_EVENT_PACKET
 0x04

	)

133 
	#HCI_DISCONNECT
 0x0406

	)

134 
	#HCI_READ_REMOTE_VERSION_INFO
 0x041D

	)

137 
	#HCI_SET_EVENT_MASK
 0x0C01

	)

138 
	#HCI_RESET
 0x0C03

	)

139 
	#HCI_READ_TRANSMIT_POWER
 0x0C2D

	)

140 
	#HCI_SET_CONTROLLER_TO_HOST_FLOW_CONTROL
 0x0C31

	)

141 
	#HCI_HOST_BUFFER_SIZE
 0x0C33

	)

142 
	#HCI_HOST_NUM_COMPLETED_PACKETS
 0x0C35

	)

145 
	#HCI_READ_LOCAL_VERSION_INFO
 0x1001

	)

146 
	#HCI_READ_LOCAL_SUPPORTED_COMMANDS
 0x1002

	)

147 
	#HCI_READ_LOCAL_SUPPORTED_FEATURES
 0x1003

	)

148 
	#HCI_READ_BDADDR
 0x1009

	)

151 
	#HCI_READ_RSSI
 0x1405

	)

154 
	#HCI_LE_SET_EVENT_MASK
 0x2001

	)

155 
	#HCI_LE_READ_BUFFER_SIZE
 0x2002

	)

156 
	#HCI_LE_READ_LOCAL_SUPPORTED_FEATURES
 0x2003

	)

157 
	#HCI_LE_SET_RANDOM_ADDR
 0x2005

	)

158 
	#HCI_LE_SET_ADV_PARAM
 0x2006

	)

159 
	#HCI_LE_READ_ADV_CHANNEL_TX_POWER
 0x2007

	)

160 
	#HCI_LE_SET_ADV_DATA
 0x2008

	)

161 
	#HCI_LE_SET_SCAN_RSP_DATA
 0x2009

	)

162 
	#HCI_LE_SET_ADV_ENABLE
 0x200A

	)

163 
	#HCI_LE_SET_SCAN_PARAM
 0x200B

	)

164 
	#HCI_LE_SET_SCAN_ENABLE
 0x200C

	)

165 
	#HCI_LE_CREATE_CONNECTION
 0x200D

	)

166 
	#HCI_LE_CREATE_CONNECTION_CANCEL
 0x200E

	)

167 
	#HCI_LE_READ_WHITE_LIST_SIZE
 0x200F

	)

168 
	#HCI_LE_CLEAR_WHITE_LIST
 0x2010

	)

169 
	#HCI_LE_ADD_WHITE_LIST
 0x2011

	)

170 
	#HCI_LE_REMOVE_WHITE_LIST
 0x2012

	)

171 
	#HCI_LE_CONNECTION_UPDATE
 0x2013

	)

172 
	#HCI_LE_SET_HOST_CHANNEL_CLASSIFICATION
 0x2014

	)

173 
	#HCI_LE_READ_CHANNEL_MAP
 0x2015

	)

174 
	#HCI_LE_READ_REMOTE_USED_FEATURES
 0x2016

	)

175 
	#HCI_LE_ENCRYPT
 0x2017

	)

176 
	#HCI_LE_RAND
 0x2018

	)

177 
	#HCI_LE_START_ENCRYPTION
 0x2019

	)

178 
	#HCI_LE_LTK_REQ_REPLY
 0x201A

	)

179 
	#HCI_LE_LTK_REQ_NEG_REPLY
 0x201B

	)

180 
	#HCI_LE_READ_SUPPORTED_STATES
 0x201C

	)

181 
	#HCI_LE_RECEIVER_TEST
 0x201D

	)

182 
	#HCI_LE_TRANSMITTER_TEST
 0x201E

	)

183 
	#HCI_LE_TEST_END
 0x201F

	)

186 
	#HCI_EXT_SET_RX_GAIN
 0xFC00

	)

187 
	#HCI_EXT_SET_TX_POWER
 0xFC01

	)

188 
	#HCI_EXT_ONE_PKT_PER_EVT
 0xFC02

	)

189 
	#HCI_EXT_CLK_DIVIDE_ON_HALT
 0xFC03

	)

190 
	#HCI_EXT_DECLARE_NV_USAGE
 0xFC04

	)

191 
	#HCI_EXT_DECRYPT
 0xFC05

	)

192 
	#HCI_EXT_SET_LOCAL_SUPPORTED_FEATURES
 0xFC06

	)

193 
	#HCI_EXT_SET_FAST_TX_RESP_TIME
 0xFC07

	)

194 
	#HCI_EXT_MODEM_TEST_TX
 0xFC08

	)

195 
	#HCI_EXT_MODEM_HOP_TEST_TX
 0xFC09

	)

196 
	#HCI_EXT_MODEM_TEST_RX
 0xFC0A

	)

197 
	#HCI_EXT_END_MODEM_TEST
 0xFC0B

	)

198 
	#HCI_EXT_SET_BDADDR
 0xFC0C

	)

199 
	#HCI_EXT_SET_SCA
 0xFC0D

	)

200 
	#HCI_EXT_ENABLE_PTM
 0xFC0E

201 
	#HCI_EXT_SET_FREQ_TUNE
 0xFC0F

	)

202 
	#HCI_EXT_SAVE_FREQ_TUNE
 0xFC10

	)

203 
	#HCI_EXT_SET_MAX_DTM_TX_POWER
 0xFC11

	)

204 
	#HCI_EXT_MAP_PM_IO_PORT
 0xFC12

	)

205 
	#HCI_EXT_DISCONNECT_IMMED
 0xFC13

	)

206 
	#HCI_EXT_PER
 0xFC14

	)

207 
	#HCI_EXT_PER_BY_CHAN
 0xFC15

208 
	#HCI_EXT_EXTEND_RF_RANGE
 0xFC16

	)

209 
	#HCI_EXT_ADV_EVENT_NOTICE
 0xFC17

210 
	#HCI_EXT_CONN_EVENT_NOTICE
 0xFC18

211 
	#HCI_EXT_HALT_DURING_RF
 0xFC19

	)

212 
	#HCI_EXT_OVERRIDE_SL
 0xFC1A

	)

213 
	#HCI_EXT_BUILD_REVISION
 0xFC1B

	)

220 
	#HCI_DISCONNECTION_COMPLETE_EVENT_CODE
 0x05

	)

221 
	#HCI_ENCRYPTION_CHANGE_EVENT_CODE
 0x08

	)

222 
	#HCI_READ_REMOTE_INFO_COMPLETE_EVENT_CODE
 0x0C

	)

223 
	#HCI_COMMAND_COMPLETE_EVENT_CODE
 0x0E

	)

224 
	#HCI_COMMAND_STATUS_EVENT_CODE
 0x0F

	)

225 
	#HCI_BLE_HARDWARE_ERROR_EVENT_CODE
 0x10

	)

226 
	#HCI_NUM_OF_COMPLETED_PACKETS_EVENT_CODE
 0x13

	)

227 
	#HCI_DATA_BUFFER_OVERFLOW_EVENT
 0x1A

	)

228 
	#HCI_KEY_REFRESH_COMPLETE_EVENT_CODE
 0x30

	)

231 
	#HCI_LE_EVENT_CODE
 0x3E

	)

234 
	#HCI_BLE_CONNECTION_COMPLETE_EVENT
 0x01

	)

235 
	#HCI_BLE_ADV_REPORT_EVENT
 0x02

	)

236 
	#HCI_BLE_CONN_UPDATE_COMPLETE_EVENT
 0x03

	)

237 
	#HCI_BLE_READ_REMOTE_FEATURE_COMPLETE_EVENT
 0x04

	)

238 
	#HCI_BLE_LTK_REQUESTED_EVENT
 0x05

	)

241 
	#HCI_VE_EVENT_CODE
 0xFF

	)

244 
	#HCI_EXT_SET_RX_GAIN_EVENT
 0x0400

	)

245 
	#HCI_EXT_SET_TX_POWER_EVENT
 0x0401

	)

246 
	#HCI_EXT_ONE_PKT_PER_EVT_EVENT
 0x0402

	)

247 
	#HCI_EXT_CLK_DIVIDE_ON_HALT_EVENT
 0x0403

	)

248 
	#HCI_EXT_DECLARE_NV_USAGE_EVENT
 0x0404

	)

249 
	#HCI_EXT_DECRYPT_EVENT
 0x0405

	)

250 
	#HCI_EXT_SET_LOCAL_SUPPORTED_FEATURES_EVENT
 0x0406

	)

251 
	#HCI_EXT_SET_FAST_TX_RESP_TIME_EVENT
 0x0407

	)

252 
	#HCI_EXT_MODEM_TEST_TX_EVENT
 0x0408

	)

253 
	#HCI_EXT_MODEM_HOP_TEST_TX_EVENT
 0x0409

	)

254 
	#HCI_EXT_MODEM_TEST_RX_EVENT
 0x040A

	)

255 
	#HCI_EXT_END_MODEM_TEST_EVENT
 0x040B

	)

256 
	#HCI_EXT_SET_BDADDR_EVENT
 0x040C

	)

257 
	#HCI_EXT_SET_SCA_EVENT
 0x040D

	)

258 
	#HCI_EXT_ENABLE_PTM_EVENT
 0x040E

259 
	#HCI_EXT_SET_FREQ_TUNE_EVENT
 0x040F

	)

260 
	#HCI_EXT_SAVE_FREQ_TUNE_EVENT
 0x0410

	)

261 
	#HCI_EXT_SET_MAX_DTM_TX_POWER_EVENT
 0x0411

	)

262 
	#HCI_EXT_MAP_PM_IO_PORT_EVENT
 0x0412

	)

263 
	#HCI_EXT_DISCONNECT_IMMED_EVENT
 0x0413

	)

264 
	#HCI_EXT_PER_EVENT
 0x0414

	)

265 
	#HCI_EXT_PER_BY_CHAN_EVENT
 0x0415

266 
	#HCI_EXT_EXTEND_RF_RANGE_EVENT
 0x0416

	)

267 
	#HCI_EXT_ADV_EVENT_NOTICE_EVENT
 0x0417

268 
	#HCI_EXT_CONN_EVENT_NOTICE_EVENT
 0x0418

269 
	#HCI_EXT_HALT_DURING_RF_EVENT
 0x0419

	)

270 
	#HCI_EXT_OVERRIDE_SL_EVENT
 0x041A

	)

271 
	#HCI_EXT_BUILD_REVISION_EVENT
 0x041B

	)

304 
HCI_Inô
–
uöt8
 
èskID
 );

323 
uöt16
 
HCI_Pro˚ssEvít
–
uöt8
 
èsk_id
,

324 
uöt16
 
evíts
 );

327 #ifde‡
__˝lu•lus


	@Components/ble/host/gatt_uuid.c

45 
	~"comdef.h
"

46 
	~"OSAL.h
"

48 
	~"g©t.h
"

49 
	~"g©t_uuid.h
"

71 
CONST
 
uöt8
 
	gg≠Sîvi˚UUID
[
ATT_BT_UUID_SIZE
] =

73 
LO_UINT16
–
GAP_SERVICE_UUID
 ), 
HI_UINT16
( GAP_SERVICE_UUID )

77 
CONST
 
uöt8
 
	gg©tSîvi˚UUID
[
ATT_BT_UUID_SIZE
] =

79 
LO_UINT16
–
GATT_SERVICE_UUID
 ), 
HI_UINT16
( GATT_SERVICE_UUID )

86 
CONST
 
uöt8
 
	g¥im¨ySîvi˚UUID
[
ATT_BT_UUID_SIZE
] =

88 
LO_UINT16
–
GATT_PRIMARY_SERVICE_UUID
 ), 
HI_UINT16
( GATT_PRIMARY_SERVICE_UUID )

92 
CONST
 
uöt8
 
	g£c⁄d¨ySîvi˚UUID
[
ATT_BT_UUID_SIZE
] =

94 
LO_UINT16
–
GATT_SECONDARY_SERVICE_UUID
 ), 
HI_UINT16
( GATT_SECONDARY_SERVICE_UUID )

98 
CONST
 
uöt8
 
	gö˛udeUUID
[
ATT_BT_UUID_SIZE
] =

100 
LO_UINT16
–
GATT_INCLUDE_UUID
 ), 
HI_UINT16
( GATT_INCLUDE_UUID )

104 
CONST
 
uöt8
 
	gch¨a˘îUUID
[
ATT_BT_UUID_SIZE
] =

106 
LO_UINT16
–
GATT_CHARACTER_UUID
 ), 
HI_UINT16
( GATT_CHARACTER_UUID )

113 
CONST
 
uöt8
 
	gch¨ExtPr›sUUID
[
ATT_BT_UUID_SIZE
] =

115 
LO_UINT16
–
GATT_CHAR_EXT_PROPS_UUID
 ), 
HI_UINT16
( GATT_CHAR_EXT_PROPS_UUID )

119 
CONST
 
uöt8
 
	gch¨U£rDescUUID
[
ATT_BT_UUID_SIZE
] =

121 
LO_UINT16
–
GATT_CHAR_USER_DESC_UUID
 ), 
HI_UINT16
( GATT_CHAR_USER_DESC_UUID )

125 
CONST
 
uöt8
 
	g˛õ¡Ch¨CfgUUID
[
ATT_BT_UUID_SIZE
] =

127 
LO_UINT16
–
GATT_CLIENT_CHAR_CFG_UUID
 ), 
HI_UINT16
( GATT_CLIENT_CHAR_CFG_UUID )

131 
CONST
 
uöt8
 
	g£rvCh¨CfgUUID
[
ATT_BT_UUID_SIZE
] =

133 
LO_UINT16
–
GATT_SERV_CHAR_CFG_UUID
 ), 
HI_UINT16
( GATT_SERV_CHAR_CFG_UUID )

137 
CONST
 
uöt8
 
	gch¨F‹m©UUID
[
ATT_BT_UUID_SIZE
] =

139 
LO_UINT16
–
GATT_CHAR_FORMAT_UUID
 ), 
HI_UINT16
( GATT_CHAR_FORMAT_UUID )

143 
CONST
 
uöt8
 
	gch¨AggF‹m©UUID
[
ATT_BT_UUID_SIZE
] =

145 
LO_UINT16
–
GATT_CHAR_AGG_FORMAT_UUID
 ), 
HI_UINT16
( GATT_CHAR_AGG_FORMAT_UUID )

152 
CONST
 
uöt8
 
	gdevi˚NameUUID
[
ATT_BT_UUID_SIZE
] =

154 
LO_UINT16
–
DEVICE_NAME_UUID
 ), 
HI_UINT16
( DEVICE_NAME_UUID )

158 
CONST
 
uöt8
 
	g≠≥¨™˚UUID
[
ATT_BT_UUID_SIZE
] =

160 
LO_UINT16
–
APPEARANCE_UUID
 ), 
HI_UINT16
( APPEARANCE_UUID )

164 
CONST
 
uöt8
 
	g≥riPrivacyFœgUUID
[
ATT_BT_UUID_SIZE
] =

166 
LO_UINT16
–
PERI_PRIVACY_FLAG_UUID
 ), 
HI_UINT16
( PERI_PRIVACY_FLAG_UUID )

170 
CONST
 
uöt8
 
	gªc⁄√˘AddrUUID
[
ATT_BT_UUID_SIZE
] =

172 
LO_UINT16
–
RECONNECT_ADDR_UUID
 ), 
HI_UINT16
( RECONNECT_ADDR_UUID )

176 
CONST
 
uöt8
 
	g≥riC⁄nP¨amUUID
[
ATT_BT_UUID_SIZE
] =

178 
LO_UINT16
–
PERI_CONN_PARAM_UUID
 ), 
HI_UINT16
( PERI_CONN_PARAM_UUID )

182 
CONST
 
uöt8
 
	g£rvi˚Ch™gedUUID
[
ATT_BT_UUID_SIZE
] =

184 
LO_UINT16
–
SERVICE_CHANGED_UUID
 ), 
HI_UINT16
( SERVICE_CHANGED_UUID )

188 
CONST
 
uöt8
 
	gvÆidR™geUUID
[
ATT_BT_UUID_SIZE
] =

190 
LO_UINT16
–
GATT_VALID_RANGE_UUID
 ), 
HI_UINT16
( GATT_VALID_RANGE_UUID )

194 
CONST
 
uöt8
 
	gextRï‹tRefUUID
[
ATT_BT_UUID_SIZE
] =

196 
LO_UINT16
–
GATT_EXT_REPORT_REF_UUID
 ), 
HI_UINT16
( GATT_EXT_REPORT_REF_UUID )

200 
CONST
 
uöt8
 
	gªp‹tRefUUID
[
ATT_BT_UUID_SIZE
] =

202 
LO_UINT16
–
GATT_REPORT_REF_UUID
 ), 
HI_UINT16
( GATT_REPORT_REF_UUID )

231 c⁄° 
uöt8
 *
	$GATT_FödUUIDRec
–
uöt8
 *
pUUID
, uöt8 
Àn
 )

233 c⁄° 
uöt8
 *
pRec
 = 
NULL
;

235 i‡–
Àn
 =
ATT_BT_UUID_SIZE
 )

238 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pUUID
[0],ÖUUID[1] );

239  
uuid
 )

243 
GAP_SERVICE_UUID
:

244 
pRec
 = 
g≠Sîvi˚UUID
;

247 
GATT_SERVICE_UUID
:

248 
pRec
 = 
g©tSîvi˚UUID
;

253 
GATT_PRIMARY_SERVICE_UUID
:

254 
pRec
 = 
¥im¨ySîvi˚UUID
;

257 
GATT_SECONDARY_SERVICE_UUID
:

258 
pRec
 = 
£c⁄d¨ySîvi˚UUID
;

261 
GATT_INCLUDE_UUID
:

262 
pRec
 = 
ö˛udeUUID
;

265 
GATT_CHARACTER_UUID
:

266 
pRec
 = 
ch¨a˘îUUID
;

271 
GATT_CHAR_EXT_PROPS_UUID
:

272 
pRec
 = 
ch¨ExtPr›sUUID
;

275 
GATT_CHAR_USER_DESC_UUID
:

276 
pRec
 = 
ch¨U£rDescUUID
;

279 
GATT_CLIENT_CHAR_CFG_UUID
:

280 
pRec
 = 
˛õ¡Ch¨CfgUUID
;

283 
GATT_SERV_CHAR_CFG_UUID
:

284 
pRec
 = 
£rvCh¨CfgUUID
;

287 
GATT_CHAR_FORMAT_UUID
:

288 
pRec
 = 
ch¨F‹m©UUID
;

291 
GATT_CHAR_AGG_FORMAT_UUID
:

292 
pRec
 = 
ch¨AggF‹m©UUID
;

295 
GATT_VALID_RANGE_UUID
:

296 
pRec
 = 
vÆidR™geUUID
;

299 
GATT_EXT_REPORT_REF_UUID
:

300 
pRec
 = 
extRï‹tRefUUID
;

303 
GATT_REPORT_REF_UUID
:

304 
pRec
 = 
ªp‹tRefUUID
;

309 
DEVICE_NAME_UUID
:

310 
pRec
 = 
devi˚NameUUID
;

313 
APPEARANCE_UUID
:

314 
pRec
 = 
≠≥¨™˚UUID
;

317 
RECONNECT_ADDR_UUID
:

318 
pRec
 = 
ªc⁄√˘AddrUUID
;

321 
PERI_PRIVACY_FLAG_UUID
:

322 
pRec
 = 
≥riPrivacyFœgUUID
;

325 
PERI_CONN_PARAM_UUID
:

326 
pRec
 = 
≥riC⁄nP¨amUUID
;

329 
SERVICE_CHANGED_UUID
:

330 
pRec
 = 
£rvi˚Ch™gedUUID
;

339 i‡–
Àn
 =
ATT_UUID_SIZE
 )

344  ( 
pRec
 );

345 
	}
}

	@Components/ble/host/linkdb.h

39 #i‚de‡
LINKDB_H


40 
	#LINKDB_H


	)

42 #ifde‡
__˝lu•lus


60 
	#INVALID_CONNHANDLE
 0xFFFF

61 
	#LOOPBACK_CONNHANDLE
 0xFFFE

62 

	)

64 
	#LINK_NOT_CONNECTED
 0x00

65 
	#LINK_CONNECTED
 0x01

66 
	#LINK_AUTHENTICATED
 0x02

67 
	#LINK_BOUND
 0x04

68 
	#LINK_ENCRYPTED
 0x10

69 

	)

71 
	#LINKDB_STATUS_UPDATE_NEW
 0

72 
	#LINKDB_STATUS_UPDATE_REMOVED
 1

73 
	#LINKDB_STATUS_UPDATE_STATEFLAGS
 2

74 

	)

76 
	#LINKDB_ERR_INSUFFICIENT_AUTHEN
 0x05

77 
	#LINBDB_ERR_INSUFFICIENT_KEYSIZE
 0x0c

78 
	#LINKDB_ERR_INSUFFICIENT_ENCRYPTION
 0x0f

79 

	)

86 
uöt8
 
§k
[
KEYLEN
];

87 
uöt32
 
signCou¡î
;

88 } 
	tlökSec_t
;

92 
uöt8
 
…k
[
KEYLEN
];

93 
uöt16
 
div
;

94 
uöt8
 
ønd
[
B_RANDOM_NUM_SIZE
];

95 
uöt8
 
keySize
;

96 } 
	tícP¨ams_t
;

100 
uöt8
 
èskID
;

101 
uöt16
 
c⁄√˘i⁄H™dÀ
;

102 
uöt8
 
°©eFœgs
;

103 
uöt8
 
addrTy≥
;

104 
uöt8
 
addr
[
B_ADDR_LEN
];

105 
uöt16
 
c⁄nI¡îvÆ
;

106 
lökSec_t
 
£c
;

107 
ícP¨ams_t
 *
pEncP¨ams
;

108 } 
	tlökDBIãm_t
;

111 (*
p‚LökDBCB_t
)–
	tuöt16
 
	tc⁄√˘i⁄H™dÀ
, 
	tuöt8
 
	tch™geTy≥
 );

114 (*
p‚Pîf‹mFuncCB_t
)–
	tlökDBIãm_t
 *
	tpLökIãm
 );

126 
lökDB_Inô
( );

132 
uöt8
 
lökDB_Regi°î
–
p‚LökDBCB_t
 
pFunc
 );

137 
uöt8
 
lökDB_Add
–uöt8 
èskID
, 
uöt16
 
c⁄√˘i⁄H™dÀ
, uöt8 
°©eFœgs
,

138 
uöt8
 
addrTy≥
, uöt8 *
pAddr
, 
uöt16
 
c⁄nI¡îvÆ
 );

143 
uöt8
 
lökDB_Remove
–
uöt16
 
c⁄√˘i⁄H™dÀ
 );

149 
uöt8
 
lökDB_Upd©e
–
uöt16
 
c⁄√˘i⁄H™dÀ
, uöt8 
√wSèã
 );

154 
uöt8
 
lökDB_NumA˘ive
( );

161 
lökDBIãm_t
 *
lökDB_Föd
–
uöt16
 
c⁄√˘i⁄H™dÀ
 );

168 
lökDBIãm_t
 *
lökDB_FödFú°
–
uöt8
 
èskID
 );

175 
uöt8
 
lökDB_Sèã
–
uöt16
 
c⁄√˘i⁄H™dÀ
, uöt8 
°©e
 );

185 
uöt8
 
lökDB_Authí
–
uöt16
 
c⁄√˘i⁄H™dÀ
, uöt8 
keySize
 );

190 
lökDB_Pîf‹mFunc
–
p‚Pîf‹mFuncCB_t
 
cb
 );

198 
	#lökDB_Up
–
c⁄√˘i⁄H™dÀ
 ) 
	`lökDB_Sèã
–(c⁄√˘i⁄H™dÀ), 
LINK_CONNECTED
 )

	)

206 
	#lökDB_En¸y±ed
–
c⁄√˘i⁄H™dÀ
 ) 
	`lökDB_Sèã
–(c⁄√˘i⁄H™dÀ), 
LINK_ENCRYPTED
 )

	)

211 #ifde‡
__˝lu•lus


	@Components/ble/include/att.h

44 #i‚de‡
ATT_H


45 
	#ATT_H


	)

47 #ifde‡
__˝lu•lus


55 
	~"bcomdef.h
"

56 
	~"OSAL.h
"

58 
	~"l2ˇp.h
"

68 
	#ATT_MTU_SIZE
 
L2CAP_MTU_SIZE


69 
	#ATT_MAX_MTU_SIZE
 517

70 

	)

75 
	#ATT_ERROR_RSP
 0x01

76 
	#ATT_EXCHANGE_MTU_REQ
 0x02

77 
	#ATT_EXCHANGE_MTU_RSP
 0x03

78 
	#ATT_FIND_INFO_REQ
 0x04

79 
	#ATT_FIND_INFO_RSP
 0x05

80 
	#ATT_FIND_BY_TYPE_VALUE_REQ
 0x06

81 
	#ATT_FIND_BY_TYPE_VALUE_RSP
 0x07

82 
	#ATT_READ_BY_TYPE_REQ
 0x08

83 
	#ATT_READ_BY_TYPE_RSP
 0x09

84 
	#ATT_READ_REQ
 0x0a

85 
	#ATT_READ_RSP
 0x0b

86 
	#ATT_READ_BLOB_REQ
 0x0c

87 
	#ATT_READ_BLOB_RSP
 0x0d

88 
	#ATT_READ_MULTI_REQ
 0x0e

89 
	#ATT_READ_MULTI_RSP
 0x0f

90 
	#ATT_READ_BY_GRP_TYPE_REQ
 0x10

91 
	#ATT_READ_BY_GRP_TYPE_RSP
 0x11

92 
	#ATT_WRITE_REQ
 0x12

93 
	#ATT_WRITE_RSP
 0x13

94 
	#ATT_PREPARE_WRITE_REQ
 0x16

95 
	#ATT_PREPARE_WRITE_RSP
 0x17

96 
	#ATT_EXECUTE_WRITE_REQ
 0x18

97 
	#ATT_EXECUTE_WRITE_RSP
 0x19

98 
	#ATT_HANDLE_VALUE_NOTI
 0x1b

99 
	#ATT_HANDLE_VALUE_IND
 0x1d

100 
	#ATT_HANDLE_VALUE_CFM
 0x1e

101 

	)

102 
	#ATT_WRITE_CMD
 0x52

103 
	#ATT_SIGNED_WRITE_CMD
 0xD2

104 

	)

109 
	#ATT_METHOD_BITS
 0x3f

	)

112 
	#ATT_CMD_FLAG_BIT
 0x40

	)

115 
	#ATT_AUTHEN_SIG_FLAG_BIT
 0x80

	)

118 
	#ATT_BT_UUID_SIZE
 2

	)

121 
	#ATT_UUID_SIZE
 16

	)

124 
	#ATT_MSG_TIMEOUT
 30

	)

127 
	#ATT_SIG_NOT_INCLUDED
 0x00

128 
	#ATT_SIG_VALID
 0x01

129 
	#ATT_SIG_INVALID
 0x02

130 

	)

139 
	#ATT_ERR_INVALID_HANDLE
 0x01

140 
	#ATT_ERR_READ_NOT_PERMITTED
 0x02

141 
	#ATT_ERR_WRITE_NOT_PERMITTED
 0x03

142 
	#ATT_ERR_INVALID_PDU
 0x04

143 
	#ATT_ERR_INSUFFICIENT_AUTHEN
 0x05

144 
	#ATT_ERR_UNSUPPORTED_REQ
 0x06

145 
	#ATT_ERR_INVALID_OFFSET
 0x07

146 
	#ATT_ERR_INSUFFICIENT_AUTHOR
 0x08

147 
	#ATT_ERR_PREPARE_QUEUE_FULL
 0x09

148 
	#ATT_ERR_ATTR_NOT_FOUND
 0x0a

149 
	#ATT_ERR_ATTR_NOT_LONG
 0x0b

150 
	#ATT_ERR_INSUFFICIENT_KEY_SIZE
 0x0c

151 
	#ATT_ERR_INVALID_VALUE_SIZE
 0x0d

152 
	#ATT_ERR_UNLIKELY
 0x0e

153 
	#ATT_ERR_INSUFFICIENT_ENCRYPT
 0x0f

154 
	#ATT_ERR_UNSUPPORTED_GRP_TYPE
 0x10

155 
	#ATT_ERR_INSUFFICIENT_RESOURCES
 0x11

156 

	)

161 
	#ATT_ERR_INVALID_VALUE
 0x80

162 

	)

169 
	#ATT_HANDLE_BT_UUID_TYPE
 0x01

	)

172 
	#ATT_HANDLE_UUID_TYPE
 0x02

	)

175 
	#ATT_MAX_NUM_HANDLE_BT_UUID
 ( ( 
ATT_MTU_SIZE
 - 2 ) / ( 2 + 
ATT_BT_UUID_SIZE
 ) )

	)

178 
	#ATT_MAX_NUM_HANDLE_UUID
 ( ( 
ATT_MTU_SIZE
 - 2 ) / ( 2 + 
ATT_UUID_SIZE
 ) )

	)

184 
	#ATT_MAX_NUM_HANDLES_INFO
 ( ( 
ATT_MTU_SIZE
 - 1 ) / 4 )

	)

190 
	#ATT_MAX_NUM_HANDLES
 ( ( 
ATT_MTU_SIZE
 - 1 ) / 2 )

	)

193 
	#ATT_MIN_NUM_HANDLES
 2

	)

199 
	#ATT_CANCEL_PREPARED_WRITES
 0x00

	)

202 
	#ATT_WRITE_PREPARED_VALUES
 0x01

	)

204 #i‡
deföed
 ( 
TESTMODES
 )

206 
	#ATT_TESTMODE_OFF
 0

207 
	#ATT_TESTMODE_UNAUTHEN_SIG
 1

209 

	)

214 
	#READ_BY_TYPE_REQ_FIXED_SIZE
 4

	)

217 
	#PREPARE_WRITE_REQ_FIXED_SIZE
 4

	)

222 
CONST
 
uöt8
 
btBa£UUID
[
ATT_UUID_SIZE
];

237 
uöt8
 
	gsig
;

238 
uöt8
 
	gcmd
;

239 
uöt8
 
	gmëhod
;

240 
uöt16
 
	gÀn
;

241 
uöt8
 *
	gpP¨ams
;

242 } 
	t©tPackë_t
;

249 
uöt8
 
	gÀn
;

250 
uöt8
 
	guuid
[
ATT_UUID_SIZE
];

251 } 
	t©tAârTy≥_t
;

258 
uöt8
 
	gÀn
;

259 
uöt8
 
	guuid
[
ATT_BT_UUID_SIZE
];

260 } 
	t©tAârBtTy≥_t
;

267 
uöt8
 
	gªqOpcode
;

268 
uöt16
 
	gh™dÀ
;

269 
uöt8
 
	gîrCode
;

270 } 
	t©tEº‹R•_t
;

277 
uöt16
 
	g˛õ¡RxMTU
;

278 } 
	t©tExch™geMTUReq_t
;

285 
uöt16
 
	g£rvîRxMTU
;

286 } 
	t©tExch™geMTUR•_t
;

293 
uöt16
 
	g°¨tH™dÀ
;

294 
uöt16
 
	gídH™dÀ
;

295 } 
	t©tFödInfoReq_t
;

302 
uöt16
 
	gh™dÀ
;

303 
uöt8
 
	guuid
[
ATT_BT_UUID_SIZE
];

304 } 
	t©tH™dÀBtUUID_t
;

311 
uöt16
 
	gh™dÀ
;

312 
uöt8
 
	guuid
[
ATT_UUID_SIZE
];

313 } 
	t©tH™dÀUUID_t
;

320 
©tH™dÀBtUUID_t
 
	gbtPaú
[
ATT_MAX_NUM_HANDLE_BT_UUID
];

321 
©tH™dÀUUID_t
 
	g∑ú
[
ATT_MAX_NUM_HANDLE_UUID
];

322 } 
	t©tFödInfo_t
;

329 
uöt8
 
	gnumInfo
;

330 
uöt8
 
	gf‹m©
;

331 
©tFödInfo_t
 
	göfo
;

332 } 
	t©tFödInfoR•_t
;

339 
uöt16
 
	g°¨tH™dÀ
;

340 
uöt16
 
	gídH™dÀ
;

341 
©tAârBtTy≥_t
 
	gty≥
;

342 
uöt8
 
	gÀn
;

343 
uöt8
 
	gvÆue
[
ATT_MTU_SIZE
-7];

344 } 
	t©tFödByTy≥VÆueReq_t
;

351 
uöt16
 
	gh™dÀ
;

352 
uöt16
 
	ggΩEndH™dÀ
;

353 } 
	t©tH™dÀsInfo_t
;

360 
uöt8
 
	gnumInfo
;

361 
©tH™dÀsInfo_t
 
	gh™dÀsInfo
[
ATT_MAX_NUM_HANDLES_INFO
];

362 } 
	t©tFödByTy≥VÆueR•_t
;

369 
uöt16
 
	g°¨tH™dÀ
;

370 
uöt16
 
	gídH™dÀ
;

371 
©tAârTy≥_t
 
	gty≥
;

372 } 
	t©tRódByTy≥Req_t
;

379 
uöt8
 
	gnumPaús
;

380 
uöt8
 
	gÀn
;

381 
uöt8
 
	gd©aLi°
[
ATT_MTU_SIZE
-2];

382 } 
	t©tRódByTy≥R•_t
;

389 
uöt16
 
	gh™dÀ
;

390 } 
	t©tRódReq_t
;

397 
uöt8
 
	gÀn
;

398 
uöt8
 
	gvÆue
[
ATT_MTU_SIZE
-1];

399 } 
	t©tRódR•_t
;

406 
uöt16
 
	gh™dÀ
;

407 
uöt16
 
	goff£t
;

408 } 
	t©tRódBlobReq_t
;

415 
uöt8
 
	gÀn
;

416 
uöt8
 
	gvÆue
[
ATT_MTU_SIZE
-1];

417 } 
	t©tRódBlobR•_t
;

424 
uöt16
 
	gh™dÀ
[
ATT_MAX_NUM_HANDLES
];

425 
uöt8
 
	gnumH™dÀs
;

426 } 
	t©tRódMu…iReq_t
;

433 
uöt8
 
	gÀn
;

434 
uöt8
 
	gvÆues
[
ATT_MTU_SIZE
-1];

435 } 
	t©tRódMu…iR•_t
;

442 
uöt16
 
	g°¨tH™dÀ
;

443 
uöt16
 
	gídH™dÀ
;

444 
©tAârTy≥_t
 
	gty≥
;

445 } 
	t©tRódByGΩTy≥Req_t
;

452 
uöt8
 
	gnumGΩs
;

453 
uöt8
 
	gÀn
;

454 
uöt8
 
	gd©aLi°
[
ATT_MTU_SIZE
-2];

455 } 
	t©tRódByGΩTy≥R•_t
;

462 
uöt16
 
	gh™dÀ
;

463 
uöt8
 
	gÀn
;

464 
uöt8
 
	gvÆue
[
ATT_MTU_SIZE
-3];

465 
uöt8
 
	gsig
;

466 
uöt8
 
	gcmd
;

467 } 
	t©tWrôeReq_t
;

474 
uöt16
 
	gh™dÀ
;

475 
uöt16
 
	goff£t
;

476 
uöt8
 
	gÀn
;

477 
uöt8
 
	gvÆue
[
ATT_MTU_SIZE
-5];

478 } 
	t©tPª∑ªWrôeReq_t
;

485 
uöt16
 
	gh™dÀ
;

486 
uöt16
 
	goff£t
;

487 
uöt8
 
	gÀn
;

488 
uöt8
 
	gvÆue
[
ATT_MTU_SIZE
-5];

489 } 
	t©tPª∑ªWrôeR•_t
;

496 
uöt8
 
	gÊags
;

498 } 
	t©tExecuãWrôeReq_t
;

505 
uöt16
 
	gh™dÀ
;

506 
uöt8
 
	gÀn
;

507 
uöt8
 
	gvÆue
[
ATT_MTU_SIZE
-3];

508 } 
	t©tH™dÀVÆueNŸi_t
;

515 
uöt16
 
	gh™dÀ
;

516 
uöt8
 
	gÀn
;

517 
uöt8
 
	gvÆue
[
ATT_MTU_SIZE
-3];

518 } 
	t©tH™dÀVÆueInd_t
;

527 
©tExch™geMTUReq_t
 
	gexch™geMTUReq
;

528 
©tFödInfoReq_t
 
	gfödInfoReq
;

529 
©tFödByTy≥VÆueReq_t
 
	gfödByTy≥VÆueReq
;

530 
©tRódByTy≥Req_t
 
	gªadByTy≥Req
;

531 
©tRódReq_t
 
	gªadReq
;

532 
©tRódBlobReq_t
 
	gªadBlobReq
;

533 
©tRódMu…iReq_t
 
	gªadMu…iReq
;

534 
©tRódByGΩTy≥Req_t
 
	gªadByGΩTy≥Req
;

535 
©tWrôeReq_t
 
	gwrôeReq
;

536 
©tPª∑ªWrôeReq_t
 
	g¥ï¨eWrôeReq
;

537 
©tExecuãWrôeReq_t
 
	gexecuãWrôeReq
;

540 
©tEº‹R•_t
 
	gîr‹R•
;

541 
©tExch™geMTUR•_t
 
	gexch™geMTUR•
;

542 
©tFödInfoR•_t
 
	gfödInfoR•
;

543 
©tFödByTy≥VÆueR•_t
 
	gfödByTy≥VÆueR•
;

544 
©tRódByTy≥R•_t
 
	gªadByTy≥R•
;

545 
©tRódR•_t
 
	gªadR•
;

546 
©tRódBlobR•_t
 
	gªadBlobR•
;

547 
©tRódMu…iR•_t
 
	gªadMu…iR•
;

548 
©tRódByGΩTy≥R•_t
 
	gªadByGΩTy≥R•
;

549 
©tPª∑ªWrôeR•_t
 
	g¥ï¨eWrôeR•
;

552 
©tH™dÀVÆueNŸi_t
 
	gh™dÀVÆueNŸi
;

553 
©tH™dÀVÆueInd_t
 
	gh™dÀVÆueInd
;

554 } 
	t©tMsg_t
;

571 
uöt8
 
ATT_P¨£Packë
–
l2ˇpD©aEvít_t
 *
pL2ˇpMsg
, 
©tPackë_t
 *
pPkt
 );

576 
uöt8
 
ATT_Com∑ªUUID
–c⁄° uöt8 *
pUUID1
, 
uöt16
 
Àn1
,

577 c⁄° 
uöt8
 *
pUUID2
, 
uöt16
 
Àn2
 );

581 
uöt8
 
ATT_C⁄vîtUUIDto128
–c⁄° uöt8 *
pUUID16
, uöt8 *
pUUID128
 );

586 
uöt8
 
ATT_C⁄vîtUUIDto16
–c⁄° uöt8 *
pUUID128
, uöt8 *
pUUID16
 );

596 
uöt16
 
ATT_BuûdEº‹R•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

601 
bSètus_t
 
ATT_P¨£Eº‹R•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

606 
uöt16
 
ATT_BuûdExch™geMTUReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

611 
uöt16
 
ATT_BuûdExch™geMTUR•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

616 
bSètus_t
 
ATT_P¨£Exch™geMTUR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

621 
uöt16
 
ATT_BuûdFödInfoReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

626 
bSètus_t
 
ATT_P¨£FödInfoR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

631 
uöt16
 
ATT_BuûdFödInfoR•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

636 
uöt16
 
ATT_BuûdFödByTy≥VÆueReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

641 
uöt16
 
ATT_BuûdFödByTy≥VÆueR•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

646 
bSètus_t
 
ATT_P¨£FödByTy≥VÆueR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

651 
uöt16
 
ATT_BuûdRódByTy≥Req
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

656 
uöt16
 
ATT_BuûdRódByTy≥R•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

661 
bSètus_t
 
ATT_P¨£RódByTy≥R•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

666 
uöt16
 
ATT_BuûdRódReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

671 
uöt16
 
ATT_BuûdRódR•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

676 
bSètus_t
 
ATT_P¨£RódR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

681 
uöt16
 
ATT_BuûdRódBlobReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

686 
uöt16
 
ATT_BuûdRódBlobR•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

691 
bSètus_t
 
ATT_P¨£RódBlobR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

696 
uöt16
 
ATT_BuûdRódMu…iReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

701 
uöt16
 
ATT_BuûdRódMu…iR•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

706 
bSètus_t
 
ATT_P¨£RódMu…iR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

711 
uöt16
 
ATT_BuûdRódByGΩTy≥R•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

716 
bSètus_t
 
ATT_P¨£RódByGΩTy≥R•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

721 
uöt16
 
ATT_BuûdWrôeReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

726 
bSètus_t
 
ATT_P¨£WrôeR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

731 
uöt16
 
ATT_BuûdPª∑ªWrôeReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

736 
uöt16
 
ATT_BuûdPª∑ªWrôeR•
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

741 
bSètus_t
 
ATT_P¨£Pª∑ªWrôeR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

746 
uöt16
 
ATT_BuûdExecuãWrôeReq
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

751 
bSètus_t
 
ATT_P¨£ExecuãWrôeR•
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

756 
uöt16
 
ATT_BuûdH™dÀVÆueInd
–
uöt8
 *
pBuf
, uöt8 *
pMsg
 );

761 
bSètus_t
 
ATT_P¨£H™dÀVÆueInd
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

771 
bSètus_t
 
ATT_P¨£Exch™geMTUReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

776 
bSètus_t
 
ATT_P¨£FödInfoReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

781 
bSètus_t
 
ATT_P¨£FödByTy≥VÆueReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

786 
bSètus_t
 
ATT_P¨£RódByTy≥Req
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

791 
bSètus_t
 
ATT_P¨£RódReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

796 
bSètus_t
 
ATT_P¨£RódBlobReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

801 
bSètus_t
 
ATT_P¨£RódMu…iReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

806 
bSètus_t
 
ATT_P¨£WrôeReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

811 
bSètus_t
 
ATT_P¨£ExecuãWrôeReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

816 
bSètus_t
 
ATT_P¨£Pª∑ªWrôeReq
–
uöt8
 
sig
, uöt8 
cmd
, uöt8 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

821 
bSètus_t
 
ATT_P¨£H™dÀVÆueCfm
–
uöt8
 *
pP¨ams
, 
uöt16
 
Àn
, 
©tMsg_t
 *
pMsg
 );

846 
bSètus_t
 
ATT_Exch™geMTUReq
–
uöt16
 
c⁄nH™dÀ
, 
©tExch™geMTUReq_t
 *
pReq
 );

860 
bSètus_t
 
ATT_FödInfoReq
–
uöt16
 
c⁄nH™dÀ
, 
©tFödInfoReq_t
 *
pReq
 );

874 
bSètus_t
 
ATT_FödByTy≥VÆueReq
–
uöt16
 
c⁄nH™dÀ
, 
©tFödByTy≥VÆueReq_t
 *
pReq
 );

888 
bSètus_t
 
ATT_RódByTy≥Req
–
uöt16
 
c⁄nH™dÀ
, 
©tRódByTy≥Req_t
 *
pReq
 );

902 
bSètus_t
 
ATT_RódReq
–
uöt16
 
c⁄nH™dÀ
, 
©tRódReq_t
 *
pReq
 );

916 
bSètus_t
 
ATT_RódBlobReq
–
uöt16
 
c⁄nH™dÀ
, 
©tRódBlobReq_t
 *
pReq
 );

930 
bSètus_t
 
ATT_RódMu…iReq
–
uöt16
 
c⁄nH™dÀ
, 
©tRódMu…iReq_t
 *
pReq
 );

944 
bSètus_t
 
ATT_RódByGΩTy≥Req
–
uöt16
 
c⁄nH™dÀ
, 
©tRódByGΩTy≥Req_t
 *
pReq
 );

959 
bSètus_t
 
ATT_WrôeReq
–
uöt16
 
c⁄nH™dÀ
, 
©tWrôeReq_t
 *
pReq
 );

973 
bSètus_t
 
ATT_Pª∑ªWrôeReq
–
uöt16
 
c⁄nH™dÀ
, 
©tPª∑ªWrôeReq_t
 *
pReq
 );

987 
bSètus_t
 
ATT_ExecuãWrôeReq
–
uöt16
 
c⁄nH™dÀ
, 
©tExecuãWrôeReq_t
 *
pReq
 );

1000 
bSètus_t
 
ATT_H™dÀVÆueCfm
–
uöt16
 
c⁄nH™dÀ
 );

1028 
bSètus_t
 
ATT_Eº‹R•
–
uöt16
 
c⁄nH™dÀ
, 
©tEº‹R•_t
 *
pR•
 );

1042 
bSètus_t
 
ATT_Exch™geMTUR•
–
uöt16
 
c⁄nH™dÀ
, 
©tExch™geMTUR•_t
 *
pR•
 );

1056 
bSètus_t
 
ATT_FödInfoR•
–
uöt16
 
c⁄nH™dÀ
, 
©tFödInfoR•_t
 *
pR•
 );

1070 
bSètus_t
 
ATT_FödByTy≥VÆueR•
–
uöt16
 
c⁄nH™dÀ
, 
©tFödByTy≥VÆueR•_t
 *
pR•
 );

1084 
bSètus_t
 
ATT_RódByTy≥R•
–
uöt16
 
c⁄nH™dÀ
, 
©tRódByTy≥R•_t
 *
pR•
 );

1098 
bSètus_t
 
ATT_RódR•
–
uöt16
 
c⁄nH™dÀ
, 
©tRódR•_t
 *
pR•
 );

1112 
bSètus_t
 
ATT_RódBlobR•
–
uöt16
 
c⁄nH™dÀ
, 
©tRódBlobR•_t
 *
pR•
 );

1126 
bSètus_t
 
ATT_RódMu…iR•
–
uöt16
 
c⁄nH™dÀ
, 
©tRódMu…iR•_t
 *
pR•
 ) ;

1140 
bSètus_t
 
ATT_RódByGΩTy≥R•
–
uöt16
 
c⁄nH™dÀ
, 
©tRódByGΩTy≥R•_t
 *
pR•
 );

1153 
bSètus_t
 
ATT_WrôeR•
–
uöt16
 
c⁄nH™dÀ
 );

1167 
bSètus_t
 
ATT_Pª∑ªWrôeR•
–
uöt16
 
c⁄nH™dÀ
, 
©tPª∑ªWrôeR•_t
 *
pR•
 );

1180 
bSètus_t
 
ATT_ExecuãWrôeR•
–
uöt16
 
c⁄nH™dÀ
 );

1194 
bSètus_t
 
ATT_H™dÀVÆueNŸi
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
 );

1208 
bSètus_t
 
ATT_H™dÀVÆueInd
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pInd
 );

1222 
ATT_SëP¨amVÆue
–
uöt16
 
vÆue
 );

1231 
uöt16
 
ATT_GëP¨amVÆue
( );

1237 #ifde‡
__˝lu•lus


	@Components/ble/include/bcomdef.h

43 #i‚de‡
BCOMDEF_H


44 
	#BCOMDEF_H


	)

46 #ifde‡
__˝lu•lus


56 
	~"comdef.h
"

62 #i‡
deföed
 ( 
HOST_CONFIG
 )

64 #i‡–
HOST_CONFIG
 =–
CENTRAL_CFG
 | 
PERIPHERAL_CFG
 ) )

65 
	#CTRL_CONFIG
 ( 
ADV_NCONN_CFG
 | 
ADV_CONN_CFG
 | 
SCAN_CFG
 | 
INIT_CFG
 )

	)

66 #ñi‡–
HOST_CONFIG
 =–
CENTRAL_CFG
 | 
BROADCASTER_CFG
 ) )

67 
	#CTRL_CONFIG
 ( 
ADV_NCONN_CFG
 | 
SCAN_CFG
 | 
INIT_CFG
 )

	)

68 #ñi‡–
HOST_CONFIG
 =–
PERIPHERAL_CFG
 | 
OBSERVER_CFG
 ) )

69 
	#CTRL_CONFIG
 ( 
ADV_NCONN_CFG
 | 
ADV_CONN_CFG
 | 
SCAN_CFG
 )

	)

70 #ñi‡–
HOST_CONFIG
 =–
BROADCASTER_CFG
 | 
OBSERVER_CFG
 ) )

71 
	#CTRL_CONFIG
 ( 
ADV_NCONN_CFG
 | 
SCAN_CFG
 )

	)

72 #ñi‡–
HOST_CONFIG
 =
CENTRAL_CFG
 )

73 
	#CTRL_CONFIG
 ( 
SCAN_CFG
 | 
INIT_CFG
 )

	)

74 #ñi‡–
HOST_CONFIG
 =
PERIPHERAL_CFG
 )

75 
	#CTRL_CONFIG
 ( 
ADV_NCONN_CFG
 | 
ADV_CONN_CFG
 )

	)

76 #ñi‡–
HOST_CONFIG
 =
OBSERVER_CFG
 )

77 
	#CTRL_CONFIG
 
SCAN_CFG


	)

78 #ñi‡–
HOST_CONFIG
 =
BROADCASTER_CFG
 )

79 
	#CTRL_CONFIG
 
ADV_NCONN_CFG


	)

85 #i‡!
deföed
–
CTRL_CONFIG
 ) || !–CTRL_CONFIG & ( 
ADV_NCONN_CFG
 | \

86 
ADV_CONN_CFG
 | \

87 
SCAN_CFG
 | \

88 
INIT_CFG
 ) )

93 #i‡!
deföed
 ( 
MAX_NUM_LL_CONN
 )

94 #i‡–
CTRL_CONFIG
 & 
INIT_CFG
 )

95 
	#MAX_NUM_LL_CONN
 3

	)

96 #ñi‡–!–
CTRL_CONFIG
 & 
INIT_CFG
 ) && ( CTRL_CONFIG & 
ADV_CONN_CFG
 ) )

97 
	#MAX_NUM_LL_CONN
 1

	)

99 
	#MAX_NUM_LL_CONN
 0

	)

107 
	#B_ADDR_LEN
 6

	)

110 
	#KEYLEN
 16

	)

113 
	#B_CHANNEL_MAP_LEN
 5

	)

116 
	#B_EVENT_MASK_LEN
 8

	)

119 
	#B_LOCAL_NAME_LEN
 248

	)

122 
	#B_MAX_ADV_LEN
 31

	)

125 
	#B_RANDOM_NUM_SIZE
 8

	)

128 
	#B_FEATURE_SUPPORT_LENGTH
 8

	)

134 
	#bÀInvÆidTaskID
 
INVALID_TASK


135 
	#bÀNŸRódy
 0x10

136 
	#bÀAÃódyInReque°edMode
 0x11

137 
	#bÀInc‹ª˘Mode
 0x12

138 
	#bÀMemAŒocEº‹
 0x13

139 
	#bÀNŸC⁄√˘ed
 0x14

140 
	#bÀNoResour˚s
 0x15

141 
	#bÀPídög
 0x16

142 
	#bÀTimeout
 0x17

143 
	#bÀInvÆidR™ge
 0x18

144 
	#bÀLökEn¸y±ed
 0x19

145 
	#bÀPro˚duªCom∂ëe
 0x1A

146 

	)

148 
	#bÀGAPU£rC™˚Àd
 0x30

149 
	#bÀGAPC⁄nNŸAc˚±abÀ
 0x31

150 
	#bÀGAPB⁄dReje˘ed
 0x32

151 

	)

153 
	#bÀInvÆidPDU
 0x40

154 
	#bÀInsufficõ¡Authí
 0x41

155 
	#bÀInsufficõ¡En¸y±
 0x42

156 
	#bÀInsufficõ¡KeySize
 0x43

157 

	)

160 
	#INVALID_TASK_ID
 0xFF

161 

	)

167 
	#BLE_NVID_IRK
 0x02

168 
	#BLE_NVID_CSRK
 0x03

169 
	#BLE_NVID_SIGNCOUNTER
 0x04

170 

	)

172 
	#BLE_NVID_GAP_BOND_START
 0x20

173 
	#BLE_NVID_GAP_BOND_END
 0x5f

174 

	)

176 
	#BLE_NVID_GATT_CFG_START
 0x70

177 
	#BLE_NVID_GATT_CFG_END
 0x79

178 

	)

183 
	#GAP_EVENT_SIGN_COUNTER_CHANGED
 0x4000

184 

	)

193 
	#GAP_MSG_EVENT
 0xD0

194 

	)

196 
	#SM_NEW_RAND_KEY_EVENT
 0xC1

197 

	)

199 
	#GATT_MSG_EVENT
 0xB0

200 
	#GATT_SERV_MSG_EVENT
 0xB1

201 

	)

203 
	#L2CAP_DATA_EVENT
 0xA0

204 
	#L2CAP_SIGNAL_EVENT
 0xA2

205 

	)

207 
	#HCI_DATA_EVENT
 0x90

208 
	#HCI_GAP_EVENT_EVENT
 0x91

209 
	#HCI_SMP_EVENT_EVENT
 0x92

210 
	#HCI_EXT_CMD_EVENT
 0x93

211 

	)

218 
Sètus_t
 
	tbSètus_t
;

236 
	#TI_BASE_UUID_128
–
uuid
 ) 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xB0, \

237 0x00, 0x40, 0x51, 0x04, 
	`LO_UINT16
–
uuid
 ), 
	`HI_UINT16
–uuid ), 0x00, 0xF0

	)

250 #ifde‡
__˝lu•lus


	@Components/ble/include/gap.h

70 #i‚de‡
GAP_H


71 
	#GAP_H


	)

73 #ifde‡
__˝lu•lus


81 
	~"bcomdef.h
"

82 
	~"OSAL.h
"

83 
	~"sm.h
"

100 
	#GAP_DEVICE_INIT_DONE_EVENT
 0x00

101 
	#GAP_DEVICE_DISCOVERY_EVENT
 0x01

102 
	#GAP_ADV_DATA_UPDATE_DONE_EVENT
 0x02

103 
	#GAP_MAKE_DISCOVERABLE_DONE_EVENT
 0x03

104 
	#GAP_END_DISCOVERABLE_DONE_EVENT
 0x04

105 
	#GAP_LINK_ESTABLISHED_EVENT
 0x05

106 
	#GAP_LINK_TERMINATED_EVENT
 0x06

107 
	#GAP_LINK_PARAM_UPDATE_EVENT
 0x07

108 
	#GAP_RANDOM_ADDR_CHANGED_EVENT
 0x08

109 
	#GAP_SIGNATURE_UPDATED_EVENT
 0x09

110 
	#GAP_AUTHENTICATION_COMPLETE_EVENT
 0x0A

111 
	#GAP_PASSKEY_NEEDED_EVENT
 0x0B

112 
	#GAP_SLAVE_REQUESTED_SECURITY_EVENT
 0x0C

113 
	#GAP_DEVICE_INFO_EVENT
 0x0D

114 
	#GAP_BOND_COMPLETE_EVENT
 0x0E

115 
	#GAP_PAIRING_REQ_EVENT
 0x0F

116 

	)

122 
	#GAP_CONNHANDLE_INIT
 0xFFFE

123 
	#GAP_CONNHANDLE_ALL
 0xFFFF

124 

	)

130 
	#GAP_PROFILE_BROADCASTER
 0x01

131 
	#GAP_PROFILE_OBSERVER
 0x02

132 
	#GAP_PROFILE_PERIPHERAL
 0x04

133 
	#GAP_PROFILE_CENTRAL
 0x08

134 

	)

142 
	#TGAP_GEN_DISC_ADV_MIN
 0

143 
	#TGAP_LIM_ADV_TIMEOUT
 1

144 
	#TGAP_GEN_DISC_SCAN
 2

145 
	#TGAP_LIM_DISC_SCAN
 3

146 
	#TGAP_CONN_EST_ADV_TIMEOUT
 4

147 
	#TGAP_CONN_PARAM_TIMEOUT
 5

148 

	)

150 
	#TGAP_LIM_DISC_ADV_INT_MIN
 6

151 
	#TGAP_LIM_DISC_ADV_INT_MAX
 7

152 
	#TGAP_GEN_DISC_ADV_INT_MIN
 8

153 
	#TGAP_GEN_DISC_ADV_INT_MAX
 9

154 
	#TGAP_CONN_ADV_INT_MIN
 10

155 
	#TGAP_CONN_ADV_INT_MAX
 11

156 
	#TGAP_CONN_SCAN_INT
 12

157 
	#TGAP_CONN_SCAN_WIND
 13

158 
	#TGAP_CONN_HIGH_SCAN_INT
 14

159 
	#TGAP_CONN_HIGH_SCAN_WIND
 15

160 
	#TGAP_GEN_DISC_SCAN_INT
 16

161 
	#TGAP_GEN_DISC_SCAN_WIND
 17

162 
	#TGAP_LIM_DISC_SCAN_INT
 18

163 
	#TGAP_LIM_DISC_SCAN_WIND
 19

164 
	#TGAP_CONN_EST_ADV
 20

165 
	#TGAP_CONN_EST_INT_MIN
 21

166 
	#TGAP_CONN_EST_INT_MAX
 22

167 
	#TGAP_CONN_EST_SCAN_INT
 23

168 
	#TGAP_CONN_EST_SCAN_WIND
 24

169 
	#TGAP_CONN_EST_SUPERV_TIMEOUT
 25

170 
	#TGAP_CONN_EST_LATENCY
 26

171 
	#TGAP_CONN_EST_MIN_CE_LEN
 27

172 
	#TGAP_CONN_EST_MAX_CE_LEN
 28

173 
	#TGAP_PRIVATE_ADDR_INT
 29

174 
	#TGAP_CONN_PAUSE_CENTRAL
 30

175 
	#TGAP_CONN_PAUSE_PERIPHERAL
 31

176 

	)

178 
	#TGAP_SM_TIMEOUT
 32

179 
	#TGAP_SM_MIN_KEY_LEN
 33

180 
	#TGAP_SM_MAX_KEY_LEN
 34

181 
	#TGAP_FILTER_ADV_REPORTS
 35

182 
	#TGAP_SCAN_RSP_RSSI_MIN
 36

183 

	)

184 #i‡!
deföed
 ( 
TESTMODES
 )

185 
	#TGAP_AUTH_TASK_ID
 37

186 
	#TGAP_PARAMID_MAX
 38

187 #ñ£

	)

188 
	#TGAP_GAP_TESTCODE
 37

189 
	#TGAP_SM_TESTCODE
 38

190 
	#TGAP_AUTH_TASK_ID
 39

191 
	#TGAP_PARAMID_MAX
 40

192 

	)

193 
	#TGAP_GATT_TESTCODE
 100

194 
	#TGAP_ATT_TESTCODE
 101

195 
	#TGAP_GGS_TESTCODE
 102

197 

	)

203 
	#DEVDISC_MODE_NONDISCOVERABLE
 0x00

204 
	#DEVDISC_MODE_GENERAL
 0x01

205 
	#DEVDISC_MODE_LIMITED
 0x02

206 
	#DEVDISC_MODE_ALL
 0x03

207 

	)

212 
	#ADDRTYPE_PUBLIC
 0x00

213 
	#ADDRTYPE_STATIC
 0x01

214 
	#ADDRTYPE_PRIVATE_NONRESOLVE
 0x02

215 
	#ADDRTYPE_PRIVATE_RESOLVE
 0x03

216 

	)

222 
	#GAP_ADTYPE_ADV_IND
 0x00

223 
	#GAP_ADTYPE_ADV_DIRECT_IND
 0x01

224 
	#GAP_ADTYPE_ADV_DISCOVER_IND
 0x02

225 
	#GAP_ADTYPE_ADV_NONCONN_IND
 0x03

226 
	#GAP_ADTYPE_SCAN_RSP_IND
 0x04

227 

	)

232 
	#GAP_FILTER_POLICY_ALL
 0x00

233 
	#GAP_FILTER_POLICY_WHITE_SCAN
 0x01

234 
	#GAP_FILTER_POLICY_WHITE_CON
 0x02

235 
	#GAP_FILTER_POLICY_WHITE
 0x03

236 

	)

239 
	#ADV_CHANMAP_SIZE
 5

	)

242 
	#GAP_PASSCODE_MAX
 999999

	)

247 
	#GAP_INIT_SIGN_COUNTER
 0xFFFFFFFF

	)

252 
	#GAP_ADVCHAN_37
 0x01

253 
	#GAP_ADVCHAN_38
 0x02

254 
	#GAP_ADVCHAN_39
 0x04

255 
	#GAP_ADVCHAN_ALL
 (
GAP_ADVCHAN_37
 | 
GAP_ADVCHAN_38
 | 
GAP_ADVCHAN_39
)

256 

	)

261 
	#WL_NOTUSED
 0x00

262 
	#WL_USED
 0x01

263 

	)

269 
	#GAP_ADTYPE_FLAGS
 0x01

270 
	#GAP_ADTYPE_16BIT_MORE
 0x02

271 
	#GAP_ADTYPE_16BIT_COMPLETE
 0x03

272 
	#GAP_ADTYPE_32BIT_MORE
 0x04

273 
	#GAP_ADTYPE_32BIT_COMPLETE
 0x05

274 
	#GAP_ADTYPE_128BIT_MORE
 0x06

275 
	#GAP_ADTYPE_128BIT_COMPLETE
 0x07

276 
	#GAP_ADTYPE_LOCAL_NAME_SHORT
 0x08

277 
	#GAP_ADTYPE_LOCAL_NAME_COMPLETE
 0x09

278 
	#GAP_ADTYPE_POWER_LEVEL
 0x0A

279 
	#GAP_ADTYPE_OOB_CLASS_OF_DEVICE
 0x0D

280 
	#GAP_ADTYPE_OOB_SIMPLE_PAIRING_HASHC
 0x0E

281 
	#GAP_ADTYPE_OOB_SIMPLE_PAIRING_RANDR
 0x0F

282 
	#GAP_ADTYPE_SM_TK
 0x10

283 
	#GAP_ADTYPE_SM_OOB_FLAG
 0x11

284 
	#GAP_ADTYPE_SLAVE_CONN_INTERVAL_RANGE
 0x12

285 
	#GAP_ADTYPE_SIGNED_DATA
 0x13

286 
	#GAP_ADTYPE_SERVICES_LIST_16BIT
 0x14

287 
	#GAP_ADTYPE_SERVICES_LIST_128BIT
 0x15

288 
	#GAP_ADTYPE_SERVICE_DATA
 0x16

289 
	#GAP_ADTYPE_APPEARANCE
 0x19

290 
	#GAP_ADTYPE_MANUFACTURER_SPECIFIC
 0xFF

291 

	)

296 
	#GAP_ADTYPE_FLAGS_LIMITED
 0x01

297 
	#GAP_ADTYPE_FLAGS_GENERAL
 0x02

298 
	#GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
 0x04

299 

	)

304 
	#GAP_APPEARE_UNKNOWN
 0x0000

305 
	#GAP_APPEARE_GENERIC_PHONE
 0x0040

306 
	#GAP_APPEARE_GENERIC_COMPUTER
 0x0080

307 
	#GAP_APPEARE_GENERIC_WATCH
 0x00C0

308 
	#GAP_APPEARE_WATCH_SPORTS
 0x00C1

309 
	#GAP_APPEARE_GENERIC_CLOCK
 0x0100

310 
	#GAP_APPEARE_GENERIC_DISPLAY
 0x0140

311 
	#GAP_APPEARE_GENERIC_RC
 0x0180

312 
	#GAP_APPEARE_GENERIC_EYE_GALSSES
 0x01C0

313 
	#GAP_APPEARE_GENERIC_TAG
 0x0200

314 
	#GAP_APPEARE_GENERIC_KEYRING
 0x0240

315 
	#GAP_APPEARE_GENERIC_MEDIA_PLAYER
 0x0280

316 
	#GAP_APPEARE_GENERIC_BARCODE_SCANNER
 0x02C0

317 
	#GAP_APPEARE_GENERIC_THERMOMETER
 0x0300

318 
	#GAP_APPEARE_GENERIC_THERMO_EAR
 0x0301

319 
	#GAP_APPEARE_GENERIC_HR_SENSOR
 0x0340

320 
	#GAP_APPEARE_GENERIC_HRS_BELT
 0x0341

321 
	#GAP_APPEARE_GENERIC_BLOOD_PRESSURE
 0x0380

322 
	#GAP_APPEARE_GENERIC_BP_ARM
 0x0381

323 
	#GAP_APPEARE_GENERIC_BP_WRIST
 0x0382

324 
	#GAP_APPEARE_GENERIC_HID
 0x03C0

325 
	#GAP_APPEARE_HID_KEYBOARD
 0x03C1

326 
	#GAP_APPEARE_HID_MOUSE
 0x03C2

327 
	#GAP_APPEARE_HID_JOYSTIC
 0x03C3

328 
	#GAP_APPEARE_HID_GAMEPAD
 0x03C4

329 
	#GAP_APPEARE_HID_DIGITIZER_TYABLET
 0x03C5

330 
	#GAP_APPEARE_HID_DIGITAL_CARDREADER
 0x03C6

331 
	#GAP_APPEARE_HID_DIGITAL_PEN
 0x03C7

332 
	#GAP_APPEARE_HID_BARCODE_SCANNER
 0x03C8

333 

	)

342 
uöt16
 
	tg≠P¨amIDs_t
;

349 
oßl_evít_hdr_t
 
hdr
;

350 
uöt8
 
›code
;

351 } 
	tg≠EvítHdr_t
;

359 
oßl_evít_hdr_t
 
hdr
;

360 
uöt8
 
›code
;

361 
uöt8
 
addrTy≥
;

362 
uöt8
 
√wR™domAddr
[
B_ADDR_LEN
];

363 } 
	tg≠R™domAddrEvít_t
;

373 
uöt16
 
öãrvÆMö
;

375 
uöt16
 
öãrvÆMax
;

377 
uöt16
 
œãncy
;

379 
uöt16
 
timeout
;

380 } 
	tg≠PîiC⁄√˘P¨ams_t
;

389 
oßl_evít_hdr_t
 
hdr
;

390 
uöt8
 
›code
;

391 
uöt8
 
devAddr
[
B_ADDR_LEN
];

392 
uöt16
 
d©aPktLí
;

393 
uöt8
 
numD©aPkts
;

394 } 
	tg≠Devi˚InôD⁄eEvít_t
;

406 
oßl_evít_hdr_t
 
hdr
;

407 
uöt8
 
›code
;

408 
uöt8
 
addrTy≥
;

409 
uöt8
 
devAddr
[
B_ADDR_LEN
];

410 
uöt32
 
signCou¡î
;

411 } 
	tg≠SignUpd©eEvít_t
;

420 
oßl_evít_hdr_t
 
hdr
;

421 
uöt8
 
›code
;

422 
uöt8
 
evítTy≥
;

423 
uöt8
 
addrTy≥
;

424 
uöt8
 
addr
[
B_ADDR_LEN
];

425 
öt8
 
rssi
;

426 
uöt8
 
d©aLí
;

427 
uöt8
 *
pEvtD©a
;

428 } 
	tg≠Devi˚InfoEvít_t
;

439 
uöt8
 
èskID
;

440 
uöt8
 
mode
;

441 
uöt8
 
a˘iveSˇn
;

442 
uöt8
 
whôeLi°
;

443 } 
	tg≠DevDiscReq_t
;

450 
uöt8
 
evítTy≥
;

451 
uöt8
 
addrTy≥
;

452 
uöt8
 
addr
[
B_ADDR_LEN
];

453 } 
	tg≠DevRec_t
;

461 
oßl_evít_hdr_t
 
hdr
;

462 
uöt8
 
›code
;

463 
uöt8
 
numDevs
;

464 
g≠DevRec_t
 *
pDevLi°
;

465 } 
	tg≠DevDiscEvít_t
;

472 
uöt8
 
evítTy≥
;

473 
uöt8
 
öôüt‹AddrTy≥
;

474 
uöt8
 
öôüt‹Addr
[
B_ADDR_LEN
];

475 
uöt8
 
ch™√lM≠
;

476 
uöt8
 
fûãrPﬁicy
;

477 } 
	tg≠AdvîtisögP¨ams_t
;

485 
oßl_evít_hdr_t
 
hdr
;

486 
uöt8
 
›code
;

487 
uöt16
 
öãrvÆ
;

488 } 
	tg≠MakeDiscovîabÀR•Evít_t
;

496 
oßl_evít_hdr_t
 
hdr
;

497 
uöt8
 
›code
;

498 } 
	tg≠EndDiscovîabÀR•Evít_t
;

506 
oßl_evít_hdr_t
 
hdr
;

507 
uöt8
 
›code
;

508 
uöt8
 
adTy≥
;

509 } 
	tg≠AdvD©aUpd©eEvít_t
;

520 
uöt8
 
èskID
;

521 
uöt8
 
highDutyCy˛e
;

522 
uöt8
 
whôeLi°
;

523 
uöt8
 
addrTy≥Pìr
;

524 
uöt8
 
≥îAddr
[
B_ADDR_LEN
];

525 } 
	tg≠E°LökReq_t
;

532 
uöt16
 
c⁄√˘i⁄H™dÀ
;

533 
uöt16
 
öãrvÆMö
;

534 
uöt16
 
öãrvÆMax
;

535 
uöt16
 
c⁄nL©ícy
;

536 
uöt16
 
c⁄nTimeout
;

537 } 
	tg≠Upd©eLökP¨amReq_t
;

548 
oßl_evít_hdr_t
 
hdr
;

549 
uöt8
 
›code
;

550 
uöt8
 
devAddrTy≥
;

551 
uöt8
 
devAddr
[
B_ADDR_LEN
];

552 
uöt16
 
c⁄√˘i⁄H™dÀ
;

553 
uöt16
 
c⁄nI¡îvÆ
;

554 
uöt16
 
c⁄nL©ícy
;

555 
uöt16
 
c⁄nTimeout
;

556 
uöt8
 
˛ockAccuøcy
;

557 } 
	tg≠E°LökReqEvít_t
;

565 
oßl_evít_hdr_t
 
hdr
;

566 
uöt8
 
›code
;

567 
uöt8
 
°©us
;

568 
uöt16
 
c⁄√˘i⁄H™dÀ
;

569 
uöt16
 
c⁄nI¡îvÆ
;

570 
uöt16
 
c⁄nL©ícy
;

571 
uöt16
 
c⁄nTimeout
;

572 } 
	tg≠LökUpd©eEvít_t
;

580 
oßl_evít_hdr_t
 
hdr
;

581 
uöt8
 
›code
;

582 
uöt16
 
c⁄√˘i⁄H™dÀ
;

583 
uöt8
 
ªas⁄
;

584 } 
	tg≠Tîmö©eLökEvít_t
;

596 
oßl_evít_hdr_t
 
hdr
;

597 
uöt8
 
›code
;

598 
uöt8
 
devi˚Addr
[
B_ADDR_LEN
];

599 
uöt16
 
c⁄√˘i⁄H™dÀ
;

600 
uöt8
 
uiI≈uts
;

601 
uöt8
 
uiOuçuts
;

602 } 
	tg≠PasskeyNìdedEvít_t
;

610 
oßl_evít_hdr_t
 
hdr
;

611 
uöt8
 
›code
;

612 
uöt16
 
c⁄√˘i⁄H™dÀ
;

613 
uöt8
 
authSèã
;

614 
smSecurôyInfo_t
 *
pSecurôyInfo
;

615 
smIdítôyInfo_t
 *
pIdítôyInfo
;

616 
smSignögInfo_t
 *
pSignögInfo
;

617 
smSecurôyInfo_t
 *
pDevSecInfo
;

618 } 
	tg≠AuthCom∂ëeEvít_t
;

626 
uöt16
 
c⁄√˘i⁄H™dÀ
;

627 
smLökSecurôyReq_t
 
£cReqs
;

628 } 
	tg≠AuthP¨ams_t
;

636 
oßl_evít_hdr_t
 
hdr
;

637 
uöt8
 
›code
;

638 
uöt16
 
c⁄√˘i⁄H™dÀ
;

639 
uöt8
 
devi˚Addr
[
B_ADDR_LEN
];

640 
uöt8
 
authReq
;

642 } 
	tg≠SœveSecurôyReqEvít_t
;

650 
oßl_evít_hdr_t
 
hdr
;

651 
uöt8
 
›code
;

652 
uöt16
 
c⁄√˘i⁄H™dÀ
;

653 } 
	tg≠B⁄dCom∂ëeEvít_t
;

660 
uöt8
 
ioC≠
;

661 
uöt8
 
oobD©aFœg
;

662 
uöt8
 
authReq
;

663 
uöt8
 
maxEncKeySize
;

664 
keyDi°_t
 
keyDi°
;

665 } 
	tg≠PaúögReq_t
;

680 
oßl_evít_hdr_t
 
hdr
;

681 
uöt8
 
›code
;

682 
uöt16
 
c⁄√˘i⁄H™dÀ
;

683 
g≠PaúögReq_t
 
∑úReq
;

684 } 
	tg≠PaúögReqEvít_t
;

693 
uöt8
 
adTy≥
;

694 
uöt8
 
©åLí
;

695 
uöt8
 *
pAârD©a
;

696 } 
	tg≠AdvD©aTokí_t
;

737 
bSètus_t
 
GAP_Devi˚Inô
–
uöt8
 
èskID
,

738 
uöt8
 
¥ofûeRﬁe
,

739 
uöt8
 
maxSˇnRe•⁄£s
,

740 
uöt8
 *
pIRK
,

741 
uöt8
 *
pSRK
,

742 
uöt32
 *
pSignCou¡î
 );

760 
bSètus_t
 
GAP_SëAdvTokí
–
g≠AdvD©aTokí_t
 *
pTokí
 );

769 
g≠AdvD©aTokí_t
 *
GAP_GëAdvTokí
–
uöt8
 
adTy≥
 );

779 
g≠AdvD©aTokí_t
 *
GAP_RemoveAdvTokí
–
uöt8
 
adTy≥
 );

787 
bSètus_t
 
GAP_Upd©eAdvTokís
( );

798 
bSètus_t
 
GAP_SëP¨amVÆue
–
g≠P¨amIDs_t
 
∑ømID
, 
uöt16
 
∑ømVÆue
 );

807 
uöt16
 
GAP_GëP¨amVÆue
–
g≠P¨amIDs_t
 
∑ømID
 );

828 
bSètus_t
 
GAP_C⁄figDevi˚Addr
–
uöt8
 
addrTy≥
, uöt8 *
pSèticAddr
 );

838 
GAP_Regi°îF‹HCIMsgs
–
uöt8
 
èskID
 );

853 
bSètus_t
 
GAP_Devi˚DiscovîyReque°
–
g≠DevDiscReq_t
 *
pP¨ams
 );

864 
bSètus_t
 
GAP_Devi˚DiscovîyC™˚l
–
uöt8
 
èskID
 );

877 
bSètus_t
 
GAP_MakeDiscovîabÀ
–
uöt8
 
èskID
, 
g≠AdvîtisögP¨ams_t
 *
pP¨ams
 );

894 
bSètus_t
 
GAP_Upd©eAdvîtisögD©a
–
uöt8
 
èskID
, uöt8 
adTy≥
,

895 
uöt8
 
d©aLí
, uöt8 *
pAdvîtD©a
 );

906 
bSètus_t
 
GAP_EndDiscovîabÀ
–
uöt8
 
èskID
 );

918 
bSètus_t
 
GAP_ResﬁvePriv©eAddr
–
uöt8
 *
pIRK
, uöt8 *
pAddr
 );

935 
bSètus_t
 
GAP_E°ablishLökReq
–
g≠E°LökReq_t
 *
pP¨ams
 );

948 
bSètus_t
 
GAP_Tîmö©eLökReq
–
uöt8
 
èskID
, 
uöt16
 
c⁄√˘i⁄H™dÀ
 );

960 
bSètus_t
 
GAP_Upd©eLökP¨amReq
–
g≠Upd©eLökP¨amReq_t
 *
pP¨ams
 );

967 
uöt8
 
GAP_NumA˘iveC⁄√˘i⁄s
( );

991 
bSètus_t
 
GAP_Authítiˇã
–
g≠AuthP¨ams_t
 *
pP¨ams
, 
g≠PaúögReq_t
 *
pPaúReq
 );

1005 
bSètus_t
 
GAP_Tîmö©eAuth
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
ªas⁄
 );

1023 
bSètus_t
 
GAP_PasskeyUpd©e
–
uöt8
 *
pPasskey
, 
uöt16
 
c⁄√˘i⁄H™dÀ
 );

1040 
bSètus_t
 
GAP_PasscodeUpd©e
–
uöt32
 
∑sscode
, 
uöt16
 
c⁄√˘i⁄H™dÀ
 );

1052 
bSètus_t
 
GAP_SídSœveSecurôyReque°
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
authReq
 );

1069 
bSètus_t
 
GAP_Sig«bÀ
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
authítiˇãd
, 
smSignögInfo_t
 *
pP¨ams
 );

1087 
bSètus_t
 
GAP_B⁄d
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
authítiˇãd
,

1088 
smSecurôyInfo_t
 *
pP¨ams
, 
uöt8
 
°¨tEn¸y±i⁄
 );

1108 
bSètus_t
 
GAP_P¨amsInô
–
uöt8
 
èskID
, uöt8 
¥ofûeRﬁe
 );

1126 
GAP_SecP¨amsInô
–
uöt8
 *
pIRK
, uöt8 *
pSRK
, 
uöt32
 *
pSignCou¡î
 );

1137 
bSètus_t
 
GAP_PîiDevMgrInô
( );

1149 
bSètus_t
 
GAP_CítDevMgrInô
–
uöt8
 
maxSˇnRe•⁄£s
 );

1160 
GAP_CítC⁄nRegi°î
( );

1176 
GAP_Inô
–
uöt8
 
èsk_id
 );

1188 
uöt16
 
GAP_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

1194 #ifde‡
__˝lu•lus


	@Components/ble/include/gatt.h

46 #i‚de‡
GATT_H


47 
	#GATT_H


	)

49 #ifde‡
__˝lu•lus


57 
	~"bcomdef.h
"

58 
	~"OSAL.h
"

60 
	~"©t.h
"

70 
	#GATT_PERMIT_READ
 0x01

71 
	#GATT_PERMIT_WRITE
 0x02

72 
	#GATT_PERMIT_AUTHEN_READ
 0x04

73 
	#GATT_PERMIT_AUTHEN_WRITE
 0x08

74 
	#GATT_PERMIT_AUTHOR_READ
 0x10

75 
	#GATT_PERMIT_AUTHOR_WRITE
 0x20

76 

	)

84 #i‡!
deföed
–
GATT_MAX_NUM_PREPARE_WRITES
 )

85 
	#GATT_MAX_NUM_PREPARE_WRITES
 5

87 

	)

95 
	#GATT_ENCRYPT_KEY_SIZE
 16

96 

	)

104 
	#GATT_MAX_ATTR_SIZE
 512

105 

	)

109 
	#GATT_MAX_NUM_CONN
 ( 
MAX_NUM_LL_CONN
 + 1 )

	)

112 
	#GATT_BASE_METHOD
 0x40

	)

115 
	#GATT_INVALID_HANDLE
 0x0000

116 
	#GATT_MIN_HANDLE
 0x0001

117 
	#GATT_MAX_HANDLE
 0xFFFF

118 

	)

128 
	#g©tPîmôRód
–
a
 ) ( (aË& 
GATT_PERMIT_READ
 )

	)

129 
	#g©tPîmôWrôe
–
a
 ) ( (aË& 
GATT_PERMIT_WRITE
 )

	)

130 
	#g©tPîmôAuthíRód
–
a
 ) ( (aË& 
GATT_PERMIT_AUTHEN_READ
 )

	)

131 
	#g©tPîmôAuthíWrôe
–
a
 ) ( (aË& 
GATT_PERMIT_AUTHEN_WRITE
 )

	)

132 
	#g©tPîmôAuth‹Ród
–
a
 ) ( (aË& 
GATT_PERMIT_AUTHOR_READ
 )

	)

133 
	#g©tPîmôAuth‹Wrôe
–
a
 ) ( (aË& 
GATT_PERMIT_AUTHOR_WRITE
 )

	)

136 
	#g©tPrim¨ySîvi˚Ty≥
–
t
 ) ( 
	`ATT_Com∑ªUUID
–
¥im¨ySîvi˚UUID
, 
ATT_BT_UUID_SIZE
, \

137 (
t
).
uuid
, (t).
Àn
 ) )

	)

138 
	#g©tSec⁄d¨ySîvi˚Ty≥
–
t
 ) ( 
	`ATT_Com∑ªUUID
–
£c⁄d¨ySîvi˚UUID
, 
ATT_BT_UUID_SIZE
, \

139 (
t
).
uuid
, (t).
Àn
 ) )

	)

140 
	#g©tCh¨a˘îTy≥
–
t
 ) ( 
	`ATT_Com∑ªUUID
–
ch¨a˘îUUID
, 
ATT_BT_UUID_SIZE
, \

141 (
t
).
uuid
, (t).
Àn
 ) )

	)

142 
	#g©tIn˛udeTy≥
–
t
 ) ( 
	`ATT_Com∑ªUUID
–
ö˛udeUUID
, 
ATT_BT_UUID_SIZE
, \

143 (
t
).
uuid
, (t).
Àn
 ) )

	)

144 
	#g©tSîvi˚Ty≥
–
t
 ) ( 
	`g©tPrim¨ySîvi˚Ty≥
( (t) ) || \

145 
	`g©tSec⁄d¨ySîvi˚Ty≥
–(
t
ËË)

	)

156 
uöt8
 
discCh¨sByUUID
;

157 
©tRódByTy≥Req_t
 
ªq
;

158 } 
	tg©tRódByTy≥Req_t
;

165 
uöt16
 
h™dÀ
;

166 
uöt16
 
off£t
;

167 
uöt8
 
Àn
;

168 
uöt8
 *
pVÆue
;

169 } 
	tg©tPª∑ªWrôeReq_t
;

176 
uöt8
 
ªlübÀ
;

177 
g©tPª∑ªWrôeReq_t
 
ªq
;

178 
uöt16
 
œ°Off£t
;

179 } 
	tg©tWrôeL⁄gReq_t
;

186 
uöt8
 
ªlübÀ
;

187 
©tPª∑ªWrôeReq_t
 *
pReqs
;

188 
uöt8
 
numReqs
;

189 
uöt8
 
ödex
;

190 
uöt8
 
Êags
;

192 } 
	tg©tRñübÀWrôesReq_t
;

201 
©tExch™geMTUReq_t
 
exch™geMTUReq
;

202 
©tFödInfoReq_t
 
födInfoReq
;

203 
©tFödByTy≥VÆueReq_t
 
födByTy≥VÆueReq
;

204 
©tRódByTy≥Req_t
 
ªadByTy≥Req
;

205 
©tRódReq_t
 
ªadReq
;

206 
©tRódBlobReq_t
 
ªadBlobReq
;

207 
©tRódMu…iReq_t
 
ªadMu…iReq
;

208 
©tRódByGΩTy≥Req_t
 
ªadByGΩTy≥Req
;

209 
©tWrôeReq_t
 
wrôeReq
;

210 
©tPª∑ªWrôeReq_t
 
¥ï¨eWrôeReq
;

211 
©tExecuãWrôeReq_t
 
execuãWrôeReq
;

212 
g©tRódByTy≥Req_t
 
g©tRódByTy≥Req
;

213 
g©tWrôeL⁄gReq_t
 
g©tWrôeL⁄gReq
;

214 
g©tRñübÀWrôesReq_t
 
g©tRñübÀWrôesReq
;

217 
©tEº‹R•_t
 
îr‹R•
;

218 
©tExch™geMTUR•_t
 
exch™geMTUR•
;

219 
©tFödInfoR•_t
 
födInfoR•
;

220 
©tFödByTy≥VÆueR•_t
 
födByTy≥VÆueR•
;

221 
©tRódByTy≥R•_t
 
ªadByTy≥R•
;

222 
©tRódR•_t
 
ªadR•
;

223 
©tRódBlobR•_t
 
ªadBlobR•
;

224 
©tRódMu…iR•_t
 
ªadMu…iR•
;

225 
©tRódByGΩTy≥R•_t
 
ªadByGΩTy≥R•
;

226 
©tPª∑ªWrôeR•_t
 
¥ï¨eWrôeR•
;

229 
©tH™dÀVÆueNŸi_t
 
h™dÀVÆueNŸi
;

230 
©tH™dÀVÆueInd_t
 
h™dÀVÆueInd
;

231 } 
	tg©tMsg_t
;

239 
oßl_evít_hdr_t
 
hdr
;

240 
uöt16
 
c⁄nH™dÀ
;

241 
uöt8
 
mëhod
;

242 
g©tMsg_t
 
msg
;

243 } 
	tg©tMsgEvít_t
;

250 
uöt8
 
Àn
;

251 c⁄° 
uöt8
 *
uuid
;

252 } 
	tg©tAârTy≥_t
;

257 
	s©tAâribuã_t


259 
g©tAârTy≥_t
 
ty≥
;

260 
uöt8
 
≥rmissi⁄s
;

261 
uöt16
 
h™dÀ
;

262 
uöt8
* c⁄° 
pVÆue
;

265 } 
	tg©tAâribuã_t
;

272 
uöt16
 
numAârs
;

278 
g©tAâribuã_t
 *
©ås
;

279 } 
	tg©tSîvi˚_t
;

304 
bSètus_t
 
GATT_InôClõ¡
( );

314 
GATT_Regi°îF‹Ind
–
uöt8
 
èskId
 );

334 
bSètus_t
 
GATT_Pª∑ªWrôeReq
–
uöt16
 
c⁄nH™dÀ
, 
©tPª∑ªWrôeReq_t
 *
pReq
, 
uöt8
 
èskId
 );

355 
bSètus_t
 
GATT_ExecuãWrôeReq
–
uöt16
 
c⁄nH™dÀ
, 
©tExecuãWrôeReq_t
 *
pReq
, 
uöt8
 
èskId
 );

376 
bSètus_t
 
GATT_InôSîvî
( );

403 
bSètus_t
 
GATT_Regi°îSîvi˚
–
g©tSîvi˚_t
 *
pSîvi˚
 );

417 
bSètus_t
 
GATT_Dîegi°îSîvi˚
–
uöt16
 
h™dÀ
, 
g©tSîvi˚_t
 *
pSîvi˚
 );

426 
GATT_Regi°îF‹Req
–
uöt8
 
èskId
 );

440 
bSètus_t
 
GATT_VîifyRódPîmissi⁄s
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
≥rmissi⁄s
 );

455 
bSètus_t
 
GATT_VîifyWrôePîmissi⁄s
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
≥rmissi⁄s
, 
©tWrôeReq_t
 *
pReq
 );

470 
uöt8
 
GATT_Sîvi˚Ch™gedInd
–
uöt16
 
c⁄nH™dÀ
, uöt8 
èskId
 );

483 
g©tAâribuã_t
 *
GATT_FödH™dÀUUID
–
uöt16
 
°¨tH™dÀ
, uöt16 
ídH™dÀ
, c⁄° 
uöt8
 *
pUUID
,

484 
uöt16
 
Àn
, uöt16 *
pH™dÀ
 );

493 
g©tAâribuã_t
 *
GATT_FödH™dÀ
–
uöt16
 
h™dÀ
, uöt16 *
pH™dÀ
 );

505 
g©tAâribuã_t
 *
GATT_FödNextAâr
–g©tAâribuã_à*
pAâr
, 
uöt16
 
ídH™dÀ
,

506 
uöt16
 
£rvi˚
, uöt16 *
pLa°H™dÀ
 );

514 
uöt16
 
GATT_Sîvi˚NumAârs
–uöt16 
h™dÀ
 );

559 
bSètus_t
 
GATT_Indiˇti⁄
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pInd
,

560 
uöt8
 
authítiˇãd
, uöt8 
èskId
 );

586 
bSètus_t
 
GATT_NŸifiˇti⁄
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
,

587 
uöt8
 
authítiˇãd
 );

632 
bSètus_t
 
GATT_Exch™geMTU
–
uöt16
 
c⁄nH™dÀ
, 
©tExch™geMTUReq_t
 *
pReq
, 
uöt8
 
èskId
 );

664 
bSètus_t
 
GATT_DiscAŒPrim¨ySîvi˚s
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
èskId
 );

701 
bSètus_t
 
GATT_DiscPrim¨ySîvi˚ByUUID
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 *
pVÆue
,

702 
uöt8
 
Àn
, uöt8 
èskId
 );

737 
bSètus_t
 
GATT_FödIn˛udedSîvi˚s
–
uöt16
 
c⁄nH™dÀ
, uöt16 
°¨tH™dÀ
,

738 
uöt16
 
ídH™dÀ
, 
uöt8
 
èskId
 );

773 
bSètus_t
 
GATT_DiscAŒCh¨s
–
uöt16
 
c⁄nH™dÀ
, uöt16 
°¨tH™dÀ
,

774 
uöt16
 
ídH™dÀ
, 
uöt8
 
èskId
 );

809 
bSètus_t
 
GATT_DiscCh¨sByUUID
–
uöt16
 
c⁄nH™dÀ
, 
©tRódByTy≥Req_t
 *
pReq
, 
uöt8
 
èskId
 );

845 
bSètus_t
 
GATT_DiscAŒCh¨Descs
–
uöt16
 
c⁄nH™dÀ
, uöt16 
°¨tH™dÀ
,

846 
uöt16
 
ídH™dÀ
, 
uöt8
 
èskId
 );

882 
bSètus_t
 
GATT_RódCh¨VÆue
–
uöt16
 
c⁄nH™dÀ
, 
©tRódReq_t
 *
pReq
, 
uöt8
 
èskId
 );

917 
bSètus_t
 
GATT_RódUsögCh¨UUID
–
uöt16
 
c⁄nH™dÀ
, 
©tRódByTy≥Req_t
 *
pReq
, 
uöt8
 
èskId
 );

947 
bSètus_t
 
GATT_RódL⁄gCh¨VÆue
–
uöt16
 
c⁄nH™dÀ
, 
©tRódBlobReq_t
 *
pReq
, 
uöt8
 
èskId
 );

980 
bSètus_t
 
GATT_RódMu…iCh¨VÆues
–
uöt16
 
c⁄nH™dÀ
, 
©tRódMu…iReq_t
 *
pReq
, 
uöt8
 
èskId
 );

1013 
bSètus_t
 
GATT_WrôeNoR•
–
uöt16
 
c⁄nH™dÀ
, 
©tWrôeReq_t
 *
pReq
 );

1051 
bSètus_t
 
GATT_Sig√dWrôeNoR•
–
uöt16
 
c⁄nH™dÀ
, 
©tWrôeReq_t
 *
pReq
 );

1087 
bSètus_t
 
GATT_WrôeCh¨VÆue
–
uöt16
 
c⁄nH™dÀ
, 
©tWrôeReq_t
 *
pReq
, 
uöt8
 
èskId
 );

1124 
bSètus_t
 
GATT_WrôeL⁄gCh¨VÆue
–
uöt16
 
c⁄nH™dÀ
, 
g©tPª∑ªWrôeReq_t
 *
pReq
, 
uöt8
 
èskId
 );

1172 
bSètus_t
 
GATT_RñübÀWrôes
–
uöt16
 
c⁄nH™dÀ
, 
©tPª∑ªWrôeReq_t
 *
pReqs
,

1173 
uöt8
 
numReqs
, uöt8 
Êags
, uöt8 
èskId
 );

1205 
bSètus_t
 
GATT_RódCh¨Desc
–
uöt16
 
c⁄nH™dÀ
, 
©tRódReq_t
 *
pReq
, 
uöt8
 
èskId
 );

1240 
bSètus_t
 
GATT_RódL⁄gCh¨Desc
–
uöt16
 
c⁄nH™dÀ
, 
©tRódBlobReq_t
 *
pReq
, 
uöt8
 
èskId
 );

1273 
bSètus_t
 
GATT_WrôeCh¨Desc
–
uöt16
 
c⁄nH™dÀ
, 
©tWrôeReq_t
 *
pReq
, 
uöt8
 
èskId
 );

1310 
bSètus_t
 
GATT_WrôeL⁄gCh¨Desc
–
uöt16
 
c⁄nH™dÀ
, 
g©tPª∑ªWrôeReq_t
 *
pReq
, 
uöt8
 
èskId
 );

1329 
GATT_SëNextH™dÀ
–
uöt16
 
h™dÀ
 );

1344 
GATT_Inô
–
uöt8
 
èskId
 );

1356 
uöt16
 
GATT_Pro˚ssEvít
–
uöt8
 
èskId
, uöt16 
evíts
 );

1361 #ifde‡
__˝lu•lus


	@Components/ble/include/gatt_uuid.h

41 #i‚de‡
GATT_UUID_H


42 
	#GATT_UUID_H


	)

44 #ifde‡
__˝lu•lus


66 
	#GAP_SERVICE_UUID
 0x1800

67 
	#GATT_SERVICE_UUID
 0x1801

68 

	)

72 
	#GATT_PRIMARY_SERVICE_UUID
 0x2800

73 
	#GATT_SECONDARY_SERVICE_UUID
 0x2801

74 
	#GATT_INCLUDE_UUID
 0x2802

75 
	#GATT_CHARACTER_UUID
 0x2803

76 

	)

80 
	#GATT_CHAR_EXT_PROPS_UUID
 0x2900

81 
	#GATT_CHAR_USER_DESC_UUID
 0x2901

82 
	#GATT_CLIENT_CHAR_CFG_UUID
 0x2902

83 
	#GATT_SERV_CHAR_CFG_UUID
 0x2903

84 
	#GATT_CHAR_FORMAT_UUID
 0x2904

85 
	#GATT_CHAR_AGG_FORMAT_UUID
 0x2905

86 
	#GATT_VALID_RANGE_UUID
 0x2906

87 
	#GATT_EXT_REPORT_REF_UUID
 0x2907

88 
	#GATT_REPORT_REF_UUID
 0x2908

89 

	)

93 
	#DEVICE_NAME_UUID
 0x2A00

94 
	#APPEARANCE_UUID
 0x2A01

95 
	#PERI_PRIVACY_FLAG_UUID
 0x2A02

96 
	#RECONNECT_ADDR_UUID
 0x2A03

97 
	#PERI_CONN_PARAM_UUID
 0x2A04

98 
	#SERVICE_CHANGED_UUID
 0x2A05

99 

	)

103 
	#GATT_UNITLESS_UUID
 0x2700

104 
	#GATT_UNIT_LENGTH_METER_UUID
 0x2701

105 
	#GATT_UNIT_MASS_KGRAM_UUID
 0x2702

106 
	#GATT_UNIT_TIME_SECOND_UUID
 0x2703

107 
	#GATT_UNIT_ELECTRIC_CURRENT_A_UUID
 0x2704

108 
	#GATT_UNIT_THERMODYNAMIC_TEMP_K_UUID
 0x2705

109 
	#GATT_UNIT_AMOUNT_SUBSTANCE_M_UUID
 0x2706

110 
	#GATT_UNIT_LUMINOUS_INTENSITY_C_UUID
 0x2707

111 

	)

112 
	#GATT_UNIT_AREA_SQ_MTR_UUID
 0x2710

113 
	#GATT_UNIT_VOLUME_CUBIC_MTR_UUID
 0x2711

114 
	#GATT_UNIT_VELOCITY_MPS_UUID
 0x2712

115 
	#GATT_UNIT_ACCELERATION_MPS_SQ_UUID
 0x2713

116 
	#GATT_UNIT_WAVENUMBER_RM_UUID
 0x2714

117 
	#GATT_UNIT_DENSITY_KGPCM_UUID
 0x2715

118 
	#GATT_UNIT_SURFACE_DENSITY_KGPSM_UUID
 0x2716

119 
	#GATT_UNIT_SPECIFIC_VOLUME_CMPKG_UUID
 0x2717

120 
	#GATT_UNIT_CURRENT_DENSITY_APSM_UUID
 0x2718

121 
	#GATT_UNIT_MAGNETIC_FIELD_STRENGTH_UUID
 0x2719

122 
	#GATT_UNIT_AMOUNT_CONCENTRATE_MPCM_UUID
 0x271A

123 
	#GATT_UNIT_MASS_CONCENTRATE_KGPCM_UUID
 0x271B

124 
	#GATT_UNIT_LUMINANCE_CPSM_UUID
 0x271C

125 
	#GATT_UNIT_REFRACTIVE_INDEX_UUID
 0x271D

126 
	#GATT_UNIT_RELATIVE_PERMEABLILTY_UUID
 0x271E

127 
	#GATT_UNIT_PLANE_ANGLE_RAD_UUID
 0x2720

128 
	#GATT_UNIT_SOLID_ANGLE_STERAD_UUID
 0x2721

129 
	#GATT_UNIT_FREQUENCY_HTZ_UUID
 0x2722

130 
	#GATT_UNIT_FORCE_NEWTON_UUID
 0x2723

131 
	#GATT_UNIT_PRESSURE_PASCAL_UUID
 0x2724

132 
	#GATT_UNIT_ENERGY_JOULE_UUID
 0x2725

133 
	#GATT_UNIT_POWER_WATT_UUID
 0x2726

134 
	#GATT_UNIT_ELECTRIC_CHARGE_C_UUID
 0x2727

135 
	#GATT_UNIT_ELECTRIC_POTENTIAL_DIF_V_UUID
 0x2728

136 

	)

137 
	#GATT_UNIT_CELSIUS_TEMP_DC_UUID
 0x272F

138 

	)

139 
	#GATT_UNIT_TIME_MINUTE_UUID
 0x2760

140 
	#GATT_UNIT_TIME_HOUR_UUID
 0x2761

141 
	#GATT_UNIT_TIME_DAY_UUID
 0x2762

142 
	#GATT_UNIT_PLANE_ANGLE_DEGREE_UUID
 0x2763

143 
	#GATT_UNIT_PLANE_ANGLE_MINUTE_UUID
 0x2764

144 
	#GATT_UNIT_PLANE_ANGLE_SECOND_UUID
 0x2765

145 
	#GATT_UNIT_AREA_HECTARE_UUID
 0x2766

146 
	#GATT_UNIT_VOLUME_LITRE_UUID
 0x2767

147 
	#GATT_UNIT_MASS_TONNE_UUID
 0x2768

148 

	)

149 
	#GATT_UINT_LENGTH_YARD_UUID
 0x27A0

150 
	#GATT_UNIT_LENGTH_PARSEC_UUID
 0x27A1

151 
	#GATT_UNIT_LENGTH_INCH_UUID
 0x27A2

152 
	#GATT_UNIT_LENGTH_FOOT_UUID
 0x27A3

153 
	#GATT_UNIT_LENGTH_MILE_UUID
 0x27A4

154 
	#GATT_UNIT_PRESSURE_PFPSI_UUID
 0x27A5

155 
	#GATT_UNIT_VELOCITY_KMPH_UUID
 0x27A6

156 
	#GATT_UNIT_VELOCITY_MPH_UUID
 0x27A7

157 
	#GATT_UNIT_ANGULAR_VELOCITY_RPM_UUID
 0x27A8

158 
	#GATT_UNIT_ENERGY_GCAL_UUID
 0x27A9

159 
	#GATT_UNIT_ENERGY_KCAL_UUID
 0x27AA

160 
	#GATT_UNIT_ENERGY_KWH_UUID
 0x27AB

161 
	#GATT_UNIT_THERMODYNAMIC_TEMP_DF_UUID
 0x27AC

162 
	#GATT_UNIT_PERCENTAGE_UUID
 0x27AD

163 
	#GATT_UNIT_PER_MILE_UUID
 0x27AE

164 
	#GATT_UNIT_PERIOD_BPM_UUID
 0x27AF

165 
	#GATT_UNIT_ELECTRIC_CHARGE_AH_UUID
 0x27B0

166 
	#GATT_UNIT_MASS_DENSITY_MGPD_UUID
 0x27B1

167 
	#GATT_UNIT_MASS_DENSITY_MMPL_UUID
 0x27B2

168 
	#GATT_UNIT_TIME_YEAR_UUID
 0x27B3

169 
	#GATT_UNIT_TIME_MONTH_UUID
 0x27B4

170 

	)

186 
CONST
 
uöt8
 
g≠Sîvi˚UUID
[];

187 
CONST
 
uöt8
 
g©tSîvi˚UUID
[];

192 
CONST
 
uöt8
 
¥im¨ySîvi˚UUID
[];

193 
CONST
 
uöt8
 
£c⁄d¨ySîvi˚UUID
[];

194 
CONST
 
uöt8
 
ö˛udeUUID
[];

195 
CONST
 
uöt8
 
ch¨a˘îUUID
[];

200 
CONST
 
uöt8
 
ch¨ExtPr›sUUID
[];

201 
CONST
 
uöt8
 
ch¨U£rDescUUID
[];

202 
CONST
 
uöt8
 
˛õ¡Ch¨CfgUUID
[];

203 
CONST
 
uöt8
 
£rvCh¨CfgUUID
[];

204 
CONST
 
uöt8
 
ch¨F‹m©UUID
[];

205 
CONST
 
uöt8
 
ch¨AggF‹m©UUID
[];

206 
CONST
 
uöt8
 
vÆidR™geUUID
[];

207 
CONST
 
uöt8
 
extRï‹tRefUUID
[];

208 
CONST
 
uöt8
 
ªp‹tRefUUID
[];

213 
CONST
 
uöt8
 
devi˚NameUUID
[];

214 
CONST
 
uöt8
 
≠≥¨™˚UUID
[];

215 
CONST
 
uöt8
 
≥riPrivacyFœgUUID
[];

216 
CONST
 
uöt8
 
ªc⁄√˘AddrUUID
[];

217 
CONST
 
uöt8
 
≥riC⁄nP¨amUUID
[];

218 
CONST
 
uöt8
 
£rvi˚Ch™gedUUID
[];

219 
CONST
 
uöt8
 
m™uNameUUID
[];

220 
CONST
 
uöt8
 
£rülNumUUID
[];

221 
CONST
 
uöt8
 
m™uAddrUUID
[];

226 c⁄° 
uöt8
 *
GATT_FödUUIDRec
–uöt8 *
pUUID
, uöt8 
Àn
 );

231 #ifde‡
__˝lu•lus


	@Components/ble/include/hci.h

44 #i‚de‡
HCI_H


45 
	#HCI_H


	)

47 #ifde‡
__˝lu•lus


55 
	~"bcomdef.h
"

56 
	~"OSAL.h
"

57 
	~"Œ.h
"

58 
	~"hÆ_as£π.h
"

73 
	#HCI_SUCCESS
 0x00

	)

74 
	#HCI_ERROR_CODE_UNKNOWN_HCI_CMD
 0x01

	)

75 
	#HCI_ERROR_CODE_UNKNOWN_CONN_ID
 0x02

	)

76 
	#HCI_ERROR_CODE_HW_FAILURE
 0x03

	)

77 
	#HCI_ERROR_CODE_PAGE_TIMEOUT
 0x04

	)

78 
	#HCI_ERROR_CODE_AUTH_FAILURE
 0x05

	)

79 
	#HCI_ERROR_CODE_PIN_KEY_MISSING
 0x06

	)

80 
	#HCI_ERROR_CODE_MEM_CAP_EXCEEDED
 0x07

	)

81 
	#HCI_ERROR_CODE_CONN_TIMEOUT
 0x08

	)

82 
	#HCI_ERROR_CODE_CONN_LIMIT_EXCEEDED
 0x09

	)

83 
	#HCI_ERROR_CODE_SYNCH_CONN_LIMIT_EXCEEDED
 0x0A

	)

84 
	#HCI_ERROR_CODE_ACL_CONN_ALREADY_EXISTS
 0x0B

	)

85 
	#HCI_ERROR_CODE_CMD_DISALLOWED
 0x0C

	)

86 
	#HCI_ERROR_CODE_CONN_REJ_LIMITED_RESOURCES
 0x0D

	)

87 
	#HCI_ERROR_CODE_CONN_REJECTED_SECURITY_REASONS
 0x0E

	)

88 
	#HCI_ERROR_CODE_CONN_REJECTED_UNACCEPTABLE_BDADDR
 0x0F

	)

89 
	#HCI_ERROR_CODE_CONN_ACCEPT_TIMEOUT_EXCEEDED
 0x10

	)

90 
	#HCI_ERROR_CODE_UNSUPPORTED_FEATURE_PARAM_VALUE
 0x11

	)

91 
	#HCI_ERROR_CODE_INVALID_HCI_CMD_PARAMS
 0x12

	)

92 
	#HCI_ERROR_CODE_REMOTE_USER_TERM_CONN
 0x13

	)

93 
	#HCI_ERROR_CODE_REMOTE_DEVICE_TERM_CONN_LOW_RESOURCES
 0x14

	)

94 
	#HCI_ERROR_CODE_REMOTE_DEVICE_TERM_CONN_POWER_OFF
 0x15

	)

95 
	#HCI_ERROR_CODE_CONN_TERM_BY_LOCAL_HOST
 0x16

	)

96 
	#HCI_ERROR_CODE_REPEATED_ATTEMPTS
 0x17

	)

97 
	#HCI_ERROR_CODE_PAIRING_NOT_ALLOWED
 0x18

	)

98 
	#HCI_ERROR_CODE_UNKNOWN_LMP_PDU
 0x19

	)

99 
	#HCI_ERROR_CODE_UNSUPPORTED_REMOTE_FEATURE
 0x1A

	)

100 
	#HCI_ERROR_CODE_SCO_OFFSET_REJ
 0x1B

	)

101 
	#HCI_ERROR_CODE_SCO_INTERVAL_REJ
 0x1C

	)

102 
	#HCI_ERROR_CODE_SCO_AIR_MODE_REJ
 0x1D

	)

103 
	#HCI_ERROR_CODE_INVALID_LMP_PARAMS
 0x1E

	)

104 
	#HCI_ERROR_CODE_UNSPECIFIED_ERROR
 0x1F

	)

105 
	#HCI_ERROR_CODE_UNSUPPORTED_LMP_PARAM_VAL
 0x20

	)

106 
	#HCI_ERROR_CODE_ROLE_CHANGE_NOT_ALLOWED
 0x21

	)

107 
	#HCI_ERROR_CODE_LMP_LL_RESP_TIMEOUT
 0x22

	)

108 
	#HCI_ERROR_CODE_LMP_ERR_TRANSACTION_COLLISION
 0x23

	)

109 
	#HCI_ERROR_CODE_LMP_PDU_NOT_ALLOWED
 0x24

	)

110 
	#HCI_ERROR_CODE_ENCRYPT_MODE_NOT_ACCEPTABLE
 0x25

	)

111 
	#HCI_ERROR_CODE_LINK_KEY_CAN_NOT_BE_CHANGED
 0x26

	)

112 
	#HCI_ERROR_CODE_REQ_QOS_NOT_SUPPORTED
 0x27

	)

113 
	#HCI_ERROR_CODE_INSTANT_PASSED
 0x28

	)

114 
	#HCI_ERROR_CODE_PAIRING_WITH_UNIT_KEY_NOT_SUPPORTED
 0x29

	)

115 
	#HCI_ERROR_CODE_DIFFERENT_TRANSACTION_COLLISION
 0x2A

	)

116 
	#HCI_ERROR_CODE_RESERVED1
 0x2B

	)

117 
	#HCI_ERROR_CODE_QOS_UNACCEPTABLE_PARAM
 0x2C

	)

118 
	#HCI_ERROR_CODE_QOS_REJ
 0x2D

	)

119 
	#HCI_ERROR_CODE_CHAN_ASSESSMENT_NOT_SUPPORTED
 0x2E

	)

120 
	#HCI_ERROR_CODE_INSUFFICIENT_SECURITY
 0x2F

	)

121 
	#HCI_ERROR_CODE_PARAM_OUT_OF_MANDATORY_RANGE
 0x30

	)

122 
	#HCI_ERROR_CODE_RESERVED2
 0x31

	)

123 
	#HCI_ERROR_CODE_ROLE_SWITCH_PENDING
 0x32

	)

124 
	#HCI_ERROR_CODE_RESERVED3
 0x33

	)

125 
	#HCI_ERROR_CODE_RESERVED_SLOT_VIOLATION
 0x34

	)

126 
	#HCI_ERROR_CODE_ROLE_SWITCH_FAILED
 0x35

	)

127 
	#HCI_ERROR_CODE_EXTENDED_INQUIRY_RESP_TOO_LARGE
 0x36

	)

128 
	#HCI_ERROR_CODE_SIMPLE_PAIRING_NOT_SUPPORTED_BY_HOST
 0x37

	)

129 
	#HCI_ERROR_CODE_HOST_BUSY_PAIRING
 0x38

	)

130 
	#HCI_ERROR_CODE_CONN_REJ_NO_SUITABLE_CHAN_FOUND
 0x39

	)

131 
	#HCI_ERROR_CODE_CONTROLLER_BUSY
 0x3A

	)

132 
	#HCI_ERROR_CODE_UNACCEPTABLE_CONN_INTERVAL
 0x3B

	)

133 
	#HCI_ERROR_CODE_DIRECTED_ADV_TIMEOUT
 0x3C

	)

134 
	#HCI_ERROR_CODE_CONN_TERM_MIC_FAILURE
 0x3D

	)

135 
	#HCI_ERROR_CODE_CONN_FAILED_TO_ESTABLISH
 0x3E

	)

136 
	#HCI_ERROR_CODE_MAC_CONN_FAILED
 0x3F

	)

143 
	#FIRST_PKT_HOST_TO_CTRL
 
LL_DATA_FIRST_PKT_HOST_TO_CTRL


	)

144 
	#CONTINUING_PKT
 
LL_DATA_CONTINUATION_PKT


	)

145 
	#FIRST_PKT_CTRL_TO_HOST
 
LL_DATA_FIRST_PKT_CTRL_TO_HOST


	)

148 
	#HCI_RSSI_NOT_AVAILABLE
 
LL_RSSI_NOT_AVAILABLE


	)

151 
	#HCI_DISCONNECT_AUTH_FAILURE
 
HCI_ERROR_CODE_AUTH_FAILURE


	)

152 
	#HCI_DISCONNECT_REMOTE_USER_TERM
 
HCI_ERROR_CODE_REMOTE_USER_TERM_CONN


	)

153 
	#HCI_DISCONNECT_REMOTE_DEV_LOW_RESOURCES
 
HCI_ERROR_CODE_REMOTE_DEVICE_TERM_CONN_LOW_RESOURCES


	)

154 
	#HCI_DISCONNECT_REMOTE_DEV_POWER_OFF
 
HCI_ERROR_CODE_REMOTE_DEVICE_TERM_CONN_POWER_OFF


	)

155 
	#HCI_DISCONNECT_UNSUPPORTED_REMOTE_FEATURE
 
HCI_ERROR_CODE_UNSUPPORTED_REMOTE_FEATURE


	)

156 
	#HCI_DISCONNECT_KEY_PAIRING_NOT_SUPPORTED
 
HCI_ERROR_CODE_PAIRING_WITH_UNIT_KEY_NOT_SUPPORTED


	)

157 
	#HCI_DISCONNECT_UNACCEPTABLE_CONN_INTERVAL
 
HCI_ERROR_CODE_UNACCEPTABLE_CONN_INTERVAL


	)

160 
	#HCI_READ_CURRENT_TX_POWER_LEVEL
 
LL_READ_CURRENT_TX_POWER_LEVEL


	)

161 
	#HCI_READ_MAX_TX_POWER_LEVEL
 
LL_READ_MAX_TX_POWER_LEVEL


	)

164 
	#HCI_CTRL_TO_HOST_FLOW_CTRL_OFF
 0

	)

165 
	#HCI_CTRL_TO_HOST_FLOW_CTRL_ACL_ON_SYNCH_OFF
 1

	)

166 
	#HCI_CTRL_TO_HOST_FLOW_CTRL_ACL_OFF_SYNCH_ON
 2

	)

167 
	#HCI_CTRL_TO_HOST_FLOW_CTRL_ACL_ON_SYNCH_ON
 3

	)

170 
	#HCI_PUBLIC_DEVICE_ADDRESS
 
LL_DEV_ADDR_TYPE_PUBLIC


	)

171 
	#HCI_RANDOM_DEVICE_ADDRESS
 
LL_DEV_ADDR_TYPE_RANDOM


	)

174 
	#HCI_CONNECTABLE_UNDIRECTED_ADV
 
LL_ADV_CONNECTABLE_UNDIRECTED_EVT


	)

175 
	#HCI_CONNECTABLE_DIRECTED_ADV
 
LL_ADV_CONNECTABLE_DIRECTED_EVT


	)

176 
	#HCI_SCANNABLE_UNDIRECTED
 
LL_ADV_SCANNABLE_UNDIRECTED_EVT


	)

177 
	#HCI_NONCONNECTABLE_UNDIRECTED_ADV
 
LL_ADV_NONCONNECTABLE_UNDIRECTED_EVT


	)

180 
	#HCI_ADV_CHAN_37
 
LL_ADV_CHAN_37


	)

181 
	#HCI_ADV_CHAN_38
 
LL_ADV_CHAN_38


	)

182 
	#HCI_ADV_CHAN_39
 
LL_ADV_CHAN_39


	)

183 
	#HCI_ADV_CHAN_ALL
 (
LL_ADV_CHAN_37
 | 
LL_ADV_CHAN_38
 | 
LL_ADV_CHAN_39
)

	)

186 
	#HCI_ADV_WL_POLICY_ANY_REQ
 
LL_ADV_WL_POLICY_ANY_REQ


	)

187 
	#HCI_ADV_WL_POLICY_WL_SCAN_REQ
 
LL_ADV_WL_POLICY_WL_SCAN_REQ


	)

188 
	#HCI_ADV_WL_POLICY_WL_CONNECT_REQ
 
LL_ADV_WL_POLICY_WL_CONNECT_REQ


	)

189 
	#HCI_ADV_WL_POLICY_WL_ALL_REQ
 
LL_ADV_WL_POLICY_WL_ALL_REQ


	)

192 
	#HCI_ENABLE_ADV
 
LL_ADV_MODE_ON


	)

193 
	#HCI_DISABLE_ADV
 
LL_ADV_MODE_OFF


	)

196 
	#HCI_SCAN_PASSIVE
 
LL_SCAN_PASSIVE


	)

197 
	#HCI_SCAN_ACTIVE
 
LL_SCAN_ACTIVE


	)

200 
	#HCI_SCAN_WL_POLICY_ANY_ADV_PKTS
 
LL_SCAN_WL_POLICY_ANY_ADV_PKTS


	)

201 
	#HCI_SCAN_WL_POLICY_USE_WHITE_LIST
 
LL_SCAN_WL_POLICY_USE_WHITE_LIST


	)

204 
	#HCI_FILTER_REPORTS_DISABLE
 
LL_FILTER_REPORTS_DISABLE


	)

205 
	#HCI_FILTER_REPORTS_ENABLE
 
LL_FILTER_REPORTS_ENABLE


	)

208 
	#HCI_SCAN_STOP
 
LL_SCAN_STOP


	)

209 
	#HCI_SCAN_START
 
LL_SCAN_START


	)

212 
	#HCI_INIT_WL_POLICY_USE_PEER_ADDR
 
LL_INIT_WL_POLICY_USE_PEER_ADDR


	)

213 
	#HCI_INIT_WL_POLICY_USE_WHITE_LIST
 
LL_INIT_WL_POLICY_USE_WHITE_LIST


	)

216 
	#HCI_ENCRYPTION_OFF
 
LL_ENCRYPTION_OFF


	)

217 
	#HCI_ENCRYPTION_ON
 
LL_ENCRYPTION_ON


	)

220 
	#HCI_DTM_NUMBER_RF_CHANS
 
LL_DIRECT_TEST_NUM_RF_CHANS


	)

221 
	#HCI_DIRECT_TEST_MAX_PAYLOAD_LEN
 
LL_DIRECT_TEST_MAX_PAYLOAD_LEN


	)

223 
	#HCI_DIRECT_TEST_PAYLOAD_PRBS9
 
LL_DIRECT_TEST_PAYLOAD_PRBS9


	)

224 
	#HCI_DIRECT_TEST_PAYLOAD_0x0F
 
LL_DIRECT_TEST_PAYLOAD_0x0F


	)

225 
	#HCI_DIRECT_TEST_PAYLOAD_0x55
 
LL_DIRECT_TEST_PAYLOAD_0x55


	)

226 
	#HCI_DIRECT_TEST_PAYLOAD_PRBS15
 
LL_DIRECT_TEST_PAYLOAD_PRBS15


	)

227 
	#HCI_DIRECT_TEST_PAYLOAD_0xFF
 
LL_DIRECT_TEST_PAYLOAD_0xFF


	)

228 
	#HCI_DIRECT_TEST_PAYLOAD_0x00
 
LL_DIRECT_TEST_PAYLOAD_0x00


	)

229 
	#HCI_DIRECT_TEST_PAYLOAD_0xF0
 
LL_DIRECT_TEST_PAYLOAD_0xF0


	)

230 
	#HCI_DIRECT_TEST_PAYLOAD_0xAA
 
LL_DIRECT_TEST_PAYLOAD_0xAA


	)

233 
	#HCI_EXT_RX_GAIN_STD
 
LL_EXT_RX_GAIN_STD


	)

234 
	#HCI_EXT_RX_GAIN_HIGH
 
LL_EXT_RX_GAIN_HIGH


	)

236 
	#HCI_EXT_TX_POWER_MINUS_23_DBM
 
LL_EXT_TX_POWER_MINUS_23_DBM


	)

237 
	#HCI_EXT_TX_POWER_MINUS_6_DBM
 
LL_EXT_TX_POWER_MINUS_6_DBM


	)

238 
	#HCI_EXT_TX_POWER_0_DBM
 
LL_EXT_TX_POWER_0_DBM


	)

239 
	#HCI_EXT_TX_POWER_4_DBM
 
LL_EXT_TX_POWER_4_DBM


	)

241 
	#HCI_EXT_ENABLE_ONE_PKT_PER_EVT
 
LL_EXT_ENABLE_ONE_PKT_PER_EVT


	)

242 
	#HCI_EXT_DISABLE_ONE_PKT_PER_EVT
 
LL_EXT_DISABLE_ONE_PKT_PER_EVT


	)

244 
	#HCI_EXT_ENABLE_CLK_DIVIDE_ON_HALT
 
LL_EXT_ENABLE_CLK_DIVIDE_ON_HALT


	)

245 
	#HCI_EXT_DISABLE_CLK_DIVIDE_ON_HALT
 
LL_EXT_DISABLE_CLK_DIVIDE_ON_HALT


	)

247 
	#HCI_EXT_NV_IN_USE
 
LL_EXT_NV_IN_USE


	)

248 
	#HCI_EXT_NV_NOT_IN_USE
 
LL_EXT_NV_NOT_IN_USE


	)

250 
	#HCI_EXT_ENABLE_FAST_TX_RESP_TIME
 
LL_EXT_ENABLE_FAST_TX_RESP_TIME


	)

251 
	#HCI_EXT_DISABLE_FAST_TX_RESP_TIME
 
LL_EXT_DISABLE_FAST_TX_RESP_TIME


	)

253 
	#HCI_EXT_ENABLE_SL_OVERRIDE
 
LL_EXT_ENABLE_SL_OVERRIDE


	)

254 
	#HCI_EXT_DISABLE_SL_OVERRIDE
 
LL_EXT_DISABLE_SL_OVERRIDE


	)

256 
	#HCI_EXT_TX_MODULATED_CARRIER
 
LL_EXT_TX_MODULATED_CARRIER


	)

257 
	#HCI_EXT_TX_UNMODULATED_CARRIER
 
LL_EXT_TX_UNMODULATED_CARRIER


	)

259 
	#HCI_PTM_SET_FREQ_TUNE_DOWN
 
LL_EXT_SET_FREQ_TUNE_DOWN


	)

260 
	#HCI_PTM_SET_FREQ_TUNE_UP
 
LL_EXT_SET_FREQ_TUNE_UP


	)

262 
	#HCI_EXT_PM_IO_PORT_P0
 
LL_EXT_PM_IO_PORT_P0


	)

263 
	#HCI_EXT_PM_IO_PORT_P1
 
LL_EXT_PM_IO_PORT_P1


	)

264 
	#HCI_EXT_PM_IO_PORT_P2
 
LL_EXT_PM_IO_PORT_P2


	)

265 
	#HCI_EXT_PM_IO_PORT_NONE
 
LL_EXT_PM_IO_PORT_NONE


	)

267 
	#HCI_EXT_PM_IO_PORT_PIN0
 
LL_EXT_PM_IO_PORT_PIN0


	)

268 
	#HCI_EXT_PM_IO_PORT_PIN1
 
LL_EXT_PM_IO_PORT_PIN1


	)

269 
	#HCI_EXT_PM_IO_PORT_PIN2
 
LL_EXT_PM_IO_PORT_PIN2


	)

270 
	#HCI_EXT_PM_IO_PORT_PIN3
 
LL_EXT_PM_IO_PORT_PIN3


	)

271 
	#HCI_EXT_PM_IO_PORT_PIN4
 
LL_EXT_PM_IO_PORT_PIN4


	)

272 
	#HCI_EXT_PM_IO_PORT_PIN5
 
LL_EXT_PM_IO_PORT_PIN5


	)

273 
	#HCI_EXT_PM_IO_PORT_PIN6
 
LL_EXT_PM_IO_PORT_PIN6


	)

274 
	#HCI_EXT_PM_IO_PORT_PIN7
 
LL_EXT_PM_IO_PORT_PIN7


	)

276 
	#HCI_EXT_PER_RESET
 
LL_EXT_PER_RESET


	)

277 
	#HCI_EXT_PER_READ
 
LL_EXT_PER_READ


	)

279 
	#HCI_EXT_HALT_DURING_RF_DISABLE
 
LL_EXT_HALT_DURING_RF_DISABLE


	)

280 
	#HCI_EXT_HALT_DURING_RF_ENABLE
 
LL_EXT_HALT_DURING_RF_ENABLE


	)

282 
	#HCI_EXT_SET_USER_REVISION
 
LL_EXT_SET_USER_REVISION


	)

283 
	#HCI_EXT_READ_BUILD_REVISION
 
LL_EXT_READ_BUILD_REVISION


	)

290 
	#HCI_LINK_TYPE_SCO_BUFFER_OVERFLOW
 0

	)

291 
	#HCI_LINK_TYPE_ACL_BUFFER_OVERFLOW
 1

	)

297 
uöt8
 
	thciSètus_t
;

306 
oßl_evít_hdr_t
 
hdr
;

307 
uöt8
 
BLEEvítCode
;

308 
uöt8
 
°©us
;

309 
uöt16
 
c⁄√˘i⁄H™dÀ
;

310 
uöt8
 
rﬁe
;

311 
uöt8
 
≥îAddrTy≥
;

312 
uöt8
 
≥îAddr
[
B_ADDR_LEN
];

313 
uöt16
 
c⁄nI¡îvÆ
;

314 
uöt16
 
c⁄nL©ícy
;

315 
uöt16
 
c⁄nTimeout
;

316 
uöt8
 
˛ockAccuøcy
;

317 } 
	thciEvt_BLEC⁄nCom∂ëe_t
;

322 
uöt8
 
evítTy≥
;

323 
uöt8
 
addrTy≥
;

324 
uöt8
 
addr
[
B_ADDR_LEN
];

325 
uöt8
 
d©aLí
;

326 
uöt8
 
r•D©a
[
B_MAX_ADV_LEN
];

327 
öt8
 
rssi
;

328 } 
	thciEvt_DevInfo_t
;

332 
oßl_evít_hdr_t
 
hdr
;

333 
uöt8
 
BLEEvítCode
;

334 
uöt8
 
numDevi˚s
;

335 
hciEvt_DevInfo_t
* 
devInfo
;

336 } 
	thciEvt_BLEAdvPktRï‹t_t
;

341 
oßl_evít_hdr_t
 
hdr
;

342 
uöt8
 
BLEEvítCode
;

343 
uöt8
 
°©us
;

344 
uöt16
 
c⁄√˘i⁄H™dÀ
;

345 
uöt16
 
c⁄nI¡îvÆ
;

346 
uöt16
 
c⁄nL©ícy
;

347 
uöt16
 
c⁄nTimeout
;

348 } 
	thciEvt_BLEC⁄nUpd©eCom∂ëe_t
;

353 
oßl_evít_hdr_t
 
hdr
;

354 
uöt8
 
BLEEvítCode
;

355 
uöt8
 
°©us
;

356 
uöt16
 
c⁄√˘i⁄H™dÀ
;

357 
uöt8
 
„©uªs
[8];

358 } 
	thciEvt_BLERódRemŸeFótuªCom∂ëe_t
;

363 
oßl_evít_hdr_t
 
hdr
;

364 
uöt8
 
BLEEvítCode
;

365 
uöt16
 
c⁄nH™dÀ
;

366 
uöt8
 
ªas⁄
;

367 
uöt8
 
ícE«bÀ
;

368 } 
	thciEvt_En¸y±Ch™ge_t
;

373 
oßl_evít_hdr_t
 
hdr
;

374 
uöt8
 
BLEEvítCode
;

375 
uöt16
 
c⁄nH™dÀ
;

376 
uöt8
 
øndom
[
B_RANDOM_NUM_SIZE
];

377 
uöt16
 
í¸y±edDivîsifõr
;

378 } 
	thciEvt_BLELTKReq_t
;

383 
oßl_evít_hdr_t
 
hdr
;

384 
uöt8
 
numH™dÀs
;

385 
uöt16
 *
pC⁄√˘i⁄H™dÀ
;

386 
uöt16
 *
pNumCom∂ëedPackës
;

387 } 
	thciEvt_NumCom∂ëedPkt_t
;

392 
oßl_evít_hdr_t
 
hdr
;

393 
uöt8
 
numHciCmdPkt
;

394 
uöt16
 
cmdOpcode
;

395 
uöt8
 *
pRëu∫P¨am
;

396 } 
	thciEvt_CmdCom∂ëe_t
;

401 
oßl_evít_hdr_t
 
hdr
;

402 
uöt8
 
cmdSètus
;

403 
uöt8
 
numHciCmdPkt
;

404 
uöt16
 
cmdOpcode
;

405 } 
	thciEvt_Comm™dSètus_t
;

410 
oßl_evít_hdr_t
 
hdr
;

411 
uöt8
 
h¨dw¨eCode
;

412 } 
	thciEvt_H¨dw¨eEº‹_t
;

417 
oßl_evít_hdr_t
 
hdr
;

418 
uöt8
 
°©us
;

419 
uöt16
 
c⁄nH™dÀ
;

420 
uöt8
 
ªas⁄
;

421 } 
	thciEvt_Disc⁄nCom∂ëe_t
;

426 
oßl_evít_hdr_t
 
hdr
;

427 
uöt8
 
lökTy≥
;

428 } 
	thciEvt_Buf„rOvîÊow_t
;

433 
uöt8
 
°©us
;

434 
uöt16
 
d©aPktLí
;

435 
uöt8
 
numD©aPkts
;

436 } 
	thciRëP¨am_LeRódBufSize_t
;

440 
oßl_evít_hdr_t
 
hdr
;

441 
uöt8
 *
pD©a
;

442 } 
	thciPackë_t
;

446 
oßl_evít_hdr_t
 
hdr
;

447 
uöt8
 
pktTy≥
;

448 
uöt16
 
c⁄nH™dÀ
;

449 
uöt8
 
pbFœg
;

450 
uöt16
 
pktLí
;

451 
uöt8
 *
pD©a
;

452 } 
	thciD©aPackë_t
;

458 
oßl_evít_hdr_t
 
hdr
;

459 
uöt16
 
c⁄nH™dÀ
;

460 
uöt8
 
pbFœg
;

461 
uöt16
 
Àn
;

462 
uöt8
 *
pD©a
;

463 } 
	thciD©aEvít_t
;

495 *
HCI_bm_Æloc
–
uöt16
 
size
 );

522 
uöt8
 
HCI_VÆidC⁄nTimeP¨ams
–
uöt16
 
c⁄nI¡îvÆMö
,

523 
uöt16
 
c⁄nI¡îvÆMax
,

524 
uöt16
 
c⁄nL©ícy
,

525 
uöt16
 
c⁄nTimeout
 );

543 
HCI_Te°AµTaskRegi°î
–
uöt8
 
èskID
 );

561 
HCI_GAPTaskRegi°î
–
uöt8
 
èskID
 );

581 
HCI_L2CAPTaskRegi°î
–
uöt8
 
èskID
 );

599 
HCI_SMPTaskRegi°î
–
uöt8
 
èskID
 );

617 
HCI_ExtTaskRegi°î
–
uöt8
 
èskID
 );

620 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

645 
hciSètus_t
 
HCI_SídD©aPkt
–
uöt16
 
c⁄nH™dÀ
,

646 
uöt8
 
pbFœg
,

647 
uöt16
 
pktLí
,

648 
uöt8
 *
pD©a
 );

656 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

682 
hciSètus_t
 
HCI_Disc⁄√˘Cmd
–
uöt16
 
c⁄nH™dÀ
,

683 
uöt8
 
ªas⁄
 );

687 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

707 
hciSètus_t
 
HCI_RódRemŸeVîsi⁄InfoCmd
–
uöt16
 
c⁄nH™dÀ
 );

729 
hciSètus_t
 
HCI_SëEvítMaskCmd
–
uöt8
 *
pMask
 );

749 
hciSètus_t
 
HCI_Re£tCmd
( );

752 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

772 
hciSètus_t
 
HCI_RódTønsmôPowîLevñCmd
–
uöt16
 
c⁄nH™dÀ
,

773 
uöt8
 
txPwrTy≥
 );

777 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

801 
hciSètus_t
 
HCI_SëC⁄åﬁÀrToHo°FlowCålCmd
–
uöt8
 
ÊowC⁄åﬁE«bÀ
 );

805 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

832 
hciSètus_t
 
HCI_Ho°Buf„rSizeCmd
–
uöt16
 
ho°A˛PktLí
,

833 
uöt8
 
ho°SyncPktLí
,

834 
uöt16
 
ho°TŸÆNumA˛Pkts
,

835 
uöt16
 
ho°TŸÆNumSyncPkts
 );

839 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

873 
hciSètus_t
 
HCI_Ho°NumCom∂ëedPktCmd
–
uöt8
 
numH™dÀs
,

874 
uöt16
 *
c⁄nH™dÀs
,

875 
uöt16
 *
numCom∂ëedPkts
 );

896 
hciSètus_t
 
HCI_RódLoˇlVîsi⁄InfoCmd
( );

916 
hciSètus_t
 
HCI_RódLoˇlSuµ‹ãdComm™dsCmd
( );

936 
hciSètus_t
 
HCI_RódLoˇlSuµ‹ãdFótuªsCmd
( );

956 
hciSètus_t
 
HCI_RódBDADDRCmd
( );

981 
hciSètus_t
 
HCI_RódRssiCmd
–
uöt16
 
c⁄nH™dÀ
 );

1006 
hciSètus_t
 
HCI_LE_SëEvítMaskCmd
–
uöt8
 *
pEvítMask
 );

1027 
hciSètus_t
 
HCI_LE_RódBufSizeCmd
( );

1047 
hciSètus_t
 
HCI_LE_RódLoˇlSuµ‹ãdFótuªsCmd
( );

1067 
hciSètus_t
 
HCI_LE_SëR™domAddªssCmd
–
uöt8
 *
pR™dAddr
 );

1070 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1107 
hciSètus_t
 
HCI_LE_SëAdvP¨amCmd
–
uöt16
 
advI¡îvÆMö
,

1108 
uöt16
 
advI¡îvÆMax
,

1109 
uöt8
 
advTy≥
,

1110 
uöt8
 
ownAddrTy≥
,

1111 
uöt8
 
dúe˘AddrTy≥
,

1112 
uöt8
 *
dúe˘Addr
,

1113 
uöt8
 
advCh™√lM≠
,

1114 
uöt8
 
advFûãrPﬁicy
 );

1118 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1137 
hciSètus_t
 
HCI_LE_SëAdvD©aCmd
–
uöt8
 
d©aLí
,

1138 
uöt8
 *
pD©a
 );

1142 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1161 
hciSètus_t
 
HCI_LE_SëSˇnR•D©aCmd
–
uöt8
 
d©aLí
,

1162 
uöt8
 *
pD©a
 );

1166 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1184 
hciSètus_t
 
HCI_LE_SëAdvE«bÀCmd
–
uöt8
 
advE«bÀ
 );

1188 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

1206 
hciSètus_t
 
HCI_LE_RódAdvCh™TxPowîCmd
( );

1210 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
SCAN_CFG
)

1234 
hciSètus_t
 
HCI_LE_SëSˇnP¨amCmd
–
uöt8
 
sˇnTy≥
,

1235 
uöt16
 
sˇnI¡îvÆ
,

1236 
uöt16
 
sˇnWödow
,

1237 
uöt8
 
ownAddrTy≥
,

1238 
uöt8
 
fûãrPﬁicy
 );

1242 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
SCAN_CFG
)

1263 
hciSètus_t
 
HCI_LE_SëSˇnE«bÀCmd
–
uöt8
 
sˇnE«bÀ
,

1264 
uöt8
 
fûãrDu∂iˇãs
 );

1268 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1304 
hciSètus_t
 
HCI_LE_Cª©eC⁄nCmd
–
uöt16
 
sˇnI¡îvÆ
,

1305 
uöt16
 
sˇnWödow
,

1306 
uöt8
 
öôFûãrPﬁicy
,

1307 
uöt8
 
addrTy≥Pìr
,

1308 
uöt8
 *
≥îAddr
,

1309 
uöt8
 
ownAddrTy≥
,

1310 
uöt16
 
c⁄nI¡îvÆMö
,

1311 
uöt16
 
c⁄nI¡îvÆMax
,

1312 
uöt16
 
c⁄nL©ícy
,

1313 
uöt16
 
c⁄nTimeout
,

1314 
uöt16
 
möLí
,

1315 
uöt16
 
maxLí
 );

1319 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1337 
hciSètus_t
 
HCI_LE_Cª©eC⁄nC™˚lCmd
( );

1358 
hciSètus_t
 
HCI_LE_RódWhôeLi°SizeCmd
( );

1378 
hciSètus_t
 
HCI_LE_CÀ¨WhôeLi°Cmd
( );

1399 
hciSètus_t
 
HCI_LE_AddWhôeLi°Cmd
–
uöt8
 
addrTy≥
,

1400 
uöt8
 *
devAddr
 );

1422 
hciSètus_t
 
HCI_LE_RemoveWhôeLi°Cmd
–
uöt8
 
addrTy≥
,

1423 
uöt8
 *
devAddr
 );

1426 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1451 
hciSètus_t
 
HCI_LE_C⁄nUpd©eCmd
–
uöt16
 
c⁄nH™dÀ
,

1452 
uöt16
 
c⁄nI¡îvÆMö
,

1453 
uöt16
 
c⁄nI¡îvÆMax
,

1454 
uöt16
 
c⁄nL©ícy
,

1455 
uöt16
 
c⁄nTimeout
,

1456 
uöt16
 
möLí
,

1457 
uöt16
 
maxLí
 );

1461 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1479 
hciSètus_t
 
HCI_LE_SëHo°Ch™Cœssifiˇti⁄Cmd
–
uöt8
 *
ch™M≠
 );

1483 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

1501 
hciSètus_t
 
HCI_LE_RódCh™√lM≠Cmd
–
uöt16
 
c⁄nH™dÀ
 );

1505 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1524 
hciSètus_t
 
HCI_LE_RódRemŸeU£dFótuªsCmd
–
uöt16
 
c⁄nH™dÀ
 );

1548 
hciSètus_t
 
HCI_LE_En¸y±Cmd
–
uöt8
 *
key
,

1549 
uöt8
 *
∂aöText
 );

1569 
hciSètus_t
 
HCI_LE_R™dCmd
( );

1572 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
INIT_CFG
)

1595 
hciSètus_t
 
HCI_LE_SèπEncy±Cmd
–
uöt16
 
c⁄nH™dÀ
,

1596 
uöt8
 *
øndom
,

1597 
uöt8
 *
ícDiv
,

1598 
uöt8
 *
…k
 );

1602 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

1622 
hciSètus_t
 
HCI_LE_LtkReqRïlyCmd
–
uöt16
 
c⁄nH™dÀ
,

1623 
uöt8
 *
…k
 );

1627 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

1646 
hciSètus_t
 
HCI_LE_LtkReqNegRïlyCmd
–
uöt16
 
c⁄nH™dÀ
 );

1667 
hciSètus_t
 
HCI_LE_RódSuµ‹ãdSèãsCmd
( );

1690 
hciSètus_t
 
HCI_LE_Re˚ivîTe°Cmd
–
uöt8
 
rxFªq
 );

1725 
hciSètus_t
 
HCI_LE_TønsmôãrTe°Cmd
–
uöt8
 
txFªq
,

1726 
uöt8
 
d©aLí
,

1727 
uöt8
 
pktPaylﬂd
 );

1749 
hciSètus_t
 
HCI_LE_Te°EndCmd
( );

1772 
hciSètus_t
 
HCI_EXT_SëRxGaöCmd
–
uöt8
 
rxGaö
 );

1795 
hciSètus_t
 
HCI_EXT_SëTxPowîCmd
–
uöt8
 
txPowî
 );

1798 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

1818 
hciSètus_t
 
HCI_EXT_O√PktPîEvtCmd
–
uöt8
 
c⁄åﬁ
 );

1841 
hciSètus_t
 
HCI_EXT_ClkDivOnHÆtCmd
–
uöt8
 
c⁄åﬁ
 );

1863 
hciSètus_t
 
HCI_EXT_De˛¨eNvUßgeCmd
–
uöt8
 
mode
 );

1885 
hciSètus_t
 
HCI_EXT_De¸y±Cmd
–
uöt8
 *
key
,

1886 
uöt8
 *
ícText
 );

1907 
hciSètus_t
 
HCI_EXT_SëLoˇlSuµ‹ãdFótuªsCmd
–
uöt8
 *
loˇlFótuªs
 );

1910 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

1930 
hciSètus_t
 
HCI_EXT_SëFa°TxRe•⁄£TimeCmd
–
uöt8
 
c⁄åﬁ
 );

1934 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

1954 
hciSètus_t
 
HCI_EXT_SëSœveL©ícyOvîrideCmd
–
uöt8
 
c⁄åﬁ
 );

1985 
hciSètus_t
 
HCI_EXT_ModemTe°TxCmd
–
uöt8
 
cwMode
,

1986 
uöt8
 
txFªq
 );

2014 
hciSètus_t
 
HCI_EXT_ModemH›Te°TxCmd
( );

2041 
hciSètus_t
 
HCI_EXT_ModemTe°RxCmd
–
uöt8
 
rxFªq
 );

2060 
hciSètus_t
 
HCI_EXT_EndModemTe°Cmd
( );

2085 
hciSètus_t
 
HCI_EXT_SëBDADDRCmd
–
uöt8
 *
bdAddr
 );

2088 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2115 
hciSètus_t
 
HCI_EXT_SëSCACmd
–
uöt16
 
sˇInPPM
 );

2138 
hciSètus_t
 
HCI_EXT_E«bÀPTMCmd
( );

2160 
hciSètus_t
 
HCI_EXT_SëFªqTu√Cmd
–
uöt8
 
°ï
 );

2181 
hciSètus_t
 
HCI_EXT_SaveFªqTu√Cmd
( );

2205 
hciSètus_t
 
HCI_EXT_SëMaxDtmTxPowîCmd
–
uöt8
 
txPowî
 );

2259 
ŒSètus_t
 
HCI_EXT_M≠PmIoP‹tCmd
–
uöt8
 
ioP‹t
, uöt8 
ioPö
 );

2262 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2283 
hciSètus_t
 
HCI_EXT_Disc⁄√˘ImmedCmd
–
uöt16
 
c⁄nH™dÀ
 );

2287 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2308 
hciSètus_t
 
HCI_EXT_PackëEº‹R©eCmd
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
comm™d
 );

2312 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_CONN_CFG
Ë|| (CTRL_CONFIG & 
INIT_CFG
))

2340 
hciSètus_t
 
HCI_EXT_PERbyCh™Cmd
–
uöt16
 
c⁄nH™dÀ
, 
≥rByCh™_t
 *
≥rByCh™
 );

2362 
hciSètus_t
 
HCI_EXT_ExãndRfR™geCmd
( );

2384 
hciSètus_t
 
HCI_EXT_HÆtDurögRfCmd
–
uöt8
 
mode
 );

2387 #i‡
deföed
(
CTRL_CONFIG
Ë&& ((CTRL_CONFIG & 
ADV_NCONN_CFG
Ë|| (CTRL_CONFIG & 
ADV_CONN_CFG
))

2408 
hciSètus_t
 
HCI_EXT_AdvEvítNŸi˚Cmd
–
uöt8
 
èskID
, 
uöt16
 
èskEvít
 );

2412 #i‡
deföed
(
CTRL_CONFIG
Ë&& (CTRL_CONFIG & 
ADV_CONN_CFG
)

2435 
hciSètus_t
 
HCI_EXT_C⁄nEvítNŸi˚Cmd
–
uöt8
 
èskID
, 
uöt16
 
èskEvít
 );

2455 
hciSètus_t
 
HCI_EXT_BuûdRevisi⁄Cmd
–
uöt8
 
mode
, 
uöt16
 
u£rRevNum
 );

2458 #ifde‡
__˝lu•lus


	@Components/ble/include/l2cap.h

40 #i‚de‡
L2CAP_H


41 
	#L2CAP_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"bcomdef.h
"

52 
	~"OSAL.h
"

59 
	#L2CAP_MTU_SIZE
 23

	)

62 
	#L2CAP_SIG_MTU_SIZE
 23

	)

65 
	#L2CAP_HDR_SIZE
 4

	)

69 
	#L2CAP_PDU_SIZE
 ( 
L2CAP_HDR_SIZE
 + 
L2CAP_MTU_SIZE
 )

	)

74 
	#L2CAP_CID_NULL
 0x0000

75 
	#L2CAP_CID_ATT
 0x0004

76 
	#L2CAP_CID_SIG
 0x0005

77 
	#L2CAP_CID_SMP
 0x0006

78 
	#L2CAP_CID_GENERIC
 0x0007

79 

	)

81 
	#L2CAP_BASE_DYNAMIC_CID
 0x0040

	)

82 
	#L2CAP_LAST_DYNAMIC_CID
 ( 
BASE_DYNAMIC_CID
 + 
L2CAP_NUM_CHANNELS
 - 1 )

	)

85 
	#L2CAP_NUM_FIXED_CHANNELS
 4

	)

88 
	#L2CAP_NUM_PROTOCOLS
 0

	)

92 
	#L2CAP_NUM_AUX_CHANNELS
 3

	)

95 
	#L2CAP_NUM_DYNAMIC_CHANNELS
 ( 
L2CAP_NUM_PROTOCOLS
 * 
MAX_NUM_LL_CONN
 )

	)

98 
	#L2CAP_NUM_CHANNELS
 ( 
L2CAP_NUM_DYNAMIC_CHANNELS
 + 
L2CAP_NUM_AUX_CHANNELS
 )

	)

104 
	#L2CAP_RTX_TIMEOUT
 30

	)

107 
	#L2CAP_CMD_REJECT
 0x01

	)

108 
	#L2CAP_ECHO_REQ
 0x08

109 
	#L2CAP_ECHO_RSP
 0x09

110 
	#L2CAP_INFO_REQ
 0x0a

111 
	#L2CAP_INFO_RSP
 0x0b

112 
	#L2CAP_PARAM_UPDATE_REQ
 0x12

	)

113 
	#L2CAP_PARAM_UPDATE_RSP
 0x13

	)

119 
	#L2CAP_REJECT_CMD_NOT_UNDERSTOOD
 0x0000

	)

122 
	#L2CAP_REJECT_SIGNAL_MTU_EXCEED
 0x0001

	)

125 
	#L2CAP_REJECT_INVALID_CID
 0x0002

	)

131 
	#L2CAP_INFO_CONNLESS_MTU
 0x0001

	)

134 
	#L2CAP_INFO_EXTENDED_FEATURES
 0x0002

	)

137 
	#L2CAP_INFO_FIXED_CHANNELS
 0x0003

	)

143 
	#L2CAP_FIXED_CHANNELS
 0x00000080

	)

146 
	#L2CAP_EXTENDED_FEATURES_SIZE
 4

	)

152 
	#L2CAP_FIXED_CHANNELS_ATT
 0x10

	)

155 
	#L2CAP_FIXED_CHANNELS_SIG
 0x20

	)

158 
	#L2CAP_FIXED_CHANNELS_SMP
 0x40

	)

161 
	#L2CAP_FIXED_CHANNELS_SIZE
 8

	)

167 
	#L2CAP_INFO_SUCCESS
 0x0000

	)

170 
	#L2CAP_INFO_NOT_SUPPORTED
 0x0001

	)

176 
	#L2CAP_CONN_PARAMS_ACCEPTED
 0x0000

	)

179 
	#L2CAP_CONN_PARAMS_REJECTED
 0x0001

	)

197 
uöt16
 
loˇlCID
;

198 
uöt16
 
ªmŸeCID
;

199 } 
	tl2ˇpInvÆidCID_t
;

204 
uöt16
 
sig«lMTU
;

205 
l2ˇpInvÆidCID_t
 
övÆidCID
;

206 } 
	tl2ˇpRós⁄D©a_t
;

211 
uöt16
 
ªas⁄
;

212 
l2ˇpRós⁄D©a_t
 
ªas⁄D©a
;

215 
	#maxSig«lMTU
 
ªas⁄D©a
.
sig«lMTU


	)

216 
	#övÆidLoˇlCID
 
ªas⁄D©a
.
övÆidCID
.
loˇlCID


	)

217 
	#övÆidRemŸeCID
 
ªas⁄D©a
.
övÆidCID
.
ªmŸeCID


	)

218 } 
	tl2ˇpCmdReje˘_t
;

223 
uöt8
 *
pD©a
;

224 
uöt16
 
Àn
;

225 } 
	tl2ˇpEchoReq_t
;

230 
uöt8
 *
pD©a
;

231 
uöt16
 
Àn
;

232 } 
	tl2ˇpEchoR•_t
;

237 
uöt16
 
öfoTy≥
;

238 } 
	tl2ˇpInfoReq_t
;

243 
uöt16
 
c⁄√˘i⁄ÀssMTU
;

244 
uöt32
 
exãndedFótuªs
;

245 
uöt8
 
fixedCh™√ls
[
L2CAP_FIXED_CHANNELS_SIZE
];

246 } 
	tl2ˇpInfo_t
;

251 
uöt16
 
ªsu…
;

252 
uöt16
 
öfoTy≥
;

253 
l2ˇpInfo_t
 
öfo
;

254 } 
	tl2ˇpInfoR•_t
;

259 
uöt16
 
öãrvÆMö
;

260 
uöt16
 
öãrvÆMax
;

261 
uöt16
 
¶aveL©ícy
;

262 
uöt16
 
timeoutMu…ùlõr
;

263 } 
	tl2ˇpP¨amUpd©eReq_t
;

268 
uöt16
 
ªsu…
;

269 } 
	tl2ˇpP¨amUpd©eR•_t
;

275 
l2ˇpEchoReq_t
 
echoReq
;

276 
l2ˇpInfoReq_t
 
öfoReq
;

277 
l2ˇpP¨amUpd©eReq_t
 
upd©eReq
;

280 
l2ˇpCmdReje˘_t
 
cmdReje˘
;

281 
l2ˇpEchoR•_t
 
echoR•
;

282 
l2ˇpInfoR•_t
 
öfoR•
;

283 
l2ˇpP¨amUpd©eR•_t
 
upd©eR•
;

284 } 
	tl2ˇpSig«lCmd_t
;

290 
oßl_evít_hdr_t
 
hdr
;

291 
uöt16
 
c⁄nH™dÀ
;

292 
uöt8
 
id
;

293 
uöt8
 
›code
;

294 
l2ˇpSig«lCmd_t
 
cmd
;

295 } 
	tl2ˇpSig«lEvít_t
;

300 
uöt16
 
CID
;

301 
uöt8
 *
pPaylﬂd
;

304 
uöt16
 
Àn
;

305 } 
	tl2ˇpPackë_t
;

311 
oßl_evít_hdr_t
 
hdr
;

312 
uöt16
 
c⁄nH™dÀ
;

313 
l2ˇpPackë_t
 
pkt
;

314 } 
	tl2ˇpD©aEvít_t
;

327 
L2CAP_Inô
–
uöt8
 
èskId
 );

332 
uöt16
 
L2CAP_Pro˚ssEvít
–
uöt8
 
èskId
, uöt16 
evíts
 );

337 
bSètus_t
 
L2CAP_Regi°îAµ
–
uöt8
 
èskId
, 
uöt16
 
CID
 );

342 
bSètus_t
 
L2CAP_SídD©a
–
uöt16
 
c⁄nH™dÀ
, 
l2ˇpPackë_t
 *
pPkt
 );

347 
bSètus_t
 
L2CAP_CmdReje˘
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
id
, 
l2ˇpCmdReje˘_t
 *
pCmdReje˘
 );

352 
uöt16
 
L2CAP_BuûdCmdReje˘
–
uöt8
 *
pBuf
, uöt8 *
pCmd
 );

357 
bSètus_t
 
L2CAP_EchoReq
–
uöt16
 
c⁄nH™dÀ
, 
l2ˇpEchoReq_t
 *
pEchoReq
, 
uöt8
 
èskId
 );

362 
bSètus_t
 
L2CAP_InfoReq
–
uöt16
 
c⁄nH™dÀ
, 
l2ˇpInfoReq_t
 *
pInfoReq
, 
uöt8
 
èskId
 );

367 
uöt16
 
L2CAP_BuûdInfoR•
–
uöt8
 *
pBuf
, uöt8 *
pCmd
 );

372 
bSètus_t
 
L2CAP_P¨£InfoReq
–
l2ˇpSig«lCmd_t
 *
pCmd
, 
uöt8
 *
pD©a
, 
uöt16
 
Àn
 );

377 
bSètus_t
 
L2CAP_C⁄nP¨amUpd©eReq
–
uöt16
 
c⁄nH™dÀ
, 
l2ˇpP¨amUpd©eReq_t
 *
pUpd©eReq
, 
uöt8
 
èskId
 );

382 
bSètus_t
 
L2CAP_P¨£P¨amUpd©eReq
–
l2ˇpSig«lCmd_t
 *
pCmd
, 
uöt8
 *
pD©a
, 
uöt16
 
Àn
 );

387 
bSètus_t
 
L2CAP_C⁄nP¨amUpd©eR•
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
id
, 
l2ˇpP¨amUpd©eR•_t
 *
pUpd©eR•
 );

392 
uöt16
 
L2CAP_BuûdP¨amUpd©eR•
–
uöt8
 *
pBuf
, uöt8 *
pD©a
 );

397 *
L2CAP_bm_Æloc
–
uöt16
 
size
 );

403 #ifde‡
__˝lu•lus


	@Components/ble/include/sm.h

42 #i‚de‡
SM_H


43 
	#SM_H


	)

45 #ifde‡
__˝lu•lus


53 
	~"bcomdef.h
"

54 
	~"OSAL.h
"

66 
	#DISPLAY_ONLY
 0x00

67 
	#DISPLAY_YES_NO
 0x01

68 
	#KEYBOARD_ONLY
 0x02

69 
	#NO_INPUT_NO_OUTPUT
 0x03

70 
	#KEYBOARD_DISPLAY
 0x04

71 

	)

73 
	#SM_AUTH_MITM_MASK
(
a
Ë((◊Ë& 0x04Ë>> 2)

	)

78 
	#SM_PASSKEY_TYPE_INPUT
 0x01

79 
	#SM_PASSKEY_TYPE_DISPLAY
 0x02

80 

	)

86 
	#SM_AUTH_REQ_NO_BONDING
 0x00

87 
	#SM_AUTH_REQ_BONDING
 0x01

88 

	)

90 
	#PASSKEY_LEN
 6

91 

	)

92 
	#SM_AUTH_STATE_AUTHENTICATED
 0x04

93 
	#SM_AUTH_STATE_BONDING
 0x01

94 

	)

105 
oßl_evít_hdr_t
 
hdr
;

106 
uöt8
 
√wKey
[
KEYLEN
];

107 } 
	tsmNewR™dKeyEvít_t
;

114 
sEncKey
:1;

115 
sIdKey
:1;

116 
sSign
:1;

117 
mEncKey
:1;

118 
mIdKey
:1;

119 
mSign
:1;

120 
ª£rved
:2;

121 } 
	tkeyDi°_t
;

128 
uöt8
 
ioC≠s
;

129 
uöt8
 
oobAvaûabÀ
;

130 
uöt8
 
oob
[
KEYLEN
];

131 
uöt8
 
authReq
;

132 
keyDi°_t
 
keyDi°
;

133 
uöt8
 
maxEncKeySize
;

134 } 
	tsmLökSecurôyReq_t
;

141 
uöt8
 
…k
[
KEYLEN
];

142 
uöt16
 
div
;

143 
uöt8
 
ønd
[
B_RANDOM_NUM_SIZE
];

144 
uöt8
 
keySize
;

145 } 
	tsmSecurôyInfo_t
;

152 
uöt8
 
úk
[
KEYLEN
];

153 
uöt8
 
bd_addr
[
B_ADDR_LEN
];

154 } 
	tsmIdítôyInfo_t
;

161 
uöt8
 
§k
[
KEYLEN
];

162 
uöt32
 
signCou¡î
;

163 } 
	tsmSignögInfo_t
;

170 
b⁄dög
:2;

171 
môm
:1;

172 
ª£rved
:5;

173 } 
	tauthReq_t
;

194 
bSètus_t
 
SM_Inôüt‹Inô
( );

211 
bSètus_t
 
SM_SèπPaúög
–
uöt8
 
öôüt‹
,

212 
uöt8
 
èskID
,

213 
uöt16
 
c⁄√˘i⁄H™dÀ
,

214 
smLökSecurôyReq_t
 *
pSecReqs
 );

229 
bSètus_t
 
SM_SèπEn¸y±i⁄
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 *
pLTK
,

230 
uöt16
 
div
, 
uöt8
 *
pR™dNum
, uöt8 
keyLí
 );

242 
bSètus_t
 
SM_Re•⁄dîInô
( );

258 
bSètus_t
 
SM_NewR™dKey
–
uöt8
 
èskID
 );

269 
bSètus_t
 
SM_CÆcR™domAddr
–
uöt8
 *
pIRK
, uöt8 *
pNewAddr
 );

281 
bSètus_t
 
SM_ResﬁveR™domAddrs
–
uöt8
 *
pIRK
, uöt8 *
pAddr
 );

295 
bSètus_t
 
SM_En¸y±
–
uöt8
 *
pKey
, uöt8 *
pPœöText
, uöt8 *
pResu…
 );

308 
bSètus_t
 
SM_Gíî©eAuthíSig
–
uöt8
 *
pD©a
, uöt8 
Àn
, uöt8 *
pAuthíSig
 );

325 
bSètus_t
 
SM_VîifyAuthíSig
–
uöt16
 
c⁄nH™dÀ
,

326 
uöt8
 
authítiˇti⁄
,

327 
uöt8
 *
pD©a
,

328 
uöt8
 
Àn
,

329 
uöt8
 *
pAuthíSig
 );

341 
bSètus_t
 
SM_PasskeyUpd©e
–
uöt8
 *
pPasskey
, 
uöt16
 
c⁄√˘i⁄H™dÀ
 );

360 
SM_Inô
–
uöt8
 
èsk_id
 );

372 
uöt16
 
SM_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

377 #ifde‡
__˝lu•lus


	@Components/hal/common/hal_assert.c

45 
	~"hÆ_as£π.h
"

46 
	~"hÆ_ty≥s.h
"

47 
	~"hÆ_bﬂrd.h
"

48 
	~"hÆ_defs.h
"

49 
	~"hÆ_mcu.h
"

51 #i‡(
deföed
 
HAL_MCU_AVR
Ë|| (deföed 
HAL_MCU_CC2430
Ë|| (deföed 
HAL_MCU_CC2530
) || \

52 (
deföed
 
	gHAL_MCU_CC2533
Ë|| (deföed 
	gHAL_MCU_MSP430
)

54 
	~"mac_rx.h
"

55 
	~"mac_tx.h
"

62 
hÆAs£πHaz¨dLights
();

75 
	$hÆAs£πH™dÀr
()

78 #ifde‡
ASSERT_RESET


79 
	`HAL_SYSTEM_RESET
();

80 #ñi‡!
deföed
 
ASSERT_WHILE


81 
	`hÆAs£πHaz¨dLights
();

85 
	}
}

87 #i‡!
deföed
 
ASSERT_WHILE


98 
	$hÆAs£πHaz¨dLights
()

102 
DEBUG_DATA_RSTACK_HIGH_OFS
,

103 
DEBUG_DATA_RSTACK_LOW_OFS
,

104 
DEBUG_DATA_TX_ACTIVE_OFS
,

105 
DEBUG_DATA_RX_ACTIVE_OFS
,

107 #i‡(
deföed
 
HAL_MCU_AVR
Ë|| (deföed 
HAL_MCU_CC2430
)

108 
DEBUG_DATA_INT_MASK_OFS
,

109 #ñi‡(
deföed
 
HAL_MCU_CC2530
Ë|| (deföed 
HAL_MCU_CC2533
)

110 
DEBUG_DATA_INT_MASK0_OFS
,

111 
DEBUG_DATA_INT_MASK1_OFS
,

114 
DEBUG_DATA_SIZE


117 
uöt8
 
buâ⁄Hñd
;

118 
uöt8
 
debugD©a
[
DEBUG_DATA_SIZE
];

121 
	`HAL_DISABLE_INTERRUPTS
();

126 
	`HAL_BOARD_INIT
();

128 
	`HAL_TURN_OFF_LED1
();

129 
	`HAL_TURN_OFF_LED2
();

130 
	`HAL_TURN_OFF_LED3
();

131 
	`HAL_TURN_OFF_LED4
();

138 
buâ⁄Hñd
 = 0;

145 
	`HAL_LED_BLINK_DELAY
();

148 #i‡(
HAL_NUM_LEDS
 >= 1)

149 
	`HAL_TOGGLE_LED1
();

150 #i‡(
HAL_NUM_LEDS
 >= 2)

151 
	`HAL_TOGGLE_LED2
();

152 #i‡(
HAL_NUM_LEDS
 >= 3)

153 
	`HAL_TOGGLE_LED3
();

154 #i‡(
HAL_NUM_LEDS
 >= 4)

155 
	`HAL_TOGGLE_LED4
();

163 
uöt8
 
esˇ≥
 = 0;

164 i‡(
esˇ≥
)

166 
esˇ≥
 = 0;

172 i‡(
	`HAL_PUSH_BUTTON1
())

174 
buâ⁄Hñd
++;

178 
buâ⁄Hñd
 = 0;

181 
buâ⁄Hñd
 != 10);

188 
	`HAL_TURN_OFF_LED1
();

189 
	`HAL_TURN_OFF_LED2
();

190 
	`HAL_TURN_OFF_LED3
();

191 
	`HAL_TURN_OFF_LED4
();

194 
	`HAL_DEBOUNCE
(!
	`HAL_PUSH_BUTTON1
());

199 #ifde‡
HAL_MCU_AVR


201 
uöt8
 * 
pSèck
;

202 
pSèck
 = (
uöt8
 *Ë
SP
;

203 
pSèck
++;

204 
debugD©a
[
DEBUG_DATA_RSTACK_HIGH_OFS
] = *
pSèck
;

205 
pSèck
++;

206 
debugD©a
[
DEBUG_DATA_RSTACK_LOW_OFS
] = *
pSèck
;

208 
debugD©a
[
DEBUG_DATA_INT_MASK_OFS
] = 
EIMSK
;

211 #i‡(
deföed
 
HAL_MCU_CC2430
)

212 
debugD©a
[
DEBUG_DATA_INT_MASK_OFS
] = 
RFIM
;

213 #ñi‡(
deföed
 
HAL_MCU_CC2530
Ë|| (deföed 
HAL_MCU_CC2533
)

214 
debugD©a
[
DEBUG_DATA_INT_MASK0_OFS
] = 
RFIRQM0
;

215 
debugD©a
[
DEBUG_DATA_INT_MASK1_OFS
] = 
RFIRQM1
;

219 #i‡(
deföed
 
HAL_MCU_AVR
Ë|| (deföed 
HAL_MCU_CC2430
Ë|| (deföed 
HAL_MCU_CC2530
) || \

220 (
deföed
 
HAL_MCU_CC2533
Ë|| (deföed 
HAL_MCU_MSP430
)

221 
debugD©a
[
DEBUG_DATA_TX_ACTIVE_OFS
] = 
macTxA˘ive
;

222 
debugD©a
[
DEBUG_DATA_RX_ACTIVE_OFS
] = 
macRxA˘ive
;

227 
uöt8
 
iBô
;

228 
uöt8
 
iByã
;

230 
iBô
 = 0;

231 
iByã
 = 0;

236 
iByã
 < 
DEBUG_DATA_SIZE
)

239 !
	`HAL_PUSH_BUTTON1
());

242 
	`HAL_TURN_ON_LED1
();

243 
	`HAL_TURN_ON_LED2
();

244 
	`HAL_TURN_ON_LED3
();

245 i‡(
iBô
 == 0)

247 
	`HAL_TURN_ON_LED4
();

251 
	`HAL_TURN_OFF_LED4
();

255 
	`HAL_DEBOUNCE
(!
	`HAL_PUSH_BUTTON1
());

258 
	`HAL_TURN_OFF_LED1
();

259 
	`HAL_TURN_OFF_LED2
();

260 
	`HAL_TURN_OFF_LED3
();

261 
	`HAL_TURN_OFF_LED4
();

264 i‡(
debugD©a
[
iByã
] & (1 << (7 - 
iBô
)))

266 
	`HAL_TURN_ON_LED1
();

270 
	`HAL_TURN_OFF_LED1
();

274 
iBô
++;

275 i‡(
iBô
 == 8)

277 
iBô
 = 0;

278 
iByã
++;

288 
	`HAL_TURN_OFF_LED1
();

290 
	}
}

299 
HAL_ASSERT_SIZE
–
öt8
, 1);

300 
HAL_ASSERT_SIZE
–
uöt8
, 1);

301 
HAL_ASSERT_SIZE
–
öt16
, 2);

302 
HAL_ASSERT_SIZE
(
uöt16
, 2);

303 
HAL_ASSERT_SIZE
–
öt32
, 4);

304 
HAL_ASSERT_SIZE
(
uöt32
, 4);

	@Components/hal/common/hal_drivers.c

44 
	~"hÆ_adc.h
"

45 #i‡(
deföed
 
HAL_AES
Ë&& (HAL_AES =
TRUE
)

46 
	~"hÆ_´s.h
"

48 #i‡(
deföed
 
HAL_BUZZER
Ë&& (HAL_BUZZER =
TRUE
)

49 
	~"hÆ_buzzî.h
"

51 #i‡(
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
)

52 
	~"hÆ_dma.h
"

54 
	~"hÆ_drivîs.h
"

55 
	~"hÆ_key.h
"

56 
	~"hÆ_lcd.h
"

57 
	~"hÆ_Àd.h
"

58 
	~"hÆ_¶ìp.h
"

59 
	~"hÆ_timî.h
"

60 
	~"hÆ_ty≥s.h
"

61 
	~"hÆ_u¨t.h
"

62 #ifde‡
CC2591_COMPRESSION_WORKAROUND


63 
	~"mac_rx.h
"

65 
	~"OSAL.h
"

66 #i‡
deföed
 
POWER_SAVING


67 
	~"OSAL_PwrMgr.h
"

69 #i‡(
deföed
 
HAL_HID
Ë&& (HAL_HID =
TRUE
)

70 
	~"usb_hid.h
"

76 
uöt8
 
	gHÆ_TaskID
;

78 
HÆLedUpd©e
( );

89 
	$HÆ_Inô
–
uöt8
 
èsk_id
 )

92 
HÆ_TaskID
 = 
èsk_id
;

94 #ifde‡
CC2591_COMPRESSION_WORKAROUND


95 
	`oßl_°¨t_ªlﬂd_timî
–
HÆ_TaskID
, 
PERIOD_RSSI_RESET_EVT
, 
PERIOD_RSSI_RESET_TIMEOUT
 );

97 
	}
}

108 
	$HÆDrivîInô
 ()

111 #i‡(
deföed
 
HAL_TIMER
Ë&& (HAL_TIMER =
TRUE
)

115 #i‡(
deföed
 
HAL_ADC
Ë&& (HAL_ADC =
TRUE
)

116 
	`HÆAdcInô
();

120 #i‡(
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
)

122 
	`HÆDmaInô
();

126 #i‡(
deföed
 
HAL_AES
Ë&& (HAL_AES =
TRUE
)

127 
	`HÆAesInô
();

131 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

132 
	`HÆLcdInô
();

136 #i‡(
deföed
 
HAL_LED
Ë&& (HAL_LED =
TRUE
)

137 
	`HÆLedInô
();

141 #i‡(
deföed
 
HAL_UART
Ë&& (HAL_UART =
TRUE
)

142 
	`HÆUARTInô
();

146 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

147 
	`HÆKeyInô
();

151 #i‡(
deföed
 
HAL_HID
Ë&& (HAL_HID =
TRUE
)

152 
	`usbHidInô
();

154 
	}
}

166 
uöt16
 
	$HÆ_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

168 
uöt8
 *
msgPå
;

170 ()
èsk_id
;

172 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

174 
msgPå
 = 
	`oßl_msg_ª˚ive
(
HÆ_TaskID
);

176 
msgPå
)

181 
	`oßl_msg_dóŒoˇã
–
msgPå
 );

183 
msgPå
 = 
	`oßl_msg_ª˚ive
–
HÆ_TaskID
 );

185  
evíts
 ^ 
SYS_EVENT_MSG
;

188 #i‡(
deföed
 
HAL_BUZZER
Ë&& (HAL_BUZZER =
TRUE
)

189 i‡(
evíts
 & 
HAL_BUZZER_EVENT
)

191 
	`HÆBuzzîSt›
();

192  
evíts
 ^ 
HAL_BUZZER_EVENT
;

196 #ifde‡
CC2591_COMPRESSION_WORKAROUND


197 i‡–
evíts
 & 
PERIOD_RSSI_RESET_EVT
 )

199 
	`macRxRe£tRssi
();

200  (
evíts
 ^ 
PERIOD_RSSI_RESET_EVT
);

204 i‡–
evíts
 & 
HAL_LED_BLINK_EVENT
 )

206 #i‡(
	`deföed
 (
BLINK_LEDS
)Ë&& (
HAL_LED
 =
TRUE
)

207 
	`HÆLedUpd©e
();

209  
evíts
 ^ 
HAL_LED_BLINK_EVENT
;

212 i‡(
evíts
 & 
HAL_KEY_EVENT
)

214 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

216 
	`HÆKeyPﬁl
();

219 i‡(!
HÆ_KeyI¡E«bÀ
)

221 
	`oßl_°¨t_timîEx
–
HÆ_TaskID
, 
HAL_KEY_EVENT
, 100);

224  
evíts
 ^ 
HAL_KEY_EVENT
;

227 #i‡
deföed
 
POWER_SAVING


228 i‡–
evíts
 & 
HAL_SLEEP_TIMER_EVENT
 )

230 
	`hÆRe°‹eSÀïLevñ
();

231  
evíts
 ^ 
HAL_SLEEP_TIMER_EVENT
;

234 i‡–
evíts
 & 
HAL_PWRMGR_HOLD_EVENT
 )

236 ()
	`oßl_pwrmgr_èsk_°©e
(
HÆ_TaskID
, 
PWRMGR_HOLD
);

238 ()
	`oßl_°›_timîEx
(
HÆ_TaskID
, 
HAL_PWRMGR_CONSERVE_EVENT
);

239 ()
	`oßl_˛ór_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_CONSERVE_EVENT
);

241  (
evíts
 & ~(
HAL_PWRMGR_HOLD_EVENT
 | 
HAL_PWRMGR_CONSERVE_EVENT
));

244 i‡–
evíts
 & 
HAL_PWRMGR_CONSERVE_EVENT
 )

246 ()
	`oßl_pwrmgr_èsk_°©e
(
HÆ_TaskID
, 
PWRMGR_CONSERVE
);

247  
evíts
 ^ 
HAL_PWRMGR_CONSERVE_EVENT
;

252 
	}
}

263 
	$HÆ_Pro˚ssPﬁl
 ()

266 #i‡(
deföed
 
HAL_UART
Ë&& (HAL_UART =
TRUE
)

267 
	`HÆUARTPﬁl
();

271 #i‡(
deföed
 
HAL_HID
Ë&& (HAL_HID =
TRUE
)

272 
	`usbHidPro˚ssEvíts
();

275 #i‡
	`deföed
–
POWER_SAVING
 )

277 
	`ALLOW_SLEEP_MODE
();

279 
	}
}

	@Components/hal/include/hal_adc.h

40 #i‚de‡
HAL_ADC_H


41 
	#HAL_ADC_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"hÆ_ty≥s.h
"

53 
	~"hÆ_bﬂrd.h
"

60 
	#HAL_ADC_RESOLUTION_8
 0x01

	)

61 
	#HAL_ADC_RESOLUTION_10
 0x02

	)

62 
	#HAL_ADC_RESOLUTION_12
 0x03

	)

63 
	#HAL_ADC_RESOLUTION_14
 0x04

	)

66 
	#HAL_ADC_CHANNEL_0
 0x00

	)

67 
	#HAL_ADC_CHANNEL_1
 0x01

	)

68 
	#HAL_ADC_CHANNEL_2
 0x02

	)

69 
	#HAL_ADC_CHANNEL_3
 0x03

	)

70 
	#HAL_ADC_CHANNEL_4
 0x04

	)

71 
	#HAL_ADC_CHANNEL_5
 0x05

	)

72 
	#HAL_ADC_CHANNEL_6
 0x06

	)

73 
	#HAL_ADC_CHANNEL_7
 0x07

	)

75 
	#HAL_ADC_CHN_AIN0
 0x00

	)

76 
	#HAL_ADC_CHN_AIN1
 0x01

	)

77 
	#HAL_ADC_CHN_AIN2
 0x02

	)

78 
	#HAL_ADC_CHN_AIN3
 0x03

	)

79 
	#HAL_ADC_CHN_AIN4
 0x04

	)

80 
	#HAL_ADC_CHN_AIN5
 0x05

	)

81 
	#HAL_ADC_CHN_AIN6
 0x06

	)

82 
	#HAL_ADC_CHN_AIN7
 0x07

	)

83 
	#HAL_ADC_CHN_A0A1
 0x08

	)

84 
	#HAL_ADC_CHN_A2A3
 0x09

	)

85 
	#HAL_ADC_CHN_A4A5
 0x0®

	)

86 
	#HAL_ADC_CHN_A6A7
 0x0b

	)

87 
	#HAL_ADC_CHN_GND
 0x0¯

	)

88 
	#HAL_ADC_CHN_VREF
 0x0d

	)

89 
	#HAL_ADC_CHN_TEMP
 0x0ê

	)

90 
	#HAL_ADC_CHN_VDD3
 0x0‡

	)

91 
	#HAL_ADC_CHN_BITS
 0x0‡

	)

93 
	#HAL_ADC_CHANNEL_TEMP
 
HAL_ADC_CHN_TEMP


	)

94 
	#HAL_ADC_CHANNEL_VDD
 
HAL_ADC_CHN_VDD3


	)

97 
	#HAL_ADC_VDD_LIMIT_0
 0x00

	)

98 
	#HAL_ADC_VDD_LIMIT_1
 0x01

	)

99 
	#HAL_ADC_VDD_LIMIT_2
 0x02

	)

100 
	#HAL_ADC_VDD_LIMIT_3
 0x03

	)

101 
	#HAL_ADC_VDD_LIMIT_4
 0x04

	)

102 
	#HAL_ADC_VDD_LIMIT_5
 0x05

	)

103 
	#HAL_ADC_VDD_LIMIT_6
 0x06

	)

104 
	#HAL_ADC_VDD_LIMIT_7
 0x07

	)

107 
	#HAL_ADC_REF_125V
 0x00

	)

108 
	#HAL_ADC_REF_AIN7
 0x40

	)

109 
	#HAL_ADC_REF_AVDD
 0x80

	)

110 
	#HAL_ADC_REF_DIFF
 0xc0

	)

111 
	#HAL_ADC_REF_BITS
 0xc0

	)

120 
HÆAdcInô
 ( );

125 
uöt16
 
HÆAdcRód
 ( 
uöt8
 
ch™√l
, uöt8 
ªsﬁuti⁄
 );

130 
HÆAdcSëRe„ªn˚
 ( 
uöt8
 
ª„ªn˚
 );

135 
boﬁ
 
HÆAdcCheckVdd
(
uöt8
 
vdd
);

140 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_assert.h

40 #i‚de‡
HAL_ASSERT_H


41 
	#HAL_ASSERT_H


	)

67 #ifde‡
HALNODEBUG


68 
	#HAL_ASSERT
(
ex¥
)

	)

69 
	#HAL_ASSERT_FORCED
()

	)

70 
	#HAL_ASSERT_STATEMENT
(
°©emít
)

	)

71 
	#HAL_ASSERT_DECLARATION
(
de˛¨©i⁄
)

	)

73 
	#HAL_ASSERT
(
ex¥
Ë
	`°
–i‡(!–ex¥ )Ë
	`hÆAs£πH™dÀr
(); )

	)

74 
	#HAL_ASSERT_FORCED
(Ë
	`hÆAs£πH™dÀr
()

	)

75 
	#HAL_ASSERT_STATEMENT
(
°©emít
Ë
	`°
–°©emíà)

	)

76 
	#HAL_ASSERT_DECLARATION
(
de˛¨©i⁄
Ë
	)
declaration

91 
	#HAL_ASSERT_SIZE
(
x
,
y
Ë
	tx
 ## 
	t_as£π_size_t
[-1+10*((xË=(y))]

	)

98 
	thÆAs£πH™dÀr
();

109 
hÆAs£πHaz¨dLights
();

	@Components/hal/include/hal_board.h

1 
	~"hÆ_bﬂrd_cfg.h
"

	@Components/hal/include/hal_defs.h

40 #i‚de‡
HAL_DEFS_H


41 
	#HAL_DEFS_H


	)

49 #i‚de‡
BV


50 
	#BV
(
n
Ë(1 << (n))

	)

53 #i‚de‡
BF


54 
	#BF
(
x
,
b
,
s
Ë(((xË& (b)Ë>> (s))

	)

57 #i‚de‡
MIN


58 
	#MIN
(
n
,
m
Ë((“Ë< (m)Ë? (nË: (m))

	)

61 #i‚de‡
MAX


62 
	#MAX
(
n
,
m
Ë((“Ë< (m)Ë? (mË: (n))

	)

65 #i‚de‡
ABS


66 
	#ABS
(
n
Ë((“Ë< 0Ë? -“Ë: (n))

	)

71 
	#BREAK_UINT32
–
v¨
, 
ByãNum
 ) \

72 (
uöt8
)((
uöt32
)(((
v¨
Ë>>((
ByãNum
Ë* 8)Ë& 0x00FF))

	)

74 
	#BUILD_UINT32
(
Byã0
, 
Byã1
, 
Byã2
, 
Byã3
) \

75 ((
uöt32
)((uöt32)((
Byã0
) & 0x00FF) \

76 + ((
uöt32
)((
Byã1
) & 0x00FF) << 8) \

77 + ((
uöt32
)((
Byã2
) & 0x00FF) << 16) \

78 + ((
uöt32
)((
Byã3
Ë& 0x00FFË<< 24)))

	)

80 
	#BUILD_UINT16
(
loByã
, 
hiByã
) \

81 ((
uöt16
)(((
loByã
Ë& 0x00FFË+ (((
hiByã
Ë& 0x00FFË<< 8)))

	)

83 
	#HI_UINT16
(
a
Ë((◊Ë>> 8Ë& 0xFF)

	)

84 
	#LO_UINT16
(
a
Ë(◊Ë& 0xFF)

	)

86 
	#BUILD_UINT8
(
hiByã
, 
loByã
) \

87 ((
uöt8
)(((
loByã
Ë& 0x0FË+ (((
hiByã
Ë& 0x0FË<< 4)))

	)

89 
	#HI_UINT8
(
a
Ë((◊Ë>> 4Ë& 0x0F)

	)

90 
	#LO_UINT8
(
a
Ë(◊Ë& 0x0F)

	)

92 #i‚de‡
GET_BIT


93 
	#GET_BIT
(
DISCS
, 
IDX
Ë(((DISCS)[((IDXË/ 8)] & 
	`BV
((IDXË% 8)Ë? 
TRUE
 : 
FALSE
)

	)

95 #i‚de‡
SET_BIT


96 
	#SET_BIT
(
DISCS
, 
IDX
Ë(((DISCS)[((IDXË/ 8)] |
	`BV
((IDXË% 8)))

	)

98 #i‚de‡
CLR_BIT


99 
	#CLR_BIT
(
DISCS
, 
IDX
Ë(((DISCS)[((IDXË/ 8)] &(
	`BV
((IDXË% 8Ë^ 0xFF)))

	)

125 
	#°
(
x
Ëdÿ{ x } 
__LINE__
 =-1)

	)

	@Components/hal/include/hal_drivers.h

39 #i‚de‡
HAL_DRIVER_H


40 
	#HAL_DRIVER_H


	)

42 #ifde‡
__˝lu•lus


51 
	~"hÆ_ty≥s.h
"

57 
	#HAL_BUZZER_EVENT
 0x0080

	)

58 
	#PERIOD_RSSI_RESET_EVT
 0x0040

	)

59 
	#HAL_LED_BLINK_EVENT
 0x0020

	)

60 
	#HAL_KEY_EVENT
 0x0010

	)

62 #i‡
deföed
 
POWER_SAVING


63 
	#HAL_SLEEP_TIMER_EVENT
 0x0004

	)

64 
	#HAL_PWRMGR_HOLD_EVENT
 0x0002

	)

65 
	#HAL_PWRMGR_CONSERVE_EVENT
 0x0001

	)

68 
	#HAL_PWRMGR_CONSERVE_DELAY
 10

	)

69 
	#PERIOD_RSSI_RESET_TIMEOUT
 10

	)

75 
uöt8
 
HÆ_TaskID
;

81 
HÆ_Inô
 ( 
uöt8
 
èsk_id
 );

86 
uöt16
 
HÆ_Pro˚ssEvít
 ( 
uöt8
 
èsk_id
, uöt16 
evíts
 );

91 
HÆ_Pro˚ssPﬁl
 ();

96 
HÆDrivîInô
 ();

98 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_flash.h

40 #i‚de‡
HAL_FLASH_H


41 
	#HAL_FLASH_H


	)

43 #ifde‡
__˝lu•lus


53 
	~"hÆ_bﬂrd.h
"

54 
	~"hÆ_ty≥s.h
"

75 
HÆFœshRód
(
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
buf
, uöt16 
˙t
);

95 
HÆFœshWrôe
(
uöt16
 
addr
, 
uöt8
 *
buf
, uöt16 
˙t
);

113 
HÆFœshEø£
(
uöt8
 
pg
);

115 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_key.h

40 #i‚de‡
HAL_KEY_H


41 
	#HAL_KEY_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"hÆ_bﬂrd.h
"

62 
	#HAL_KEY_INTERRUPT_DISABLE
 0x00

	)

63 
	#HAL_KEY_INTERRUPT_ENABLE
 0x01

	)

66 
	#HAL_KEY_STATE_NORMAL
 0x00

	)

67 
	#HAL_KEY_STATE_SHIFT
 0x01

	)

69 
	#HAL_KEY_SW_1
 0x01

70 
	#HAL_KEY_SW_2
 0x02

71 
	#HAL_KEY_SW_5
 0x04

72 
	#HAL_KEY_SW_4
 0x08

73 
	#HAL_KEY_SW_3
 0x10

74 

	)

75 
	#HAL_KEY_SW_6
 0x20

76 
	#HAL_KEY_SW_7
 0x40

77 

	)

79 
	#HAL_KEY_UP
 0x01

80 
	#HAL_KEY_RIGHT
 0x02

81 
	#HAL_KEY_CENTER
 0x04

82 
	#HAL_KEY_LEFT
 0x08

83 
	#HAL_KEY_DOWN
 0x10

84 

	)

86 
	#HAL_PUSH_BUTTON_RIGHT
 0x01

87 
	#HAL_PUSH_BUTTON_LEFT
 0x02

88 
	#HAL_PUSH_BUTTON_SELECT
 0x04

89 
	#HAL_KEY_BUTTON_UP
 0x40

90 
	#HAL_KEY_BUTTON_DOWN
 0x80

91 

	)

95 (*
hÆKeyCBack_t
Ë(
	tuöt8
 
	tkeys
, uöt8 
	t°©e
);

100 
boﬁ
 
HÆ_KeyI¡E«bÀ
;

109 
HÆKeyInô
( );

114 
HÆKeyC⁄fig
–
boﬁ
 
öãºu±E«bÀ
, c⁄° 
hÆKeyCBack_t
 
cback
);

119 
uöt8
 
HÆKeyRód
( );

124 
HÆKeyE¡îSÀï
 ( );

129 
uöt8
 
HÆKeyExôSÀï
 ( );

134 
HÆKeyPﬁl
 ( );

139 
boﬁ
 
HÆKeyPªs£d
( );

141 
uöt8
 
hÆ_key_keys
();

143 
uöt8
 
hÆ_key_öt_keys
();

148 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_lcd.h

40 #i‚de‡
HAL_LCD_H


41 
	#HAL_LCD_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"hÆ_bﬂrd.h
"

52 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

60 
	#HAL_LCD_LINE_1
 0x01

	)

61 
	#HAL_LCD_LINE_2
 0x02

	)

66 
	#HAL_LCD_LINE_3
 0x03

	)

67 
	#HAL_LCD_LINE_4
 0x04

	)

68 
	#HAL_LCD_LINE_5
 0x05

	)

69 
	#HAL_LCD_LINE_6
 0x06

	)

70 
	#HAL_LCD_LINE_7
 0x07

	)

71 
	#HAL_LCD_LINE_8
 0x08

	)

95 
HÆLcdInô
();

100 
HÆLcdWrôeSåög
 ( *
°r
, 
uöt8
 
›ti⁄
);

105 
HÆLcdWrôeVÆue
 ( 
uöt32
 
vÆue
, c⁄° 
uöt8
 
ødix
, uöt8 
›ti⁄
);

110 
HÆLcdWrôeS¸ìn
–*
löe1
, *
löe2
 );

115 
HÆLcdWrôeSåögVÆue
–*
tôÀ
, 
uöt16
 
vÆue
, 
uöt8
 
f‹m©
, uöt8 
löe
 );

120 
HÆLcdWrôeSåögVÆueVÆue
–*
tôÀ
, 
uöt16
 
vÆue1
, 
uöt8
 
f‹m©1
, uöt16 
vÆue2
, uöt8 
f‹m©2
, uöt8 
löe
 );

125 
HÆLcdDi•œyPî˚¡B¨
–*
tôÀ
, 
uöt8
 
vÆue
 );

131 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_led.h

40 #i‚de‡
HAL_LED_H


41 
	#HAL_LED_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"hÆ_bﬂrd.h
"

62 
	#HAL_LED_1
 0x01

	)

63 
	#HAL_LED_2
 0x02

	)

64 
	#HAL_LED_3
 0x04

	)

65 
	#HAL_LED_4
 0x08

	)

66 
	#HAL_LED_ALL
 (
HAL_LED_1
 | 
HAL_LED_2
 | 
HAL_LED_3
 | 
HAL_LED_4
)

	)

69 
	#HAL_LED_MODE_OFF
 0x00

	)

70 
	#HAL_LED_MODE_ON
 0x01

	)

71 
	#HAL_LED_MODE_BLINK
 0x02

	)

72 
	#HAL_LED_MODE_FLASH
 0x04

	)

73 
	#HAL_LED_MODE_TOGGLE
 0x08

	)

76 
	#HAL_LED_DEFAULT_MAX_LEDS
 4

	)

77 
	#HAL_LED_DEFAULT_DUTY_CYCLE
 5

	)

78 
	#HAL_LED_DEFAULT_FLASH_COUNT
 50

	)

79 
	#HAL_LED_DEFAULT_FLASH_TIME
 1000

	)

93 
HÆLedInô
( );

98 
uöt8
 
HÆLedSë
–uöt8 
Àd
, uöt8 
mode
 );

103 
HÆLedBlök
–
uöt8
 
Àds
, uöt8 
˙t
, uöt8 
duty
, 
uöt16
 
time
 );

108 
HÆLedE¡îSÀï
( );

113 
HÆLedExôSÀï
( );

118 
uöt8
 
HÆLedGëSèã
 ( );

123 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_rpc.h

40 #i‚de‡
HAL_RPC_H


41 
	#HAL_RPC_H


	)

43 #ifde‡
__˝lu•lus


62 
	#RPC_CMD_POLL
 0x00

	)

63 
	#RPC_CMD_SREQ
 0x20

	)

64 
	#RPC_CMD_AREQ
 0x40

	)

65 
	#RPC_CMD_SRSP
 0x60

	)

66 
	#RPC_CMD_RES4
 0x80

	)

67 
	#RPC_CMD_RES5
 0xA0

	)

68 
	#RPC_CMD_RES6
 0xC0

	)

69 
	#RPC_CMD_RES7
 0xE0

	)

72 
	#RPC_SYS_RES0
 0

	)

73 
	#RPC_SYS_SYS
 1

	)

74 
	#RPC_SYS_MAC
 2

	)

75 
	#RPC_SYS_NWK
 3

	)

76 
	#RPC_SYS_AF
 4

	)

77 
	#RPC_SYS_ZDO
 5

	)

78 
	#RPC_SYS_SAPI
 6

79 
	#RPC_SYS_UTIL
 7

	)

80 
	#RPC_SYS_DBG
 8

	)

81 
	#RPC_SYS_APP
 9

	)

82 
	#RPC_SYS_RCAF
 10

83 
	#RPC_SYS_RCN
 11

84 
	#RPC_SYS_RCN_CLIENT
 12

85 
	#RPC_SYS_BOOT
 13

86 
	#RPC_SYS_MAX
 14

87 

	)

89 
	#RPC_FRAME_HDR_SZ
 3

	)

92 
	#RPC_CMD_TYPE_MASK
 0xE0

	)

95 
	#RPC_SUBSYSTEM_MASK
 0x1F

	)

98 
	#RPC_POS_LEN
 0

	)

99 
	#RPC_POS_CMD0
 1

	)

100 
	#RPC_POS_CMD1
 2

	)

101 
	#RPC_POS_DAT0
 3

	)

104 
	#RPC_SUCCESS
 0

	)

105 
	#RPC_ERR_SUBSYSTEM
 1

	)

106 
	#RPC_ERR_COMMAND_ID
 2

	)

107 
	#RPC_ERR_PARAMETER
 3

	)

108 
	#RPC_ERR_LENGTH
 4

	)

114 
	#RPC_UART_FRAME_OVHD
 2

	)

117 
	#RPC_UART_SOF
 0xFE

	)

132 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_sleep.h

40 #i‚de‡
HAL_SLEEP_H


41 
	#HAL_SLEEP_H


	)

43 #ifde‡
__˝lu•lus


55 
hÆSÀï
–
uöt32
 
oßl_timî
 );

60 
hÆSÀïWaô
(
uöt16
 
duøti⁄
);

65 
hÆRe°‹eSÀïLevñ
( );

70 
hÆSÀïExô
();

75 
hÆSëMaxSÀïLo›Time
(
uöt32
 
rﬁlovîTime
);

80 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_timer.h

40 #i‚de‡
HAL_TIMER_H


41 
	#HAL_TIMER_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"hÆ_bﬂrd.h
"

63 
	#HAL_TIMER_0
 0x00

64 
	#HAL_TIMER_1
 0x01

65 
	#HAL_TIMER_2
 0x02

66 
	#HAL_TIMER_3
 0x03

67 
	#HAL_TIMER_MAX
 4

68 

	)

70 
	#HAL_TIMER_MODE_NORMAL
 0x01

71 
	#HAL_TIMER_MODE_CTC
 0x02

72 
	#HAL_TIMER_MODE_MASK
 (
HAL_TIMER_MODE_NORMAL
 | 
HAL_TIMER_MODE_CTC
)

	)

75 
	#HAL_T1_CH0
 0

	)

76 
	#HAL_T1_CH1
 1

	)

77 
	#HAL_T1_CH2
 2

	)

78 
	#HAL_T1_CH3
 3

	)

79 
	#HAL_T1_CH4
 4

	)

82 
	#HAL_TIMER_CHANNEL_SINGLE
 0x01

83 
	#HAL_TIMER_CHANNEL_A
 0x02

84 
	#HAL_TIMER_CHANNEL_B
 0x04

85 
	#HAL_TIMER_CHANNEL_C
 0x08

86 
	#HAL_TIMER_CHANNEL_D
 0x10

87 
	#HAL_TIMER_CHANNEL_E
 0x20

88 
	#HAL_TIMER_CHANNEL_MASK
 (
HAL_TIMER_CHANNEL_SINGLE
 | \

89 
HAL_TIMER_CHANNEL_A
 | \

90 
HAL_TIMER_CHANNEL_B
 | \

91 
HAL_TIMER_CHANNEL_C
 | \

92 
HAL_TIMER_CHANNEL_D
 | \

93 
HAL_TIMER_CHANNEL_E
)

	)

94 
	#HAL_TIMER_CH_MAX
 0x06

	)

97 
	#HAL_TIMER1_CH0_CMP_MODE_SET_ON_COMP
 0x00

98 
	#HAL_TIMER1_CH0_CMP_MODE_CLR_ON_COMP
 0x01

99 
	#HAL_TIMER1_CH0_CMP_MODE_TOG_ON_COMP
 0x02

100 
	#HAL_TIMER1_CH0_CMP_MODE_SET_ON_COMP_CLR_ON_0
 0x03

101 
	#HAL_TIMER1_CH0_CMP_MODE_CLR_ON_COMP_SET_ON_0
 0x04

102 
	#HAL_TIMER1_CH0_CMP_MODE_INIT
 0x07

103 

	)

105 
	#HAL_TIMER1_CHn_CMP_MODE_SET_ON_COMP
 0x00

106 
	#HAL_TIMER1_CHn_CMP_MODE_CLR_ON_COMP
 0x01

107 
	#HAL_TIMER1_CHn_CMP_MODE_TOG_ON_COMP
 0x02

108 
	#HAL_TIMER1_CHn_CMP_MODE_SET_ON_COMP_CLR_ON_0
 0x03

110 
	#HAL_TIMER1_CHn_CMP_MODE_CLR_ON_COMP_SET_ON_0
 0x04

112 
	#HAL_TIMER1_CHn_CMP_MODE_CLR_ON_CH0_SET_ON_CHn
 0x05

113 
	#HAL_TIMER1_CHn_CMP_MODE_SET_ON_CH0_CLR_ON_CHn
 0x06

114 
	#HAL_TIMER1_CHn_CMP_MODE_INIT
 0x07

115 
	#HAL_TIMER1_CH_CMP_MODE_BITS
 0x38

116 

	)

118 
	#HAL_TIMER1_CH_CAP_MODE_NO
 0x00

119 
	#HAL_TIMER1_CH_CAP_MODE_RISING
 0x01

120 
	#HAL_TIMER1_CH_CAP_MODE_FALLING
 0x02

121 
	#HAL_TIMER1_CH_CAP_MODE_ALL
 0x03

122 
	#HAL_TIMER1_CH_CAP_BITS
 0x03

123 

	)

125 
	#HAL_TIMER_CH_MODE_INPUT_CAPTURE
 0x01

126 
	#HAL_TIMER_CH_MODE_OUTPUT_COMPARE
 0x02

127 
	#HAL_TIMER_CH_MODE_OVERFLOW
 0x04

128 
	#HAL_TIMER_CH_MODE_MASK
 (
HAL_TIMER_CH_MODE_INPUT_CAPTURE
 | \

129 
HAL_TIMER_CH_MODE_OUTPUT_COMPARE
 | \

130 
HAL_TIMER_CH_MODE_OVERFLOW
)

	)

133 
	#HAL_TIMER_OK
 0x00

	)

134 
	#HAL_TIMER_NOT_OK
 0x01

	)

135 
	#HAL_TIMER_PARAMS_ERROR
 0x02

	)

136 
	#HAL_TIMER_NOT_CONFIGURED
 0x03

	)

137 
	#HAL_TIMER_INVALID_ID
 0x04

	)

138 
	#HAL_TIMER_INVALID_CH_MODE
 0x05

	)

139 
	#HAL_TIMER_INVALID_OP_MODE
 0x06

	)

142 
	#HAL_TIMER3_16_TC_STOP
 0x00

143 
	#HAL_TIMER3_16_TC_DIV1
 0x01

144 
	#HAL_TIMER3_16_TC_DIV8
 0x02

145 
	#HAL_TIMER3_16_TC_DIV64
 0x03

146 
	#HAL_TIMER3_16_TC_DIV256
 0x04

147 
	#HAL_TIMER3_16_TC_DIV1024
 0x05

148 
	#HAL_TIMER3_16_TC_EXTFE
 0x06

149 
	#HAL_TIMER3_16_TC_EXTRE
 0x07

150 

	)

152 
	#HAL_TIMER0_8_TC_STOP
 0x00

153 
	#HAL_TIMER0_8_TC_DIV1
 0x01

154 
	#HAL_TIMER0_8_TC_DIV8
 0x02

155 
	#HAL_TIMER0_8_TC_DIV32
 0x03

156 
	#HAL_TIMER0_8_TC_DIV64
 0x04

157 
	#HAL_TIMER0_8_TC_DIV128
 0x05

158 
	#HAL_TIMER0_8_TC_DIV256
 0x06

159 
	#HAL_TIMER0_8_TC_DIV1024
 0x07

160 

	)

162 
	#HAL_TIMER2_8_TC_STOP
 0x00

163 
	#HAL_TIMER2_8_TC_DIV1
 0x01

164 
	#HAL_TIMER2_8_TC_DIV8
 0x02

165 
	#HAL_TIMER2_8_TC_DIV64
 0x03

166 
	#HAL_TIMER2_8_TC_DIV256
 0x04

167 
	#HAL_TIMER2_8_TC_DIV1024
 0x05

168 
	#HAL_TIMER2_8_TC_EXTFE
 0x06

169 
	#HAL_TIMER2_8_TC_EXTRE
 0x07

170 

	)

175 (*
hÆTimîCBack_t
Ë(
	tuöt8
 
	ttimîId
, uöt8 
	tch™√l
, uöt8 
	tch™√lMode
);

189 
HÆTimîInô
 ( );

194 
uöt8
 
HÆTimîC⁄fig
 ( uöt8 
timîId
,

195 
uöt8
 
›Mode
,

196 
uöt8
 
ch™√l
,

197 
uöt8
 
ch™√lMode
,

198 
boﬁ
 
ötE«bÀ
,

199 
hÆTimîCBack_t
 
cback
 );

204 
uöt8
 
HÆTimîSèπ
 ( uöt8 
timîId
, 
uöt32
 
timePîTick
 );

209 
uöt8
 
HÆTimîSt›
 ( uöt8 
timîId
 );

215 
HÆTimîTick
 ( );

220 
uöt8
 
HÆTimîI¡îru±E«bÀ
 (uöt8 
timîId
, uöt8 
ch™√lMode
, 
boﬁ
 
íabÀ
);

225 
HÆTimî1Inô
 (
hÆTimîCBack_t
 
cBack
);

231 
hÆTimî1SëCh™√lDuty
 (
uöt8
 
ch™√l
, 
uöt16
 
¥omûl
);

236 #ifde‡
__˝lu•lus


	@Components/hal/include/hal_uart.h

40 #i‚de‡
HAL_UART_H


41 
	#HAL_UART_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"hÆ_bﬂrd.h
"

68 
	#HAL_UART_BR_9600
 0x00

	)

69 
	#HAL_UART_BR_19200
 0x01

	)

70 
	#HAL_UART_BR_38400
 0x02

	)

71 
	#HAL_UART_BR_57600
 0x03

	)

72 
	#HAL_UART_BR_115200
 0x04

	)

77 
	#HAL_UART_ONE_STOP_BIT
 0x00

	)

78 
	#HAL_UART_TWO_STOP_BITS
 0x01

	)

81 
	#HAL_UART_NO_PARITY
 0x00

	)

82 
	#HAL_UART_EVEN_PARITY
 0x01

	)

83 
	#HAL_UART_ODD_PARITY
 0x02

	)

86 
	#HAL_UART_8_BITS_PER_CHAR
 0x00

	)

87 
	#HAL_UART_9_BITS_PER_CHAR
 0x01

	)

90 
	#HAL_UART_FLOW_OFF
 0x00

	)

91 
	#HAL_UART_FLOW_ON
 0x01

	)

94 
	#HAL_UART_PORT_0
 0x00

	)

95 
	#HAL_UART_PORT_1
 0x01

	)

96 
	#HAL_UART_PORT_MAX
 0x02

	)

99 
	#HAL_UART_SUCCESS
 0x00

	)

100 
	#HAL_UART_UNCONFIGURED
 0x01

	)

101 
	#HAL_UART_NOT_SUPPORTED
 0x02

	)

102 
	#HAL_UART_MEM_FAIL
 0x03

	)

103 
	#HAL_UART_BAUDRATE_ERROR
 0x04

	)

106 
	#HAL_UART_RX_FULL
 0x01

	)

107 
	#HAL_UART_RX_ABOUT_FULL
 0x02

	)

108 
	#HAL_UART_RX_TIMEOUT
 0x04

	)

109 
	#HAL_UART_TX_FULL
 0x08

	)

110 
	#HAL_UART_TX_EMPTY
 0x10

	)

116 (*
hÆUARTCBack_t
Ë(
	tuöt8
 
	tp‹t
, uöt8 
	tevít
);

121 vﬁ©ûê
uöt16
 
buf„rHód
;

122 vﬁ©ûê
uöt16
 
buf„rTaû
;

123 
uöt16
 
maxBufSize
;

124 
uöt8
 *
pBuf„r
;

125 } 
	thÆUARTBufC⁄åﬁ_t
;

129 
boﬁ
 
c⁄figuªd
;

130 
uöt8
 
baudR©e
;

131 
boﬁ
 
ÊowC⁄åﬁ
;

132 
uöt16
 
ÊowC⁄åﬁThªshﬁd
;

133 
uöt8
 
idÀTimeout
;

134 
hÆUARTBufC⁄åﬁ_t
 
rx
;

135 
hÆUARTBufC⁄åﬁ_t
 
tx
;

136 
boﬁ
 
ötE«bÀ
;

137 
uöt32
 
rxChRvdTime
;

138 
hÆUARTCBack_t
 
ˇŒBackFunc
;

139 }
	thÆUARTCfg_t
;

143 
boﬁ
 
∑ømCTS
;

144 
boﬁ
 
∑ømRTS
;

145 
boﬁ
 
∑ømDSR
;

146 
boﬁ
 
∑ømDTR
;

147 
boﬁ
 
∑ømCD
;

148 
boﬁ
 
∑ømRI
;

149 
uöt16
 
baudR©e
;

150 
boﬁ
 
ÊowC⁄åﬁ
;

151 
boﬁ
 
ÊushC⁄åﬁ
;

152 }
	thÆUARTIo˘l_t
;

166 
HÆUARTInô
 ( );

171 
uöt8
 
HÆUARTO≥n
 ( uöt8 
p‹t
, 
hÆUARTCfg_t
 *
c⁄fig
 );

176 
HÆUARTClo£
 ( 
uöt8
 
p‹t
 );

181 
uöt16
 
HÆUARTRód
 ( 
uöt8
 
p‹t
, uöt8 *
pBuf„r
, uöt16 
Àngth
 );

186 
uöt16
 
HÆUARTWrôe
 ( 
uöt8
 
p‹t
, uöt8 *
pBuf„r
, uöt16 
Àngth
 );

191 
uöt8
 
HÆUARTIo˘l
 ( uöt8 
p‹t
, uöt8 
cmd
, 
hÆUARTIo˘l_t
 *
pIo˘l
 );

196 
HÆUARTPﬁl
( );

201 
uöt16
 
HÆ_UART_RxBufLí
 ( 
uöt8
 
p‹t
 );

206 
uöt16
 
HÆ_UART_TxBufLí
 ( 
uöt8
 
p‹t
 );

211 
HÆ_UART_FlowC⁄åﬁSë
 ( 
uöt8
 
p‹t
, 
boﬁ
 
°©us
 );

216 
uöt8
 
HÆUART_HW_Inô
(uöt8 
p‹t
);

221 
HÆUARTSu•íd
();

226 
HÆUARTResume
();

231 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2540EB/_hal_uart_dma.c

50 
	~<°rög.h
>

52 
	~"hÆ_as£π.h
"

53 
	~"hÆ_bﬂrd.h
"

54 
	~"hÆ_defs.h
"

55 
	~"hÆ_dma.h
"

56 
	~"hÆ_mcu.h
"

57 
	~"hÆ_ty≥s.h
"

58 
	~"hÆ_u¨t.h
"

66 
	#CSR_MODE
 0x80

	)

67 
	#CSR_RE
 0x40

	)

68 
	#CSR_SLAVE
 0x20

	)

69 
	#CSR_FE
 0x10

	)

70 
	#CSR_ERR
 0x08

	)

71 
	#CSR_RX_BYTE
 0x04

	)

72 
	#CSR_TX_BYTE
 0x02

	)

73 
	#CSR_ACTIVE
 0x01

	)

76 
	#UCR_FLUSH
 0x80

	)

77 
	#UCR_FLOW
 0x40

	)

78 
	#UCR_D9
 0x20

	)

79 
	#UCR_BIT9
 0x10

	)

80 
	#UCR_PARITY
 0x08

	)

81 
	#UCR_SPB
 0x04

	)

82 
	#UCR_STOP
 0x02

	)

83 
	#UCR_START
 0x01

	)

85 
	#UTX0IE
 0x04

	)

86 
	#UTX1IE
 0x08

	)

88 
	#P2DIR_PRIPO
 0xC0

	)

90 
	#HAL_DMA_U0DBUF
 0x70C1

	)

91 
	#HAL_DMA_U1DBUF
 0x70F9

	)

93 #unde‡
UxCSR


94 #unde‡
UxUCR


95 #unde‡
UxDBUF


96 #unde‡
UxBAUD


97 #unde‡
UxGCR


98 #unde‡
UTXxIE


99 #unde‡
UTXxIF


100 #i‡ (
HAL_UART_DMA
 == 1)

101 
	#UxCSR
 
U0CSR


	)

102 
	#UxUCR
 
U0UCR


	)

103 
	#UxDBUF
 
U0DBUF


	)

104 
	#UxBAUD
 
U0BAUD


	)

105 
	#UxGCR
 
U0GCR


	)

106 
	#UTXxIE
 
UTX0IE


	)

107 
	#UTXxIF
 
UTX0IF


	)

108 #ñi‡ (
HAL_UART_DMA
 == 2)

109 
	#UxCSR
 
U1CSR


	)

110 
	#UxUCR
 
U1UCR


	)

111 
	#UxDBUF
 
U1DBUF


	)

112 
	#UxBAUD
 
U1BAUD


	)

113 
	#UxGCR
 
U1GCR


	)

114 
	#UTXxIE
 
UTX1IE


	)

115 
	#UTXxIF
 
UTX1IF


	)

118 #unde‡
PxSEL


119 #unde‡
HAL_UART_PERCFG_BIT


120 #unde‡
HAL_UART_PRIPO


121 #unde‡
HAL_UART_Px_CTS


122 #unde‡
HAL_UART_Px_RTS


123 #unde‡
HAL_UART_Px_SEL


124 #i‡ (
HAL_UART_DMA
 == 1)

125 
	#PxSEL
 
P0SEL


	)

126 
	#HAL_UART_PERCFG_BIT
 0x01

127 
	#HAL_UART_PRIPO
 0x00

128 
	#HAL_UART_Px_CTS
 0x10

129 
	#HAL_UART_Px_RTS
 0x20

130 
	#HAL_UART_Px_SEL
 0x0C

131 #ñi‡ (
HAL_UART_DMA
 =2)

	)

132 
	#PxSEL
 
P1SEL


	)

133 
	#HAL_UART_PERCFG_BIT
 0x02

134 
	#HAL_UART_PRIPO
 0x40

135 
	#HAL_UART_Px_CTS
 0x10

136 
	#HAL_UART_Px_RTS
 0x20

137 
	#HAL_UART_Px_SEL
 0xC0

139 

	)

140 #unde‡
DMA_PAD


141 #unde‡
DMA_UxDBUF


142 #unde‡
DMATRIG_RX


143 #unde‡
DMATRIG_TX


144 #i‡ (
HAL_UART_DMA
 == 1)

145 
	#DMA_PAD
 
U0BAUD


	)

146 
	#DMA_UxDBUF
 
HAL_DMA_U0DBUF


	)

147 
	#DMATRIG_RX
 
HAL_DMA_TRIG_URX0


	)

148 
	#DMATRIG_TX
 
HAL_DMA_TRIG_UTX0


	)

149 #ñi‡ (
HAL_UART_DMA
 == 2)

150 
	#DMA_PAD
 
U1BAUD


	)

151 
	#DMA_UxDBUF
 
HAL_DMA_U1DBUF


	)

152 
	#DMATRIG_RX
 
HAL_DMA_TRIG_URX1


	)

153 
	#DMATRIG_TX
 
HAL_DMA_TRIG_UTX1


	)

156 #unde‡
PxDIR


157 #unde‡
PxIEN


158 #unde‡
PxIFG


159 #unde‡
PxIF


160 #unde‡
PICTL_BIT


161 #unde‡
IENx


162 #unde‡
IEN_BIT


163 #i‡ (
HAL_UART_DMA
 == 1)

164 
	#PxDIR
 
P0DIR


	)

165 
	#PxIEN
 
P0IEN


	)

166 
	#PxIFG
 
P0IFG


	)

167 
	#PxIF
 
P0IF


	)

168 
	#DMA_RDYIn
 
P0_4


	)

169 
	#DMA_RDYOut
 
P0_5


	)

170 
	#DMA_RDYIn_BIT
 
	`BV
(4)

171 
	#DMA_RDYOut_BIT
 
	`BV
(5)

173 
	#PICTL_BIT
 
	`BV
(0)

	)

174 
	#IENx
 
IEN1


	)

175 
	#IEN_BIT
 
	`BV
(5)

	)

176 #ñi‡ (
HAL_UART_DMA
 == 2)

177 
	#PxDIR
 
P1DIR


	)

178 
	#PxIEN
 
P1IEN


	)

179 
	#PxIFG
 
P1IFG


	)

180 
	#PxIF
 
P1IF


	)

181 
	#DMA_RDYIn
 
P1_4


	)

182 
	#DMA_RDYOut
 
P1_5


	)

183 
	#DMA_RDYIn_BIT
 
	`BV
(4)

184 
	#DMA_RDYOut_BIT
 
	`BV
(5)

186 
	#PICTL_BIT
 
	`BV
(2)

	)

187 
	#IENx
 
IEN2


	)

188 
	#IEN_BIT
 
	`BV
(4)

	)

191 #i‡!
deföed
–
DMA_PM
 )

192 #i‡
deföed
 
POWER_SAVING


193 
	#DMA_PM
 1

	)

195 
	#DMA_PM
 0

	)

201 #i‡!
deföed
 
HAL_UART_TX_BY_ISR


202 
	#HAL_UART_TX_BY_ISR
 1

	)

208 #i‡!
deföed
 
HAL_UART_RX_FLUSH


209 
	#HAL_UART_RX_FLUSH
 
TRUE


	)

220 
	#DMA_PM_DLY
 0

	)

223 
	#HAL_UART_MSECS_TO_TICKS
 33

	)

225 #i‡!
deföed
 
HAL_UART_DMA_RX_MAX


226 
	#HAL_UART_DMA_RX_MAX
 128

	)

228 #i‡!
deföed
 
HAL_UART_DMA_TX_MAX


229 
	#HAL_UART_DMA_TX_MAX
 
HAL_UART_DMA_RX_MAX


	)

231 #i‡!
deföed
 
HAL_UART_DMA_HIGH


232 
	#HAL_UART_DMA_HIGH
 (
HAL_UART_DMA_RX_MAX
 - 1)

	)

234 #i‡!
deföed
 
HAL_UART_DMA_IDLE


235 
	#HAL_UART_DMA_IDLE
 (0 * 
HAL_UART_MSECS_TO_TICKS
)

	)

237 #i‡!
deföed
 
HAL_UART_DMA_FULL


238 
	#HAL_UART_DMA_FULL
 (
HAL_UART_DMA_RX_MAX
 - 16)

	)

242 
	#HAL_UART_TX_TICK_MIN
 11

	)

249 #i‡
HAL_UART_DMA_RX_MAX
 <= 256

250 
uöt8
 
	trxIdx_t
;

252 
uöt16
 
	trxIdx_t
;

255 #i‡
HAL_UART_DMA_TX_MAX
 <= 256

256 
uöt8
 
	ttxIdx_t
;

258 
uöt16
 
	ttxIdx_t
;

263 
uöt16
 
	mrxBuf
[
HAL_UART_DMA_RX_MAX
];

264 
rxIdx_t
 
	mrxHód
;

265 
rxIdx_t
 
	mrxTaû
;

266 #i‡
HAL_UART_DMA_IDLE


267 
uöt8
 
	mrxTick
;

270 #i‡
HAL_UART_TX_BY_ISR


271 
uöt8
 
	mtxBuf
[
HAL_UART_DMA_TX_MAX
];

272 vﬁ©ûê
txIdx_t
 
	mtxHód
;

273 
txIdx_t
 
	mtxTaû
;

274 
uöt8
 
	mtxMT
;

276 
uöt8
 
	mtxBuf
[2][
HAL_UART_DMA_TX_MAX
];

277 
txIdx_t
 
	mtxIdx
[2];

278 
uöt8
 
	mtxMT
;

279 
uöt8
 
	mtxTick
;

280 
uöt8
 
	mtxTrig
;

284 vﬁ©ûê
uöt8
 
	mtxSñ
;

287 
hÆUARTCBack_t
 
	mu¨tCB
;

288 } 
	tu¨tDMACfg_t
;

295 
	#HAL_UART_DMA_NEW_RX_BYTE
(
IDX
Ë((
uöt8
)
DMA_PAD
 =
	`HI_UINT16
(
dmaCfg
.
rxBuf
[(IDX)]))

	)

296 
	#HAL_UART_DMA_GET_RX_BYTE
(
IDX
Ë(*(vﬁ©ûê
uöt8
 *)(
dmaCfg
.
rxBuf
+(IDX)))

	)

297 
	#HAL_UART_DMA_CLR_RX_BYTE
(
IDX
Ë(
dmaCfg
.
rxBuf
[(IDX)] = 
	`BUILD_UINT16
(0, (
DMA_PAD
 ^ 0xFF)))

	)

299 
	#HAL_UART_DMA_CLR_RDY_OUT
(Ë(
DMA_RDYOut
 = 1)

	)

300 
	#HAL_UART_DMA_SET_RDY_OUT
(Ë(
DMA_RDYOut
 = 0)

	)

302 
	#HAL_UART_DMA_RDY_IN
(Ë(
DMA_RDYIn
 =0)

	)

303 
	#HAL_UART_DMA_RDY_OUT
(Ë(
DMA_RDYOut
 =0)

	)

305 #i‡
HAL_UART_DMA_RX_MAX
 == 256

306 
	#HAL_UART_RX_IDX_T_DECR
(
IDX
Ë(IDX)--

	)

308 
	#HAL_UART_RX_IDX_T_DECR
(
IDX
Ë
	`°
 ( \

309 i‡((
IDX
)-- == 0) \

311 (
IDX
Ë
HAL_UART_DMA_RX_MAX
-1; \

313 )

	)

316 #i‡
HAL_UART_DMA_RX_MAX
 == 256

317 
	#HAL_UART_RX_IDX_T_INCR
(
IDX
Ë(IDX)++

	)

319 
	#HAL_UART_RX_IDX_T_INCR
(
IDX
Ë
	`°
 ( \

320 i‡(++(
IDX
Ë>
HAL_UART_DMA_RX_MAX
) \

322 (
IDX
) = 0; \

324 )

	)

327 
	#HAL_UART_DMA_TX_AVAIL
() \

328 (
dmaCfg
.
txHód
 > dmaCfg.
txTaû
) ? \

329 (
dmaCfg
.
txHód
 - dmaCfg.
txTaû
 - 1) : \

330 (
HAL_UART_DMA_TX_MAX
 - 
dmaCfg
.
txTaû
 + dmaCfg.
txHód
 - 1)

	)

338 vﬁ©ûê
uöt8
 
	gdmaRdyI§
;

339 
uöt8
 
	gdmaRdyDly
;

341 
u¨tDMACfg_t
 
	gdmaCfg
;

349 
rxIdx_t
 
	gu¨tRxBug
;

356 
HÆUART_DMAI§DMA
();

364 
HÆUARTInôDMA
();

365 
HÆUARTO≥nDMA
(
hÆUARTCfg_t
 *
c⁄fig
);

366 
uöt16
 
HÆUARTRódDMA
(
uöt8
 *
buf
, uöt16 
Àn
);

367 
uöt16
 
HÆUARTWrôeDMA
(
uöt8
 *
buf
, uöt16 
Àn
);

368 
HÆUARTPﬁlDMA
();

369 
uöt16
 
HÆUARTRxAvaûDMA
();

370 
uöt8
 
HÆUARTBusyDMA
();

371 #i‡!
HAL_UART_TX_BY_ISR


372 
HÆUARTPﬁlTxTrigDMA
();

373 
HÆUARTArmTxDMA
();

385 
	$HÆUARTInôDMA
()

387 
hÆDMADesc_t
 *
ch
;

388 #i‡(
HAL_UART_DMA
 == 1)

389 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

391 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

393 
PxSEL
 |
HAL_UART_Px_SEL
;

394 
UxCSR
 = 
CSR_MODE
;

395 
UxUCR
 = 
UCR_FLUSH
;

397 
P2DIR
 &~
P2DIR_PRIPO
;

398 
P2DIR
 |
HAL_UART_PRIPO
;

400 i‡(
DMA_PM
)

403 
PxIEN
 |
DMA_RDYIn_BIT
;

404 
PICTL
 |
PICTL_BIT
;

406 
	`HAL_UART_DMA_CLR_RDY_OUT
();

407 
PxDIR
 |
DMA_RDYOut_BIT
;

410 #i‡!
HAL_UART_TX_BY_ISR


412 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_CH_TX
 );

415 
	`HAL_DMA_ABORT_CH
–
HAL_DMA_CH_TX
 );

418 
	`HAL_DMA_SET_DEST
–
ch
, 
DMA_UxDBUF
 );

421 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

424 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

427 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

428 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
DMATRIG_TX
 );

431 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_1
 );

434 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_0
 );

437 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_ENABLE
 );

440 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

443 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
);

447 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_CH_RX
 );

450 
	`HAL_DMA_ABORT_CH
–
HAL_DMA_CH_RX
 );

453 
	`HAL_DMA_SET_SOURCE
–
ch
, 
DMA_UxDBUF
 );

456 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

465 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_WORD
 );

468 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE_REPEATED
 );

469 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
DMATRIG_RX
 );

472 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_0
 );

475 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_1
 );

476 
	`HAL_DMA_SET_DEST
–
ch
, 
dmaCfg
.
rxBuf
 );

477 
	`HAL_DMA_SET_LEN
–
ch
, 
HAL_UART_DMA_RX_MAX
 );

480 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

483 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

486 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
);

488 vﬁ©ûê
uöt8
 
dummy
 = *(vﬁ©ûêuöt8 *)
DMA_UxDBUF
;

489 
	`HAL_DMA_CLEAR_IRQ
(
HAL_DMA_CH_RX
);

490 
	`HAL_DMA_ARM_CH
(
HAL_DMA_CH_RX
);

491 ()
	`mem£t
(
dmaCfg
.
rxBuf
, (
DMA_PAD
 ^ 0xFF), 
HAL_UART_DMA_RX_MAX
*2);

492 
	}
}

503 
	$HÆUARTO≥nDMA
(
hÆUARTCfg_t
 *
c⁄fig
)

505 
dmaCfg
.
u¨tCB
 = 
c⁄fig
->
ˇŒBackFunc
;

508 
	`HAL_ASSERT
((
c⁄fig
->
baudR©e
 =
HAL_UART_BR_9600
) ||

509 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_19200
) ||

510 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_38400
) ||

511 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
) ||

512 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
));

514 i‡(
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
 ||

515 
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
)

517 
UxBAUD
 = 216;

521 
UxBAUD
 = 59;

524 
c⁄fig
->
baudR©e
)

526 
HAL_UART_BR_9600
:

527 
UxGCR
 = 8;

529 
HAL_UART_BR_19200
:

530 
UxGCR
 = 9;

532 
HAL_UART_BR_38400
:

533 
HAL_UART_BR_57600
:

534 
UxGCR
 = 10;

538 
UxGCR
 = 11;

553 
UxUCR
 = 
UCR_STOP
;

555 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

557 i‡(
DMA_PM
)

559 
PxIFG
 = 0;

560 
PxIF
 = 0;

561 
IENx
 |
IEN_BIT
;

563 i‡(
UxUCR
 & 
UCR_FLOW
)

567 
	`HAL_UART_DMA_SET_RDY_OUT
();

568 
PxDIR
 |
HAL_UART_Px_RTS
;

571 #i‡
HAL_UART_TX_BY_ISR


572 
UTXxIF
 = 1;

574 
	}
}

586 
uöt16
 
	$HÆUARTRódDMA
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

588 
uöt16
 
˙t
;

590 
˙t
 = 0; c¡ < 
Àn
; cnt++)

592 i‡(!
	`HAL_UART_DMA_NEW_RX_BYTE
(
dmaCfg
.
rxHód
))

596 *
buf
++ = 
	`HAL_UART_DMA_GET_RX_BYTE
(
dmaCfg
.
rxHód
);

597 
	`HAL_UART_DMA_CLR_RX_BYTE
(
dmaCfg
.
rxHód
);

598 
	`HAL_UART_RX_IDX_T_INCR
(
dmaCfg
.
rxHód
);

601 i‡(!
DMA_PM
 && (
UxUCR
 & 
UCR_FLOW
))

603 i‡(
	`HÆUARTRxAvaûDMA
(Ë< 
HAL_UART_DMA_HIGH
)

605 
	`HAL_UART_DMA_SET_RDY_OUT
();

609  
˙t
;

610 
	}
}

623 
uöt16
 
	$HÆUARTWrôeDMA
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

625 #i‡
HAL_UART_TX_BY_ISR


627 i‡(
	`HAL_UART_DMA_TX_AVAIL
(Ë< 
Àn
)

632 
uöt16
 
˙t
 = 0; c¡ < 
Àn
; cnt++)

634 
dmaCfg
.
txBuf
[dmaCfg.
txTaû
] = *
buf
++;

635 
dmaCfg
.
txMT
 = 0;

637 i‡(
dmaCfg
.
txTaû
 >
HAL_UART_DMA_TX_MAX
-1)

639 
dmaCfg
.
txTaû
 = 0;

643 
dmaCfg
.
txTaû
++;

647 
IEN2
 |
UTXxIE
;

650 
txIdx_t
 
txIdx
;

651 
uöt8
 
txSñ
;

652 
hÆI¡Sèã_t
 
his
;

654 
	`HAL_ENTER_CRITICAL_SECTION
(
his
);

655 
txSñ
 = 
dmaCfg
.txSel;

656 
txIdx
 = 
dmaCfg
.txIdx[
txSñ
];

657 
	`HAL_EXIT_CRITICAL_SECTION
(
his
);

660 i‡((
Àn
 + 
txIdx
Ë> 
HAL_UART_DMA_TX_MAX
)

665 ()
	`mem˝y
(&(
dmaCfg
.
txBuf
[
txSñ
][
txIdx
]), 
buf
, 
Àn
);

667 
	`HAL_ENTER_CRITICAL_SECTION
(
his
);

672 i‡(
txSñ
 !
dmaCfg
.txSel)

674 
	`HAL_EXIT_CRITICAL_SECTION
(
his
);

675 
txSñ
 ^= 1;

677 ()
	`mem˝y
(&(
dmaCfg
.
txBuf
[
txSñ
][0]), 
buf
, 
Àn
);

678 
	`HAL_ENTER_CRITICAL_SECTION
(
his
);

679 
dmaCfg
.
txIdx
[
txSñ
] = 
Àn
;

683 
dmaCfg
.
txIdx
[
txSñ
] =ÅxIdx + 
Àn
;

687 i‡(
dmaCfg
.
txIdx
[(
txSñ
 ^ 1)] == 0)

689 
	`HAL_EXIT_CRITICAL_SECTION
(
his
);

690 
	`HÆUARTArmTxDMA
();

694 
dmaCfg
.
txMT
 = 
FALSE
;

695 
	`HAL_EXIT_CRITICAL_SECTION
(
his
);

699  
Àn
;

700 
	}
}

712 
	$HÆUARTPﬁlDMA
()

714 
uöt8
 
evt
 = 0;

715 
uöt16
 
˙t
;

717 #i‡
DMA_PM


718 
PxIEN
 &~
DMA_RDYIn_BIT
;

720 i‡(
dmaRdyI§
 || 
	`HAL_UART_DMA_RDY_IN
(Ë|| 
	`HÆUARTBusyDMA
())

723 #i‡
HAL_UART_TX_BY_ISR


724 i‡(!
	`HAL_UART_DMA_RDY_IN
(Ë&& (
dmaCfg
.
txHód
 !dmaCfg.
txTaû
))

726 i‡(!
	`HAL_UART_DMA_RDY_IN
(Ë&& ((
dmaCfg
.
txIdx
[0] != 0) || (dmaCfg.txIdx[1] != 0)))

729 
	`HAL_UART_DMA_CLR_RDY_OUT
();

731 
dmaRdyI§
 = 0;

733 i‡(
dmaRdyDly
 == 0)

735 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_HOLD_EVENT
);

738 i‡((
dmaRdyDly
 = 
ST0
) == 0)

740 
dmaRdyDly
 = 0xFF;

742 
	`HAL_UART_DMA_SET_RDY_OUT
();

744 i‡((
dmaRdyDly
 !0Ë&& (!
DMA_PM_DLY
 || ((
uöt8
)(
ST0
 - dmaRdyDly) > DMA_PM_DLY)))

746 
dmaRdyDly
 = 0;

747 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_CONSERVE_EVENT
);

750 
PxIEN
 |
DMA_RDYIn_BIT
;

753 #i‡!
HAL_UART_TX_BY_ISR


754 
	`HÆUARTPﬁlTxTrigDMA
();

757 i‡(!
	`HAL_UART_DMA_NEW_RX_BYTE
(
dmaCfg
.
rxHód
))

759 i‡(
	`HAL_UART_DMA_NEW_RX_BYTE
(
u¨tRxBug
))

762 
	`HAL_UART_RX_IDX_T_INCR
(
dmaCfg
.
rxHód
);

763 } !
	`HAL_UART_DMA_NEW_RX_BYTE
(
dmaCfg
.
rxHód
));

765 
u¨tRxBug
 = 
dmaCfg
.
rxHód
;

766 
dmaCfg
.
rxTaû
 = dmaCfg.
rxHód
;

768 
	`HAL_UART_RX_IDX_T_INCR
(
u¨tRxBug
);

771 
˙t
 = 
	`HÆUARTRxAvaûDMA
();

773 #i‡
HAL_UART_DMA_IDLE


774 i‡(
dmaCfg
.
rxTick
)

777 i‡((
ST0
 - 
dmaCfg
.
rxTick
Ë> 
HAL_UART_DMA_IDLE
)

779 
dmaCfg
.
rxTick
 = 0;

780 
evt
 = 
HAL_UART_RX_TIMEOUT
;

783 i‡(
˙t
 != 0)

785 i‡((
dmaCfg
.
rxTick
 = 
ST0
) == 0)

787 
dmaCfg
.
rxTick
 = 0xFF;

791 i‡(
˙t
 != 0)

793 
evt
 = 
HAL_UART_RX_TIMEOUT
;

797 i‡(
˙t
 >
HAL_UART_DMA_FULL
)

799 
evt
 |
HAL_UART_RX_FULL
;

801 i‡(
˙t
 >
HAL_UART_DMA_HIGH
)

803 
evt
 |
HAL_UART_RX_ABOUT_FULL
;

805 i‡(!
DMA_PM
 && (
UxUCR
 & 
UCR_FLOW
))

807 
	`HAL_UART_DMA_CLR_RDY_OUT
();

811 i‡(
dmaCfg
.
txMT
)

813 
dmaCfg
.
txMT
 = 
FALSE
;

814 
evt
 |
HAL_UART_TX_EMPTY
;

817 i‡((
evt
 !0Ë&& (
dmaCfg
.
u¨tCB
 !
NULL
))

819 
dmaCfg
.
	`u¨tCB
(
HAL_UART_DMA
-1, 
evt
);

822 i‡(
DMA_PM
 && (
dmaRdyDly
 =0Ë&& !
	`HÆUARTBusyDMA
())

824 
	`HAL_UART_DMA_CLR_RDY_OUT
();

826 
	}
}

837 
uöt16
 
	$HÆUARTRxAvaûDMA
()

840 
rxIdx_t
 
èû
 = 
dmaCfg
.
rxTaû
;

844 i‡(!
	`HAL_UART_DMA_NEW_RX_BYTE
(
èû
))

849 
	`HAL_UART_RX_IDX_T_INCR
(
èû
);

850 } 
èû
 !
dmaCfg
.
rxHód
);

852 
dmaCfg
.
rxTaû
 = 
èû
;

854 
uöt16
 
˙t
 = 
èû
 - 
dmaCfg
.
rxHód
;

857 i‡((
˙t
 =0Ë&& 
	`HAL_UART_DMA_NEW_RX_BYTE
(
èû
))

862 
èû
 = 
dmaCfg
.
rxHód
;

863 
	`HAL_UART_RX_IDX_T_DECR
(
èû
);

865 i‡(
	`HAL_UART_DMA_NEW_RX_BYTE
(
èû
))

867 i‡(
HAL_UART_RX_FLUSH
)

869 ()
	`mem£t
(
dmaCfg
.
rxBuf
, (
DMA_PAD
 ^ 0xFF), 
HAL_UART_DMA_RX_MAX
*2);

871 
u¨tRxBug
 = 
dmaCfg
.
rxHód
;

872 
dmaCfg
.
rxTaû
 = dmaCfg.
rxHód
;

876 
˙t
 = 
HAL_UART_DMA_RX_MAX
;

881 
˙t
 = 1;

884 i‡(
˙t
 > 
HAL_UART_DMA_RX_MAX
)

886 
˙t
 +
HAL_UART_DMA_RX_MAX
;

889  
˙t
;

890 
	}
}

901 
uöt8
 
	$HÆUARTBusyDMA
( )

903 #i‡
HAL_UART_TX_BY_ISR


904  !((!(
UxCSR
 & (
CSR_ACTIVE
 | 
CSR_RX_BYTE
))Ë&& (
	`HÆUARTRxAvaûDMA
() == 0) &&

905 (
dmaCfg
.
txHód
 =dmaCfg.
txTaû
));

907  !((!(
UxCSR
 & (
CSR_ACTIVE
 | 
CSR_RX_BYTE
))Ë&& (
	`HÆUARTRxAvaûDMA
() == 0) &&

908 (
dmaCfg
.
txIdx
[0] == 0) && (dmaCfg.txIdx[1] == 0));

910 
	}
}

912 #i‡!
HAL_UART_TX_BY_ISR


922 
	$HÆUARTPﬁlTxTrigDMA
()

924 i‡((
UxCSR
 & 
CSR_TX_BYTE
) == 0)

926 i‡((
dmaCfg
.
txTick
 =0Ë|| ((
uöt8
)(
ST0
 - dmaCfg.txTickË> 
HAL_UART_TX_TICK_MIN
))

928 
dmaCfg
.
txTick
 = 0;

930 i‡(
dmaCfg
.
txTrig
 && 
	`HAL_DMA_CH_ARMED
(
HAL_DMA_CH_TX
))

932 
	`HAL_DMA_MAN_TRIGGER
(
HAL_DMA_CH_TX
);

934 
dmaCfg
.
txTrig
 = 0;

939 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

940 
dmaCfg
.
txTick
 = 
ST0
;

942 i‡(
dmaCfg
.
txTick
 == 0)

944 
dmaCfg
.
txTick
 = 0xFF;

947 
	}
}

958 
	$HÆUARTArmTxDMA
()

960 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
(
HAL_DMA_CH_TX
);

961 
	`HAL_DMA_SET_SOURCE
(
ch
, 
dmaCfg
.
txBuf
[dmaCfg.
txSñ
]);

962 
	`HAL_DMA_SET_LEN
(
ch
, 
dmaCfg
.
txIdx
[dmaCfg.
txSñ
]);

964 
dmaCfg
.
txSñ
 ^= 1;

965 
dmaCfg
.
txTrig
 = 1;

966 
	`HAL_DMA_ARM_CH
(
HAL_DMA_CH_TX
);

968 
	`HÆUARTPﬁlTxTrigDMA
();

970 i‡(
DMA_PM
)

972 
	`HAL_UART_DMA_SET_RDY_OUT
();

974 
	}
}

986 
	$HÆUART_DMAI§DMA
()

988 #i‡!
HAL_UART_TX_BY_ISR


989 i‡(
dmaCfg
.
txIdx
[dmaCfg.
txSñ
])

992 
	`HÆUARTArmTxDMA
();

995 
dmaCfg
.
txIdx
[dmaCfg.
txSñ
] = 0;

999 
dmaCfg
.
txIdx
[(dmaCfg.
txSñ
 ^ 1)] = 0;

1003 
	`HÆUARTPﬁlTxTrigDMA
();

1006 
dmaCfg
.
txMT
 = 
TRUE
;

1008 
	}
}

1010 #i‡
DMA_PM


1020 #i‡(
HAL_UART_DMA
 == 1)

1021 
	$HAL_ISR_FUNCTION
(
p‹t0I§
, 
P0INT_VECTOR
)

1023 
	$HAL_ISR_FUNCTION
(
p‹t1I§
, 
P1INT_VECTOR
)

1026 
	`HAL_ENTER_ISR
();

1028 
PxIFG
 = 0;

1029 
PxIF
 = 0;

1031 
dmaRdyI§
 = 1;

1033 
	`CLEAR_SLEEP_MODE
();

1034 
	`HAL_EXIT_ISR
();

1035 
	}
}

1038 #i‡
HAL_UART_TX_BY_ISR


1048 #i‡(
HAL_UART_DMA
 == 1)

1049 
	$HAL_ISR_FUNCTION
–
hÆU¨t0TxI§
, 
UTX0_VECTOR
 )

1051 
	$HAL_ISR_FUNCTION
–
hÆU¨t1TxI§
, 
UTX1_VECTOR
 )

1054 
	`HAL_ENTER_ISR
();

1056 i‡(
dmaCfg
.
txHód
 =dmaCfg.
txTaû
)

1058 
IEN2
 &~
UTXxIE
;

1059 
dmaCfg
.
txMT
 = 1;

1063 
UTXxIF
 = 0;

1064 
UxDBUF
 = 
dmaCfg
.
txBuf
[dmaCfg.
txHód
++];

1066 i‡((
HAL_UART_DMA_TX_MAX
 !256Ë&& (
dmaCfg
.
txHód
 >= HAL_UART_DMA_TX_MAX))

1068 
dmaCfg
.
txHód
 = 0;

1072 
	`HAL_EXIT_ISR
();

1073 
	}
}

	@Components/hal/target/CC2540EB/_hal_uart_isr.c

47 
	~"hÆ_ty≥s.h
"

48 
	~"hÆ_as£π.h
"

49 
	~"hÆ_bﬂrd.h
"

50 
	~"hÆ_defs.h
"

51 
	~"hÆ_mcu.h
"

52 
	~"hÆ_u¨t.h
"

59 
	#HAL_UART_ASSERT
(
ex¥
)

	)

61 
	#HAL_UART_ISR_RX_AVAIL
() \

62 (
i§Cfg
.
rxTaû
 >i§Cfg.
rxHód
) ? \

63 (
i§Cfg
.
rxTaû
 - i§Cfg.
rxHód
) : \

64 (
HAL_UART_ISR_RX_MAX
 - 
i§Cfg
.
rxHód
 + i§Cfg.
rxTaû
)

	)

66 
	#HAL_UART_ISR_TX_AVAIL
() \

67 (
i§Cfg
.
txHód
 > i§Cfg.
txTaû
) ? \

68 (
i§Cfg
.
txHód
 - i§Cfg.
txTaû
 - 1) : \

69 (
HAL_UART_ISR_TX_MAX
 - 
i§Cfg
.
txTaû
 + i§Cfg.
txHód
 - 1)

	)

76 
	#CSR_MODE
 0x80

	)

77 
	#CSR_RE
 0x40

	)

78 
	#CSR_SLAVE
 0x20

	)

79 
	#CSR_FE
 0x10

	)

80 
	#CSR_ERR
 0x08

	)

81 
	#CSR_RX_BYTE
 0x04

	)

82 
	#CSR_TX_BYTE
 0x02

	)

83 
	#CSR_ACTIVE
 0x01

	)

86 
	#UCR_FLUSH
 0x80

	)

87 
	#UCR_FLOW
 0x40

	)

88 
	#UCR_D9
 0x20

	)

89 
	#UCR_BIT9
 0x10

	)

90 
	#UCR_PARITY
 0x08

	)

91 
	#UCR_SPB
 0x04

	)

92 
	#UCR_STOP
 0x02

	)

93 
	#UCR_START
 0x01

	)

95 
	#UTX0IE
 0x04

	)

96 
	#UTX1IE
 0x08

	)

98 
	#P2DIR_PRIPO
 0xC0

	)

101 #unde‡
PxOUT


102 #unde‡
PxDIR


103 #unde‡
PxSEL


104 #unde‡
UxCSR


105 #unde‡
UxUCR


106 #unde‡
UxDBUF


107 #unde‡
UxBAUD


108 #unde‡
UxGCR


109 #unde‡
URXxIE


110 #unde‡
URXxIF


111 #unde‡
UTXxIE


112 #unde‡
UTXxIF


113 #unde‡
HAL_UART_PERCFG_BIT


114 #unde‡
HAL_UART_Px_RTS


115 #unde‡
HAL_UART_Px_CTS


116 #unde‡
HAL_UART_Px_RX_TX


117 #unde‡
HAL_UART_Px_RX


118 #unde‡
PxIFG


119 #unde‡
PxIF


120 #unde‡
PxIEN


121 #unde‡
PICTL_BIT


122 #unde‡
IENx


123 #unde‡
IEN_BIT


124 #i‡(
HAL_UART_ISR
 == 1)

125 
	#PxOUT
 
P0


	)

126 
	#PxIN
 
P0


	)

127 
	#PxDIR
 
P0DIR


	)

128 
	#PxSEL
 
P0SEL


	)

129 
	#UxCSR
 
U0CSR


	)

130 
	#UxUCR
 
U0UCR


	)

131 
	#UxDBUF
 
U0DBUF


	)

132 
	#UxBAUD
 
U0BAUD


	)

133 
	#UxGCR
 
U0GCR


	)

134 
	#URXxIE
 
URX0IE


	)

135 
	#URXxIF
 
URX0IF


	)

136 
	#UTXxIE
 
UTX0IE


	)

137 
	#UTXxIF
 
UTX0IF


	)

139 
	#PxIFG
 
P0IFG


	)

140 
	#PxIF
 
P0IF


	)

141 
	#PxIEN
 
P0IEN


	)

142 
	#PICTL_BIT
 0x01

	)

143 
	#IENx
 
IEN1


	)

144 
	#IEN_BIT
 0x20

	)

147 
	#PxOUT
 
P1


	)

148 
	#PxIN
 
P1


	)

149 
	#PxDIR
 
P1DIR


	)

150 
	#PxSEL
 
P1SEL


	)

151 
	#UxCSR
 
U1CSR


	)

152 
	#UxUCR
 
U1UCR


	)

153 
	#UxDBUF
 
U1DBUF


	)

154 
	#UxBAUD
 
U1BAUD


	)

155 
	#UxGCR
 
U1GCR


	)

156 
	#URXxIE
 
URX1IE


	)

157 
	#URXxIF
 
URX1IF


	)

158 
	#UTXxIE
 
UTX1IE


	)

159 
	#UTXxIF
 
UTX1IF


	)

161 
	#PxIFG
 
P1IFG


	)

162 
	#PxIF
 
P1IF


	)

163 
	#PxIEN
 
P1IEN


	)

164 
	#PICTL_BIT
 0x04

	)

165 
	#IENx
 
IEN2


	)

166 
	#IEN_BIT
 0x10

	)

169 #i‡(
HAL_UART_ISR
 == 1)

170 
	#HAL_UART_PERCFG_BIT
 0x01

171 
	#HAL_UART_Px_RX_TX
 0x0C

172 
	#HAL_UART_Px_RX
 0x04

173 
	#HAL_UART_Px_RTS
 0x20

174 
	#HAL_UART_Px_CTS
 0x10

175 #ñ£

	)

176 
	#HAL_UART_PERCFG_BIT
 0x02

177 
	#HAL_UART_Px_RTS
 0x20

178 
	#HAL_UART_Px_CTS
 0x10

179 
	#HAL_UART_Px_RX_TX
 0xC0

180 
	#HAL_UART_Px_RX
 0x80

182 

	)

184 
	#HAL_UART_MSECS_TO_TICKS
 33

	)

186 #i‡!
deföed
 
HAL_UART_ISR_RX_MAX


187 
	#HAL_UART_ISR_RX_MAX
 128

	)

189 #i‡!
deföed
 
HAL_UART_ISR_TX_MAX


190 
	#HAL_UART_ISR_TX_MAX
 
HAL_UART_ISR_RX_MAX


	)

192 #i‡!
deföed
 
HAL_UART_ISR_HIGH


193 
	#HAL_UART_ISR_HIGH
 (
HAL_UART_ISR_RX_MAX
 / 2 - 16)

	)

195 #i‡!
deföed
 
HAL_UART_ISR_IDLE


196 
	#HAL_UART_ISR_IDLE
 (0 * 
HAL_UART_MSECS_TO_TICKS
)

	)

203 #i‡
HAL_UART_ISR_RX_MAX
 <= 256

204 
uöt8
 
	trxIdx_t
;

206 
uöt16
 
	trxIdx_t
;

209 #i‡
HAL_UART_ISR_TX_MAX
 <= 256

210 
uöt8
 
	ttxIdx_t
;

212 
uöt16
 
	ttxIdx_t
;

217 
uöt8
 
	mrxBuf
[
HAL_UART_ISR_RX_MAX
];

218 
rxIdx_t
 
	mrxHód
;

219 vﬁ©ûê
rxIdx_t
 
	mrxTaû
;

220 
uöt8
 
	mrxTick
;

221 
uöt8
 
	mrxShdw
;

223 
uöt8
 
	mtxBuf
[
HAL_UART_ISR_TX_MAX
];

224 vﬁ©ûê
txIdx_t
 
	mtxHód
;

225 
txIdx_t
 
	mtxTaû
;

226 
uöt8
 
	mtxMT
;

228 
hÆUARTCBack_t
 
	mu¨tCB
;

229 } 
	tu¨tISRCfg_t
;

235 
u¨tISRCfg_t
 
	gi§Cfg
;

241 
HÆUARTInôISR
();

242 
HÆUARTO≥nISR
(
hÆUARTCfg_t
 *
c⁄fig
);

243 
uöt16
 
HÆUARTRódISR
(
uöt8
 *
buf
, uöt16 
Àn
);

244 
uöt16
 
HÆUARTWrôeISR
(
uöt8
 *
buf
, uöt16 
Àn
);

245 
HÆUARTPﬁlISR
();

246 
uöt16
 
HÆUARTRxAvaûISR
();

247 
uöt8
 
HÆUARTBusyISR
();

248 
HÆUARTSu•ídISR
();

249 
HÆUARTResumeISR
();

260 
	$HÆUARTInôISR
()

263 
P2DIR
 &~
P2DIR_PRIPO
;

264 
P2DIR
 |
HAL_UART_PRIPO
;

266 #i‡(
HAL_UART_ISR
 == 1)

267 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

269 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

271 
PxSEL
 |
HAL_UART_Px_RX_TX
;

272 
ADCCFG
 &~
HAL_UART_Px_RX_TX
;

273 
UxCSR
 = 
CSR_MODE
;

274 
UxUCR
 = 
UCR_FLUSH
;

275 
	}
}

286 
	$HÆUARTO≥nISR
(
hÆUARTCfg_t
 *
c⁄fig
)

288 
i§Cfg
.
u¨tCB
 = 
c⁄fig
->
ˇŒBackFunc
;

290 
	`HAL_UART_ASSERT
((
c⁄fig
->
baudR©e
 =
HAL_UART_BR_9600
) ||

291 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_19200
) ||

292 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_38400
) ||

293 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
) ||

294 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
));

296 i‡(
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
 ||

297 
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
)

299 
UxBAUD
 = 216;

303 
UxBAUD
 = 59;

306 
c⁄fig
->
baudR©e
)

308 
HAL_UART_BR_9600
:

309 
UxGCR
 = 8;

311 
HAL_UART_BR_19200
:

312 
UxGCR
 = 9;

314 
HAL_UART_BR_38400
:

315 
HAL_UART_BR_57600
:

316 
UxGCR
 = 10;

320 
UxGCR
 = 11;

325 i‡(
c⁄fig
->
ÊowC⁄åﬁ
)

327 
UxUCR
 = 
UCR_FLOW
 | 
UCR_STOP
;

328 
PxSEL
 |
HAL_UART_Px_RTS
 | 
HAL_UART_Px_CTS
;

329 
PxOUT
 &~
HAL_UART_Px_RTS
;

330 
PxDIR
 |
HAL_UART_Px_RTS
;

334 
UxUCR
 = 
UCR_STOP
;

337 
URXxIE
 = 1;

338 
UTXxIF
 = 1;

339 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

340 
	}
}

352 
uöt16
 
	$HÆUARTRódISR
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

354 
uöt16
 
˙t
 = 0;

356 (
i§Cfg
.
rxHód
 !i§Cfg.
rxTaû
Ë&& (
˙t
 < 
Àn
))

358 *
buf
++ = 
i§Cfg
.
rxBuf
[i§Cfg.
rxHód
++];

359 i‡(
i§Cfg
.
rxHód
 >
HAL_UART_ISR_RX_MAX
)

361 
i§Cfg
.
rxHód
 = 0;

363 
˙t
++;

366  
˙t
;

367 
	}
}

379 
uöt16
 
	$HÆUARTWrôeISR
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

381 
uöt16
 
˙t
;

384 i‡(
	`HAL_UART_ISR_TX_AVAIL
(Ë< 
Àn
)

389 
˙t
 = 0; c¡ < 
Àn
; cnt++)

391 
i§Cfg
.
txBuf
[i§Cfg.
txTaû
] = *
buf
++;

392 
i§Cfg
.
txMT
 = 0;

394 i‡(
i§Cfg
.
txTaû
 >
HAL_UART_ISR_TX_MAX
-1)

396 
i§Cfg
.
txTaû
 = 0;

400 
i§Cfg
.
txTaû
++;

404 
IEN2
 |
UTXxIE
;

407  
˙t
;

408 
	}
}

419 
	$HÆUARTPﬁlISR
()

421 
uöt16
 
˙t
 = 
	`HAL_UART_ISR_RX_AVAIL
();

422 
uöt8
 
evt
 = 0;

424 i‡(
i§Cfg
.
rxTick
)

427 
uöt8
 
de¸
 = 
ST0
 - 
i§Cfg
.
rxShdw
;

429 i‡(
i§Cfg
.
rxTick
 > 
de¸
)

431 
i§Cfg
.
rxTick
 -
de¸
;

435 
i§Cfg
.
rxTick
 = 0;

438 
i§Cfg
.
rxShdw
 = 
ST0
;

440 i‡(
˙t
 >
HAL_UART_ISR_RX_MAX
-1)

442 
evt
 = 
HAL_UART_RX_FULL
;

444 i‡(
˙t
 >
HAL_UART_ISR_HIGH
)

446 
evt
 = 
HAL_UART_RX_ABOUT_FULL
;

448 i‡(
˙t
 && !
i§Cfg
.
rxTick
)

450 
evt
 = 
HAL_UART_RX_TIMEOUT
;

453 i‡(
i§Cfg
.
txMT
)

455 
i§Cfg
.
txMT
 = 0;

456 
evt
 |
HAL_UART_TX_EMPTY
;

459 i‡(
evt
 && (
i§Cfg
.
u¨tCB
 !
NULL
))

461 
i§Cfg
.
	`u¨tCB
(
HAL_UART_ISR
-1, 
evt
);

463 
	}
}

474 
uöt16
 
	$HÆUARTRxAvaûISR
()

476  
	`HAL_UART_ISR_RX_AVAIL
();

477 
	}
}

488 
uöt8
 
	$HÆUARTBusyISR
( )

490  ((!(
UxCSR
 & (
CSR_ACTIVE
 | 
CSR_RX_BYTE
))) &&

491 (
i§Cfg
.
rxHód
 =i§Cfg.
rxTaû
Ë&& (i§Cfg.
txHód
 =i§Cfg.
txTaû
));

492 
	}
}

503 
	$HÆUARTSu•ídISR
( )

505 #i‡
deföed
 
POWER_SAVING


506 
UxCSR
 = 
CSR_MODE
;

508 i‡(
UxUCR
 & 
UCR_FLOW
)

510 
PxOUT
 |
HAL_UART_Px_RTS
;

511 
PxIFG
 = (
HAL_UART_Px_CTS
 ^ 0xFF);

512 
PxIEN
 |
HAL_UART_Px_CTS
;

516 
PxIFG
 = (
HAL_UART_Px_RX
 ^ 0xFF);

517 
PxIEN
 |
HAL_UART_Px_RX
;

520 #i‡
deföed
 
HAL_UART_GPIO_ISR


521 
PxIF
 = 0;

522 
PICTL
 |
PICTL_BIT
;

523 
IENx
 |
IEN_BIT
;

526 
	}
}

537 
	$HÆUARTResumeISR
( )

539 #i‡
deföed
 
POWER_SAVING


540 #i‡
deföed
 
HAL_UART_GPIO_ISR


541 
IENx
 &(
IEN_BIT
 ^ 0xFF);

544 i‡(
UxUCR
 & 
UCR_FLOW
)

546 
PxIEN
 &(
HAL_UART_Px_CTS
 ^ 0xFF);

547 
PxOUT
 &(
HAL_UART_Px_RTS
 ^ 0xFF);

551 
PxIEN
 &(
HAL_UART_Px_RX
 ^ 0xFF);

554 
UxUCR
 |
UCR_FLUSH
;

555 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

557 
	}
}

568 #i‡(
HAL_UART_ISR
 == 1)

569 
	$HAL_ISR_FUNCTION
–
hÆU¨t0RxI§
, 
URX0_VECTOR
 )

571 
	$HAL_ISR_FUNCTION
–
hÆU¨t1RxI§
, 
URX1_VECTOR
 )

574 
	`HAL_ENTER_ISR
();

576 
uöt8
 
tmp
 = 
UxDBUF
;

577 
i§Cfg
.
rxBuf
[i§Cfg.
rxTaû
] = 
tmp
;

580 i‡(
i§Cfg
.
rxHód
 =i§Cfg.
rxTaû
)

582 
i§Cfg
.
rxShdw
 = 
ST0
;

585 i‡(++
i§Cfg
.
rxTaû
 >
HAL_UART_ISR_RX_MAX
)

587 
i§Cfg
.
rxTaû
 = 0;

590 
i§Cfg
.
rxTick
 = 
HAL_UART_ISR_IDLE
;

592 
	`HAL_EXIT_ISR
();

593 
	}
}

604 #i‡(
HAL_UART_ISR
 == 1)

605 
	$HAL_ISR_FUNCTION
–
hÆU¨t0TxI§
, 
UTX0_VECTOR
 )

607 
	$HAL_ISR_FUNCTION
–
hÆU¨t1TxI§
, 
UTX1_VECTOR
 )

610 
	`HAL_ENTER_ISR
();

612 i‡(
i§Cfg
.
txHód
 =i§Cfg.
txTaû
)

614 
IEN2
 &~
UTXxIE
;

615 
i§Cfg
.
txMT
 = 1;

619 
UTXxIF
 = 0;

620 
UxDBUF
 = 
i§Cfg
.
txBuf
[i§Cfg.
txHód
++];

622 i‡(
i§Cfg
.
txHód
 >
HAL_UART_ISR_TX_MAX
)

624 
i§Cfg
.
txHód
 = 0;

628 
	`HAL_EXIT_ISR
();

629 
	}
}

631 #i‡(
deföed
 
POWER_SAVING
 && deföed 
HAL_UART_GPIO_ISR
)

641 #i‡(
HAL_UART_ISR
 == 1)

642 
	$HAL_ISR_FUNCTION
(
p‹t0I§
, 
P0INT_VECTOR
)

644 
	$HAL_ISR_FUNCTION
(
p‹t1I§
, 
P1INT_VECTOR
)

647 
	`HAL_ENTER_ISR
();

649 
	`HÆUARTResume
();

650 i‡(
dmaCfg
.
u¨tCB
 !
NULL
)

652 
dmaCfg
.
	`u¨tCB
(
HAL_UART_DMA
-1, 
HAL_UART_RX_WAKEUP
);

654 
PxIFG
 = 0;

655 
PxIF
 = 0;

657 
	`HAL_EXIT_ISR
();

658 
	}
}

	@Components/hal/target/CC2540EB/_hal_uart_spi.c

72 
	~<°rög.h
>

74 
	~"hÆ_as£π.h
"

75 
	~"hÆ_bﬂrd.h
"

76 
	~"hÆ_defs.h
"

77 
	~"hÆ_drivîs.h
"

78 
	~"hÆ_dma.h
"

79 
	~"hÆ_mcu.h
"

80 
	~"hÆ_ty≥s.h
"

81 
	~"hÆ_u¨t.h
"

82 #i‡
deföed
 
POWER_SAVING


83 
	~"OSAL.h
"

84 
	~"OSAL_PwrMgr.h
"

85 #ñi‡
deföed
 
HAL_SPI_QUEUED_TX
 && HAL_SPI_QUEUED_TX

86 
	~"OSAL.h
"

97 #i‡!
deföed
 
HAL_SPI_CH_RX


98 
	#HAL_SPI_CH_RX
 
HAL_DMA_CH_RX


	)

100 #i‡!
deföed
 
HAL_SPI_CH_TX


101 
	#HAL_SPI_CH_TX
 
HAL_DMA_CH_TX


	)

106 #i‡!
deföed
 
HAL_SPI_ON_UART_BUFS


107 
	#HAL_SPI_ON_UART_BUFS
 
FALSE


	)

110 #i‡!
deföed
 
HAL_SPI_QUEUED_TX


111 
	#HAL_SPI_QUEUED_TX
 
FALSE


	)

114 
	#SPI_MAX_PKT_LEN
 256

	)

115 
	#SPI_MAX_DAT_LEN
 (
SPI_MAX_PKT_LEN
 - 
SPI_FRM_LEN
)

	)

117 
	#SPI_SOF
 0xFE

118 

	)

120 
	#SPI_HDR_LEN
 1

122 
	#SPI_FRM_LEN
 (2 + 
SPI_HDR_LEN
)

	)

124 
	#SPI_SOF_IDX
 0

	)

125 
	#SPI_HDR_IDX
 1

126 
	#SPI_LEN_IDX
 1

127 
	#SPI_DAT_IDX
 2

128 

	)

129 #i‡
deföed
 
HAL_SPI_MASTER


133 #i‡!
deföed
 
HAL_SPI_WAKEUP


134 
	#HAL_SPI_WAKEUP
 
TRUE


	)

138 #i‡!
deföed
 
HAL_UART_SPI


139 
	#HAL_UART_SPI
 2

	)

140 #ñi‡ (
HAL_UART_SPI
 != 2)

141 #îr‹ 
O∆y
 
suµ‹tög
 
HAL_UART_SPI
==2 
now
.

145 
	#CSR_MODE
 0x80

	)

146 
	#CSR_RE
 0x40

	)

147 
	#CSR_SLAVE
 0x20

	)

148 
	#CSR_FE
 0x10

	)

149 
	#CSR_ERR
 0x08

	)

150 
	#CSR_RX_BYTE
 0x04

	)

151 
	#CSR_TX_BYTE
 0x02

	)

152 
	#CSR_ACTIVE
 0x01

	)

155 
	#UCR_FLUSH
 0x80

	)

156 
	#UCR_FLOW
 0x40

	)

157 
	#UCR_D9
 0x20

	)

158 
	#UCR_BIT9
 0x10

	)

159 
	#UCR_PARITY
 0x08

	)

160 
	#UCR_SPB
 0x04

	)

161 
	#UCR_STOP
 0x02

	)

162 
	#UCR_START
 0x01

	)

164 
	#P2DIR_PRIPO
 0xC0

	)

166 
	#HAL_DMA_U0DBUF
 0x70C1

	)

167 
	#HAL_DMA_U1DBUF
 0x70F9

	)

169 #unde‡
UxCSR


170 #unde‡
UxUCR


171 #unde‡
UxDBUF


172 #unde‡
UxBAUD


173 #unde‡
UxGCR


174 #i‡ (
HAL_UART_SPI
 == 1)

175 
	#UxCSR
 
U0CSR


	)

176 
	#UxUCR
 
U0UCR


	)

177 
	#UxDBUF
 
U0DBUF


	)

178 
	#UxBAUD
 
U0BAUD


	)

179 
	#UxGCR
 
U0GCR


	)

180 #ñi‡ (
HAL_UART_SPI
 == 2)

181 
	#UxCSR
 
U1CSR


	)

182 
	#UxUCR
 
U1UCR


	)

183 
	#UxDBUF
 
U1DBUF


	)

184 
	#UxBAUD
 
U1BAUD


	)

185 
	#UxGCR
 
U1GCR


	)

188 #unde‡
PxSEL


189 #unde‡
HAL_UART_PERCFG_BIT


190 #unde‡
HAL_UART_PRIPO


191 #unde‡
HAL_UART_Px_SEL_S


192 #unde‡
HAL_UART_Px_SEL_M


193 #i‡ (
HAL_UART_SPI
 == 1)

194 
	#PxSEL
 
P0SEL


	)

195 
	#HAL_UART_PERCFG_BIT
 0x01

196 
	#HAL_UART_PRIPO
 0x00

197 
	#HAL_UART_Px_SEL_S
 0x3C

198 
	#HAL_UART_Px_SEL_M
 0x2C

199 #ñi‡ (
HAL_UART_SPI
 =2)

	)

200 
	#PxSEL
 
P1SEL


	)

201 
	#HAL_UART_PERCFG_BIT
 0x02

202 
	#HAL_UART_PRIPO
 0x40

203 
	#HAL_UART_Px_SEL_S
 0xF0

204 
	#HAL_UART_Px_SEL_M
 0xE0

206 

	)

207 #unde‡
DMA_PAD


208 #unde‡
DMA_UxDBUF


209 #unde‡
DMATRIG_RX


210 #unde‡
DMATRIG_TX


211 #i‡ (
HAL_UART_SPI
 == 1)

212 
	#DMA_PAD
 
U0BAUD


	)

213 
	#DMA_UxDBUF
 
HAL_DMA_U0DBUF


	)

214 
	#DMATRIG_RX
 
HAL_DMA_TRIG_URX0


	)

215 
	#DMATRIG_TX
 
HAL_DMA_TRIG_UTX0


	)

216 #ñi‡ (
HAL_UART_SPI
 == 2)

217 
	#DMA_PAD
 
U1BAUD


	)

218 
	#DMA_UxDBUF
 
HAL_DMA_U1DBUF


	)

219 
	#DMATRIG_RX
 
HAL_DMA_TRIG_URX1


	)

220 
	#DMATRIG_TX
 
HAL_DMA_TRIG_UTX1


	)

223 #unde‡
PxIEN


224 #unde‡
PxIFG


225 #unde‡
PxIF


226 #unde‡
PICTL_BIT


227 #unde‡
IENx


228 #unde‡
IEN_BIT


229 #i‡ ((
HAL_UART_SPI
 =1Ë|| 
deföed
 
HAL_SPI_MASTER
)

230 
	#PxIEN
 
P0IEN


	)

231 
	#PxIFG
 
P0IFG


	)

232 
	#PxIF
 
P0IF


	)

233 #i‡!
deföed
 
SPI_RDYIn


234 
	#SPI_RDYIn
 
P0_1


	)

235 
	#SPI_RDYIn_BIT
 
	`BV
(1)

	)

238 
	#PICTL_BIT
 
	`BV
(0)

	)

239 
	#IENx
 
IEN1


	)

240 
	#IEN_BIT
 
	`BV
(5)

	)

241 #ñi‡ (
HAL_UART_SPI
 == 2)

242 
	#PxIEN
 
P1IEN


	)

243 
	#PxIFG
 
P1IFG


	)

244 
	#PxIF
 
P1IF


	)

245 
	#SPI_RDYIn
 
P1_4


	)

246 
	#SPI_RDYIn_BIT
 
	`BV
(4)

	)

248 
	#PICTL_BIT
 
	`BV
(2)

	)

249 
	#IENx
 
IEN2


	)

250 
	#IEN_BIT
 
	`BV
(4)

	)

253 #unde‡
PxDIR


254 #i‡ ((
HAL_UART_SPI
 =1Ë|| 
deföed
 
HAL_SPI_MASTER
)

255 
	#PxDIR
 
P1DIR


	)

256 
	#SPI_RDYOut
 
P1_4


	)

257 
	#SPI_RDYOut_BIT
 
	`BV
(4)

	)

258 #ñi‡ (
HAL_UART_SPI
 == 2)

259 
	#PxDIR
 
P0DIR


	)

260 
	#SPI_RDYOut
 
P0_5


	)

261 
	#SPI_RDYOut_BIT
 
	`BV
(5)

	)

269 #i‡(
SPI_MAX_PKT_LEN
 <= 256)

270 
uöt8
 
	t•iLí_t
;

272 
uöt16
 
	t•iLí_t
;

277 
	m•iRxSãSOF
,

278 
	m•iRxSãLí
,

279 
	m•iRxSãD©a
,

280 
	m•iRxSãFcs


281 } 
	t•iRxSã_t
;

288 #i‡
SPI_MAX_PKT_LEN
 == 256

289 
	#SPI_LEN_T_INCR
(
LEN
Ë(LEN)++

	)

290 
	#SPI_LEN_T_BOUNDS_CHECK
(
LEN
)

	)

292 
	#SPI_LEN_T_INCR
(
LEN
Ë
	`°
 ( \

293 i‡(++(
LEN
Ë>
SPI_MAX_PKT_LEN
) \

295 (
LEN
) = 0; \

297 )

	)

299 
	#SPI_LEN_T_BOUNDS_CHECK
(
LEN
Ë
	`°
 ( \

300 i‡(
Àn
 > 
SPI_MAX_PKT_LEN
) \

302 
Àn
 = 
SPI_MAX_PKT_LEN
; \

304 )

	)

307 
	#SPI_CLR_RX_BYTE
(
IDX
Ë(
•iRxBuf
[(IDX)] = 
	`BUILD_UINT16
(0, (
DMA_PAD
 ^ 0xFF)))

	)

308 
	#SPI_GET_RX_BYTE
(
IDX
Ë(*(vﬁ©ûê
uöt8
 *)(
•iRxBuf
+(IDX)))

	)

309 
	#SPI_NEW_RX_BYTE
(
IDX
Ë((
uöt8
)
DMA_PAD
 =
	`HI_UINT16
(
•iRxBuf
[(IDX)]))

	)

311 
	#SPI_DAT_LEN
(
PBUF
Ë((PBUF)[
SPI_LEN_IDX
])

	)

312 
	#SPI_PKT_LEN
(
PBUF
Ë(
	`SPI_DAT_LEN
((PBUF)Ë+ 
SPI_FRM_LEN
)

	)

314 
	#SPI_RDY_IN
(Ë(
SPI_RDYIn
 =0)

	)

315 
	#SPI_RDY_OUT
(Ë(
SPI_RDYOut
 =0)

	)

317 #i‡
deföed
 
HAL_SPI_MASTER


318 
	#SPI_CLR_CSn_OUT
(Ë(
SPI_RDYOut
 = 1)

	)

319 
	#SPI_SET_CSn_OUT
(Ë(
SPI_RDYOut
 = 0)

	)

321 
	#SPI_CLOCK_RX
(
CNT
Ë
	`°
 ( \

322 
	`SPI_SET_CSn_OUT
(); \

324 
•iLí_t
 
˙t
 = 0; c¡ <(
CNT
); cnt++) \

326 
UxDBUF
 = 0; \

327 
UxCSR
 & 
CSR_ACTIVE
); \

330 
	`SPI_CLR_CSn_OUT
(); \

331 )

	)

332 
	#SPI_CLR_RDY_OUT
(Ë
	`SPI_CLR_CSn_OUT
()

	)

334 #ñi‡!
deföed
 
HAL_SPI_MASTER


335 
	#SPI_CLR_RDY_OUT
(Ë(
SPI_RDYOut
 = 1)

	)

336 
	#SPI_SET_RDY_OUT
(Ë(
SPI_RDYOut
 = 0)

	)

337 
	#SPI_TOG_RDY_OUT
(Ë
	`°
 ( \

338 i‡(
	`SPI_RDY_OUT
()) \

340 
	`SPI_CLR_RDY_OUT
(); \

344 
	`SPI_SET_RDY_OUT
(); \

346 )

	)

349 
	#SPI_RX_RDY
(Ë(
•iRxHód
 !
•iRxTaû
)

	)

358 #i‡
HAL_SPI_ON_UART_BUFS


359 
uöt16
 *c⁄° 
	g•iRxBuf
 = 
dmaCfg
.
rxBuf
;

360 #i‡(
deföed
 
HAL_UART_TX_BY_ISR
 && HAL_UART_TX_BY_ISR)

361 
uöt8
 *c⁄° 
	g•iRxD©
 = 
dmaCfg
.
txBuf
;

362 
__no_öô
 
uöt8
 
	g•iTxPkt
[
SPI_MAX_PKT_LEN
];

364 
uöt8
 *c⁄° 
	g•iRxD©
 = 
dmaCfg
.
txBuf
[0];

365 
uöt8
 *c⁄° 
	g•iTxPkt
 = 
dmaCfg
.
txBuf
[1];

368 
__no_öô
 
uöt16
 
	g•iRxBuf
[
SPI_MAX_PKT_LEN
];

369 
__no_öô
 
uöt8
 
	g•iRxD©
[
SPI_MAX_PKT_LEN
];

370 
__no_öô
 
uöt8
 
	g•iTxPkt
[
SPI_MAX_PKT_LEN
];

373 #i‡
HAL_SPI_QUEUED_TX


374 
oßl_msg_q_t
 
	g•iTxQ
;

375 vﬁ©ûê
uöt8
 
	g•iTxMT
;

378 
•iRxSã_t
 
	g•iRxSã
;

379 
•iLí_t
 
	g•iRxIdx
;

380 
•iLí_t
 
	g•iRxC¡
;

381 
•iLí_t
 
	g•iRxLí
;

382 
•iLí_t
 
	g•iRxFcs
;

384 
•iLí_t
 
	g•iRxHód
;

385 
•iLí_t
 
	g•iRxTaû
;

386 
•iLí_t
 
	g•iRxTemp
;

390 vﬁ©ûê
•iLí_t
 
	g•iTxLí
;

392 
hÆUARTCBack_t
 
	g•iCB
;

394 #i‡(
deföed
 
POWER_SAVING
 || (deföed 
HAL_SPI_MASTER
 && 
HAL_SPI_WAKEUP
))

395 vﬁ©ûê
uöt8
 
	g•iRdyI§
;

398 #i‡
deföed
 
POWER_SAVING


399 
uöt8
 
	g•iHﬁdPM
;

407 
•iLí_t
 
	g•iRxBug
;

414 
HÆUART_DMAI§SPI
();

421 
uöt8
 
•iCÆcFcs
(uöt8 *
pBuf
);

422 
•iP¨£Rx
();

423 #i‡
deföed
 
POWER_SAVING


424 
uöt8
 
•iSwìpRx
();

442 
	$HÆUARTInôSPI
()

444 #i‡(
HAL_UART_SPI
 == 1)

445 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

447 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

449 #i‡
deföed
 
HAL_SPI_MASTER


450 
PxSEL
 |
HAL_UART_Px_SEL_M
;

451 
UxCSR
 = 0;

452 
UxGCR
 = 16;

453 
UxBAUD
 = 255;

454 #ñi‡!
deföed
 
HAL_SPI_MASTER


455 
PxSEL
 |
HAL_UART_Px_SEL_S
;

456 
UxCSR
 = 
CSR_SLAVE
;

458 
UxUCR
 = 
UCR_FLUSH
;

459 
UxGCR
 |
	`BV
(5);

461 
P2DIR
 &~
P2DIR_PRIPO
;

462 
P2DIR
 |
HAL_UART_PRIPO
;

465 
PxIEN
 |
SPI_RDYIn_BIT
;

466 
PICTL
 |
PICTL_BIT
;

468 
	`SPI_CLR_RDY_OUT
();

469 
PxDIR
 |
SPI_RDYOut_BIT
;

472 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_SPI_CH_TX
 );

475 
	`HAL_DMA_SET_DEST
–
ch
, 
DMA_UxDBUF
 );

478 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

481 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

484 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

485 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
DMATRIG_TX
 );

488 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_1
 );

489 
	`HAL_DMA_SET_SOURCE
–
ch
, 
•iTxPkt
 );

492 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_0
 );

495 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_ENABLE
 );

498 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

501 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

504 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_SPI_CH_RX
 );

507 
	`HAL_DMA_SET_SOURCE
–
ch
, 
DMA_UxDBUF
 );

510 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

519 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_WORD
 );

522 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE_REPEATED
 );

523 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
DMATRIG_RX
 );

526 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_0
 );

529 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_1
 );

530 
	`HAL_DMA_SET_DEST
–
ch
, 
•iRxBuf
 );

531 
	`HAL_DMA_SET_LEN
–
ch
, 
SPI_MAX_PKT_LEN
 );

534 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

537 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

540 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

542 vﬁ©ûê
uöt8
 
dummy
 = *(vﬁ©ûêuöt8 *)
DMA_UxDBUF
;

543 
	`HAL_DMA_CLEAR_IRQ
(
HAL_SPI_CH_RX
);

544 
	`HAL_DMA_ARM_CH
(
HAL_SPI_CH_RX
);

545 ()
	`mem£t
(
•iRxBuf
, (
DMA_PAD
 ^ 0xFF), 
SPI_MAX_PKT_LEN
 * (
uöt16
));

546 
	}
}

563 
	$HÆUARTO≥nSPI
(
hÆUARTCfg_t
 *
c⁄fig
)

565 
•iCB
 = 
c⁄fig
->
ˇŒBackFunc
;

567 
UxCSR
 |
CSR_RE
;

569 
PxIFG
 = 0;

570 
PxIF
 = 0;

571 
IENx
 |
IEN_BIT
;

572 
	}
}

590 
•iLí_t
 
	$HÆUARTRódSPI
(
uöt8
 *
buf
, 
•iLí_t
 
Àn
)

592 
•iLí_t
 
˙t
 = 0; c¡ < 
Àn
; cnt++)

594 i‡(
•iRxHód
 =
•iRxTaû
)

596 
Àn
 = 
˙t
;

600 *
buf
++ = 
•iRxD©
[
•iRxHód
];

601 
	`SPI_LEN_T_INCR
(
•iRxHód
);

604  
Àn
;

605 
	}
}

623 
•iLí_t
 
	$HÆUARTWrôeSPI
(
uöt8
 *
buf
, 
•iLí_t
 
Àn
)

625 i‡(
•iTxLí
 != 0)

627 #i‡
HAL_SPI_QUEUED_TX


628 
uöt8
 *
txMsg
 = 
	`oßl_msg_Æloˇã
(
Àn
);

630 i‡(
txMsg
 !
NULL
)

632 ()
	`mem˝y
(
txMsg
, 
buf
, 
Àn
);

633 
	`oßl_msg_íqueue
(&
•iTxQ
, 
txMsg
);

635  
Àn
;

642 i‡(
Àn
 > 
SPI_MAX_DAT_LEN
)

644 
Àn
 = 
SPI_MAX_DAT_LEN
;

646 
•iTxLí
 = 
Àn
;

647 #i‡
HAL_SPI_QUEUED_TX


648 
•iTxMT
 = 
FALSE
;

651 
•iTxPkt
[
SPI_LEN_IDX
] = 
Àn
;

652 ()
	`mem˝y
(
•iTxPkt
 + 
SPI_DAT_IDX
, 
buf
, 
Àn
);

654 
	`•iCÆcFcs
(
•iTxPkt
);

655 
•iTxPkt
[
SPI_SOF_IDX
] = 
SPI_SOF
;

657 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
(
HAL_SPI_CH_TX
);

658 
	`HAL_DMA_SET_LEN
(
ch
, 
	`SPI_PKT_LEN
(
•iTxPkt
));

660 #i‡
deföed
 
HAL_SPI_MASTER


661 #i‡
HAL_SPI_WAKEUP


668 
•iRdyI§
 = 0;

669 !
	`SPI_RDY_IN
(Ë&& (
•iRdyI§
 == 0))

671 
	`SPI_CLOCK_RX
(1);

673 
uöt16
 
˙t
 = 0; cnt < 512; cnt++)

675 i‡(
	`SPI_RDY_IN
(Ë|| (
•iRdyI§
 != 0))

682 
	`SPI_SET_CSn_OUT
();

683 
	`HAL_DMA_ARM_CH
(
HAL_SPI_CH_TX
);

684 
	`asm
("NOP");ásm("NOP");ásm("NOP");ásm("NOP");ásm("NOP");

685 
	`asm
("NOP");ásm("NOP");ásm("NOP");ásm("NOP");

686 
	`HAL_DMA_MAN_TRIGGER
(
HAL_SPI_CH_TX
);

688 #ñi‡!
deföed
 
HAL_SPI_MASTER


690 
	`HAL_DMA_ARM_CH
(
HAL_SPI_CH_TX
);

691 
	`asm
("NOP");ásm("NOP");ásm("NOP");ásm("NOP");ásm("NOP");

692 
	`asm
("NOP");ásm("NOP");ásm("NOP");ásm("NOP");

693 
	`SPI_SET_RDY_OUT
();

696  
Àn
;

697 
	}
}

714 
	$HÆUARTPﬁlSPI
()

716 #i‡
HAL_SPI_QUEUED_TX


722 i‡((
•iTxLí
 =0Ë&& (
•iTxQ
 !
NULL
))

724 
uöt8
 *
txMsg
 = 
	`oßl_msg_dequeue
(&
•iTxQ
);

726 ()
	`HÆUARTWrôeSPI
(
txMsg
, 
	`OSAL_MSG_LEN
(txMsg));

727 ()
	`oßl_msg_dóŒoˇã
(
txMsg
);

729 i‡(
•iTxMT
)

731 
•iTxMT
 = 
FALSE
;

732 
	`•iCB
((
HAL_UART_SPI
 - 1), 
HAL_UART_TX_EMPTY
);

736 
	`•iP¨£Rx
();

738 #i‡
HAL_SPI_QUEUED_TX
 || 
deföed
 
HAL_SPI_MASTER


739 i‡(
	`SPI_RX_RDY
())

745 i‡(
	`SPI_RX_RDY
(Ë&& !
•iTxLí
)

748 i‡(
•iCB
 !
NULL
)

750 
	`•iCB
((
HAL_UART_SPI
 - 1), 
HAL_UART_RX_TIMEOUT
);

754 
PxIEN
 &~
SPI_RDYIn_BIT
;

756 i‡(!
	`SPI_RDY_IN
(Ë&& !
•iTxLí
)

758 
	`SPI_CLR_RDY_OUT
();

761 #i‡
deföed
 
POWER_SAVING


762 i‡(
	`SPI_RDY_IN
(Ë|| 
	`SPI_RX_RDY
(Ë|| 
•iRxLí
 || 
•iTxLí
 || 
•iRdyI§
)

764 
•iRdyI§
 = 0;

766 i‡(
•iHﬁdPM
 == 0)

768 
•iHﬁdPM
 = 1;

769 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_HOLD_EVENT
);

774 
•iRdyI§
 = 0;

776 i‡(
•iHﬁdPM
 != 0)

778 
PxIEN
 |
SPI_RDYIn_BIT
;

780 i‡(
	`•iSwìpRx
())

782 
•iHﬁdPM
 = 0;

783 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_CONSERVE_EVENT
);

789 
PxIEN
 |
SPI_RDYIn_BIT
;

790 
	}
}

807 
•iLí_t
 
	$HÆUARTRxAvaûSPI
()

809  (
•iRxTaû
 > 
•iRxHód
Ë? (•iRxTaû-•iRxHódË: (•iRxTaû+(
SPI_MAX_PKT_LEN
-spiRxHead));

810 
	}
}

827 
uöt8
 
	$•iCÆcFcs
(
uöt8
 *
pBuf
)

829 
•iLí_t
 
Àn
 = 
	`SPI_DAT_LEN
(
pBuf
Ë+ 
SPI_HDR_LEN
 + 
SPI_HDR_IDX
;

830 
•iLí_t
 
idx
 = 
SPI_HDR_IDX
;

831 
uöt8
 
fcs
 = 0;

833 
idx
 < 
Àn
)

835 
fcs
 ^
pBuf
[
idx
++];

837 
pBuf
[
idx
] = 
fcs
;

839  
fcs
;

840 
	}
}

857 
	$•iP¨£Rx
()

861 i‡(!
	`SPI_NEW_RX_BYTE
(
•iRxIdx
))

863 #i‡
deföed
 
HAL_SPI_MASTER


864 i‡(
	`SPI_RDY_IN
(Ë&& (
•iTxLí
 == 0))

866 
	`SPI_CLOCK_RX
(1);

871 i‡(
	`SPI_NEW_RX_BYTE
(
•iRxBug
))

873 !
	`SPI_NEW_RX_BYTE
(
•iRxIdx
))

875 
	`SPI_LEN_T_INCR
(
•iRxIdx
);

878 
•iRxBug
 = 
•iRxIdx
;

882 
	`SPI_LEN_T_INCR
(
•iRxBug
);

886 
uöt8
 
ch
 = 
	`SPI_GET_RX_BYTE
(
•iRxIdx
);

887 
	`SPI_CLR_RX_BYTE
(
•iRxIdx
);

888 
	`SPI_LEN_T_INCR
(
•iRxIdx
);

890 
•iRxSã
)

892 
•iRxSãSOF
:

893 i‡(
ch
 =
SPI_SOF
)

895 
•iRxSã
 = 
•iRxSãLí
;

901 
•iRxLí
 = 1;

905 
•iRxSãLí
:

906 i‡((
ch
 =0Ë|| (ch > 
SPI_MAX_DAT_LEN
))

908 
•iRxSã
 = 
•iRxSãSOF
;

909 
•iRxLí
 = 0;

913 
•iRxFcs
 = 
•iRxLí
 = 
ch
;

914 
•iRxTemp
 = 
•iRxTaû
;

915 
•iRxC¡
 = 0;

916 
•iRxSã
 = 
•iRxSãD©a
;

917 #i‡
deföed
 
HAL_SPI_MASTER


918 
	`SPI_CLOCK_RX
(
ch
 + 1);

923 
•iRxSãD©a
:

924 
•iRxFcs
 ^
ch
;

925 
•iRxD©
[
•iRxTemp
] = 
ch
;

926 
	`SPI_LEN_T_INCR
(
•iRxTemp
);

928 i‡(++
•iRxC¡
 =
•iRxLí
)

930 
•iRxSã
 = 
•iRxSãFcs
;

934 
•iRxSãFcs
:

935 
•iRxSã
 = 
•iRxSãSOF
;

937 i‡(
ch
 =
•iRxFcs
)

939 
•iRxTaû
 = 
•iRxTemp
;

942 
•iRxC¡
 = 
•iRxLí
 = 0;

946 
	`HAL_ASSERT
(0);

950 
	}
}

952 #i‡
deföed
 
POWER_SAVING


972 
uöt8
 
	$•iSwìpRx
()

974 
•iLí_t
 
swìpIdx
 = 
•iRxIdx
;

977 i‡(
	`SPI_NEW_RX_BYTE
(
swìpIdx
))

979 
•iRxBug
 = 
•iRxIdx
 = 
swìpIdx
++;

983 
	`SPI_LEN_T_INCR
(
swìpIdx
);

985 } 
swìpIdx
 !
•iRxIdx
);

987  (
swìpIdx
 =
•iRxIdx
);

988 
	}
}

1006 
	$HÆUART_DMAI§SPI
()

1008 #i‡!
deföed
 
HAL_SPI_MASTER


1009 i‡(!
	`SPI_RDY_IN
())

1012 
	`SPI_CLR_RDY_OUT
();

1014 
•iTxLí
 = 0;

1016 #i‡
HAL_SPI_QUEUED_TX


1017 i‡(
•iTxQ
 !
NULL
)

1019 
uöt8
 *
txMsg
 = 
	`oßl_msg_dequeue
(&
•iTxQ
);

1021 ()
	`HÆUARTWrôeSPI
(
txMsg
, 
	`OSAL_MSG_LEN
(txMsg));

1022 ()
	`oßl_msg_dóŒoˇã
(
txMsg
);

1026 
•iTxMT
 = 
TRUE
;

1029 
	`•iCB
((
HAL_UART_SPI
 - 1), 
HAL_UART_TX_EMPTY
);

1031 
	}
}

1042 #i‡
deföed
 
HAL_SBL_BOOT_CODE


1043 
	$•iRdyIn
()

1046 #i‡ ((
HAL_UART_SPI
 =1Ë|| 
deföed
 
HAL_SPI_MASTER
)

1047 
	$HAL_ISR_FUNCTION
(
p‹t0I§
, 
P0INT_VECTOR
)

1048 #ñi‡(
HAL_UART_SPI
 == 2)

1049 
	$HAL_ISR_FUNCTION
(
p‹t1I§
, 
P1INT_VECTOR
)

1052 
	`HAL_ENTER_ISR
();

1055 
PxIFG
 = 0;

1056 
PxIF
 = 0;

1058 #i‡(
deföed
 
POWER_SAVING
 || (deföed 
HAL_SPI_MASTER
 && 
HAL_SPI_WAKEUP
))

1059 
•iRdyI§
 = 1;

1061 #i‡!
deföed
 
HAL_SPI_MASTER


1062 i‡(
•iTxLí
 == 0)

1064 
	`SPI_TOG_RDY_OUT
();

1068 #i‡!
deföed
 
HAL_SBL_BOOT_CODE


1069 
	`CLEAR_SLEEP_MODE
();

1070 
	`HAL_EXIT_ISR
();

1072 
	}
}

	@Components/hal/target/CC2540EB/hal_adc.c

44 
	~"hÆ_adc.h
"

45 
	~"hÆ_defs.h
"

46 
	~"hÆ_mcu.h
"

47 
	~"hÆ_ty≥s.h
"

52 
	#HAL_ADC_EOC
 0x80

	)

53 
	#HAL_ADC_START
 0x40

	)

55 
	#HAL_ADC_STSEL_EXT
 0x00

	)

56 
	#HAL_ADC_STSEL_FULL
 0x10

	)

57 
	#HAL_ADC_STSEL_T1C0
 0x20

	)

58 
	#HAL_ADC_STSEL_ST
 0x30

	)

60 
	#HAL_ADC_RAND_NORM
 0x00

	)

61 
	#HAL_ADC_RAND_LFSR
 0x04

	)

62 
	#HAL_ADC_RAND_SEED
 0x08

	)

63 
	#HAL_ADC_RAND_STOP
 0x0¯

	)

64 
	#HAL_ADC_RAND_BITS
 0x0¯

	)

66 
	#HAL_ADC_DEC_064
 0x00

	)

67 
	#HAL_ADC_DEC_128
 0x10

	)

68 
	#HAL_ADC_DEC_256
 0x20

	)

69 
	#HAL_ADC_DEC_512
 0x30

	)

70 
	#HAL_ADC_DEC_BITS
 0x30

	)

72 
	#HAL_ADC_STSEL
 
HAL_ADC_STSEL_ST


	)

73 
	#HAL_ADC_RAND_GEN
 
HAL_ADC_RAND_STOP


	)

74 
	#HAL_ADC_REF_VOLT
 
HAL_ADC_REF_AVDD


	)

75 
	#HAL_ADC_DEC_RATE
 
HAL_ADC_DEC_064


	)

76 
	#HAL_ADC_SCHN
 
HAL_ADC_CHN_VDD3


	)

77 
	#HAL_ADC_ECHN
 
HAL_ADC_CHN_GND


	)

84 #i‡(
HAL_ADC
 =
TRUE
)

85 
uöt8
 
	gadcRef
;

97 
	$HÆAdcInô
 ()

99 #i‡(
HAL_ADC
 =
TRUE
)

100 
adcRef
 = 
HAL_ADC_REF_VOLT
;

102 
	}
}

117 
uöt16
 
	$HÆAdcRód
 (
uöt8
 
ch™√l
, uöt8 
ªsﬁuti⁄
)

119 
öt16
 
ªadög
 = 0;

121 #i‡(
HAL_ADC
 =
TRUE
)

122 
uöt8
 
i
, 
ªsbôs
;

123 
uöt8
 
adcCh™√l
 = 1;

133 i‡(
ch™√l
 < 8)

135 
i
=0; i < 
ch™√l
; i++)

137 
adcCh™√l
 <<= 1;

142 
ADCCFG
 |
adcCh™√l
;

145 
ªsﬁuti⁄
)

147 
HAL_ADC_RESOLUTION_8
:

148 
ªsbôs
 = 
HAL_ADC_DEC_064
;

150 
HAL_ADC_RESOLUTION_10
:

151 
ªsbôs
 = 
HAL_ADC_DEC_128
;

153 
HAL_ADC_RESOLUTION_12
:

154 
ªsbôs
 = 
HAL_ADC_DEC_256
;

156 
HAL_ADC_RESOLUTION_14
:

158 
ªsbôs
 = 
HAL_ADC_DEC_512
;

163 
ADCCON3
 = 
ch™√l
 | 
ªsbôs
 | 
adcRef
;

166 !(
ADCCON1
 & 
HAL_ADC_EOC
));

169 
ADCCFG
 &(
adcCh™√l
 ^ 0xFF);

172 
ªadög
 = (
öt16
Ë(
ADCL
);

173 
ªadög
 |(
öt16
Ë(
ADCH
 << 8);

176 i‡(
ªadög
 < 0)

177 
ªadög
 = 0;

179 
ªsﬁuti⁄
)

181 
HAL_ADC_RESOLUTION_8
:

182 
ªadög
 >>= 8;

184 
HAL_ADC_RESOLUTION_10
:

185 
ªadög
 >>= 6;

187 
HAL_ADC_RESOLUTION_12
:

188 
ªadög
 >>= 4;

190 
HAL_ADC_RESOLUTION_14
:

192 
ªadög
 >>= 2;

197 (Ë
ch™√l
;

198 (Ë
ªsﬁuti⁄
;

201  ((
uöt16
)
ªadög
);

202 
	}
}

214 
	$HÆAdcSëRe„ªn˚
 ( 
uöt8
 
ª„ªn˚
 )

216 #i‡(
HAL_ADC
 =
TRUE
)

217 
adcRef
 = 
ª„ªn˚
;

219 
	}
}

232 
boﬁ
 
	$HÆAdcCheckVdd
(
uöt8
 
vdd
)

234 
ADCCON3
 = 0x0F;

235 !(
ADCCON1
 & 0x80));

236  (
ADCH
 > 
vdd
);

237 
	}
}

	@Components/hal/target/CC2540EB/hal_aes.c

42 
	~"oßl.h
"

43 
	~"hÆ_´s.h
"

44 
	~"hÆ_dma.h
"

66 (*
pS•AesEn¸y±
)–
uöt8
 *, uöt8 * ) = (*)
NULL
;

71 
	`´sDmaInô
( );

73 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

85 
	$´sDmaInô
( )

87 
hÆDMADesc_t
 *
ch
;

90 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

91 
	`HAL_DMA_SET_DEST
–
ch
, 
HAL_AES_IN_ADDR
 );

92 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

93 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

94 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

95 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
HAL_DMA_TRIG_ENC_DW
 );

96 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_1
 );

97 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_0
 );

98 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

99 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

100 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

103 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_OUT
 );

104 
	`HAL_DMA_SET_SOURCE
–
ch
, 
HAL_AES_OUT_ADDR
 );

105 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

106 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

107 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

108 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
HAL_DMA_TRIG_ENC_UP
 );

109 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_0
 );

110 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_1
 );

111 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

112 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

113 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

114 
	}
}

117 #i‡(!
deföed
 
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

129 
	$AesLﬂdBlock
–
uöt8
 *
±r
 )

131 
uöt8
 
i
;

134 
	`AES_START
();

137 
i
 = 0; i < 
STATE_BLENGTH
; i++)

139 
ENCDI
 = *
±r
++;

141 
	}
}

155 
	$AesSèπBlock
–
uöt8
 *
out
, uöt8 *
ö
 )

157 
uöt8
 
i
;

160 
	`AES_START
();

163 
i
 = 0; i < 
STATE_BLENGTH
; i++)

165 
ENCDI
 = *
ö
++;

169 
	`HAL_AES_DELAY
();

172 
i
 = 0; i < 
STATE_BLENGTH
; i++)

174 *
out
++ = 
ENCDO
;

176 
	}
}

192 
	$AesSèπSh‹tBlock
–
uöt8
 *
out
, uöt8 *
ö
 )

194 
uöt8
 
i
, 
j
;

196 
	`AES_START
();

197 
i
 = 0; i < 4; i++)

200 
j
 = 0; j < 4; j++)

202 
ENCDI
 = *
ö
++;

206 
	`HAL_AES_DELAY
();

209 
j
 = 0; j < 4; j++)

211 *
out
++ = 
ENCDO
;

214 
	}
}

228 
	$AesLﬂdIV
–
uöt8
 *
IV
 )

230 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

231 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

234 
	`HAL_DMA_SET_SOURCE
–
ch
, 
IV
 );

235 
	`HAL_DMA_SET_LEN
–
ch
, 
STATE_BLENGTH
 );

238 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

239 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

241 
	`asm
("NOP");

242 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

245 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_IV
 );

248 
	`AES_START
();

249  !(
ENCCS
 & 0x08) );

252 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_IV
 );

255 
	`AesLﬂdBlock
–
IV
 );

257 
	}
}

270 
	$AesLﬂdKey
–
uöt8
 *
AesKey
 )

272 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

273 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

276 
	`HAL_DMA_SET_SOURCE
–
ch
, 
AesKey
 );

277 
	`HAL_DMA_SET_LEN
–
ch
, 
KEY_BLENGTH
 );

280 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

281 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

283 
	`asm
("NOP");

284 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

287 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_KEY
 );

290 
	`AES_START
();

291  !(
ENCCS
 & 0x08) );

294 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_KEY
 );

297 
	`AesLﬂdBlock
–
AesKey
 );

299 
	}
}

301 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

321 
	$AesDmaSëup
–
uöt8
 *
C°©e
, 
uöt16
 
msg_out_Àn
, uöt8 *
msg_ö
, uöt16 
msg_ö_Àn
 )

323 
hÆDMADesc_t
 *
ch
;

326 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

327 
	`HAL_DMA_SET_SOURCE
–
ch
, 
msg_ö
 );

328 
	`HAL_DMA_SET_LEN
–
ch
, 
msg_ö_Àn
 );

331 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_OUT
 );

332 
	`HAL_DMA_SET_DEST
–
ch
, 
C°©e
 );

333 
	`HAL_DMA_SET_LEN
–
ch
, 
msg_out_Àn
 );

336 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

337 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

339 
	`asm
("NOP");

340 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

341 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_OUT
 );

342 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_OUT
 );

344 
	`asm
("NOP");

345 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_OUT
));

346 
	}
}

360 
	$HÆAesInô
( )

362 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

364 
	`´sDmaInô
();

366 
	}
}

379 
	$s•_HW_KeyInô
–
uöt8
 *
AesKey
 )

381 
	`AES_SETMODE
(
ECB
);

382 
	`AesLﬂdKey
–
AesKey
 );

383 
	}
}

402 
	$s•AesEn¸y±HW
–
uöt8
 *
AesKey
, uöt8 *
C°©e
 )

404 ()
AesKey
;

406 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

408 
	`AesDmaSëup
–
C°©e
, 
STATE_BLENGTH
, Cstate, STATE_BLENGTH );

409 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_ENCRYPT
 );

412 
	`AES_START
();

413  !
	`HAL_DMA_CHECK_IRQ
–
HAL_DMA_AES_OUT
 ) );

416 
	`AES_SETMODE
(
ECB
);

417 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_ENCRYPT
 );

420 
	`AesSèπBlock
–
C°©e
, Cstate );

422 
	}
}

	@Components/hal/target/CC2540EB/hal_aes.h

39 #i‚de‡
HAL_AES_H_


40 
	#HAL_AES_H_


	)

42 
	~"hÆ_ty≥s.h
"

44 
	#STATE_BLENGTH
 16

45 
	#KEY_BLENGTH
 16

46 
	#KEY_EXP_LENGTH
 176

47 

	)

52 #i‡((
deföed
 
SOFTWARE_AES
Ë&& (SOFTWARE_AES =
TRUE
)Ë&& ((deföed 
SW_AES_AND_KEY_EXP
) && (SW_AES_AND_KEY_EXP == TRUE))

56 
HÆAesInô
( );

57 
AesLﬂdBlock
–
uöt8
 * );

58 
AesSèπBlock
–
uöt8
 *, uint8 * );

59 
AesSèπSh‹tBlock
–
uöt8
 *, uint8 * );

60 
AesLﬂdIV
(
uöt8
 *);

61 
AesDmaSëup
–
uöt8
 *, 
uöt16
, uint8 *, uint16 );

62 
AesLﬂdKey
–
uöt8
 * );

64 (*
pS•AesEn¸y±
)–
uöt8
 *, uint8 * );

65 
	`s•_HW_KeyInô
 (
uöt8
 *);

66 
	`s•KeyEx∑nsi⁄
 (
uöt8
 *, uint8 *);

68 
	`s•AesEn¸y±HW
 (
uöt8
 *, uint8 *);

69 
	`s•AesEn¸y±KeyExp
 (
uöt8
 *, uint8 *);

70 
	`s•AesEn¸y±Basic
 (
uöt8
 *, uint8 *);

72 
	`s•AesDe¸y±HW
–
uöt8
 *, uint8 * );

73 
	`s•AesDe¸y±
–
uöt8
 *
key
, uöt8 *
buf
 );

76 
	#AES_BUSY
 0x08

	)

77 
	#ENCRYPT
 0x00

	)

78 
	#DECRYPT
 0x01

	)

81 
	#AES_SETMODE
(
mode
) \

83 
ENCCS
 = (ENCCS & ~0x70Ë| (
mode
); \

84 
	}
} 0)

	)

87 
	#CBC
 0x00

	)

88 
	#CFB
 0x10

	)

89 
	#OFB
 0x20

	)

90 
	#CTR
 0x30

	)

91 
	#ECB
 0x40

	)

92 
	#CBC_MAC
 0x50

	)

95 
	#AES_SET_ENCR_DECR_KEY_IV
(
cmd
) \

97 
ENCCS
 = (ENCCS & ~0x07Ë| (
cmd
); \

98 } 0)

	)

101 
	#AES_ENCRYPT
 0x00

	)

102 
	#AES_DECRYPT
 0x02

	)

103 
	#AES_LOAD_KEY
 0x04

	)

104 
	#AES_LOAD_IV
 0x06

	)

108 
	#AES_START
(Ë
ENCCS
 |0x01

	)

111 
	#HAL_DMA_AES_IN
 1

	)

112 
	#HAL_DMA_AES_OUT
 2

	)

115 
	#HAL_AES_IN_ADDR
 0x70B1

	)

116 
	#HAL_AES_OUT_ADDR
 0x70B2

	)

118 #i‡!
deföed
 (
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

119 
	#HAL_AES_DELAY
() \

121 vﬁ©ûê
uöt8
 
dñay
 = 15; \

122 
dñay
--); \

123 } 0)

	)

	@Components/hal/target/CC2540EB/hal_board_cfg.h

42 #i‚de‡
HAL_BOARD_CFG_H


43 
	#HAL_BOARD_CFG_H


	)

45 #ifde‡
__˝lu•lus


55 
	~"hÆ_mcu.h
"

56 
	~"hÆ_defs.h
"

57 
	~"hÆ_ty≥s.h
"

65 #i‡!
deföed
 (
HAL_BOARD_CC2530EB_REV17
Ë&& !deföed (
HAL_BOARD_CC2530EB_REV13
)

66 
	#HAL_BOARD_CC2530EB_REV17


	)

71 
	#HAL_CPU_CLOCK_MHZ
 32

	)

75 
	#EXTERNAL_CRYSTAL_OSC
 0x00

76 
	#INTERNAL_RC_OSC
 0x80

77 

	)

79 #i‡!
deföed
 (
XOSC32K_INSTALLED
Ë|| (deföed (XOSC32K_INSTALLEDË&& (XOSC32K_INSTALLED =
TRUE
))

80 
	#OSC_32KHZ
 
EXTERNAL_CRYSTAL_OSC


	)

82 
	#OSC_32KHZ
 
INTERNAL_RC_OSC


	)

86 
	#MIN_TIME_TO_STABLE_32KHZ_XOSC
 400

	)

89 
	#HAL_LCD_MAX_CHARS
 16

	)

90 
	#HAL_LCD_MAX_BUFF
 25

	)

94 #i‡
deföed
 (
HAL_BOARD_CC2530EB_REV17
Ë&& !deföed (
HAL_PA_LNA
Ë&& !deföed (
HAL_PA_LNA_CC2590
)

95 
	#HAL_NUM_LEDS
 3

	)

96 #ñi‡
deföed
 (
HAL_BOARD_CC2530EB_REV13
Ë|| deföed (
HAL_PA_LNA
Ë|| deföed (
HAL_PA_LNA_CC2590
)

97 
	#HAL_NUM_LEDS
 1

	)

99 #îr‹ 
Unknown
 
Bﬂrd
 
Indítifõr


102 
	#HAL_LED_BLINK_DELAY
(Ë
	`°
–{ vﬁ©ûê
uöt32
 
i
; i=0; i<0x5800; i++Ë{ }; } )

	)

105 
	#LED1_BV
 
	`BV
(0)

	)

106 
	#LED1_SBIT
 
P1_0


	)

107 
	#LED1_DDR
 
P1DIR


	)

108 
	#LED1_POLARITY
 
ACTIVE_HIGH


	)

110 #ifde‡
HAL_BOARD_CC2530EB_REV17


112 
	#LED2_BV
 
	`BV
(1)

	)

113 
	#LED2_SBIT
 
P1_1


	)

114 
	#LED2_DDR
 
P1DIR


	)

115 
	#LED2_POLARITY
 
ACTIVE_HIGH


	)

118 
	#LED3_BV
 
	`BV
(4)

	)

119 
	#LED3_SBIT
 
P1_4


	)

120 
	#LED3_DDR
 
P1DIR


	)

121 
	#LED3_POLARITY
 
ACTIVE_HIGH


	)

126 
	#ACTIVE_LOW
 !

	)

127 
	#ACTIVE_HIGH
 !!

	)

130 
	#PUSH1_BV
 
	`BV
(1)

	)

131 
	#PUSH1_SBIT
 
P0_1


	)

133 #ifde‡
HAL_BOARD_CC2530EB_REV17


134 
	#PUSH1_POLARITY
 
ACTIVE_HIGH


	)

135 #ñi‡
deföed
 (
HAL_BOARD_CC2530EB_REV13
)

136 
	#PUSH1_POLARITY
 
ACTIVE_LOW


	)

138 #îr‹ 
Unknown
 
Bﬂrd
 
Indítifõr


142 
	#PUSH2_BV
 
	`BV
(0)

	)

143 
	#PUSH2_SBIT
 
P2_0


	)

144 
	#PUSH2_POLARITY
 
ACTIVE_HIGH


	)

149 
	#HAL_FLASH_PAGE_PER_BANK
 16

	)

152 
	#HAL_FLASH_PAGE_PHYS
 2048

	)

155 
	#HAL_FLASH_PAGE_SIZE
 
HAL_FLASH_PAGE_PHYS


	)

156 
	#HAL_FLASH_WORD_SIZE
 4

	)

159 
	#HAL_FLASH_PAGE_MAP
 0x8000

	)

162 
	#HAL_FLASH_LOCK_BITS
 16

	)

165 #i‡
deföed
 
NON_BANKED


166 
	#HAL_NV_PAGE_END
 30

	)

167 #ñi‡
deföed
 
HAL_BOARD_CC2541S


168 
	#HAL_NV_PAGE_END
 125

	)

170 
	#HAL_NV_PAGE_END
 126

	)

174 
	#HAL_FLASH_IEEE_SIZE
 8

	)

175 
	#HAL_FLASH_IEEE_PAGE
 (
HAL_NV_PAGE_END
+1)

	)

176 
	#HAL_FLASH_IEEE_OSET
 (
HAL_FLASH_PAGE_SIZE
 - 
HAL_FLASH_LOCK_BITS
 - 
HAL_FLASH_IEEE_SIZE
)

	)

177 
	#HAL_INFOP_IEEE_OSET
 0xC

	)

179 
	#HAL_NV_PAGE_CNT
 2

	)

180 
	#HAL_NV_PAGE_BEG
 (
HAL_NV_PAGE_END
-
HAL_NV_PAGE_CNT
+1)

	)

183 
	#HAL_NV_DMA_CH
 0

	)

184 
	#HAL_DMA_CH_RX
 3

	)

185 
	#HAL_DMA_CH_TX
 4

	)

187 
	#HAL_NV_DMA_GET_DESC
(Ë
	`HAL_DMA_GET_DESC0
()

	)

188 
	#HAL_NV_DMA_SET_ADDR
(
a
Ë
	`HAL_DMA_SET_ADDR_DESC0
(◊))

	)

193 
	#VDD_2_0
 74

194 
	#VDD_2_7
 100

195 

	)

196 
	#VDD_MIN_RUN
 
VDD_2_0


	)

197 
	#VDD_MIN_NV
 (
VDD_2_0
+4)

198 
	#VDD_MIN_XNV
 (
VDD_2_7
+5)

199 

	)

206 
	#PREFETCH_ENABLE
(Ë
	`°
–
FCTL
 = 0x08; )

	)

207 
	#PREFETCH_DISABLE
(Ë
	`°
–
FCTL
 = 0x04; )

	)

212 
	#SET_OSC_TO_HSOSC
() \

214 
CLKCONCMD
 = (CLKCONCMD & 0x80Ë| 
CLKCONCMD_16MHZ
; \

215  (
CLKCONSTA
 & ~0x80Ë!
CLKCONCMD_16MHZ
 ); \

216 }

	)

219 
	#SET_OSC_TO_XOSC
() \

221 
CLKCONCMD
 = (CLKCONCMD & 0x80Ë| 
CLKCONCMD_32MHZ
; \

222  (
CLKCONSTA
 & ~0x80Ë!
CLKCONCMD_32MHZ
 ); \

223 }

	)

226 
	#SET_32KHZ_OSC
() \

228 
CLKCONCMD
 = (CLKCONCMD & ~0x80Ë| 
OSC_32KHZ
; \

229  (
CLKCONSTA
 & 0x80Ë!
OSC_32KHZ
 ); \

230 }

	)

232 
	#START_HSOSC_XOSC
() \

234 
SLEEPCMD
 &~
OSC_PD
; \

235 !(
SLEEPSTA
 & 
XOSC_STB
)); \

236 }

	)

238 
	#STOP_HSOSC
() \

240 
SLEEPCMD
 |
OSC_PD
; \

241 }

	)

244 
	#HAL_BOARD_INIT
() \

247 
	`START_HSOSC_XOSC
(); \

248 
	`SET_OSC_TO_HSOSC
(); \

249 
	`SET_32KHZ_OSC
(); \

250 
	`SET_OSC_TO_XOSC
(); \

251 
	`STOP_HSOSC
(); \

254 
	`PREFETCH_ENABLE
(); \

255 }

	)

258 
	#HAL_DEBOUNCE
(
ex¥
Ë{ 
i
; i=0; i<500; i++Ë{ i‡(!”x¥)Ëò0; } }

	)

261 
	#HAL_PUSH_BUTTON1
(Ë(
	`PUSH1_POLARITY
 (
PUSH1_SBIT
))

	)

262 
	#HAL_PUSH_BUTTON2
(Ë(
	`PUSH2_POLARITY
 (
PUSH2_SBIT
))

	)

263 
	#HAL_PUSH_BUTTON3
(Ë(0)

	)

264 
	#HAL_PUSH_BUTTON4
(Ë(0)

	)

265 
	#HAL_PUSH_BUTTON5
(Ë(0)

	)

266 
	#HAL_PUSH_BUTTON6
(Ë(0)

	)

270 #i‡
deföed
 (
HAL_BOARD_CC2530EB_REV17
Ë&& !deföed (
HAL_PA_LNA
Ë&& !deföed (
HAL_PA_LNA_CC2590
)

272 
	#HAL_TURN_OFF_LED1
(Ë
	`°
–
LED1_SBIT
 = 
	`LED1_POLARITY
 (0); )

	)

273 
	#HAL_TURN_OFF_LED2
(Ë
	`°
–
LED2_SBIT
 = 
	`LED2_POLARITY
 (0); )

	)

274 
	#HAL_TURN_OFF_LED3
(Ë
	`°
–
LED3_SBIT
 = 
	`LED3_POLARITY
 (0); )

	)

275 
	#HAL_TURN_OFF_LED4
(Ë
	`HAL_TURN_OFF_LED1
()

	)

277 
	#HAL_TURN_ON_LED1
(Ë
	`°
–
LED1_SBIT
 = 
	`LED1_POLARITY
 (1); )

	)

278 
	#HAL_TURN_ON_LED2
(Ë
	`°
–
LED2_SBIT
 = 
	`LED2_POLARITY
 (1); )

	)

279 
	#HAL_TURN_ON_LED3
(Ë
	`°
–
LED3_SBIT
 = 
	`LED3_POLARITY
 (1); )

	)

280 
	#HAL_TURN_ON_LED4
(Ë
	`HAL_TURN_ON_LED1
()

	)

282 
	#HAL_TOGGLE_LED1
(Ë
	`°
–i‡(
LED1_SBIT
Ë{ LED1_SBIT = 0; } { LED1_SBIT = 1;} )

	)

283 
	#HAL_TOGGLE_LED2
(Ë
	`°
–i‡(
LED2_SBIT
Ë{ LED2_SBIT = 0; } { LED2_SBIT = 1;} )

	)

284 
	#HAL_TOGGLE_LED3
(Ë
	`°
–i‡(
LED3_SBIT
Ë{ LED3_SBIT = 0; } { LED3_SBIT = 1;} )

	)

285 
	#HAL_TOGGLE_LED4
(Ë
	`HAL_TOGGLE_LED1
()

	)

287 
	#HAL_STATE_LED1
(Ë(
	`LED1_POLARITY
 (
LED1_SBIT
))

	)

288 
	#HAL_STATE_LED2
(Ë(
	`LED2_POLARITY
 (
LED2_SBIT
))

	)

289 
	#HAL_STATE_LED3
(Ë(
	`LED3_POLARITY
 (
LED3_SBIT
))

	)

290 
	#HAL_STATE_LED4
(Ë
	`HAL_STATE_LED1
()

	)

292 #ñi‡
deföed
 (
HAL_BOARD_CC2530EB_REV13
Ë|| deföed (
HAL_PA_LNA
Ë|| deföed (
HAL_PA_LNA_CC2590
)

294 
	#HAL_TURN_OFF_LED1
(Ë
	`°
–
LED1_SBIT
 = 
	`LED1_POLARITY
 (0); )

	)

295 
	#HAL_TURN_OFF_LED2
(Ë
	`HAL_TURN_OFF_LED1
()

	)

296 
	#HAL_TURN_OFF_LED3
(Ë
	`HAL_TURN_OFF_LED1
()

	)

297 
	#HAL_TURN_OFF_LED4
(Ë
	`HAL_TURN_OFF_LED1
()

	)

299 
	#HAL_TURN_ON_LED1
(Ë
	`°
–
LED1_SBIT
 = 
	`LED1_POLARITY
 (1); )

	)

300 
	#HAL_TURN_ON_LED2
(Ë
	`HAL_TURN_ON_LED1
()

	)

301 
	#HAL_TURN_ON_LED3
(Ë
	`HAL_TURN_ON_LED1
()

	)

302 
	#HAL_TURN_ON_LED4
(Ë
	`HAL_TURN_ON_LED1
()

	)

304 
	#HAL_TOGGLE_LED1
(Ë
	`°
–i‡(
LED1_SBIT
Ë{ LED1_SBIT = 0; } { LED1_SBIT = 1;} )

	)

305 
	#HAL_TOGGLE_LED2
(Ë
	`HAL_TOGGLE_LED1
()

	)

306 
	#HAL_TOGGLE_LED3
(Ë
	`HAL_TOGGLE_LED1
()

	)

307 
	#HAL_TOGGLE_LED4
(Ë
	`HAL_TOGGLE_LED1
()

	)

309 
	#HAL_STATE_LED1
(Ë(
	`LED1_POLARITY
 (
LED1_SBIT
))

	)

310 
	#HAL_STATE_LED2
(Ë
	`HAL_STATE_LED1
()

	)

311 
	#HAL_STATE_LED3
(Ë
	`HAL_STATE_LED1
()

	)

312 
	#HAL_STATE_LED4
(Ë
	`HAL_STATE_LED1
()

	)

318 
	#XNV_SPI_BEGIN
(Ë
	`°
(
P1_3
 = 0;)

	)

319 
	#XNV_SPI_TX
(
x
Ë
	`°
(
U1CSR
 &~0x02; 
U1DBUF
 = (x);)

	)

320 
	#XNV_SPI_RX
(Ë
U1DBUF


	)

321 
	#XNV_SPI_WAIT_RXRDY
(Ë
	`°
(!(
U1CSR
 & 0x02));)

	)

322 
	#XNV_SPI_END
(Ë
	`°
(
P1_3
 = 1;)

	)

325 
	#XNV_SPI_INIT
() \

326 
	`°
( \

328 
U1CSR
 = 0; \

331 
U1GCR
 = 11; \

332 
U1BAUD
 = 216; \

335 
U1GCR
 |
	`BV
(5); \

338 
PERCFG
 |= 0x02; \

341 
P1SEL
 |= 0xE0; \

343 
P1SEL
 &= ~0x0E; \

344 
P1
 |= 0x0E; \

345 
P1_1
 = 0; \

346 
P1DIR
 |= 0x0E; \

349 
P2SEL
 &= ~0x20; \

352 
U1CSR
 |= 0x40; \

354 
P1_1
 = 1; \

355 )

	)

360 #i‚de‡
HAL_TIMER


361 
	#HAL_TIMER
 
FALSE


	)

365 #i‚de‡
HAL_ADC


366 
	#HAL_ADC
 
TRUE


	)

370 #i‚de‡
HAL_DMA


371 
	#HAL_DMA
 
TRUE


	)

375 #i‚de‡
HAL_FLASH


376 
	#HAL_FLASH
 
TRUE


	)

380 #i‚de‡
HAL_AES


381 
	#HAL_AES
 
TRUE


	)

384 #i‚de‡
HAL_AES_DMA


385 
	#HAL_AES_DMA
 
TRUE


	)

389 #i‚de‡
HAL_LCD


390 
	#HAL_LCD
 
TRUE


	)

394 #i‚de‡
HAL_LED


395 
	#HAL_LED
 
TRUE


	)

397 #i‡(!
deföed
 
BLINK_LEDS
Ë&& (
HAL_LED
 =
TRUE
)

398 
	#BLINK_LEDS


	)

402 #i‚de‡
HAL_KEY


403 
	#HAL_KEY
 
TRUE


	)

407 #i‚de‡
HAL_UART


408 #i‡(
deföed
 
ZAPP_P1
Ë|| (deföed 
ZAPP_P2
Ë|| (deföed 
ZTOOL_P1
Ë|| (deföed 
ZTOOL_P2
)

409 
	#HAL_UART
 
TRUE


	)

411 
	#HAL_UART
 
FALSE


	)

415 #i‡
HAL_UART


417 #i‡
HAL_DMA


418 #i‚de‡
HAL_UART_DMA


419 #i‡(
deföed
 
ZAPP_P1
Ë|| (deföed 
ZTOOL_P1
)

420 
	#HAL_UART_DMA
 1

	)

421 #ñi‡(
deföed
 
ZAPP_P2
Ë|| (deföed 
ZTOOL_P2
)

422 
	#HAL_UART_DMA
 2

	)

424 
	#HAL_UART_DMA
 1

	)

427 #i‚de‡
HAL_UART_ISR


428 
	#HAL_UART_ISR
 0

	)

431 #i‚de‡
HAL_UART_ISR


432 #i‡(
deföed
 
ZAPP_P1
Ë|| (deföed 
ZTOOL_P1
)

433 
	#HAL_UART_ISR
 1

	)

434 #ñi‡(
deföed
 
ZAPP_P2
Ë|| (deföed 
ZTOOL_P2
)

435 
	#HAL_UART_ISR
 2

	)

437 
	#HAL_UART_ISR
 1

	)

440 #i‚de‡
HAL_UART_DMA


441 
	#HAL_UART_DMA
 0

	)

446 #i‡((
HAL_UART_DMA
 =1Ë|| (
HAL_UART_ISR
 == 1))

447 
	#HAL_UART_PRIPO
 0x00

	)

449 
	#HAL_UART_PRIPO
 0x40

	)

453 
	#HAL_UART_DMA
 0

	)

454 
	#HAL_UART_ISR
 0

	)

457 #i‡!
deföed
 
HAL_UART_SPI


458 
	#HAL_UART_SPI
 0

	)

461 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2540EB/hal_ccm.h

40 #i‚de‡ 
HAL_CCM_H_


41 
	#HAL_CCM_H_


	)

43 
Sètus_t
 
SSP_CCM_Auth
 (
uöt8
, uöt8 *, uöt8 *, 
uöt16
, uint8 *, uint16, uint8 *, uint8 *, uint8);

44 
Sètus_t
 
SSP_CCM_En¸y±
 (
uöt8
, uöt8 *, uöt8 *, 
uöt16
, uint8 *, uint8 *, uint8);

45 
Sètus_t
 
SSP_CCM_De¸y±
 (
uöt8
, uöt8 *, uöt8 *, 
uöt16
, uint8 *, uint8 *, uint8);

46 
Sètus_t
 
SSP_CCM_InvAuth
 (
uöt8
, uöt8 *, uöt8 *, 
uöt16
, uint8 *, uint16, uint8 *, uint8 *, uint8);

47 
Sètus_t
 
SSP_CCM_Auth_En¸y±
 (
boﬁ
, 
uöt8
, uöt8 *, uöt8 *, 
uöt16
, uint8 *, uint16, uint8 *, uint8 *, uint8);

48 
Sètus_t
 
SSP_CCM_InvAuth_De¸y±
 (
boﬁ
, 
uöt8
, uöt8 *, uöt8 *, 
uöt16
, uint8 *, uint16, uint8 *, uint8 *, uint8);

	@Components/hal/target/CC2540EB/hal_crc.c

45 
	~"hÆ_bﬂrd.h
"

46 
	~"hÆ_¸c.h
"

47 
	~"hÆ_ty≥s.h
"

64 
uöt16
 
	$HÆCRCCÆc
()

66 
uöt16
 
¸c
 = 
RNDH
;

67 
¸c
 = (¸¯<< 8Ë| 
RNDL
;

69  
¸c
;

70 
	}
}

87 
	$HÆCRCExec
(
uöt8
 
ch
)

89 
RNDH
 = 
ch
;

90 
	}
}

107 
	$HÆCRCInô
(
uöt16
 
£ed
)

109 
ADCCON1
 &= 0xF3;

111 
RNDL
 = 
	`HI_UINT16
(
£ed
);

112 
RNDL
 = 
	`LO_UINT16
(
£ed
);

113 
	}
}

	@Components/hal/target/CC2540EB/hal_crc.h

39 #i‚de‡
HAL_CRC_H


40 
	#HAL_CRC_H


	)

47 
	~"hÆ_ty≥s.h
"

64 
uöt16
 
HÆCRCCÆc
();

81 
HÆCRCExec
(
uöt8
 
ch
);

98 
HÆCRCInô
(
uöt16
 
£ed
);

	@Components/hal/target/CC2540EB/hal_dma.c

44 
	~"hÆ_dma.h
"

45 
	~"hÆ_mcu.h
"

46 
	~"hÆ_ty≥s.h
"

47 
	~"hÆ_u¨t.h
"

49 #i‡(
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)

50 
	~"hÆ_úgí.h
"

53 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

59 
hÆDMADesc_t
 
	gdmaCh0
;

60 
hÆDMADesc_t
 
	gdmaCh1234
[4];

71 
	$HÆDmaInô
( )

73 
	`HAL_DMA_SET_ADDR_DESC0
–&
dmaCh0
 );

74 
	`HAL_DMA_SET_ADDR_DESC1234
–
dmaCh1234
 );

75 #i‡(
HAL_UART_DMA
 || \

76 ((
deföed
 
HAL_UART_SPI
) && (HAL_UART_SPI != 0)) || \

77 ((
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)))

78 
DMAIE
 = 1;

80 
	}
}

82 #i‡(
HAL_UART_DMA
 || \

83 ((
deföed
 
	gHAL_UART_SPI
) && (HAL_UART_SPI != 0)) || \

84 ((
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)))

94 
	$HAL_ISR_FUNCTION
–
hÆDmaI§
, 
DMA_VECTOR
 )

96 
	`HAL_ENTER_ISR
();

98 
DMAIF
 = 0;

100 #i‡(((
deföed
 
HAL_UART_DMA
) && (HAL_UART_DMA != 0)) || \

101 ((
deföed
 
HAL_UART_SPI
) && (HAL_UART_SPI != 0)))

102 i‡(
	`HAL_DMA_CHECK_IRQ
(
HAL_DMA_CH_TX
))

104 
	`HAL_DMA_CLEAR_IRQ
(
HAL_DMA_CH_TX
);

105 
	`HÆUARTI§DMA
();

106 
	`HÆUARTI§DMA
();

110 #i‡(
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)

111 i‡–
HAL_IRGEN
 =
TRUE
 && 
	`HAL_DMA_CHECK_IRQ
–
HAL_IRGEN_DMA_CH
 ) )

113 
	`HAL_DMA_CLEAR_IRQ
–
HAL_IRGEN_DMA_CH
 );

114 
	`HÆIrGíDmaI§
();

118 
	`CLEAR_SLEEP_MODE
();

119 
	`HAL_EXIT_ISR
();

122 
	}
}

	@Components/hal/target/CC2540EB/hal_dma.h

40 #i‚de‡
HAL_DMA_H


41 
	#HAL_DMA_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"hÆ_bﬂrd.h
"

53 
	~"hÆ_ty≥s.h
"

55 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

61 
	#HAL_DMA_SET_ADDR_DESC0
–
a
 ) \

62 
	`°
( \

63 
DMA0CFGH
 = (
uöt8
)–(
uöt16
)(
a
) >> 8 ); \

64 
DMA0CFGL
 = (
uöt8
)–(
uöt16
)(
a
) & 0xFF ); \

65 )

	)

67 
	#HAL_DMA_SET_ADDR_DESC1234
–
a
 ) \

68 
	`°
( \

69 
DMA1CFGH
 = (
uöt8
)–(
uöt16
)(
a
) >> 8 ); \

70 
DMA1CFGL
 = (
uöt8
)–(
uöt16
)(
a
) & 0xFF); \

71 )

	)

73 
	#HAL_DMA_GET_DESC0
(Ë&
dmaCh0


	)

75 
	#HAL_DMA_GET_DESC1234
–
a
 ) (
dmaCh1234
+(◊)-1))

	)

77 
	#HAL_DMA_ARM_CH
–
ch
 ) 
DMAARM
 = (0x01 << (ch))

	)

79 
	#HAL_DMA_CH_ARMED
–
ch
 ) (
DMAARM
 & (0x01 << (ch)))

	)

81 
	#HAL_DMA_ABORT_CH
–
ch
 ) 
DMAARM
 = (0x80 | (0x01 << (ch)))

	)

82 
	#HAL_DMA_MAN_TRIGGER
–
ch
 ) 
DMAREQ
 = (0x01 << (ch))

	)

83 
	#HAL_DMA_START_CH
–
ch
 ) 
	`HAL_DMA_MAN_TRIGGER
–(chË)

	)

85 
	#HAL_DMA_CLEAR_IRQ
–
ch
 ) 
DMAIRQ
 &~–1 << (chË)

	)

87 
	#HAL_DMA_CHECK_IRQ
–
ch
 ) (
DMAIRQ
 & ( 1 << (chË))

	)

90 
	#HAL_DMA_SET_SOURCE
–
pDesc
, 
§c
 ) \

91 
	`°
( \

92 
pDesc
->
§cAddrH
 = (
uöt8
)((
uöt16
)(
§c
) >> 8); \

93 
pDesc
->
§cAddrL
 = (
uöt8
)((
uöt16
)(
§c
) & 0xFF); \

94 )

	)

97 
	#HAL_DMA_SET_DEST
–
pDesc
, 
d°
 ) \

98 
	`°
( \

99 
pDesc
->
d°AddrH
 = (
uöt8
)((
uöt16
)(
d°
) >> 8); \

100 
pDesc
->
d°AddrL
 = (
uöt8
)((
uöt16
)(
d°
) & 0xFF); \

101 )

	)

105 
	#HAL_DMA_SET_LEN
–
pDesc
, 
Àn
 ) \

106 
	`°
( \

107 
pDesc
->
x„rLíL
 = (
uöt8
)(
uöt16
)(
Àn
); \

108 
pDesc
->
x„rLíV
 &~
HAL_DMA_LEN_H
; \

109 
pDesc
->
x„rLíV
 |(
uöt8
)((
uöt16
)(
Àn
) >> 8); \

110 )

	)

112 
	#HAL_DMA_GET_LEN
–
pDesc
 ) \

113 (((
uöt16
)(
pDesc
->
x„rLíV
 & 
HAL_DMA_LEN_H
Ë<< 8Ë|ÖDesc->
x„rLíL
)

	)

115 
	#HAL_DMA_SET_VLEN
–
pDesc
, 
vMode
 ) \

116 
	`°
( \

117 
pDesc
->
x„rLíV
 &~
HAL_DMA_LEN_V
; \

118 
pDesc
->
x„rLíV
 |(
vMode
 << 5); \

119 )

	)

121 
	#HAL_DMA_SET_WORD_SIZE
–
pDesc
, 
xSz
 ) \

122 
	`°
( \

123 
pDesc
->
˘æA
 &~
HAL_DMA_WORD_SIZE
; \

124 
pDesc
->
˘æA
 |(
xSz
 << 7); \

125 )

	)

127 
	#HAL_DMA_SET_TRIG_MODE
–
pDesc
, 
tMode
 ) \

128 
	`°
( \

129 
pDesc
->
˘æA
 &~
HAL_DMA_TRIG_MODE
; \

130 
pDesc
->
˘æA
 |(
tMode
 << 5); \

131 )

	)

133 
	#HAL_DMA_GET_TRIG_MODE
–
pDesc
 ) (’Desc->
˘æA
 >> 5Ë& 0x3)

	)

135 
	#HAL_DMA_SET_TRIG_SRC
–
pDesc
, 
tSrc
 ) \

136 
	`°
( \

137 
pDesc
->
˘æA
 &~
HAL_DMA_TRIG_SRC
; \

138 
pDesc
->
˘æA
 |
tSrc
; \

139 )

	)

141 
	#HAL_DMA_SET_SRC_INC
–
pDesc
, 
§cInc
 ) \

142 
	`°
( \

143 
pDesc
->
˘æB
 &~
HAL_DMA_SRC_INC
; \

144 
pDesc
->
˘æB
 |(
§cInc
 << 6); \

145 )

	)

147 
	#HAL_DMA_SET_DST_INC
–
pDesc
, 
d°Inc
 ) \

148 
	`°
( \

149 
pDesc
->
˘æB
 &~
HAL_DMA_DST_INC
; \

150 
pDesc
->
˘æB
 |(
d°Inc
 << 4); \

151 )

	)

153 
	#HAL_DMA_SET_IRQ
–
pDesc
, 
íabÀ
 ) \

154 
	`°
( \

155 
pDesc
->
˘æB
 &~
HAL_DMA_IRQ_MASK
; \

156 
pDesc
->
˘æB
 |(
íabÀ
 << 3); \

157 )

	)

159 
	#HAL_DMA_SET_M8
–
pDesc
, 
m8
 ) \

160 
	`°
( \

161 
pDesc
->
˘æB
 &~
HAL_DMA_M8
; \

162 
pDesc
->
˘æB
 |(
m8
 << 2); \

163 )

	)

165 
	#HAL_DMA_SET_PRIORITY
–
pDesc
, 
¥i
 ) \

166 
	`°
( \

167 
pDesc
->
˘æB
 &~
HAL_DMA_PRIORITY
; \

168 
pDesc
->
˘æB
 |
¥i
; \

169 )

	)

176 
	#HAL_DMA_VLEN_USE_LEN
 0x00

	)

178 
	#HAL_DMA_VLEN_1_P_VALOFFIRST
 0x01

	)

180 
	#HAL_DMA_VLEN_VALOFFIRST
 0x02

	)

182 
	#HAL_DMA_VLEN_1_P_VALOFFIRST_P_1
 0x03

	)

184 
	#HAL_DMA_VLEN_1_P_VALOFFIRST_P_2
 0x04

	)

186 
	#HAL_DMA_WORDSIZE_BYTE
 0x00

	)

187 
	#HAL_DMA_WORDSIZE_WORD
 0x01

	)

189 
	#HAL_DMA_TMODE_SINGLE
 0x00

	)

190 
	#HAL_DMA_TMODE_BLOCK
 0x01

	)

191 
	#HAL_DMA_TMODE_SINGLE_REPEATED
 0x02

	)

192 
	#HAL_DMA_TMODE_BLOCK_REPEATED
 0x03

	)

194 
	#HAL_DMA_TRIG_NONE
 0

	)

195 
	#HAL_DMA_TRIG_PREV
 1

	)

196 
	#HAL_DMA_TRIG_T1_CH0
 2

	)

197 
	#HAL_DMA_TRIG_T1_CH1
 3

	)

198 
	#HAL_DMA_TRIG_T1_CH2
 4

	)

199 
	#HAL_DMA_TRIG_T2_COMP
 5

	)

200 
	#HAL_DMA_TRIG_T2_OVFL
 6

	)

201 
	#HAL_DMA_TRIG_T3_CH0
 7

	)

202 
	#HAL_DMA_TRIG_T3_CH1
 8

	)

203 
	#HAL_DMA_TRIG_T4_CH0
 9

	)

204 
	#HAL_DMA_TRIG_T4_CH1
 10

	)

205 
	#HAL_DMA_TRIG_ST
 11

	)

206 
	#HAL_DMA_TRIG_IOC_0
 12

	)

207 
	#HAL_DMA_TRIG_IOC_1
 13

	)

208 
	#HAL_DMA_TRIG_URX0
 14

	)

209 
	#HAL_DMA_TRIG_UTX0
 15

	)

210 
	#HAL_DMA_TRIG_URX1
 16

	)

211 
	#HAL_DMA_TRIG_UTX1
 17

	)

212 
	#HAL_DMA_TRIG_FLASH
 18

	)

213 
	#HAL_DMA_TRIG_RADIO
 19

	)

214 
	#HAL_DMA_TRIG_ADC_CHALL
 20

	)

215 
	#HAL_DMA_TRIG_ADC_CH0
 21

	)

216 
	#HAL_DMA_TRIG_ADC_CH1
 22

	)

217 
	#HAL_DMA_TRIG_ADC_CH2
 23

	)

218 
	#HAL_DMA_TRIG_ADC_CH3
 24

	)

219 
	#HAL_DMA_TRIG_ADC_CH4
 25

	)

220 
	#HAL_DMA_TRIG_ADC_CH5
 26

	)

221 
	#HAL_DMA_TRIG_ADC_CH6
 27

	)

222 
	#HAL_DMA_TRIG_ADC_CH7
 28

	)

223 
	#HAL_DMA_TRIG_ENC_DW
 29

	)

224 
	#HAL_DMA_TRIG_ENC_UP
 30

	)

226 
	#HAL_DMA_SRCINC_0
 0x00

	)

227 
	#HAL_DMA_SRCINC_1
 0x01

	)

228 
	#HAL_DMA_SRCINC_2
 0x02

	)

229 
	#HAL_DMA_SRCINC_M1
 0x03

	)

231 
	#HAL_DMA_DSTINC_0
 0x00

	)

232 
	#HAL_DMA_DSTINC_1
 0x01

	)

233 
	#HAL_DMA_DSTINC_2
 0x02

	)

234 
	#HAL_DMA_DSTINC_M1
 0x03

	)

236 
	#HAL_DMA_IRQMASK_DISABLE
 0x00

	)

237 
	#HAL_DMA_IRQMASK_ENABLE
 0x01

	)

239 
	#HAL_DMA_M8_USE_8_BITS
 0x00

	)

240 
	#HAL_DMA_M8_USE_7_BITS
 0x01

	)

242 
	#HAL_DMA_PRI_LOW
 0x00

	)

243 
	#HAL_DMA_PRI_GUARANTEED
 0x01

	)

244 
	#HAL_DMA_PRI_HIGH
 0x02

	)

245 
	#HAL_DMA_PRI_ABSOLUTE
 0x03

	)

247 
	#HAL_DMA_MAX_ARM_CLOCKS
 45

248 

	)

254 
	#HAL_DMA_LEN_V
 0xE0

	)

255 
	#HAL_DMA_LEN_H
 0x1F

	)

258 
	#HAL_DMA_WORD_SIZE
 0x80

	)

259 
	#HAL_DMA_TRIG_MODE
 0x60

	)

260 
	#HAL_DMA_TRIG_SRC
 0x1F

	)

263 
	#HAL_DMA_SRC_INC
 0xC0

	)

264 
	#HAL_DMA_DST_INC
 0x30

	)

265 
	#HAL_DMA_IRQ_MASK
 0x08

	)

266 
	#HAL_DMA_M8
 0x04

	)

267 
	#HAL_DMA_PRIORITY
 0x03

	)

270 
uöt8
 
§cAddrH
;

271 
uöt8
 
§cAddrL
;

272 
uöt8
 
d°AddrH
;

273 
uöt8
 
d°AddrL
;

274 
uöt8
 
x„rLíV
;

275 
uöt8
 
x„rLíL
;

276 
uöt8
 
˘æA
;

277 
uöt8
 
˘æB
;

278 } 
	thÆDMADesc_t
;

284 
hÆDMADesc_t
 
dmaCh0
;

285 
hÆDMADesc_t
 
dmaCh1234
[4];

291 
HÆDmaInô
( );

295 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2540EB/hal_flash.c

45 
	~"hÆ_bﬂrd_cfg.h
"

46 
	~"hÆ_dma.h
"

47 
	~"hÆ_Êash.h
"

48 
	~"hÆ_ty≥s.h
"

69 
	$HÆFœshRód
(
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
buf
, uöt16 
˙t
)

72 
uöt8
 *
±r
 = (uöt8 *)(
off£t
 + 
HAL_FLASH_PAGE_MAP
) +

73 ((
pg
 % 
HAL_FLASH_PAGE_PER_BANK
Ë* 
HAL_FLASH_PAGE_SIZE
);

74 
uöt8
 
mem˘r
 = 
MEMCTR
;

76 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


77 
hÆI¡Sèã_t
 
is
;

80 
pg
 /
HAL_FLASH_PAGE_PER_BANK
;

82 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


83 
	`HAL_ENTER_CRITICAL_SECTION
(
is
);

87 
MEMCTR
 = (MEMCTR & 0xF8Ë| 
pg
;

89 
˙t
--)

91 *
buf
++ = *
±r
++;

94 
MEMCTR
 = 
mem˘r
;

96 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


97 
	`HAL_EXIT_CRITICAL_SECTION
(
is
);

99 
	}
}

119 
	$HÆFœshWrôe
(
uöt16
 
addr
, 
uöt8
 *
buf
, uöt16 
˙t
)

121 #i‡(
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
)

122 
hÆDMADesc_t
 *
ch
 = 
	`HAL_NV_DMA_GET_DESC
();

124 
	`HAL_DMA_SET_SOURCE
(
ch
, 
buf
);

125 
	`HAL_DMA_SET_DEST
(
ch
, &
FWDATA
);

126 
	`HAL_DMA_SET_VLEN
(
ch
, 
HAL_DMA_VLEN_USE_LEN
);

127 
	`HAL_DMA_SET_LEN
(
ch
, (
˙t
 * 
HAL_FLASH_WORD_SIZE
));

128 
	`HAL_DMA_SET_WORD_SIZE
(
ch
, 
HAL_DMA_WORDSIZE_BYTE
);

129 
	`HAL_DMA_SET_TRIG_MODE
(
ch
, 
HAL_DMA_TMODE_SINGLE
);

130 
	`HAL_DMA_SET_TRIG_SRC
(
ch
, 
HAL_DMA_TRIG_FLASH
);

131 
	`HAL_DMA_SET_SRC_INC
(
ch
, 
HAL_DMA_SRCINC_1
);

132 
	`HAL_DMA_SET_DST_INC
(
ch
, 
HAL_DMA_DSTINC_0
);

134 
	`HAL_DMA_SET_IRQ
(
ch
, 
HAL_DMA_IRQMASK_DISABLE
);

135 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
);

136 
	`HAL_DMA_SET_PRIORITY
(
ch
, 
HAL_DMA_PRI_HIGH
);

137 
	`HAL_DMA_CLEAR_IRQ
(
HAL_NV_DMA_CH
);

138 
	`HAL_DMA_ARM_CH
(
HAL_NV_DMA_CH
);

140 
FADDRL
 = (
uöt8
)
addr
;

141 
FADDRH
 = (
uöt8
)(
addr
 >> 8);

142 
FCTL
 |= 0x02;

143 
FCTL
 & 0x80);

145 
	}
}

163 
	$HÆFœshEø£
(
uöt8
 
pg
)

165 
FADDRH
 = 
pg
 * (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
 / 256);

166 
FCTL
 |= 0x01;

167 
	}
}

	@Components/hal/target/CC2540EB/hal_key.c

83 
	~"hÆ_mcu.h
"

84 
	~"hÆ_defs.h
"

85 
	~"hÆ_ty≥s.h
"

86 
	~"hÆ_drivîs.h
"

87 
	~"hÆ_adc.h
"

88 
	~"hÆ_key.h
"

89 
	~"oßl.h
"

91 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

96 
	#HAL_KEY_RISING_EDGE
 0

	)

97 
	#HAL_KEY_FALLING_EDGE
 1

	)

99 
	#HAL_KEY_DEBOUNCE_VALUE
 25

	)

102 
	#HAL_KEY_CPU_PORT_0_IF
 
P0IF


	)

103 
	#HAL_KEY_CPU_PORT_2_IF
 
P2IF


	)

105 #i‡
deföed
 ( 
CC2540_MINIDK
 )

107 
	#HAL_KEY_SW_1_PORT
 
P0


	)

108 
	#HAL_KEY_SW_1_BIT
 
	`BV
(0)

	)

109 
	#HAL_KEY_SW_1_SEL
 
P0SEL


	)

110 
	#HAL_KEY_SW_1_DIR
 
P0DIR


	)

113 
	#HAL_KEY_SW_2_PORT
 
P0


	)

114 
	#HAL_KEY_SW_2_BIT
 
	`BV
(1)

	)

115 
	#HAL_KEY_SW_2_SEL
 
P0SEL


	)

116 
	#HAL_KEY_SW_2_DIR
 
P0DIR


	)

118 
	#HAL_KEY_SW_1_IEN
 
IEN1


	)

119 
	#HAL_KEY_SW_1_ICTL
 
P0IEN


	)

120 
	#HAL_KEY_SW_1_ICTLBIT
 
	`BV
(0Ë

	)

121 
	#HAL_KEY_SW_1_IENBIT
 
	`BV
(5Ë

	)

123 
	#HAL_KEY_SW_1_PXIFG
 
P0IFG


	)

124 
	#HAL_KEY_SW_2_IEN
 
IEN1


	)

125 
	#HAL_KEY_SW_2_ICTL
 
P0IEN


	)

126 
	#HAL_KEY_SW_2_ICTLBIT
 
	`BV
(1Ë

	)

127 
	#HAL_KEY_SW_2_IENBIT
 
	`BV
(5Ë

	)

128 
	#HAL_KEY_SW_2_PXIFG
 
P0IFG


	)

130 
	#HAL_KEY_SW_1_EDGEBIT
 
	`BV
(0)

	)

135 
	#HAL_KEY_SW_6_PORT
 
P0


	)

136 
	#HAL_KEY_SW_6_BIT
 
	`BV
(1)

	)

137 
	#HAL_KEY_SW_6_SEL
 
P0SEL


	)

138 
	#HAL_KEY_SW_6_DIR
 
P0DIR


	)

141 
	#HAL_KEY_SW_6_EDGEBIT
 
	`BV
(0)

	)

142 
	#HAL_KEY_SW_6_EDGE
 
HAL_KEY_FALLING_EDGE


	)

145 
	#HAL_KEY_SW_6_IEN
 
IEN1


	)

146 
	#HAL_KEY_SW_6_IENBIT
 
	`BV
(5Ë

	)

147 
	#HAL_KEY_SW_6_ICTL
 
P0IEN


	)

148 
	#HAL_KEY_SW_6_ICTLBIT
 
	`BV
(1Ë

	)

149 
	#HAL_KEY_SW_6_PXIFG
 
P0IFG


	)

152 
	#HAL_KEY_JOY_MOVE_PORT
 
P2


	)

153 
	#HAL_KEY_JOY_MOVE_BIT
 
	`BV
(0)

	)

154 
	#HAL_KEY_JOY_MOVE_SEL
 
P2SEL


	)

155 
	#HAL_KEY_JOY_MOVE_DIR
 
P2DIR


	)

158 
	#HAL_KEY_JOY_MOVE_EDGEBIT
 
	`BV
(3)

	)

159 
	#HAL_KEY_JOY_MOVE_EDGE
 
HAL_KEY_FALLING_EDGE


	)

162 
	#HAL_KEY_JOY_MOVE_IEN
 
IEN2


	)

163 
	#HAL_KEY_JOY_MOVE_IENBIT
 
	`BV
(1Ë

	)

164 
	#HAL_KEY_JOY_MOVE_ICTL
 
P2IEN


	)

165 
	#HAL_KEY_JOY_MOVE_ICTLBIT
 
	`BV
(0Ë

	)

166 
	#HAL_KEY_JOY_MOVE_PXIFG
 
P2IFG


	)

168 
	#HAL_KEY_JOY_CHN
 
HAL_ADC_CHANNEL_6


	)

180 
uöt8
 
	ghÆKeySavedKeys
;

181 
hÆKeyCBack_t
 
	gpHÆKeyPro˚ssFun˘i⁄
;

182 
uöt8
 
	gHÆKeyC⁄figuªd
;

183 
boﬁ
 
	gHÆ_KeyI¡E«bÀ
;

188 
hÆPro˚ssKeyI¡îru±
();

189 
uöt8
 
hÆGëJoyKeyI≈ut
();

207 
	$HÆKeyInô
( )

209 
hÆKeySavedKeys
 = 0;

211 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

212 
HAL_KEY_SW_1_SEL
 &~(
HAL_KEY_SW_1_BIT
);

213 
HAL_KEY_SW_1_DIR
 &~(
HAL_KEY_SW_1_BIT
);

214 
HAL_KEY_SW_2_SEL
 &~(
HAL_KEY_SW_2_BIT
);

215 
HAL_KEY_SW_2_DIR
 &~(
HAL_KEY_SW_2_BIT
);

217 
HAL_KEY_SW_6_SEL
 &~(
HAL_KEY_SW_6_BIT
);

218 
HAL_KEY_SW_6_DIR
 &~(
HAL_KEY_SW_6_BIT
);

219 
HAL_KEY_JOY_MOVE_SEL
 &~(
HAL_KEY_JOY_MOVE_BIT
);

220 
HAL_KEY_JOY_MOVE_DIR
 &~(
HAL_KEY_JOY_MOVE_BIT
);

222 
P2INP
 |
PUSH2_BV
;

226 
pHÆKeyPro˚ssFun˘i⁄
 = 
NULL
;

229 
HÆKeyC⁄figuªd
 = 
FALSE
;

230 
	}
}

243 
	$HÆKeyC⁄fig
 (
boﬁ
 
öãºu±E«bÀ
, 
hÆKeyCBack_t
 
cback
)

246 
HÆ_KeyI¡E«bÀ
 = 
öãºu±E«bÀ
;

249 
pHÆKeyPro˚ssFun˘i⁄
 = 
cback
;

252 i‡(
HÆ_KeyI¡E«bÀ
)

254 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

256 
PICTL
 |
HAL_KEY_SW_1_EDGEBIT
;

258 
HAL_KEY_SW_1_ICTL
 |
HAL_KEY_SW_1_ICTLBIT
;

259 
HAL_KEY_SW_1_IEN
 |
HAL_KEY_SW_1_IENBIT
;

260 
HAL_KEY_SW_1_PXIFG
 = ~(
HAL_KEY_SW_1_BIT
);

261 
HAL_KEY_SW_2_ICTL
 |
HAL_KEY_SW_2_ICTLBIT
;

262 
HAL_KEY_SW_2_IEN
 |
HAL_KEY_SW_2_IENBIT
;

263 
HAL_KEY_SW_2_PXIFG
 = ~(
HAL_KEY_SW_2_BIT
);

267 
PICTL
 &~(
HAL_KEY_SW_6_EDGEBIT
);

269 #i‡(
HAL_KEY_SW_6_EDGE
 =
HAL_KEY_FALLING_EDGE
)

270 
PICTL
 |
HAL_KEY_SW_6_EDGEBIT
;

279 
HAL_KEY_SW_6_ICTL
 |
HAL_KEY_SW_6_ICTLBIT
;

280 
HAL_KEY_SW_6_IEN
 |
HAL_KEY_SW_6_IENBIT
;

281 
HAL_KEY_SW_6_PXIFG
 = ~(
HAL_KEY_SW_6_BIT
);

287 
HAL_KEY_JOY_MOVE_ICTL
 &~(
HAL_KEY_JOY_MOVE_EDGEBIT
);

289 #i‡(
HAL_KEY_JOY_MOVE_EDGE
 =
HAL_KEY_FALLING_EDGE
)

290 
HAL_KEY_JOY_MOVE_ICTL
 |
HAL_KEY_JOY_MOVE_EDGEBIT
;

299 
HAL_KEY_JOY_MOVE_ICTL
 |
HAL_KEY_JOY_MOVE_ICTLBIT
;

300 
HAL_KEY_JOY_MOVE_IEN
 |
HAL_KEY_JOY_MOVE_IENBIT
;

301 
HAL_KEY_JOY_MOVE_PXIFG
 = ~(
HAL_KEY_JOY_MOVE_BIT
);

305 i‡(
HÆKeyC⁄figuªd
 =
TRUE
)

307 
	`oßl_°›_timîEx
(
HÆ_TaskID
, 
HAL_KEY_EVENT
);

312 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

313 
HAL_KEY_SW_1_ICTL
 &~(
HAL_KEY_SW_1_ICTLBIT
);

314 
HAL_KEY_SW_1_IEN
 &~(
HAL_KEY_SW_1_IENBIT
);

315 
HAL_KEY_SW_2_ICTL
 &~(
HAL_KEY_SW_2_ICTLBIT
);

316 
HAL_KEY_SW_2_IEN
 &~(
HAL_KEY_SW_2_IENBIT
);

318 
HAL_KEY_SW_6_ICTL
 &~(
HAL_KEY_SW_6_ICTLBIT
);

319 
HAL_KEY_SW_6_IEN
 &~(
HAL_KEY_SW_6_IENBIT
);

322 
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_KEY_EVENT
);

326 
HÆKeyC⁄figuªd
 = 
TRUE
;

327 
	}
}

339 
uöt8
 
	$HÆKeyRód
 ( )

341 
uöt8
 
keys
 = 0;

343 #i‡
	`deföed
 (
CC2540_MINIDK
)

344 i‡(!(
HAL_KEY_SW_1_PORT
 & 
HAL_KEY_SW_1_BIT
))

346 
keys
 |
HAL_KEY_SW_1
;

348 i‡(!(
HAL_KEY_SW_2_PORT
 & 
HAL_KEY_SW_2_BIT
))

350 
keys
 |
HAL_KEY_SW_2
;

353 #ifde‡
HAL_BOARD_CC2530EB_REV17


354 i‡–(
HAL_KEY_SW_6_PORT
 & 
HAL_KEY_SW_6_BIT
))

355 #ñi‡
	`deföed
 (
HAL_BOARD_CC2530EB_REV13
)

356 i‡(!(
HAL_KEY_SW_6_PORT
 & 
HAL_KEY_SW_6_BIT
))

359 
keys
 |
HAL_KEY_SW_6
;

362 i‡((
HAL_KEY_JOY_MOVE_PORT
 & 
HAL_KEY_JOY_MOVE_BIT
))

364 
keys
 |
	`hÆGëJoyKeyI≈ut
();

367  
keys
;

368 
	}
}

380 
	$HÆKeyPﬁl
 ()

382 
uöt8
 
keys
 = 0;

383 
uöt8
 
nŸify
 = 0;

384 #i‡
	`deföed
 (
CC2540_MINIDK
)

385 i‡(!(
HAL_KEY_SW_1_PORT
 & 
HAL_KEY_SW_1_BIT
))

387 
keys
 |
HAL_KEY_SW_1
;

389 i‡(!(
HAL_KEY_SW_2_PORT
 & 
HAL_KEY_SW_2_BIT
))

391 
keys
 |
HAL_KEY_SW_2
;

394 i‡(!(
HAL_KEY_SW_6_PORT
 & 
HAL_KEY_SW_6_BIT
))

396 
keys
 |
HAL_KEY_SW_6
;

399 i‡((
HAL_KEY_JOY_MOVE_PORT
 & 
HAL_KEY_JOY_MOVE_BIT
))

401 
keys
 = 
	`hÆGëJoyKeyI≈ut
();

408 i‡(!
HÆ_KeyI¡E«bÀ
)

410 i‡(
keys
 =
hÆKeySavedKeys
)

417 
nŸify
 = 1;

423 i‡(
keys
)

425 
nŸify
 = 1;

430 
hÆKeySavedKeys
 = 
keys
;

433 i‡(
nŸify
 && (
pHÆKeyPro˚ssFun˘i⁄
))

435 (
pHÆKeyPro˚ssFun˘i⁄
Ë(
keys
, 
HAL_KEY_STATE_NORMAL
);

438 
	}
}

440 #i‡!
deföed
 ( 
CC2540_MINIDK
 )

450 
uöt8
 
	$hÆGëJoyKeyI≈ut
()

455 
uöt8
 
adc
;

456 
uöt8
 
kßve0
 = 0;

457 
uöt8
 
kßve1
;

462 
kßve1
 = 
kßve0
;

464 
adc
 = 
	`HÆAdcRód
 (
HAL_KEY_JOY_CHN
, 
HAL_ADC_RESOLUTION_8
);

466 i‡((
adc
 >= 2) && (adc <= 38))

468 
kßve0
 |
HAL_KEY_UP
;

470 i‡((
adc
 >= 74) && (adc <= 88))

472 
kßve0
 |
HAL_KEY_RIGHT
;

474 i‡((
adc
 >= 60) && (adc <= 73))

476 
kßve0
 |
HAL_KEY_LEFT
;

478 i‡((
adc
 >= 39) && (adc <= 59))

480 
kßve0
 |
HAL_KEY_DOWN
;

482 i‡((
adc
 >= 89) && (adc <= 100))

484 
kßve0
 |
HAL_KEY_CENTER
;

486 } 
kßve0
 !
kßve1
);

488  
kßve0
;

489 
	}
}

502 
	$hÆPro˚ssKeyI¡îru±
 ()

504 
boﬁ
 
vÆid
=
FALSE
;

506 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

507 if–
HAL_KEY_SW_1_PXIFG
 & 
HAL_KEY_SW_1_BIT
)

509 
HAL_KEY_SW_1_PXIFG
 = ~(
HAL_KEY_SW_1_BIT
);

510 
vÆid
 = 
TRUE
;

513 i‡(
HAL_KEY_SW_2_PXIFG
 & 
HAL_KEY_SW_2_BIT
)

515 
HAL_KEY_SW_2_PXIFG
 = ~(
HAL_KEY_SW_2_BIT
);

516 
vÆid
 = 
TRUE
;

519 i‡(
HAL_KEY_SW_6_PXIFG
 & 
HAL_KEY_SW_6_BIT
)

521 
HAL_KEY_SW_6_PXIFG
 = ~(
HAL_KEY_SW_6_BIT
);

522 
vÆid
 = 
TRUE
;

525 i‡(
HAL_KEY_JOY_MOVE_PXIFG
 & 
HAL_KEY_JOY_MOVE_BIT
)

527 
HAL_KEY_JOY_MOVE_PXIFG
 = ~(
HAL_KEY_JOY_MOVE_BIT
);

528 
vÆid
 = 
TRUE
;

531 i‡(
vÆid
)

533 
	`oßl_°¨t_timîEx
 (
HÆ_TaskID
, 
HAL_KEY_EVENT
, 
HAL_KEY_DEBOUNCE_VALUE
);

535 
	}
}

546 
	$HÆKeyE¡îSÀï
 ( )

548 
	}
}

559 
uöt8
 
	$HÆKeyExôSÀï
 ( )

562  ( 
	`HÆKeyRód
 () );

563 
	}
}

578 
	$HAL_ISR_FUNCTION
–
hÆKeyP‹t0I§
, 
P0INT_VECTOR
 )

580 
	`HAL_ENTER_ISR
();

582 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

583 i‡((
HAL_KEY_SW_1_PXIFG
 & 
HAL_KEY_SW_1_BIT
Ë|| (
HAL_KEY_SW_2_PXIFG
 & 
HAL_KEY_SW_2_BIT
))

585 i‡(
HAL_KEY_SW_6_PXIFG
 & 
HAL_KEY_SW_6_BIT
)

588 
	`hÆPro˚ssKeyI¡îru±
();

595 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

596 
HAL_KEY_SW_1_PXIFG
 = 0;

597 
HAL_KEY_SW_2_PXIFG
 = 0;

599 
HAL_KEY_SW_6_PXIFG
 = 0;

601 
HAL_KEY_CPU_PORT_0_IF
 = 0;

603 
	`CLEAR_SLEEP_MODE
();

605 
	`HAL_EXIT_ISR
();

608 
	}
}

610 #i‡!
deföed
 ( 
CC2540_MINIDK
 )

620 
	$HAL_ISR_FUNCTION
–
hÆKeyP‹t2I§
, 
P2INT_VECTOR
 )

622 
	`HAL_ENTER_ISR
();

624 i‡(
HAL_KEY_JOY_MOVE_PXIFG
 & 
HAL_KEY_JOY_MOVE_BIT
)

626 
	`hÆPro˚ssKeyI¡îru±
();

634 
HAL_KEY_JOY_MOVE_PXIFG
 = 0;

635 
HAL_KEY_CPU_PORT_2_IF
 = 0;

637 
	`CLEAR_SLEEP_MODE
();

639 
	`HAL_EXIT_ISR
();

642 
	}
}

646 
	$HÆKeyInô
(){
	}
}

647 
	$HÆKeyC⁄fig
(
boﬁ
 
öãºu±E«bÀ
, 
hÆKeyCBack_t
 
cback
){
	}
}

648 
uöt8
 
	$HÆKeyRód
(){  0;
	}
}

649 
	$HÆKeyPﬁl
(){
	}
}

	@Components/hal/target/CC2540EB/hal_lcd.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"hÆ_lcd.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_as£π.h
"

49 #i‡
deföed
 (
ZTOOL_P1
Ë|| deföed (
ZTOOL_P2
)

50 
	~"DebugTø˚.h
"

71 
	#HAL_LCD_MAX_CHARS
 16

	)

72 
	#HAL_LCD_MAX_BUFF
 25

	)

75 
	#HAL_LCD_MODE_PORT
 0

	)

76 
	#HAL_LCD_MODE_PIN
 0

	)

78 
	#HAL_LCD_RESET_PORT
 1

	)

79 
	#HAL_LCD_RESET_PIN
 1

	)

81 
	#HAL_LCD_CS_PORT
 1

	)

82 
	#HAL_LCD_CS_PIN
 2

	)

85 
	#HAL_LCD_CLK_PORT
 1

	)

86 
	#HAL_LCD_CLK_PIN
 5

	)

88 
	#HAL_LCD_MOSI_PORT
 1

	)

89 
	#HAL_LCD_MOSI_PIN
 6

	)

91 
	#HAL_LCD_MISO_PORT
 1

	)

92 
	#HAL_LCD_MISO_PIN
 7

	)

95 
	#HAL_SPI_CLOCK_POL_LO
 0x00

	)

96 
	#HAL_SPI_CLOCK_PHA_0
 0x00

	)

97 
	#HAL_SPI_TRANSFER_MSB_FIRST
 0x20

	)

100 
	#LCD_MAX_LINE_COUNT
 3

	)

105 
	#OSC_OFF
 0x00

	)

106 
	#OSC_ON
 0x01

	)

107 
	#POWER_SAVE_OFF
 0x00

	)

108 
	#POWER_SAVE_ON
 0x02

	)

109 
	#SET_POWER_SAVE_MODE
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x0C | (›ti⁄s))

	)

112 
	#CGROM
 0x00

	)

113 
	#CGRAM
 0x01

	)

114 
	#COM_FORWARD
 0x00

	)

115 
	#COM_BACKWARD
 0x02

	)

116 
	#TWO_LINE
 0x00

	)

117 
	#THREE_LINE
 0x04

	)

118 
	#FUNCTION_SET
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x10 | (›ti⁄s))

	)

121 
	#LINE1
 0x00

	)

122 
	#LINE2
 0x01

	)

123 
	#LINE3
 0x02

	)

124 
	#LINE4
 0x03

	)

125 
	#SET_DISPLAY_START_LINE
(
löe
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x18 | (löe))

	)

128 
	#BIAS_1_5
 0x00

	)

129 
	#BIAS_1_4
 0x01

	)

130 
	#SET_BIAS_CTRL
(
büs
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x1C | (büs))

	)

133 
	#VOLTAGE_DIVIDER_OFF
 0x00

	)

134 
	#VOLTAGE_DIVIDER_ON
 0x01

	)

135 
	#CONVERTER_AND_REG_OFF
 0x00

	)

136 
	#CONVERTER_AND_REG_ON
 0x04

	)

137 
	#SET_POWER_CTRL
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x20 | (›ti⁄s))

	)

140 
	#DISPLAY_CTRL_ON
 0x01

	)

141 
	#DISPLAY_CTRL_OFF
 0x00

	)

142 
	#DISPLAY_CTRL_BLINK_ON
 0x02

	)

143 
	#DISPLAY_CTRL_BLINK_OFF
 0x00

	)

144 
	#DISPLAY_CTRL_CURSOR_ON
 0x04

	)

145 
	#DISPLAY_CTRL_CURSOR_OFF
 0x00

	)

146 
	#SET_DISPLAY_CTRL
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x28 | (›ti⁄s))

	)

149 
	#SET_DDRAM_ADDR
(
ch¨Index
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x80 | (ch¨Index))

	)

150 
	#SET_GCRAM_CHAR
(
•ecIndex
Ë
	`HÆLcd_HW_C⁄åﬁ
(0xC0 | (•ecIndex))

	)

153 
	#CONTRAST_CTRL_REGISTER
 0x10

	)

154 
	#SET_ICONRAM_ADDR
(
addr
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x40 | (addr))

	)

157 
	#LINE_1_AND_2
 0x01

	)

158 
	#LINE_2_AND_3
 0x02

	)

159 
	#NORMAL_DISPLAY
 0x00

	)

160 
	#SET_DOUBLE_HEIGHT
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x08 | (›ti⁄s))

	)

166 
	#HAL_IO_SET
(
p‹t
, 
pö
, 
vÆ
Ë
	`HAL_IO_SET_PREP
’‹t,Öö, vÆ)

	)

167 
	#HAL_IO_SET_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
_
##pö## = vÆ; )

	)

169 
	#HAL_CONFIG_IO_OUTPUT
(
p‹t
, 
pö
, 
vÆ
Ë
	`HAL_CONFIG_IO_OUTPUT_PREP
’‹t,Öö, vÆ)

	)

170 
	#HAL_CONFIG_IO_OUTPUT_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
SEL
 &~
	`BV
(pin); \

171 
P
##
p‹t
##
_
##
pö
## = 
vÆ
; \

172 
P
##
p‹t
##
DIR
 |
	`BV
(
pö
); )

	)

174 
	#HAL_CONFIG_IO_PERIPHERAL
(
p‹t
, 
pö
Ë
	`HAL_CONFIG_IO_PERIPHERAL_PREP
’‹t,Öö)

	)

175 
	#HAL_CONFIG_IO_PERIPHERAL_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
SEL
 |
	`BV
’ö); )

	)

180 
	#LCD_SPI_BEGIN
(Ë
	`HAL_IO_SET
(
HAL_LCD_CS_PORT
, 
HAL_LCD_CS_PIN
, 0);

	)

181 
	#LCD_SPI_END
() \

183 
	`asm
("NOP"); \

184 
	`asm
("NOP"); \

185 
	`asm
("NOP"); \

186 
	`asm
("NOP"); \

187 
	`HAL_IO_SET
(
HAL_LCD_CS_PORT
, 
HAL_LCD_CS_PIN
, 1); \

188 }

	)

190 
	#LCD_SPI_TX
(
x
Ë{ 
U1CSR
 &~(
	`BV
(2Ë| BV(1)); 
U1DBUF
 = x;  !(U1CSR & BV(1)Ë); }

	)

191 
	#LCD_SPI_WAIT_RXRDY
(Ë{ !(
U1CSR
 & 
	`BV
(1))); }

	)

195 
	#LCD_DO_WRITE
(Ë
	`HAL_IO_SET
(
HAL_LCD_MODE_PORT
, 
HAL_LCD_MODE_PIN
, 1);

	)

196 
	#LCD_DO_CONTROL
(Ë
	`HAL_IO_SET
(
HAL_LCD_MODE_PORT
, 
HAL_LCD_MODE_PIN
, 0);

	)

198 
	#LCD_ACTIVATE_RESET
(Ë
	`HAL_IO_SET
(
HAL_LCD_RESET_PORT
, 
HAL_LCD_RESET_PIN
, 0);

	)

199 
	#LCD_RELEASE_RESET
(Ë
	`HAL_IO_SET
(
HAL_LCD_RESET_PORT
, 
HAL_LCD_RESET_PIN
, 1);

	)

205 #i‡(
HAL_LCD
 =
TRUE
)

206 
uöt8
 *
	gLcd_Löe1
;

212 #i‡(
HAL_LCD
 =
TRUE
)

213 
HÆLcd_HW_Inô
();

214 
HÆLcd_HW_WaôUs
(
uöt16
 
i
);

215 
HÆLcd_HW_CÀ¨
();

216 
HÆLcd_HW_CÀ¨AŒS≥cCh¨s
();

217 
HÆLcd_HW_C⁄åﬁ
(
uöt8
 
cmd
);

218 
HÆLcd_HW_Wrôe
(
uöt8
 
d©a
);

219 
HÆLcd_HW_SëC⁄åa°
(
uöt8
 
vÆue
);

220 
HÆLcd_HW_WrôeCh¨
(
uöt8
 
löe
, uöt8 
cﬁ
, 
ãxt
);

221 
HÆLcd_HW_WrôeLöe
(
uöt8
 
löe
, c⁄° *
pText
);

233 
	$HÆLcdInô
()

235 #i‡(
HAL_LCD
 =
TRUE
)

236 
Lcd_Löe1
 = 
NULL
;

237 
	`HÆLcd_HW_Inô
();

239 
	}
}

269 
	$HÆLcdWrôeSåög
 ( *
°r
, 
uöt8
 
›ti⁄
)

271 #i‡(
HAL_LCD
 =
TRUE
)

273 
uöt8
 
°rLí
 = 0;

274 
uöt8
 
tŸÆLí
 = 0;

275 
uöt8
 *
buf
;

276 
uöt8
 
tmpLí
;

278 i‡–
Lcd_Löe1
 =
NULL
 )

280 
Lcd_Löe1
 = 
	`oßl_mem_Æloc
–
HAL_LCD_MAX_CHARS
+1 );

281 
	`HÆLcdWrôeSåög
( "Texas Instruments", 1 );

284 
°rLí
 = (
uöt8
)
	`oßl_°æí
–(*)
°r
 );

287 i‡–
°rLí
 > 
HAL_LCD_MAX_CHARS
 )

288 
°rLí
 = 
HAL_LCD_MAX_CHARS
;

290 i‡–
›ti⁄
 =
HAL_LCD_LINE_1
 )

293 
	`oßl_mem˝y
–
Lcd_Löe1
, 
°r
, 
°rLí
 );

294 
Lcd_Löe1
[
°rLí
] = '\0';

299 
tmpLí
 = (
uöt8
)
	`oßl_°æí
–(*)
Lcd_Löe1
 );

300 
tŸÆLí
 = 
tmpLí
 + 1 + 
°rLí
 + 1;

301 
buf
 = 
	`oßl_mem_Æloc
–
tŸÆLí
 );

302 i‡–
buf
 !
NULL
 )

305 
	`oßl_mem˝y
–
buf
, 
Lcd_Löe1
, 
tmpLí
 );

306 
buf
[
tmpLí
++] = ' ';

307 
	`oßl_mem˝y
–&
buf
[
tmpLí
], 
°r
, 
°rLí
 );

308 
buf
[
tmpLí
+
°rLí
] = '\0';

311 #i‡
	`deföed
 (
ZTOOL_P1
Ë|| deföed (
ZTOOL_P2
)

313 #i‡
	`deföed
(
SERIAL_DEBUG_SUPPORTED
)

314 
	`debug_°r
–(
uöt8
*)
buf
 );

320 
	`oßl_mem_‰ì
–
buf
 );

325 
	`HÆLcd_HW_WrôeLöe
 (
›ti⁄
, 
°r
);

329 
	}
}

342 
	$HÆLcdWrôeVÆue
 ( 
uöt32
 
vÆue
, c⁄° 
uöt8
 
ødix
, uöt8 
›ti⁄
)

344 #i‡(
HAL_LCD
 =
TRUE
)

345 
uöt8
 
buf
[
HAL_LCD_MAX_BUFF
];

347 
	`_…ﬂ
–
vÆue
, &
buf
[0], 
ødix
 );

348 
	`HÆLcdWrôeSåög
–(*)
buf
, 
›ti⁄
 );

350 
	}
}

362 
	$HÆLcdWrôeS¸ìn
–*
löe1
, *
löe2
 )

364 #i‡(
HAL_LCD
 =
TRUE
)

365 
	`HÆLcdWrôeSåög
–
löe1
, 1 );

366 
	`HÆLcdWrôeSåög
–
löe2
, 2 );

368 
	}
}

382 
	$HÆLcdWrôeSåögVÆue
–*
tôÀ
, 
uöt16
 
vÆue
, 
uöt8
 
f‹m©
, uöt8 
löe
 )

384 #i‡(
HAL_LCD
 =
TRUE
)

385 
uöt8
 
tmpLí
;

386 
uöt8
 
buf
[
HAL_LCD_MAX_BUFF
];

387 
uöt32
 
îr
;

389 
tmpLí
 = (
uöt8
)
	`oßl_°æí
–(*)
tôÀ
 );

390 
	`oßl_mem˝y
–
buf
, 
tôÀ
, 
tmpLí
 );

391 
buf
[
tmpLí
] = ' ';

392 
îr
 = (
uöt32
)(
vÆue
);

393 
	`_…ﬂ
–
îr
, &
buf
[
tmpLí
+1], 
f‹m©
 );

394 
	`HÆLcdWrôeSåög
–(*)
buf
, 
löe
 );

396 
	}
}

412 
	$HÆLcdWrôeSåögVÆueVÆue
–*
tôÀ
, 
uöt16
 
vÆue1
, 
uöt8
 
f‹m©1
,

413 
uöt16
 
vÆue2
, 
uöt8
 
f‹m©2
, uöt8 
löe
 )

416 #i‡(
HAL_LCD
 =
TRUE
)

418 
uöt8
 
tmpLí
;

419 
uöt8
 
buf
[
HAL_LCD_MAX_BUFF
];

420 
uöt32
 
îr
;

422 
tmpLí
 = (
uöt8
)
	`oßl_°æí
–(*)
tôÀ
 );

423 i‡–
tmpLí
 )

425 
	`oßl_mem˝y
–
buf
, 
tôÀ
, 
tmpLí
 );

426 
buf
[
tmpLí
++] = ' ';

429 
îr
 = (
uöt32
)(
vÆue1
);

430 
	`_…ﬂ
–
îr
, &
buf
[
tmpLí
], 
f‹m©1
 );

431 
tmpLí
 = (
uöt8
)
	`oßl_°æí
–(*)
buf
 );

433 
buf
[
tmpLí
++] = ',';

434 
buf
[
tmpLí
++] = ' ';

435 
îr
 = (
uöt32
)(
vÆue2
);

436 
	`_…ﬂ
–
îr
, &
buf
[
tmpLí
], 
f‹m©2
 );

438 
	`HÆLcdWrôeSåög
–(*)
buf
, 
löe
 );

441 
	}
}

453 
	$HÆLcdDi•œyPî˚¡B¨
–*
tôÀ
, 
uöt8
 
vÆue
 )

455 #i‡(
HAL_LCD
 =
TRUE
)

457 
uöt8
 
≥r˚¡
;

458 
uöt8
 
À·Ovî
;

459 
uöt8
 
buf
[17];

460 
uöt32
 
îr
;

461 
uöt8
 
x
;

464 
	`HÆLcdWrôeSåög
–
tôÀ
, 
HAL_LCD_LINE_1
 );

466 i‡–
vÆue
 > 100 )

467 
vÆue
 = 100;

470 
≥r˚¡
 = (
uöt8
)(
vÆue
 / 10);

471 
À·Ovî
 = (
uöt8
)(
vÆue
 % 10);

474 
	`oßl_mem˝y
–
buf
, "[ ] ", 15 );

476  
x
 = 0; x < 
≥r˚¡
; x ++ )

478 
buf
[1+
x
] = '>';

481 i‡–
À·Ovî
 >= 5 )

482 
buf
[1+
x
] = '+';

484 
îr
 = (
uöt32
)
vÆue
;

485 
	`_…ﬂ
–
îr
, (
uöt8
*)&
buf
[13], 10 );

487 
	`HÆLcdWrôeSåög
–(*)
buf
, 
HAL_LCD_LINE_2
 );

491 
	}
}

494 #i‡(
HAL_LCD
 =
TRUE
)

508 
	$hÆLcd_C⁄figIO
()

511 
	`HAL_CONFIG_IO_OUTPUT
(
HAL_LCD_MODE_PORT
, 
HAL_LCD_MODE_PIN
, 1);

512 
	`HAL_CONFIG_IO_OUTPUT
(
HAL_LCD_RESET_PORT
, 
HAL_LCD_RESET_PIN
, 1);

513 
	`HAL_CONFIG_IO_OUTPUT
(
HAL_LCD_CS_PORT
, 
HAL_LCD_CS_PIN
, 1);

514 
	}
}

525 
	$hÆLcd_C⁄figSPI
()

529 
uöt8
 
baud_exp⁄ít
;

530 
uöt8
 
baud_m™tisß
;

533 
PERCFG
 |= 0x02;

536 
	`HAL_CONFIG_IO_PERIPHERAL
(
HAL_LCD_CLK_PORT
, 
HAL_LCD_CLK_PIN
);

537 
	`HAL_CONFIG_IO_PERIPHERAL
(
HAL_LCD_MOSI_PORT
, 
HAL_LCD_MOSI_PIN
);

538 
	`HAL_CONFIG_IO_PERIPHERAL
(
HAL_LCD_MISO_PORT
, 
HAL_LCD_MISO_PIN
);

544 
baud_exp⁄ít
 = 15;

545 
baud_m™tisß
 = 0;

548 
U1UCR
 = 0x80;

549 
U1CSR
 = 0x00;

550 
U1GCR
 = 
HAL_SPI_TRANSFER_MSB_FIRST
 | 
HAL_SPI_CLOCK_PHA_0
 | 
HAL_SPI_CLOCK_POL_LO
 | 
baud_exp⁄ít
;

551 
U1BAUD
 = 
baud_m™tisß
;

552 
	}
}

563 
	$HÆLcd_HW_Inô
()

566 
	`hÆLcd_C⁄figIO
();

569 
	`hÆLcd_C⁄figSPI
();

572 
	`LCD_ACTIVATE_RESET
();

573 
	`HÆLcd_HW_WaôUs
(15000);

574 
	`LCD_RELEASE_RESET
();

575 
	`HÆLcd_HW_WaôUs
(15);

578 
	`FUNCTION_SET
(
CGRAM
 | 
COM_FORWARD
 | 
THREE_LINE
);

581 
	`HÆLcd_HW_SëC⁄åa°
(15);

584 
	`SET_POWER_SAVE_MODE
(
OSC_OFF
 | 
POWER_SAVE_ON
);

585 
	`SET_POWER_CTRL
(
VOLTAGE_DIVIDER_ON
 | 
CONVERTER_AND_REG_ON
);

586 
	`SET_BIAS_CTRL
(
BIAS_1_5
);

587 
	`HÆLcd_HW_WaôUs
(21000);

590 
	`HÆLcd_HW_CÀ¨
();

591 
	`HÆLcd_HW_CÀ¨AŒS≥cCh¨s
();

592 
	`SET_DISPLAY_CTRL
(
DISPLAY_CTRL_ON
 | 
DISPLAY_CTRL_BLINK_OFF
 | 
DISPLAY_CTRL_CURSOR_OFF
);

593 
	}
}

604 
	$HÆLcd_HW_C⁄åﬁ
(
uöt8
 
cmd
)

606 
	`LCD_SPI_BEGIN
();

607 
	`LCD_DO_CONTROL
();

608 
	`LCD_SPI_TX
(
cmd
);

609 
	`LCD_SPI_WAIT_RXRDY
();

610 
	`LCD_SPI_END
();

611 
	}
}

622 
	$HÆLcd_HW_Wrôe
(
uöt8
 
d©a
)

624 
	`LCD_SPI_BEGIN
();

625 
	`LCD_DO_WRITE
();

626 
	`LCD_SPI_TX
(
d©a
);

627 
	`LCD_SPI_WAIT_RXRDY
();

628 
	`LCD_SPI_END
();

629 
	}
}

640 
	$HÆLcd_HW_SëC⁄åa°
(
uöt8
 
vÆue
)

642 
	`SET_ICONRAM_ADDR
(
CONTRAST_CTRL_REGISTER
);

643 
	`HÆLcd_HW_Wrôe
(
vÆue
);

644 
	}
}

655 
	$HÆLcd_HW_CÀ¨
()

657 
uöt8
 
n
;

659 
	`SET_DDRAM_ADDR
(0x00);

660 
n
 = 0;Ç < (
LCD_MAX_LINE_COUNT
 * 
HAL_LCD_MAX_CHARS
);Ç++)

662 
	`HÆLcd_HW_Wrôe
(' ');

664 
	}
}

675 
	$HÆLcd_HW_CÀ¨AŒS≥cCh¨s
()

677 
uöt8
 
n
 = 0;

679 
	`SET_GCRAM_CHAR
(0);

680 
n
 = 0;Ç < (8 * 8);Ç++)

682 
	`HÆLcd_HW_Wrôe
(0x00);

684 
	}
}

696 
	$HÆLcd_HW_WrôeCh¨
(
uöt8
 
löe
, uöt8 
cﬁ
, 
ãxt
)

698 i‡(
cﬁ
 < 
HAL_LCD_MAX_CHARS
)

700 
	`SET_DDRAM_ADDR
((
löe
 - 1Ë* 
HAL_LCD_MAX_CHARS
 + 
cﬁ
);

701 
	`HÆLcd_HW_Wrôe
(
ãxt
);

707 
	}
}

719 
	$HÆLcd_HW_WrôeLöe
(
uöt8
 
löe
, c⁄° *
pText
)

721 
uöt8
 
cou¡
;

722 
uöt8
 
tŸÆLígth
 = (uöt8)
	`oßl_°æí
–(*)
pText
 );

725 
cou¡
=0; cou¡<
tŸÆLígth
; count++)

727 
	`HÆLcd_HW_WrôeCh¨
(
löe
, 
cou¡
, (*(
pText
++)));

731 
cou¡
=
tŸÆLígth
; cou¡<
HAL_LCD_MAX_CHARS
;count++)

733 
	`HÆLcd_HW_WrôeCh¨
(
löe
, 
cou¡
, ' ');

735 
	}
}

746 
	$HÆLcd_HW_WaôUs
(
uöt16
 
mi¸oSecs
)

748 
mi¸oSecs
--)

751 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

752 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

753 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

754 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

755 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

756 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

757 
	`asm
("nop");ásm("nop");

759 
	}
}

	@Components/hal/target/CC2540EB/hal_led.c

44 
	~"hÆ_mcu.h
"

45 
	~"hÆ_defs.h
"

46 
	~"hÆ_ty≥s.h
"

47 
	~"hÆ_drivîs.h
"

48 
	~"hÆ_Àd.h
"

49 
	~"oßl.h
"

50 
	~"hÆ_bﬂrd.h
"

58 
uöt8
 
	mmode
;

59 
uöt8
 
	mÀ·
;

60 
uöt8
 
	m⁄P˘
;

61 
uöt16
 
	mtime
;

62 
uöt32
 
	m√xt
;

63 } 
	tHÆLedC⁄åﬁ_t
;

67 
HÆLedC⁄åﬁ_t
 
	mHÆLedC⁄åﬁTabÀ
[
HAL_LED_DEFAULT_MAX_LEDS
];

68 
uöt8
 
	m¶ìpA˘ive
;

69 } 
	tHÆLedSètus_t
;

75 
uöt8
 
	gHÆLedSèã
;

77 #i‡
HAL_LED
 =
TRUE


78 
uöt8
 
	gHÆSÀïLedSèã
;

79 
uöt8
 
	g¥eBlökSèã
;

83 #ifde‡
BLINK_LEDS


84 
HÆLedSètus_t
 
	gHÆLedSètusC⁄åﬁ
;

91 #i‡(
HAL_LED
 =
TRUE
)

92 
HÆLedUpd©e
 ();

93 
HÆLedOnOff
 (
uöt8
 
Àds
, uöt8 
mode
);

109 
	$HÆLedInô
 ()

111 #i‡(
HAL_LED
 =
TRUE
)

112 
	`HÆLedSë
(
HAL_LED_ALL
, 
HAL_LED_MODE_OFF
);

115 
LED1_DDR
 |
LED1_BV
;

116 #i‡(!
deföed
 
HAL_PA_LNA
 && !deföed 
HAL_PA_LNA_CC2590
)

117 
LED2_DDR
 |
LED2_BV
;

118 #i‡(!
deföed
 
CC2540_MINIDK
 && !deföed 
HAL_BOARD_CC2540USB
)

119 
LED3_DDR
 |
LED3_BV
;

122 #i‡
deföed
 
BLINK_LEDS


123 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
FALSE
;

126 
	}
}

137 
uöt8
 
	$HÆLedSë
 (
uöt8
 
Àds
, uöt8 
mode
)

140 #i‡(
	`deföed
 (
BLINK_LEDS
)Ë&& (
HAL_LED
 =
TRUE
)

141 
uöt8
 
Àd
;

142 
HÆLedC⁄åﬁ_t
 *
°s
;

144 
mode
)

146 
HAL_LED_MODE_BLINK
:

148 
	`HÆLedBlök
 (
Àds
, 1, 
HAL_LED_DEFAULT_DUTY_CYCLE
, 
HAL_LED_DEFAULT_FLASH_TIME
);

151 
HAL_LED_MODE_FLASH
:

153 
	`HÆLedBlök
 (
Àds
, 
HAL_LED_DEFAULT_FLASH_COUNT
, 
HAL_LED_DEFAULT_DUTY_CYCLE
, 
HAL_LED_DEFAULT_FLASH_TIME
);

156 
HAL_LED_MODE_ON
:

157 
HAL_LED_MODE_OFF
:

158 
HAL_LED_MODE_TOGGLE
:

160 
Àd
 = 
HAL_LED_1
;

161 
Àds
 &
HAL_LED_ALL
;

162 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

164 
Àds
)

166 i‡(
Àds
 & 
Àd
)

168 i‡(
mode
 !
HAL_LED_MODE_TOGGLE
)

170 
°s
->
mode
 = mode;

174 
°s
->
mode
 ^
HAL_LED_MODE_ON
;

176 
	`HÆLedOnOff
 (
Àd
, 
°s
->
mode
);

177 
Àds
 ^
Àd
;

179 
Àd
 <<= 1;

180 
°s
++;

188 #ñi‡(
HAL_LED
 =
TRUE
)

189 
	`LedOnOff
(
Àds
, 
mode
);

192 (Ë
Àds
;

193 (Ë
mode
;

196  ( 
HÆLedSèã
 );

197 
	}
}

212 
	$HÆLedBlök
 (
uöt8
 
Àds
, uöt8 
numBlöks
, uöt8 
≥r˚¡
, 
uöt16
 
≥riod
)

214 #i‡(
	`deföed
 (
BLINK_LEDS
)Ë&& (
HAL_LED
 =
TRUE
)

215 
uöt8
 
Àd
;

216 
HÆLedC⁄åﬁ_t
 *
°s
;

218 i‡(
Àds
 && 
≥r˚¡
 && 
≥riod
)

220 i‡(
≥r˚¡
 < 100)

222 
Àd
 = 
HAL_LED_1
;

223 
Àds
 &
HAL_LED_ALL
;

224 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

226 
Àds
)

228 i‡(
Àds
 & 
Àd
)

231 if(
°s
->
mode
 < 
HAL_LED_MODE_BLINK
 )

232 
¥eBlökSèã
 |(
Àd
 & 
HÆLedSèã
);

234 
°s
->
mode
 = 
HAL_LED_MODE_OFF
;

235 
°s
->
time
 = 
≥riod
;

236 
°s
->
⁄P˘
 = 
≥r˚¡
;

237 
°s
->
À·
 = 
numBlöks
;

238 i‡(!
numBlöks
Ë
°s
->
mode
 |
HAL_LED_MODE_FLASH
;

239 
°s
->
√xt
 = 
	`oßl_GëSy°emClock
();

240 
°s
->
mode
 |
HAL_LED_MODE_BLINK
;

241 
Àds
 ^
Àd
;

243 
Àd
 <<= 1;

244 
°s
++;

247 
	`oßl_°›_timîEx
(
HÆ_TaskID
, 
HAL_LED_BLINK_EVENT
);

248 
	`oßl_£t_evít
 (
HÆ_TaskID
, 
HAL_LED_BLINK_EVENT
);

252 
	`HÆLedSë
 (
Àds
, 
HAL_LED_MODE_ON
);

257 
	`HÆLedSë
 (
Àds
, 
HAL_LED_MODE_OFF
);

259 #ñi‡(
HAL_LED
 =
TRUE
)

260 
≥r˚¡
 = (
Àds
 & 
HÆLedSèã
Ë? 
HAL_LED_MODE_OFF
 : 
HAL_LED_MODE_ON
;

261 
	`HÆLedOnOff
 (
Àds
, 
≥r˚¡
);

264 (Ë
Àds
;

265 (Ë
numBlöks
;

266 (Ë
≥r˚¡
;

267 (Ë
≥riod
;

269 
	}
}

271 #i‡(
HAL_LED
 =
TRUE
)

281 
	$HÆLedUpd©e
 ()

283 
uöt8
 
Àd
;

284 
uöt8
 
p˘
;

285 
uöt8
 
Àds
;

286 
HÆLedC⁄åﬁ_t
 *
°s
;

287 
uöt32
 
time
;

288 
uöt16
 
√xt
;

289 
uöt16
 
waô
;

291 
√xt
 = 0;

292 
Àd
 = 
HAL_LED_1
;

293 
Àds
 = 
HAL_LED_ALL
;

294 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

297 i‡(!
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
)

299 
Àds
)

301 i‡(
Àds
 & 
Àd
)

303 i‡(
°s
->
mode
 & 
HAL_LED_MODE_BLINK
)

305 
time
 = 
	`oßl_GëSy°emClock
();

306 i‡(
time
 >
°s
->
√xt
)

308 i‡(
°s
->
mode
 & 
HAL_LED_MODE_ON
)

310 
p˘
 = 100 - 
°s
->
⁄P˘
;

311 
°s
->
mode
 &~
HAL_LED_MODE_ON
;

312 
	`HÆLedOnOff
 (
Àd
, 
HAL_LED_MODE_OFF
);

314 i‡–!(
°s
->
mode
 & 
HAL_LED_MODE_FLASH
) )

316 
°s
->
À·
--;

319 i‡–!(
°s
->
À·
Ë&& !(°s->
mode
 & 
HAL_LED_MODE_FLASH
) )

321 
°s
->
mode
 ^
HAL_LED_MODE_BLINK
;

325 
p˘
 = 
°s
->
⁄P˘
;

326 
°s
->
mode
 |
HAL_LED_MODE_ON
;

327 
	`HÆLedOnOff
–
Àd
, 
HAL_LED_MODE_ON
 );

329 i‡(
°s
->
mode
 & 
HAL_LED_MODE_BLINK
)

331 
waô
 = (((
uöt32
)
p˘
 * (uöt32)
°s
->
time
) / 100);

332 
°s
->
√xt
 = 
time
 + 
waô
;

337 
waô
 = 0;

339 
	`HÆLedSë
 (
Àd
, ((
¥eBlökSèã
 &Üed)!=0)?
HAL_LED_MODE_ON
:
HAL_LED_MODE_OFF
);

341 
¥eBlökSèã
 &(
Àd
 ^ 0xFF);

346 
waô
 = 
°s
->
√xt
 - 
time
;

349 i‡(!
√xt
 || ( 
waô
 && (wait <Çext) ))

351 
√xt
 = 
waô
;

354 
Àds
 ^
Àd
;

356 
Àd
 <<= 1;

357 
°s
++;

360 i‡(
√xt
)

362 
	`oßl_°¨t_timîEx
(
HÆ_TaskID
, 
HAL_LED_BLINK_EVENT
, 
√xt
);

365 
	}
}

377 
	$HÆLedOnOff
 (
uöt8
 
Àds
, uöt8 
mode
)

379 i‡(
Àds
 & 
HAL_LED_1
)

381 i‡(
mode
 =
HAL_LED_MODE_ON
)

383 
	`HAL_TURN_ON_LED1
();

387 
	`HAL_TURN_OFF_LED1
();

391 i‡(
Àds
 & 
HAL_LED_2
)

393 i‡(
mode
 =
HAL_LED_MODE_ON
)

395 
	`HAL_TURN_ON_LED2
();

399 
	`HAL_TURN_OFF_LED2
();

403 i‡(
Àds
 & 
HAL_LED_3
)

405 i‡(
mode
 =
HAL_LED_MODE_ON
)

407 
	`HAL_TURN_ON_LED3
();

411 
	`HAL_TURN_OFF_LED3
();

415 i‡(
Àds
 & 
HAL_LED_4
)

417 i‡(
mode
 =
HAL_LED_MODE_ON
)

419 
	`HAL_TURN_ON_LED4
();

423 
	`HAL_TURN_OFF_LED4
();

428 i‡(
mode
)

430 
HÆLedSèã
 |
Àds
;

434 
HÆLedSèã
 &(
Àds
 ^ 0xFF);

436 
	}
}

448 
uöt8
 
	$HÆLedGëSèã
 ()

450 #i‡(
HAL_LED
 =
TRUE
)

451  
HÆLedSèã
;

455 
	}
}

466 
	$HÆLedE¡îSÀï
( )

468 #ifde‡
BLINK_LEDS


470 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
TRUE
;

473 #i‡(
HAL_LED
 =
TRUE
)

475 
HÆSÀïLedSèã
 = 0;

476 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED1
();

477 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED2
() << 1;

478 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED3
() << 2;

479 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED4
() << 3;

482 
	`HÆLedOnOff
 (
HAL_LED_ALL
, 
HAL_LED_MODE_OFF
);

485 
	}
}

496 
	$HÆLedExôSÀï
( )

498 #i‡(
HAL_LED
 =
TRUE
)

500 
	`HÆLedOnOff
(
HÆSÀïLedSèã
, 
HAL_LED_MODE_ON
);

503 
	`HÆLedUpd©e
();

506 #ifde‡
BLINK_LEDS


508 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
FALSE
;

510 
	}
}

	@Components/hal/target/CC2540EB/hal_mcu.h

40 #i‚de‡
_HAL_MCU_H


41 
	#_HAL_MCU_H


	)

53 
	~"hÆ_defs.h
"

54 
	~"hÆ_ty≥s.h
"

61 
	#HAL_MCU_CC2540


	)

70 #ifde‡
__IAR_SYSTEMS_ICC__


72 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

73 
	~<ioCC2541.h
>

75 
	~<ioCC2540.h
>

78 
	#HAL_COMPILER_IAR


	)

79 
	#HAL_MCU_LITTLE_ENDIAN
(Ë
__LITTLE_ENDIAN__


	)

80 
	#_PRAGMA
(
x
Ë
	`_Pøgma
(#x)

	)

81 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

82 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

83 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

86 #ñi‡
deföed
 
__KEIL__


88 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

89 
	~<CC2541.h
>

91 
	~<CC2540.h
>

94 
	#HAL_COMPILER_KEIL


	)

95 
	#HAL_MCU_LITTLE_ENDIAN
(Ë0

	)

96 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`f
(Ë
öãºu±
 
	)
v

97 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`f
()

	)

98 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

110 
	#HAL_ENABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 1; )

	)

111 
	#HAL_DISABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 0; )

	)

112 
	#HAL_INTERRUPTS_ARE_ENABLED
(Ë(
EA
)

	)

114 
	thÆI¡Sèã_t
;

115 
	#HAL_ENTER_CRITICAL_SECTION
(
x
Ë
	`°
–x = 
EA
; 
	`HAL_DISABLE_INTERRUPTS
(); )

	)

116 
	#HAL_EXIT_CRITICAL_SECTION
(
x
Ë
	`°
–
EA
 = x; )

	)

117 
	#HAL_CRITICAL_STATEMENT
(
x
Ë
	`°
–
hÆI¡Sèã_t
 
_s
; 
	`HAL_ENTER_CRITICAL_SECTION
(_s); x; 
	`HAL_EXIT_CRITICAL_SECTION
(_s); )

	)

119 #ifde‡
__IAR_SYSTEMS_ICC__


125 
	#HAL_ENTER_ISR
(Ë{ 
hÆI¡Sèã_t
 
_i§I¡Sèã
 = 
EA
; 
	`HAL_ENABLE_INTERRUPTS
();

	)

126 
	#HAL_EXIT_ISR
(Ë
EA
 = 
_i§I¡Sèã
; }

	)

128 
	#HAL_ENTER_ISR
()

	)

129 
	#HAL_EXIT_ISR
()

	)

136 
	#WD_EN
 
	`BV
(3)

	)

137 
	#WD_MODE
 
	`BV
(2)

	)

138 
	#WD_INT_1900_USEC
 (
	`BV
(0Ë| BV(1))

	)

139 
	#WD_RESET1
 (0xA0 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

140 
	#WD_RESET2
 (0x50 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

141 
	#WD_KICK
(Ë
	`°
–
WDCTL
 = (0xA0 | WDCTL & 0x0F); WDCTL = (0x50 | WDCTL & 0x0F); )

	)

144 
	#HAL_SYSTEM_RESET
(Ë
	`°
–
	`HAL_DISABLE_INTERRUPTS
(); 
WDCTL
 = 
WD_RESET1
; WDCTL = 
WD_RESET2
; ;;); )

	)

150 
	#REV_A
 0x00

	)

151 
	#REV_B
 0x11

	)

152 
	#REV_C
 0x20

	)

153 
	#REV_D
 0x21

	)

161 
	#PCON_IDLE
 
	`BV
(0Ë

	)

164 
	#OSC_PD
 
	`BV
(2Ë

	)

165 
	#PMODE
 (
	`BV
(1Ë| BV(0)Ë

	)

168 
	#XOSC_STB
 
	`BV
(6Ë

	)

169 
	#HFRC_STB
 
	`BV
(5Ë

	)

172 
	#OSC_PD
 
	`BV
(2Ë

	)

176 
	#OSC
 
	`BV
(6)

	)

177 
	#TICKSPD
(
x
Ë(x << 3)

	)

178 
	#CLKSPD
(
x
Ë(x << 0)

	)

179 
	#CLKCONCMD_32MHZ
 (0)

	)

180 
	#CLKCONCMD_16MHZ
 (
	`CLKSPD
(1Ë| 
	`TICKSPD
(1Ë| 
OSC
)

	)

183 
	#LDRDY
 
	`BV
(0Ë

	)

187 #ifde‡
POWER_SAVING


188 vﬁ©ûê
__d©a
 
uöt8
 
hÆSÀïPc⁄VÆue
;

193 
	#CLEAR_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 0; )

	)

194 
	#ALLOW_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; )

	)

196 
	#CLEAR_SLEEP_MODE
()

	)

197 
	#ALLOW_SLEEP_MODE
()

	)

	@Components/hal/target/CC2540EB/hal_sleep.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"hÆ_mcu.h
"

45 
	~"hÆ_bﬂrd.h
"

46 
	~"hÆ_¶ìp.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"OSAL.h
"

50 
	~"OSAL_Timîs.h
"

51 
	~"OSAL_Tasks.h
"

52 
	~"OSAL_PwrMgr.h
"

53 
	~"hÆ_drivîs.h
"

54 
	~"hÆ_as£π.h
"

55 
	~"Œ_¶ìp.h
"

56 
	~"Œ_timî2.h
"

57 
	~"Œ_m©h.h
"

63 #i‚de‡
HAL_SLEEP_DEBUG_POWER_MODE


65 
	#HAL_SLEEP_PREP_POWER_MODE
(
mode
) \

66 
	`°
–
SLEEPCMD
 &~
PMODE
; \

67 
SLEEPCMD
 |
mode
; \

68 !(
STLOAD
 & 
LDRDY
)); \

69 
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; \

70 )

	)

71 
	#HAL_SLEEP_SET_POWER_MODE
() \

72 
	`hÆSëSÀïMode
()

	)

77 
	#HAL_SLEEP_PREP_POWER_MODE
(
mode
Ë

	)

78 
	#HAL_SLEEP_SET_POWER_MODE
() \

79 
	`°
–
hÆSÀïI¡
 =
FALSE
); \

80 
hÆSÀïI¡
 = 
FALSE
; \

81 
	`HAL_DISABLE_INTERRUPTS
(); \

82 )

	)

86 
	#HAL_SLEEP_TIMER_ENABLE_INT
(Ë
	`°
(
IEN0
 |
STIE_BV
;)

87 
	#HAL_SLEEP_TIMER_DISABLE_INT
(Ë
	`°
(
IEN0
 &~
STIE_BV
;)

88 
	#HAL_SLEEP_TIMER_CLEAR_INT
(Ë
	`°
(
IRCON
 &= ~0x80;)

89 

	)

91 
	#HAL_SLEEP_IE_BACKUP_AND_DISABLE
–
õn0
, 
õn1
, 
õn2
 ) \

92 
	`°
–(
õn0
Ë
IEN0
; \

93 (
õn1
Ë
IEN1
; \

94 (
õn2
Ë
IEN2
; \

95 
IEN0
 &
STIE_BV
; \

96 
IEN1
 &
P0IE_BV
; \

97 
IEN2
 &(
P1IE_BV
|
P2IE_BV
); \

98 )

	)

101 
	#HAL_SLEEP_IE_RESTORE
–
õn0
, 
õn1
, 
õn2
 ) \

102 
	`°
–
IEN0
 = (
õn0
); \

103 
IEN1
 = (
õn1
); \

104 
IEN2
 = (
õn2
); \

105 )

	)

108 
	#HAL_SLEEP_MS_TO_625US
–
ms
 ) (((((
uöt32
Ë(ms)Ë* 8Ë+ 4Ë/ 5)

	)

112 
	#HAL_SLEEP_MS_TO_32KHZ
–
ms
 ) ((((
uöt32
Ë(ms)Ë* 4096Ë/ 125)

	)

128 
	#MAX_SLEEP_TIMEOUT
 40000

	)

136 
	#CC2540_PM0
 0

137 
	#CC2540_PM1
 1

138 
	#CC2540_PM2
 2

139 
	#CC2540_PM3
 3

140 

	)

147 
	#HAL_SLEEP_OFF
 
CC2540_PM0


	)

148 
	#HAL_SLEEP_TIMER
 
CC2540_PM2


	)

149 
	#HAL_SLEEP_DEEP
 
CC2540_PM3


	)

154 
	#MAX_SLEEP_TIME
 16711680

155 

	)

159 #i‡!
deföed
 (
PM_MIN_SLEEP_TIME
)

160 
	#PM_MIN_SLEEP_TIME
 66

162 

	)

169 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

170 
	#HAL_SLEEP_ADJ_TICKS
 25

171 #ñ£ // CC2540

	)

172 
	#HAL_SLEEP_ADJ_TICKS
 35

174 

	)

176 
	#STIE_BV
 
	`BV
(5)

	)

177 
	#P0IE_BV
 
	`BV
(5)

	)

178 
	#P1IE_BV
 
	`BV
(4)

	)

179 
	#P2IE_BV
 
	`BV
(1)

	)

182 #i‡
HAL_MCU_LITTLE_ENDIAN
()

183 
	#UINT32_NDX0
 0

	)

184 
	#UINT32_NDX1
 1

	)

185 
	#UINT32_NDX2
 2

	)

186 
	#UINT32_NDX3
 3

	)

188 
	#UINT32_NDX0
 3

	)

189 
	#UINT32_NDX1
 2

	)

190 
	#UINT32_NDX2
 1

	)

191 
	#UINT32_NDX3
 0

	)

203 
uöt8
 
	ghÆPwrMgtMode
 = 
HAL_SLEEP_OFF
;

206 
uöt8
 
	gwakeF‹RF
;

208 #ifde‡
HAL_SLEEP_DEBUG_POWER_MODE


209 
boﬁ
 
	ghÆSÀïI¡
 = 
FALSE
;

217 vﬁ©ûê
__d©a
 
uöt8
 
	ghÆSÀïPc⁄VÆue
 = 
PCON_IDLE
;

226 #¥agm®
loˇti⁄
 = "SLEEP_CODE"

227 
hÆSëSÀïMode
();

229 
hÆSÀïSëTimî
–
uöt32
 
¶ìpTime
, uöt32 
timeout
 );

230 
uöt32
 
hÆSÀïRódTimî
( );

231 
uöt32
 
TimîEœp£d
( );

251 #¥agm®
›timize
=
n⁄e


252 
	$hÆSëSÀïMode
()

255 
PCON
 = 
hÆSÀïPc⁄VÆue
;

257 
	`HAL_DISABLE_INTERRUPTS
();

258 
	}
}

277 
	$hÆSÀï
–
uöt32
 
oßl_timeout
 )

279 
uöt32
 
timeout
;

280 
uöt32
 
ŒTimeout
;

281 
uöt32
 
¶ìpTimî
;

283 #ifde‡
DEBUG_GPIO


285 
P1_0
 = 1;

289 i‡(
oßl_timeout
 > 
MAX_SLEEP_TIMEOUT
)

291 
oßl_timeout
 = 
MAX_SLEEP_TIMEOUT
;

295 
	`LL_TimeToNextRfEvít
–&
¶ìpTimî
, &
ŒTimeout
 );

301 i‡(
oßl_timeout
 == 0)

304 
timeout
 = 
ŒTimeout
;

309 
wakeF‹RF
 = (
timeout
 !0Ë? 
TRUE
 : 
FALSE
;

315 
timeout
 = 
	`HAL_SLEEP_MS_TO_32KHZ
–
oßl_timeout
 );

318 i‡((
ŒTimeout
 !0Ë&& (ŒTimeouà< 
timeout
))

321 
timeout
 = 
ŒTimeout
;

324 
wakeF‹RF
 = 
TRUE
;

329 
¶ìpTimî
 = 
	`hÆSÀïRódTimî
();

332 
wakeF‹RF
 = 
FALSE
;

337 
hÆPwrMgtMode
 = (
timeout
 =0Ë? 
HAL_SLEEP_DEEP
 : 
HAL_SLEEP_TIMER
;

339 #ifde‡
DEBUG_GPIO


341 
P1_0
 = 0;

345 i‡–(
timeout
 > 
PM_MIN_SLEEP_TIME
) || (timeout == 0) )

347 
hÆI¡Sèã_t
 
õn0
, 
õn1
, 
õn2
;

349 #ifde‡
DEBUG_GPIO


351 
P1_0
 = 1;

354 
	`HAL_ASSERT
–
	`HAL_INTERRUPTS_ARE_ENABLED
() );

355 
	`HAL_DISABLE_INTERRUPTS
();

358 i‡–
	`LL_PowîOffReq
(
hÆPwrMgtMode
Ë=
LL_SLEEP_REQUEST_ALLOWED
 )

360 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

362 
	`HÆKeyE¡îSÀï
();

365 #ifde‡
HAL_SLEEP_DEBUG_LED


366 
	`HAL_TURN_OFF_LED3
();

369 
	`HÆLedE¡îSÀï
();

373 i‡(
timeout
 != 0)

376 i‡(
timeout
 > 
MAX_SLEEP_TIME
 )

379 
	`hÆSÀïSëTimî
–
¶ìpTimî
, 
MAX_SLEEP_TIME
 );

384 
	`hÆSÀïSëTimî
–
¶ìpTimî
, 
timeout
 );

389 
	`HAL_SLEEP_PREP_POWER_MODE
(
hÆPwrMgtMode
);

392 
	`HAL_SLEEP_IE_BACKUP_AND_DISABLE
(
õn0
, 
õn1
, 
õn2
);

393 
	`HAL_ENABLE_INTERRUPTS
();

395 #ifde‡
DEBUG_GPIO


397 
P1_0
 = 0;

405 
	`HAL_SLEEP_SET_POWER_MODE
();

407 #ifde‡
DEBUG_GPIO


409 
P1_0
 = 1;

422 i‡–(
wakeF‹RF
 =
TRUE
Ë&& !(
IRCON
 & 0x80) )

424 
wakeF‹RF
 = 
FALSE
;

428 
	`HAL_SLEEP_IE_RESTORE
(
õn0
, 
õn1
, 
õn2
);

433 
	`LL_PowîOnReq
–(
hÆPwrMgtMode
 =
CC2540_PM3
), 
wakeF‹RF
 );

435 #ifde‡
HAL_SLEEP_DEBUG_LED


436 
	`HAL_TURN_ON_LED3
();

439 
	`HÆLedExôSÀï
();

442 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

444 ()
	`HÆKeyExôSÀï
();

448 
	`HAL_ENABLE_INTERRUPTS
();

451 #ifde‡
DEBUG_GPIO


453 
P1_0
 = 0;

457 
	}
}

485 
	$hÆSÀïSëTimî
–
uöt32
 
¶ìpTimî
, uöt32 
timeout
 )

487 
	`HAL_SLEEP_TIMER_DISABLE_INT
();

490 
¶ìpTimî
 +
timeout
;

493 
¶ìpTimî
 -
HAL_SLEEP_ADJ_TICKS
;

496 
ST2
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX2
];

497 
ST1
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX1
];

498 
ST0
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX0
];

500 
	`HAL_SLEEP_TIMER_CLEAR_INT
();

501 
	`HAL_SLEEP_TIMER_ENABLE_INT
();

504 
	}
}

522 
uöt32
 
	$hÆSÀïRódTimî
( )

524 
uöt32
 
¶ìpTimî
;

528 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX0
] = 
ST0
;

529 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX1
] = 
ST1
;

530 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX2
] = 
ST2
;

531 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX3
] = 0;

533 –
¶ìpTimî
 );

534 
	}
}

552 
uöt32
 
	$TimîEœp£d
( )

555 
	}
}

573 
	$hÆRe°‹eSÀïLevñ
( )

576 #ifde‡
PM_TEST


577 
	`oßl_°¨t_timîEx
 (
HÆ_TaskID
, 
HAL_SLEEP_TIMER_EVENT
, 1000);

579 
	}
}

597 
	$HAL_ISR_FUNCTION
(
hÆSÀïTimîI§
, 
ST_VECTOR
)

599 
	`HAL_ENTER_ISR
();

601 
	`HAL_SLEEP_TIMER_CLEAR_INT
();

603 #ifde‡
HAL_SLEEP_DEBUG_POWER_MODE


604 
hÆSÀïI¡
 = 
TRUE
;

607 
	`CLEAR_SLEEP_MODE
();

609 
	`HAL_EXIT_ISR
();

612 
	}
}

	@Components/hal/target/CC2540EB/hal_startup.c

42 
	~"hÆ_bﬂrd.h
"

43 
	~"hÆ_ty≥s.h
"

45 #ifde‡
__˝lu•lus


49 #¥agm®
œnguage
=
exãnded


54 #¥agm®
loˇti⁄
="CSTART"

59 #i‡(
__CODE_MODEL__
 == 2)

60 
__√¨_func
 
__roŸ
 

62 
__roŸ
 

64 
__low_Àvñ_öô
();

77 #i‡(
__CODE_MODEL__
 == 2)

78 
__√¨_func
 
__roŸ
 

80 
__roŸ
 

82 
__low_Àvñ_öô
()

88 #i‡
deföed
 
HAL_IMAGE_A


89 
MEMCTR
 = (MEMCTR & 0xF8) | 0x05;

90 #ñi‡
deföed
 
HAL_IMAGE_B


91 
MEMCTR
 = (MEMCTR & 0xF8) | 0x04;

93 
MEMCTR
 = (MEMCTR & 0xF8) | 0x01;

105 #¥agm®
œnguage
=

107 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2540EB/hal_timer.c

	@Components/hal/target/CC2540EB/hal_types.h

44 #i‚de‡
_HAL_TYPES_H


45 
	#_HAL_TYPES_H


	)

56 sig√d 
	töt8
;

57 
	tuöt8
;

59 sig√d 
	töt16
;

60 
	tuöt16
;

62 sig√d 
	töt32
;

63 
	tuöt32
;

65 
	tboﬁ
;

67 
uöt8
 
	thÆD©aAlign_t
;

76 #ifde‡
__IAR_SYSTEMS_ICC__


77 
	#CODE
 
__code


	)

78 
	#XDATA
 
__xd©a


	)

79 
	#DATA
 
__d©a


	)

80 
	#NEAR_FUNC
 
__√¨_func


	)

81 
	#ASM_NOP
 
	`asm
("NOP")

	)

84 #ñi‡
deföed
 
__KEIL__


85 
	#CODE
 
code


	)

86 
	#XDATA
 
xd©a


	)

87 
	#ASM_NOP
 
	`__n›
()

	)

90 #ñi‡
deföed
 
__GNUC__


91 
	#ASM_NOP
 
__asm__
 
	`__vﬁ©ûe__
 ("n›")

	)

94 #ñi‡
_MSC_VER


95 
	#ASM_NOP
 
__asm
 
NOP


	)

98 #ñi‡
deföed
 
__TI_COMPILER_VERSION


99 
	#ASM_NOP
 
	`asm
(" NOP")

	)

111 #i‚de‡
TRUE


112 
	#TRUE
 1

	)

115 #i‚de‡
FALSE


116 
	#FALSE
 0

	)

119 #i‚de‡
NULL


120 
	#NULL
 0

	)

	@Components/hal/target/CC2540EB/hal_uart.c

44 
	~"hÆ_bﬂrd_cfg.h
"

45 
	~"hÆ_defs.h
"

46 
	~"hÆ_drivîs.h
"

47 
	~"hÆ_ty≥s.h
"

48 
	~"hÆ_u¨t.h
"

49 #i‡
deföed
 
POWER_SAVING


50 
	~"OSAL.h
"

51 
	~"OSAL_PwrMgr.h
"

58 
HÆUARTI§DMA
();

64 #i‡
HAL_UART_DMA


65 
	~"_hÆ_u¨t_dma.c
"

67 #i‡
HAL_UART_ISR


68 
	~"_hÆ_u¨t_i§.c
"

70 #i‡
HAL_UART_SPI


71 
	~"_hÆ_u¨t_•i.c
"

73 #i‡
HAL_UART_USB


74 
	~"_hÆ_u¨t_usb.c
"

86 
	$HÆUARTInô
()

88 #i‡(
HAL_UART_DMA
 && 
HAL_UART_SPI
)

89 i‡(
HAL_UART_PORT
)

91 
	`HÆUARTInôSPI
();

95 
	`HÆUARTInôDMA
();

98 #i‡
HAL_UART_DMA


99 
	`HÆUARTInôDMA
();

101 #i‡
HAL_UART_ISR


102 
	`HÆUARTInôISR
();

104 #i‡
HAL_UART_SPI


105 
	`HÆUARTInôSPI
();

107 #i‡
HAL_UART_USB


108 
	`HÆUARTInôUSB
();

111 
	}
}

123 
uöt8
 
	$HÆUARTO≥n
(
uöt8
 
p‹t
, 
hÆUARTCfg_t
 *
c⁄fig
)

125 #i‡(
HAL_UART_DMA
 == 1)

126 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë
	`HÆUARTO≥nDMA
(
c⁄fig
);

128 #i‡(
HAL_UART_DMA
 == 2)

129 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë
	`HÆUARTO≥nDMA
(
c⁄fig
);

131 #i‡(
HAL_UART_ISR
 == 1)

132 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë
	`HÆUARTO≥nISR
(
c⁄fig
);

134 #i‡(
HAL_UART_ISR
 == 2)

135 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë
	`HÆUARTO≥nISR
(
c⁄fig
);

137 #i‡(
HAL_UART_SPI
 == 1)

138 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë
	`HÆUARTO≥nSPI
(
c⁄fig
);

140 #i‡(
HAL_UART_SPI
 == 2)

141 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë
	`HÆUARTO≥nSPI
(
c⁄fig
);

143 #i‡(
HAL_UART_USB
)

144 
	`HÆUARTO≥nUSB
(
c⁄fig
);

146 #i‡(
HAL_UART_DMA
 =0Ë&& (
HAL_UART_ISR
 =0Ë&& (
HAL_UART_SPI
 == 0)

148 (Ë
p‹t
;

149 (Ë
c⁄fig
;

152  
HAL_UART_SUCCESS
;

153 
	}
}

166 
uöt16
 
	$HÆUARTRód
(
uöt8
 
p‹t
, uöt8 *
buf
, 
uöt16
 
Àn
)

168 #i‡(
HAL_UART_DMA
 == 1)

169 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRódDMA
(
buf
, 
Àn
);

171 #i‡(
HAL_UART_DMA
 == 2)

172 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRódDMA
(
buf
, 
Àn
);

174 #i‡(
HAL_UART_ISR
 == 1)

175 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRódISR
(
buf
, 
Àn
);

177 #i‡(
HAL_UART_ISR
 == 2)

178 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRódISR
(
buf
, 
Àn
);

180 #i‡(
HAL_UART_SPI
 == 1)

181 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRódSPI
(
buf
, 
Àn
);

183 #i‡(
HAL_UART_SPI
 == 2)

184 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRódSPI
(
buf
, 
Àn
);

187 #i‡
HAL_UART_USB


188  
	`HÆUARTRx
(
buf
, 
Àn
);

190 #i‡(
HAL_UART_DMA
 =0Ë&& (
HAL_UART_ISR
 =0Ë&& (
HAL_UART_SPI
 == 0)

192 (Ë
p‹t
;

193 (Ë
buf
;

194 (Ë
Àn
;

198 
	}
}

211 
uöt16
 
	$HÆUARTWrôe
(
uöt8
 
p‹t
, uöt8 *
buf
, 
uöt16
 
Àn
)

213 #i‡(
HAL_UART_DMA
 == 1)

214 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTWrôeDMA
(
buf
, 
Àn
);

216 #i‡(
HAL_UART_DMA
 == 2)

217 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTWrôeDMA
(
buf
, 
Àn
);

219 #i‡(
HAL_UART_ISR
 == 1)

220 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTWrôeISR
(
buf
, 
Àn
);

222 #i‡(
HAL_UART_ISR
 == 2)

223 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTWrôeISR
(
buf
, 
Àn
);

225 #i‡(
HAL_UART_SPI
 == 1)

226 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTWrôeSPI
(
buf
, 
Àn
);

228 #i‡(
HAL_UART_SPI
 == 2)

229 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTWrôeSPI
(
buf
, 
Àn
);

232 #i‡
HAL_UART_USB


233 
	`HÆUARTTx
(
buf
, 
Àn
);

234  
Àn
;

236 #i‡(
HAL_UART_DMA
 =0Ë&& (
HAL_UART_ISR
 =0Ë&& (
HAL_UART_SPI
 == 0)

238 (Ë
p‹t
;

239 (Ë
buf
;

240 (Ë
Àn
;

244 
	}
}

255 
	$HÆUARTSu•íd
( )

257 #i‡
HAL_UART_ISR


258 
	`HÆUARTSu•ídISR
();

260 
	}
}

271 
	$HÆUARTResume
( )

273 #i‡
HAL_UART_ISR


274 
	`HÆUARTResumeISR
();

276 
	}
}

287 
	$HÆUARTPﬁl
()

289 #i‡(
HAL_UART_DMA
 && 
HAL_UART_SPI
)

290 i‡(
HAL_UART_PORT
)

292 
	`HÆUARTPﬁlSPI
();

296 
	`HÆUARTPﬁlDMA
();

299 #i‡
HAL_UART_DMA


300 
	`HÆUARTPﬁlDMA
();

302 #i‡
HAL_UART_ISR


303 
	`HÆUARTPﬁlISR
();

305 #i‡
HAL_UART_SPI


306 
	`HÆUARTPﬁlSPI
();

308 #i‡
HAL_UART_USB


309 
	`HÆUARTPﬁlUSB
();

312 
	}
}

323 
uöt16
 
	$HÆ_UART_RxBufLí
–
uöt8
 
p‹t
 )

325 #i‡(
HAL_UART_DMA
 == 1)

326 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRxAvaûDMA
();

328 #i‡(
HAL_UART_DMA
 == 2)

329 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRxAvaûDMA
();

331 #i‡(
HAL_UART_ISR
 == 1)

332 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRxAvaûISR
();

334 #i‡(
HAL_UART_ISR
 == 2)

335 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRxAvaûISR
();

337 #i‡(
HAL_UART_SPI
 == 1)

338 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRxAvaûSPI
();

340 #i‡(
HAL_UART_SPI
 == 2)

341 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRxAvaûSPI
();

344 #i‡
HAL_UART_USB


345  
	`HÆUARTRxAvaûUSB
();

347 #i‡(
HAL_UART_DMA
 =0Ë&& (
HAL_UART_ISR
 =0Ë&& (
HAL_UART_SPI
 == 0)

349 (Ë
p‹t
;

353 
	}
}

355 
	$HÆUARTI§DMA
()

357 #i‡(
HAL_UART_DMA
 && 
HAL_UART_SPI
)

358 i‡(
HAL_UART_PORT
)

360 
	`HÆUART_DMAI§SPI
();

364 
	`HÆUART_DMAI§DMA
();

366 #ñi‡
HAL_UART_DMA


367 
	`HÆUART_DMAI§DMA
();

368 #ñi‡
HAL_UART_SPI


369 
	`HÆUART_DMAI§SPI
();

371 
	}
}

	@Components/hal/target/CC2540USB/_hal_uart_dma.c

50 
	~<°rög.h
>

52 
	~"hÆ_as£π.h
"

53 
	~"hÆ_bﬂrd.h
"

54 
	~"hÆ_defs.h
"

55 
	~"hÆ_dma.h
"

56 
	~"hÆ_mcu.h
"

57 
	~"hÆ_ty≥s.h
"

58 
	~"hÆ_u¨t.h
"

66 
	#CSR_MODE
 0x80

	)

67 
	#CSR_RE
 0x40

	)

68 
	#CSR_SLAVE
 0x20

	)

69 
	#CSR_FE
 0x10

	)

70 
	#CSR_ERR
 0x08

	)

71 
	#CSR_RX_BYTE
 0x04

	)

72 
	#CSR_TX_BYTE
 0x02

	)

73 
	#CSR_ACTIVE
 0x01

	)

76 
	#UCR_FLUSH
 0x80

	)

77 
	#UCR_FLOW
 0x40

	)

78 
	#UCR_D9
 0x20

	)

79 
	#UCR_BIT9
 0x10

	)

80 
	#UCR_PARITY
 0x08

	)

81 
	#UCR_SPB
 0x04

	)

82 
	#UCR_STOP
 0x02

	)

83 
	#UCR_START
 0x01

	)

85 
	#UTX0IE
 0x04

	)

86 
	#UTX1IE
 0x08

	)

88 
	#P2DIR_PRIPO
 0xC0

	)

90 
	#HAL_DMA_U0DBUF
 0x70C1

	)

91 
	#HAL_DMA_U1DBUF
 0x70F9

	)

93 #unde‡
UxCSR


94 #unde‡
UxUCR


95 #unde‡
UxDBUF


96 #unde‡
UxBAUD


97 #unde‡
UxGCR


98 #unde‡
UTXxIE


99 #unde‡
UTXxIF


100 #i‡ (
HAL_UART_DMA
 == 1)

101 
	#UxCSR
 
U0CSR


	)

102 
	#UxUCR
 
U0UCR


	)

103 
	#UxDBUF
 
U0DBUF


	)

104 
	#UxBAUD
 
U0BAUD


	)

105 
	#UxGCR
 
U0GCR


	)

106 
	#UTXxIE
 
UTX0IE


	)

107 
	#UTXxIF
 
UTX0IF


	)

108 #ñi‡ (
HAL_UART_DMA
 == 2)

109 
	#UxCSR
 
U1CSR


	)

110 
	#UxUCR
 
U1UCR


	)

111 
	#UxDBUF
 
U1DBUF


	)

112 
	#UxBAUD
 
U1BAUD


	)

113 
	#UxGCR
 
U1GCR


	)

114 
	#UTXxIE
 
UTX1IE


	)

115 
	#UTXxIF
 
UTX1IF


	)

118 #unde‡
PxSEL


119 #unde‡
HAL_UART_PERCFG_BIT


120 #unde‡
HAL_UART_PRIPO


121 #unde‡
HAL_UART_Px_CTS


122 #unde‡
HAL_UART_Px_RTS


123 #unde‡
HAL_UART_Px_SEL


124 #i‡ (
HAL_UART_DMA
 == 1)

125 
	#PxSEL
 
P0SEL


	)

126 
	#HAL_UART_PERCFG_BIT
 0x01

127 
	#HAL_UART_PRIPO
 0x00

128 
	#HAL_UART_Px_CTS
 0x10

129 
	#HAL_UART_Px_RTS
 0x20

130 
	#HAL_UART_Px_SEL
 0x0C

131 #ñi‡ (
HAL_UART_DMA
 =2)

	)

132 
	#PxSEL
 
P1SEL


	)

133 
	#HAL_UART_PERCFG_BIT
 0x02

134 
	#HAL_UART_PRIPO
 0x40

135 
	#HAL_UART_Px_CTS
 0x10

136 
	#HAL_UART_Px_RTS
 0x20

137 
	#HAL_UART_Px_SEL
 0xC0

139 

	)

140 #unde‡
DMA_PAD


141 #unde‡
DMA_UxDBUF


142 #unde‡
DMATRIG_RX


143 #unde‡
DMATRIG_TX


144 #i‡ (
HAL_UART_DMA
 == 1)

145 
	#DMA_PAD
 
U0BAUD


	)

146 
	#DMA_UxDBUF
 
HAL_DMA_U0DBUF


	)

147 
	#DMATRIG_RX
 
HAL_DMA_TRIG_URX0


	)

148 
	#DMATRIG_TX
 
HAL_DMA_TRIG_UTX0


	)

149 #ñi‡ (
HAL_UART_DMA
 == 2)

150 
	#DMA_PAD
 
U1BAUD


	)

151 
	#DMA_UxDBUF
 
HAL_DMA_U1DBUF


	)

152 
	#DMATRIG_RX
 
HAL_DMA_TRIG_URX1


	)

153 
	#DMATRIG_TX
 
HAL_DMA_TRIG_UTX1


	)

156 #unde‡
PxDIR


157 #unde‡
PxIEN


158 #unde‡
PxIFG


159 #unde‡
PxIF


160 #unde‡
PICTL_BIT


161 #unde‡
IENx


162 #unde‡
IEN_BIT


163 #i‡ (
HAL_UART_DMA
 == 1)

164 
	#PxDIR
 
P0DIR


	)

165 
	#PxIEN
 
P0IEN


	)

166 
	#PxIFG
 
P0IFG


	)

167 
	#PxIF
 
P0IF


	)

168 
	#DMA_RDYIn
 
P0_4


	)

169 
	#DMA_RDYOut
 
P0_5


	)

170 
	#DMA_RDYIn_BIT
 
	`BV
(4)

171 
	#DMA_RDYOut_BIT
 
	`BV
(5)

173 
	#PICTL_BIT
 
	`BV
(0)

	)

174 
	#IENx
 
IEN1


	)

175 
	#IEN_BIT
 
	`BV
(5)

	)

176 #ñi‡ (
HAL_UART_DMA
 == 2)

177 
	#PxDIR
 
P1DIR


	)

178 
	#PxIEN
 
P1IEN


	)

179 
	#PxIFG
 
P1IFG


	)

180 
	#PxIF
 
P1IF


	)

181 
	#DMA_RDYIn
 
P1_4


	)

182 
	#DMA_RDYOut
 
P1_5


	)

183 
	#DMA_RDYIn_BIT
 
	`BV
(4)

184 
	#DMA_RDYOut_BIT
 
	`BV
(5)

186 
	#PICTL_BIT
 
	`BV
(2)

	)

187 
	#IENx
 
IEN2


	)

188 
	#IEN_BIT
 
	`BV
(4)

	)

191 #i‡!
deföed
–
DMA_PM
 )

192 #i‡
deföed
 
POWER_SAVING


193 
	#DMA_PM
 1

	)

195 
	#DMA_PM
 0

	)

201 #i‡!
deföed
 
HAL_UART_TX_BY_ISR


202 
	#HAL_UART_TX_BY_ISR
 1

	)

208 #i‡!
deföed
 
HAL_UART_RX_FLUSH


209 
	#HAL_UART_RX_FLUSH
 
TRUE


	)

220 
	#DMA_PM_DLY
 0

	)

223 
	#HAL_UART_MSECS_TO_TICKS
 33

	)

225 #i‡!
deföed
 
HAL_UART_DMA_RX_MAX


226 
	#HAL_UART_DMA_RX_MAX
 128

	)

228 #i‡!
deföed
 
HAL_UART_DMA_TX_MAX


229 
	#HAL_UART_DMA_TX_MAX
 
HAL_UART_DMA_RX_MAX


	)

231 #i‡!
deföed
 
HAL_UART_DMA_HIGH


232 
	#HAL_UART_DMA_HIGH
 (
HAL_UART_DMA_RX_MAX
 - 1)

	)

234 #i‡!
deföed
 
HAL_UART_DMA_IDLE


235 
	#HAL_UART_DMA_IDLE
 (0 * 
HAL_UART_MSECS_TO_TICKS
)

	)

237 #i‡!
deföed
 
HAL_UART_DMA_FULL


238 
	#HAL_UART_DMA_FULL
 (
HAL_UART_DMA_RX_MAX
 - 16)

	)

242 
	#HAL_UART_TX_TICK_MIN
 11

	)

249 #i‡
HAL_UART_DMA_RX_MAX
 <= 256

250 
uöt8
 
	trxIdx_t
;

252 
uöt16
 
	trxIdx_t
;

255 #i‡
HAL_UART_DMA_TX_MAX
 <= 256

256 
uöt8
 
	ttxIdx_t
;

258 
uöt16
 
	ttxIdx_t
;

263 
uöt16
 
	mrxBuf
[
HAL_UART_DMA_RX_MAX
];

264 
rxIdx_t
 
	mrxHód
;

265 
rxIdx_t
 
	mrxTaû
;

266 #i‡
HAL_UART_DMA_IDLE


267 
uöt8
 
	mrxTick
;

270 #i‡
HAL_UART_TX_BY_ISR


271 
uöt8
 
	mtxBuf
[
HAL_UART_DMA_TX_MAX
];

272 vﬁ©ûê
txIdx_t
 
	mtxHód
;

273 
txIdx_t
 
	mtxTaû
;

274 
uöt8
 
	mtxMT
;

276 
uöt8
 
	mtxBuf
[2][
HAL_UART_DMA_TX_MAX
];

277 
txIdx_t
 
	mtxIdx
[2];

278 
uöt8
 
	mtxMT
;

279 
uöt8
 
	mtxTick
;

280 
uöt8
 
	mtxTrig
;

284 vﬁ©ûê
uöt8
 
	mtxSñ
;

287 
hÆUARTCBack_t
 
	mu¨tCB
;

288 } 
	tu¨tDMACfg_t
;

295 
	#HAL_UART_DMA_NEW_RX_BYTE
(
IDX
Ë((
uöt8
)
DMA_PAD
 =
	`HI_UINT16
(
dmaCfg
.
rxBuf
[(IDX)]))

	)

296 
	#HAL_UART_DMA_GET_RX_BYTE
(
IDX
Ë(*(vﬁ©ûê
uöt8
 *)(
dmaCfg
.
rxBuf
+(IDX)))

	)

297 
	#HAL_UART_DMA_CLR_RX_BYTE
(
IDX
Ë(
dmaCfg
.
rxBuf
[(IDX)] = 
	`BUILD_UINT16
(0, (
DMA_PAD
 ^ 0xFF)))

	)

299 
	#HAL_UART_DMA_CLR_RDY_OUT
(Ë(
DMA_RDYOut
 = 1)

	)

300 
	#HAL_UART_DMA_SET_RDY_OUT
(Ë(
DMA_RDYOut
 = 0)

	)

302 
	#HAL_UART_DMA_RDY_IN
(Ë(
DMA_RDYIn
 =0)

	)

303 
	#HAL_UART_DMA_RDY_OUT
(Ë(
DMA_RDYOut
 =0)

	)

305 #i‡
HAL_UART_DMA_RX_MAX
 == 256

306 
	#HAL_UART_RX_IDX_T_DECR
(
IDX
Ë(IDX)--

	)

308 
	#HAL_UART_RX_IDX_T_DECR
(
IDX
Ë
	`°
 ( \

309 i‡((
IDX
)-- == 0) \

311 (
IDX
Ë
HAL_UART_DMA_RX_MAX
-1; \

313 )

	)

316 #i‡
HAL_UART_DMA_RX_MAX
 == 256

317 
	#HAL_UART_RX_IDX_T_INCR
(
IDX
Ë(IDX)++

	)

319 
	#HAL_UART_RX_IDX_T_INCR
(
IDX
Ë
	`°
 ( \

320 i‡(++(
IDX
Ë>
HAL_UART_DMA_RX_MAX
) \

322 (
IDX
) = 0; \

324 )

	)

327 
	#HAL_UART_DMA_TX_AVAIL
() \

328 (
dmaCfg
.
txHód
 > dmaCfg.
txTaû
) ? \

329 (
dmaCfg
.
txHód
 - dmaCfg.
txTaû
 - 1) : \

330 (
HAL_UART_DMA_TX_MAX
 - 
dmaCfg
.
txTaû
 + dmaCfg.
txHód
 - 1)

	)

338 vﬁ©ûê
uöt8
 
	gdmaRdyI§
;

339 
uöt8
 
	gdmaRdyDly
;

341 
u¨tDMACfg_t
 
	gdmaCfg
;

349 
rxIdx_t
 
	gu¨tRxBug
;

356 
HÆUART_DMAI§DMA
();

364 
HÆUARTInôDMA
();

365 
HÆUARTO≥nDMA
(
hÆUARTCfg_t
 *
c⁄fig
);

366 
uöt16
 
HÆUARTRódDMA
(
uöt8
 *
buf
, uöt16 
Àn
);

367 
uöt16
 
HÆUARTWrôeDMA
(
uöt8
 *
buf
, uöt16 
Àn
);

368 
HÆUARTPﬁlDMA
();

369 
uöt16
 
HÆUARTRxAvaûDMA
();

370 
uöt8
 
HÆUARTBusyDMA
();

371 #i‡!
HAL_UART_TX_BY_ISR


372 
HÆUARTPﬁlTxTrigDMA
();

373 
HÆUARTArmTxDMA
();

385 
	$HÆUARTInôDMA
()

387 
hÆDMADesc_t
 *
ch
;

388 #i‡(
HAL_UART_DMA
 == 1)

389 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

391 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

393 
PxSEL
 |
HAL_UART_Px_SEL
;

394 
UxCSR
 = 
CSR_MODE
;

395 
UxUCR
 = 
UCR_FLUSH
;

397 
P2DIR
 &~
P2DIR_PRIPO
;

398 
P2DIR
 |
HAL_UART_PRIPO
;

400 i‡(
DMA_PM
)

403 
PxIEN
 |
DMA_RDYIn_BIT
;

404 
PICTL
 |
PICTL_BIT
;

406 
	`HAL_UART_DMA_CLR_RDY_OUT
();

407 
PxDIR
 |
DMA_RDYOut_BIT
;

410 #i‡!
HAL_UART_TX_BY_ISR


412 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_CH_TX
 );

415 
	`HAL_DMA_ABORT_CH
–
HAL_DMA_CH_TX
 );

418 
	`HAL_DMA_SET_DEST
–
ch
, 
DMA_UxDBUF
 );

421 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

424 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

427 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

428 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
DMATRIG_TX
 );

431 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_1
 );

434 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_0
 );

437 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_ENABLE
 );

440 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

443 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
);

447 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_CH_RX
 );

450 
	`HAL_DMA_ABORT_CH
–
HAL_DMA_CH_RX
 );

453 
	`HAL_DMA_SET_SOURCE
–
ch
, 
DMA_UxDBUF
 );

456 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

465 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_WORD
 );

468 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE_REPEATED
 );

469 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
DMATRIG_RX
 );

472 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_0
 );

475 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_1
 );

476 
	`HAL_DMA_SET_DEST
–
ch
, 
dmaCfg
.
rxBuf
 );

477 
	`HAL_DMA_SET_LEN
–
ch
, 
HAL_UART_DMA_RX_MAX
 );

480 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

483 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

486 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
);

488 vﬁ©ûê
uöt8
 
dummy
 = *(vﬁ©ûêuöt8 *)
DMA_UxDBUF
;

489 
	`HAL_DMA_CLEAR_IRQ
(
HAL_DMA_CH_RX
);

490 
	`HAL_DMA_ARM_CH
(
HAL_DMA_CH_RX
);

491 ()
	`mem£t
(
dmaCfg
.
rxBuf
, (
DMA_PAD
 ^ 0xFF), 
HAL_UART_DMA_RX_MAX
*2);

492 
	}
}

503 
	$HÆUARTO≥nDMA
(
hÆUARTCfg_t
 *
c⁄fig
)

505 
dmaCfg
.
u¨tCB
 = 
c⁄fig
->
ˇŒBackFunc
;

508 
	`HAL_ASSERT
((
c⁄fig
->
baudR©e
 =
HAL_UART_BR_9600
) ||

509 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_19200
) ||

510 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_38400
) ||

511 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
) ||

512 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
));

514 i‡(
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
 ||

515 
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
)

517 
UxBAUD
 = 216;

521 
UxBAUD
 = 59;

524 
c⁄fig
->
baudR©e
)

526 
HAL_UART_BR_9600
:

527 
UxGCR
 = 8;

529 
HAL_UART_BR_19200
:

530 
UxGCR
 = 9;

532 
HAL_UART_BR_38400
:

533 
HAL_UART_BR_57600
:

534 
UxGCR
 = 10;

538 
UxGCR
 = 11;

542 i‡(
DMA_PM
 || 
c⁄fig
->
ÊowC⁄åﬁ
)

544 
UxUCR
 = 
UCR_FLOW
 | 
UCR_STOP
;

545 
PxSEL
 |
HAL_UART_Px_CTS
;

549 
UxUCR
 = 
UCR_STOP
;

552 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

554 i‡(
DMA_PM
)

556 
PxIFG
 = 0;

557 
PxIF
 = 0;

558 
IENx
 |
IEN_BIT
;

560 i‡(
UxUCR
 & 
UCR_FLOW
)

564 
	`HAL_UART_DMA_SET_RDY_OUT
();

565 
PxDIR
 |
HAL_UART_Px_RTS
;

568 #i‡
HAL_UART_TX_BY_ISR


569 
UTXxIF
 = 1;

571 
	}
}

583 
uöt16
 
	$HÆUARTRódDMA
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

585 
uöt16
 
˙t
;

587 
˙t
 = 0; c¡ < 
Àn
; cnt++)

589 i‡(!
	`HAL_UART_DMA_NEW_RX_BYTE
(
dmaCfg
.
rxHód
))

593 *
buf
++ = 
	`HAL_UART_DMA_GET_RX_BYTE
(
dmaCfg
.
rxHód
);

594 
	`HAL_UART_DMA_CLR_RX_BYTE
(
dmaCfg
.
rxHód
);

595 
	`HAL_UART_RX_IDX_T_INCR
(
dmaCfg
.
rxHód
);

598 i‡(!
DMA_PM
 && (
UxUCR
 & 
UCR_FLOW
))

600 i‡(
	`HÆUARTRxAvaûDMA
(Ë< 
HAL_UART_DMA_HIGH
)

602 
	`HAL_UART_DMA_SET_RDY_OUT
();

606  
˙t
;

607 
	}
}

620 
uöt16
 
	$HÆUARTWrôeDMA
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

622 #i‡
HAL_UART_TX_BY_ISR


624 i‡(
	`HAL_UART_DMA_TX_AVAIL
(Ë< 
Àn
)

629 
uöt16
 
˙t
 = 0; c¡ < 
Àn
; cnt++)

631 
dmaCfg
.
txBuf
[dmaCfg.
txTaû
] = *
buf
++;

632 
dmaCfg
.
txMT
 = 0;

634 i‡(
dmaCfg
.
txTaû
 >
HAL_UART_DMA_TX_MAX
-1)

636 
dmaCfg
.
txTaû
 = 0;

640 
dmaCfg
.
txTaû
++;

644 
IEN2
 |
UTXxIE
;

647 
txIdx_t
 
txIdx
;

648 
uöt8
 
txSñ
;

649 
hÆI¡Sèã_t
 
his
;

651 
	`HAL_ENTER_CRITICAL_SECTION
(
his
);

652 
txSñ
 = 
dmaCfg
.txSel;

653 
txIdx
 = 
dmaCfg
.txIdx[
txSñ
];

654 
	`HAL_EXIT_CRITICAL_SECTION
(
his
);

657 i‡((
Àn
 + 
txIdx
Ë> 
HAL_UART_DMA_TX_MAX
)

662 ()
	`mem˝y
(&(
dmaCfg
.
txBuf
[
txSñ
][
txIdx
]), 
buf
, 
Àn
);

664 
	`HAL_ENTER_CRITICAL_SECTION
(
his
);

669 i‡(
txSñ
 !
dmaCfg
.txSel)

671 
	`HAL_EXIT_CRITICAL_SECTION
(
his
);

672 
txSñ
 ^= 1;

674 ()
	`mem˝y
(&(
dmaCfg
.
txBuf
[
txSñ
][0]), 
buf
, 
Àn
);

675 
	`HAL_ENTER_CRITICAL_SECTION
(
his
);

676 
dmaCfg
.
txIdx
[
txSñ
] = 
Àn
;

680 
dmaCfg
.
txIdx
[
txSñ
] =ÅxIdx + 
Àn
;

684 i‡(
dmaCfg
.
txIdx
[(
txSñ
 ^ 1)] == 0)

686 
	`HAL_EXIT_CRITICAL_SECTION
(
his
);

687 
	`HÆUARTArmTxDMA
();

691 
dmaCfg
.
txMT
 = 
FALSE
;

692 
	`HAL_EXIT_CRITICAL_SECTION
(
his
);

696  
Àn
;

697 
	}
}

709 
	$HÆUARTPﬁlDMA
()

711 
uöt8
 
evt
 = 0;

712 
uöt16
 
˙t
;

714 #i‡
DMA_PM


715 
PxIEN
 &~
DMA_RDYIn_BIT
;

717 i‡(
dmaRdyI§
 || 
	`HAL_UART_DMA_RDY_IN
(Ë|| 
	`HÆUARTBusyDMA
())

720 #i‡
HAL_UART_TX_BY_ISR


721 i‡(!
	`HAL_UART_DMA_RDY_IN
(Ë&& (
dmaCfg
.
txHód
 !dmaCfg.
txTaû
))

723 i‡(!
	`HAL_UART_DMA_RDY_IN
(Ë&& ((
dmaCfg
.
txIdx
[0] != 0) || (dmaCfg.txIdx[1] != 0)))

726 
	`HAL_UART_DMA_CLR_RDY_OUT
();

728 
dmaRdyI§
 = 0;

730 i‡(
dmaRdyDly
 == 0)

732 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_HOLD_EVENT
);

735 i‡((
dmaRdyDly
 = 
ST0
) == 0)

737 
dmaRdyDly
 = 0xFF;

739 
	`HAL_UART_DMA_SET_RDY_OUT
();

741 i‡((
dmaRdyDly
 !0Ë&& (!
DMA_PM_DLY
 || ((
uöt8
)(
ST0
 - dmaRdyDly) > DMA_PM_DLY)))

743 
dmaRdyDly
 = 0;

744 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_CONSERVE_EVENT
);

747 
PxIEN
 |
DMA_RDYIn_BIT
;

750 #i‡!
HAL_UART_TX_BY_ISR


751 
	`HÆUARTPﬁlTxTrigDMA
();

754 i‡(!
	`HAL_UART_DMA_NEW_RX_BYTE
(
dmaCfg
.
rxHód
))

756 i‡(
	`HAL_UART_DMA_NEW_RX_BYTE
(
u¨tRxBug
))

759 
	`HAL_UART_RX_IDX_T_INCR
(
dmaCfg
.
rxHód
);

760 } !
	`HAL_UART_DMA_NEW_RX_BYTE
(
dmaCfg
.
rxHód
));

762 
u¨tRxBug
 = 
dmaCfg
.
rxHód
;

763 
dmaCfg
.
rxTaû
 = dmaCfg.
rxHód
;

765 
	`HAL_UART_RX_IDX_T_INCR
(
u¨tRxBug
);

768 
˙t
 = 
	`HÆUARTRxAvaûDMA
();

770 #i‡
HAL_UART_DMA_IDLE


771 i‡(
dmaCfg
.
rxTick
)

774 i‡((
ST0
 - 
dmaCfg
.
rxTick
Ë> 
HAL_UART_DMA_IDLE
)

776 
dmaCfg
.
rxTick
 = 0;

777 
evt
 = 
HAL_UART_RX_TIMEOUT
;

780 i‡(
˙t
 != 0)

782 i‡((
dmaCfg
.
rxTick
 = 
ST0
) == 0)

784 
dmaCfg
.
rxTick
 = 0xFF;

788 i‡(
˙t
 != 0)

790 
evt
 = 
HAL_UART_RX_TIMEOUT
;

794 i‡(
˙t
 >
HAL_UART_DMA_FULL
)

796 
evt
 |
HAL_UART_RX_FULL
;

798 i‡(
˙t
 >
HAL_UART_DMA_HIGH
)

800 
evt
 |
HAL_UART_RX_ABOUT_FULL
;

802 i‡(!
DMA_PM
 && (
UxUCR
 & 
UCR_FLOW
))

804 
	`HAL_UART_DMA_CLR_RDY_OUT
();

808 i‡(
dmaCfg
.
txMT
)

810 
dmaCfg
.
txMT
 = 
FALSE
;

811 
evt
 |
HAL_UART_TX_EMPTY
;

814 i‡((
evt
 !0Ë&& (
dmaCfg
.
u¨tCB
 !
NULL
))

816 
dmaCfg
.
	`u¨tCB
(
HAL_UART_DMA
-1, 
evt
);

819 i‡(
DMA_PM
 && (
dmaRdyDly
 =0Ë&& !
	`HÆUARTBusyDMA
())

821 
	`HAL_UART_DMA_CLR_RDY_OUT
();

823 
	}
}

834 
uöt16
 
	$HÆUARTRxAvaûDMA
()

837 
rxIdx_t
 
èû
 = 
dmaCfg
.
rxTaû
;

841 i‡(!
	`HAL_UART_DMA_NEW_RX_BYTE
(
èû
))

846 
	`HAL_UART_RX_IDX_T_INCR
(
èû
);

847 } 
èû
 !
dmaCfg
.
rxHód
);

849 
dmaCfg
.
rxTaû
 = 
èû
;

851 
uöt16
 
˙t
 = 
èû
 - 
dmaCfg
.
rxHód
;

854 i‡((
˙t
 =0Ë&& 
	`HAL_UART_DMA_NEW_RX_BYTE
(
èû
))

859 
èû
 = 
dmaCfg
.
rxHód
;

860 
	`HAL_UART_RX_IDX_T_DECR
(
èû
);

862 i‡(
	`HAL_UART_DMA_NEW_RX_BYTE
(
èû
))

864 i‡(
HAL_UART_RX_FLUSH
)

866 ()
	`mem£t
(
dmaCfg
.
rxBuf
, (
DMA_PAD
 ^ 0xFF), 
HAL_UART_DMA_RX_MAX
*2);

868 
u¨tRxBug
 = 
dmaCfg
.
rxHód
;

869 
dmaCfg
.
rxTaû
 = dmaCfg.
rxHód
;

873 
˙t
 = 
HAL_UART_DMA_RX_MAX
;

878 
˙t
 = 1;

881 i‡(
˙t
 > 
HAL_UART_DMA_RX_MAX
)

883 
˙t
 +
HAL_UART_DMA_RX_MAX
;

886  
˙t
;

887 
	}
}

898 
uöt8
 
	$HÆUARTBusyDMA
( )

900 #i‡
HAL_UART_TX_BY_ISR


901  !((!(
UxCSR
 & (
CSR_ACTIVE
 | 
CSR_RX_BYTE
))Ë&& (
	`HÆUARTRxAvaûDMA
() == 0) &&

902 (
dmaCfg
.
txHód
 =dmaCfg.
txTaû
));

904  !((!(
UxCSR
 & (
CSR_ACTIVE
 | 
CSR_RX_BYTE
))Ë&& (
	`HÆUARTRxAvaûDMA
() == 0) &&

905 (
dmaCfg
.
txIdx
[0] == 0) && (dmaCfg.txIdx[1] == 0));

907 
	}
}

909 #i‡!
HAL_UART_TX_BY_ISR


919 
	$HÆUARTPﬁlTxTrigDMA
()

921 i‡((
UxCSR
 & 
CSR_TX_BYTE
) == 0)

923 i‡((
dmaCfg
.
txTick
 =0Ë|| ((
uöt8
)(
ST0
 - dmaCfg.txTickË> 
HAL_UART_TX_TICK_MIN
))

925 
dmaCfg
.
txTick
 = 0;

927 i‡(
dmaCfg
.
txTrig
 && 
	`HAL_DMA_CH_ARMED
(
HAL_DMA_CH_TX
))

929 
	`HAL_DMA_MAN_TRIGGER
(
HAL_DMA_CH_TX
);

931 
dmaCfg
.
txTrig
 = 0;

936 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

937 
dmaCfg
.
txTick
 = 
ST0
;

939 i‡(
dmaCfg
.
txTick
 == 0)

941 
dmaCfg
.
txTick
 = 0xFF;

944 
	}
}

955 
	$HÆUARTArmTxDMA
()

957 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
(
HAL_DMA_CH_TX
);

958 
	`HAL_DMA_SET_SOURCE
(
ch
, 
dmaCfg
.
txBuf
[dmaCfg.
txSñ
]);

959 
	`HAL_DMA_SET_LEN
(
ch
, 
dmaCfg
.
txIdx
[dmaCfg.
txSñ
]);

961 
dmaCfg
.
txSñ
 ^= 1;

962 
dmaCfg
.
txTrig
 = 1;

963 
	`HAL_DMA_ARM_CH
(
HAL_DMA_CH_TX
);

965 
	`HÆUARTPﬁlTxTrigDMA
();

967 i‡(
DMA_PM
)

969 
	`HAL_UART_DMA_SET_RDY_OUT
();

971 
	}
}

983 
	$HÆUART_DMAI§DMA
()

985 #i‡!
HAL_UART_TX_BY_ISR


986 i‡(
dmaCfg
.
txIdx
[dmaCfg.
txSñ
])

989 
	`HÆUARTArmTxDMA
();

992 
dmaCfg
.
txIdx
[dmaCfg.
txSñ
] = 0;

996 
dmaCfg
.
txIdx
[(dmaCfg.
txSñ
 ^ 1)] = 0;

1000 
	`HÆUARTPﬁlTxTrigDMA
();

1003 
dmaCfg
.
txMT
 = 
TRUE
;

1005 
	}
}

1007 #i‡
DMA_PM


1017 #i‡(
HAL_UART_DMA
 == 1)

1018 
	$HAL_ISR_FUNCTION
(
p‹t0I§
, 
P0INT_VECTOR
)

1020 
	$HAL_ISR_FUNCTION
(
p‹t1I§
, 
P1INT_VECTOR
)

1023 
	`HAL_ENTER_ISR
();

1025 
PxIFG
 = 0;

1026 
PxIF
 = 0;

1028 
dmaRdyI§
 = 1;

1030 
	`CLEAR_SLEEP_MODE
();

1031 
	`HAL_EXIT_ISR
();

1032 
	}
}

1035 #i‡
HAL_UART_TX_BY_ISR


1045 #i‡(
HAL_UART_DMA
 == 1)

1046 
	$HAL_ISR_FUNCTION
–
hÆU¨t0TxI§
, 
UTX0_VECTOR
 )

1048 
	$HAL_ISR_FUNCTION
–
hÆU¨t1TxI§
, 
UTX1_VECTOR
 )

1051 
	`HAL_ENTER_ISR
();

1053 i‡(
dmaCfg
.
txHód
 =dmaCfg.
txTaû
)

1055 
IEN2
 &~
UTXxIE
;

1056 
dmaCfg
.
txMT
 = 1;

1060 
UTXxIF
 = 0;

1061 
UxDBUF
 = 
dmaCfg
.
txBuf
[dmaCfg.
txHód
++];

1063 i‡((
HAL_UART_DMA_TX_MAX
 !256Ë&& (
dmaCfg
.
txHód
 >= HAL_UART_DMA_TX_MAX))

1065 
dmaCfg
.
txHód
 = 0;

1069 
	`HAL_EXIT_ISR
();

1070 
	}
}

	@Components/hal/target/CC2540USB/_hal_uart_isr.c

47 
	~"hÆ_ty≥s.h
"

48 
	~"hÆ_as£π.h
"

49 
	~"hÆ_bﬂrd.h
"

50 
	~"hÆ_defs.h
"

51 
	~"hÆ_mcu.h
"

52 
	~"hÆ_u¨t.h
"

59 
	#HAL_UART_ASSERT
(
ex¥
)

	)

61 
	#HAL_UART_ISR_RX_AVAIL
() \

62 (
i§Cfg
.
rxTaû
 >i§Cfg.
rxHód
) ? \

63 (
i§Cfg
.
rxTaû
 - i§Cfg.
rxHód
) : \

64 (
HAL_UART_ISR_RX_MAX
 - 
i§Cfg
.
rxHód
 + i§Cfg.
rxTaû
)

	)

66 
	#HAL_UART_ISR_TX_AVAIL
() \

67 (
i§Cfg
.
txHód
 > i§Cfg.
txTaû
) ? \

68 (
i§Cfg
.
txHód
 - i§Cfg.
txTaû
 - 1) : \

69 (
HAL_UART_ISR_TX_MAX
 - 
i§Cfg
.
txTaû
 + i§Cfg.
txHód
 - 1)

	)

76 
	#CSR_MODE
 0x80

	)

77 
	#CSR_RE
 0x40

	)

78 
	#CSR_SLAVE
 0x20

	)

79 
	#CSR_FE
 0x10

	)

80 
	#CSR_ERR
 0x08

	)

81 
	#CSR_RX_BYTE
 0x04

	)

82 
	#CSR_TX_BYTE
 0x02

	)

83 
	#CSR_ACTIVE
 0x01

	)

86 
	#UCR_FLUSH
 0x80

	)

87 
	#UCR_FLOW
 0x40

	)

88 
	#UCR_D9
 0x20

	)

89 
	#UCR_BIT9
 0x10

	)

90 
	#UCR_PARITY
 0x08

	)

91 
	#UCR_SPB
 0x04

	)

92 
	#UCR_STOP
 0x02

	)

93 
	#UCR_START
 0x01

	)

95 
	#UTX0IE
 0x04

	)

96 
	#UTX1IE
 0x08

	)

98 
	#P2DIR_PRIPO
 0xC0

	)

101 #unde‡
PxOUT


102 #unde‡
PxDIR


103 #unde‡
PxSEL


104 #unde‡
UxCSR


105 #unde‡
UxUCR


106 #unde‡
UxDBUF


107 #unde‡
UxBAUD


108 #unde‡
UxGCR


109 #unde‡
URXxIE


110 #unde‡
URXxIF


111 #unde‡
UTXxIE


112 #unde‡
UTXxIF


113 #unde‡
HAL_UART_PERCFG_BIT


114 #unde‡
HAL_UART_Px_RTS


115 #unde‡
HAL_UART_Px_CTS


116 #unde‡
HAL_UART_Px_RX_TX


117 #unde‡
HAL_UART_Px_RX


118 #unde‡
PxIFG


119 #unde‡
PxIF


120 #unde‡
PxIEN


121 #unde‡
PICTL_BIT


122 #unde‡
IENx


123 #unde‡
IEN_BIT


124 #i‡(
HAL_UART_ISR
 == 1)

125 
	#PxOUT
 
P0


	)

126 
	#PxIN
 
P0


	)

127 
	#PxDIR
 
P0DIR


	)

128 
	#PxSEL
 
P0SEL


	)

129 
	#UxCSR
 
U0CSR


	)

130 
	#UxUCR
 
U0UCR


	)

131 
	#UxDBUF
 
U0DBUF


	)

132 
	#UxBAUD
 
U0BAUD


	)

133 
	#UxGCR
 
U0GCR


	)

134 
	#URXxIE
 
URX0IE


	)

135 
	#URXxIF
 
URX0IF


	)

136 
	#UTXxIE
 
UTX0IE


	)

137 
	#UTXxIF
 
UTX0IF


	)

139 
	#PxIFG
 
P0IFG


	)

140 
	#PxIF
 
P0IF


	)

141 
	#PxIEN
 
P0IEN


	)

142 
	#PICTL_BIT
 0x01

	)

143 
	#IENx
 
IEN1


	)

144 
	#IEN_BIT
 0x20

	)

147 
	#PxOUT
 
P1


	)

148 
	#PxIN
 
P1


	)

149 
	#PxDIR
 
P1DIR


	)

150 
	#PxSEL
 
P1SEL


	)

151 
	#UxCSR
 
U1CSR


	)

152 
	#UxUCR
 
U1UCR


	)

153 
	#UxDBUF
 
U1DBUF


	)

154 
	#UxBAUD
 
U1BAUD


	)

155 
	#UxGCR
 
U1GCR


	)

156 
	#URXxIE
 
URX1IE


	)

157 
	#URXxIF
 
URX1IF


	)

158 
	#UTXxIE
 
UTX1IE


	)

159 
	#UTXxIF
 
UTX1IF


	)

161 
	#PxIFG
 
P1IFG


	)

162 
	#PxIF
 
P1IF


	)

163 
	#PxIEN
 
P1IEN


	)

164 
	#PICTL_BIT
 0x04

	)

165 
	#IENx
 
IEN2


	)

166 
	#IEN_BIT
 0x10

	)

169 #i‡(
HAL_UART_ISR
 == 1)

170 
	#HAL_UART_PERCFG_BIT
 0x01

171 
	#HAL_UART_Px_RX_TX
 0x0C

172 
	#HAL_UART_Px_RX
 0x04

173 
	#HAL_UART_Px_RTS
 0x20

174 
	#HAL_UART_Px_CTS
 0x10

175 #ñ£

	)

176 
	#HAL_UART_PERCFG_BIT
 0x02

177 
	#HAL_UART_Px_RTS
 0x20

178 
	#HAL_UART_Px_CTS
 0x10

179 
	#HAL_UART_Px_RX_TX
 0xC0

180 
	#HAL_UART_Px_RX
 0x80

182 

	)

184 
	#HAL_UART_MSECS_TO_TICKS
 33

	)

186 #i‡!
deföed
 
HAL_UART_ISR_RX_MAX


187 
	#HAL_UART_ISR_RX_MAX
 128

	)

189 #i‡!
deföed
 
HAL_UART_ISR_TX_MAX


190 
	#HAL_UART_ISR_TX_MAX
 
HAL_UART_ISR_RX_MAX


	)

192 #i‡!
deföed
 
HAL_UART_ISR_HIGH


193 
	#HAL_UART_ISR_HIGH
 (
HAL_UART_ISR_RX_MAX
 / 2 - 16)

	)

195 #i‡!
deföed
 
HAL_UART_ISR_IDLE


196 
	#HAL_UART_ISR_IDLE
 (0 * 
HAL_UART_MSECS_TO_TICKS
)

	)

203 #i‡
HAL_UART_ISR_RX_MAX
 <= 256

204 
uöt8
 
	trxIdx_t
;

206 
uöt16
 
	trxIdx_t
;

209 #i‡
HAL_UART_ISR_TX_MAX
 <= 256

210 
uöt8
 
	ttxIdx_t
;

212 
uöt16
 
	ttxIdx_t
;

217 
uöt8
 
	mrxBuf
[
HAL_UART_ISR_RX_MAX
];

218 
rxIdx_t
 
	mrxHód
;

219 vﬁ©ûê
rxIdx_t
 
	mrxTaû
;

220 
uöt8
 
	mrxTick
;

221 
uöt8
 
	mrxShdw
;

223 
uöt8
 
	mtxBuf
[
HAL_UART_ISR_TX_MAX
];

224 vﬁ©ûê
txIdx_t
 
	mtxHód
;

225 
txIdx_t
 
	mtxTaû
;

226 
uöt8
 
	mtxMT
;

228 
hÆUARTCBack_t
 
	mu¨tCB
;

229 } 
	tu¨tISRCfg_t
;

235 
u¨tISRCfg_t
 
	gi§Cfg
;

241 
HÆUARTInôISR
();

242 
HÆUARTO≥nISR
(
hÆUARTCfg_t
 *
c⁄fig
);

243 
uöt16
 
HÆUARTRódISR
(
uöt8
 *
buf
, uöt16 
Àn
);

244 
uöt16
 
HÆUARTWrôeISR
(
uöt8
 *
buf
, uöt16 
Àn
);

245 
HÆUARTPﬁlISR
();

246 
uöt16
 
HÆUARTRxAvaûISR
();

247 
uöt8
 
HÆUARTBusyISR
();

248 
HÆUARTSu•ídISR
();

249 
HÆUARTResumeISR
();

260 
	$HÆUARTInôISR
()

263 
P2DIR
 &~
P2DIR_PRIPO
;

264 
P2DIR
 |
HAL_UART_PRIPO
;

266 #i‡(
HAL_UART_ISR
 == 1)

267 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

269 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

271 
PxSEL
 |
HAL_UART_Px_RX_TX
;

272 
ADCCFG
 &~
HAL_UART_Px_RX_TX
;

273 
UxCSR
 = 
CSR_MODE
;

274 
UxUCR
 = 
UCR_FLUSH
;

275 
	}
}

286 
	$HÆUARTO≥nISR
(
hÆUARTCfg_t
 *
c⁄fig
)

288 
i§Cfg
.
u¨tCB
 = 
c⁄fig
->
ˇŒBackFunc
;

290 
	`HAL_UART_ASSERT
((
c⁄fig
->
baudR©e
 =
HAL_UART_BR_9600
) ||

291 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_19200
) ||

292 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_38400
) ||

293 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
) ||

294 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
));

296 i‡(
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
 ||

297 
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
)

299 
UxBAUD
 = 216;

303 
UxBAUD
 = 59;

306 
c⁄fig
->
baudR©e
)

308 
HAL_UART_BR_9600
:

309 
UxGCR
 = 8;

311 
HAL_UART_BR_19200
:

312 
UxGCR
 = 9;

314 
HAL_UART_BR_38400
:

315 
HAL_UART_BR_57600
:

316 
UxGCR
 = 10;

320 
UxGCR
 = 11;

325 i‡(
c⁄fig
->
ÊowC⁄åﬁ
)

327 
UxUCR
 = 
UCR_FLOW
 | 
UCR_STOP
;

328 
PxSEL
 |
HAL_UART_Px_RTS
 | 
HAL_UART_Px_CTS
;

329 
PxOUT
 &~
HAL_UART_Px_RTS
;

330 
PxDIR
 |
HAL_UART_Px_RTS
;

334 
UxUCR
 = 
UCR_STOP
;

337 
URXxIE
 = 1;

338 
UTXxIF
 = 1;

339 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

340 
	}
}

352 
uöt16
 
	$HÆUARTRódISR
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

354 
uöt16
 
˙t
 = 0;

356 (
i§Cfg
.
rxHód
 !i§Cfg.
rxTaû
Ë&& (
˙t
 < 
Àn
))

358 *
buf
++ = 
i§Cfg
.
rxBuf
[i§Cfg.
rxHód
++];

359 i‡(
i§Cfg
.
rxHód
 >
HAL_UART_ISR_RX_MAX
)

361 
i§Cfg
.
rxHód
 = 0;

363 
˙t
++;

366  
˙t
;

367 
	}
}

379 
uöt16
 
	$HÆUARTWrôeISR
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

381 
uöt16
 
˙t
;

384 i‡(
	`HAL_UART_ISR_TX_AVAIL
(Ë< 
Àn
)

389 
˙t
 = 0; c¡ < 
Àn
; cnt++)

391 
i§Cfg
.
txBuf
[i§Cfg.
txTaû
] = *
buf
++;

392 
i§Cfg
.
txMT
 = 0;

394 i‡(
i§Cfg
.
txTaû
 >
HAL_UART_ISR_TX_MAX
-1)

396 
i§Cfg
.
txTaû
 = 0;

400 
i§Cfg
.
txTaû
++;

404 
IEN2
 |
UTXxIE
;

407  
˙t
;

408 
	}
}

419 
	$HÆUARTPﬁlISR
()

421 
uöt16
 
˙t
 = 
	`HAL_UART_ISR_RX_AVAIL
();

422 
uöt8
 
evt
 = 0;

424 i‡(
i§Cfg
.
rxTick
)

427 
uöt8
 
de¸
 = 
ST0
 - 
i§Cfg
.
rxShdw
;

429 i‡(
i§Cfg
.
rxTick
 > 
de¸
)

431 
i§Cfg
.
rxTick
 -
de¸
;

435 
i§Cfg
.
rxTick
 = 0;

438 
i§Cfg
.
rxShdw
 = 
ST0
;

440 i‡(
˙t
 >
HAL_UART_ISR_RX_MAX
-1)

442 
evt
 = 
HAL_UART_RX_FULL
;

444 i‡(
˙t
 >
HAL_UART_ISR_HIGH
)

446 
evt
 = 
HAL_UART_RX_ABOUT_FULL
;

448 i‡(
˙t
 && !
i§Cfg
.
rxTick
)

450 
evt
 = 
HAL_UART_RX_TIMEOUT
;

453 i‡(
i§Cfg
.
txMT
)

455 
i§Cfg
.
txMT
 = 0;

456 
evt
 |
HAL_UART_TX_EMPTY
;

459 i‡(
evt
 && (
i§Cfg
.
u¨tCB
 !
NULL
))

461 
i§Cfg
.
	`u¨tCB
(
HAL_UART_ISR
-1, 
evt
);

463 
	}
}

474 
uöt16
 
	$HÆUARTRxAvaûISR
()

476  
	`HAL_UART_ISR_RX_AVAIL
();

477 
	}
}

488 
uöt8
 
	$HÆUARTBusyISR
( )

490  ((!(
UxCSR
 & (
CSR_ACTIVE
 | 
CSR_RX_BYTE
))) &&

491 (
i§Cfg
.
rxHód
 =i§Cfg.
rxTaû
Ë&& (i§Cfg.
txHód
 =i§Cfg.
txTaû
));

492 
	}
}

503 
	$HÆUARTSu•ídISR
( )

505 #i‡
deföed
 
POWER_SAVING


506 
UxCSR
 = 
CSR_MODE
;

508 i‡(
UxUCR
 & 
UCR_FLOW
)

510 
PxOUT
 |
HAL_UART_Px_RTS
;

511 
PxIFG
 = (
HAL_UART_Px_CTS
 ^ 0xFF);

512 
PxIEN
 |
HAL_UART_Px_CTS
;

516 
PxIFG
 = (
HAL_UART_Px_RX
 ^ 0xFF);

517 
PxIEN
 |
HAL_UART_Px_RX
;

520 #i‡
deföed
 
HAL_UART_GPIO_ISR


521 
PxIF
 = 0;

522 
PICTL
 |
PICTL_BIT
;

523 
IENx
 |
IEN_BIT
;

526 
	}
}

537 
	$HÆUARTResumeISR
( )

539 #i‡
deföed
 
POWER_SAVING


540 #i‡
deföed
 
HAL_UART_GPIO_ISR


541 
IENx
 &(
IEN_BIT
 ^ 0xFF);

544 i‡(
UxUCR
 & 
UCR_FLOW
)

546 
PxIEN
 &(
HAL_UART_Px_CTS
 ^ 0xFF);

547 
PxOUT
 &(
HAL_UART_Px_RTS
 ^ 0xFF);

551 
PxIEN
 &(
HAL_UART_Px_RX
 ^ 0xFF);

554 
UxUCR
 |
UCR_FLUSH
;

555 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

557 
	}
}

568 #i‡(
HAL_UART_ISR
 == 1)

569 
	$HAL_ISR_FUNCTION
–
hÆU¨t0RxI§
, 
URX0_VECTOR
 )

571 
	$HAL_ISR_FUNCTION
–
hÆU¨t1RxI§
, 
URX1_VECTOR
 )

574 
	`HAL_ENTER_ISR
();

576 
uöt8
 
tmp
 = 
UxDBUF
;

577 
i§Cfg
.
rxBuf
[i§Cfg.
rxTaû
] = 
tmp
;

580 i‡(
i§Cfg
.
rxHód
 =i§Cfg.
rxTaû
)

582 
i§Cfg
.
rxShdw
 = 
ST0
;

585 i‡(++
i§Cfg
.
rxTaû
 >
HAL_UART_ISR_RX_MAX
)

587 
i§Cfg
.
rxTaû
 = 0;

590 
i§Cfg
.
rxTick
 = 
HAL_UART_ISR_IDLE
;

592 
	`HAL_EXIT_ISR
();

593 
	}
}

604 #i‡(
HAL_UART_ISR
 == 1)

605 
	$HAL_ISR_FUNCTION
–
hÆU¨t0TxI§
, 
UTX0_VECTOR
 )

607 
	$HAL_ISR_FUNCTION
–
hÆU¨t1TxI§
, 
UTX1_VECTOR
 )

610 
	`HAL_ENTER_ISR
();

612 i‡(
i§Cfg
.
txHód
 =i§Cfg.
txTaû
)

614 
IEN2
 &~
UTXxIE
;

615 
i§Cfg
.
txMT
 = 1;

619 
UTXxIF
 = 0;

620 
UxDBUF
 = 
i§Cfg
.
txBuf
[i§Cfg.
txHód
++];

622 i‡(
i§Cfg
.
txHód
 >
HAL_UART_ISR_TX_MAX
)

624 
i§Cfg
.
txHód
 = 0;

628 
	`HAL_EXIT_ISR
();

629 
	}
}

631 #i‡(
deföed
 
POWER_SAVING
 && deföed 
HAL_UART_GPIO_ISR
)

641 #i‡(
HAL_UART_ISR
 == 1)

642 
	$HAL_ISR_FUNCTION
(
p‹t0I§
, 
P0INT_VECTOR
)

644 
	$HAL_ISR_FUNCTION
(
p‹t1I§
, 
P1INT_VECTOR
)

647 
	`HAL_ENTER_ISR
();

649 
	`HÆUARTResume
();

650 i‡(
dmaCfg
.
u¨tCB
 !
NULL
)

652 
dmaCfg
.
	`u¨tCB
(
HAL_UART_DMA
-1, 
HAL_UART_RX_WAKEUP
);

654 
PxIFG
 = 0;

655 
PxIF
 = 0;

657 
	`HAL_EXIT_ISR
();

658 
	}
}

	@Components/hal/target/CC2540USB/_hal_uart_spi.c

72 
	~<°rög.h
>

74 
	~"hÆ_as£π.h
"

75 
	~"hÆ_bﬂrd.h
"

76 
	~"hÆ_defs.h
"

77 
	~"hÆ_drivîs.h
"

78 
	~"hÆ_dma.h
"

79 
	~"hÆ_mcu.h
"

80 
	~"hÆ_ty≥s.h
"

81 
	~"hÆ_u¨t.h
"

82 #i‡
deföed
 
POWER_SAVING


83 
	~"OSAL.h
"

84 
	~"OSAL_PwrMgr.h
"

85 #ñi‡
deföed
 
HAL_SPI_QUEUED_TX
 && HAL_SPI_QUEUED_TX

86 
	~"OSAL.h
"

97 #i‡!
deföed
 
HAL_SPI_CH_RX


98 
	#HAL_SPI_CH_RX
 
HAL_DMA_CH_RX


	)

100 #i‡!
deföed
 
HAL_SPI_CH_TX


101 
	#HAL_SPI_CH_TX
 
HAL_DMA_CH_TX


	)

106 #i‡!
deföed
 
HAL_SPI_ON_UART_BUFS


107 
	#HAL_SPI_ON_UART_BUFS
 
FALSE


	)

110 #i‡!
deföed
 
HAL_SPI_QUEUED_TX


111 
	#HAL_SPI_QUEUED_TX
 
FALSE


	)

114 
	#SPI_MAX_PKT_LEN
 256

	)

115 
	#SPI_MAX_DAT_LEN
 (
SPI_MAX_PKT_LEN
 - 
SPI_FRM_LEN
)

	)

117 
	#SPI_SOF
 0xFE

118 

	)

120 
	#SPI_HDR_LEN
 1

122 
	#SPI_FRM_LEN
 (2 + 
SPI_HDR_LEN
)

	)

124 
	#SPI_SOF_IDX
 0

	)

125 
	#SPI_HDR_IDX
 1

126 
	#SPI_LEN_IDX
 1

127 
	#SPI_DAT_IDX
 2

128 

	)

129 #i‡
deföed
 
HAL_SPI_MASTER


133 #i‡!
deföed
 
HAL_SPI_WAKEUP


134 
	#HAL_SPI_WAKEUP
 
TRUE


	)

138 #i‡!
deföed
 
HAL_UART_SPI


139 
	#HAL_UART_SPI
 2

	)

140 #ñi‡ (
HAL_UART_SPI
 != 2)

141 #îr‹ 
O∆y
 
suµ‹tög
 
HAL_UART_SPI
==2 
now
.

145 
	#CSR_MODE
 0x80

	)

146 
	#CSR_RE
 0x40

	)

147 
	#CSR_SLAVE
 0x20

	)

148 
	#CSR_FE
 0x10

	)

149 
	#CSR_ERR
 0x08

	)

150 
	#CSR_RX_BYTE
 0x04

	)

151 
	#CSR_TX_BYTE
 0x02

	)

152 
	#CSR_ACTIVE
 0x01

	)

155 
	#UCR_FLUSH
 0x80

	)

156 
	#UCR_FLOW
 0x40

	)

157 
	#UCR_D9
 0x20

	)

158 
	#UCR_BIT9
 0x10

	)

159 
	#UCR_PARITY
 0x08

	)

160 
	#UCR_SPB
 0x04

	)

161 
	#UCR_STOP
 0x02

	)

162 
	#UCR_START
 0x01

	)

164 
	#P2DIR_PRIPO
 0xC0

	)

166 
	#HAL_DMA_U0DBUF
 0x70C1

	)

167 
	#HAL_DMA_U1DBUF
 0x70F9

	)

169 #unde‡
UxCSR


170 #unde‡
UxUCR


171 #unde‡
UxDBUF


172 #unde‡
UxBAUD


173 #unde‡
UxGCR


174 #i‡ (
HAL_UART_SPI
 == 1)

175 
	#UxCSR
 
U0CSR


	)

176 
	#UxUCR
 
U0UCR


	)

177 
	#UxDBUF
 
U0DBUF


	)

178 
	#UxBAUD
 
U0BAUD


	)

179 
	#UxGCR
 
U0GCR


	)

180 #ñi‡ (
HAL_UART_SPI
 == 2)

181 
	#UxCSR
 
U1CSR


	)

182 
	#UxUCR
 
U1UCR


	)

183 
	#UxDBUF
 
U1DBUF


	)

184 
	#UxBAUD
 
U1BAUD


	)

185 
	#UxGCR
 
U1GCR


	)

188 #unde‡
PxSEL


189 #unde‡
HAL_UART_PERCFG_BIT


190 #unde‡
HAL_UART_PRIPO


191 #unde‡
HAL_UART_Px_SEL_S


192 #unde‡
HAL_UART_Px_SEL_M


193 #i‡ (
HAL_UART_SPI
 == 1)

194 
	#PxSEL
 
P0SEL


	)

195 
	#HAL_UART_PERCFG_BIT
 0x01

196 
	#HAL_UART_PRIPO
 0x00

197 
	#HAL_UART_Px_SEL_S
 0x3C

198 
	#HAL_UART_Px_SEL_M
 0x2C

199 #ñi‡ (
HAL_UART_SPI
 =2)

	)

200 
	#PxSEL
 
P1SEL


	)

201 
	#HAL_UART_PERCFG_BIT
 0x02

202 
	#HAL_UART_PRIPO
 0x40

203 
	#HAL_UART_Px_SEL_S
 0xF0

204 
	#HAL_UART_Px_SEL_M
 0xE0

206 

	)

207 #unde‡
DMA_PAD


208 #unde‡
DMA_UxDBUF


209 #unde‡
DMATRIG_RX


210 #unde‡
DMATRIG_TX


211 #i‡ (
HAL_UART_SPI
 == 1)

212 
	#DMA_PAD
 
U0BAUD


	)

213 
	#DMA_UxDBUF
 
HAL_DMA_U0DBUF


	)

214 
	#DMATRIG_RX
 
HAL_DMA_TRIG_URX0


	)

215 
	#DMATRIG_TX
 
HAL_DMA_TRIG_UTX0


	)

216 #ñi‡ (
HAL_UART_SPI
 == 2)

217 
	#DMA_PAD
 
U1BAUD


	)

218 
	#DMA_UxDBUF
 
HAL_DMA_U1DBUF


	)

219 
	#DMATRIG_RX
 
HAL_DMA_TRIG_URX1


	)

220 
	#DMATRIG_TX
 
HAL_DMA_TRIG_UTX1


	)

223 #unde‡
PxIEN


224 #unde‡
PxIFG


225 #unde‡
PxIF


226 #unde‡
PICTL_BIT


227 #unde‡
IENx


228 #unde‡
IEN_BIT


229 #i‡ ((
HAL_UART_SPI
 =1Ë|| 
deföed
 
HAL_SPI_MASTER
)

230 
	#PxIEN
 
P0IEN


	)

231 
	#PxIFG
 
P0IFG


	)

232 
	#PxIF
 
P0IF


	)

233 #i‡!
deföed
 
SPI_RDYIn


234 
	#SPI_RDYIn
 
P0_1


	)

235 
	#SPI_RDYIn_BIT
 
	`BV
(1)

	)

238 
	#PICTL_BIT
 
	`BV
(0)

	)

239 
	#IENx
 
IEN1


	)

240 
	#IEN_BIT
 
	`BV
(5)

	)

241 #ñi‡ (
HAL_UART_SPI
 == 2)

242 
	#PxIEN
 
P1IEN


	)

243 
	#PxIFG
 
P1IFG


	)

244 
	#PxIF
 
P1IF


	)

245 
	#SPI_RDYIn
 
P1_4


	)

246 
	#SPI_RDYIn_BIT
 
	`BV
(4)

	)

248 
	#PICTL_BIT
 
	`BV
(2)

	)

249 
	#IENx
 
IEN2


	)

250 
	#IEN_BIT
 
	`BV
(4)

	)

253 #unde‡
PxDIR


254 #i‡ ((
HAL_UART_SPI
 =1Ë|| 
deföed
 
HAL_SPI_MASTER
)

255 
	#PxDIR
 
P1DIR


	)

256 
	#SPI_RDYOut
 
P1_4


	)

257 
	#SPI_RDYOut_BIT
 
	`BV
(4)

	)

258 #ñi‡ (
HAL_UART_SPI
 == 2)

259 
	#PxDIR
 
P0DIR


	)

260 
	#SPI_RDYOut
 
P0_5


	)

261 
	#SPI_RDYOut_BIT
 
	`BV
(5)

	)

269 #i‡(
SPI_MAX_PKT_LEN
 <= 256)

270 
uöt8
 
	t•iLí_t
;

272 
uöt16
 
	t•iLí_t
;

277 
	m•iRxSãSOF
,

278 
	m•iRxSãLí
,

279 
	m•iRxSãD©a
,

280 
	m•iRxSãFcs


281 } 
	t•iRxSã_t
;

288 #i‡
SPI_MAX_PKT_LEN
 == 256

289 
	#SPI_LEN_T_INCR
(
LEN
Ë(LEN)++

	)

290 
	#SPI_LEN_T_BOUNDS_CHECK
(
LEN
)

	)

292 
	#SPI_LEN_T_INCR
(
LEN
Ë
	`°
 ( \

293 i‡(++(
LEN
Ë>
SPI_MAX_PKT_LEN
) \

295 (
LEN
) = 0; \

297 )

	)

299 
	#SPI_LEN_T_BOUNDS_CHECK
(
LEN
Ë
	`°
 ( \

300 i‡(
Àn
 > 
SPI_MAX_PKT_LEN
) \

302 
Àn
 = 
SPI_MAX_PKT_LEN
; \

304 )

	)

307 
	#SPI_CLR_RX_BYTE
(
IDX
Ë(
•iRxBuf
[(IDX)] = 
	`BUILD_UINT16
(0, (
DMA_PAD
 ^ 0xFF)))

	)

308 
	#SPI_GET_RX_BYTE
(
IDX
Ë(*(vﬁ©ûê
uöt8
 *)(
•iRxBuf
+(IDX)))

	)

309 
	#SPI_NEW_RX_BYTE
(
IDX
Ë((
uöt8
)
DMA_PAD
 =
	`HI_UINT16
(
•iRxBuf
[(IDX)]))

	)

311 
	#SPI_DAT_LEN
(
PBUF
Ë((PBUF)[
SPI_LEN_IDX
])

	)

312 
	#SPI_PKT_LEN
(
PBUF
Ë(
	`SPI_DAT_LEN
((PBUF)Ë+ 
SPI_FRM_LEN
)

	)

314 
	#SPI_RDY_IN
(Ë(
SPI_RDYIn
 =0)

	)

315 
	#SPI_RDY_OUT
(Ë(
SPI_RDYOut
 =0)

	)

317 #i‡
deföed
 
HAL_SPI_MASTER


318 
	#SPI_CLR_CSn_OUT
(Ë(
SPI_RDYOut
 = 1)

	)

319 
	#SPI_SET_CSn_OUT
(Ë(
SPI_RDYOut
 = 0)

	)

321 
	#SPI_CLOCK_RX
(
CNT
Ë
	`°
 ( \

322 
	`SPI_SET_CSn_OUT
(); \

324 
•iLí_t
 
˙t
 = 0; c¡ <(
CNT
); cnt++) \

326 
UxDBUF
 = 0; \

327 
UxCSR
 & 
CSR_ACTIVE
); \

330 
	`SPI_CLR_CSn_OUT
(); \

331 )

	)

332 
	#SPI_CLR_RDY_OUT
(Ë
	`SPI_CLR_CSn_OUT
()

	)

334 #ñi‡!
deföed
 
HAL_SPI_MASTER


335 
	#SPI_CLR_RDY_OUT
(Ë(
SPI_RDYOut
 = 1)

	)

336 
	#SPI_SET_RDY_OUT
(Ë(
SPI_RDYOut
 = 0)

	)

337 
	#SPI_TOG_RDY_OUT
(Ë
	`°
 ( \

338 i‡(
	`SPI_RDY_OUT
()) \

340 
	`SPI_CLR_RDY_OUT
(); \

344 
	`SPI_SET_RDY_OUT
(); \

346 )

	)

349 
	#SPI_RX_RDY
(Ë(
•iRxHód
 !
•iRxTaû
)

	)

358 #i‡
HAL_SPI_ON_UART_BUFS


359 
uöt16
 *c⁄° 
	g•iRxBuf
 = 
dmaCfg
.
rxBuf
;

360 #i‡(
deföed
 
HAL_UART_TX_BY_ISR
 && HAL_UART_TX_BY_ISR)

361 
uöt8
 *c⁄° 
	g•iRxD©
 = 
dmaCfg
.
txBuf
;

362 
__no_öô
 
uöt8
 
	g•iTxPkt
[
SPI_MAX_PKT_LEN
];

364 
uöt8
 *c⁄° 
	g•iRxD©
 = 
dmaCfg
.
txBuf
[0];

365 
uöt8
 *c⁄° 
	g•iTxPkt
 = 
dmaCfg
.
txBuf
[1];

368 
__no_öô
 
uöt16
 
	g•iRxBuf
[
SPI_MAX_PKT_LEN
];

369 
__no_öô
 
uöt8
 
	g•iRxD©
[
SPI_MAX_PKT_LEN
];

370 
__no_öô
 
uöt8
 
	g•iTxPkt
[
SPI_MAX_PKT_LEN
];

373 #i‡
HAL_SPI_QUEUED_TX


374 
oßl_msg_q_t
 
	g•iTxQ
;

375 vﬁ©ûê
uöt8
 
	g•iTxMT
;

378 
•iRxSã_t
 
	g•iRxSã
;

379 
•iLí_t
 
	g•iRxIdx
;

380 
•iLí_t
 
	g•iRxC¡
;

381 
•iLí_t
 
	g•iRxLí
;

382 
•iLí_t
 
	g•iRxFcs
;

384 
•iLí_t
 
	g•iRxHód
;

385 
•iLí_t
 
	g•iRxTaû
;

386 
•iLí_t
 
	g•iRxTemp
;

390 vﬁ©ûê
•iLí_t
 
	g•iTxLí
;

392 
hÆUARTCBack_t
 
	g•iCB
;

394 #i‡(
deföed
 
POWER_SAVING
 || (deföed 
HAL_SPI_MASTER
 && 
HAL_SPI_WAKEUP
))

395 vﬁ©ûê
uöt8
 
	g•iRdyI§
;

398 #i‡
deföed
 
POWER_SAVING


399 
uöt8
 
	g•iHﬁdPM
;

407 
•iLí_t
 
	g•iRxBug
;

414 
HÆUART_DMAI§SPI
();

421 
uöt8
 
•iCÆcFcs
(uöt8 *
pBuf
);

422 
•iP¨£Rx
();

423 #i‡
deföed
 
POWER_SAVING


424 
uöt8
 
•iSwìpRx
();

442 
	$HÆUARTInôSPI
()

444 #i‡(
HAL_UART_SPI
 == 1)

445 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

447 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

449 #i‡
deföed
 
HAL_SPI_MASTER


450 
PxSEL
 |
HAL_UART_Px_SEL_M
;

451 
UxCSR
 = 0;

452 
UxGCR
 = 16;

453 
UxBAUD
 = 255;

454 #ñi‡!
deföed
 
HAL_SPI_MASTER


455 
PxSEL
 |
HAL_UART_Px_SEL_S
;

456 
UxCSR
 = 
CSR_SLAVE
;

458 
UxUCR
 = 
UCR_FLUSH
;

459 
UxGCR
 |
	`BV
(5);

461 
P2DIR
 &~
P2DIR_PRIPO
;

462 
P2DIR
 |
HAL_UART_PRIPO
;

465 
PxIEN
 |
SPI_RDYIn_BIT
;

466 
PICTL
 |
PICTL_BIT
;

468 
	`SPI_CLR_RDY_OUT
();

469 
PxDIR
 |
SPI_RDYOut_BIT
;

472 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_SPI_CH_TX
 );

475 
	`HAL_DMA_SET_DEST
–
ch
, 
DMA_UxDBUF
 );

478 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

481 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

484 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

485 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
DMATRIG_TX
 );

488 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_1
 );

489 
	`HAL_DMA_SET_SOURCE
–
ch
, 
•iTxPkt
 );

492 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_0
 );

495 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_ENABLE
 );

498 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

501 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

504 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_SPI_CH_RX
 );

507 
	`HAL_DMA_SET_SOURCE
–
ch
, 
DMA_UxDBUF
 );

510 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

519 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_WORD
 );

522 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE_REPEATED
 );

523 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
DMATRIG_RX
 );

526 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_0
 );

529 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_1
 );

530 
	`HAL_DMA_SET_DEST
–
ch
, 
•iRxBuf
 );

531 
	`HAL_DMA_SET_LEN
–
ch
, 
SPI_MAX_PKT_LEN
 );

534 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

537 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

540 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

542 vﬁ©ûê
uöt8
 
dummy
 = *(vﬁ©ûêuöt8 *)
DMA_UxDBUF
;

543 
	`HAL_DMA_CLEAR_IRQ
(
HAL_SPI_CH_RX
);

544 
	`HAL_DMA_ARM_CH
(
HAL_SPI_CH_RX
);

545 ()
	`mem£t
(
•iRxBuf
, (
DMA_PAD
 ^ 0xFF), 
SPI_MAX_PKT_LEN
 * (
uöt16
));

546 
	}
}

563 
	$HÆUARTO≥nSPI
(
hÆUARTCfg_t
 *
c⁄fig
)

565 
•iCB
 = 
c⁄fig
->
ˇŒBackFunc
;

567 
UxCSR
 |
CSR_RE
;

569 
PxIFG
 = 0;

570 
PxIF
 = 0;

571 
IENx
 |
IEN_BIT
;

572 
	}
}

590 
•iLí_t
 
	$HÆUARTRódSPI
(
uöt8
 *
buf
, 
•iLí_t
 
Àn
)

592 
•iLí_t
 
˙t
 = 0; c¡ < 
Àn
; cnt++)

594 i‡(
•iRxHód
 =
•iRxTaû
)

596 
Àn
 = 
˙t
;

600 *
buf
++ = 
•iRxD©
[
•iRxHód
];

601 
	`SPI_LEN_T_INCR
(
•iRxHód
);

604  
Àn
;

605 
	}
}

623 
•iLí_t
 
	$HÆUARTWrôeSPI
(
uöt8
 *
buf
, 
•iLí_t
 
Àn
)

625 i‡(
•iTxLí
 != 0)

627 #i‡
HAL_SPI_QUEUED_TX


628 
uöt8
 *
txMsg
 = 
	`oßl_msg_Æloˇã
(
Àn
);

630 i‡(
txMsg
 !
NULL
)

632 ()
	`mem˝y
(
txMsg
, 
buf
, 
Àn
);

633 
	`oßl_msg_íqueue
(&
•iTxQ
, 
txMsg
);

635  
Àn
;

642 i‡(
Àn
 > 
SPI_MAX_DAT_LEN
)

644 
Àn
 = 
SPI_MAX_DAT_LEN
;

646 
•iTxLí
 = 
Àn
;

647 #i‡
HAL_SPI_QUEUED_TX


648 
•iTxMT
 = 
FALSE
;

651 
•iTxPkt
[
SPI_LEN_IDX
] = 
Àn
;

652 ()
	`mem˝y
(
•iTxPkt
 + 
SPI_DAT_IDX
, 
buf
, 
Àn
);

654 
	`•iCÆcFcs
(
•iTxPkt
);

655 
•iTxPkt
[
SPI_SOF_IDX
] = 
SPI_SOF
;

657 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
(
HAL_SPI_CH_TX
);

658 
	`HAL_DMA_SET_LEN
(
ch
, 
	`SPI_PKT_LEN
(
•iTxPkt
));

660 #i‡
deföed
 
HAL_SPI_MASTER


661 #i‡
HAL_SPI_WAKEUP


668 
•iRdyI§
 = 0;

669 !
	`SPI_RDY_IN
(Ë&& (
•iRdyI§
 == 0))

671 
	`SPI_CLOCK_RX
(1);

673 
uöt16
 
˙t
 = 0; cnt < 512; cnt++)

675 i‡(
	`SPI_RDY_IN
(Ë|| (
•iRdyI§
 != 0))

682 
	`SPI_SET_CSn_OUT
();

683 
	`HAL_DMA_ARM_CH
(
HAL_SPI_CH_TX
);

684 
	`asm
("NOP");ásm("NOP");ásm("NOP");ásm("NOP");ásm("NOP");

685 
	`asm
("NOP");ásm("NOP");ásm("NOP");ásm("NOP");

686 
	`HAL_DMA_MAN_TRIGGER
(
HAL_SPI_CH_TX
);

688 #ñi‡!
deföed
 
HAL_SPI_MASTER


690 
	`HAL_DMA_ARM_CH
(
HAL_SPI_CH_TX
);

691 
	`asm
("NOP");ásm("NOP");ásm("NOP");ásm("NOP");ásm("NOP");

692 
	`asm
("NOP");ásm("NOP");ásm("NOP");ásm("NOP");

693 
	`SPI_SET_RDY_OUT
();

696  
Àn
;

697 
	}
}

714 
	$HÆUARTPﬁlSPI
()

716 #i‡
HAL_SPI_QUEUED_TX


722 i‡((
•iTxLí
 =0Ë&& (
•iTxQ
 !
NULL
))

724 
uöt8
 *
txMsg
 = 
	`oßl_msg_dequeue
(&
•iTxQ
);

726 ()
	`HÆUARTWrôeSPI
(
txMsg
, 
	`OSAL_MSG_LEN
(txMsg));

727 ()
	`oßl_msg_dóŒoˇã
(
txMsg
);

729 i‡(
•iTxMT
)

731 
•iTxMT
 = 
FALSE
;

732 
	`•iCB
((
HAL_UART_SPI
 - 1), 
HAL_UART_TX_EMPTY
);

736 
	`•iP¨£Rx
();

738 #i‡
HAL_SPI_QUEUED_TX
 || 
deföed
 
HAL_SPI_MASTER


739 i‡(
	`SPI_RX_RDY
())

745 i‡(
	`SPI_RX_RDY
(Ë&& !
•iTxLí
)

748 i‡(
•iCB
 !
NULL
)

750 
	`•iCB
((
HAL_UART_SPI
 - 1), 
HAL_UART_RX_TIMEOUT
);

754 
PxIEN
 &~
SPI_RDYIn_BIT
;

756 i‡(!
	`SPI_RDY_IN
(Ë&& !
•iTxLí
)

758 
	`SPI_CLR_RDY_OUT
();

761 #i‡
deföed
 
POWER_SAVING


762 i‡(
	`SPI_RDY_IN
(Ë|| 
	`SPI_RX_RDY
(Ë|| 
•iRxLí
 || 
•iTxLí
 || 
•iRdyI§
)

764 
•iRdyI§
 = 0;

766 i‡(
•iHﬁdPM
 == 0)

768 
•iHﬁdPM
 = 1;

769 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_HOLD_EVENT
);

774 
•iRdyI§
 = 0;

776 i‡(
•iHﬁdPM
 != 0)

778 
PxIEN
 |
SPI_RDYIn_BIT
;

780 i‡(
	`•iSwìpRx
())

782 
•iHﬁdPM
 = 0;

783 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_PWRMGR_CONSERVE_EVENT
);

789 
PxIEN
 |
SPI_RDYIn_BIT
;

790 
	}
}

807 
•iLí_t
 
	$HÆUARTRxAvaûSPI
()

809  (
•iRxTaû
 > 
•iRxHód
Ë? (•iRxTaû-•iRxHódË: (•iRxTaû+(
SPI_MAX_PKT_LEN
-spiRxHead));

810 
	}
}

827 
uöt8
 
	$•iCÆcFcs
(
uöt8
 *
pBuf
)

829 
•iLí_t
 
Àn
 = 
	`SPI_DAT_LEN
(
pBuf
Ë+ 
SPI_HDR_LEN
 + 
SPI_HDR_IDX
;

830 
•iLí_t
 
idx
 = 
SPI_HDR_IDX
;

831 
uöt8
 
fcs
 = 0;

833 
idx
 < 
Àn
)

835 
fcs
 ^
pBuf
[
idx
++];

837 
pBuf
[
idx
] = 
fcs
;

839  
fcs
;

840 
	}
}

857 
	$•iP¨£Rx
()

861 i‡(!
	`SPI_NEW_RX_BYTE
(
•iRxIdx
))

863 #i‡
deföed
 
HAL_SPI_MASTER


864 i‡(
	`SPI_RDY_IN
(Ë&& (
•iTxLí
 == 0))

866 
	`SPI_CLOCK_RX
(1);

871 i‡(
	`SPI_NEW_RX_BYTE
(
•iRxBug
))

873 !
	`SPI_NEW_RX_BYTE
(
•iRxIdx
))

875 
	`SPI_LEN_T_INCR
(
•iRxIdx
);

878 
•iRxBug
 = 
•iRxIdx
;

882 
	`SPI_LEN_T_INCR
(
•iRxBug
);

886 
uöt8
 
ch
 = 
	`SPI_GET_RX_BYTE
(
•iRxIdx
);

887 
	`SPI_CLR_RX_BYTE
(
•iRxIdx
);

888 
	`SPI_LEN_T_INCR
(
•iRxIdx
);

890 
•iRxSã
)

892 
•iRxSãSOF
:

893 i‡(
ch
 =
SPI_SOF
)

895 
•iRxSã
 = 
•iRxSãLí
;

901 
•iRxLí
 = 1;

905 
•iRxSãLí
:

906 i‡((
ch
 =0Ë|| (ch > 
SPI_MAX_DAT_LEN
))

908 
•iRxSã
 = 
•iRxSãSOF
;

909 
•iRxLí
 = 0;

913 
•iRxFcs
 = 
•iRxLí
 = 
ch
;

914 
•iRxTemp
 = 
•iRxTaû
;

915 
•iRxC¡
 = 0;

916 
•iRxSã
 = 
•iRxSãD©a
;

917 #i‡
deföed
 
HAL_SPI_MASTER


918 
	`SPI_CLOCK_RX
(
ch
 + 1);

923 
•iRxSãD©a
:

924 
•iRxFcs
 ^
ch
;

925 
•iRxD©
[
•iRxTemp
] = 
ch
;

926 
	`SPI_LEN_T_INCR
(
•iRxTemp
);

928 i‡(++
•iRxC¡
 =
•iRxLí
)

930 
•iRxSã
 = 
•iRxSãFcs
;

934 
•iRxSãFcs
:

935 
•iRxSã
 = 
•iRxSãSOF
;

937 i‡(
ch
 =
•iRxFcs
)

939 
•iRxTaû
 = 
•iRxTemp
;

942 
•iRxC¡
 = 
•iRxLí
 = 0;

946 
	`HAL_ASSERT
(0);

950 
	}
}

952 #i‡
deföed
 
POWER_SAVING


972 
uöt8
 
	$•iSwìpRx
()

974 
•iLí_t
 
swìpIdx
 = 
•iRxIdx
;

977 i‡(
	`SPI_NEW_RX_BYTE
(
swìpIdx
))

979 
•iRxBug
 = 
•iRxIdx
 = 
swìpIdx
++;

983 
	`SPI_LEN_T_INCR
(
swìpIdx
);

985 } 
swìpIdx
 !
•iRxIdx
);

987  (
swìpIdx
 =
•iRxIdx
);

988 
	}
}

1006 
	$HÆUART_DMAI§SPI
()

1008 #i‡!
deföed
 
HAL_SPI_MASTER


1009 i‡(!
	`SPI_RDY_IN
())

1012 
	`SPI_CLR_RDY_OUT
();

1014 
•iTxLí
 = 0;

1016 #i‡
HAL_SPI_QUEUED_TX


1017 i‡(
•iTxQ
 !
NULL
)

1019 
uöt8
 *
txMsg
 = 
	`oßl_msg_dequeue
(&
•iTxQ
);

1021 ()
	`HÆUARTWrôeSPI
(
txMsg
, 
	`OSAL_MSG_LEN
(txMsg));

1022 ()
	`oßl_msg_dóŒoˇã
(
txMsg
);

1026 
•iTxMT
 = 
TRUE
;

1029 
	`•iCB
((
HAL_UART_SPI
 - 1), 
HAL_UART_TX_EMPTY
);

1031 
	}
}

1042 #i‡
deföed
 
HAL_SBL_BOOT_CODE


1043 
	$•iRdyIn
()

1046 #i‡ ((
HAL_UART_SPI
 =1Ë|| 
deföed
 
HAL_SPI_MASTER
)

1047 
	$HAL_ISR_FUNCTION
(
p‹t0I§
, 
P0INT_VECTOR
)

1048 #ñi‡(
HAL_UART_SPI
 == 2)

1049 
	$HAL_ISR_FUNCTION
(
p‹t1I§
, 
P1INT_VECTOR
)

1052 
	`HAL_ENTER_ISR
();

1055 
PxIFG
 = 0;

1056 
PxIF
 = 0;

1058 #i‡(
deföed
 
POWER_SAVING
 || (deföed 
HAL_SPI_MASTER
 && 
HAL_SPI_WAKEUP
))

1059 
•iRdyI§
 = 1;

1061 #i‡!
deföed
 
HAL_SPI_MASTER


1062 i‡(
•iTxLí
 == 0)

1064 
	`SPI_TOG_RDY_OUT
();

1068 #i‡!
deföed
 
HAL_SBL_BOOT_CODE


1069 
	`CLEAR_SLEEP_MODE
();

1070 
	`HAL_EXIT_ISR
();

1072 
	}
}

	@Components/hal/target/CC2540USB/_hal_uart_usb.c

44 
	~"hÆ_u¨t.h
"

46 
	~"usb_bﬂrd_cfg.h
"

47 
	~"usb_cdc.h
"

48 
	~"usb_cdc_hooks.h
"

49 
	~"usb_fúmw¨e_libøry_c⁄fig.h
"

50 
	~"usb_fúmw¨e_libøry_hódîs.h
"

56 #i‡!
deföed
 
HAL_UART_BAUD_RATE


57 
	#HAL_UART_BAUD_RATE
 115200

	)

61 
	#HAL_UART_MSECS_TO_TICKS
 33

	)

63 #i‡!
deföed
 
HAL_UART_USB_HIGH


64 
	#HAL_UART_USB_HIGH
 (256 / 2 - 16)

	)

66 #i‡!
deföed
 
HAL_UART_USB_IDLE


67 
	#HAL_UART_USB_IDLE
 (0 * 
HAL_UART_MSECS_TO_TICKS
)

	)

71 
	#HAL_UART_USB_TX_MAX
 64

	)

85 
__no_öô
 
uöt8
 
	ghÆU¨tRxQ
[256];

86 
__no_öô
 
uöt8
 
	ghÆU¨tTxQ
[256];

88 
uöt8
 
	ghÆU¨tRxH
, 
	ghÆU¨tRxT
;

89 
uöt8
 
	ghÆU¨tTxH
, 
	ghÆU¨tTxT
;

91 #i‡!
deföed
 
HAL_SB_BOOT_CODE


92 
uöt8
 
	grxTick
;

93 
uöt8
 
	grxShdw
;

94 
uöt8
 
	gusbTxMT
;

95 
hÆUARTCBack_t
 
	gusbCB
;

102 
HÆUARTInôUSB
();

103 
HÆUARTPﬁlUSB
();

104 
hÆU¨tPﬁlEvt
();

105 
hÆU¨tPﬁlRx
();

106 
hÆU¨tPﬁlTx
();

123 
	$HÆUARTInôUSB
()

126 
cuºítLöeCodög
.
dãR©e
 = 
HAL_UART_BAUD_RATE
;

127 
cuºítLöeCodög
.
ch¨F‹m©
 = 
CDC_CHAR_FORMAT_1_STOP_BIT
;

128 
cuºítLöeCodög
.
∑rôyTy≥
 = 
CDC_PARITY_TYPE_NONE
;

129 
cuºítLöeCodög
.
d©aBôs
 = 8;

132 
	`usbfwInô
();

135 
	`usbúqInô
(0xFFFF);

137 #i‡
deföed
 
HAL_SB_BOOT_CODE


138 
	`HAL_USB_PULLUP_ENABLE
();

140 
	}
}

142 #i‡!
deföed
 
HAL_SB_BOOT_CODE


152 
	$HÆUARTO≥nUSB
(
hÆUARTCfg_t
 *
c⁄fig
)

154 
usbCB
 = 
c⁄fig
->
ˇŒBackFunc
;

155 
	`HAL_USB_PULLUP_ENABLE
();

156 
	}
}

168 
	$HÆUARTPﬁlUSB
()

170 #i‡
deföed
 
HAL_SB_BOOT_CODE


171 
USBIF
Ë
	`usbúqH™dÀr
();

173 
	`hÆU¨tPﬁlEvt
();

174 
	`hÆU¨tPﬁlRx
();

175 
	`hÆU¨tPﬁlTx
();

176 
	}
}

178 
uöt8
 
HÆUARTRx
(uöt8 *
buf
, uöt8 
max
);

179 
uöt8
 
	$HÆUARTRx
(
uöt8
 *
buf
, uöt8 
max
)

181 
uöt8
 
˙t
 = 0;

183 (
hÆU¨tRxH
 !
hÆU¨tRxT
Ë&& (
˙t
 < 
max
))

185 *
buf
++ = 
hÆU¨tRxQ
[
hÆU¨tRxH
++];

186 
˙t
++;

189  
˙t
;

190 
	}
}

192 
uöt8
 
HÆUARTTx
(uöt8 *
buf
, uöt8 
˙t
);

193 
uöt8
 
	$HÆUARTTx
(
uöt8
 *
buf
, uöt8 
˙t
)

195 
˙t
--)

197 
hÆU¨tTxQ
[
hÆU¨tTxT
++] = *
buf
++;

200 #i‡!
deföed
 
HAL_SB_BOOT_CODE


201 
usbTxMT
 = 
FALSE
;

204 
	}
}

215 
uöt16
 
	$HÆUARTRxAvaûUSB
()

217  ((
hÆU¨tRxT
 >
hÆU¨tRxH
)?

218 
hÆU¨tRxT
 - 
hÆU¨tRxH
 : (
hÆU¨tRxQ
) - halUartRxH + halUartRxT);

219 
	}
}

230 
	$hÆU¨tPﬁlEvt
()

233 i‡(
	`USBIRQ_GET_EVENT_MASK
(Ë& 
USBIRQ_EVENT_RESET
)

235 
	`USBIRQ_CLEAR_EVENTS
(
USBIRQ_EVENT_RESET
);

236 
	`usbfwRe£tH™dÀr
();

240 i‡(
	`USBIRQ_GET_EVENT_MASK
(Ë& 
USBIRQ_EVENT_SETUP
)

242 
	`USBIRQ_CLEAR_EVENTS
(
USBIRQ_EVENT_SETUP
);

243 
	`usbfwSëupH™dÀr
();

247 i‡(
	`USBIRQ_GET_EVENT_MASK
(Ë& 
USBIRQ_EVENT_SUSPEND
)

250 
	`USBIRQ_CLEAR_EVENTS
(
USBIRQ_EVENT_SUSPEND
);

252 #i‡
HAL_UART_USB_SUSPEND


254 
	`usbsu•E¡î
();

258 
	`USBIRQ_CLEAR_EVENTS
(
USBIRQ_EVENT_RESUME
);

260 
	}
}

271 
	$hÆU¨tPﬁlRx
()

273 
uöt8
 
˙t
;

274 
uöt8
 
ï
 = 
	`USBFW_GET_SELECTED_ENDPOINT
();

275 
	`USBFW_SELECT_ENDPOINT
(4);

278 i‡(
	`USBFW_OUT_ENDPOINT_DISARMED
())

280 
hÆI¡Sèã_t
 
ötSèã
;

282 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

284 
˙t
 = 
	`USBFW_GET_OUT_ENDPOINT_COUNT_LOW
();

285 
˙t
 +
	`USBFW_GET_OUT_ENDPOINT_COUNT_HIGH
() >> 8;

286 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

288 
˙t
--)

290 
hÆU¨tRxQ
[
hÆU¨tRxT
++] = 
USBF4
;

292 
	`USBFW_ARM_OUT_ENDPOINT
();

294 #i‡!
deföed
 
HAL_SB_BOOT_CODE


298 i‡(
rxTick
 == 0)

300 
rxShdw
 = 
ST0
;

302 
rxTick
 = 
HAL_UART_USB_IDLE
;

305 #i‡!
deföed
 
HAL_SB_BOOT_CODE


306 i‡(
rxTick
)

309 
uöt8
 
de¸
 = 
ST0
 - 
rxShdw
;

311 i‡(
rxTick
 > 
de¸
)

313 
rxTick
 -
de¸
;

314 
rxShdw
 = 
ST0
;

318 
rxTick
 = 0;

323 
uöt8
 
evt
 = 0;

324 
˙t
 = 
hÆU¨tRxT
 - 
hÆU¨tRxH
;

326 i‡(
˙t
 >
HAL_UART_USB_HIGH
)

328 
evt
 = 
HAL_UART_RX_ABOUT_FULL
;

330 i‡(
˙t
 && !
rxTick
)

332 
evt
 = 
HAL_UART_RX_TIMEOUT
;

335 i‡(
evt
 && (
NULL
 !
usbCB
))

337 
	`usbCB
(0, 
evt
);

342 
	`USBFW_SELECT_ENDPOINT
(
ï
);

343 
	}
}

354 
	$hÆU¨tPﬁlTx
()

356 
uöt8
 
ï
 = 
	`USBFW_GET_SELECTED_ENDPOINT
();

357 
	`USBFW_SELECT_ENDPOINT
(4);

360 i‡(
	`USBFW_IN_ENDPOINT_DISARMED
())

362 i‡(
hÆU¨tTxT
 =
hÆU¨tTxH
)

364 #i‡!
deföed
 
HAL_SB_BOOT_CODE


365 i‡(!
usbTxMT
 && 
usbCB
)

367 
usbTxMT
 = 
TRUE
;

368 
	`usbCB
(0, 
HAL_UART_TX_EMPTY
);

374 
uöt8
 
max
 = 
HAL_UART_USB_TX_MAX
;

378 
USBF4
 = 
hÆU¨tTxQ
[
hÆU¨tTxH
++];

379 } (
hÆU¨tTxH
 !
hÆU¨tTxT
Ë&& (0 !--
max
));

381 
	`USBFW_ARM_IN_ENDPOINT
();

385 
	`USBFW_SELECT_ENDPOINT
(
ï
);

386 
	}
}

	@Components/hal/target/CC2540USB/hal_adc.c

44 
	~"hÆ_adc.h
"

45 
	~"hÆ_defs.h
"

46 
	~"hÆ_mcu.h
"

47 
	~"hÆ_ty≥s.h
"

52 
	#HAL_ADC_EOC
 0x80

	)

53 
	#HAL_ADC_START
 0x40

	)

55 
	#HAL_ADC_STSEL_EXT
 0x00

	)

56 
	#HAL_ADC_STSEL_FULL
 0x10

	)

57 
	#HAL_ADC_STSEL_T1C0
 0x20

	)

58 
	#HAL_ADC_STSEL_ST
 0x30

	)

60 
	#HAL_ADC_RAND_NORM
 0x00

	)

61 
	#HAL_ADC_RAND_LFSR
 0x04

	)

62 
	#HAL_ADC_RAND_SEED
 0x08

	)

63 
	#HAL_ADC_RAND_STOP
 0x0¯

	)

64 
	#HAL_ADC_RAND_BITS
 0x0¯

	)

66 
	#HAL_ADC_DEC_064
 0x00

	)

67 
	#HAL_ADC_DEC_128
 0x10

	)

68 
	#HAL_ADC_DEC_256
 0x20

	)

69 
	#HAL_ADC_DEC_512
 0x30

	)

70 
	#HAL_ADC_DEC_BITS
 0x30

	)

72 
	#HAL_ADC_STSEL
 
HAL_ADC_STSEL_ST


	)

73 
	#HAL_ADC_RAND_GEN
 
HAL_ADC_RAND_STOP


	)

74 
	#HAL_ADC_REF_VOLT
 
HAL_ADC_REF_AVDD


	)

75 
	#HAL_ADC_DEC_RATE
 
HAL_ADC_DEC_064


	)

76 
	#HAL_ADC_SCHN
 
HAL_ADC_CHN_VDD3


	)

77 
	#HAL_ADC_ECHN
 
HAL_ADC_CHN_GND


	)

84 #i‡(
HAL_ADC
 =
TRUE
)

85 
uöt8
 
	gadcRef
;

97 
	$HÆAdcInô
 ()

99 #i‡(
HAL_ADC
 =
TRUE
)

100 
adcRef
 = 
HAL_ADC_REF_VOLT
;

102 
	}
}

117 
uöt16
 
	$HÆAdcRód
 (
uöt8
 
ch™√l
, uöt8 
ªsﬁuti⁄
)

119 
öt16
 
ªadög
 = 0;

121 #i‡(
HAL_ADC
 =
TRUE
)

122 
uöt8
 
i
, 
ªsbôs
;

123 
uöt8
 
adcCh™√l
 = 1;

133 i‡(
ch™√l
 < 8)

135 
i
=0; i < 
ch™√l
; i++)

137 
adcCh™√l
 <<= 1;

142 
ADCCFG
 |
adcCh™√l
;

145 
ªsﬁuti⁄
)

147 
HAL_ADC_RESOLUTION_8
:

148 
ªsbôs
 = 
HAL_ADC_DEC_064
;

150 
HAL_ADC_RESOLUTION_10
:

151 
ªsbôs
 = 
HAL_ADC_DEC_128
;

153 
HAL_ADC_RESOLUTION_12
:

154 
ªsbôs
 = 
HAL_ADC_DEC_256
;

156 
HAL_ADC_RESOLUTION_14
:

158 
ªsbôs
 = 
HAL_ADC_DEC_512
;

163 
ADCCON3
 = 
ch™√l
 | 
ªsbôs
 | 
adcRef
;

166 !(
ADCCON1
 & 
HAL_ADC_EOC
));

169 
ADCCFG
 &(
adcCh™√l
 ^ 0xFF);

172 
ªadög
 = (
öt16
Ë(
ADCL
);

173 
ªadög
 |(
öt16
Ë(
ADCH
 << 8);

176 i‡(
ªadög
 < 0)

177 
ªadög
 = 0;

179 
ªsﬁuti⁄
)

181 
HAL_ADC_RESOLUTION_8
:

182 
ªadög
 >>= 8;

184 
HAL_ADC_RESOLUTION_10
:

185 
ªadög
 >>= 6;

187 
HAL_ADC_RESOLUTION_12
:

188 
ªadög
 >>= 4;

190 
HAL_ADC_RESOLUTION_14
:

192 
ªadög
 >>= 2;

197 (Ë
ch™√l
;

198 (Ë
ªsﬁuti⁄
;

201  ((
uöt16
)
ªadög
);

202 
	}
}

214 
	$HÆAdcSëRe„ªn˚
 ( 
uöt8
 
ª„ªn˚
 )

216 #i‡(
HAL_ADC
 =
TRUE
)

217 
adcRef
 = 
ª„ªn˚
;

219 
	}
}

232 
boﬁ
 
	$HÆAdcCheckVdd
(
uöt8
 
vdd
)

234 
ADCCON3
 = 0x0F;

235 !(
ADCCON1
 & 0x80));

236  (
ADCH
 > 
vdd
);

237 
	}
}

	@Components/hal/target/CC2540USB/hal_aes.c

42 
	~"oßl.h
"

43 
	~"hÆ_´s.h
"

44 
	~"hÆ_dma.h
"

66 (*
pS•AesEn¸y±
)–
uöt8
 *, uöt8 * ) = (*)
NULL
;

71 
	`´sDmaInô
( );

73 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

85 
	$´sDmaInô
( )

87 
hÆDMADesc_t
 *
ch
;

90 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

91 
	`HAL_DMA_SET_DEST
–
ch
, 
HAL_AES_IN_ADDR
 );

92 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

93 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

94 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

95 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
HAL_DMA_TRIG_ENC_DW
 );

96 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_1
 );

97 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_0
 );

98 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

99 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

100 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

103 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_OUT
 );

104 
	`HAL_DMA_SET_SOURCE
–
ch
, 
HAL_AES_OUT_ADDR
 );

105 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

106 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

107 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

108 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
HAL_DMA_TRIG_ENC_UP
 );

109 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_0
 );

110 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_1
 );

111 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

112 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

113 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

114 
	}
}

117 #i‡(!
deföed
 
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

129 
	$AesLﬂdBlock
–
uöt8
 *
±r
 )

131 
uöt8
 
i
;

134 
	`AES_START
();

137 
i
 = 0; i < 
STATE_BLENGTH
; i++)

139 
ENCDI
 = *
±r
++;

141 
	}
}

155 
	$AesSèπBlock
–
uöt8
 *
out
, uöt8 *
ö
 )

157 
uöt8
 
i
;

160 
	`AES_START
();

163 
i
 = 0; i < 
STATE_BLENGTH
; i++)

165 
ENCDI
 = *
ö
++;

169 
	`HAL_AES_DELAY
();

172 
i
 = 0; i < 
STATE_BLENGTH
; i++)

174 *
out
++ = 
ENCDO
;

176 
	}
}

192 
	$AesSèπSh‹tBlock
–
uöt8
 *
out
, uöt8 *
ö
 )

194 
uöt8
 
i
, 
j
;

196 
	`AES_START
();

197 
i
 = 0; i < 4; i++)

200 
j
 = 0; j < 4; j++)

202 
ENCDI
 = *
ö
++;

206 
	`HAL_AES_DELAY
();

209 
j
 = 0; j < 4; j++)

211 *
out
++ = 
ENCDO
;

214 
	}
}

228 
	$AesLﬂdIV
–
uöt8
 *
IV
 )

230 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

231 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

234 
	`HAL_DMA_SET_SOURCE
–
ch
, 
IV
 );

235 
	`HAL_DMA_SET_LEN
–
ch
, 
STATE_BLENGTH
 );

238 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

239 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

241 
	`asm
("NOP");

242 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

245 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_IV
 );

248 
	`AES_START
();

249  !(
ENCCS
 & 0x08) );

252 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_IV
 );

255 
	`AesLﬂdBlock
–
IV
 );

257 
	}
}

270 
	$AesLﬂdKey
–
uöt8
 *
AesKey
 )

272 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

273 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

276 
	`HAL_DMA_SET_SOURCE
–
ch
, 
AesKey
 );

277 
	`HAL_DMA_SET_LEN
–
ch
, 
KEY_BLENGTH
 );

280 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

281 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

283 
	`asm
("NOP");

284 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

287 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_KEY
 );

290 
	`AES_START
();

291  !(
ENCCS
 & 0x08) );

294 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_KEY
 );

297 
	`AesLﬂdBlock
–
AesKey
 );

299 
	}
}

301 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

321 
	$AesDmaSëup
–
uöt8
 *
C°©e
, 
uöt16
 
msg_out_Àn
, uöt8 *
msg_ö
, uöt16 
msg_ö_Àn
 )

323 
hÆDMADesc_t
 *
ch
;

326 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

327 
	`HAL_DMA_SET_SOURCE
–
ch
, 
msg_ö
 );

328 
	`HAL_DMA_SET_LEN
–
ch
, 
msg_ö_Àn
 );

331 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_OUT
 );

332 
	`HAL_DMA_SET_DEST
–
ch
, 
C°©e
 );

333 
	`HAL_DMA_SET_LEN
–
ch
, 
msg_out_Àn
 );

336 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

337 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

339 
	`asm
("NOP");

340 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

341 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_OUT
 );

342 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_OUT
 );

344 
	`asm
("NOP");

345 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_OUT
));

346 
	}
}

360 
	$HÆAesInô
( )

362 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

364 
	`´sDmaInô
();

366 
	}
}

379 
	$s•_HW_KeyInô
–
uöt8
 *
AesKey
 )

381 
	`AES_SETMODE
(
ECB
);

382 
	`AesLﬂdKey
–
AesKey
 );

383 
	}
}

402 
	$s•AesEn¸y±HW
–
uöt8
 *
AesKey
, uöt8 *
C°©e
 )

404 ()
AesKey
;

406 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

408 
	`AesDmaSëup
–
C°©e
, 
STATE_BLENGTH
, Cstate, STATE_BLENGTH );

409 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_ENCRYPT
 );

412 
	`AES_START
();

413  !
	`HAL_DMA_CHECK_IRQ
–
HAL_DMA_AES_OUT
 ) );

416 
	`AES_SETMODE
(
ECB
);

417 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_ENCRYPT
 );

420 
	`AesSèπBlock
–
C°©e
, Cstate );

422 
	}
}

	@Components/hal/target/CC2540USB/hal_aes.h

39 #i‚de‡
HAL_AES_H_


40 
	#HAL_AES_H_


	)

42 
	~"hÆ_ty≥s.h
"

44 
	#STATE_BLENGTH
 16

45 
	#KEY_BLENGTH
 16

46 
	#KEY_EXP_LENGTH
 176

47 

	)

52 #i‡((
deföed
 
SOFTWARE_AES
Ë&& (SOFTWARE_AES =
TRUE
)Ë&& ((deföed 
SW_AES_AND_KEY_EXP
) && (SW_AES_AND_KEY_EXP == TRUE))

56 
HÆAesInô
( );

57 
AesLﬂdBlock
–
uöt8
 * );

58 
AesSèπBlock
–
uöt8
 *, uint8 * );

59 
AesSèπSh‹tBlock
–
uöt8
 *, uint8 * );

60 
AesLﬂdIV
(
uöt8
 *);

61 
AesDmaSëup
–
uöt8
 *, 
uöt16
, uint8 *, uint16 );

62 
AesLﬂdKey
–
uöt8
 * );

64 (*
pS•AesEn¸y±
)–
uöt8
 *, uint8 * );

65 
	`s•_HW_KeyInô
 (
uöt8
 *);

66 
	`s•KeyEx∑nsi⁄
 (
uöt8
 *, uint8 *);

68 
	`s•AesEn¸y±HW
 (
uöt8
 *, uint8 *);

69 
	`s•AesEn¸y±KeyExp
 (
uöt8
 *, uint8 *);

70 
	`s•AesEn¸y±Basic
 (
uöt8
 *, uint8 *);

72 
	`s•AesDe¸y±HW
–
uöt8
 *, uint8 * );

73 
	`s•AesDe¸y±
–
uöt8
 *
key
, uöt8 *
buf
 );

76 
	#AES_BUSY
 0x08

	)

77 
	#ENCRYPT
 0x00

	)

78 
	#DECRYPT
 0x01

	)

81 
	#AES_SETMODE
(
mode
) \

83 
ENCCS
 = (ENCCS & ~0x70Ë| (
mode
); \

84 
	}
} 0)

	)

87 
	#CBC
 0x00

	)

88 
	#CFB
 0x10

	)

89 
	#OFB
 0x20

	)

90 
	#CTR
 0x30

	)

91 
	#ECB
 0x40

	)

92 
	#CBC_MAC
 0x50

	)

95 
	#AES_SET_ENCR_DECR_KEY_IV
(
cmd
) \

97 
ENCCS
 = (ENCCS & ~0x07Ë| (
cmd
); \

98 } 0)

	)

101 
	#AES_ENCRYPT
 0x00

	)

102 
	#AES_DECRYPT
 0x02

	)

103 
	#AES_LOAD_KEY
 0x04

	)

104 
	#AES_LOAD_IV
 0x06

	)

108 
	#AES_START
(Ë
ENCCS
 |0x01

	)

111 
	#HAL_DMA_AES_IN
 1

	)

112 
	#HAL_DMA_AES_OUT
 2

	)

115 
	#HAL_AES_IN_ADDR
 0x70B1

	)

116 
	#HAL_AES_OUT_ADDR
 0x70B2

	)

118 #i‡!
deföed
 (
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

119 
	#HAL_AES_DELAY
() \

121 vﬁ©ûê
uöt8
 
dñay
 = 15; \

122 
dñay
--); \

123 } 0)

	)

	@Components/hal/target/CC2540USB/hal_board_cfg.h

42 #i‚de‡
HAL_BOARD_CFG_H


43 
	#HAL_BOARD_CFG_H


	)

45 #ifde‡
__˝lu•lus


55 
	~"hÆ_mcu.h
"

56 
	~"hÆ_defs.h
"

57 
	~"hÆ_ty≥s.h
"

58 
	~"usb_bﬂrd_cfg.h
"

66 
	#HAL_BOARD_CC2540USB


	)

70 
	#HAL_CPU_CLOCK_MHZ
 32

	)

74 
	#EXTERNAL_CRYSTAL_OSC
 0x00

75 
	#INTERNAL_RC_OSC
 0x80

76 

	)

78 #i‡!
deföed
 (
XOSC32K_INSTALLED
Ë|| (deföed (XOSC32K_INSTALLEDË&& (XOSC32K_INSTALLED =
FALSE
))

79 
	#OSC_32KHZ
 
INTERNAL_RC_OSC


	)

81 
	#OSC_32KHZ
 
EXTERNAL_CRYSTAL_OSC


	)

85 
	#MIN_TIME_TO_STABLE_32KHZ_XOSC
 400

	)

88 
	#HAL_LCD_MAX_CHARS
 16

	)

89 
	#HAL_LCD_MAX_BUFF
 25

	)

93 
	#HAL_NUM_LEDS
 2

	)

95 
	#HAL_LED_BLINK_DELAY
(Ë
	`°
–{ vﬁ©ûê
uöt32
 
i
; i=0; i<0x5800; i++Ë{ }; } )

	)

98 
	#LED1_BV
 
	`BV
(0)

	)

99 
	#LED1_SBIT
 
P0_0


	)

100 
	#LED1_DDR
 
P0DIR


	)

101 
	#LED1_POLARITY
 
ACTIVE_LOW


	)

104 
	#LED2_BV
 
	`BV
(1)

	)

105 
	#LED2_SBIT
 
P1_1


	)

106 
	#LED2_DDR
 
P1DIR


	)

107 
	#LED2_POLARITY
 
ACTIVE_HIGH


	)

111 
	#ACTIVE_LOW
 !

	)

112 
	#ACTIVE_HIGH
 !!

	)

115 
	#PUSH1_BV
 
	`BV
(2)

	)

116 
	#PUSH1_SBIT
 
P1_2


	)

117 
	#PUSH1_POLARITY
 
ACTIVE_LOW


	)

120 
	#PUSH2_BV
 
	`BV
(3)

	)

121 
	#PUSH2_SBIT
 
P1_3


	)

122 
	#PUSH2_POLARITY
 
ACTIVE_LOW


	)

127 
	#HAL_FLASH_PAGE_PER_BANK
 16

	)

130 
	#HAL_FLASH_PAGE_SIZE
 2048

	)

131 
	#HAL_FLASH_WORD_SIZE
 4

	)

134 
	#HAL_FLASH_PAGE_MAP
 0x8000

	)

137 
	#HAL_FLASH_LOCK_BITS
 16

	)

140 #i‡
deföed
 
NON_BANKED


141 
	#HAL_NV_PAGE_END
 30

	)

142 #ñi‡
deföed
 
FEATURE_UBL_MSD


143 
	#HAL_NV_PAGE_END
 121

	)

145 
	#HAL_NV_PAGE_END
 126

	)

149 
	#HAL_FLASH_IEEE_SIZE
 8

	)

150 
	#HAL_FLASH_IEEE_PAGE
 (
HAL_NV_PAGE_END
+1)

	)

151 
	#HAL_FLASH_IEEE_OSET
 (
HAL_FLASH_PAGE_SIZE
 - 
HAL_FLASH_LOCK_BITS
 - 
HAL_FLASH_IEEE_SIZE
)

	)

152 
	#HAL_INFOP_IEEE_OSET
 0xC

	)

154 
	#HAL_NV_PAGE_CNT
 2

	)

155 
	#HAL_NV_PAGE_BEG
 (
HAL_NV_PAGE_END
-
HAL_NV_PAGE_CNT
+1)

	)

158 
	#HAL_NV_DMA_CH
 0

	)

159 
	#HAL_DMA_CH_RX
 3

	)

160 
	#HAL_DMA_CH_TX
 4

	)

162 
	#HAL_NV_DMA_GET_DESC
(Ë
	`HAL_DMA_GET_DESC0
()

	)

163 
	#HAL_NV_DMA_SET_ADDR
(
a
Ë
	`HAL_DMA_SET_ADDR_DESC0
(◊))

	)

167 
	#HAL_USB_IMG_ADDR
 0x1800

	)

168 
	#HAL_USB_CRC_ADDR
 0x1890

	)

170 
	#HAL_USB_IMG_SIZE
 (0x40000 - 0x2000 - 0x3000)

	)

178 
	#PREFETCH_ENABLE
(Ë
	`°
–
FCTL
 = 0x08; )

	)

179 
	#PREFETCH_DISABLE
(Ë
	`°
–
FCTL
 = 0x04; )

	)

184 
	#SET_OSC_TO_HSOSC
() \

186 
CLKCONCMD
 = (CLKCONCMD & 0x80Ë| 
CLKCONCMD_16MHZ
; \

187  (
CLKCONSTA
 & ~0x80Ë!
CLKCONCMD_16MHZ
 ); \

188 }

	)

191 
	#SET_OSC_TO_XOSC
() \

193 
CLKCONCMD
 = (CLKCONCMD & 0x80Ë| 
CLKCONCMD_32MHZ
; \

194  (
CLKCONSTA
 & ~0x80Ë!
CLKCONCMD_32MHZ
 ); \

195 }

	)

198 
	#SET_32KHZ_OSC
() \

200 
CLKCONCMD
 = (CLKCONCMD & ~0x80Ë| 
OSC_32KHZ
; \

201  (
CLKCONSTA
 & 0x80Ë!
OSC_32KHZ
 ); \

202 }

	)

204 
	#START_HSOSC_XOSC
() \

206 
SLEEPCMD
 &~
OSC_PD
; \

207 !(
SLEEPSTA
 & 
XOSC_STB
)); \

208 }

	)

210 
	#STOP_HSOSC
() \

212 
SLEEPCMD
 |
OSC_PD
; \

213 }

	)

216 #i‡
deföed
 
HAL_USB_BOOT_CODE


217 
	#HAL_BOARD_INIT
() \

220 
	`START_HSOSC_XOSC
(); \

221 
	`SET_OSC_TO_HSOSC
(); \

222 
	`SET_32KHZ_OSC
(); \

223 
	`SET_OSC_TO_XOSC
(); \

224 
	`STOP_HSOSC
(); \

227 
	`HAL_USB_PULLUP_DISABLE
(); \

230 
	`PREFETCH_ENABLE
(); \

231 }

	)

234 
	#HAL_BOARD_INIT
() \

237 
	`START_HSOSC_XOSC
(); \

238 
	`SET_OSC_TO_HSOSC
(); \

239 
	`SET_32KHZ_OSC
(); \

240 
	`SET_OSC_TO_XOSC
(); \

241 
	`STOP_HSOSC
(); \

244 
	`PREFETCH_ENABLE
(); \

245 }

	)

250 
	#HAL_DEBOUNCE
(
ex¥
Ë{ 
i
; i=0; i<500; i++Ë{ i‡(!”x¥)Ëò0; } }

	)

254 
	#HAL_PUSH_BUTTON1
(Ë(
	`PUSH1_POLARITY
 (
PUSH1_SBIT
))

	)

255 
	#HAL_PUSH_BUTTON2
(Ë(
	`PUSH2_POLARITY
 (
PUSH2_SBIT
))

	)

256 
	#HAL_PUSH_BUTTON3
(Ë(0)

	)

257 
	#HAL_PUSH_BUTTON4
(Ë(0)

	)

258 
	#HAL_PUSH_BUTTON5
(Ë(0)

	)

259 
	#HAL_PUSH_BUTTON6
(Ë(0)

	)

263 
	#HAL_TURN_OFF_LED1
(Ë
	`°
–
LED1_SBIT
 = 
	`LED1_POLARITY
 (0); )

	)

264 
	#HAL_TURN_OFF_LED2
(Ë
	`°
–
LED2_SBIT
 = 
	`LED2_POLARITY
 (0); )

	)

265 
	#HAL_TURN_OFF_LED3
(Ë
	`HAL_TURN_OFF_LED1
()

	)

266 
	#HAL_TURN_OFF_LED4
(Ë
	`HAL_TURN_OFF_LED2
()

	)

268 
	#HAL_TURN_ON_LED1
(Ë
	`°
–
LED1_SBIT
 = 
	`LED1_POLARITY
 (1); )

	)

269 
	#HAL_TURN_ON_LED2
(Ë
	`°
–
LED2_SBIT
 = 
	`LED2_POLARITY
 (1); )

	)

270 
	#HAL_TURN_ON_LED3
(Ë
	`HAL_TURN_ON_LED1
()

	)

271 
	#HAL_TURN_ON_LED4
(Ë
	`HAL_TURN_ON_LED2
()

	)

273 
	#HAL_TOGGLE_LED1
(Ë
	`°
–i‡(
LED1_SBIT
Ë{ LED1_SBIT = 0; } { LED1_SBIT = 1;} )

	)

274 
	#HAL_TOGGLE_LED2
(Ë
	`°
–i‡(
LED2_SBIT
Ë{ LED2_SBIT = 0; } { LED2_SBIT = 1;} )

	)

275 
	#HAL_TOGGLE_LED3
(Ë
	`HAL_TOGGLE_LED1
()

	)

276 
	#HAL_TOGGLE_LED4
(Ë
	`HAL_TOGGLE_LED2
()

	)

278 
	#HAL_STATE_LED1
(Ë(
	`LED1_POLARITY
 (
LED1_SBIT
))

	)

279 
	#HAL_STATE_LED2
(Ë(
	`LED2_POLARITY
 (
LED2_SBIT
))

	)

280 
	#HAL_STATE_LED3
(Ë
	`HAL_STATE_LED1
()

	)

281 
	#HAL_STATE_LED4
(Ë
	`HAL_STATE_LED2
()

	)

286 #i‚de‡
HAL_TIMER


287 
	#HAL_TIMER
 
FALSE


	)

291 #i‚de‡
HAL_ADC


292 
	#HAL_ADC
 
TRUE


	)

296 #i‚de‡
HAL_DMA


297 
	#HAL_DMA
 
TRUE


	)

301 #i‚de‡
HAL_FLASH


302 
	#HAL_FLASH
 
TRUE


	)

306 #i‚de‡
HAL_AES


307 
	#HAL_AES
 
TRUE


	)

310 #i‚de‡
HAL_AES_DMA


311 
	#HAL_AES_DMA
 
TRUE


	)

315 #i‚de‡
HAL_LCD


316 
	#HAL_LCD
 
FALSE


	)

320 #i‚de‡
HAL_LED


321 
	#HAL_LED
 
TRUE


	)

323 #i‡(!
deföed
 
BLINK_LEDS
Ë&& (
HAL_LED
 =
TRUE
)

324 
	#BLINK_LEDS


	)

328 #i‚de‡
HAL_KEY


329 
	#HAL_KEY
 
TRUE


	)

333 #i‚de‡
HAL_UART


334 
	#HAL_UART
 
TRUE


	)

335 
	#HAL_UART_DMA
 0

	)

336 
	#HAL_UART_ISR
 0

	)

337 
	#HAL_UART_USB
 1

	)

340 #i‚de‡
HAL_UART_DMA


341 
	#HAL_UART_DMA
 0

	)

343 #i‚de‡
HAL_UART_ISR


344 
	#HAL_UART_ISR
 0

	)

347 #i‚de‡
HAL_UART_USB


348 #i‡
HAL_UART


349 
	#HAL_UART_USB
 1

	)

351 
	#HAL_UART_USB
 0

	)

356 #i‚de‡
HAL_HID


357 
	#HAL_HID
 
FALSE


	)

360 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2540USB/hal_crc.c

45 
	~"hÆ_bﬂrd.h
"

46 
	~"hÆ_¸c.h
"

47 
	~"hÆ_ty≥s.h
"

64 
uöt16
 
	$HÆCRCCÆc
()

66 
uöt16
 
¸c
 = 
RNDH
;

67 
¸c
 = (¸¯<< 8Ë| 
RNDL
;

69  
¸c
;

70 
	}
}

87 
	$HÆCRCExec
(
uöt8
 
ch
)

89 
RNDH
 = 
ch
;

90 
	}
}

107 
	$HÆCRCInô
(
uöt16
 
£ed
)

109 
ADCCON1
 &= 0xF3;

111 
RNDL
 = 
	`HI_UINT16
(
£ed
);

112 
RNDL
 = 
	`LO_UINT16
(
£ed
);

113 
	}
}

	@Components/hal/target/CC2540USB/hal_crc.h

39 #i‚de‡
HAL_CRC_H


40 
	#HAL_CRC_H


	)

47 
	~"hÆ_ty≥s.h
"

64 
uöt16
 
HÆCRCCÆc
();

81 
HÆCRCExec
(
uöt8
 
ch
);

98 
HÆCRCInô
(
uöt16
 
£ed
);

	@Components/hal/target/CC2540USB/hal_dma.c

44 
	~"hÆ_dma.h
"

45 
	~"hÆ_mcu.h
"

46 
	~"hÆ_ty≥s.h
"

47 
	~"hÆ_u¨t.h
"

49 #i‡(
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)

50 
	~"hÆ_úgí.h
"

53 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

59 
hÆDMADesc_t
 
	gdmaCh0
;

60 
hÆDMADesc_t
 
	gdmaCh1234
[4];

71 
	$HÆDmaInô
( )

73 
	`HAL_DMA_SET_ADDR_DESC0
–&
dmaCh0
 );

74 
	`HAL_DMA_SET_ADDR_DESC1234
–
dmaCh1234
 );

75 #i‡(
HAL_UART_DMA
 || \

76 ((
deföed
 
HAL_UART_SPI
) && (HAL_UART_SPI != 0)) || \

77 ((
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)))

78 
DMAIE
 = 1;

80 
	}
}

82 #i‡(
HAL_UART_DMA
 || \

83 ((
deföed
 
	gHAL_UART_SPI
) && (HAL_UART_SPI != 0)) || \

84 ((
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)))

94 
	$HAL_ISR_FUNCTION
–
hÆDmaI§
, 
DMA_VECTOR
 )

96 
	`HAL_ENTER_ISR
();

98 
DMAIF
 = 0;

100 #i‡(((
deföed
 
HAL_UART_DMA
) && (HAL_UART_DMA != 0)) || \

101 ((
deföed
 
HAL_UART_SPI
) && (HAL_UART_SPI != 0)))

102 i‡(
	`HAL_DMA_CHECK_IRQ
(
HAL_DMA_CH_TX
))

104 
	`HAL_DMA_CLEAR_IRQ
(
HAL_DMA_CH_TX
);

105 
	`HÆUARTI§DMA
();

106 
	`HÆUARTI§DMA
();

110 #i‡(
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)

111 i‡–
HAL_IRGEN
 =
TRUE
 && 
	`HAL_DMA_CHECK_IRQ
–
HAL_IRGEN_DMA_CH
 ) )

113 
	`HAL_DMA_CLEAR_IRQ
–
HAL_IRGEN_DMA_CH
 );

114 
	`HÆIrGíDmaI§
();

118 
	`CLEAR_SLEEP_MODE
();

119 
	`HAL_EXIT_ISR
();

122 
	}
}

	@Components/hal/target/CC2540USB/hal_dma.h

40 #i‚de‡
HAL_DMA_H


41 
	#HAL_DMA_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"hÆ_bﬂrd.h
"

53 
	~"hÆ_ty≥s.h
"

55 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

61 
	#HAL_DMA_SET_ADDR_DESC0
–
a
 ) \

62 
	`°
( \

63 
DMA0CFGH
 = (
uöt8
)–(
uöt16
)(
a
) >> 8 ); \

64 
DMA0CFGL
 = (
uöt8
)–(
uöt16
)(
a
) & 0xFF ); \

65 )

	)

67 
	#HAL_DMA_SET_ADDR_DESC1234
–
a
 ) \

68 
	`°
( \

69 
DMA1CFGH
 = (
uöt8
)–(
uöt16
)(
a
) >> 8 ); \

70 
DMA1CFGL
 = (
uöt8
)–(
uöt16
)(
a
) & 0xFF); \

71 )

	)

73 
	#HAL_DMA_GET_DESC0
(Ë&
dmaCh0


	)

75 
	#HAL_DMA_GET_DESC1234
–
a
 ) (
dmaCh1234
+(◊)-1))

	)

77 
	#HAL_DMA_ARM_CH
–
ch
 ) 
DMAARM
 = (0x01 << (ch))

	)

79 
	#HAL_DMA_CH_ARMED
–
ch
 ) (
DMAARM
 & (0x01 << (ch)))

	)

81 
	#HAL_DMA_ABORT_CH
–
ch
 ) 
DMAARM
 = (0x80 | (0x01 << (ch)))

	)

82 
	#HAL_DMA_MAN_TRIGGER
–
ch
 ) 
DMAREQ
 = (0x01 << (ch))

	)

83 
	#HAL_DMA_START_CH
–
ch
 ) 
	`HAL_DMA_MAN_TRIGGER
–(chË)

	)

85 
	#HAL_DMA_CLEAR_IRQ
–
ch
 ) 
DMAIRQ
 &~–1 << (chË)

	)

87 
	#HAL_DMA_CHECK_IRQ
–
ch
 ) (
DMAIRQ
 & ( 1 << (chË))

	)

90 
	#HAL_DMA_SET_SOURCE
–
pDesc
, 
§c
 ) \

91 
	`°
( \

92 
pDesc
->
§cAddrH
 = (
uöt8
)((
uöt16
)(
§c
) >> 8); \

93 
pDesc
->
§cAddrL
 = (
uöt8
)((
uöt16
)(
§c
) & 0xFF); \

94 )

	)

97 
	#HAL_DMA_SET_DEST
–
pDesc
, 
d°
 ) \

98 
	`°
( \

99 
pDesc
->
d°AddrH
 = (
uöt8
)((
uöt16
)(
d°
) >> 8); \

100 
pDesc
->
d°AddrL
 = (
uöt8
)((
uöt16
)(
d°
) & 0xFF); \

101 )

	)

105 
	#HAL_DMA_SET_LEN
–
pDesc
, 
Àn
 ) \

106 
	`°
( \

107 
pDesc
->
x„rLíL
 = (
uöt8
)(
uöt16
)(
Àn
); \

108 
pDesc
->
x„rLíV
 &~
HAL_DMA_LEN_H
; \

109 
pDesc
->
x„rLíV
 |(
uöt8
)((
uöt16
)(
Àn
) >> 8); \

110 )

	)

112 
	#HAL_DMA_GET_LEN
–
pDesc
 ) \

113 (((
uöt16
)(
pDesc
->
x„rLíV
 & 
HAL_DMA_LEN_H
Ë<< 8Ë|ÖDesc->
x„rLíL
)

	)

115 
	#HAL_DMA_SET_VLEN
–
pDesc
, 
vMode
 ) \

116 
	`°
( \

117 
pDesc
->
x„rLíV
 &~
HAL_DMA_LEN_V
; \

118 
pDesc
->
x„rLíV
 |(
vMode
 << 5); \

119 )

	)

121 
	#HAL_DMA_SET_WORD_SIZE
–
pDesc
, 
xSz
 ) \

122 
	`°
( \

123 
pDesc
->
˘æA
 &~
HAL_DMA_WORD_SIZE
; \

124 
pDesc
->
˘æA
 |(
xSz
 << 7); \

125 )

	)

127 
	#HAL_DMA_SET_TRIG_MODE
–
pDesc
, 
tMode
 ) \

128 
	`°
( \

129 
pDesc
->
˘æA
 &~
HAL_DMA_TRIG_MODE
; \

130 
pDesc
->
˘æA
 |(
tMode
 << 5); \

131 )

	)

133 
	#HAL_DMA_GET_TRIG_MODE
–
pDesc
 ) (’Desc->
˘æA
 >> 5Ë& 0x3)

	)

135 
	#HAL_DMA_SET_TRIG_SRC
–
pDesc
, 
tSrc
 ) \

136 
	`°
( \

137 
pDesc
->
˘æA
 &~
HAL_DMA_TRIG_SRC
; \

138 
pDesc
->
˘æA
 |
tSrc
; \

139 )

	)

141 
	#HAL_DMA_SET_SRC_INC
–
pDesc
, 
§cInc
 ) \

142 
	`°
( \

143 
pDesc
->
˘æB
 &~
HAL_DMA_SRC_INC
; \

144 
pDesc
->
˘æB
 |(
§cInc
 << 6); \

145 )

	)

147 
	#HAL_DMA_SET_DST_INC
–
pDesc
, 
d°Inc
 ) \

148 
	`°
( \

149 
pDesc
->
˘æB
 &~
HAL_DMA_DST_INC
; \

150 
pDesc
->
˘æB
 |(
d°Inc
 << 4); \

151 )

	)

153 
	#HAL_DMA_SET_IRQ
–
pDesc
, 
íabÀ
 ) \

154 
	`°
( \

155 
pDesc
->
˘æB
 &~
HAL_DMA_IRQ_MASK
; \

156 
pDesc
->
˘æB
 |(
íabÀ
 << 3); \

157 )

	)

159 
	#HAL_DMA_SET_M8
–
pDesc
, 
m8
 ) \

160 
	`°
( \

161 
pDesc
->
˘æB
 &~
HAL_DMA_M8
; \

162 
pDesc
->
˘æB
 |(
m8
 << 2); \

163 )

	)

165 
	#HAL_DMA_SET_PRIORITY
–
pDesc
, 
¥i
 ) \

166 
	`°
( \

167 
pDesc
->
˘æB
 &~
HAL_DMA_PRIORITY
; \

168 
pDesc
->
˘æB
 |
¥i
; \

169 )

	)

176 
	#HAL_DMA_VLEN_USE_LEN
 0x00

	)

178 
	#HAL_DMA_VLEN_1_P_VALOFFIRST
 0x01

	)

180 
	#HAL_DMA_VLEN_VALOFFIRST
 0x02

	)

182 
	#HAL_DMA_VLEN_1_P_VALOFFIRST_P_1
 0x03

	)

184 
	#HAL_DMA_VLEN_1_P_VALOFFIRST_P_2
 0x04

	)

186 
	#HAL_DMA_WORDSIZE_BYTE
 0x00

	)

187 
	#HAL_DMA_WORDSIZE_WORD
 0x01

	)

189 
	#HAL_DMA_TMODE_SINGLE
 0x00

	)

190 
	#HAL_DMA_TMODE_BLOCK
 0x01

	)

191 
	#HAL_DMA_TMODE_SINGLE_REPEATED
 0x02

	)

192 
	#HAL_DMA_TMODE_BLOCK_REPEATED
 0x03

	)

194 
	#HAL_DMA_TRIG_NONE
 0

	)

195 
	#HAL_DMA_TRIG_PREV
 1

	)

196 
	#HAL_DMA_TRIG_T1_CH0
 2

	)

197 
	#HAL_DMA_TRIG_T1_CH1
 3

	)

198 
	#HAL_DMA_TRIG_T1_CH2
 4

	)

199 
	#HAL_DMA_TRIG_T2_COMP
 5

	)

200 
	#HAL_DMA_TRIG_T2_OVFL
 6

	)

201 
	#HAL_DMA_TRIG_T3_CH0
 7

	)

202 
	#HAL_DMA_TRIG_T3_CH1
 8

	)

203 
	#HAL_DMA_TRIG_T4_CH0
 9

	)

204 
	#HAL_DMA_TRIG_T4_CH1
 10

	)

205 
	#HAL_DMA_TRIG_ST
 11

	)

206 
	#HAL_DMA_TRIG_IOC_0
 12

	)

207 
	#HAL_DMA_TRIG_IOC_1
 13

	)

208 
	#HAL_DMA_TRIG_URX0
 14

	)

209 
	#HAL_DMA_TRIG_UTX0
 15

	)

210 
	#HAL_DMA_TRIG_URX1
 16

	)

211 
	#HAL_DMA_TRIG_UTX1
 17

	)

212 
	#HAL_DMA_TRIG_FLASH
 18

	)

213 
	#HAL_DMA_TRIG_RADIO
 19

	)

214 
	#HAL_DMA_TRIG_ADC_CHALL
 20

	)

215 
	#HAL_DMA_TRIG_ADC_CH0
 21

	)

216 
	#HAL_DMA_TRIG_ADC_CH1
 22

	)

217 
	#HAL_DMA_TRIG_ADC_CH2
 23

	)

218 
	#HAL_DMA_TRIG_ADC_CH3
 24

	)

219 
	#HAL_DMA_TRIG_ADC_CH4
 25

	)

220 
	#HAL_DMA_TRIG_ADC_CH5
 26

	)

221 
	#HAL_DMA_TRIG_ADC_CH6
 27

	)

222 
	#HAL_DMA_TRIG_ADC_CH7
 28

	)

223 
	#HAL_DMA_TRIG_ENC_DW
 29

	)

224 
	#HAL_DMA_TRIG_ENC_UP
 30

	)

226 
	#HAL_DMA_SRCINC_0
 0x00

	)

227 
	#HAL_DMA_SRCINC_1
 0x01

	)

228 
	#HAL_DMA_SRCINC_2
 0x02

	)

229 
	#HAL_DMA_SRCINC_M1
 0x03

	)

231 
	#HAL_DMA_DSTINC_0
 0x00

	)

232 
	#HAL_DMA_DSTINC_1
 0x01

	)

233 
	#HAL_DMA_DSTINC_2
 0x02

	)

234 
	#HAL_DMA_DSTINC_M1
 0x03

	)

236 
	#HAL_DMA_IRQMASK_DISABLE
 0x00

	)

237 
	#HAL_DMA_IRQMASK_ENABLE
 0x01

	)

239 
	#HAL_DMA_M8_USE_8_BITS
 0x00

	)

240 
	#HAL_DMA_M8_USE_7_BITS
 0x01

	)

242 
	#HAL_DMA_PRI_LOW
 0x00

	)

243 
	#HAL_DMA_PRI_GUARANTEED
 0x01

	)

244 
	#HAL_DMA_PRI_HIGH
 0x02

	)

245 
	#HAL_DMA_PRI_ABSOLUTE
 0x03

	)

247 
	#HAL_DMA_MAX_ARM_CLOCKS
 45

248 

	)

254 
	#HAL_DMA_LEN_V
 0xE0

	)

255 
	#HAL_DMA_LEN_H
 0x1F

	)

258 
	#HAL_DMA_WORD_SIZE
 0x80

	)

259 
	#HAL_DMA_TRIG_MODE
 0x60

	)

260 
	#HAL_DMA_TRIG_SRC
 0x1F

	)

263 
	#HAL_DMA_SRC_INC
 0xC0

	)

264 
	#HAL_DMA_DST_INC
 0x30

	)

265 
	#HAL_DMA_IRQ_MASK
 0x08

	)

266 
	#HAL_DMA_M8
 0x04

	)

267 
	#HAL_DMA_PRIORITY
 0x03

	)

270 
uöt8
 
§cAddrH
;

271 
uöt8
 
§cAddrL
;

272 
uöt8
 
d°AddrH
;

273 
uöt8
 
d°AddrL
;

274 
uöt8
 
x„rLíV
;

275 
uöt8
 
x„rLíL
;

276 
uöt8
 
˘æA
;

277 
uöt8
 
˘æB
;

278 } 
	thÆDMADesc_t
;

284 
hÆDMADesc_t
 
dmaCh0
;

285 
hÆDMADesc_t
 
dmaCh1234
[4];

291 
HÆDmaInô
( );

295 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2540USB/hal_flash.c

45 
	~"hÆ_bﬂrd_cfg.h
"

46 
	~"hÆ_dma.h
"

47 
	~"hÆ_Êash.h
"

48 
	~"hÆ_ty≥s.h
"

69 
	$HÆFœshRód
(
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
buf
, uöt16 
˙t
)

72 
uöt8
 *
±r
 = (uöt8 *)(
off£t
 + 
HAL_FLASH_PAGE_MAP
) +

73 ((
pg
 % 
HAL_FLASH_PAGE_PER_BANK
Ë* 
HAL_FLASH_PAGE_SIZE
);

74 
uöt8
 
mem˘r
 = 
MEMCTR
;

76 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


77 
hÆI¡Sèã_t
 
is
;

80 
pg
 /
HAL_FLASH_PAGE_PER_BANK
;

82 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


83 
	`HAL_ENTER_CRITICAL_SECTION
(
is
);

87 
MEMCTR
 = (MEMCTR & 0xF8Ë| 
pg
;

89 
˙t
--)

91 *
buf
++ = *
±r
++;

94 
MEMCTR
 = 
mem˘r
;

96 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


97 
	`HAL_EXIT_CRITICAL_SECTION
(
is
);

99 
	}
}

119 
	$HÆFœshWrôe
(
uöt16
 
addr
, 
uöt8
 *
buf
, uöt16 
˙t
)

121 #i‡(
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
)

122 
hÆDMADesc_t
 *
ch
 = 
	`HAL_NV_DMA_GET_DESC
();

124 
	`HAL_DMA_SET_SOURCE
(
ch
, 
buf
);

125 
	`HAL_DMA_SET_DEST
(
ch
, &
FWDATA
);

126 
	`HAL_DMA_SET_VLEN
(
ch
, 
HAL_DMA_VLEN_USE_LEN
);

127 
	`HAL_DMA_SET_LEN
(
ch
, (
˙t
 * 
HAL_FLASH_WORD_SIZE
));

128 
	`HAL_DMA_SET_WORD_SIZE
(
ch
, 
HAL_DMA_WORDSIZE_BYTE
);

129 
	`HAL_DMA_SET_TRIG_MODE
(
ch
, 
HAL_DMA_TMODE_SINGLE
);

130 
	`HAL_DMA_SET_TRIG_SRC
(
ch
, 
HAL_DMA_TRIG_FLASH
);

131 
	`HAL_DMA_SET_SRC_INC
(
ch
, 
HAL_DMA_SRCINC_1
);

132 
	`HAL_DMA_SET_DST_INC
(
ch
, 
HAL_DMA_DSTINC_0
);

134 
	`HAL_DMA_SET_IRQ
(
ch
, 
HAL_DMA_IRQMASK_DISABLE
);

135 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
);

136 
	`HAL_DMA_SET_PRIORITY
(
ch
, 
HAL_DMA_PRI_HIGH
);

137 
	`HAL_DMA_CLEAR_IRQ
(
HAL_NV_DMA_CH
);

138 
	`HAL_DMA_ARM_CH
(
HAL_NV_DMA_CH
);

140 
FADDRL
 = (
uöt8
)
addr
;

141 
FADDRH
 = (
uöt8
)(
addr
 >> 8);

142 
FCTL
 |= 0x02;

143 
FCTL
 & 0x80);

145 
	}
}

163 
	$HÆFœshEø£
(
uöt8
 
pg
)

165 
FADDRH
 = 
pg
 * (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
 / 256);

166 
FCTL
 |= 0x01;

167 
	}
}

	@Components/hal/target/CC2540USB/hal_key.c

45 
	~"hÆ_bﬂrd.h
"

46 
	~"hÆ_drivîs.h
"

47 
	~"hÆ_key.h
"

48 
	~"hÆ_ty≥s.h
"

49 
	~"oßl.h
"

50 
	~"usb_öãºu±.h
"

52 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

59 
	#HAL_KEY_CLR_INT
() \

60 
	`°
 ( \

62 
P1IFG
 = 0; \

63 
P1IF
 = 0; \

64 )

	)

81 
uöt8
 
	gHÆ_KeyI¡E«bÀ
;

93 
hÆKeyCBack_t
 
	gpHÆKeyPro˚ssFun˘i⁄
;

94 vﬁ©ûê
uöt8
 
	gi§Keys
;

95 
uöt8
 
	ghÆKeys
;

118 
	$HÆKeyInô
()

120 
	}
}

139 
	$HÆKeyC⁄fig
(
boﬁ
 
öãºu±E«bÀ
, 
hÆKeyCBack_t
 
cback
)

141 i‡((
HÆ_KeyI¡E«bÀ
 = 
öãºu±E«bÀ
))

143 
	`HAL_KEY_CLR_INT
();

144 
PICTL
 |= 0x01;

145 
P1IEN
 |
PUSH1_BV
 | 
PUSH2_BV
;

146 
IEN2
 |= 0x10;

150 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_KEY_EVENT
);

153 
pHÆKeyPro˚ssFun˘i⁄
 = 
cback
;

154 
	}
}

172 
	$HÆKeyPﬁl
()

174 
uöt8
 
√wKeys
;

176 i‡(
HÆ_KeyI¡E«bÀ
)

178 
hÆI¡Sèã_t
 
ötSèã
;

179 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

180 
√wKeys
 = 
i§Keys
;

181 
i§Keys
 = 0;

182 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

186 
uöt8
 
keys
 = 
	`HÆKeyRód
();

187 
√wKeys
 = (
hÆKeys
 ^ 
keys
) & keys;

188 
hÆKeys
 = 
keys
;

191 i‡(
√wKeys
 && 
pHÆKeyPro˚ssFun˘i⁄
)

193 (
pHÆKeyPro˚ssFun˘i⁄
)(
√wKeys
, 
HAL_KEY_STATE_NORMAL
);

195 
	}
}

213 
uöt8
 
	$HÆKeyRód
()

215 
uöt8
 
keys
 = 0;

217 i‡(
	`HAL_PUSH_BUTTON1
())

219 
keys
 |
HAL_KEY_SW_1
;

222 i‡(
	`HAL_PUSH_BUTTON2
())

224 
keys
 |
HAL_KEY_SW_2
;

227  
keys
;

228 
	}
}

239 
	$HÆKeyE¡îSÀï
 ( )

241 
	}
}

252 
uöt8
 
	$HÆKeyExôSÀï
 ( )

255  ( 
	`HÆKeyRód
 () );

256 
	}
}

274 
	$HAL_ISR_FUNCTION
–
usbKeyISR
, 
P1INT_VECTOR
 )

276 
	`HAL_ENTER_ISR
();

278 i‡(
P1IFG
 & 
PUSH1_BV
)

280 
i§Keys
 |
HAL_KEY_SW_1
;

283 i‡(
P1IFG
 & 
PUSH2_BV
)

285 
i§Keys
 |
HAL_KEY_SW_2
;

288 
	`HAL_KEY_CLR_INT
();

289 ()
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_KEY_EVENT
);

291 
	`CLEAR_SLEEP_MODE
();

293 
	`HAL_EXIT_ISR
();

296 
	}
}

300 
	$HÆKeyInô
(){
	}
}

301 
	$HÆKeyC⁄fig
(
boﬁ
 
öãºu±E«bÀ
, 
hÆKeyCBack_t
 
cback
){
	}
}

302 
uöt8
 
	$HÆKeyRód
(){  0;
	}
}

303 
	$HÆKeyPﬁl
(){
	}
}

	@Components/hal/target/CC2540USB/hal_lcd.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"hÆ_lcd.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_as£π.h
"

49 #i‡
deföed
 (
ZTOOL_P1
Ë|| deföed (
ZTOOL_P2
)

50 
	~"DebugTø˚.h
"

71 
	#HAL_LCD_MAX_CHARS
 16

	)

72 
	#HAL_LCD_MAX_BUFF
 25

	)

75 
	#HAL_LCD_MODE_PORT
 0

	)

76 
	#HAL_LCD_MODE_PIN
 0

	)

78 
	#HAL_LCD_RESET_PORT
 1

	)

79 
	#HAL_LCD_RESET_PIN
 1

	)

81 
	#HAL_LCD_CS_PORT
 1

	)

82 
	#HAL_LCD_CS_PIN
 2

	)

85 
	#HAL_LCD_CLK_PORT
 1

	)

86 
	#HAL_LCD_CLK_PIN
 5

	)

88 
	#HAL_LCD_MOSI_PORT
 1

	)

89 
	#HAL_LCD_MOSI_PIN
 6

	)

91 
	#HAL_LCD_MISO_PORT
 1

	)

92 
	#HAL_LCD_MISO_PIN
 7

	)

95 
	#HAL_SPI_CLOCK_POL_LO
 0x00

	)

96 
	#HAL_SPI_CLOCK_PHA_0
 0x00

	)

97 
	#HAL_SPI_TRANSFER_MSB_FIRST
 0x20

	)

100 
	#LCD_MAX_LINE_COUNT
 3

	)

105 
	#OSC_OFF
 0x00

	)

106 
	#OSC_ON
 0x01

	)

107 
	#POWER_SAVE_OFF
 0x00

	)

108 
	#POWER_SAVE_ON
 0x02

	)

109 
	#SET_POWER_SAVE_MODE
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x0C | (›ti⁄s))

	)

112 
	#CGROM
 0x00

	)

113 
	#CGRAM
 0x01

	)

114 
	#COM_FORWARD
 0x00

	)

115 
	#COM_BACKWARD
 0x02

	)

116 
	#TWO_LINE
 0x00

	)

117 
	#THREE_LINE
 0x04

	)

118 
	#FUNCTION_SET
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x10 | (›ti⁄s))

	)

121 
	#LINE1
 0x00

	)

122 
	#LINE2
 0x01

	)

123 
	#LINE3
 0x02

	)

124 
	#LINE4
 0x03

	)

125 
	#SET_DISPLAY_START_LINE
(
löe
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x18 | (löe))

	)

128 
	#BIAS_1_5
 0x00

	)

129 
	#BIAS_1_4
 0x01

	)

130 
	#SET_BIAS_CTRL
(
büs
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x1C | (büs))

	)

133 
	#VOLTAGE_DIVIDER_OFF
 0x00

	)

134 
	#VOLTAGE_DIVIDER_ON
 0x01

	)

135 
	#CONVERTER_AND_REG_OFF
 0x00

	)

136 
	#CONVERTER_AND_REG_ON
 0x04

	)

137 
	#SET_POWER_CTRL
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x20 | (›ti⁄s))

	)

140 
	#DISPLAY_CTRL_ON
 0x01

	)

141 
	#DISPLAY_CTRL_OFF
 0x00

	)

142 
	#DISPLAY_CTRL_BLINK_ON
 0x02

	)

143 
	#DISPLAY_CTRL_BLINK_OFF
 0x00

	)

144 
	#DISPLAY_CTRL_CURSOR_ON
 0x04

	)

145 
	#DISPLAY_CTRL_CURSOR_OFF
 0x00

	)

146 
	#SET_DISPLAY_CTRL
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x28 | (›ti⁄s))

	)

149 
	#SET_DDRAM_ADDR
(
ch¨Index
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x80 | (ch¨Index))

	)

150 
	#SET_GCRAM_CHAR
(
•ecIndex
Ë
	`HÆLcd_HW_C⁄åﬁ
(0xC0 | (•ecIndex))

	)

153 
	#CONTRAST_CTRL_REGISTER
 0x10

	)

154 
	#SET_ICONRAM_ADDR
(
addr
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x40 | (addr))

	)

157 
	#LINE_1_AND_2
 0x01

	)

158 
	#LINE_2_AND_3
 0x02

	)

159 
	#NORMAL_DISPLAY
 0x00

	)

160 
	#SET_DOUBLE_HEIGHT
(
›ti⁄s
Ë
	`HÆLcd_HW_C⁄åﬁ
(0x08 | (›ti⁄s))

	)

166 
	#HAL_IO_SET
(
p‹t
, 
pö
, 
vÆ
Ë
	`HAL_IO_SET_PREP
’‹t,Öö, vÆ)

	)

167 
	#HAL_IO_SET_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
_
##pö## = vÆ; )

	)

169 
	#HAL_CONFIG_IO_OUTPUT
(
p‹t
, 
pö
, 
vÆ
Ë
	`HAL_CONFIG_IO_OUTPUT_PREP
’‹t,Öö, vÆ)

	)

170 
	#HAL_CONFIG_IO_OUTPUT_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
SEL
 &~
	`BV
(pin); \

171 
P
##
p‹t
##
_
##
pö
## = 
vÆ
; \

172 
P
##
p‹t
##
DIR
 |
	`BV
(
pö
); )

	)

174 
	#HAL_CONFIG_IO_PERIPHERAL
(
p‹t
, 
pö
Ë
	`HAL_CONFIG_IO_PERIPHERAL_PREP
’‹t,Öö)

	)

175 
	#HAL_CONFIG_IO_PERIPHERAL_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
SEL
 |
	`BV
’ö); )

	)

180 
	#LCD_SPI_BEGIN
(Ë
	`HAL_IO_SET
(
HAL_LCD_CS_PORT
, 
HAL_LCD_CS_PIN
, 0);

	)

181 
	#LCD_SPI_END
() \

183 
	`asm
("NOP"); \

184 
	`asm
("NOP"); \

185 
	`asm
("NOP"); \

186 
	`asm
("NOP"); \

187 
	`HAL_IO_SET
(
HAL_LCD_CS_PORT
, 
HAL_LCD_CS_PIN
, 1); \

188 }

	)

190 
	#LCD_SPI_TX
(
x
Ë{ 
U1CSR
 &~(
	`BV
(2Ë| BV(1)); 
U1DBUF
 = x;  !(U1CSR & BV(1)Ë); }

	)

191 
	#LCD_SPI_WAIT_RXRDY
(Ë{ !(
U1CSR
 & 
	`BV
(1))); }

	)

195 
	#LCD_DO_WRITE
(Ë
	`HAL_IO_SET
(
HAL_LCD_MODE_PORT
, 
HAL_LCD_MODE_PIN
, 1);

	)

196 
	#LCD_DO_CONTROL
(Ë
	`HAL_IO_SET
(
HAL_LCD_MODE_PORT
, 
HAL_LCD_MODE_PIN
, 0);

	)

198 
	#LCD_ACTIVATE_RESET
(Ë
	`HAL_IO_SET
(
HAL_LCD_RESET_PORT
, 
HAL_LCD_RESET_PIN
, 0);

	)

199 
	#LCD_RELEASE_RESET
(Ë
	`HAL_IO_SET
(
HAL_LCD_RESET_PORT
, 
HAL_LCD_RESET_PIN
, 1);

	)

205 #i‡(
HAL_LCD
 =
TRUE
)

206 
uöt8
 *
	gLcd_Löe1
;

212 #i‡(
HAL_LCD
 =
TRUE
)

213 
HÆLcd_HW_Inô
();

214 
HÆLcd_HW_WaôUs
(
uöt16
 
i
);

215 
HÆLcd_HW_CÀ¨
();

216 
HÆLcd_HW_CÀ¨AŒS≥cCh¨s
();

217 
HÆLcd_HW_C⁄åﬁ
(
uöt8
 
cmd
);

218 
HÆLcd_HW_Wrôe
(
uöt8
 
d©a
);

219 
HÆLcd_HW_SëC⁄åa°
(
uöt8
 
vÆue
);

220 
HÆLcd_HW_WrôeCh¨
(
uöt8
 
löe
, uöt8 
cﬁ
, 
ãxt
);

221 
HÆLcd_HW_WrôeLöe
(
uöt8
 
löe
, c⁄° *
pText
);

233 
	$HÆLcdInô
()

235 #i‡(
HAL_LCD
 =
TRUE
)

236 
Lcd_Löe1
 = 
NULL
;

237 
	`HÆLcd_HW_Inô
();

239 
	}
}

269 
	$HÆLcdWrôeSåög
 ( *
°r
, 
uöt8
 
›ti⁄
)

271 #i‡(
HAL_LCD
 =
TRUE
)

273 
uöt8
 
°rLí
 = 0;

274 
uöt8
 
tŸÆLí
 = 0;

275 
uöt8
 *
buf
;

276 
uöt8
 
tmpLí
;

278 i‡–
Lcd_Löe1
 =
NULL
 )

280 
Lcd_Löe1
 = 
	`oßl_mem_Æloc
–
HAL_LCD_MAX_CHARS
+1 );

281 
	`HÆLcdWrôeSåög
( "Texas Instruments", 1 );

284 
°rLí
 = (
uöt8
)
	`oßl_°æí
–(*)
°r
 );

287 i‡–
°rLí
 > 
HAL_LCD_MAX_CHARS
 )

288 
°rLí
 = 
HAL_LCD_MAX_CHARS
;

290 i‡–
›ti⁄
 =
HAL_LCD_LINE_1
 )

293 
	`oßl_mem˝y
–
Lcd_Löe1
, 
°r
, 
°rLí
 );

294 
Lcd_Löe1
[
°rLí
] = '\0';

299 
tmpLí
 = (
uöt8
)
	`oßl_°æí
–(*)
Lcd_Löe1
 );

300 
tŸÆLí
 = 
tmpLí
 + 1 + 
°rLí
 + 1;

301 
buf
 = 
	`oßl_mem_Æloc
–
tŸÆLí
 );

302 i‡–
buf
 !
NULL
 )

305 
	`oßl_mem˝y
–
buf
, 
Lcd_Löe1
, 
tmpLí
 );

306 
buf
[
tmpLí
++] = ' ';

307 
	`oßl_mem˝y
–&
buf
[
tmpLí
], 
°r
, 
°rLí
 );

308 
buf
[
tmpLí
+
°rLí
] = '\0';

311 #i‡
	`deföed
 (
ZTOOL_P1
Ë|| deföed (
ZTOOL_P2
)

313 #i‡
	`deföed
(
SERIAL_DEBUG_SUPPORTED
)

314 
	`debug_°r
–(
uöt8
*)
buf
 );

320 
	`oßl_mem_‰ì
–
buf
 );

325 
	`HÆLcd_HW_WrôeLöe
 (
›ti⁄
, 
°r
);

329 
	}
}

342 
	$HÆLcdWrôeVÆue
 ( 
uöt32
 
vÆue
, c⁄° 
uöt8
 
ødix
, uöt8 
›ti⁄
)

344 #i‡(
HAL_LCD
 =
TRUE
)

345 
uöt8
 
buf
[
HAL_LCD_MAX_BUFF
];

347 
	`_…ﬂ
–
vÆue
, &
buf
[0], 
ødix
 );

348 
	`HÆLcdWrôeSåög
–(*)
buf
, 
›ti⁄
 );

350 
	}
}

362 
	$HÆLcdWrôeS¸ìn
–*
löe1
, *
löe2
 )

364 #i‡(
HAL_LCD
 =
TRUE
)

365 
	`HÆLcdWrôeSåög
–
löe1
, 1 );

366 
	`HÆLcdWrôeSåög
–
löe2
, 2 );

368 
	}
}

382 
	$HÆLcdWrôeSåögVÆue
–*
tôÀ
, 
uöt16
 
vÆue
, 
uöt8
 
f‹m©
, uöt8 
löe
 )

384 #i‡(
HAL_LCD
 =
TRUE
)

385 
uöt8
 
tmpLí
;

386 
uöt8
 
buf
[
HAL_LCD_MAX_BUFF
];

387 
uöt32
 
îr
;

389 
tmpLí
 = (
uöt8
)
	`oßl_°æí
–(*)
tôÀ
 );

390 
	`oßl_mem˝y
–
buf
, 
tôÀ
, 
tmpLí
 );

391 
buf
[
tmpLí
] = ' ';

392 
îr
 = (
uöt32
)(
vÆue
);

393 
	`_…ﬂ
–
îr
, &
buf
[
tmpLí
+1], 
f‹m©
 );

394 
	`HÆLcdWrôeSåög
–(*)
buf
, 
löe
 );

396 
	}
}

412 
	$HÆLcdWrôeSåögVÆueVÆue
–*
tôÀ
, 
uöt16
 
vÆue1
, 
uöt8
 
f‹m©1
,

413 
uöt16
 
vÆue2
, 
uöt8
 
f‹m©2
, uöt8 
löe
 )

416 #i‡(
HAL_LCD
 =
TRUE
)

418 
uöt8
 
tmpLí
;

419 
uöt8
 
buf
[
HAL_LCD_MAX_BUFF
];

420 
uöt32
 
îr
;

422 
tmpLí
 = (
uöt8
)
	`oßl_°æí
–(*)
tôÀ
 );

423 i‡–
tmpLí
 )

425 
	`oßl_mem˝y
–
buf
, 
tôÀ
, 
tmpLí
 );

426 
buf
[
tmpLí
++] = ' ';

429 
îr
 = (
uöt32
)(
vÆue1
);

430 
	`_…ﬂ
–
îr
, &
buf
[
tmpLí
], 
f‹m©1
 );

431 
tmpLí
 = (
uöt8
)
	`oßl_°æí
–(*)
buf
 );

433 
buf
[
tmpLí
++] = ',';

434 
buf
[
tmpLí
++] = ' ';

435 
îr
 = (
uöt32
)(
vÆue2
);

436 
	`_…ﬂ
–
îr
, &
buf
[
tmpLí
], 
f‹m©2
 );

438 
	`HÆLcdWrôeSåög
–(*)
buf
, 
löe
 );

441 
	}
}

453 
	$HÆLcdDi•œyPî˚¡B¨
–*
tôÀ
, 
uöt8
 
vÆue
 )

455 #i‡(
HAL_LCD
 =
TRUE
)

457 
uöt8
 
≥r˚¡
;

458 
uöt8
 
À·Ovî
;

459 
uöt8
 
buf
[17];

460 
uöt32
 
îr
;

461 
uöt8
 
x
;

464 
	`HÆLcdWrôeSåög
–
tôÀ
, 
HAL_LCD_LINE_1
 );

466 i‡–
vÆue
 > 100 )

467 
vÆue
 = 100;

470 
≥r˚¡
 = (
uöt8
)(
vÆue
 / 10);

471 
À·Ovî
 = (
uöt8
)(
vÆue
 % 10);

474 
	`oßl_mem˝y
–
buf
, "[ ] ", 15 );

476  
x
 = 0; x < 
≥r˚¡
; x ++ )

478 
buf
[1+
x
] = '>';

481 i‡–
À·Ovî
 >= 5 )

482 
buf
[1+
x
] = '+';

484 
îr
 = (
uöt32
)
vÆue
;

485 
	`_…ﬂ
–
îr
, (
uöt8
*)&
buf
[13], 10 );

487 
	`HÆLcdWrôeSåög
–(*)
buf
, 
HAL_LCD_LINE_2
 );

491 
	}
}

494 #i‡(
HAL_LCD
 =
TRUE
)

508 
	$hÆLcd_C⁄figIO
()

511 
	`HAL_CONFIG_IO_OUTPUT
(
HAL_LCD_MODE_PORT
, 
HAL_LCD_MODE_PIN
, 1);

512 
	`HAL_CONFIG_IO_OUTPUT
(
HAL_LCD_RESET_PORT
, 
HAL_LCD_RESET_PIN
, 1);

513 
	`HAL_CONFIG_IO_OUTPUT
(
HAL_LCD_CS_PORT
, 
HAL_LCD_CS_PIN
, 1);

514 
	}
}

525 
	$hÆLcd_C⁄figSPI
()

529 
uöt8
 
baud_exp⁄ít
;

530 
uöt8
 
baud_m™tisß
;

533 
PERCFG
 |= 0x02;

536 
	`HAL_CONFIG_IO_PERIPHERAL
(
HAL_LCD_CLK_PORT
, 
HAL_LCD_CLK_PIN
);

537 
	`HAL_CONFIG_IO_PERIPHERAL
(
HAL_LCD_MOSI_PORT
, 
HAL_LCD_MOSI_PIN
);

538 
	`HAL_CONFIG_IO_PERIPHERAL
(
HAL_LCD_MISO_PORT
, 
HAL_LCD_MISO_PIN
);

544 
baud_exp⁄ít
 = 15;

545 
baud_m™tisß
 = 0;

548 
U1UCR
 = 0x80;

549 
U1CSR
 = 0x00;

550 
U1GCR
 = 
HAL_SPI_TRANSFER_MSB_FIRST
 | 
HAL_SPI_CLOCK_PHA_0
 | 
HAL_SPI_CLOCK_POL_LO
 | 
baud_exp⁄ít
;

551 
U1BAUD
 = 
baud_m™tisß
;

552 
	}
}

563 
	$HÆLcd_HW_Inô
()

566 
	`hÆLcd_C⁄figIO
();

569 
	`hÆLcd_C⁄figSPI
();

572 
	`LCD_ACTIVATE_RESET
();

573 
	`HÆLcd_HW_WaôUs
(15000);

574 
	`LCD_RELEASE_RESET
();

575 
	`HÆLcd_HW_WaôUs
(15);

578 
	`FUNCTION_SET
(
CGRAM
 | 
COM_FORWARD
 | 
THREE_LINE
);

581 
	`HÆLcd_HW_SëC⁄åa°
(15);

584 
	`SET_POWER_SAVE_MODE
(
OSC_OFF
 | 
POWER_SAVE_ON
);

585 
	`SET_POWER_CTRL
(
VOLTAGE_DIVIDER_ON
 | 
CONVERTER_AND_REG_ON
);

586 
	`SET_BIAS_CTRL
(
BIAS_1_5
);

587 
	`HÆLcd_HW_WaôUs
(21000);

590 
	`HÆLcd_HW_CÀ¨
();

591 
	`HÆLcd_HW_CÀ¨AŒS≥cCh¨s
();

592 
	`SET_DISPLAY_CTRL
(
DISPLAY_CTRL_ON
 | 
DISPLAY_CTRL_BLINK_OFF
 | 
DISPLAY_CTRL_CURSOR_OFF
);

593 
	}
}

604 
	$HÆLcd_HW_C⁄åﬁ
(
uöt8
 
cmd
)

606 
	`LCD_SPI_BEGIN
();

607 
	`LCD_DO_CONTROL
();

608 
	`LCD_SPI_TX
(
cmd
);

609 
	`LCD_SPI_WAIT_RXRDY
();

610 
	`LCD_SPI_END
();

611 
	}
}

622 
	$HÆLcd_HW_Wrôe
(
uöt8
 
d©a
)

624 
	`LCD_SPI_BEGIN
();

625 
	`LCD_DO_WRITE
();

626 
	`LCD_SPI_TX
(
d©a
);

627 
	`LCD_SPI_WAIT_RXRDY
();

628 
	`LCD_SPI_END
();

629 
	}
}

640 
	$HÆLcd_HW_SëC⁄åa°
(
uöt8
 
vÆue
)

642 
	`SET_ICONRAM_ADDR
(
CONTRAST_CTRL_REGISTER
);

643 
	`HÆLcd_HW_Wrôe
(
vÆue
);

644 
	}
}

655 
	$HÆLcd_HW_CÀ¨
()

657 
uöt8
 
n
;

659 
	`SET_DDRAM_ADDR
(0x00);

660 
n
 = 0;Ç < (
LCD_MAX_LINE_COUNT
 * 
HAL_LCD_MAX_CHARS
);Ç++)

662 
	`HÆLcd_HW_Wrôe
(' ');

664 
	}
}

675 
	$HÆLcd_HW_CÀ¨AŒS≥cCh¨s
()

677 
uöt8
 
n
 = 0;

679 
	`SET_GCRAM_CHAR
(0);

680 
n
 = 0;Ç < (8 * 8);Ç++)

682 
	`HÆLcd_HW_Wrôe
(0x00);

684 
	}
}

696 
	$HÆLcd_HW_WrôeCh¨
(
uöt8
 
löe
, uöt8 
cﬁ
, 
ãxt
)

698 i‡(
cﬁ
 < 
HAL_LCD_MAX_CHARS
)

700 
	`SET_DDRAM_ADDR
((
löe
 - 1Ë* 
HAL_LCD_MAX_CHARS
 + 
cﬁ
);

701 
	`HÆLcd_HW_Wrôe
(
ãxt
);

707 
	}
}

719 
	$HÆLcd_HW_WrôeLöe
(
uöt8
 
löe
, c⁄° *
pText
)

721 
uöt8
 
cou¡
;

722 
uöt8
 
tŸÆLígth
 = (uöt8)
	`oßl_°æí
–(*)
pText
 );

725 
cou¡
=0; cou¡<
tŸÆLígth
; count++)

727 
	`HÆLcd_HW_WrôeCh¨
(
löe
, 
cou¡
, (*(
pText
++)));

731 
cou¡
=
tŸÆLígth
; cou¡<
HAL_LCD_MAX_CHARS
;count++)

733 
	`HÆLcd_HW_WrôeCh¨
(
löe
, 
cou¡
, ' ');

735 
	}
}

746 
	$HÆLcd_HW_WaôUs
(
uöt16
 
mi¸oSecs
)

748 
mi¸oSecs
--)

751 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

752 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

753 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

754 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

755 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

756 
	`asm
("nop");ásm("nop");ásm("nop");ásm("nop");ásm("nop");

757 
	`asm
("nop");ásm("nop");

759 
	}
}

	@Components/hal/target/CC2540USB/hal_led.c

44 
	~"hÆ_mcu.h
"

45 
	~"hÆ_defs.h
"

46 
	~"hÆ_ty≥s.h
"

47 
	~"hÆ_drivîs.h
"

48 
	~"hÆ_Àd.h
"

49 
	~"oßl.h
"

50 
	~"hÆ_bﬂrd.h
"

58 
uöt8
 
	mmode
;

59 
uöt8
 
	mÀ·
;

60 
uöt8
 
	m⁄P˘
;

61 
uöt16
 
	mtime
;

62 
uöt32
 
	m√xt
;

63 } 
	tHÆLedC⁄åﬁ_t
;

67 
HÆLedC⁄åﬁ_t
 
	mHÆLedC⁄åﬁTabÀ
[
HAL_LED_DEFAULT_MAX_LEDS
];

68 
uöt8
 
	m¶ìpA˘ive
;

69 } 
	tHÆLedSètus_t
;

75 
uöt8
 
	gHÆLedSèã
;

77 #i‡
HAL_LED
 =
TRUE


78 
uöt8
 
	gHÆSÀïLedSèã
;

79 
uöt8
 
	g¥eBlökSèã
;

83 #ifde‡
BLINK_LEDS


84 
HÆLedSètus_t
 
	gHÆLedSètusC⁄åﬁ
;

91 #i‡(
HAL_LED
 =
TRUE
)

92 
HÆLedUpd©e
 ();

93 
HÆLedOnOff
 (
uöt8
 
Àds
, uöt8 
mode
);

109 
	$HÆLedInô
 ()

111 #i‡(
HAL_LED
 =
TRUE
)

112 
	`HÆLedSë
(
HAL_LED_ALL
, 
HAL_LED_MODE_OFF
);

115 
LED1_DDR
 |
LED1_BV
;

116 #i‡(!
deföed
 
HAL_PA_LNA
 && !deföed 
HAL_PA_LNA_CC2590
)

117 
LED2_DDR
 |
LED2_BV
;

118 #i‡(!
deföed
 
CC2540_MINIDK
 && !deföed 
HAL_BOARD_CC2540USB
)

119 
LED3_DDR
 |
LED3_BV
;

122 #i‡
deföed
 
BLINK_LEDS


123 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
FALSE
;

126 
	}
}

137 
uöt8
 
	$HÆLedSë
 (
uöt8
 
Àds
, uöt8 
mode
)

140 #i‡(
	`deföed
 (
BLINK_LEDS
)Ë&& (
HAL_LED
 =
TRUE
)

141 
uöt8
 
Àd
;

142 
HÆLedC⁄åﬁ_t
 *
°s
;

144 
mode
)

146 
HAL_LED_MODE_BLINK
:

148 
	`HÆLedBlök
 (
Àds
, 1, 
HAL_LED_DEFAULT_DUTY_CYCLE
, 
HAL_LED_DEFAULT_FLASH_TIME
);

151 
HAL_LED_MODE_FLASH
:

153 
	`HÆLedBlök
 (
Àds
, 
HAL_LED_DEFAULT_FLASH_COUNT
, 
HAL_LED_DEFAULT_DUTY_CYCLE
, 
HAL_LED_DEFAULT_FLASH_TIME
);

156 
HAL_LED_MODE_ON
:

157 
HAL_LED_MODE_OFF
:

158 
HAL_LED_MODE_TOGGLE
:

160 
Àd
 = 
HAL_LED_1
;

161 
Àds
 &
HAL_LED_ALL
;

162 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

164 
Àds
)

166 i‡(
Àds
 & 
Àd
)

168 i‡(
mode
 !
HAL_LED_MODE_TOGGLE
)

170 
°s
->
mode
 = mode;

174 
°s
->
mode
 ^
HAL_LED_MODE_ON
;

176 
	`HÆLedOnOff
 (
Àd
, 
°s
->
mode
);

177 
Àds
 ^
Àd
;

179 
Àd
 <<= 1;

180 
°s
++;

188 #ñi‡(
HAL_LED
 =
TRUE
)

189 
	`LedOnOff
(
Àds
, 
mode
);

192 (Ë
Àds
;

193 (Ë
mode
;

196  ( 
HÆLedSèã
 );

197 
	}
}

212 
	$HÆLedBlök
 (
uöt8
 
Àds
, uöt8 
numBlöks
, uöt8 
≥r˚¡
, 
uöt16
 
≥riod
)

214 #i‡(
	`deföed
 (
BLINK_LEDS
)Ë&& (
HAL_LED
 =
TRUE
)

215 
uöt8
 
Àd
;

216 
HÆLedC⁄åﬁ_t
 *
°s
;

218 i‡(
Àds
 && 
≥r˚¡
 && 
≥riod
)

220 i‡(
≥r˚¡
 < 100)

222 
Àd
 = 
HAL_LED_1
;

223 
Àds
 &
HAL_LED_ALL
;

224 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

226 
Àds
)

228 i‡(
Àds
 & 
Àd
)

231 if(
°s
->
mode
 < 
HAL_LED_MODE_BLINK
 )

232 
¥eBlökSèã
 |(
Àd
 & 
HÆLedSèã
);

234 
°s
->
mode
 = 
HAL_LED_MODE_OFF
;

235 
°s
->
time
 = 
≥riod
;

236 
°s
->
⁄P˘
 = 
≥r˚¡
;

237 
°s
->
À·
 = 
numBlöks
;

238 i‡(!
numBlöks
Ë
°s
->
mode
 |
HAL_LED_MODE_FLASH
;

239 
°s
->
√xt
 = 
	`oßl_GëSy°emClock
();

240 
°s
->
mode
 |
HAL_LED_MODE_BLINK
;

241 
Àds
 ^
Àd
;

243 
Àd
 <<= 1;

244 
°s
++;

247 
	`oßl_°›_timîEx
(
HÆ_TaskID
, 
HAL_LED_BLINK_EVENT
);

248 
	`oßl_£t_evít
 (
HÆ_TaskID
, 
HAL_LED_BLINK_EVENT
);

252 
	`HÆLedSë
 (
Àds
, 
HAL_LED_MODE_ON
);

257 
	`HÆLedSë
 (
Àds
, 
HAL_LED_MODE_OFF
);

259 #ñi‡(
HAL_LED
 =
TRUE
)

260 
≥r˚¡
 = (
Àds
 & 
HÆLedSèã
Ë? 
HAL_LED_MODE_OFF
 : 
HAL_LED_MODE_ON
;

261 
	`HÆLedOnOff
 (
Àds
, 
≥r˚¡
);

264 (Ë
Àds
;

265 (Ë
numBlöks
;

266 (Ë
≥r˚¡
;

267 (Ë
≥riod
;

269 
	}
}

271 #i‡(
HAL_LED
 =
TRUE
)

281 
	$HÆLedUpd©e
 ()

283 
uöt8
 
Àd
;

284 
uöt8
 
p˘
;

285 
uöt8
 
Àds
;

286 
HÆLedC⁄åﬁ_t
 *
°s
;

287 
uöt32
 
time
;

288 
uöt16
 
√xt
;

289 
uöt16
 
waô
;

291 
√xt
 = 0;

292 
Àd
 = 
HAL_LED_1
;

293 
Àds
 = 
HAL_LED_ALL
;

294 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

297 i‡(!
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
)

299 
Àds
)

301 i‡(
Àds
 & 
Àd
)

303 i‡(
°s
->
mode
 & 
HAL_LED_MODE_BLINK
)

305 
time
 = 
	`oßl_GëSy°emClock
();

306 i‡(
time
 >
°s
->
√xt
)

308 i‡(
°s
->
mode
 & 
HAL_LED_MODE_ON
)

310 
p˘
 = 100 - 
°s
->
⁄P˘
;

311 
°s
->
mode
 &~
HAL_LED_MODE_ON
;

312 
	`HÆLedOnOff
 (
Àd
, 
HAL_LED_MODE_OFF
);

314 i‡–!(
°s
->
mode
 & 
HAL_LED_MODE_FLASH
) )

316 
°s
->
À·
--;

319 i‡–!(
°s
->
À·
Ë&& !(°s->
mode
 & 
HAL_LED_MODE_FLASH
) )

321 
°s
->
mode
 ^
HAL_LED_MODE_BLINK
;

325 
p˘
 = 
°s
->
⁄P˘
;

326 
°s
->
mode
 |
HAL_LED_MODE_ON
;

327 
	`HÆLedOnOff
–
Àd
, 
HAL_LED_MODE_ON
 );

329 i‡(
°s
->
mode
 & 
HAL_LED_MODE_BLINK
)

331 
waô
 = (((
uöt32
)
p˘
 * (uöt32)
°s
->
time
) / 100);

332 
°s
->
√xt
 = 
time
 + 
waô
;

337 
waô
 = 0;

339 
	`HÆLedSë
 (
Àd
, ((
¥eBlökSèã
 &Üed)!=0)?
HAL_LED_MODE_ON
:
HAL_LED_MODE_OFF
);

341 
¥eBlökSèã
 &(
Àd
 ^ 0xFF);

346 
waô
 = 
°s
->
√xt
 - 
time
;

349 i‡(!
√xt
 || ( 
waô
 && (wait <Çext) ))

351 
√xt
 = 
waô
;

354 
Àds
 ^
Àd
;

356 
Àd
 <<= 1;

357 
°s
++;

360 i‡(
√xt
)

362 
	`oßl_°¨t_timîEx
(
HÆ_TaskID
, 
HAL_LED_BLINK_EVENT
, 
√xt
);

365 
	}
}

377 
	$HÆLedOnOff
 (
uöt8
 
Àds
, uöt8 
mode
)

379 i‡(
Àds
 & 
HAL_LED_1
)

381 i‡(
mode
 =
HAL_LED_MODE_ON
)

383 
	`HAL_TURN_ON_LED1
();

387 
	`HAL_TURN_OFF_LED1
();

391 i‡(
Àds
 & 
HAL_LED_2
)

393 i‡(
mode
 =
HAL_LED_MODE_ON
)

395 
	`HAL_TURN_ON_LED2
();

399 
	`HAL_TURN_OFF_LED2
();

403 i‡(
Àds
 & 
HAL_LED_3
)

405 i‡(
mode
 =
HAL_LED_MODE_ON
)

407 
	`HAL_TURN_ON_LED3
();

411 
	`HAL_TURN_OFF_LED3
();

415 i‡(
Àds
 & 
HAL_LED_4
)

417 i‡(
mode
 =
HAL_LED_MODE_ON
)

419 
	`HAL_TURN_ON_LED4
();

423 
	`HAL_TURN_OFF_LED4
();

428 i‡(
mode
)

430 
HÆLedSèã
 |
Àds
;

434 
HÆLedSèã
 &(
Àds
 ^ 0xFF);

436 
	}
}

448 
uöt8
 
	$HÆLedGëSèã
 ()

450 #i‡(
HAL_LED
 =
TRUE
)

451  
HÆLedSèã
;

455 
	}
}

466 
	$HÆLedE¡îSÀï
( )

468 #ifde‡
BLINK_LEDS


470 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
TRUE
;

473 #i‡(
HAL_LED
 =
TRUE
)

475 
HÆSÀïLedSèã
 = 0;

476 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED1
();

477 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED2
() << 1;

478 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED3
() << 2;

479 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED4
() << 3;

482 
	`HÆLedOnOff
 (
HAL_LED_ALL
, 
HAL_LED_MODE_OFF
);

485 
	}
}

496 
	$HÆLedExôSÀï
( )

498 #i‡(
HAL_LED
 =
TRUE
)

500 
	`HÆLedOnOff
(
HÆSÀïLedSèã
, 
HAL_LED_MODE_ON
);

503 
	`HÆLedUpd©e
();

506 #ifde‡
BLINK_LEDS


508 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
FALSE
;

510 
	}
}

	@Components/hal/target/CC2540USB/hal_mcu.h

40 #i‚de‡
_HAL_MCU_H


41 
	#_HAL_MCU_H


	)

53 
	~"hÆ_defs.h
"

54 
	~"hÆ_ty≥s.h
"

61 
	#HAL_MCU_CC2540


	)

70 #ifde‡
__IAR_SYSTEMS_ICC__


72 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

73 
	~<ioCC2541.h
>

75 
	~<ioCC2540.h
>

78 
	#HAL_COMPILER_IAR


	)

79 
	#HAL_MCU_LITTLE_ENDIAN
(Ë
__LITTLE_ENDIAN__


	)

80 
	#_PRAGMA
(
x
Ë
	`_Pøgma
(#x)

	)

81 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

82 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

83 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

86 #ñi‡
deföed
 
__KEIL__


88 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

89 
	~<CC2541.h
>

91 
	~<CC2540.h
>

94 
	#HAL_COMPILER_KEIL


	)

95 
	#HAL_MCU_LITTLE_ENDIAN
(Ë0

	)

96 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`f
(Ë
öãºu±
 
	)
v

97 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`f
()

	)

98 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

110 
	#HAL_ENABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 1; )

	)

111 
	#HAL_DISABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 0; )

	)

112 
	#HAL_INTERRUPTS_ARE_ENABLED
(Ë(
EA
)

	)

114 
	thÆI¡Sèã_t
;

115 
	#HAL_ENTER_CRITICAL_SECTION
(
x
Ë
	`°
–x = 
EA
; 
	`HAL_DISABLE_INTERRUPTS
(); )

	)

116 
	#HAL_EXIT_CRITICAL_SECTION
(
x
Ë
	`°
–
EA
 = x; )

	)

117 
	#HAL_CRITICAL_STATEMENT
(
x
Ë
	`°
–
hÆI¡Sèã_t
 
_s
; 
	`HAL_ENTER_CRITICAL_SECTION
(_s); x; 
	`HAL_EXIT_CRITICAL_SECTION
(_s); )

	)

119 #ifde‡
__IAR_SYSTEMS_ICC__


125 
	#HAL_ENTER_ISR
(Ë{ 
hÆI¡Sèã_t
 
_i§I¡Sèã
 = 
EA
; 
	`HAL_ENABLE_INTERRUPTS
();

	)

126 
	#HAL_EXIT_ISR
(Ë
EA
 = 
_i§I¡Sèã
; }

	)

128 
	#HAL_ENTER_ISR
()

	)

129 
	#HAL_EXIT_ISR
()

	)

136 
	#WD_EN
 
	`BV
(3)

	)

137 
	#WD_MODE
 
	`BV
(2)

	)

138 
	#WD_INT_1900_USEC
 (
	`BV
(0Ë| BV(1))

	)

139 
	#WD_RESET1
 (0xA0 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

140 
	#WD_RESET2
 (0x50 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

141 
	#WD_KICK
(Ë
	`°
–
WDCTL
 = (0xA0 | WDCTL & 0x0F); WDCTL = (0x50 | WDCTL & 0x0F); )

	)

144 
	#HAL_SYSTEM_RESET
(Ë
	`°
–
	`HAL_DISABLE_INTERRUPTS
(); 
WDCTL
 = 
WD_RESET1
; WDCTL = 
WD_RESET2
; ;;); )

	)

150 
	#REV_A
 0x00

	)

151 
	#REV_B
 0x11

	)

152 
	#REV_C
 0x20

	)

153 
	#REV_D
 0x21

	)

161 
	#PCON_IDLE
 
	`BV
(0Ë

	)

164 
	#OSC_PD
 
	`BV
(2Ë

	)

165 
	#PMODE
 (
	`BV
(1Ë| BV(0)Ë

	)

168 
	#XOSC_STB
 
	`BV
(6Ë

	)

169 
	#HFRC_STB
 
	`BV
(5Ë

	)

172 
	#OSC_PD
 
	`BV
(2Ë

	)

176 
	#OSC
 
	`BV
(6)

	)

177 
	#TICKSPD
(
x
Ë(x << 3)

	)

178 
	#CLKSPD
(
x
Ë(x << 0)

	)

179 
	#CLKCONCMD_32MHZ
 (0)

	)

180 
	#CLKCONCMD_16MHZ
 (
	`CLKSPD
(1Ë| 
	`TICKSPD
(1Ë| 
OSC
)

	)

183 
	#LDRDY
 
	`BV
(0Ë

	)

187 #ifde‡
POWER_SAVING


188 vﬁ©ûê
__d©a
 
uöt8
 
hÆSÀïPc⁄VÆue
;

193 
	#CLEAR_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 0; )

	)

194 
	#ALLOW_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; )

	)

196 
	#CLEAR_SLEEP_MODE
()

	)

197 
	#ALLOW_SLEEP_MODE
()

	)

	@Components/hal/target/CC2540USB/hal_sleep.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"hÆ_mcu.h
"

45 
	~"hÆ_bﬂrd.h
"

46 
	~"hÆ_¶ìp.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"OSAL.h
"

50 
	~"OSAL_Timîs.h
"

51 
	~"OSAL_Tasks.h
"

52 
	~"OSAL_PwrMgr.h
"

53 
	~"hÆ_drivîs.h
"

54 
	~"hÆ_as£π.h
"

55 
	~"Œ_¶ìp.h
"

56 
	~"Œ_timî2.h
"

57 
	~"Œ_m©h.h
"

63 #i‚de‡
HAL_SLEEP_DEBUG_POWER_MODE


65 
	#HAL_SLEEP_PREP_POWER_MODE
(
mode
) \

66 
	`°
–
SLEEPCMD
 &~
PMODE
; \

67 
SLEEPCMD
 |
mode
; \

68 !(
STLOAD
 & 
LDRDY
)); \

69 
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; \

70 )

	)

71 
	#HAL_SLEEP_SET_POWER_MODE
() \

72 
	`hÆSëSÀïMode
()

	)

77 
	#HAL_SLEEP_PREP_POWER_MODE
(
mode
Ë

	)

78 
	#HAL_SLEEP_SET_POWER_MODE
() \

79 
	`°
–
hÆSÀïI¡
 =
FALSE
); \

80 
hÆSÀïI¡
 = 
FALSE
; \

81 
	`HAL_DISABLE_INTERRUPTS
(); \

82 )

	)

86 
	#HAL_SLEEP_TIMER_ENABLE_INT
(Ë
	`°
(
IEN0
 |
STIE_BV
;)

87 
	#HAL_SLEEP_TIMER_DISABLE_INT
(Ë
	`°
(
IEN0
 &~
STIE_BV
;)

88 
	#HAL_SLEEP_TIMER_CLEAR_INT
(Ë
	`°
(
IRCON
 &= ~0x80;)

89 

	)

91 
	#HAL_SLEEP_IE_BACKUP_AND_DISABLE
–
õn0
, 
õn1
, 
õn2
 ) \

92 
	`°
–(
õn0
Ë
IEN0
; \

93 (
õn1
Ë
IEN1
; \

94 (
õn2
Ë
IEN2
; \

95 
IEN0
 &
STIE_BV
; \

96 
IEN1
 &
P0IE_BV
; \

97 
IEN2
 &(
P1IE_BV
|
P2IE_BV
); \

98 )

	)

101 
	#HAL_SLEEP_IE_RESTORE
–
õn0
, 
õn1
, 
õn2
 ) \

102 
	`°
–
IEN0
 = (
õn0
); \

103 
IEN1
 = (
õn1
); \

104 
IEN2
 = (
õn2
); \

105 )

	)

108 
	#HAL_SLEEP_MS_TO_625US
–
ms
 ) (((((
uöt32
Ë(ms)Ë* 8Ë+ 4Ë/ 5)

	)

112 
	#HAL_SLEEP_MS_TO_32KHZ
–
ms
 ) ((((
uöt32
Ë(ms)Ë* 4096Ë/ 125)

	)

128 
	#MAX_SLEEP_TIMEOUT
 40000

	)

136 
	#CC2540_PM0
 0

137 
	#CC2540_PM1
 1

138 
	#CC2540_PM2
 2

139 
	#CC2540_PM3
 3

140 

	)

147 
	#HAL_SLEEP_OFF
 
CC2540_PM0


	)

148 
	#HAL_SLEEP_TIMER
 
CC2540_PM2


	)

149 
	#HAL_SLEEP_DEEP
 
CC2540_PM3


	)

154 
	#MAX_SLEEP_TIME
 16711680

155 

	)

159 #i‡!
deföed
 (
PM_MIN_SLEEP_TIME
)

160 
	#PM_MIN_SLEEP_TIME
 66

162 

	)

169 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

170 
	#HAL_SLEEP_ADJ_TICKS
 25

171 #ñ£ // CC2540

	)

172 
	#HAL_SLEEP_ADJ_TICKS
 35

174 

	)

176 
	#STIE_BV
 
	`BV
(5)

	)

177 
	#P0IE_BV
 
	`BV
(5)

	)

178 
	#P1IE_BV
 
	`BV
(4)

	)

179 
	#P2IE_BV
 
	`BV
(1)

	)

182 #i‡
HAL_MCU_LITTLE_ENDIAN
()

183 
	#UINT32_NDX0
 0

	)

184 
	#UINT32_NDX1
 1

	)

185 
	#UINT32_NDX2
 2

	)

186 
	#UINT32_NDX3
 3

	)

188 
	#UINT32_NDX0
 3

	)

189 
	#UINT32_NDX1
 2

	)

190 
	#UINT32_NDX2
 1

	)

191 
	#UINT32_NDX3
 0

	)

203 
uöt8
 
	ghÆPwrMgtMode
 = 
HAL_SLEEP_OFF
;

206 
uöt8
 
	gwakeF‹RF
;

208 #ifde‡
HAL_SLEEP_DEBUG_POWER_MODE


209 
boﬁ
 
	ghÆSÀïI¡
 = 
FALSE
;

217 vﬁ©ûê
__d©a
 
uöt8
 
	ghÆSÀïPc⁄VÆue
 = 
PCON_IDLE
;

226 #¥agm®
loˇti⁄
 = "SLEEP_CODE"

227 
hÆSëSÀïMode
();

229 
hÆSÀïSëTimî
–
uöt32
 
¶ìpTime
, uöt32 
timeout
 );

230 
uöt32
 
hÆSÀïRódTimî
( );

231 
uöt32
 
TimîEœp£d
( );

251 #¥agm®
›timize
=
n⁄e


252 
	$hÆSëSÀïMode
()

255 
PCON
 = 
hÆSÀïPc⁄VÆue
;

257 
	`HAL_DISABLE_INTERRUPTS
();

258 
	}
}

277 
	$hÆSÀï
–
uöt32
 
oßl_timeout
 )

279 
uöt32
 
timeout
;

280 
uöt32
 
ŒTimeout
;

281 
uöt32
 
¶ìpTimî
;

283 #ifde‡
DEBUG_GPIO


285 
P1_0
 = 1;

289 i‡(
oßl_timeout
 > 
MAX_SLEEP_TIMEOUT
)

291 
oßl_timeout
 = 
MAX_SLEEP_TIMEOUT
;

295 
	`LL_TimeToNextRfEvít
–&
¶ìpTimî
, &
ŒTimeout
 );

301 i‡(
oßl_timeout
 == 0)

304 
timeout
 = 
ŒTimeout
;

309 
wakeF‹RF
 = (
timeout
 !0Ë? 
TRUE
 : 
FALSE
;

315 
timeout
 = 
	`HAL_SLEEP_MS_TO_32KHZ
–
oßl_timeout
 );

318 i‡((
ŒTimeout
 !0Ë&& (ŒTimeouà< 
timeout
))

321 
timeout
 = 
ŒTimeout
;

324 
wakeF‹RF
 = 
TRUE
;

329 
¶ìpTimî
 = 
	`hÆSÀïRódTimî
();

332 
wakeF‹RF
 = 
FALSE
;

337 
hÆPwrMgtMode
 = (
timeout
 =0Ë? 
HAL_SLEEP_DEEP
 : 
HAL_SLEEP_TIMER
;

339 #ifde‡
DEBUG_GPIO


341 
P1_0
 = 0;

345 i‡–(
timeout
 > 
PM_MIN_SLEEP_TIME
) || (timeout == 0) )

347 
hÆI¡Sèã_t
 
õn0
, 
õn1
, 
õn2
;

349 #ifde‡
DEBUG_GPIO


351 
P1_0
 = 1;

354 
	`HAL_ASSERT
–
	`HAL_INTERRUPTS_ARE_ENABLED
() );

355 
	`HAL_DISABLE_INTERRUPTS
();

358 i‡–
	`LL_PowîOffReq
(
hÆPwrMgtMode
Ë=
LL_SLEEP_REQUEST_ALLOWED
 )

360 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

362 
	`HÆKeyE¡îSÀï
();

365 #ifde‡
HAL_SLEEP_DEBUG_LED


366 
	`HAL_TURN_OFF_LED3
();

369 
	`HÆLedE¡îSÀï
();

373 i‡(
timeout
 != 0)

376 i‡(
timeout
 > 
MAX_SLEEP_TIME
 )

379 
	`hÆSÀïSëTimî
–
¶ìpTimî
, 
MAX_SLEEP_TIME
 );

384 
	`hÆSÀïSëTimî
–
¶ìpTimî
, 
timeout
 );

389 
	`HAL_SLEEP_PREP_POWER_MODE
(
hÆPwrMgtMode
);

392 
	`HAL_SLEEP_IE_BACKUP_AND_DISABLE
(
õn0
, 
õn1
, 
õn2
);

393 
	`HAL_ENABLE_INTERRUPTS
();

395 #ifde‡
DEBUG_GPIO


397 
P1_0
 = 0;

405 
	`HAL_SLEEP_SET_POWER_MODE
();

407 #ifde‡
DEBUG_GPIO


409 
P1_0
 = 1;

422 i‡–(
wakeF‹RF
 =
TRUE
Ë&& !(
IRCON
 & 0x80) )

424 
wakeF‹RF
 = 
FALSE
;

428 
	`HAL_SLEEP_IE_RESTORE
(
õn0
, 
õn1
, 
õn2
);

433 
	`LL_PowîOnReq
–(
hÆPwrMgtMode
 =
CC2540_PM3
), 
wakeF‹RF
 );

435 #ifde‡
HAL_SLEEP_DEBUG_LED


436 
	`HAL_TURN_ON_LED3
();

439 
	`HÆLedExôSÀï
();

442 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

444 ()
	`HÆKeyExôSÀï
();

448 
	`HAL_ENABLE_INTERRUPTS
();

451 #ifde‡
DEBUG_GPIO


453 
P1_0
 = 0;

457 
	}
}

485 
	$hÆSÀïSëTimî
–
uöt32
 
¶ìpTimî
, uöt32 
timeout
 )

487 
	`HAL_SLEEP_TIMER_DISABLE_INT
();

490 
¶ìpTimî
 +
timeout
;

493 
¶ìpTimî
 -
HAL_SLEEP_ADJ_TICKS
;

496 
ST2
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX2
];

497 
ST1
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX1
];

498 
ST0
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX0
];

500 
	`HAL_SLEEP_TIMER_CLEAR_INT
();

501 
	`HAL_SLEEP_TIMER_ENABLE_INT
();

504 
	}
}

522 
uöt32
 
	$hÆSÀïRódTimî
( )

524 
uöt32
 
¶ìpTimî
;

528 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX0
] = 
ST0
;

529 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX1
] = 
ST1
;

530 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX2
] = 
ST2
;

531 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX3
] = 0;

533 –
¶ìpTimî
 );

534 
	}
}

552 
uöt32
 
	$TimîEœp£d
( )

555 
	}
}

573 
	$hÆRe°‹eSÀïLevñ
( )

576 #ifde‡
PM_TEST


577 
	`oßl_°¨t_timîEx
 (
HÆ_TaskID
, 
HAL_SLEEP_TIMER_EVENT
, 1000);

579 
	}
}

597 
	$HAL_ISR_FUNCTION
(
hÆSÀïTimîI§
, 
ST_VECTOR
)

599 
	`HAL_ENTER_ISR
();

601 
	`HAL_SLEEP_TIMER_CLEAR_INT
();

603 #ifde‡
HAL_SLEEP_DEBUG_POWER_MODE


604 
hÆSÀïI¡
 = 
TRUE
;

607 
	`CLEAR_SLEEP_MODE
();

609 
	`HAL_EXIT_ISR
();

612 
	}
}

	@Components/hal/target/CC2540USB/hal_startup.c

42 
	~"hÆ_bﬂrd.h
"

43 
	~"hÆ_ty≥s.h
"

45 #ifde‡
__˝lu•lus


49 #¥agm®
œnguage
=
exãnded


54 #¥agm®
loˇti⁄
="CSTART"

59 #i‡(
__CODE_MODEL__
 == 2)

60 
__√¨_func
 
__roŸ
 

62 
__roŸ
 

64 
__low_Àvñ_öô
();

77 #i‡(
__CODE_MODEL__
 == 2)

78 
__√¨_func
 
__roŸ
 

80 
__roŸ
 

82 
__low_Àvñ_öô
()

88 #i‡
deföed
 
HAL_IMAGE_A


89 
MEMCTR
 = (MEMCTR & 0xF8) | 0x05;

90 #ñi‡
deföed
 
HAL_IMAGE_B


91 
MEMCTR
 = (MEMCTR & 0xF8) | 0x04;

93 
MEMCTR
 = (MEMCTR & 0xF8) | 0x01;

105 #¥agm®
œnguage
=

107 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2540USB/hal_timer.c

	@Components/hal/target/CC2540USB/hal_types.h

44 #i‚de‡
_HAL_TYPES_H


45 
	#_HAL_TYPES_H


	)

56 sig√d 
	töt8
;

57 
	tuöt8
;

59 sig√d 
	töt16
;

60 
	tuöt16
;

62 sig√d 
	töt32
;

63 
	tuöt32
;

65 
	tboﬁ
;

67 
uöt8
 
	thÆD©aAlign_t
;

76 #ifde‡
__IAR_SYSTEMS_ICC__


77 
	#CODE
 
__code


	)

78 
	#XDATA
 
__xd©a


	)

79 
	#DATA
 
__d©a


	)

80 
	#NEAR_FUNC
 
__√¨_func


	)

81 
	#ASM_NOP
 
	`asm
("NOP")

	)

84 #ñi‡
deföed
 
__KEIL__


85 
	#CODE
 
code


	)

86 
	#XDATA
 
xd©a


	)

87 
	#ASM_NOP
 
	`__n›
()

	)

90 #ñi‡
deföed
 
__GNUC__


91 
	#ASM_NOP
 
__asm__
 
	`__vﬁ©ûe__
 ("n›")

	)

94 #ñi‡
_MSC_VER


95 
	#ASM_NOP
 
__asm
 
NOP


	)

98 #ñi‡
deföed
 
__TI_COMPILER_VERSION


99 
	#ASM_NOP
 
	`asm
(" NOP")

	)

111 #i‚de‡
TRUE


112 
	#TRUE
 1

	)

115 #i‚de‡
FALSE


116 
	#FALSE
 0

	)

119 #i‚de‡
NULL


120 
	#NULL
 0

	)

	@Components/hal/target/CC2540USB/hal_uart.c

44 
	~"hÆ_bﬂrd_cfg.h
"

45 
	~"hÆ_defs.h
"

46 
	~"hÆ_drivîs.h
"

47 
	~"hÆ_ty≥s.h
"

48 
	~"hÆ_u¨t.h
"

49 #i‡
deföed
 
POWER_SAVING


50 
	~"OSAL.h
"

51 
	~"OSAL_PwrMgr.h
"

58 
HÆUARTI§DMA
();

64 #i‡
HAL_UART_DMA


65 
	~"_hÆ_u¨t_dma.c
"

67 #i‡
HAL_UART_ISR


68 
	~"_hÆ_u¨t_i§.c
"

70 #i‡
HAL_UART_SPI


71 
	~"_hÆ_u¨t_•i.c
"

73 #i‡
HAL_UART_USB


74 
	~"_hÆ_u¨t_usb.c
"

86 
	$HÆUARTInô
()

88 #i‡(
HAL_UART_DMA
 && 
HAL_UART_SPI
)

89 i‡(
HAL_UART_PORT
)

91 
	`HÆUARTInôSPI
();

95 
	`HÆUARTInôDMA
();

98 #i‡
HAL_UART_DMA


99 
	`HÆUARTInôDMA
();

101 #i‡
HAL_UART_ISR


102 
	`HÆUARTInôISR
();

104 #i‡
HAL_UART_SPI


105 
	`HÆUARTInôSPI
();

107 #i‡
HAL_UART_USB


108 
	`HÆUARTInôUSB
();

111 
	}
}

123 
uöt8
 
	$HÆUARTO≥n
(
uöt8
 
p‹t
, 
hÆUARTCfg_t
 *
c⁄fig
)

125 #i‡(
HAL_UART_DMA
 == 1)

126 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë
	`HÆUARTO≥nDMA
(
c⁄fig
);

128 #i‡(
HAL_UART_DMA
 == 2)

129 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë
	`HÆUARTO≥nDMA
(
c⁄fig
);

131 #i‡(
HAL_UART_ISR
 == 1)

132 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë
	`HÆUARTO≥nISR
(
c⁄fig
);

134 #i‡(
HAL_UART_ISR
 == 2)

135 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë
	`HÆUARTO≥nISR
(
c⁄fig
);

137 #i‡(
HAL_UART_SPI
 == 1)

138 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë
	`HÆUARTO≥nSPI
(
c⁄fig
);

140 #i‡(
HAL_UART_SPI
 == 2)

141 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë
	`HÆUARTO≥nSPI
(
c⁄fig
);

143 #i‡(
HAL_UART_USB
)

144 
	`HÆUARTO≥nUSB
(
c⁄fig
);

146 #i‡(
HAL_UART_DMA
 =0Ë&& (
HAL_UART_ISR
 =0Ë&& (
HAL_UART_SPI
 == 0)

148 (Ë
p‹t
;

149 (Ë
c⁄fig
;

152  
HAL_UART_SUCCESS
;

153 
	}
}

166 
uöt16
 
	$HÆUARTRód
(
uöt8
 
p‹t
, uöt8 *
buf
, 
uöt16
 
Àn
)

168 #i‡(
HAL_UART_DMA
 == 1)

169 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRódDMA
(
buf
, 
Àn
);

171 #i‡(
HAL_UART_DMA
 == 2)

172 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRódDMA
(
buf
, 
Àn
);

174 #i‡(
HAL_UART_ISR
 == 1)

175 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRódISR
(
buf
, 
Àn
);

177 #i‡(
HAL_UART_ISR
 == 2)

178 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRódISR
(
buf
, 
Àn
);

180 #i‡(
HAL_UART_SPI
 == 1)

181 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRódSPI
(
buf
, 
Àn
);

183 #i‡(
HAL_UART_SPI
 == 2)

184 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRódSPI
(
buf
, 
Àn
);

187 #i‡
HAL_UART_USB


188  
	`HÆUARTRx
(
buf
, 
Àn
);

190 #i‡(
HAL_UART_DMA
 =0Ë&& (
HAL_UART_ISR
 =0Ë&& (
HAL_UART_SPI
 == 0)

192 (Ë
p‹t
;

193 (Ë
buf
;

194 (Ë
Àn
;

198 
	}
}

211 
uöt16
 
	$HÆUARTWrôe
(
uöt8
 
p‹t
, uöt8 *
buf
, 
uöt16
 
Àn
)

213 #i‡(
HAL_UART_DMA
 == 1)

214 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTWrôeDMA
(
buf
, 
Àn
);

216 #i‡(
HAL_UART_DMA
 == 2)

217 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTWrôeDMA
(
buf
, 
Àn
);

219 #i‡(
HAL_UART_ISR
 == 1)

220 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTWrôeISR
(
buf
, 
Àn
);

222 #i‡(
HAL_UART_ISR
 == 2)

223 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTWrôeISR
(
buf
, 
Àn
);

225 #i‡(
HAL_UART_SPI
 == 1)

226 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTWrôeSPI
(
buf
, 
Àn
);

228 #i‡(
HAL_UART_SPI
 == 2)

229 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTWrôeSPI
(
buf
, 
Àn
);

232 #i‡
HAL_UART_USB


233 
	`HÆUARTTx
(
buf
, 
Àn
);

234  
Àn
;

236 #i‡(
HAL_UART_DMA
 =0Ë&& (
HAL_UART_ISR
 =0Ë&& (
HAL_UART_SPI
 == 0)

238 (Ë
p‹t
;

239 (Ë
buf
;

240 (Ë
Àn
;

244 
	}
}

255 
	$HÆUARTSu•íd
( )

257 #i‡
HAL_UART_ISR


258 
	`HÆUARTSu•ídISR
();

260 
	}
}

271 
	$HÆUARTResume
( )

273 #i‡
HAL_UART_ISR


274 
	`HÆUARTResumeISR
();

276 
	}
}

287 
	$HÆUARTPﬁl
()

289 #i‡(
HAL_UART_DMA
 && 
HAL_UART_SPI
)

290 i‡(
HAL_UART_PORT
)

292 
	`HÆUARTPﬁlSPI
();

296 
	`HÆUARTPﬁlDMA
();

299 #i‡
HAL_UART_DMA


300 
	`HÆUARTPﬁlDMA
();

302 #i‡
HAL_UART_ISR


303 
	`HÆUARTPﬁlISR
();

305 #i‡
HAL_UART_SPI


306 
	`HÆUARTPﬁlSPI
();

308 #i‡
HAL_UART_USB


309 
	`HÆUARTPﬁlUSB
();

312 
	}
}

323 
uöt16
 
	$HÆ_UART_RxBufLí
–
uöt8
 
p‹t
 )

325 #i‡(
HAL_UART_DMA
 == 1)

326 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRxAvaûDMA
();

328 #i‡(
HAL_UART_DMA
 == 2)

329 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRxAvaûDMA
();

331 #i‡(
HAL_UART_ISR
 == 1)

332 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRxAvaûISR
();

334 #i‡(
HAL_UART_ISR
 == 2)

335 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRxAvaûISR
();

337 #i‡(
HAL_UART_SPI
 == 1)

338 i‡(
p‹t
 =
HAL_UART_PORT_0
Ë 
	`HÆUARTRxAvaûSPI
();

340 #i‡(
HAL_UART_SPI
 == 2)

341 i‡(
p‹t
 =
HAL_UART_PORT_1
Ë 
	`HÆUARTRxAvaûSPI
();

344 #i‡
HAL_UART_USB


345  
	`HÆUARTRxAvaûUSB
();

347 #i‡(
HAL_UART_DMA
 =0Ë&& (
HAL_UART_ISR
 =0Ë&& (
HAL_UART_SPI
 == 0)

349 (Ë
p‹t
;

353 
	}
}

355 
	$HÆUARTI§DMA
()

357 #i‡(
HAL_UART_DMA
 && 
HAL_UART_SPI
)

358 i‡(
HAL_UART_PORT
)

360 
	`HÆUART_DMAI§SPI
();

364 
	`HÆUART_DMAI§DMA
();

366 #ñi‡
HAL_UART_DMA


367 
	`HÆUART_DMAI§DMA
();

368 #ñi‡
HAL_UART_SPI


369 
	`HÆUART_DMAI§SPI
();

371 
	}
}

	@Components/hal/target/CC2540USB/usb/class_cdc/usb_cdc.h

9 #i‚de‡
USB_CDC_H


10 
	#USB_CDC_H


	)

13 
	#CDC_DEVICE
 0x02

	)

16 
	#COMM_INTF
 0x02

	)

19 
	#ABSTRACT_CONTROL_MODEL
 0x02

	)

22 
	#V25TER
 0x01

23 

	)

26 
	#DATA_INTF
 0x0A

	)

29 
	#NO_PROTOCOL
 0x00

30 

	)

33 
	#ABSTRACT_STATE
 0x01

	)

34 
	#COUNTRY_SETTING
 0x02

	)

38 
	#CS_INTERFACE
 0x24

	)

39 
	#CS_ENDPOINT
 0x25

	)

42 
	#DSC_FN_HEADER
 0x00

	)

43 
	#DSC_FN_CALL_MGT
 0x01

	)

44 
	#DSC_FN_ACM
 0x02

45 
	#DSC_FN_DLM
 0x03

46 
	#DSC_FN_TELEPHONE_RINGER
 0x04

	)

47 
	#DSC_FN_RPT_CAPABILITIES
 0x05

	)

48 
	#DSC_FN_UNION
 0x06

	)

49 
	#DSC_FN_COUNTRY_SELECTION
 0x07

	)

50 
	#DSC_FN_TEL_OP_MODES
 0x08

	)

51 
	#DSC_FN_USB_TERMINAL
 0x09

	)

55 
	#CDC_COMM_INTF_ID
 0x00

	)

56 
	#CDC_DATA_INTF_ID
 0x01

	)

61 
	#CDC_SEND_ENCAPSULATED_COMMAND
 0x00

	)

62 
	#CDC_GET_ENCAPSULATED_RESPONSE
 0x01

	)

63 
	#CDC_SET_COMM_FEATURE
 0x02

64 
	#CDC_GET_COMM_FEATURE
 0x03

65 
	#CDC_CLEAR_COMM_FEATURE
 0x04

66 
	#CDC_SET_LINE_CODING
 0x20

67 
	#CDC_GET_LINE_CODING
 0x21

68 
	#CDC_SET_CONTROL_LINE_STATE
 0x22

69 
	#CDC_SEND_BREAK
 0x23

70 

	)

73 
	#CDC_CHAR_FORMAT_1_STOP_BIT
 0

	)

74 
	#CDC_CHAR_FORMAT_1_5_STOP_BIT
 1

	)

75 
	#CDC_CHAR_FORMAT_2_STOP_BIT
 2

	)

77 
	#CDC_PARITY_TYPE_NONE
 0

	)

78 
	#CDC_PARITY_TYPE_ODD
 1

	)

79 
	#CDC_PARITY_TYPE_EVEN
 2

	)

80 
	#CDC_PARITY_TYPE_MARK
 3

	)

81 
	#CDC_PARITY_TYPE_SPACE
 4

	)

	@Components/hal/target/CC2540USB/usb/class_cdc/usb_cdc_hooks.c

16 
	~"usb_cdc.h
"

17 
	~"usb_cdc_hooks.h
"

18 
	~"usb_fúmw¨e_libøry_hódîs.h
"

20 
	~"hÆ_ty≥s.h
"

24 
CDC_LINE_CODING_STRUCTURE
 
	gcuºítLöeCodög
;

32 
	$usb¸HookPro˚ssOut
()

35 i‡(
usbSëupHódî
.
ªque°
 =
CDC_SET_CONTROL_LINE_STATE
) {

37 if(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
)

39 
usbfwD©a
.
ï0Sètus
 = 
EP_RX
;

43 } if(
usbSëupHódî
.
ªque°
 =
CDC_SET_LINE_CODING
) {

45 if(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
)

47 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__xd©a
 *Ë&
cuºítLöeCodög
;

48 
usbfwD©a
.
ï0Sètus
 = 
EP_RX
;

50 if(
usbfwD©a
.
ï0Sètus
 =
EP_RX
) { }

54 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

56 
	}
}

59 
	$usb¸HookPro˚ssIn
()

62 i‡(
usbSëupHódî
.
ªque°
 =
CDC_GET_LINE_CODING
) {

64 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

65 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__xd©a
 *Ë&
cuºítLöeCodög
;

66 
usbSëupD©a
.
byãsLe·
 = 7;

67 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

69 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_TX
) {

73 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

75 
	}
}

78 
	$usbvrHookPro˚ssOut
(Ë{
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

79 
	$usbvrHookPro˚ssIn
(Ë{
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

82 
	$usb§HookSëDes¸ùt‹
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

83 
	$usb§HookSynchFøme
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

84 
	$usb§HookCÀ¨Fótuª
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

85 
	$usb§HookSëFótuª
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

86 
	$usb§HookModifyGëSètus
(
uöt8
 
ªcùõ¡
, uöt8 
ödex
, 
uöt16
 
__xd©a
 *
pSètus
Ë{ 
	}
}

90 
	$usb§HookPro˚ssEvít
(
uöt8
 
evít
, uöt8 
ödex
)

93 
evít
) {

94 
USBSR_EVENT_CONFIGURATION_CHANGING
 :

96 
USBSR_EVENT_CONFIGURATION_CHANGED
 :

98 
USBSR_EVENT_INTERFACE_CHANGING
 :

100 
USBSR_EVENT_INTERFACE_CHANGED
 :

102 
USBSR_EVENT_REMOTE_WAKEUP_ENABLED
 :

104 
USBSR_EVENT_REMOTE_WAKEUP_DISABLED
 :

106 
USBSR_EVENT_EPIN_STALL_CLEARED
 :

108 
USBSR_EVENT_EPIN_STALL_SET
 :

110 
USBSR_EVENT_EPOUT_STALL_CLEARED
 :

112 
USBSR_EVENT_EPOUT_STALL_SET
 :

115 
	}
}

118 
	$usbúqHookPro˚ssEvíts
()

121 
	}
}

	@Components/hal/target/CC2540USB/usb/class_cdc/usb_cdc_hooks.h

8 #i‚de‡
USB_CDC_HOOKS_H


9 
	#USB_CDC_HOOKS_H


	)

11 
	~"hÆ_ty≥s.h
"

14 
uöt32
 
	mdãR©e
;

15 
uöt8
 
	mch¨F‹m©
;

16 
uöt8
 
	m∑rôyTy≥
;

17 
uöt8
 
	md©aBôs
;

18 } 
	tCDC_LINE_CODING_STRUCTURE
;

20 
CDC_LINE_CODING_STRUCTURE
 
cuºítLöeCodög
;

	@Components/hal/target/CC2540USB/usb/class_cdc/usb_firmware_library_config.c

11 
	#USBFIRMWARELIBRARYCONFIG_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

23 
USB_DESCRIPTOR_MARKER
 
	gusbDes¸ùt‹M¨kî
= {

24 (
uöt8
 
__code
 *)&
usbDescSèπ
,

25 (
uöt8
 
__code
 *)&
usbDescEnd
,

26 (
DESC_LUT_INFO
 
__code
 *Ë&
usbDescLut
,

27 (
DESC_LUT_INFO
 
__code
 *Ë&
usbDescLutEnd
,

28 (
DBLBUF_LUT_INFO
 
__code
 *Ë&
usbDblbufLut
,

29 (
DBLBUF_LUT_INFO
 
__code
 *Ë&
usbDblbufLutEnd


	@Components/hal/target/CC2540USB/usb/class_cdc/usb_firmware_library_config.h

8 #i‚de‡
USBFIRMWARELIBRARYCONFIG_H


9 
	#USBFIRMWARELIBRARYCONFIG_H


10 

	)

26 
	#USB_SETUP_MAX_NUMBER_OF_INTERFACES
 5

	)

	@Components/hal/target/CC2540USB/usb/class_cdc/usb_firmware_library_headers.h

9 #i‚de‡
USB_FIRMWARE_LIBRARY_HEADERS_H


10 
	#USB_FIRMWARE_LIBRARY_HEADERS_H


	)

20 
	~"usb_fúmw¨e_libøry_c⁄fig.h
"

21 
	~"usb_des¸ùt‹.h
"

22 
	~"usb_des¸ùt‹_∑r£r.h
"

23 
	~"usb_öãºu±.h
"

24 
	~"usb_‰amew‹k.h
"

25 
	~"usb_ªg.h
"

26 
	~"usb_°™d¨d_ªque°s.h
"

27 
	~"usb_su•íd.h
"

	@Components/hal/target/CC2540USB/usb/class_hid/usb_class_requests.c

13 
	~"usb_˛ass_ªque°s.h
"

14 
	~"usb_hid_ªp‹ts.h
"

15 
	~"usb_‰amew‹k.h
"

25 
	$usb¸SëRï‹t
()

28 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

32 i‡((
	`HI_UINT16
(
usbSëupHódî
.
vÆue
Ë=
HID_REP_TYPE_OUTPUT
) &&

33 (
usbSëupHódî
.
ödex
 =
KEYBOARD_INDEX
) &&

34 (
usbSëupHódî
.
Àngth
 =(
KEYBOARD_OUT_REPORT
))) {

37 
usbfwD©a
.
ï0Sètus
 = 
EP_RX
;

38 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 *Ë&
hidD©a
.
keybﬂrdOutRï‹t
.
ÀdSètus
;

39 
usbSëupD©a
.
byãsLe·
 = 
usbSëupHódî
.
Àngth
;

45 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

50 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_RX
) {

61 
	}
}

71 
	$usb¸GëRï‹t
()

74 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

77 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

81 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_TX
) {

87 
	}
}

98 
	$usb¸SëPrŸocﬁ
()

101 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

104 i‡((
usbSëupHódî
.
vÆue
 & 0xFFFE) ||

105 (
usbSëupHódî
.
Àngth
 != 0) ||

106 (
usbSëupHódî
.
ödex
 > 
MOUSE_INDEX
)) {

109 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

114 
	`LO_UINT16
(
usbSëupHódî
.
ödex
)) {

116 
KEYBOARD_INDEX
:

117 
hidD©a
.
keybﬂrdPrŸocﬁ
 = 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
);

119 
MOUSE_INDEX
:

120 
hidD©a
.
mou£PrŸocﬁ
 = 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
);

131 
	}
}

142 
	$usb¸GëPrŸocﬁ
()

145 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

148 i‡((
usbSëupHódî
.
vÆue
 != 0) ||

149 (
usbSëupHódî
.
Àngth
 != 1) ||

150 (
usbSëupHódî
.
ödex
 > 
MOUSE_INDEX
)) {

153 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

158 
	`LO_UINT16
(
usbSëupHódî
.
ödex
)) {

160 
KEYBOARD_INDEX
:

161 
usbSëupD©a
.
pBuf„r
 = &
hidD©a
.
keybﬂrdPrŸocﬁ
;

163 
MOUSE_INDEX
:

164 
usbSëupD©a
.
pBuf„r
 = &
hidD©a
.
mou£PrŸocﬁ
;

169 
usbSëupD©a
.
byãsLe·
 = 1;

170 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

175 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_TX
) {

181 
	}
}

192 
	$usb¸SëIdÀ
()

195 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

198 i‡((
usbSëupHódî
.
Àngth
 != 0) ||

199 (
usbSëupHódî
.
ödex
 > 
MOUSE_INDEX
)) {

202 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

207 
	`LO_UINT16
(
usbSëupHódî
.
ödex
)) {

209 
KEYBOARD_INDEX
:

210 
hidD©a
.
keybﬂrdIdÀR©e
 = 
usbSëupHódî
.
vÆue
;

212 
MOUSE_INDEX
:

213 
hidD©a
.
mou£IdÀR©e
 = 
usbSëupHódî
.
vÆue
;

224 
	}
}

235 
	$usb¸GëIdÀ
()

238 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

241 i‡((
usbSëupHódî
.
Àngth
 != 1) ||

242 (
usbSëupHódî
.
ödex
 > 
MOUSE_INDEX
)) {

245 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

250 
	`LO_UINT16
(
usbSëupHódî
.
ödex
)) {

252 
KEYBOARD_INDEX
:

253 
usbSëupD©a
.
pBuf„r
 = 
	`LOBYTEPTR
(
hidD©a
.
keybﬂrdIdÀR©e
);

255 
MOUSE_INDEX
:

256 
usbSëupD©a
.
pBuf„r
 = 
	`LOBYTEPTR
(
hidD©a
.
mou£IdÀR©e
);

261 
usbSëupD©a
.
byãsLe·
 = 1;

262 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

267 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_TX
) {

273 
	}
}

	@Components/hal/target/CC2540USB/usb/class_hid/usb_class_requests.h

9 #i‚de‡
USB_CLASS_REQUEST


10 
	#USB_CLASS_REQUEST


	)

13 
	#KEYBOARD_INDEX
 0

	)

14 
	#MOUSE_INDEX
 1

	)

17 
	#GET_REPORT
 0x01

	)

18 
	#GET_IDLE
 0x02

	)

19 
	#GET_PROTOCOL
 0x03

	)

20 
	#SET_REPORT
 0x09

	)

21 
	#SET_IDLE
 0x0A

	)

22 
	#SET_PROTOCOL
 0x0B

	)

25 
	#HID_REP_TYPE_INPUT
 1

	)

26 
	#HID_REP_TYPE_OUTPUT
 2

	)

27 
	#HID_REP_TYPE_FEATURE
 3

	)

30 
	#HID_IDLE_INDEFINITE
 0x0000

	)

31 
	#HID_IDLE_NOT_SET
 0x00FF

32 

	)

34 
	#HID_PROTOCOL_BOOT
 0

	)

35 
	#HID_PROTOCOL_REPORT
 1

	)

39 
usb¸SëRï‹t
();

40 
usb¸SëPrŸocﬁ
();

41 
usb¸SëIdÀ
();

42 
usb¸GëRï‹t
();

43 
usb¸GëPrŸocﬁ
();

44 
usb¸GëIdÀ
();

	@Components/hal/target/CC2540USB/usb/class_hid/usb_firmware_library_config.c

11 
	#USBFIRMWARELIBRARYCONFIG_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

24 
USB_DESCRIPTOR_MARKER
 
	gusbDes¸ùt‹M¨kî
= {

25 (
uöt8
 
__code
 *)&
usbDescSèπ
,

26 (
uöt8
 
__code
 *)&
usbDescEnd
,

27 (
DESC_LUT_INFO
 
__code
 *Ë&
usbDescLut
,

28 (
DESC_LUT_INFO
 
__code
 *Ë&
usbDescLutEnd
,

29 (
DBLBUF_LUT_INFO
 
__code
 *Ë&
usbDblbufLut
,

	@Components/hal/target/CC2540USB/usb/class_hid/usb_firmware_library_config.h

9 #i‚de‡
USB_FIRMWARE_LIBRARY_CONFIG_H


10 
	#USB_FIRMWARE_LIBRARY_CONFIG_H


	)

38 #i‡!
deföed
 
USB_SETUP_MAX_NUMBER_OF_INTERFACES


39 
	#USB_SETUP_MAX_NUMBER_OF_INTERFACES
 2

	)

	@Components/hal/target/CC2540USB/usb/class_hid/usb_firmware_library_headers.h

9 #i‚de‡
RF_USB_LIBRARY_HEADERS_H


10 
	#RF_USB_LIBRARY_HEADERS_H


	)

20 
	~"hÆ_defs.h
"

21 
	~"hÆ_ty≥s.h
"

22 
	~"hÆ_bﬂrd.h
"

23 
	~"usb_fúmw¨e_libøry_c⁄fig.h
"

24 
	~"usb_des¸ùt‹.h
"

25 
	~"usb_des¸ùt‹_∑r£r.h
"

26 
	~"usb_öãºu±.h
"

27 
	~"usb_‰amew‹k.h
"

28 
	~"usb_ªg.h
"

29 
	~"usb_°™d¨d_ªque°s.h
"

30 
	~"usb_su•íd.h
"

	@Components/hal/target/CC2540USB/usb/class_hid/usb_hid.c

13 
	~"usb_fúmw¨e_libøry_hódîs.h
"

14 
	~"usb_hid_ªp‹ts.h
"

15 
	~"usb_˛ass_ªque°s.h
"

16 
	~"usb_hid.h
"

26 
	$usbHidInô
()

29 
	`usbúqInô
(0xFFFF);

30 
	`usbfwInô
();

31 
	}
}

35 
	$usbHidPro˚ssEvíts
()

38 i‡(
	`USBIRQ_GET_EVENT_MASK
(Ë& 
USBIRQ_EVENT_RESUME
) {

39 
	`USBIRQ_CLEAR_EVENTS
(
USBIRQ_EVENT_RESUME
);

40 i‡(
pFnSu•ídExôHook
!=
NULL
)

42 
	`pFnSu•ídExôHook
();

47 i‡(
	`USBIRQ_GET_EVENT_MASK
(Ë& 
USBIRQ_EVENT_RESET
) {

48 
	`USBIRQ_CLEAR_EVENTS
(0xFFFF);

49 
	`usbfwRe£tH™dÀr
();

53 i‡(
	`USBIRQ_GET_EVENT_MASK
(Ë& 
USBIRQ_EVENT_SUSPEND
) {

54 
	`USBIRQ_CLEAR_EVENTS
(
USBIRQ_EVENT_SUSPEND
);

55 i‡(
pFnSu•ídE¡îHook
!=
NULL
)

57 
	`pFnSu•ídE¡îHook
();

62 i‡(
	`USBIRQ_GET_EVENT_MASK
(Ë& 
USBIRQ_EVENT_SETUP
) {

63 
	`USBIRQ_CLEAR_EVENTS
(
USBIRQ_EVENT_SETUP
);

64 
	`usbfwSëupH™dÀr
();

66 
	}
}

	@Components/hal/target/CC2540USB/usb/class_hid/usb_hid.h

9 #i‚de‡
USB_HID_H


10 
	#USB_HID_H


	)

12 
	~"usb_fúmw¨e_libøry_c⁄fig.h
"

13 
	~"usb_hid_ªp‹ts.h
"

14 
	~"usb_˛ass_ªque°s.h
"

16 
usbHidInô
();

17 
usbHidPro˚ssEvíts
();

	@Components/hal/target/CC2540USB/usb/class_hid/usb_hid_hooks.c

15 
	~"usb_fúmw¨e_libøry_hódîs.h
"

16 
	~"usb_˛ass_ªque°s.h
"

30 
	$usb¸HookPro˚ssOut
()

33 
usbSëupHódî
.
ªque°
) {

34 
SET_REPORT
: 
	`usb¸SëRï‹t
(); ;

35 
SET_PROTOCOL
: 
	`usb¸SëPrŸocﬁ
(); ;

36 
SET_IDLE
: 
	`usb¸SëIdÀ
(); ;

37 : 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; ;

39 
	}
}

43 
	$usb¸HookPro˚ssIn
()

46 
usbSëupHódî
.
ªque°
) {

47 
GET_REPORT
: 
	`usb¸GëRï‹t
(); ;

48 
GET_PROTOCOL
: 
	`usb¸GëPrŸocﬁ
(); ;

49 
GET_IDLE
: 
	`usb¸GëIdÀ
(); ;

50 : 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; ;

52 
	}
}

56 
	$usbvrHookPro˚ssOut
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

57 
	$usbvrHookPro˚ssIn
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

60 
	$usb§HookSëDes¸ùt‹
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

61 
	$usb§HookSynchFøme
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

62 
	$usb§HookCÀ¨Fótuª
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

63 
	$usb§HookSëFótuª
(Ë{ 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; 
	}
}

64 
	$usb§HookModifyGëSètus
(
uöt8
 
ªcùõ¡
, uöt8 
ödex
, 
uöt16
 
__xd©a
 *
pSètus
)

66 ()
ªcùõ¡
;

67 ()
ödex
;

68 ()
pSètus
;

69 
	}
}

73 
	$usb§HookPro˚ssEvít
(
uöt8
 
evít
, uöt8 
ödex
)

75 ()
ödex
;

78 
evít
) {

79 
USBSR_EVENT_CONFIGURATION_CHANGING
 :

81 
USBSR_EVENT_CONFIGURATION_CHANGED
 :

83 
USBSR_EVENT_INTERFACE_CHANGING
 :

85 
USBSR_EVENT_INTERFACE_CHANGED
 :

87 
USBSR_EVENT_REMOTE_WAKEUP_ENABLED
 :

89 
USBSR_EVENT_REMOTE_WAKEUP_DISABLED
 :

91 
USBSR_EVENT_EPIN_STALL_CLEARED
 :

93 
USBSR_EVENT_EPIN_STALL_SET
 :

95 
USBSR_EVENT_EPOUT_STALL_CLEARED
 :

97 
USBSR_EVENT_EPOUT_STALL_SET
 :

100 
	}
}

104 
	$usbúqHookPro˚ssEvíts
()

107 
	}
}

	@Components/hal/target/CC2540USB/usb/class_hid/usb_hid_reports.c

9 
	~"usb_fúmw¨e_libøry_hódîs.h
"

10 
	~"usb_˛ass_ªque°s.h
"

11 
	~"usb_hid_ªp‹ts.h
"

14 
HID_DATA
 
	ghidD©a
 = {

15 .
keybﬂrdOutRï‹t
.
ÀdSètus
= 0,

16 .
	gkeybﬂrdPrŸocﬁ
 = 
HID_PROTOCOL_REPORT
,

17 .
	gmou£PrŸocﬁ
 = 
HID_PROTOCOL_REPORT
,

18 .
	gkeybﬂrdIdÀR©e
 = 
HID_IDLE_NOT_SET
,

19 .
	gmou£IdÀR©e
 = 
HID_IDLE_NOT_SET
,

22 
	#hÆI¡U∆ock
(
HIS
Ë
	`HAL_EXIT_CRITICAL_SECTION
((HIS))

	)

23 
hÆI¡Sèã_t
 
hÆI¡Lock
();

24 
hÆI¡Sèã_t
 
	$hÆI¡Lock
()

26 
hÆI¡Sèã_t
 
ötSèã
 = 
EA
;

27 
	`HAL_DISABLE_INTERRUPTS
();

28  
ötSèã
;

29 
	}
}

48 
uöt8
 
	$hidSídHidInRï‹t
(
uöt8
 *
pRï‹t
, uöt8 
ídPoöt
, uöt8 
Àn
)

50 
uöt8
 
ªsu…
 = 
FALSE
;

52 i‡(
ídPoöt
 < 6)

54 
uöt8
 
ó
 = 
	`hÆI¡Lock
();

56 
	`USBFW_SELECT_ENDPOINT
(
ídPoöt
);

57 i‡(!(
USBCSIL
 & 
USBCSIL_INPKT_RDY
))

59 
	`usbfwWrôeFifo
(((&
USBF0
Ë+ (
ídPoöt
 << 1)), 
Àn
, 
pRï‹t
);

60 
USBCSIL
 |
USBCSIL_INPKT_RDY
;

61 
ªsu…
 = 
TRUE
;

63 
	`hÆI¡U∆ock
(
ó
);

66  
ªsu…
;

67 
	}
}

	@Components/hal/target/CC2540USB/usb/class_hid/usb_hid_reports.h

9 #i‚de‡
USBHIDREPORTS_H


10 
	#USBHIDREPORTS_H


	)

12 
	~"hÆ_ty≥s.h
"

14 
	#USB_HID_KBD_EP
 1

15 
	#USB_HID_CC_EP
 2

16 
	#USB_HID_MOUSE_EP
 4

17 

	)

19 
uöt8
 
	mÀdSètus
;

20 } 
	tKEYBOARD_OUT_REPORT
;

23 
uöt8
 
	mmodifõrs
;

24 
uöt8
 
	mª£rved
;

25 
uöt8
 
	mpKeyCodes
[6];

26 } 
	tKEYBOARD_IN_REPORT
;

29 
uöt8
 
	mbuâ⁄s
;

30 
öt8
 
	mdX
;

31 
öt8
 
	mdY
;

32 
öt8
 
	mdZ
;

33 } 
	tMOUSE_IN_REPORT
;

37 
KEYBOARD_OUT_REPORT
 
	mkeybﬂrdOutRï‹t
;

38 
uöt8
 
	mkeybﬂrdPrŸocﬁ
;

39 
uöt8
 
	mmou£PrŸocﬁ
;

40 
uöt16
 
	mkeybﬂrdIdÀR©e
;

41 
uöt16
 
	mmou£IdÀR©e
;

42 } 
	tHID_DATA
;

45 
HID_DATA
 
hidD©a
;

47 
uöt8
 
hidSídHidInRï‹t
(uöt8 *
pRï‹t
, uöt8 
ídPoöt
, uöt8 
Àn
);

48 
hidShowKeybﬂrdLeds
();

	@Components/hal/target/CC2540USB/usb/library/cc2540/usb_board_cfg.h

41 #i‚de‡
USB_BOARD_CFG_H


42 
	#USB_BOARD_CFG_H


	)

49 
	~"hÆ_bﬂrd_cfg.h
"

50 
	~"hÆ_mcu.h
"

51 
	~"ioCC2540.h
"

52 
	~"usb_ªg.h
"

59 
	#HAL_BOARD_IO_USB_ENABLE_PORT
 1

60 
	#HAL_BOARD_IO_USB_ENABLE_PIN
 0

	)

62 
	#BIT0
 0x01

	)

63 
	#BIT1
 0x02

	)

64 
	#BIT2
 0x04

	)

65 
	#BIT3
 0x08

	)

66 
	#BIT4
 0x10

	)

67 
	#BIT5
 0x20

	)

68 
	#BIT6
 0x40

	)

69 
	#BIT7
 0x80

	)

71 #i‡!
deföed
 
HAL_UART_USB_SUSPEND


72 
	#HAL_UART_USB_SUSPEND
 
FALSE


	)

80 
	#HAL_USB_ENABLE
(Ë
	`°
–
USBCTRL

USBCTRL_PLL_EN
 | 
USBCTRL_USB_EN
; \

81 !(
USBCTRL
&
USBCTRL_PLL_LOCKED
)); )

	)

82 
	#HAL_USB_PLL_DISABLE
(Ë
	`°
–
USBCTRL
&~
USBCTRL_PLL_EN
; \

83 
USBCTRL
&
USBCTRL_PLL_LOCKED
); )

	)

84 
	#HAL_USB_DISABLE
 
	`°
(
USBCTRL
 = 0; USBCTRL & 0x80);)

	)

86 
	#HAL_USB_PULLUP_ENABLE
() \

87 
	`MCU_IO_OUTPUT
(
HAL_BOARD_IO_USB_ENABLE_PORT
, 
HAL_BOARD_IO_USB_ENABLE_PIN
, 1)

	)

88 
	#HAL_USB_PULLUP_DISABLE
() \

89 
	`MCU_IO_OUTPUT
(
HAL_BOARD_IO_USB_ENABLE_PORT
, 
HAL_BOARD_IO_USB_ENABLE_PIN
, 0)

	)

91 
	#HAL_USB_INT_ENABLE
(Ë
	`°
–
P2IEN
|0x20; 
IEN2
|0x02; )

	)

92 
	#HAL_USB_INT_DISABLE
(Ë
	`°
–
P2IEN
&~0x20; )

	)

93 
	#HAL_USB_INT_CLEAR
(Ë
	`°
–
P2IFG
0; 
P2IF
0; )

	)

95 
	#HAL_USB_RESUME_INT_ENABLE
(Ë
	`°
 ( 
USBCIE
 |0x02; )

	)

96 
	#HAL_USB_RESUME_INT_DISABLE
(Ë
	`°
 ( 
USBCIE
 &~0x02; )

	)

98 
	#USBCTRL_PLL_LOCKED
 0x80

	)

99 
	#USBCTRL_PLL_EN
 0x02

	)

100 
	#USBCTRL_USB_EN
 0x01

	)

102 
	#P2IFG_DPIF
 0x20

	)

104 
	#CC2540_IS_XOSC_STABLE
(Ë(
SLEEPSTA
 & 
XOSC_STB
)

	)

106 
	#NOP
(Ë
	`asm
("NOP")

	)

107 
	#MCU_IO_TRISTATE
 1

108 
	#MCU_IO_PULLUP
 2

	)

109 
	#MCU_IO_PULLDOWN
 3

	)

114 
	#MCU_IO_PERIPHERAL
(
p‹t
, 
pö
Ë
	`MCU_IO_PERIPHERAL_PREP
’‹t,Öö)

	)

115 
	#MCU_IO_INPUT
(
p‹t
, 
pö
, 
func
Ë
	`MCU_IO_INPUT_PREP
’‹t,Öö, func)

	)

116 
	#MCU_IO_OUTPUT
(
p‹t
, 
pö
, 
vÆ
Ë
	`MCU_IO_OUTPUT_PREP
’‹t,Öö, vÆ)

	)

117 
	#MCU_IO_SET
(
p‹t
, 
pö
, 
vÆ
Ë
	`MCU_IO_SET_PREP
’‹t,Öö, vÆ)

	)

118 
	#MCU_IO_SET_HIGH
(
p‹t
, 
pö
Ë
	`MCU_IO_SET_HIGH_PREP
’‹t,Öö)

	)

119 
	#MCU_IO_SET_LOW
(
p‹t
, 
pö
Ë
	`MCU_IO_SET_LOW_PREP
’‹t,Öö)

	)

120 
	#MCU_IO_TGL
(
p‹t
, 
pö
Ë
	`MCU_IO_TGL_PREP
’‹t,Öö)

	)

121 
	#MCU_IO_GET
(
p‹t
, 
pö
Ë
	`MCU_IO_GET_PREP
’‹t,Öö)

	)

123 
	#MCU_IO_DIR_INPUT
(
p‹t
, 
pö
Ë
	`MCU_IO_DIR_INPUT_PREP
’‹t,Öö)

	)

124 
	#MCU_IO_DIR_OUTPUT
(
p‹t
, 
pö
Ë
	`MCU_IO_DIR_OUTPUT_PREP
’‹t,Öö)

	)

129 
	#MCU_IO_PERIPHERAL_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
SEL
 |
	`BV
’ö); )

	)

131 
	#MCU_IO_INPUT_PREP
(
p‹t
, 
pö
, 
func
Ë
	`°
–
P
##p‹t##
SEL
 &~
	`BV
(pin); \

132 
P
##
p‹t
##
DIR
 &~
	`BV
(
pö
); \

133 
func
) { \

134 
MCU_IO_PULLUP
: \

135 
P
##
p‹t
##
INP
 &~
	`BV
(
pö
); \

136 
P2INP
 &~
	`BV
(
p‹t
 + 5); \

138 
MCU_IO_PULLDOWN
: \

139 
P
##
p‹t
##
INP
 &~
	`BV
(
pö
); \

140 
P2INP
 |
	`BV
(
p‹t
 + 5); \

143 
P
##
p‹t
##
INP
 |
	`BV
(
pö
); \

144 ; } )

	)

146 
	#MCU_IO_OUTPUT_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
SEL
 &~
	`BV
(pin); \

147 
P
##
p‹t
##
_
##
pö
## = 
vÆ
; \

148 
P
##
p‹t
##
DIR
 |
	`BV
(
pö
); )

	)

150 
	#MCU_IO_SET_HIGH_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## = 1; )

	)

151 
	#MCU_IO_SET_LOW_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## = 0; )

	)

153 
	#MCU_IO_SET_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
_
##pö## = vÆ; )

	)

154 
	#MCU_IO_TGL_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## ^1; )

	)

155 
	#MCU_IO_GET_PREP
(
p‹t
, 
pö
Ë(
P
##p‹t## & 
	`BV
’ö))

	)

157 
	#MCU_IO_DIR_INPUT_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
DIR
 &~
	`BV
’ö); )

	)

158 
	#MCU_IO_DIR_OUTPUT_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
DIR
 |
	`BV
’ö); )

	)

	@Components/hal/target/CC2540USB/usb/library/cc2540/usb_interrupt.c

11 
	#USBINTERRUPT_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

13 
	~"usb_bﬂrd_cfg.h
"

14 
	~"hÆ_Êash.h
"

15 
	~"hÆ_Àd.h
"

27 
	$usbúqInô
(
uöt16
 
úqMask
)

30 
usbúqD©a
.
evítMask
 = 0x0000;

31 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

32 
usbúqD©a
.
úqMask
 = irqMask;

35 
USBCIE
 = 
úqMask
;

36 
USBIIE
 = 
úqMask
 >> 4;

37 
USBOIE
 = (
úqMask
 >> 9) & 0x3E;

39 
	`HAL_USB_INT_CLEAR
();

40 
	`HAL_USB_INT_ENABLE
();

42 
	}
}

51 #i‡
deföed
 
HAL_USB_BOOT_CODE


52 
	$usbúqH™dÀr
()

54 #¥agm®
ve˘‹
=
P2INT_VECTOR


55 
__öãºu±
 
	$usbúqH™dÀr
()

58 
uöt8
 
usbcif
;

61 !
	`CC2540_IS_XOSC_STABLE
());

64 
usbcif
 = 
USBCIF
;

65 i‡(
usbcif
 & 
USBCIF_RSTIF
) {

69 
USBCIE
 = 
usbúqD©a
.
úqMask
;

70 
USBIIE
 = 
usbúqD©a
.
úqMask
 >> 4;

71 
USBOIE
 = (
usbúqD©a
.
úqMask
 >> 9) & 0x3E;

74 
USBPOW
 |
USBPOW_SUSPEND_EN
;

78 
usbúqD©a
.
evítMask
 |(
uöt16
Ë
usbcif
;

79 
usbúqD©a
.
evítMask
 |(
uöt16
Ë
USBIIF
 << 4;

80 
usbúqD©a
.
evítMask
 |(
uöt16
Ë
USBOIF
 << 9;

85 i‡(
usbcif
 & 
USBCIF_SUSPENDIF
) {

86 
usbúqD©a
.
öSu•íd
 = 
TRUE
;

88 i‡(
usbcif
 & (
USBCIF_RSTIF
 | 
USBCIF_RESUMEIF
)) {

89 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

91 i‡(
P2IFG
 & 
P2IFG_DPIF
) {

93 
P2IFG
 = ~
P2IFG_DPIF
;

94 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

98 
	`usbúqHookPro˚ssEvíts
();

101 
	`HAL_USB_INT_CLEAR
();

103 
	}
}

	@Components/hal/target/CC2540USB/usb/library/cc2540/usb_suspend.c

11 
	~"usb_fúmw¨e_libøry_hódîs.h
"

12 
	~"hÆ_bﬂrd.h
"

13 
	~"hÆ_mcu.h
"

14 
	~"hÆ_Àd.h
"

16 
__xd©a
 
VFPTR
 
	gpFnSu•ídE¡îHook

NULL
;

17 
__xd©a
 
VFPTR
 
	gpFnSu•ídExôHook

NULL
;

19 #i‡
HAL_UART_USB_SUSPEND


20 
hÆE¡îPowîMode
();

30 
	$usbsu•E¡î
()

32 i‡(
pFnSu•ídE¡îHook
!=
NULL
)

33 
	`pFnSu•ídE¡îHook
();

35 
	`HAL_USB_INT_CLEAR
();

36 
	`HAL_USB_INT_ENABLE
();

39 
	`HAL_USB_PLL_DISABLE
();

41 
	`HAL_LED_CLR_1
();

45 
SLEEPCMD
 = 0x05;

46 
	`hÆE¡îPowîMode
();

47 }  
usbúqD©a
.
öSu•íd
 );

52 !
	`CC2540_IS_XOSC_STABLE
());

55 
	`HAL_USB_ENABLE
();

57 i‡(
pFnSu•ídExôHook
!=
NULL
)

58 
	`pFnSu•ídExôHook
();

59 
	}
}

76 
uöt8
 
	$usbsu•DoRemŸeWakeup
()

78 
	`hÆMcuWaôMs
(
uöt16
 
m£c
);

79 
hÆI¡Sèã_t
 
ötSèã
;

82 i‡(!
usbfwD©a
.
ªmŸeWakeup
Ë 
FALSE
;

84 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

87 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

90 
USBPOW
 |
USBPOW_RESUME
;

91 
	`hÆMcuWaôMs
(10);

92 
USBPOW
 &~
USBPOW_RESUME
;

95 
	`HAL_USB_INT_CLEAR
();

97 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

99  
TRUE
;

101 
	}
}

	@Components/hal/target/CC2540USB/usb/library/cc2540_hid/usb_board_cfg.h

41 #i‚de‡
USB_BOARD_CFG_H


42 
	#USB_BOARD_CFG_H


	)

49 
	~"hÆ_bﬂrd_cfg.h
"

50 
	~"hÆ_mcu.h
"

51 
	~"ioCC2540.h
"

52 
	~"usb_ªg.h
"

59 
	#HAL_BOARD_IO_USB_ENABLE_PORT
 1

60 
	#HAL_BOARD_IO_USB_ENABLE_PIN
 0

	)

62 
	#BIT0
 0x01

	)

63 
	#BIT1
 0x02

	)

64 
	#BIT2
 0x04

	)

65 
	#BIT3
 0x08

	)

66 
	#BIT4
 0x10

	)

67 
	#BIT5
 0x20

	)

68 
	#BIT6
 0x40

	)

69 
	#BIT7
 0x80

	)

76 
	#HAL_BOARD_STABLE
(Ë(
CLKCONSTA
 =(
CLKCONCMD_32MHZ
 | 
OSC_32KHZ
))

	)

80 
	#HAL_USB_ENABLE
(Ë
	`°
( \

81 !
	`HAL_BOARD_STABLE
()); \

82 
USBCTRL
 = 
USBCTRL_USB_EN
 | 
USBCTRL_PLL_EN
; \

83 !(
USBCTRL
 & 
USBCTRL_PLL_LOCKED
)); \

84 )

	)

86 
	#HAL_USB_RUN
(Ë
	`°
( \

87 
	`HAL_USB_PULLUP_ENABLE
(); \

88 
	`HAL_USB_INT_CLEAR
(); \

89 
	`HAL_USB_INT_ENABLE
(); \

90 )

	)

92 
	#HAL_USB_PLL_DISABLE
(Ë
	`°
–
USBCTRL
 &~
USBCTRL_PLL_EN
; USBCTRL & 
USBCTRL_PLL_LOCKED
); )

	)

93 
	#HAL_USB_DISABLE
 
	`°
–
USBCTRL
 = 0; USBCTRL & 
USBCTRL_PLL_LOCKED
); )

	)

95 
	#HAL_USB_PULLUP_ENABLE
() \

96 
	`MCU_IO_OUTPUT
(
HAL_BOARD_IO_USB_ENABLE_PORT
, 
HAL_BOARD_IO_USB_ENABLE_PIN
, 1)

	)

97 
	#HAL_USB_PULLUP_DISABLE
() \

98 
	`MCU_IO_OUTPUT
(
HAL_BOARD_IO_USB_ENABLE_PORT
, 
HAL_BOARD_IO_USB_ENABLE_PIN
, 0)

	)

100 
	#HAL_USB_INT_ENABLE
(Ë
	`°
–
P2IEN
|0x20; 
IEN2
|0x02; )

	)

101 
	#HAL_USB_INT_DISABLE
(Ë
	`°
–
P2IEN
&~0x20; )

	)

102 
	#HAL_USB_INT_CLEAR
(Ë
	`°
–
P2IFG
0; 
P2IF
0; )

	)

104 
	#HAL_USB_RESUME_INT_ENABLE
(Ë
	`°
 ( 
USBCIE
 |0x02; )

	)

105 
	#HAL_USB_RESUME_INT_DISABLE
(Ë
	`°
 ( 
USBCIE
 &~0x02; )

	)

107 
	#USBCTRL_PLL_LOCKED
 0x80

	)

108 
	#USBCTRL_PLL_EN
 0x02

	)

109 
	#USBCTRL_USB_EN
 0x01

	)

111 
	#P2IFG_DPIF
 0x20

	)

113 
	#CC2540_IS_XOSC_STABLE
(Ë(
SLEEPSTA
 & 
XOSC_STB
)

	)

115 
	#NOP
(Ë
	`asm
("NOP")

	)

116 
	#MCU_IO_TRISTATE
 1

117 
	#MCU_IO_PULLUP
 2

	)

118 
	#MCU_IO_PULLDOWN
 3

	)

123 
	#MCU_IO_PERIPHERAL
(
p‹t
, 
pö
Ë
	`MCU_IO_PERIPHERAL_PREP
’‹t,Öö)

	)

124 
	#MCU_IO_INPUT
(
p‹t
, 
pö
, 
func
Ë
	`MCU_IO_INPUT_PREP
’‹t,Öö, func)

	)

125 
	#MCU_IO_OUTPUT
(
p‹t
, 
pö
, 
vÆ
Ë
	`MCU_IO_OUTPUT_PREP
’‹t,Öö, vÆ)

	)

126 
	#MCU_IO_SET
(
p‹t
, 
pö
, 
vÆ
Ë
	`MCU_IO_SET_PREP
’‹t,Öö, vÆ)

	)

127 
	#MCU_IO_SET_HIGH
(
p‹t
, 
pö
Ë
	`MCU_IO_SET_HIGH_PREP
’‹t,Öö)

	)

128 
	#MCU_IO_SET_LOW
(
p‹t
, 
pö
Ë
	`MCU_IO_SET_LOW_PREP
’‹t,Öö)

	)

129 
	#MCU_IO_TGL
(
p‹t
, 
pö
Ë
	`MCU_IO_TGL_PREP
’‹t,Öö)

	)

130 
	#MCU_IO_GET
(
p‹t
, 
pö
Ë
	`MCU_IO_GET_PREP
’‹t,Öö)

	)

132 
	#MCU_IO_DIR_INPUT
(
p‹t
, 
pö
Ë
	`MCU_IO_DIR_INPUT_PREP
’‹t,Öö)

	)

133 
	#MCU_IO_DIR_OUTPUT
(
p‹t
, 
pö
Ë
	`MCU_IO_DIR_OUTPUT_PREP
’‹t,Öö)

	)

138 
	#MCU_IO_PERIPHERAL_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
SEL
 |
	`BV
’ö); )

	)

140 
	#MCU_IO_INPUT_PREP
(
p‹t
, 
pö
, 
func
Ë
	`°
–
P
##p‹t##
SEL
 &~
	`BV
(pin); \

141 
P
##
p‹t
##
DIR
 &~
	`BV
(
pö
); \

142 
func
) { \

143 
MCU_IO_PULLUP
: \

144 
P
##
p‹t
##
INP
 &~
	`BV
(
pö
); \

145 
P2INP
 &~
	`BV
(
p‹t
 + 5); \

147 
MCU_IO_PULLDOWN
: \

148 
P
##
p‹t
##
INP
 &~
	`BV
(
pö
); \

149 
P2INP
 |
	`BV
(
p‹t
 + 5); \

152 
P
##
p‹t
##
INP
 |
	`BV
(
pö
); \

153 ; } )

	)

155 
	#MCU_IO_OUTPUT_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
SEL
 &~
	`BV
(pin); \

156 
P
##
p‹t
##
_
##
pö
## = 
vÆ
; \

157 
P
##
p‹t
##
DIR
 |
	`BV
(
pö
); )

	)

159 
	#MCU_IO_SET_HIGH_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## = 1; )

	)

160 
	#MCU_IO_SET_LOW_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## = 0; )

	)

162 
	#MCU_IO_SET_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
_
##pö## = vÆ; )

	)

163 
	#MCU_IO_TGL_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## ^1; )

	)

164 
	#MCU_IO_GET_PREP
(
p‹t
, 
pö
Ë(
P
##p‹t## & 
	`BV
’ö))

	)

166 
	#MCU_IO_DIR_INPUT_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
DIR
 &~
	`BV
’ö); )

	)

167 
	#MCU_IO_DIR_OUTPUT_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
DIR
 |
	`BV
’ö); )

	)

	@Components/hal/target/CC2540USB/usb/library/cc2540_hid/usb_interrupt.c

11 
	#USBINTERRUPT_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

13 
	~"usb_bﬂrd_cfg.h
"

25 
	$usbúqInô
(
uöt16
 
úqMask
)

27 
usbúqD©a
.
evítMask
 = 0x0000;

28 
usbúqD©a
.
úqMask
 = irqMask;

29 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

30 
	}
}

39 #i‡
deföed
 
HAL_USB_BOOT_CODE


40 
	$usbúqH™dÀr
()

42 #¥agm®
ve˘‹
=
P2INT_VECTOR


43 
__öãºu±
 
	$usbúqH™dÀr
()

46 
uöt16
 
evítMask
;

47 
uöt8
 
usbcif
;

49 
	`HAL_ENTER_ISR
();

50 
	`HAL_USB_ENABLE
();

51 
usbcif
 = 
USBCIF
;

53 i‡((
usbcif
 & (
USBCIF_RSTIF
 | 
USBCIF_RESUMEIF
)Ë|| (
P2IFG
 & 
P2IFG_DPIF
)) {

54 i‡(
usbcif
 & 
USBCIF_RSTIF
) {

57 
USBCIE
 = 
usbúqD©a
.
úqMask
;

58 
USBIIE
 = 
usbúqD©a
.
úqMask
 >> 4;

59 
USBOIE
 = (
usbúqD©a
.
úqMask
 >> 9) & 0x3E;

62 
USBPOW
 |
USBPOW_SUSPEND_EN
;

65 
usbcif
 |
USBCIF_RESUMEIF
;

66 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

68 i‡(
usbcif
 & 
USBCIF_SUSPENDIF
) {

69 
	`HAL_USB_PLL_DISABLE
();

70 
usbúqD©a
.
öSu•íd
 = 
TRUE
;

73 
evítMask
 = 
usbcif
;

74 
evítMask
 |(
uöt16
)
USBIIF
 << 4;

75 
evítMask
 |(
uöt16
)
USBOIF
 << 9;

76 
usbúqD©a
.
evítMask
 |=ÉventMask;

78 
	`HAL_USB_INT_CLEAR
();

79 
	`HAL_EXIT_ISR
();

80 
	}
}

	@Components/hal/target/CC2540USB/usb/library/cc2540_hid/usb_suspend.c

11 
	~"usb_fúmw¨e_libøry_hódîs.h
"

12 
	~"usb_bﬂrd_cfg.h
"

13 
	~"hÆ_¶ìp.h
"

15 
__xd©a
 
VFPTR
 
	gpFnSu•ídE¡îHook

NULL
;

16 
__xd©a
 
VFPTR
 
	gpFnSu•ídExôHook

NULL
;

31 #¥agm®
›timize
=
n⁄e


32 
	$hÆMcuWaôMs
(
uöt16
 
m£c
)

34 
m£c
--)

36 
	`hÆSÀïWaô
(1000);

38 
	}
}

52 
uöt8
 
	$usbsu•DoRemŸeWakeup
()

54 
hÆI¡Sèã_t
 
ötSèã
;

55 
uöt8
 
exô
 = 
FALSE
;

57 i‡(!
usbfwD©a
.
ªmŸeWakeup
Ë 
FALSE
;

59 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

61 i‡(
usbúqD©a
.
öSu•íd
)

63 
	`HAL_USB_ENABLE
();

64 
USBPOW
 |
USBPOW_RESUME
;

65 
	`hÆMcuWaôMs
(10);

66 
USBPOW
 &~
USBPOW_RESUME
;

67 
exô
 = 
TRUE
;

70 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

72 i‡(
exô
 && (
pFnSu•ídExôHook
!=
NULL
))

74 
	`pFnSu•ídExôHook
();

77  
TRUE
;

78 
	}
}

	@Components/hal/target/CC2540USB/usb/library/usb/usb_descriptor_parser.c

11 
	#USBDESCRIPTORPARSER_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

14 
	#BLE_INFO_PAGE_BDADDR
 0x780C

15 
	#BLE_INFO_PAGE_BDADDR_LEN
 8

	)

16 
	#BLE_INFO_PAGE_WAFER_INFO
 0x7FF4

	)

20 
USBDP_DATA
 
__xd©a
 
	gusbdpD©a
;

26 c⁄° 
uöt8
 
	gœnguageId
[4] = {

28 
DESC_TYPE_STRING
,

33 c⁄° 
uöt8
 
	gm™uÁ˘uªr
[36] = {

35 
DESC_TYPE_STRING
,

56 c⁄° 
uöt8
 
	g¥odu˘
[36] = {

58 
DESC_TYPE_STRING
,

79 
uöt8
 
	g£rülNumbî
[42] = {

81 
DESC_TYPE_STRING
,

108 
	$usbdpInô
()

110 
usbdpD©a
.
pDesc
 = (c⁄° 
uöt8
 
__code
 *Ë
usbDes¸ùt‹M¨kî
.
pUsbDescSèπ
;

111 
	}
}

138 
__code
* 
	$usbdpFödNext
(
uöt8
 
w™ãdTy≥
, uöt8 
hÆtAtTy≥
)

140 
__code
 *
pResu…
;

141 
pResu…
 = 
NULL
;

144 
usbdpD©a
.
pDesc
 !(
__code
 *Ë
usbDes¸ùt‹M¨kî
.
pUsbDescEnd
) {

147 i‡(
usbdpD©a
.
pDesc
[
DESC_TYPE_IDX
] =
w™ãdTy≥
) {

148 
pResu…
 = (
__code
*Ë
usbdpD©a
.
pDesc
;

149 
usbdpD©a
.
pDesc
 +usbdpD©a.pDesc[
DESC_LENGTH_IDX
];

153 } i‡(
usbdpD©a
.
pDesc
[
DESC_TYPE_IDX
] =
hÆtAtTy≥
) {

154 i‡(
hÆtAtTy≥
) ;

158 
usbdpD©a
.
pDesc
 +usbdpD©a.pDesc[
DESC_LENGTH_IDX
];

161  
pResu…
;

162 
	}
}

174 
USB_DEVICE_DESCRIPTOR
 
__code
* 
	$usbdpGëDevi˚Desc
()

176 
	`usbdpInô
();

177  
	`usbdpFödNext
(
DESC_TYPE_DEVICE
, 0);

178 
	}
}

200 
USB_CONFIGURATION_DESCRIPTOR
 
__code
* 
	$usbdpGëC⁄figuøti⁄Desc
(
uöt8
 
cfgVÆue
, uöt8 
cfgIndex
)

202 
USB_CONFIGURATION_DESCRIPTOR
 
__code
 *
pC⁄figuøti⁄Desc
;

203 
	`usbdpInô
();

206 
pC⁄figuøti⁄Desc
 = 
	`usbdpFödNext
(
DESC_TYPE_CONFIG
, 0)) {

209 i‡(
cfgVÆue
) {

210 i‡(
cfgVÆue
 =
pC⁄figuøti⁄Desc
->
bC⁄figuøti⁄VÆue
) ;

213 } i‡(!
cfgIndex
--) {

218  
pC⁄figuøti⁄Desc
;

219 
	}
}

242 
USB_INTERFACE_DESCRIPTOR
 
__code
* 
	$usbdpGëI¡îÁ˚Desc
(
uöt8
 
cfgVÆue
, uöt8 
ötNumbî
, uöt8 
ÆtSëtög
)

244 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚Desc
;

247 
	`usbdpGëC⁄figuøti⁄Desc
(
cfgVÆue
, 0);

250 
pI¡îÁ˚Desc
 = 
	`usbdpFödNext
(
DESC_TYPE_INTERFACE
, 
DESC_TYPE_CONFIG
)) {

251 i‡((
pI¡îÁ˚Desc
->
bI¡îÁ˚Numbî
 =
ötNumbî
Ë&& (pI¡îÁ˚Desc->
bA…î«ãSëtög
 =
ÆtSëtög
)) {

256  
pI¡îÁ˚Desc
;

257 
	}
}

272 
USB_STRING_DESCRIPTOR
 *
	$usbdpGëSåögDesc
(
uöt8
 
°rIndex
)

274 
USB_STRING_DESCRIPTOR
 *
pSåögDesc
 = 
NULL
;

276 #ifde‡
MS_EXT_C_ID


289 
°rIndex
)

292 
pSåögDesc
 = (
USB_STRING_DESCRIPTOR
 *)
œnguageId
;

296 
pSåögDesc
 = (
USB_STRING_DESCRIPTOR
 *)
m™uÁ˘uªr
;

300 
pSåögDesc
 = (
USB_STRING_DESCRIPTOR
 *)
¥odu˘
;

304 i‡(
£rülNumbî
[0] == 0)

306 
uöt8
 
bdAddr
[ 8 ], 
i
;

307 
uöt16
 
tmp
;

310 
i
=0; i<
BLE_INFO_PAGE_BDADDR_LEN
; i++)

312 
bdAddr
[
i
] = ((
uöt8
 *)
BLE_INFO_PAGE_BDADDR
)[i];

316 i‡–(
bdAddr
[0] == 0xFF) && (bdAddr[1] == 0xFF) &&

317 (
bdAddr
[2] == 0xFF) && (bdAddr[3] == 0xFF) &&

318 (
bdAddr
[4] == 0xFF) && (bdAddr[5] == 0xFF) &&

319 (
bdAddr
[6] == 0xFF) && (bdAddr[7] == 0xFF) )

322 
i
=0; i<
BLE_INFO_PAGE_BDADDR_LEN
; i++)

324 
bdAddr
[
i
] = ((
uöt8
 *)
BLE_INFO_PAGE_WAFER_INFO
)[i];

328 
i
=2; i<42; i+=2)

330 i‡(((
i
-2) % 10) == 0)

332 
uöt8
 
j
 = (
i
-2) / 5;

333 
tmp
 = 
	`BUILD_UINT16
(
bdAddr
[
j
], bdAddr[j+1]);

336 
£rülNumbî
[
i
] = '0' + (
tmp
 % 10);

337 
tmp
 /= 10;

339 
£rülNumbî
[0] = 42;

341 
pSåögDesc
 = (
USB_STRING_DESCRIPTOR
 *)
£rülNumbî
;

350  
pSåögDesc
;

351 
	}
}

	@Components/hal/target/CC2540USB/usb/library/usb/usb_descriptor_parser.h

9 #i‚de‡
USBDESCRIPTORPARSER_H


10 
	#USBDESCRIPTORPARSER_H


	)

63 
	~"usb_des¸ùt‹.h
"

72 
	#DESC_LENGTH_IDX
 0

73 
	#DESC_TYPE_IDX
 1

74 
	#DESC_CONFIG_LENGTH_LSB_IDX
 2

75 
	#DESC_CONFIG_LENGTH_MSB_IDX
 3

78 

	)

82 
usbdpInô
();

83 
__code
 *
usbdpFödNext
(
uöt8
 
w™ãdTy≥
, uöt8 
hÆtAtTy≥
);

85 
USB_DEVICE_DESCRIPTOR
 
__code
* 
usbdpGëDevi˚Desc
();

86 
USB_CONFIGURATION_DESCRIPTOR
 
__code
* 
usbdpGëC⁄figuøti⁄Desc
(
uöt8
 
cfgVÆue
, uöt8 
cfgIndex
);

87 
USB_INTERFACE_DESCRIPTOR
 
__code
* 
usbdpGëI¡îÁ˚Desc
(
uöt8
 
cfgVÆue
, uöt8 
ötNumbî
, uöt8 
ÆtSëtög
);

88 
USB_STRING_DESCRIPTOR
 *
usbdpGëSåögDesc
(
uöt8
 
°rIndex
);

	@Components/hal/target/CC2540USB/usb/library/usb/usb_framework.c

11 
	#USBFRAMEWORK_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

13 
	~"usb_bﬂrd_cfg.h
"

16 
VFPTR
 
__d©a
 
	gPro˚ssFunc
;

25 
	$usbfwInô
()

28 
usbfwD©a
.
£lfPowîed
 = (
	`usbdpGëC⁄figuøti⁄Desc
(1, 0)->
bmAâribuãs
 & 0x40Ë? 
TRUE
 : 
FALSE
;

29 
usbfwD©a
.
ªmŸeWakeup
 = 
FALSE
;

31 
	`HAL_USB_ENABLE
();

34 
	`HAL_USB_RESUME_INT_ENABLE
();

36 
	}
}

48 
	$usbfwRe£tH™dÀr
()

52 
usbfwD©a
.
usbSèã
 = 
DEV_DEFAULT
;

53 
usbfwD©a
.
c⁄figuøti⁄VÆue
 = 0;

56 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

57 
	`usbfwSëAŒEpSètus
(
EP_HALT
);

60 
Pro˚ssFunc
 = 
NULL
;

62 
	}
}

77 
	$usbfwSëupH™dÀr
()

79 
uöt8
 
c⁄åﬁReg
;

80 
uöt8
 
byãsNow
;

81 
uöt8
 
ﬁdEndpoöt
;

84 
ﬁdEndpoöt
 = 
	`USBFW_GET_SELECTED_ENDPOINT
();

85 
	`USBFW_SELECT_ENDPOINT
(0);

86 
c⁄åﬁReg
 = 
USBCS0
;

89 i‡(
c⁄åﬁReg
 & 
USBCS0_SETUP_END
) {

90 
USBCS0
 = 
USBCS0_CLR_SETUP_END
;

91 
usbfwD©a
.
ï0Sètus
 = 
EP_CANCEL
;

92 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

93 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

97 i‡(
c⁄åﬁReg
 & 
USBCS0_SENT_STALL
) {

98 
USBCS0
 = 0x00;

99 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

103 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_RX
) {

106 
byãsNow
 = 
USBCNT0
;

107 
	`usbfwRódFifo
(&
USBF0
, 
byãsNow
, 
usbSëupD©a
.
pBuf„r
);

108 
usbSëupD©a
.
byãsLe·
 -
byãsNow
;

109 
usbSëupD©a
.
pBuf„r
 +
byãsNow
;

112 
USBCS0
 = 
usbSëupD©a
.
byãsLe·
 ? 
USBCS0_CLR_OUTPKT_RDY
 : (USBCS0_CLR_OUTPKT_RDY | 
USBCS0_DATA_END
);

115 i‡(
usbSëupD©a
.
byãsLe·
 == 0) {

116 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

117 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

121 
	`USBFW_SELECT_ENDPOINT
(
ﬁdEndpoöt
);

125 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_MANUAL_RX
) {

126 
	`Pro˚ssFunc
();

130 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

131 i‡(
c⁄åﬁReg
 & 
USBCS0_OUTPKT_RDY
) {

132 
	`usbfwRódFifo
(&
USBF0
, 8, (
uöt8
 
__xd©a
 *Ë&
usbSëupHódî
);

135 
Pro˚ssFunc
 = 
NULL
;

136 
usbSëupHódî
.
ªque°Ty≥
 & (
RT_MASK_TYPE
 | 
RT_MASK_DIR
)) {

139 
RT_STD_OUT
:

140 
usbSëupHódî
.
ªque°
) {

141 
SET_ADDRESS
: 
	`usb§SëAddªss
(); ;

142 
SET_FEATURE
: 
	`usb§SëFótuª
(); ;

143 
CLEAR_FEATURE
: 
	`usb§CÀ¨Fótuª
(); ;

144 
SET_CONFIGURATION
: 
	`usb§SëC⁄figuøti⁄
(); ;

145 
SET_INTERFACE
: 
	`usb§SëI¡îÁ˚
(); ;

146 
SET_DESCRIPTOR
:

147 : 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; ;

152 
RT_STD_IN
:

153 
usbSëupHódî
.
ªque°
) {

154 
GET_STATUS
: 
	`usb§GëSètus
(); ;

155 
GET_DESCRIPTOR
: 
	`usb§GëDes¸ùt‹
(); ;

156 
GET_CONFIGURATION
: 
	`usb§GëC⁄figuøti⁄
(); ;

157 
GET_INTERFACE
: 
	`usb§GëI¡îÁ˚
(); ;

158 
SYNCH_FRAME
:

159 : 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; ;

164 
RT_VEND_OUT
:

165 
Pro˚ssFunc
 = 
usbvrHookPro˚ssOut
; 
	`usbvrHookPro˚ssOut
();

167 
RT_VEND_IN
:

168 
Pro˚ssFunc
 = 
usbvrHookPro˚ssIn
; 
	`usbvrHookPro˚ssIn
();

172 
RT_CLASS_OUT
:

173 
Pro˚ssFunc
 = 
usb¸HookPro˚ssOut
; 
	`usb¸HookPro˚ssOut
();

175 
RT_CLASS_IN
:

176 
Pro˚ssFunc
 = 
usb¸HookPro˚ssIn
; 
	`usb¸HookPro˚ssIn
();

181 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

186 
USBCS0
 = (
usbfwD©a
.
ï0Sètus
 =
EP_STALL
Ë? (
USBCS0_CLR_OUTPKT_RDY
 | 
USBCS0_SEND_STALL
) : USBCS0_CLR_OUTPKT_RDY;

191 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_TX
) {

192 
c⁄åﬁReg
 = 
USBCS0_INPKT_RDY
;

195 i‡(
usbSëupD©a
.
byãsLe·
 < 
EP0_PACKET_SIZE
) {

196 
byãsNow
 = 
usbSëupD©a
.
byãsLe·
;

197 
c⁄åﬁReg
 |
USBCS0_DATA_END
;

201 
byãsNow
 = 
EP0_PACKET_SIZE
;

205 
	`usbfwWrôeFifo
(&
USBF0
, 
byãsNow
, 
usbSëupD©a
.
pBuf„r
);

206 
usbSëupD©a
.
pBuf„r
 +
byãsNow
;

207 
usbSëupD©a
.
byãsLe·
 -
byãsNow
;

210 
USBCS0
 = 
c⁄åﬁReg
;

213 i‡(
byãsNow
 < 
EP0_PACKET_SIZE
) {

214 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

215 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

219 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_MANUAL_TX
) {

220 
	`Pro˚ssFunc
();

224 
	`USBFW_SELECT_ENDPOINT
(
ﬁdEndpoöt
);

226 
	}
}

238 
	$usbfwSëAŒEpSètus
(
EP_STATUS
 
°©us
)

240 
uöt8
 
n
;

241 
n
 = 0;Ç < (
usbfwD©a
.
pEpInSètus
);Ç++)

242 
usbfwD©a
.
pEpInSètus
[
n
] = 
°©us
;

243 
n
 = 0;Ç < (
usbfwD©a
.
pEpOutSètus
);Ç++)

244 
usbfwD©a
.
pEpOutSètus
[
n
] = 
°©us
;

245 
	}
}

262 
	$usbfwRódFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
)

264 
uöt8
 
__gíîic
 *
pTemp
 = 
pD©a
;

265 i‡(
cou¡
) {

267 *(
pTemp
++Ë*
pFifo
;

268 } --
cou¡
);

270 
	}
}

287 
	$usbfwWrôeFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
)

289 
uöt8
 
__gíîic
 *
pTemp
 = 
pD©a
;

290 i‡(
cou¡
) {

292 *
pFifo
 = *(
pTemp
++);

293 } --
cou¡
);

295 
	}
}

	@Components/hal/target/CC2540USB/usb/library/usb/usb_framework_structs.h

9 #i‚de‡
USBFRAMEWORKSTRUCTS_H


10 
	#USBFRAMEWORKSTRUCTS_H


	)

17 
	~"hÆ_ty≥s.h
"

18 
	~"usb_fúmw¨e_libøry_c⁄fig.h
"

20 #ifde‡
EXTERN


21 #unde‡
EXTERN


23 #ifde‡
USBFRAMEWORK_C


24 
	#EXTERN


25 #ñ£

	)

26 
	#EXTERN
 

28 

	)

36 
EP_IDLE
 = 0x00,

37 
EP_TX
 = 0x01,

38 
EP_RX
 = 0x02,

39 
EP_HALT
 = 0x03,

40 
EP_STALL
 = 0x04,

41 
EP_MANUAL_TX
 = 0x05,

42 
EP_MANUAL_RX
 = 0x06,

43 
EP_CANCEL
 = 0x07

44 } 
	tEP_STATUS
;

48 
	mDEV_ATTACHED
 = 0x00,

49 
	mDEV_POWERED
 = 0x01,

50 
	mDEV_DEFAULT
 = 0x02,

51 
	mDEV_ADDRESS
 = 0x03,

52 
	mDEV_CONFIGURED
 = 0x04,

53 
	mDEV_SUSPENDED
 = 0x05

54 } 
	tUSB_STATE
;

58 
USB_STATE
 
	musbSèã
;

59 
uöt8
 
	mc⁄figuøti⁄VÆue
;

60 
uöt8
 
	mpA…î«ãSëtög
[
USB_SETUP_MAX_NUMBER_OF_INTERFACES
];

61 
EP_STATUS
 
	mï0Sètus
;

62 
EP_STATUS
 
	mpEpInSètus
[5];

63 
EP_STATUS
 
	mpEpOutSètus
[5];

64 
uöt8
 
	mªmŸeWakeup
;

65 
uöt8
 
	m£lfPowîed
;

66 } 
	tUSBFW_DATA
;

71 
uöt8
 
	mªque°Ty≥
;

72 
uöt8
 
	mªque°
;

73 
uöt16
 
	mvÆue
;

74 
uöt16
 
	mödex
;

75 
uöt16
 
	mÀngth
;

76 } 
	tUSB_SETUP_HEADER
;

80 
uöt8
 
__gíîic
 *
	mpBuf„r
;

81 
uöt16
 
	mbyãsLe·
;

82 } 
	tUSB_SETUP_DATA
;

93 
uöt8
 
	mbLígth
;

94 
uöt8
 
	mbDes¸ùt‹Ty≥
;

95 
uöt16
 
	mbcdUSB
;

96 
uöt8
 
	mbDevi˚Cœss
;

97 
uöt8
 
	mbDevi˚SubCœss
;

98 
uöt8
 
	mbDevi˚PrŸocﬁ
;

99 
uöt8
 
	mbMaxPackëSize0
;

100 
uöt16
 
	midVíd‹
;

101 
uöt16
 
	midProdu˘
;

102 
uöt16
 
	mbcdDevi˚
;

103 
uöt8
 
	miM™uÁ˘uªr
;

104 
uöt8
 
	miProdu˘
;

105 
uöt8
 
	miSîülNumbî
;

106 
uöt8
 
	mbNumC⁄figuøti⁄s
;

107 } 
	tUSB_DEVICE_DESCRIPTOR
;

111 
uöt8
 
	mbLígth
;

112 
uöt8
 
	mbDes¸ùt‹Ty≥
;

113 
uöt16
 
	mwTŸÆLígth
;

114 
uöt8
 
	mbNumI¡îÁ˚s
;

115 
uöt8
 
	mbC⁄figuøti⁄VÆue
;

116 
uöt8
 
	miC⁄figuøti⁄
;

117 
uöt8
 
	mbmAâribuãs
;

118 
uöt8
 
	mbMaxPowî
;

119 } 
	tUSB_CONFIGURATION_DESCRIPTOR
;

123 
uöt8
 
	mbLígth
;

124 
uöt8
 
	mbDes¸ùt‹Ty≥
;

125 
uöt8
 
	mbI¡îÁ˚Numbî
;

126 
uöt8
 
	mbA…î«ãSëtög
;

127 
uöt8
 
	mbNumEndpoöts
;

128 
uöt8
 
	mbI¡îÁ˚Cœss
;

129 
uöt8
 
	mbI¡îÁ˚SubCœss
;

130 
uöt8
 
	mbI¡îÁ˚PrŸocﬁ
;

131 
uöt8
 
	miI¡îÁ˚
;

132 } 
	tUSB_INTERFACE_DESCRIPTOR
;

136 
uöt8
 
	mbLígth
;

137 
uöt8
 
	mbDes¸ùt‹Ty≥
;

138 
uöt8
 
	mbEndpoötAddªss
;

139 
uöt8
 
	mbmAâribuãs
;

140 
uöt16
 
	mwMaxPackëSize
;

141 
uöt8
 
	mbI¡îvÆ
;

142 } 
	tUSB_ENDPOINT_DESCRIPTOR
;

146 
uöt8
 
	mbLígth
;

147 
uöt8
 
	mbDes¸ùt‹Ty≥
;

148 
uöt16
 
	mpSåög
[1];

149 } 
	tUSB_STRING_DESCRIPTOR
;

153 
uöt8
 
	mbLígth
;

154 
uöt8
 
	mbDes¸ùt‹Ty≥
;

155 
uöt16
 
	mbscHID
;

156 
uöt8
 
	mbCou¡ryCode
;

157 
uöt8
 
	mbNumDes¸ùt‹s
;

158 
uöt8
 
	mbRDes¸ùt‹Ty≥
;

159 
uöt16
 
	mwDes¸ùt‹Lígth
;

160 } 
	tUSB_HID_DESCRIPTOR
;

167 
uöt8
 
	mvÆueMsb
;

168 
uöt8
 
	mvÆueLsb
;

169 
uöt8
 
	mödexMsb
;

170 
uöt8
 
	mödexLsb
;

171 
uöt8
 
__code
 *
	mpDescSèπ
;

172 
uöt16
 
	mÀngth
;

173 } 
	tDESC_LUT_INFO
;

177 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
	mpI¡îÁ˚
;

178 
uöt8
 
	möMask
;

179 
uöt8
 
	moutMask
;

180 } 
	tDBLBUF_LUT_INFO
;

186 
uöt16
 
	mevítMask
;

187 
uöt8
 
	möSu•íd
;

188 
uöt16
 
	múqMask
;

189 } 
	tUSBIRQ_DATA
;

194 c⁄° 
uöt8
 
__code
 *
	mpDesc
;

195 } 
	tUSBDP_DATA
;

	@Components/hal/target/CC2540USB/usb/library/usb/usb_interrupt.h

9 #i‚de‡
USBINTERRUPT_H


10 
	#USBINTERRUPT_H


	)

76 
	~"usb_‰amew‹k_°ru˘s.h
"

78 #ifde‡
EXTERN


79 #unde‡
EXTERN


81 #ifde‡
USBINTERRUPT_C


82 
	#EXTERN


83 #ñ£

	)

84 
	#EXTERN
 

86 

	)

95 #ifde‡
USBIRQ_DATA_ADDR


96 
EXTERN
 
__no_öô
 
__d©a
 
USBIRQ_DATA
 
usbúqD©a
 @ 
USBIRQ_DATA_ADDR
;

98 
EXTERN
 
USBIRQ_DATA
 
__d©a
 
	gusbúqD©a
;

109 
	#USBIRQ_EVENT_SUSPEND
 0x0001

	)

111 
	#USBIRQ_EVENT_RESUME
 0x0002

	)

113 
	#USBIRQ_EVENT_RESET
 0x0004

	)

115 
	#USBIRQ_EVENT_START_OF_FRAME
 0x0008

	)

117 
	#USBIRQ_EVENT_SETUP
 0x0010

	)

119 
	#USBIRQ_EVENT_EP1IN
 0x0020

	)

121 
	#USBIRQ_EVENT_EP2IN
 0x0040

	)

123 
	#USBIRQ_EVENT_EP3IN
 0x0080

	)

125 
	#USBIRQ_EVENT_EP4IN
 0x0100

	)

127 
	#USBIRQ_EVENT_EP5IN
 0x0200

	)

129 
	#USBIRQ_EVENT_EP1OUT
 0x0400

	)

131 
	#USBIRQ_EVENT_EP2OUT
 0x0800

	)

133 
	#USBIRQ_EVENT_EP3OUT
 0x1000

	)

135 
	#USBIRQ_EVENT_EP4OUT
 0x2000

	)

137 
	#USBIRQ_EVENT_EP5OUT
 0x4000

	)

147 
	#USBIRQ_CLEAR_EVENTS
(
mask
Ë(
usbúqD©a
.
evítMask
 &~(mask))

	)

149 
	#USBIRQ_GET_EVENT_MASK
(Ë(
usbúqD©a
.
evítMask
)

	)

159 
usbúqHookPro˚ssEvíts
();

167 
usbúqInô
(
uöt16
 
úqMask
);

168 #i‡
deföed
 
HAL_USB_BOOT_CODE


169 
usbúqH™dÀr
();

171 
__öãºu±
 
usbúqH™dÀr
();

	@Components/hal/target/CC2540USB/usb/library/usb_descriptor.h

8 #i‚de‡
USBDESCRIPTOR_H


9 
	#USBDESCRIPTOR_H


	)

12 #i‚de‡
ASM_FILE


13 
	~"usb_‰amew‹k_°ru˘s.h
"

87 #ifde‡
EXTERN


88 #unde‡
EXTERN


90 #ifde‡
USBDESCRIPTORPARSER_C


91 
	#EXTERN


92 #ñ£

	)

93 
	#EXTERN
 

95 

	)

100 
	#EP0_PACKET_SIZE
 32

102 

	)

105 
	#DESC_TYPE_DEVICE
 0x01

106 
	#DESC_TYPE_CONFIG
 0x02

107 
	#DESC_TYPE_STRING
 0x03

108 
	#DESC_TYPE_INTERFACE
 0x04

109 
	#DESC_TYPE_ENDPOINT
 0x05

111 

	)

114 
	#DESC_TYPE_HID
 0x21

115 
	#DESC_TYPE_HIDREPORT
 0x22

117 

	)

120 
	#EP_ATTR_CTRL
 0x00

121 
	#EP_ATTR_ISO
 0x01

122 
	#EP_ATTR_BULK
 0x02

123 
	#EP_ATTR_INT
 0x03

124 
	#EP_ATTR_TYPE_BM
 0x03

127 

	)

129 #i‚de‡
ASM_FILE


136 
uöt8
 
__code
* c⁄° 
pUsbDescSèπ
;

137 
uöt8
 
__code
* c⁄° 
pUsbDescEnd
;

138 
DESC_LUT_INFO
 
__code
* c⁄° 
pUsbDescLut
;

139 
DESC_LUT_INFO
 
__code
* c⁄° 
pUsbDescLutEnd
;

140 
DBLBUF_LUT_INFO
 
__code
* c⁄° 
pUsbDblbufLut
;

141 
DBLBUF_LUT_INFO
 
__code
* c⁄° 
pUsbDblbufLutEnd
;

142 } 
	tUSB_DESCRIPTOR_MARKER
;

144 
USB_DESCRIPTOR_MARKER
 
__xd©a
 
usbDes¸ùt‹M¨kî
;

152 
__code
* 
usbDescSèπ
;

153 
__code
* 
usbDescEnd
;

154 
__code
* 
usbDescLut
;

155 
__code
* 
usbDescLutEnd
;

156 
__code
* 
usbDblbufLut
;

157 
__code
* 
usbDblbufLutEnd
;

	@Components/hal/target/CC2540USB/usb/library/usb_framework.h

9 #i‚de‡
USBFRAMEWORK_H


10 
	#USBFRAMEWORK_H


	)

182 
	~"usb_bﬂrd_cfg.h
"

183 
	~"usb_‰amew‹k_°ru˘s.h
"

185 #ifde‡
EXTERN


186 #unde‡
EXTERN


188 #ifde‡
USBFRAMEWORK_C


189 
	#EXTERN


190 #ñ£

	)

191 
	#EXTERN
 

193 

	)

198 
EXTERN
 
USBFW_DATA
 
__xd©a
 
usbfwD©a
;

206 
EXTERN
 
USB_SETUP_DATA
 
__xd©a
 
	gusbSëupD©a
;

207 
EXTERN
 
USB_SETUP_HEADER
 
__xd©a
 
	gusbSëupHódî
;

217 
	#RT_MASK_DIR
 0x80

218 
	#RT_MASK_TYPE
 0x60

219 
	#RT_MASK_RECIP
 0x1F

220 

	)

222 
	#RT_DIR_IN
 0x80

223 
	#RT_DIR_OUT
 0x00

224 

	)

226 
	#RT_TYPE_STD
 0x00

227 
	#RT_TYPE_CLASS
 0x20

228 
	#RT_TYPE_VEND
 0x40

229 

	)

231 
	#RT_RECIP_DEV
 0x00

232 
	#RT_RECIP_IF
 0x01

233 
	#RT_RECIP_EP
 0x02

234 
	#RT_RECIP_OTHER
 0x03

235 

	)

237 
	#RT_STD_OUT
 (
RT_TYPE_STD
 | 
RT_DIR_OUT
)

238 
	#RT_STD_IN
 (
RT_TYPE_STD
 | 
RT_DIR_IN
)

239 
	#RT_VEND_OUT
 (
RT_TYPE_VEND
 | 
RT_DIR_OUT
)

240 
	#RT_VEND_IN
 (
RT_TYPE_VEND
 | 
RT_DIR_IN
)

241 
	#RT_CLASS_OUT
 (
RT_TYPE_CLASS
 | 
RT_DIR_OUT
)

242 
	#RT_CLASS_IN
 (
RT_TYPE_CLASS
 | 
RT_DIR_IN
)

243 

	)

245 
	#RT_OUT_DEVICE
 (
RT_DIR_OUT
 | 
RT_RECIP_DEV
)

246 
	#RT_IN_DEVICE
 (
RT_DIR_IN
 | 
RT_RECIP_DEV
)

247 
	#RT_OUT_INTERFACE
 (
RT_DIR_OUT
 | 
RT_RECIP_IF
)

248 
	#RT_IN_INTERFACE
 (
RT_DIR_IN
 | 
RT_RECIP_IF
)

249 
	#RT_OUT_ENDPOINT
 (
RT_DIR_OUT
 | 
RT_RECIP_EP
)

250 
	#RT_IN_ENDPOINT
 (
RT_DIR_IN
 | 
RT_RECIP_EP
)

253 

	)

261 
usb¸HookPro˚ssOut
();

263 
usb¸HookPro˚ssIn
();

265 
usbvrHookPro˚ssOut
();

267 
usbvrHookPro˚ssIn
();

281 
	#USBFW_SELECT_ENDPOINT
(
n
Ë(
USBINDEX
 = (n))

	)

283 
	#USBFW_GET_SELECTED_ENDPOINT
(Ë(
USBINDEX
)

	)

286 
	#USBFW_STALL_IN_ENDPOINT
(Ë
	`°
 (\

287 
USBCSIL
 = 
USBCSIL_SEND_STALL
; \

288 
usbfwD©a
.
pEpInSètus
[
USBINDEX
 - 1] = 
EP_HALT
; )

	)

291 
	#USBFW_IN_ENDPOINT_STALLED
(Ë(
USBCSIL
 & 
USBCSIL_SEND_STALL
)

	)

293 
	#USBFW_FLUSH_IN_ENDPOINT
(Ë
	`°
 (\

294 
USBCSIL
 = 
USBCSIL_FLUSH_PACKET
; \

295 
USBCSIL
 & 
USBCSIL_FLUSH_PACKET
); )

	)

298 
	#USBFW_ARM_IN_ENDPOINT
(Ë(
USBCSIL
 = 
USBCSIL_INPKT_RDY
)

	)

300 
	#USBFW_IN_ENDPOINT_DISARMED
(Ë!(
USBCSIL
 & 
USBCSIL_INPKT_RDY
)

	)

302 
	#USBFW_IN_ENDPOINT_FIFO_EMPTY
(Ë!(
USBCSIL
 & 
USBCSIL_PKT_PRESENT
)

	)

305 
	#USBFW_STALL_OUT_ENDPOINT
(Ë
	`°
 ( \

306 
USBCSOL
 = 
USBCSOL_SEND_STALL
; \

307 
usbfwD©a
.
pEpOutSètus
[
USBINDEX
 - 1] = 
EP_HALT
; \

308 }

	)

311 
	#USBFW_OUT_ENDPOINT_STALLED
(Ë(
USBCSOL
 & 
USBCSOL_SEND_STALL
)

	)

313 
	#USBFW_FLUSH_OUT_ENDPOINT
(Ë
	`°
(\

314 
USBCSOL
 = 
USBCSOL_FLUSH_PACKET
; \

315 
USBCSOL
 & 
USBCSOL_FLUSH_PACKET
); )

	)

318 
	#USBFW_ARM_OUT_ENDPOINT
(Ë(
USBCSOL
 = 0)

	)

320 
	#USBFW_OUT_ENDPOINT_DISARMED
(Ë(
USBCSOL
 & 
USBCSOL_OUTPKT_RDY
)

	)

322 
	#USBFW_GET_OUT_ENDPOINT_COUNT_LOW
(Ë(
USBCNTL
)

	)

324 
	#USBFW_GET_OUT_ENDPOINT_COUNT_HIGH
(Ë(
USBCNTH
)

	)

330 
	#LOBYTEPTR
(
w
Ë–(
uöt8
 
__gíîic
 *)(&(w)Ë+ 1 )

	)

338 
usbfwInô
();

339 
usbfwRe£tH™dÀr
();

340 
usbfwSëupH™dÀr
();

341 
usbfwSëAŒEpSètus
(
EP_STATUS
 
°©us
);

342 
usbfwWrôeFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
);

343 
usbfwRódFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
);

	@Components/hal/target/CC2540USB/usb/library/usb_hid/usb_descriptor_parser.c

11 
	#USBDESCRIPTORPARSER_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

16 
USBDP_DATA
 
__xd©a
 
	gusbdpD©a
;

23 
	$usbdpInô
()

25 
usbdpD©a
.
pDesc
 = (c⁄° 
uöt8
 
__code
 *Ë
usbDes¸ùt‹M¨kî
.
pUsbDescSèπ
;

26 
	}
}

53 
__code
* 
	$usbdpFödNext
(
uöt8
 
w™ãdTy≥
, uöt8 
hÆtAtTy≥
)

55 
__code
 *
pResu…
;

56 
pResu…
 = 
NULL
;

59 
usbdpD©a
.
pDesc
 !(
__code
 *Ë
usbDes¸ùt‹M¨kî
.
pUsbDescEnd
) {

62 i‡(
usbdpD©a
.
pDesc
[
DESC_TYPE_IDX
] =
w™ãdTy≥
) {

63 
pResu…
 = (
__code
*Ë
usbdpD©a
.
pDesc
;

64 
usbdpD©a
.
pDesc
 +usbdpD©a.pDesc[
DESC_LENGTH_IDX
];

68 } i‡(
usbdpD©a
.
pDesc
[
DESC_TYPE_IDX
] =
hÆtAtTy≥
) {

69 i‡(
hÆtAtTy≥
) ;

73 
usbdpD©a
.
pDesc
 +usbdpD©a.pDesc[
DESC_LENGTH_IDX
];

76  
pResu…
;

77 
	}
}

89 
USB_DEVICE_DESCRIPTOR
 
__code
* 
	$usbdpGëDevi˚Desc
()

91 
	`usbdpInô
();

92  
	`usbdpFödNext
(
DESC_TYPE_DEVICE
, 0);

93 
	}
}

115 
USB_CONFIGURATION_DESCRIPTOR
 
__code
* 
	$usbdpGëC⁄figuøti⁄Desc
(
uöt8
 
cfgVÆue
, uöt8 
cfgIndex
)

117 
USB_CONFIGURATION_DESCRIPTOR
 
__code
 *
pC⁄figuøti⁄Desc
;

118 
	`usbdpInô
();

121 
pC⁄figuøti⁄Desc
 = 
	`usbdpFödNext
(
DESC_TYPE_CONFIG
, 0)) {

124 i‡(
cfgVÆue
) {

125 i‡(
cfgVÆue
 =
pC⁄figuøti⁄Desc
->
bC⁄figuøti⁄VÆue
) ;

128 } i‡(!
cfgIndex
--) {

133  
pC⁄figuøti⁄Desc
;

134 
	}
}

157 
USB_INTERFACE_DESCRIPTOR
 
__code
* 
	$usbdpGëI¡îÁ˚Desc
(
uöt8
 
cfgVÆue
, uöt8 
ötNumbî
, uöt8 
ÆtSëtög
)

159 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚Desc
;

162 
	`usbdpGëC⁄figuøti⁄Desc
(
cfgVÆue
, 0);

165 
pI¡îÁ˚Desc
 = 
	`usbdpFödNext
(
DESC_TYPE_INTERFACE
, 
DESC_TYPE_CONFIG
)) {

166 i‡((
pI¡îÁ˚Desc
->
bI¡îÁ˚Numbî
 =
ötNumbî
Ë&& (pI¡îÁ˚Desc->
bA…î«ãSëtög
 =
ÆtSëtög
)) {

171  
pI¡îÁ˚Desc
;

172 
	}
}

187 
USB_STRING_DESCRIPTOR
 
__code
* 
	$usbdpGëSåögDesc
(
uöt8
 
°rIndex
)

189 
USB_STRING_DESCRIPTOR
 
__code
 *
pSåögDesc
;

190 
	`usbdpInô
();

192 #ifde‡
MS_EXT_C_ID


193 i‡(
°rIndex
 == 0xEE){

196 
pSåögDesc
 = 
	`usbdpFödNext
(
DESC_TYPE_STRING
, 0);

197 }
pSåögDesc
 !
NULL
 &&ÖSåögDesc->
bLígth
 != 18);

203 
pSåögDesc
 = 
	`usbdpFödNext
(
DESC_TYPE_STRING
, 0);

204 } 
°rIndex
--);

206  
pSåögDesc
;

207 
	}
}

	@Components/hal/target/CC2540USB/usb/library/usb_hid/usb_descriptor_parser.h

9 #i‚de‡
USBDESCRIPTORPARSER_H


10 
	#USBDESCRIPTORPARSER_H


	)

63 
	~"usb_des¸ùt‹.h
"

72 
	#DESC_LENGTH_IDX
 0

73 
	#DESC_TYPE_IDX
 1

74 
	#DESC_CONFIG_LENGTH_LSB_IDX
 2

75 
	#DESC_CONFIG_LENGTH_MSB_IDX
 3

78 

	)

82 
usbdpInô
();

83 
__code
 *
usbdpFödNext
(
uöt8
 
w™ãdTy≥
, uöt8 
hÆtAtTy≥
);

85 
USB_DEVICE_DESCRIPTOR
 
__code
* 
usbdpGëDevi˚Desc
();

86 
USB_CONFIGURATION_DESCRIPTOR
 
__code
* 
usbdpGëC⁄figuøti⁄Desc
(
uöt8
 
cfgVÆue
, uöt8 
cfgIndex
);

87 
USB_INTERFACE_DESCRIPTOR
 
__code
* 
usbdpGëI¡îÁ˚Desc
(
uöt8
 
cfgVÆue
, uöt8 
ötNumbî
, uöt8 
ÆtSëtög
);

88 
USB_STRING_DESCRIPTOR
 
__code
* 
usbdpGëSåögDesc
(
uöt8
 
°rIndex
);

	@Components/hal/target/CC2540USB/usb/library/usb_hid/usb_framework.c

11 
	#USBFRAMEWORK_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

13 
	~"usb_bﬂrd_cfg.h
"

16 
VFPTR
 
	gPro˚ssFunc
;

25 
	$usbfwInô
()

28 
usbfwD©a
.
£lfPowîed
 = (
	`usbdpGëC⁄figuøti⁄Desc
(1, 0)->
bmAâribuãs
 & 0x40Ë? 
TRUE
 : 
FALSE
;

29 
usbfwD©a
.
ªmŸeWakeup
 = 
TRUE
;

31 
	`HAL_USB_ENABLE
();

32 
	`HAL_USB_RUN
();

33 
	}
}

45 
	$usbfwRe£tH™dÀr
()

49 
usbfwD©a
.
usbSèã
 = 
DEV_DEFAULT
;

50 
usbfwD©a
.
c⁄figuøti⁄VÆue
 = 0;

53 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

54 
	`usbfwSëAŒEpSètus
(
EP_HALT
);

57 
Pro˚ssFunc
 = 
NULL
;

59 
	}
}

74 
	$usbfwSëupH™dÀr
()

76 
uöt8
 
c⁄åﬁReg
;

77 
uöt8
 
byãsNow
;

78 
uöt8
 
ﬁdEndpoöt
;

81 
ﬁdEndpoöt
 = 
	`USBFW_GET_SELECTED_ENDPOINT
();

82 
	`USBFW_SELECT_ENDPOINT
(0);

83 
c⁄åﬁReg
 = 
USBCS0
;

86 i‡(
c⁄åﬁReg
 & 
USBCS0_SETUP_END
) {

87 
USBCS0
 = 
USBCS0_CLR_SETUP_END
;

88 
usbfwD©a
.
ï0Sètus
 = 
EP_CANCEL
;

89 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

90 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

94 i‡(
c⁄åﬁReg
 & 
USBCS0_SENT_STALL
) {

95 
USBCS0
 = 0x00;

96 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

100 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_RX
) {

103 
byãsNow
 = 
USBCNT0
;

104 
	`usbfwRódFifo
(&
USBF0
, 
byãsNow
, 
usbSëupD©a
.
pBuf„r
);

105 
usbSëupD©a
.
byãsLe·
 -
byãsNow
;

106 
usbSëupD©a
.
pBuf„r
 +
byãsNow
;

109 
USBCS0
 = 
usbSëupD©a
.
byãsLe·
 ? 
USBCS0_CLR_OUTPKT_RDY
 : (USBCS0_CLR_OUTPKT_RDY | 
USBCS0_DATA_END
);

112 i‡(
usbSëupD©a
.
byãsLe·
 == 0) {

113 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

114 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

118 
	`USBFW_SELECT_ENDPOINT
(
ﬁdEndpoöt
);

122 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_MANUAL_RX
) {

123 
	`Pro˚ssFunc
();

127 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

128 i‡(
c⁄åﬁReg
 & 
USBCS0_OUTPKT_RDY
) {

129 
	`usbfwRódFifo
(&
USBF0
, 8, (
uöt8
 
__xd©a
 *Ë&
usbSëupHódî
);

132 
Pro˚ssFunc
 = 
NULL
;

133 
usbSëupHódî
.
ªque°Ty≥
 & (
RT_MASK_TYPE
 | 
RT_MASK_DIR
)) {

136 
RT_STD_OUT
:

137 
usbSëupHódî
.
ªque°
) {

138 
SET_ADDRESS
: 
	`usb§SëAddªss
(); ;

139 
SET_FEATURE
: 
	`usb§SëFótuª
(); ;

140 
CLEAR_FEATURE
: 
	`usb§CÀ¨Fótuª
(); ;

141 
SET_CONFIGURATION
: 
	`usb§SëC⁄figuøti⁄
(); ;

142 
SET_INTERFACE
: 
	`usb§SëI¡îÁ˚
(); ;

143 
SET_DESCRIPTOR
:

144 : 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; ;

149 
RT_STD_IN
:

150 
usbSëupHódî
.
ªque°
) {

151 
GET_STATUS
: 
	`usb§GëSètus
(); ;

152 
GET_DESCRIPTOR
: 
	`usb§GëDes¸ùt‹
(); ;

153 
GET_CONFIGURATION
: 
	`usb§GëC⁄figuøti⁄
(); ;

154 
GET_INTERFACE
: 
	`usb§GëI¡îÁ˚
(); ;

155 
SYNCH_FRAME
:

156 : 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; ;

161 
RT_VEND_OUT
:

162 
Pro˚ssFunc
 = 
usbvrHookPro˚ssOut
; 
	`usbvrHookPro˚ssOut
();

164 
RT_VEND_IN
:

165 
Pro˚ssFunc
 = 
usbvrHookPro˚ssIn
; 
	`usbvrHookPro˚ssIn
();

169 
RT_CLASS_OUT
:

170 
Pro˚ssFunc
 = 
usb¸HookPro˚ssOut
; 
	`usb¸HookPro˚ssOut
();

172 
RT_CLASS_IN
:

173 
Pro˚ssFunc
 = 
usb¸HookPro˚ssIn
; 
	`usb¸HookPro˚ssIn
();

178 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

183 
USBCS0
 = (
usbfwD©a
.
ï0Sètus
 =
EP_STALL
Ë? (
USBCS0_CLR_OUTPKT_RDY
 | 
USBCS0_SEND_STALL
) : USBCS0_CLR_OUTPKT_RDY;

188 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_TX
) {

189 
c⁄åﬁReg
 = 
USBCS0_INPKT_RDY
;

192 i‡(
usbSëupD©a
.
byãsLe·
 < 
EP0_PACKET_SIZE
) {

193 
byãsNow
 = 
usbSëupD©a
.
byãsLe·
;

194 
c⁄åﬁReg
 |
USBCS0_DATA_END
;

198 
byãsNow
 = 
EP0_PACKET_SIZE
;

202 
	`usbfwWrôeFifo
(&
USBF0
, 
byãsNow
, 
usbSëupD©a
.
pBuf„r
);

203 
usbSëupD©a
.
pBuf„r
 +
byãsNow
;

204 
usbSëupD©a
.
byãsLe·
 -
byãsNow
;

207 
USBCS0
 = 
c⁄åﬁReg
;

210 i‡(
byãsNow
 < 
EP0_PACKET_SIZE
) {

211 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

212 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

216 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_MANUAL_TX
) {

217 
	`Pro˚ssFunc
();

221 
	`USBFW_SELECT_ENDPOINT
(
ﬁdEndpoöt
);

223 
	}
}

235 
	$usbfwSëAŒEpSètus
(
EP_STATUS
 
°©us
)

237 
uöt8
 
n
;

238 
n
 = 0;Ç < (
usbfwD©a
.
pEpInSètus
);Ç++)

239 
usbfwD©a
.
pEpInSètus
[
n
] = 
°©us
;

240 
n
 = 0;Ç < (
usbfwD©a
.
pEpOutSètus
);Ç++)

241 
usbfwD©a
.
pEpOutSètus
[
n
] = 
°©us
;

242 
	}
}

259 
	$usbfwRódFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
)

261 
uöt8
 
__gíîic
 *
pTemp
 = 
pD©a
;

262 i‡(
cou¡
) {

264 *(
pTemp
++Ë*
pFifo
;

265 } --
cou¡
);

267 
	}
}

284 
	$usbfwWrôeFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
)

286 
uöt8
 
__gíîic
 *
pTemp
 = 
pD©a
;

287 i‡(
cou¡
) {

289 *
pFifo
 = *(
pTemp
++);

290 } --
cou¡
);

292 
	}
}

	@Components/hal/target/CC2540USB/usb/library/usb_hid/usb_framework_structs.h

9 #i‚de‡
USBFRAMEWORKSTRUCTS_H


10 
	#USBFRAMEWORKSTRUCTS_H


	)

17 
	~"hÆ_ty≥s.h
"

18 
	~"usb_fúmw¨e_libøry_c⁄fig.h
"

20 #ifde‡
EXTERN


21 #unde‡
EXTERN


23 #ifde‡
USBFRAMEWORK_C


24 
	#EXTERN


25 #ñ£

	)

26 
	#EXTERN
 

28 

	)

36 
EP_IDLE
 = 0x00,

37 
EP_TX
 = 0x01,

38 
EP_RX
 = 0x02,

39 
EP_HALT
 = 0x03,

40 
EP_STALL
 = 0x04,

41 
EP_MANUAL_TX
 = 0x05,

42 
EP_MANUAL_RX
 = 0x06,

43 
EP_CANCEL
 = 0x07

44 } 
	tEP_STATUS
;

48 
	mDEV_ATTACHED
 = 0x00,

49 
	mDEV_POWERED
 = 0x01,

50 
	mDEV_DEFAULT
 = 0x02,

51 
	mDEV_ADDRESS
 = 0x03,

52 
	mDEV_CONFIGURED
 = 0x04,

53 
	mDEV_SUSPENDED
 = 0x05

54 } 
	tUSB_STATE
;

58 
USB_STATE
 
	musbSèã
;

59 
uöt8
 
	mc⁄figuøti⁄VÆue
;

60 
uöt8
 
	mpA…î«ãSëtög
[
USB_SETUP_MAX_NUMBER_OF_INTERFACES
];

61 
EP_STATUS
 
	mï0Sètus
;

62 
EP_STATUS
 
	mpEpInSètus
[5];

63 
EP_STATUS
 
	mpEpOutSètus
[5];

64 
uöt8
 
	mªmŸeWakeup
;

65 
uöt8
 
	m£lfPowîed
;

66 } 
	tUSBFW_DATA
;

71 
uöt8
 
	mªque°Ty≥
;

72 
uöt8
 
	mªque°
;

73 
uöt16
 
	mvÆue
;

74 
uöt16
 
	mödex
;

75 
uöt16
 
	mÀngth
;

76 } 
	tUSB_SETUP_HEADER
;

80 
uöt8
 
__gíîic
 *
	mpBuf„r
;

81 
uöt16
 
	mbyãsLe·
;

82 } 
	tUSB_SETUP_DATA
;

93 
uöt8
 
	mbLígth
;

94 
uöt8
 
	mbDes¸ùt‹Ty≥
;

95 
uöt16
 
	mbcdUSB
;

96 
uöt8
 
	mbDevi˚Cœss
;

97 
uöt8
 
	mbDevi˚SubCœss
;

98 
uöt8
 
	mbDevi˚PrŸocﬁ
;

99 
uöt8
 
	mbMaxPackëSize0
;

100 
uöt16
 
	midVíd‹
;

101 
uöt16
 
	midProdu˘
;

102 
uöt16
 
	mbcdDevi˚
;

103 
uöt8
 
	miM™uÁ˘uªr
;

104 
uöt8
 
	miProdu˘
;

105 
uöt8
 
	miSîülNumbî
;

106 
uöt8
 
	mbNumC⁄figuøti⁄s
;

107 } 
	tUSB_DEVICE_DESCRIPTOR
;

111 
uöt8
 
	mbLígth
;

112 
uöt8
 
	mbDes¸ùt‹Ty≥
;

113 
uöt16
 
	mwTŸÆLígth
;

114 
uöt8
 
	mbNumI¡îÁ˚s
;

115 
uöt8
 
	mbC⁄figuøti⁄VÆue
;

116 
uöt8
 
	miC⁄figuøti⁄
;

117 
uöt8
 
	mbmAâribuãs
;

118 
uöt8
 
	mbMaxPowî
;

119 } 
	tUSB_CONFIGURATION_DESCRIPTOR
;

123 
uöt8
 
	mbLígth
;

124 
uöt8
 
	mbDes¸ùt‹Ty≥
;

125 
uöt8
 
	mbI¡îÁ˚Numbî
;

126 
uöt8
 
	mbA…î«ãSëtög
;

127 
uöt8
 
	mbNumEndpoöts
;

128 
uöt8
 
	mbI¡îÁ˚Cœss
;

129 
uöt8
 
	mbI¡îÁ˚SubCœss
;

130 
uöt8
 
	mbI¡îÁ˚PrŸocﬁ
;

131 
uöt8
 
	miI¡îÁ˚
;

132 } 
	tUSB_INTERFACE_DESCRIPTOR
;

136 
uöt8
 
	mbLígth
;

137 
uöt8
 
	mbDes¸ùt‹Ty≥
;

138 
uöt8
 
	mbEndpoötAddªss
;

139 
uöt8
 
	mbmAâribuãs
;

140 
uöt16
 
	mwMaxPackëSize
;

141 
uöt8
 
	mbI¡îvÆ
;

142 } 
	tUSB_ENDPOINT_DESCRIPTOR
;

146 
uöt8
 
	mbLígth
;

147 
uöt8
 
	mbDes¸ùt‹Ty≥
;

148 
uöt16
 
	mpSåög
[1];

149 } 
	tUSB_STRING_DESCRIPTOR
;

153 
uöt8
 
	mbLígth
;

154 
uöt8
 
	mbDes¸ùt‹Ty≥
;

155 
uöt16
 
	mbscHID
;

156 
uöt8
 
	mbCou¡ryCode
;

157 
uöt8
 
	mbNumDes¸ùt‹s
;

158 
uöt8
 
	mbRDes¸ùt‹Ty≥
;

159 
uöt16
 
	mwDes¸ùt‹Lígth
;

160 } 
	tUSB_HID_DESCRIPTOR
;

167 
uöt8
 
	mvÆueMsb
;

168 
uöt8
 
	mvÆueLsb
;

169 
uöt8
 
	mödexMsb
;

170 
uöt8
 
	mödexLsb
;

171 
uöt8
 
__code
 *
	mpDescSèπ
;

172 
uöt16
 
	mÀngth
;

173 } 
	tDESC_LUT_INFO
;

177 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
	mpI¡îÁ˚
;

178 
uöt8
 
	möMask
;

179 
uöt8
 
	moutMask
;

180 } 
	tDBLBUF_LUT_INFO
;

186 
uöt16
 
	mevítMask
;

187 
uöt16
 
	múqMask
;

188 
uöt8
 
	möSu•íd
;

189 } 
	tUSBIRQ_DATA
;

194 c⁄° 
uöt8
 
__code
 *
	mpDesc
;

195 } 
	tUSBDP_DATA
;

	@Components/hal/target/CC2540USB/usb/library/usb_hid/usb_interrupt.h

9 #i‚de‡
USBINTERRUPT_H


10 
	#USBINTERRUPT_H


	)

76 
	~"usb_‰amew‹k_°ru˘s.h
"

78 #ifde‡
EXTERN


79 #unde‡
EXTERN


81 #ifde‡
USBINTERRUPT_C


82 
	#EXTERN


83 #ñ£

	)

84 
	#EXTERN
 

86 

	)

94 #ifde‡
USBIRQ_DATA_ADDR


95 
EXTERN
 
__no_öô
 vﬁ©ûê
USBIRQ_DATA
 
usbúqD©a
 @ 
USBIRQ_DATA_ADDR
;

97 
EXTERN
 vﬁ©ûê
USBIRQ_DATA
 
	gusbúqD©a
;

108 
	#USBIRQ_EVENT_SUSPEND
 0x0001

	)

110 
	#USBIRQ_EVENT_RESUME
 0x0002

	)

112 
	#USBIRQ_EVENT_RESET
 0x0004

	)

114 
	#USBIRQ_EVENT_START_OF_FRAME
 0x0008

	)

116 
	#USBIRQ_EVENT_SETUP
 0x0010

	)

118 
	#USBIRQ_EVENT_EP1IN
 0x0020

	)

120 
	#USBIRQ_EVENT_EP2IN
 0x0040

	)

122 
	#USBIRQ_EVENT_EP3IN
 0x0080

	)

124 
	#USBIRQ_EVENT_EP4IN
 0x0100

	)

126 
	#USBIRQ_EVENT_EP5IN
 0x0200

	)

128 
	#USBIRQ_EVENT_EP1OUT
 0x0400

	)

130 
	#USBIRQ_EVENT_EP2OUT
 0x0800

	)

132 
	#USBIRQ_EVENT_EP3OUT
 0x1000

	)

134 
	#USBIRQ_EVENT_EP4OUT
 0x2000

	)

136 
	#USBIRQ_EVENT_EP5OUT
 0x4000

	)

146 
	#USBIRQ_CLEAR_EVENTS
(
mask
Ë(
usbúqD©a
.
evítMask
 &((maskË^ 0xFF))

	)

148 
	#USBIRQ_GET_EVENT_MASK
(Ë(
usbúqD©a
.
evítMask
)

	)

158 
usbúqHookPro˚ssEvíts
();

166 
usbúqInô
(
uöt16
 
úqMask
);

167 #i‡
deföed
 
HAL_USB_BOOT_CODE


168 
usbúqH™dÀr
();

170 
__öãºu±
 
usbúqH™dÀr
();

	@Components/hal/target/CC2540USB/usb/library/usb_reg.h

9 #i‚de‡
USBREG_H


10 
	#USBREG_H


	)

14 
	#USBADDR_UPDATE
 0x80

	)

15 
	#USBADDR_USBADDR
 0x7F

	)

18 
	#USBPOW_ISO_WAIT_SOF
 0x80

	)

19 
	#USBPOW_RST
 0x08

	)

20 
	#USBPOW_RESUME
 0x04

	)

21 
	#USBPOW_SUSPEND
 0x02

	)

22 
	#USBPOW_SUSPEND_EN
 0x01

	)

25 
	#USBIIF_INEP5IF
 0x20

	)

26 
	#USBIIF_INEP4IF
 0x10

	)

27 
	#USBIIF_INEP3IF
 0x08

	)

28 
	#USBIIF_INEP2IF
 0x04

	)

29 
	#USBIIF_INEP1IF
 0x02

	)

30 
	#USBIIF_EP0IF
 0x01

	)

33 
	#USBOIF_OUTEP5IF
 0x20

	)

34 
	#USBOIF_OUTEP4IF
 0x10

	)

35 
	#USBOIF_OUTEP3IF
 0x08

	)

36 
	#USBOIF_OUTEP2IF
 0x04

	)

37 
	#USBOIF_OUTEP1IF
 0x02

	)

40 
	#USBCIF_SOFIF
 0x08

	)

41 
	#USBCIF_RSTIF
 0x04

	)

42 
	#USBCIF_RESUMEIF
 0x02

	)

43 
	#USBCIF_SUSPENDIF
 0x01

	)

46 
	#USBIIE_INEP5IE
 0x20

	)

47 
	#USBIIE_INEP4IE
 0x10

	)

48 
	#USBIIE_INEP3IE
 0x08

	)

49 
	#USBIIE_INEP2IE
 0x04

	)

50 
	#USBIIE_INEP1IE
 0x02

	)

51 
	#USBIIE_EP0IE
 0x01

	)

54 
	#USBOIE_OUTEP5IE
 0x20

	)

55 
	#USBOIE_OUTEP4IE
 0x10

	)

56 
	#USBOIE_OUTEP3IE
 0x08

	)

57 
	#USBOIE_OUTEP2IE
 0x04

	)

58 
	#USBOIE_OUTEP1IE
 0x02

	)

61 
	#USBCIE_SOFIE
 0x08

	)

62 
	#USBCIE_RSTIE
 0x04

	)

63 
	#USBCIE_RESUMEIE
 0x02

	)

64 
	#USBCIE_SUSPENDIE
 0x01

	)

67 
	#USBCS0_CLR_SETUP_END
 0x80

	)

68 
	#USBCS0_CLR_OUTPKT_RDY
 0x40

	)

69 
	#USBCS0_SEND_STALL
 0x20

	)

70 
	#USBCS0_SETUP_END
 0x10

	)

71 
	#USBCS0_DATA_END
 0x08

	)

72 
	#USBCS0_SENT_STALL
 0x04

	)

73 
	#USBCS0_INPKT_RDY
 0x02

	)

74 
	#USBCS0_OUTPKT_RDY
 0x01

	)

77 
	#USBCSIL_CLR_DATA_TOG
 0x40

	)

78 
	#USBCSIL_SENT_STALL
 0x20

	)

79 
	#USBCSIL_SEND_STALL
 0x10

	)

80 
	#USBCSIL_FLUSH_PACKET
 0x08

	)

81 
	#USBCSIL_UNDERRUN
 0x04

	)

82 
	#USBCSIL_PKT_PRESENT
 0x02

	)

83 
	#USBCSIL_INPKT_RDY
 0x01

	)

86 
	#USBCSIH_AUTOSET
 0x80

	)

87 
	#USBCSIH_ISO
 0x40

	)

88 
	#USBCSIH_FORCE_DATA_TOG
 0x08

	)

89 
	#USBCSIH_IN_DBL_BUF
 0x01

	)

92 
	#USBCSOL_CLR_DATA_TOG
 0x80

	)

93 
	#USBCSOL_SENT_STALL
 0x40

	)

94 
	#USBCSOL_SEND_STALL
 0x20

	)

95 
	#USBCSOL_FLUSH_PACKET
 0x10

	)

96 
	#USBCSOL_DATA_ERROR
 0x08

	)

97 
	#USBCSOL_OVERRUN
 0x04

	)

98 
	#USBCSOL_FIFO_FULL
 0x02

	)

99 
	#USBCSOL_OUTPKT_RDY
 0x01

	)

102 
	#USBCSOH_AUTOCLEAR
 0x80

	)

103 
	#USBCSOH_ISO
 0x40

	)

104 
	#USBCSOH_OUT_DBL_BUF
 0x01

	)

106 
	#SLEEP_USB_EN
 0x80

	)

	@Components/hal/target/CC2540USB/usb/library/usb_standard_requests.c

11 
	~"usb_fúmw¨e_libøry_hódîs.h
"

12 
	~"hÆ_ty≥s.h
"

13 
	~"hÆ_bﬂrd.h
"

37 
	$usb§GëSètus
()

39 
uöt8
 
ídpoöt
;

40 
uöt16
 
__xd©a
 
°©us
;

43 i‡(
usbSëupHódî
.
vÆue
 || 
	`HI_UINT16
(usbSëupHódî.
ödex
Ë|| (usbSëupHódî.
Àngth
 != 2)) {

44 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

48 
usbSëupHódî
.
ªque°Ty≥
) {

53 
RT_IN_DEVICE
:

56 i‡(
	`LO_UINT16
(
usbSëupHódî
.
ödex
)) {

57 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

63 
°©us
 = 
usbfwD©a
.
£lfPowîed
 ? 0x0001 : 0x0000;

66 i‡(
usbfwD©a
.
ªmŸeWakeup
Ë
°©us
 |= 0x0002;

72 
RT_IN_INTERFACE
:

75 i‡(
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
) {

76 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

78 
°©us
 = 0x0000;

84 
RT_IN_ENDPOINT
:

85 
ídpoöt
 = 
	`LO_UINT16
(
usbSëupHódî
.
ödex
) & 0x7F;

88 i‡((
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
Ë|| (
ídpoöt
 > 5)) {

89 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

95 i‡(
	`LO_UINT16
(
usbSëupHódî
.
ödex
) & 0x80) {

96 
°©us
 = (
usbfwD©a
.
pEpInSètus
[
ídpoöt
 - 1] =
EP_HALT
) ? 0x0001 : 0x0000;

100 
°©us
 = (
usbfwD©a
.
pEpOutSètus
[
ídpoöt
 - 1] =
EP_HALT
) ? 0x0001 : 0x0000;

106 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

110 i‡(
usbfwD©a
.
ï0Sètus
 !
EP_STALL
) {

112 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__gíîic
 *)&
°©us
;

113 
usbSëupD©a
.
byãsLe·
 = 2;

114 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

117 
	}
}

133 
uöt8
 
	$Ch™geFótuª
(
uöt8
 
£t
)

135 
uöt8
 
ídpoöt
;

138 i‡(
usbSëupHódî
.
Àngth
 || (
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
Ë&& (usbSëupHódî.
ödex
 != 0)) {

139 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

143 
usbSëupHódî
.
ªque°Ty≥
 & 
RT_MASK_RECIP
) {

146 
RT_RECIP_DEV
:

149 i‡(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
Ë!
DEVICE_REMOTE_WAKEUP
) {

150  
FALSE
;

152 
usbfwD©a
.
ªmŸeWakeup
 = 
£t
;

153 
	`usb§HookPro˚ssEvít
(
£t
 ? 
USBSR_EVENT_REMOTE_WAKEUP_ENABLED
 : 
USBSR_EVENT_REMOTE_WAKEUP_DISABLED
, 0);

158 
RT_RECIP_IF
:

159  
FALSE
;

162 
RT_RECIP_EP
:

163 
ídpoöt
 = 
	`LO_UINT16
(
usbSëupHódî
.
ödex
) & 0x7F;

166 i‡(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
Ë!
ENDPOINT_HALT
) {

167  
FALSE
;

168 } i‡(
ídpoöt
 > 5) {

169 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

171 
	`USBFW_SELECT_ENDPOINT
(
ídpoöt
);

174 i‡(
	`LO_UINT16
(
usbSëupHódî
.
ödex
) & 0x80) {

175 
USBCSIL
 = 
£t
 ? 
USBCSIL_SEND_STALL
 : 
USBCSIL_CLR_DATA_TOG
;

176 
usbfwD©a
.
pEpInSètus
[
ídpoöt
 - 1] = 
£t
 ? 
EP_HALT
 : 
EP_IDLE
;

177 
	`usb§HookPro˚ssEvít
(
£t
 ? 
USBSR_EVENT_EPIN_STALL_SET
 : 
USBSR_EVENT_EPIN_STALL_CLEARED
, 
ídpoöt
);

181 
USBCSOL
 = 
£t
 ? 
USBCSOL_SEND_STALL
 : 
USBCSOL_CLR_DATA_TOG
;

182 
usbfwD©a
.
pEpOutSètus
[
ídpoöt
 - 1] = 
£t
 ? 
EP_HALT
 : 
EP_IDLE
;

183 
	`usb§HookPro˚ssEvít
(
£t
 ? 
USBSR_EVENT_EPOUT_STALL_SET
 : 
USBSR_EVENT_EPOUT_STALL_CLEARED
, 
ídpoöt
);

185 
	`USBFW_SELECT_ENDPOINT
(0);

190 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

194  
TRUE
;

195 
	}
}

214 
	$usb§CÀ¨Fótuª
()

216 i‡(!
	`Ch™geFótuª
(
FALSE
)) {

217 
	`usb§HookCÀ¨Fótuª
();

219 
	}
}

238 
	$usb§SëFótuª
()

240 i‡(!
	`Ch™geFótuª
(
TRUE
)) {

241 
	`usb§HookSëFótuª
();

243 
	}
}

262 
	$usb§SëAddªss
()

266 i‡(
usbSëupHódî
.
ödex
 || usbSëupHódî.
Àngth
 || 
	`HI_UINT16
(usbSëupHódî.
vÆue
Ë|| (
	`LO_UINT16
(usbSetupHeader.value) & 0x80)) {

267 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

271 
USBADDR
 = 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
);

272 i‡(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
) != 0) {

273 i‡(
usbfwD©a
.
usbSèã
 =
DEV_DEFAULT
ËusbfwD©a.usbSèã = 
DEV_ADDRESS
;

275 i‡(
usbfwD©a
.
usbSèã
 =
DEV_ADDRESS
ËusbfwD©a.usbSèã = 
DEV_DEFAULT
;

279 
	}
}

305 
	$usb§GëDes¸ùt‹
()

307 
uöt8
 
n
;

310 
	`HI_UINT16
(
usbSëupHódî
.
vÆue
)) {

313 
DESC_TYPE_DEVICE
:

314 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__code
*Ë
	`usbdpGëDevi˚Desc
();

315 
usbSëupD©a
.
byãsLe·
 = usbSëupD©a.
pBuf„r
[
DESC_LENGTH_IDX
];

319 
DESC_TYPE_CONFIG
:

320 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__code
*Ë
	`usbdpGëC⁄figuøti⁄Desc
(0, 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
));

321 
usbSëupD©a
.
byãsLe·
 = usbSëupD©a.
pBuf„r
[
DESC_CONFIG_LENGTH_LSB_IDX
] +

322 
usbSëupD©a
.
pBuf„r
[
DESC_CONFIG_LENGTH_MSB_IDX
] * 256;

326 
DESC_TYPE_STRING
:

328 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__code
*Ë
	`usbdpGëSåögDesc
(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
));

329 
usbSëupD©a
.
byãsLe·
 = usbSëupD©a.
pBuf„r
[
DESC_LENGTH_IDX
];

335 
usbSëupD©a
.
pBuf„r
 = 
NULL
;

336 
n
 = 0;Ç < ((
uöt16
)
usbDes¸ùt‹M¨kî
.
pUsbDescLutEnd
 - (uöt16)usbDes¸ùt‹M¨kî.
pUsbDescLut
Ë/ (
DESC_LUT_INFO
);Ç++) {

337 i‡((
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
vÆueMsb
 =
	`HI_UINT16
(
usbSëupHódî
.
vÆue
))

338 && (
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
vÆueLsb
 =
	`LO_UINT16
(
usbSëupHódî
.
vÆue
))

339 && (
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
ödexMsb
 =
	`HI_UINT16
(
usbSëupHódî
.
ödex
))

340 && (
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
ödexLsb
 =
	`LO_UINT16
(
usbSëupHódî
.
ödex
)) )

342 
usbSëupD©a
.
pBuf„r
 = 
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
pDescSèπ
;

343 
usbSëupD©a
.
byãsLe·
 = 
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
Àngth
;

349 i‡(
usbSëupD©a
.
pBuf„r
 =
NULL
Ë
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

351 i‡(
usbfwD©a
.
ï0Sètus
 !
EP_STALL
) {

355 i‡(
usbSëupD©a
.
byãsLe·
 > 
usbSëupHódî
.
Àngth
) {

356 
usbSëupD©a
.
byãsLe·
 = 
usbSëupHódî
.
Àngth
;

359 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

362 
	}
}

376 
	$C⁄figuªEndpoöts
(
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚
)

378 
uöt8
 
n
;

379 
uöt16
 
maxpRegVÆue
;

380 
uöt8
 
csRegVÆue
;

381 
uöt8
 
ídpoöt
;

382 
USB_ENDPOINT_DESCRIPTOR
 
__code
 *
pEndpoöt
;

383 
DBLBUF_LUT_INFO
 
__code
 *
pUsbDblbufLutInfo
;

386 i‡(
pI¡îÁ˚
->
bNumEndpoöts
) {

387 
pUsbDblbufLutInfo
 = (
DBLBUF_LUT_INFO
 
__code
*Ë
usbDes¸ùt‹M¨kî
.
pUsbDblbufLut
;

388 
pUsbDblbufLutInfo
->
pI¡îÁ˚
 !=ÖInterface) {

389 
pUsbDblbufLutInfo
++;

394 
n
 = 0;Ç < 
pI¡îÁ˚
->
bNumEndpoöts
;Ç++) {

395 i‡(
pEndpoöt
 = 
	`usbdpFödNext
(
DESC_TYPE_ENDPOINT
, 0)) {

398 
ídpoöt
 = 
pEndpoöt
->
bEndpoötAddªss
 & 0x0F;

399 
	`USBFW_SELECT_ENDPOINT
(
ídpoöt
);

401 
csRegVÆue
 = 0x00;

402 
maxpRegVÆue
 = (
pEndpoöt
->
wMaxPackëSize
 + 7) >> 3;

405 i‡(
pEndpoöt
->
bEndpoötAddªss
 & 0x80) {

408 
USBCSIL
 = 
USBCSIL_CLR_DATA_TOG
 | 
USBCSIL_FLUSH_PACKET
;

409 
USBCSIL
 = 
USBCSIL_FLUSH_PACKET
;

412 i‡((
pEndpoöt
->
bmAâribuãs
 & 
EP_ATTR_TYPE_BM
Ë=
EP_ATTR_ISO
Ë
csRegVÆue
 |
USBCSIH_ISO
;

413 i‡(
pUsbDblbufLutInfo
->
öMask
 & (1 << 
ídpoöt
)Ë
csRegVÆue
 |
USBCSIH_IN_DBL_BUF
;

414 
USBCSIH
 = 
csRegVÆue
;

417 
USBMAXI
 = 
maxpRegVÆue
;

420 
usbfwD©a
.
pEpInSètus
[
ídpoöt
 - 1] = 
EP_IDLE
;

426 
USBCSOL
 = 
USBCSOL_CLR_DATA_TOG
 | 
USBCSOL_FLUSH_PACKET
;

427 
USBCSOL
 = 
USBCSOL_FLUSH_PACKET
;

430 i‡((
pEndpoöt
->
bmAâribuãs
 & 
EP_ATTR_TYPE_BM
Ë=
EP_ATTR_ISO
Ë
csRegVÆue
 |
USBCSOH_ISO
;

431 i‡(
pUsbDblbufLutInfo
->
outMask
 & (1 << 
ídpoöt
)Ë
csRegVÆue
 |
USBCSOH_OUT_DBL_BUF
;

432 
USBCSOH
 = 
csRegVÆue
;

435 
USBMAXO
 = 
maxpRegVÆue
;

438 
usbfwD©a
.
pEpOutSètus
[
ídpoöt
 - 1] = 
EP_IDLE
;

440 
	`USBFW_SELECT_ENDPOINT
(0);

443 
	}
}

461 
	$usb§GëC⁄figuøti⁄
()

465 i‡(
usbSëupHódî
.
vÆue
 || usbSëupHódî.
ödex
 || (usbSëupHódî.
Àngth
 != 1)) {

466 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

470 
usbSëupD©a
.
pBuf„r
 = &
usbfwD©a
.
c⁄figuøti⁄VÆue
;

471 
usbSëupD©a
.
byãsLe·
 = 1;

472 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

475 
	}
}

494 
	$usb§SëC⁄figuøti⁄
()

496 
uöt8
 
n
;

497 
USB_CONFIGURATION_DESCRIPTOR
 
__code
 *
pC⁄figuøti⁄
;

498 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚
;

501 i‡((
usbfwD©a
.
usbSèã
 =
DEV_DEFAULT
Ë|| 
usbSëupHódî
.
ödex
 || usbSëupHódî.
Àngth
 || 
	`HI_UINT16
(usbSëupHódî.
vÆue
)) {

502 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

506 
	`usb§HookPro˚ssEvít
(
USBSR_EVENT_CONFIGURATION_CHANGING
, 0);

509 i‡(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
)) {

512 
pC⁄figuøti⁄
 = 
	`usbdpGëC⁄figuøti⁄Desc
(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
), 0);

515 i‡(
pC⁄figuøti⁄
) {

516 
usbfwD©a
.
usbSèã
 = 
DEV_CONFIGURED
;

517 
usbfwD©a
.
c⁄figuøti⁄VÆue
 = 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
);

520 
n
 = 0;Ç < 
pC⁄figuøti⁄
->
bNumI¡îÁ˚s
;Ç++) {

521 
usbfwD©a
.
pA…î«ãSëtög
[
n
] = 0x00;

525 
pI¡îÁ˚
 = 
	`usbdpFödNext
(
DESC_TYPE_INTERFACE
, 0);

526 } 
pI¡îÁ˚
->
bA…î«ãSëtög
 !
usbfwD©a
.
pA…î«ãSëtög
[
n
]);

529 
	`C⁄figuªEndpoöts
(
pI¡îÁ˚
);

534 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

539 
usbfwD©a
.
c⁄figuøti⁄VÆue
 = 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
);

540 
usbfwD©a
.
usbSèã
 = 
DEV_ADDRESS
;

541 
	`usbfwSëAŒEpSètus
(
EP_HALT
);

543 
	`usb§HookPro˚ssEvít
(
USBSR_EVENT_CONFIGURATION_CHANGED
, 0);

546 
	}
}

565 
	$usb§GëI¡îÁ˚
()

569 i‡((
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
Ë|| (
usbSëupHódî
.
ªque°Ty≥
 !
RT_IN_INTERFACE
Ë|| usbSëupHódî.
vÆue
 || (usbSëupHódî.
Àngth
 != 1)) {

570 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

574 
usbSëupD©a
.
pBuf„r
 = &
usbfwD©a
.
pA…î«ãSëtög
[
usbSëupHódî
.
ödex
];

575 
usbSëupD©a
.
byãsLe·
 = 1;

576 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

579 
	}
}

598 
	$usb§SëI¡îÁ˚
()

600 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚
;

603 i‡((
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
Ë|| (
usbSëupHódî
.
ªque°Ty≥
 !
RT_OUT_INTERFACE
Ë|| usbSëupHódî.
Àngth
) {

604 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

608 i‡(
pI¡îÁ˚
 = 
	`usbdpGëI¡îÁ˚Desc
(
usbfwD©a
.
c⁄figuøti⁄VÆue
, 
usbSëupHódî
.
ödex
, usbSëupHódî.
vÆue
)) {

609 
	`usb§HookPro˚ssEvít
(
USBSR_EVENT_INTERFACE_CHANGING
, 
usbSëupHódî
.
ödex
);

610 
usbfwD©a
.
pA…î«ãSëtög
[
usbSëupHódî
.
ödex
] = usbSëupHódî.
vÆue
;

613 
	`C⁄figuªEndpoöts
(
pI¡îÁ˚
);

614 
	`usb§HookPro˚ssEvít
(
USBSR_EVENT_INTERFACE_CHANGED
, 
usbSëupHódî
.
ödex
);

618 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

622 
	}
}

	@Components/hal/target/CC2540USB/usb/library/usb_standard_requests.h

9 #i‚de‡
USBSTANDARDREQUESTS_H


10 
	#USBSTANDARDREQUESTS_H


	)

61 
	#GET_STATUS
 0x00

	)

63 
	#CLEAR_FEATURE
 0x01

	)

65 
	#SET_FEATURE
 0x03

	)

67 
	#SET_ADDRESS
 0x05

	)

69 
	#GET_DESCRIPTOR
 0x06

	)

71 
	#SET_DESCRIPTOR
 0x07

	)

73 
	#GET_CONFIGURATION
 0x08

	)

75 
	#SET_CONFIGURATION
 0x09

	)

77 
	#GET_INTERFACE
 0x0A

	)

79 
	#SET_INTERFACE
 0x0B

	)

81 
	#SYNCH_FRAME
 0x0C

	)

91 
	#ENDPOINT_HALT
 0x00

	)

93 
	#DEVICE_REMOTE_WAKEUP
 0x01

	)

103 
	#USBSR_EVENT_CONFIGURATION_CHANGING
 0x01

	)

105 
	#USBSR_EVENT_CONFIGURATION_CHANGED
 0x02

	)

107 
	#USBSR_EVENT_INTERFACE_CHANGING
 0x03

	)

109 
	#USBSR_EVENT_INTERFACE_CHANGED
 0x04

	)

111 
	#USBSR_EVENT_REMOTE_WAKEUP_ENABLED
 0x05

	)

113 
	#USBSR_EVENT_REMOTE_WAKEUP_DISABLED
 0x06

	)

115 
	#USBSR_EVENT_EPIN_STALL_CLEARED
 0x07

	)

117 
	#USBSR_EVENT_EPIN_STALL_SET
 0x08

	)

119 
	#USBSR_EVENT_EPOUT_STALL_CLEARED
 0x09

	)

121 
	#USBSR_EVENT_EPOUT_STALL_SET
 0x0A

	)

133 
usb§HookSëDes¸ùt‹
();

135 
usb§HookSynchFøme
();

137 
usb§HookCÀ¨Fótuª
();

139 
usb§HookSëFótuª
();

141 
usb§HookModifyGëSètus
(
uöt8
 
ªcùõ¡
, uöt8 
ödex
, 
uöt16
 
__xd©a
 *
pSètus
);

143 
usb§HookPro˚ssEvít
(
uöt8
 
evít
, uöt8 
ödex
);

151 
usb§GëSètus
();

152 
usb§CÀ¨Fótuª
();

153 
usb§SëFótuª
();

154 
usb§SëAddªss
();

155 
usb§GëDes¸ùt‹
();

156 
usb§GëC⁄figuøti⁄
();

157 
usb§SëC⁄figuøti⁄
();

158 
usb§GëI¡îÁ˚
();

159 
usb§SëI¡îÁ˚
();

	@Components/hal/target/CC2540USB/usb/library/usb_suspend.h

9 #i‚de‡
USBSUSPEND_H


10 
	#USBSUSPEND_H


	)

90 
	~"usb_fúmw¨e_libøry_hódîs.h
"

92 (*
	tVFPTR
)();

96 
__xd©a
 
VFPTR
 
pFnSu•ídE¡îHook
;

97 
__xd©a
 
VFPTR
 
pFnSu•ídExôHook
;

101 
	`usbsu•E¡î
();

102 
uöt8
 
	`usbsu•DoRemŸeWakeup
();

103 
	`usbsu•St›Pm1
();

	@Components/hal/target/CC2541ARC/AIR_MOTION_Lib.h

84 #i‚de‡
__AIR_MOTION_LIB_H


85 
	#__AIR_MOTION_LIB_H


	)

91 
	~"°döt.h
"

94 
	~"°dboﬁ.h
"

107 
uöt8_t
 
	mLe·
 :1;

108 
uöt8_t
 
	mRight
 :1;

109 
uöt8_t
 
	mUp
 :1;

110 
uöt8_t
 
	mDown
 :1;

111 } 
	tt_°ru˘_AIR_MOTION_Swùes
;

120 
öt16_t
 
	mX
;

121 
öt16_t
 
	mY
;

122 
öt16_t
 
	mZ
;

123 } 
	tt_°ru˘_AIR_MOTION_Sís‹Axis
;

132 
öt8_t
 
	mX
;

133 
öt8_t
 
	mY
;

134 } 
	tt_°ru˘_AIR_MOTION_Dñè
;

141 
	mAúMŸi⁄Low
,

142 
	mAúMŸi⁄N‹mÆ
,

143 
	mAúMŸi⁄High


144 } 
	tt_íum_AIR_MOTION_Levñ
;

152 
t_°ru˘_AIR_MOTION_Dñè
 
	mDñèGaö
;

153 
t_°ru˘_AIR_MOTION_Sís‹Axis
 
	mGyroOff£ts
;

154 
uöt8_t
 
	mGyroSèticMaxNoi£
;

155 
uöt16_t
 
	mSèticSam∂es
;

156 
uöt16_t
 
	mSwùeMöDi°
;

157 
uöt16_t
 
	mSwùeMaxNoi£
;

158 
uöt8_t
 
	mSèπupSam∂es
;

159 
uöt8_t
 
	mClickStûlSam∂es
;

160 
t_íum_AIR_MOTION_Levñ
 
	mClickStûlTﬁî™˚
;

161 
boﬁ
 
	mIsRﬁlCompE«bÀd
;

162 
uöt16_t
 
	mAcc1gLsb
;

163 
uöt16_t
 
	mGyroSísôivôy
;

164 } 
	tt_°ru˘_AIR_MOTION_Inô
;

172 
t_°ru˘_AIR_MOTION_Sís‹Axis
 
	mGyroSam∂es
;

173 
t_°ru˘_AIR_MOTION_Sís‹Axis
 
	mAccSam∂es
;

174 
uöt8_t
 
	mClickSam∂e
;

175 } 
	tt_°ru˘_AIR_MOTION_Pro˚ssDñèSam∂es
;

183 
uöt8_t
 
	mIsDñèCompuãd
 :1;

184 
uöt8_t
 
	mIsSètic
 :1;

185 
uöt8_t
 
	mNewGyroOff£t
 :1;

186 } 
	tt_°ru˘_AIR_MOTION_Sètus
;

194 
t_°ru˘_AIR_MOTION_Sètus
 
	mSètus
;

195 
t_°ru˘_AIR_MOTION_Sís‹Axis
 
	mGyroOff£ts
;

196 
t_°ru˘_AIR_MOTION_Dñè
 
	mDñè
;

197 
t_°ru˘_AIR_MOTION_Swùes
 
	mSwùesDëe˘ed
;

198 } 
	tt_°ru˘_AIR_MOTION_Pro˚ssDñèSètus
;

237 
AIR_MOTION_Inô
(c⁄° 
t_°ru˘_AIR_MOTION_Inô
 *
pInôP¨amëîs
);

266 
t_°ru˘_AIR_MOTION_Pro˚ssDñèSètus
 
AIR_MOTION_Pro˚ssDñè
(
t_°ru˘_AIR_MOTION_Pro˚ssDñèSam∂es
 
lSís‹Sam∂es
);

	@Components/hal/target/CC2541ARC/hal_accel.c

48 
	~"comdef.h
"

49 
	~"hÆ_ac˚l.h
"

50 
	~"hÆ_bﬂrd_cfg.h
"

51 
	~"hÆ_drivîs.h
"

52 
	~"hÆ_mŸi⁄.h
"

53 
	~"oßl.h
"

61 
	#ACC_REG_ADDR_XOUT_HPF_L
 0x00

	)

62 
	#ACC_REG_ADDR_XOUT_HPF_H
 0x01

	)

63 
	#ACC_REG_ADDR_YOUT_HPF_L
 0x02

	)

64 
	#ACC_REG_ADDR_YOUT_HPF_H
 0x03

	)

65 
	#ACC_REG_ADDR_ZOUT_HPF_L
 0x04

	)

66 
	#ACC_REG_ADDR_ZOUT_HPF_H
 0x05

	)

67 
	#ACC_REG_ADDR_XOUT_L
 0x06

	)

68 
	#ACC_REG_ADDR_XOUT_H
 0x07

	)

69 
	#ACC_REG_ADDR_YOUT_L
 0x08

	)

70 
	#ACC_REG_ADDR_YOUT_H
 0x09

	)

71 
	#ACC_REG_ADDR_ZOUT_L
 0x0A

	)

72 
	#ACC_REG_ADDR_ZOUT_H
 0x0B

	)

73 
	#ACC_REG_ADDR_DCST_RESP
 0x0C

	)

74 
	#ACC_REG_ADDR_WHO_AM_I
 0x0F

	)

75 
	#ACC_REG_ADDR_TILT_POS_CUR
 0x10

	)

76 
	#ACC_REG_ADDR_TILT_POS_PRE
 0x11

	)

77 
	#ACC_REG_ADDR_INT_SRC_REG1
 0x15

	)

78 
	#ACC_REG_ADDR_INT_SRC_REG2
 0x16

	)

79 
	#ACC_REG_ADDR_STATUS_REG
 0x18

	)

80 
	#ACC_REG_ADDR_INT_REL
 0x1A

	)

81 
	#ACC_REG_ADDR_CTRL_REG1
 0x1B

	)

82 
	#ACC_REG_ADDR_CTRL_REG2
 0x1C

	)

83 
	#ACC_REG_ADDR_CTRL_REG3
 0x1D

	)

84 
	#ACC_REG_ADDR_INT_CTRL_REG1
 0x1E

	)

85 
	#ACC_REG_ADDR_INT_CTRL_REG2
 0x1F

	)

86 
	#ACC_REG_ADDR_INT_CTRL_REG3
 0x20

	)

87 
	#ACC_REG_ADDR_DATA_CTRL_REG
 0x21

	)

88 
	#ACC_REG_ADDR_TILT_TIMER
 0x28

	)

89 
	#ACC_REG_ADDR_WUF_TIMER
 0x29

	)

90 
	#ACC_REG_ADDR_TDT_TIMER
 0x2B

	)

91 
	#ACC_REG_ADDR_TDT_H_THRESH
 0x2C

	)

92 
	#ACC_REG_ADDR_TDT_L_THRESH
 0x2D

	)

93 
	#ACC_REG_ADDR_TAP_TIMER
 0x2E

	)

94 
	#ACC_REG_ADDR_TDT_TOTAL_TIMER
 0x2F

	)

95 
	#ACC_REG_ADDR_TDT_LATENCY_TIMER
 0x30

	)

96 
	#ACC_REG_ADDR_TDT_WINDOW_TIMER
 0x31

	)

97 
	#ACC_REG_ADDR_SELF_TEST
 0x3A

	)

98 
	#ACC_REG_ADDR_WUF_THRESH
 0x5A

	)

99 
	#ACC_REG_ADDR_TILT_ANGLE
 0x5C

	)

100 
	#ACC_REG_ADDR_HYST_SET
 0x5F

	)

103 
	#CTRL_REG1_PC1_OPERATING_MODE
 0x80

	)

104 
	#CTRL_REG1_PC1_STANDBY_MODE
 0x00

	)

105 
	#CTRL_REG1_RES_12BIT
 0x40

	)

106 
	#CTRL_REG1_RES_8BIT
 0x00

	)

107 
	#CTRL_REG1_DRDYE_INT_ENABLED
 0x20

	)

108 
	#CTRL_REG1_DRDYE_INT_DISABLED
 0x00

	)

109 
	#CTRL_REG1_GSEL_8G
 0x10

	)

110 
	#CTRL_REG1_GSEL_4G
 0x08

	)

111 
	#CTRL_REG1_GSEL_2G
 0x00

	)

112 
	#CTRL_REG1_TDTE_ENABLED
 0x04

	)

113 
	#CTRL_REG1_TDTE_DISABLED
 0x00

	)

114 
	#CTRL_REG1_WUFE_ENABLED
 0x02

	)

115 
	#CTRL_REG1_WUFE_DISABLED
 0x00

	)

116 
	#CTRL_REG1_TPE_ENABLED
 0x01

	)

117 
	#CTRL_REG1_TPE_DISABLED
 0x00

	)

119 
	#CTRL_REG3_OWUF_ODR_100HZ
 0x02

	)

121 
	#INT_CTRL_REG1_INT_ENABLED
 0x20

	)

122 
	#INT_CTRL_REG1_POLARITY_HIGH
 0x10

	)

124 
	#INT_CTRL_REG2_X_AXIS_ENABLED
 0x80

	)

125 
	#INT_CTRL_REG2_Y_AXIS_ENABLED
 0x40

	)

126 
	#INT_CTRL_REG2_Z_AXIS_ENABLED
 0x20

	)

128 
	#DATA_CTRL_REG_LPF_ODR_50HZ
 0x02

	)

129 
	#DATA_CTRL_REG_LPF_ODR_100HZ
 0x03

	)

130 
	#DATA_CTRL_REG_LPF_ODR_200HZ
 0x04

	)

131 
	#DATA_CTRL_REG_LPF_ODR_400HZ
 0x05

	)

132 
	#DATA_CTRL_REG_LPF_ODR_800HZ
 0x06

	)

135 
	#HAL_ACCEL_P1_GPIO_PINS
 ( 
	`BV
(2Ë)

	)

138 
	#HAL_ACCEL_P1_INPUT_PINS
 ( 
	`BV
(2Ë)

	)

141 
	#HAL_ACCEL_P1_INTERRUPT_PINS
 ( 
	`BV
(2Ë)

	)

144 
	#HAL_ACCEL_POWER_PIN_BV
 ( 
	`BV
(6Ë)

	)

145 
	#HAL_ACCEL_POWER_PIN
 
P1_6


	)

146 
	#HAL_ACCEL_POWER_PxDIR
 
P1DIR


	)

147 
	#HAL_ACCEL_POWER_PxSEL
 
P1SEL


	)

165 
uöt8
 
	maddr
;

166 
uöt8
 
	md©a
;

167 } 
	thÆAc˚lC⁄fig_t
;

173 
hÆAc˚lC⁄fig_t
 
	gHÆAc˚lE«bÀC⁄figTabÀ
[] =

175 { 
ACC_REG_ADDR_CTRL_REG1
, 0 },

176 { 
ACC_REG_ADDR_CTRL_REG2
, 0 },

177 { 
ACC_REG_ADDR_CTRL_REG3
, 0 },

178 { 
ACC_REG_ADDR_INT_CTRL_REG1
, 
INT_CTRL_REG1_POLARITY_HIGH
 },

179 { 
ACC_REG_ADDR_INT_CTRL_REG2
, 0 },

180 { 
ACC_REG_ADDR_INT_CTRL_REG3
, 0 },

181 { 
ACC_REG_ADDR_DATA_CTRL_REG
, 
DATA_CTRL_REG_LPF_ODR_200HZ
 },

182 { 
ACC_REG_ADDR_CTRL_REG1
, 
CTRL_REG1_PC1_OPERATING_MODE
 | 
CTRL_REG1_GSEL_2G
}

184 
	#HAL_ACCEL_ENABLE_CONFIG_TABLE_SIZE
 ((
HÆAc˚lE«bÀC⁄figTabÀ
Ë/ (HÆAc˚lE«bÀC⁄figTabÀ[0]))

	)

186 
hÆAc˚lC⁄fig_t
 
	gHÆAc˚lMŸi⁄Dëe˘C⁄figTabÀ
[] =

188 { 
ACC_REG_ADDR_CTRL_REG1
, 0 },

189 { 
ACC_REG_ADDR_CTRL_REG3
, 
CTRL_REG3_OWUF_ODR_100HZ
 },

190 { 
ACC_REG_ADDR_INT_CTRL_REG1
, 
INT_CTRL_REG1_INT_ENABLED
 | 
INT_CTRL_REG1_POLARITY_HIGH
 },

191 { 
ACC_REG_ADDR_INT_CTRL_REG2
, 
INT_CTRL_REG2_X_AXIS_ENABLED
 | 
INT_CTRL_REG2_Y_AXIS_ENABLED
 | 
INT_CTRL_REG2_Z_AXIS_ENABLED
 },

192 { 
ACC_REG_ADDR_INT_CTRL_REG3
, 0 },

193 { 
ACC_REG_ADDR_DATA_CTRL_REG
, 
DATA_CTRL_REG_LPF_ODR_200HZ
 },

194 { 
ACC_REG_ADDR_WUF_TIMER
, 25 },

195 { 
ACC_REG_ADDR_WUF_THRESH
, 0x08 },

196 { 
ACC_REG_ADDR_CTRL_REG1
, 
CTRL_REG1_PC1_OPERATING_MODE
 | 
CTRL_REG1_WUFE_ENABLED
 | 
CTRL_REG1_GSEL_2G
 }

198 
	#HAL_ACCEL_MOTION_DETECT_CONFIG_TABLE_SIZE
 ((
HÆAc˚lMŸi⁄Dëe˘C⁄figTabÀ
Ë/ (HÆAc˚lMŸi⁄Dëe˘C⁄figTabÀ[0]))

	)

200 
hÆAc˚lC⁄fig_t
 
	gHÆAc˚lLowPowîC⁄figTabÀ
[] =

202 { 
ACC_REG_ADDR_CTRL_REG1
, 0 }

204 
	#HAL_ACCEL_LOW_POWER_CONFIG_TABLE_SIZE
 ((
HÆAc˚lLowPowîC⁄figTabÀ
Ë/ (HÆAc˚lLowPowîC⁄figTabÀ[0]))

	)

210 
hÆAc˚lPro˚ssMŸi⁄Dëe˘I¡îru±
( );

216 
hÆAc˚lCBack_t
 
	gpHÆAc˚lPro˚ssFun˘i⁄
;

229 
	$hÆAc˚lPro˚ssMŸi⁄Dëe˘I¡îru±
( )

232 
P1IEN
 &(
uöt8
Ë~
HAL_ACCEL_P1_INTERRUPT_PINS
;

235 
IEN2
 &~(
	`BV
( 4 ));

238 
	`oßl_£t_evít
–
HÆ_TaskID
, 
HAL_MOTION_DETECTED_EVENT
 );

239 
	}
}

250 
	$hÆAc˚lPro˚ssMŸi⁄Dëe˘Evít
( )

253 i‡(
pHÆAc˚lPro˚ssFun˘i⁄
 !
NULL
)

255 
	`pHÆAc˚lPro˚ssFun˘i⁄
();

257 
	}
}

274 
	$HÆAc˚lInô
( )

277 
HAL_ACCEL_POWER_PxDIR
 |
HAL_ACCEL_POWER_PIN_BV
;

280 
HAL_ACCEL_POWER_PIN
 = 1;

283 
HAL_ACCEL_POWER_PxSEL
 &~
HAL_ACCEL_POWER_PIN_BV
;

284 
P1SEL
 &(
uöt8
Ë~
HAL_ACCEL_P1_GPIO_PINS
;

287 
P1DIR
 &(
uöt8
Ë~
HAL_ACCEL_P1_INPUT_PINS
;

292 
P2INP
 |= 0x40;

295 
pHÆAc˚lPro˚ssFun˘i⁄
 = 
NULL
;

296 
	}
}

313 
	$HÆAc˚lE«bÀ
( )

315 
uöt8
 
i
, 
dummy
;

318 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_ACCELEROMETER
,

319 
ACC_REG_ADDR_CTRL_REG1
,

320 &
HÆAc˚lE«bÀC⁄figTabÀ
[0].
d©a
,

324 
	`HÆMŸi⁄I2cRód
–
HAL_MOTION_DEVICE_ACCELEROMETER
,

325 
ACC_REG_ADDR_INT_REL
,

327 &
dummy
 );

330 
i
 = 0; i < 
HAL_ACCEL_ENABLE_CONFIG_TABLE_SIZE
; i++)

332 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_ACCELEROMETER
,

333 
HÆAc˚lE«bÀC⁄figTabÀ
[
i
].
addr
,

334 &
HÆAc˚lE«bÀC⁄figTabÀ
[
i
].
d©a
,

337 
	}
}

354 
	$HÆAc˚lDißbÀ
( )

356 
uöt8
 
i
;

359 
i
 = 0; i < 
HAL_ACCEL_LOW_POWER_CONFIG_TABLE_SIZE
; i++)

361 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_ACCELEROMETER
,

362 
HÆAc˚lLowPowîC⁄figTabÀ
[
i
].
addr
,

363 &
HÆAc˚lLowPowîC⁄figTabÀ
[
i
].
d©a
,

366 
	}
}

383 
	$HÆAc˚lMŸi⁄Dëe˘
–
hÆAc˚lCBack_t
 
cback
 )

385 
uöt8
 
i
;

388 
pHÆAc˚lPro˚ssFun˘i⁄
 = 
cback
;

391 
i
 = 0; i < 
HAL_ACCEL_MOTION_DETECT_CONFIG_TABLE_SIZE
; i++)

393 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_ACCELEROMETER
,

394 
HÆAc˚lMŸi⁄Dëe˘C⁄figTabÀ
[
i
].
addr
,

395 &
HÆAc˚lMŸi⁄Dëe˘C⁄figTabÀ
[
i
].
d©a
,

400 
P1IFG
 = (
uöt8
Ë(~
HAL_ACCEL_P1_INTERRUPT_PINS
);

401 
P1IF
 = 0;

404 
P1IEN
 |
HAL_ACCEL_P1_INTERRUPT_PINS
;

407 
IEN2
 |
	`BV
( 4 );

408 
	}
}

423 
	$HAL_ISR_FUNCTION
–
hÆAc˚lP‹t1I§
, 
P1INT_VECTOR
 )

425 
	`HAL_ENTER_ISR
();

428 i‡((
P1IFG
 & 
HAL_ACCEL_P1_INTERRUPT_PINS
Ë&& (
P1IEN
 & HAL_ACCEL_P1_INTERRUPT_PINS))

430 
	`hÆAc˚lPro˚ssMŸi⁄Dëe˘I¡îru±
();

433 
P1IFG
 = 0;

434 
P1IF
 = 0;

436 
	`HAL_EXIT_ISR
();

437 
	}
}

	@Components/hal/target/CC2541ARC/hal_accel.h

41 #i‚de‡
HAL_ACCEL_H


42 
	#HAL_ACCEL_H


	)

44 #ifde‡
__˝lu•lus


53 
	~"comdef.h
"

59 
	#HAL_ACCEL_I2C_ADDRESS
 0x0F

	)

60 
	#HAL_ACCEL_OUTPUT_DATA_ADDRESS
 0x06

61 

	)

66 (*
hÆAc˚lCBack_t
) ( );

88 
HÆAc˚lInô
( );

105 
HÆAc˚lE«bÀ
( );

122 
HÆAc˚lDißbÀ
( );

139 
HÆAc˚lMŸi⁄Dëe˘
–
hÆAc˚lCBack_t
 
cback
 );

157 
HÆAc˚lRód
–
öt8
 *
y
, i¡8 *
z
 );

174 
hÆAc˚lPro˚ssMŸi⁄Dëe˘Evít
( );

179 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ARC/hal_aes.c

42 
	~"oßl.h
"

43 
	~"hÆ_´s.h
"

44 
	~"hÆ_dma.h
"

66 (*
pS•AesEn¸y±
)–
uöt8
 *, uöt8 * ) = (*)
NULL
;

71 
	`´sDmaInô
( );

73 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

85 
	$´sDmaInô
( )

87 
hÆDMADesc_t
 *
ch
;

90 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

91 
	`HAL_DMA_SET_DEST
–
ch
, 
HAL_AES_IN_ADDR
 );

92 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

93 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

94 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

95 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
HAL_DMA_TRIG_ENC_DW
 );

96 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_1
 );

97 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_0
 );

98 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

99 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

100 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

103 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_OUT
 );

104 
	`HAL_DMA_SET_SOURCE
–
ch
, 
HAL_AES_OUT_ADDR
 );

105 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

106 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

107 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

108 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
HAL_DMA_TRIG_ENC_UP
 );

109 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_0
 );

110 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_1
 );

111 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

112 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

113 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

114 
	}
}

117 #i‡(!
deföed
 
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

129 
	$AesLﬂdBlock
–
uöt8
 *
±r
 )

131 
uöt8
 
i
;

134 
	`AES_START
();

137 
i
 = 0; i < 
STATE_BLENGTH
; i++)

139 
ENCDI
 = *
±r
++;

141 
	}
}

155 
	$AesSèπBlock
–
uöt8
 *
out
, uöt8 *
ö
 )

157 
uöt8
 
i
;

160 
	`AES_START
();

163 
i
 = 0; i < 
STATE_BLENGTH
; i++)

165 
ENCDI
 = *
ö
++;

169 
	`HAL_AES_DELAY
();

172 
i
 = 0; i < 
STATE_BLENGTH
; i++)

174 *
out
++ = 
ENCDO
;

176 
	}
}

192 
	$AesSèπSh‹tBlock
–
uöt8
 *
out
, uöt8 *
ö
 )

194 
uöt8
 
i
, 
j
;

196 
	`AES_START
();

197 
i
 = 0; i < 4; i++)

200 
j
 = 0; j < 4; j++)

202 
ENCDI
 = *
ö
++;

206 
	`HAL_AES_DELAY
();

209 
j
 = 0; j < 4; j++)

211 *
out
++ = 
ENCDO
;

214 
	}
}

228 
	$AesLﬂdIV
–
uöt8
 *
IV
 )

230 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

231 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

234 
	`HAL_DMA_SET_SOURCE
–
ch
, 
IV
 );

235 
	`HAL_DMA_SET_LEN
–
ch
, 
STATE_BLENGTH
 );

238 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

239 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

241 
	`asm
("NOP");

242 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

245 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_IV
 );

248 
	`AES_START
();

249  !(
ENCCS
 & 0x08) );

252 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_IV
 );

255 
	`AesLﬂdBlock
–
IV
 );

257 
	}
}

270 
	$AesLﬂdKey
–
uöt8
 *
AesKey
 )

272 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

273 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

276 
	`HAL_DMA_SET_SOURCE
–
ch
, 
AesKey
 );

277 
	`HAL_DMA_SET_LEN
–
ch
, 
KEY_BLENGTH
 );

280 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

281 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

283 
	`asm
("NOP");

284 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

287 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_KEY
 );

290 
	`AES_START
();

291  !(
ENCCS
 & 0x08) );

294 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_KEY
 );

297 
	`AesLﬂdBlock
–
AesKey
 );

299 
	}
}

301 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

321 
	$AesDmaSëup
–
uöt8
 *
C°©e
, 
uöt16
 
msg_out_Àn
, uöt8 *
msg_ö
, uöt16 
msg_ö_Àn
 )

323 
hÆDMADesc_t
 *
ch
;

326 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

327 
	`HAL_DMA_SET_SOURCE
–
ch
, 
msg_ö
 );

328 
	`HAL_DMA_SET_LEN
–
ch
, 
msg_ö_Àn
 );

331 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_OUT
 );

332 
	`HAL_DMA_SET_DEST
–
ch
, 
C°©e
 );

333 
	`HAL_DMA_SET_LEN
–
ch
, 
msg_out_Àn
 );

336 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

337 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

339 
	`asm
("NOP");

340 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

341 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_OUT
 );

342 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_OUT
 );

344 
	`asm
("NOP");

345 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_OUT
));

346 
	}
}

360 
	$HÆAesInô
( )

362 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

364 
	`´sDmaInô
();

366 
	}
}

379 
	$s•_HW_KeyInô
–
uöt8
 *
AesKey
 )

381 
	`AES_SETMODE
(
ECB
);

382 
	`AesLﬂdKey
–
AesKey
 );

383 
	}
}

402 
	$s•AesEn¸y±HW
–
uöt8
 *
AesKey
, uöt8 *
C°©e
 )

404 ()
AesKey
;

406 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

408 
	`AesDmaSëup
–
C°©e
, 
STATE_BLENGTH
, Cstate, STATE_BLENGTH );

409 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_ENCRYPT
 );

412 
	`AES_START
();

413  !
	`HAL_DMA_CHECK_IRQ
–
HAL_DMA_AES_OUT
 ) );

416 
	`AES_SETMODE
(
ECB
);

417 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_ENCRYPT
 );

420 
	`AesSèπBlock
–
C°©e
, Cstate );

422 
	}
}

	@Components/hal/target/CC2541ARC/hal_aes.h

39 #i‚de‡
HAL_AES_H_


40 
	#HAL_AES_H_


	)

42 
	~"hÆ_ty≥s.h
"

44 
	#STATE_BLENGTH
 16

45 
	#KEY_BLENGTH
 16

46 
	#KEY_EXP_LENGTH
 176

47 

	)

52 #i‡((
deföed
 
SOFTWARE_AES
Ë&& (SOFTWARE_AES =
TRUE
)Ë&& ((deföed 
SW_AES_AND_KEY_EXP
) && (SW_AES_AND_KEY_EXP == TRUE))

56 
HÆAesInô
( );

57 
AesLﬂdBlock
–
uöt8
 * );

58 
AesSèπBlock
–
uöt8
 *, uint8 * );

59 
AesSèπSh‹tBlock
–
uöt8
 *, uint8 * );

60 
AesLﬂdIV
(
uöt8
 *);

61 
AesDmaSëup
–
uöt8
 *, 
uöt16
, uint8 *, uint16 );

62 
AesLﬂdKey
–
uöt8
 * );

64 (*
pS•AesEn¸y±
)–
uöt8
 *, uint8 * );

65 
	`s•_HW_KeyInô
 (
uöt8
 *);

66 
	`s•KeyEx∑nsi⁄
 (
uöt8
 *, uint8 *);

68 
	`s•AesEn¸y±HW
 (
uöt8
 *, uint8 *);

69 
	`s•AesEn¸y±KeyExp
 (
uöt8
 *, uint8 *);

70 
	`s•AesEn¸y±Basic
 (
uöt8
 *, uint8 *);

72 
	`s•AesDe¸y±HW
–
uöt8
 *, uint8 * );

73 
	`s•AesDe¸y±
–
uöt8
 *
key
, uöt8 *
buf
 );

76 
	#AES_BUSY
 0x08

	)

77 
	#ENCRYPT
 0x00

	)

78 
	#DECRYPT
 0x01

	)

81 
	#AES_SETMODE
(
mode
) \

83 
ENCCS
 = (ENCCS & ~0x70Ë| (
mode
); \

84 
	}
} 0)

	)

87 
	#CBC
 0x00

	)

88 
	#CFB
 0x10

	)

89 
	#OFB
 0x20

	)

90 
	#CTR
 0x30

	)

91 
	#ECB
 0x40

	)

92 
	#CBC_MAC
 0x50

	)

95 
	#AES_SET_ENCR_DECR_KEY_IV
(
cmd
) \

97 
ENCCS
 = (ENCCS & ~0x07Ë| (
cmd
); \

98 } 0)

	)

101 
	#AES_ENCRYPT
 0x00

	)

102 
	#AES_DECRYPT
 0x02

	)

103 
	#AES_LOAD_KEY
 0x04

	)

104 
	#AES_LOAD_IV
 0x06

	)

108 
	#AES_START
(Ë
ENCCS
 |0x01

	)

111 
	#HAL_DMA_AES_IN
 1

	)

112 
	#HAL_DMA_AES_OUT
 2

	)

115 
	#HAL_AES_IN_ADDR
 0x70B1

	)

116 
	#HAL_AES_OUT_ADDR
 0x70B2

	)

118 #i‡!
deföed
 (
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

119 
	#HAL_AES_DELAY
() \

121 vﬁ©ûê
uöt8
 
dñay
 = 15; \

122 
dñay
--); \

123 } 0)

	)

	@Components/hal/target/CC2541ARC/hal_buzzer.c

43 
	~"hÆ_bﬂrd.h
"

44 
	~"hÆ_buzzî.h
"

45 
	~"hÆ_drivîs.h
"

46 
	~"oßl.h
"

53 
	#HAL_T4_CC0_VALUE
 125

	)

54 
	#HAL_T4_TIMER_CTL_DIV32
 0xA0

	)

55 
	#HAL_T4_TIMER_CTL_START
 0x10

	)

56 
	#HAL_T4_TIMER_CTL_CLEAR
 0x04

	)

57 
	#HAL_T4_TIMER_CTL_OPMODE_MODULO
 0x02

	)

58 
	#HAL_T4_TIMER_CCTL_MODE_COMPARE
 0x04

	)

59 
	#HAL_T4_TIMER_CCTL_CMP_TOGGLE
 0x10

	)

60 
	#HAL_T4_TIMER_CTL_DIV64
 0xC0

	)

63 
	#HAL_BUZZER_P1_GPIO_PINS
 ( 
	`BV
–0 ) )

	)

66 
	#HAL_BUZZER_P1_OUTPUT_PINS
 ( 
	`BV
–0 ) )

	)

69 
	#HAL_BUZZER_ENABLE_PIN
 
P1_0


	)

75 
	#HAL_BUZZER_DISABLE
(Ë–
HAL_BUZZER_ENABLE_PIN
 = 0 )

	)

85 
hÆBuzzîCBack_t
 
	gpHÆBuzzîRögCom∂ëeNŸifiˇti⁄Fun˘i⁄
;

104 
	$HÆBuzzîInô
( )

106 
pHÆBuzzîRögCom∂ëeNŸifiˇti⁄Fun˘i⁄
 = 
NULL
;

109 
	`HAL_BUZZER_DISABLE
();

112 
P1DIR
 |(
uöt8
Ë
HAL_BUZZER_P1_OUTPUT_PINS
;

113 
	}
}

132 
	$HÆBuzzîRög
–
uöt16
 
m£c
,

133 
uöt8
 
t⁄e
,

134 
hÆBuzzîCBack_t
 
buzzîCback
 )

137 
pHÆBuzzîRögCom∂ëeNŸifiˇti⁄Fun˘i⁄
 = 
buzzîCback
;

140 
P1SEL
 |(
uöt8
Ë
HAL_BUZZER_P1_GPIO_PINS
;

142 i‡–
t⁄e
 =
HAL_BUZZER_LOW_TONE
 )

145 
T4CTL
 = 
HAL_T4_TIMER_CTL_DIV64
 |

146 
HAL_T4_TIMER_CTL_CLEAR
 |

147 
HAL_T4_TIMER_CTL_OPMODE_MODULO
;

152 
T4CTL
 = 
HAL_T4_TIMER_CTL_DIV32
 |

153 
HAL_T4_TIMER_CTL_CLEAR
 |

154 
HAL_T4_TIMER_CTL_OPMODE_MODULO
;

157 
T4CCTL0
 = 
HAL_T4_TIMER_CCTL_MODE_COMPARE
 | 
HAL_T4_TIMER_CCTL_CMP_TOGGLE
;

158 
T4CC0
 = 
HAL_T4_CC0_VALUE
;

161 
T4CTL
 |
HAL_T4_TIMER_CTL_START
;

164 
	`oßl_°¨t_timîEx
–
HÆ_TaskID
,

165 
HAL_BUZZER_EVENT
,

166 
m£c
 );

168 
	}
}

179 
	$HÆBuzzîSt›
( )

182 
T4CTL
 = 0;

185 
P1SEL
 &(
uöt8
Ë~
HAL_BUZZER_P1_GPIO_PINS
;

188 i‡(
pHÆBuzzîRögCom∂ëeNŸifiˇti⁄Fun˘i⁄
 !
NULL
)

190 
	`pHÆBuzzîRögCom∂ëeNŸifiˇti⁄Fun˘i⁄
();

192 
	}
}

	@Components/hal/target/CC2541ARC/hal_buzzer.h

41 #i‚de‡
HAL_BUZZER_H


42 
	#HAL_BUZZER_H


	)

44 #ifde‡
__˝lu•lus


53 
	~"comdef.h
"

59 
	#HAL_BUZZER_LOW_TONE
 0

	)

60 
	#HAL_BUZZER_HIGH_TONE
 1

	)

67 (*
hÆBuzzîCBack_t
) ();

89 
HÆBuzzîInô
( );

108 
HÆBuzzîRög
–
uöt16
 
m£c
,

109 
uöt8
 
t⁄e
,

110 
hÆBuzzîCBack_t
 
buzzîCback
 );

121 
HÆBuzzîSt›
( );

123 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ARC/hal_drivers.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"OSAL.h
"

46 
	~"hÆ_drivîs.h
"

47 
	~"hÆ_adc.h
"

48 #i‡(
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
)

49 
	~"hÆ_dma.h
"

51 
	~"hÆ_Êash.h
"

52 #i‡((
deföed
 
HAL_I2C
Ë&& (HAL_I2C =
TRUE
))

53 
	~"hÆ_i2c.h
"

55 
	~"hÆ_key.h
"

56 
	~"hÆ_lcd.h
"

57 
	~"hÆ_Àd.h
"

58 
	~"hÆ_timî.h
"

59 
	~"hÆ_u¨t.h
"

60 
	~"hÆ_¶ìp.h
"

62 #i‡(
deföed
 
HAL_AES
Ë&& (HAL_AES =
TRUE
)

63 
	~"hÆ_´s.h
"

65 #i‡(
deföed
 
HAL_MOTION
Ë&& (HAL_MOTION =
TRUE
)

66 
	~"hÆ_gyro.h
"

67 
	~"hÆ_mŸi⁄.h
"

69 #i‡(
deföed
 
HAL_SPI
Ë&& (HAL_SPI =
TRUE
)

70 
	~"hÆ_•i.h
"

72 #i‡(
deföed
 
HAL_BUZZER
Ë&& (HAL_BUZZER =
TRUE
)

73 
	~"hÆ_buzzî.h
"

75 #i‡(
deföed
 
HAL_GPIO_DBG
Ë&& (HAL_GPIO_DBG =
TRUE
)

76 
	~"hÆ_gpiodbg.h
"

96 
uöt8
 
	gHÆ_TaskID
;

98 
HÆLedUpd©e
( );

113 
	$HÆ_Inô
–
uöt8
 
èsk_id
 )

116 
HÆ_TaskID
 = 
èsk_id
;

121 #i‡(
deföed
 
HAL_MOTION
Ë&& (HAL_MOTION =
TRUE
)

122 
	`HÆMŸi⁄Inô
();

124 
	}
}

135 
	$HÆDrivîInô
 ()

138 #i‡(
deföed
 
HAL_VDDMON
Ë&& (HAL_VDDMON =
TRUE
)

139 
	`HÆVddM⁄Inô
();

143 #i‡(
deföed
 
HAL_ADC
Ë&& (HAL_ADC =
TRUE
)

144 
	`HÆAdcInô
();

148 #i‡(
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
)

150 
	`HÆDmaInô
();

154 #i‡(
deföed
 
HAL_AES
Ë&& (HAL_AES =
TRUE
)

155 
	`HÆAesInô
();

159 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

160 
	`HÆLcdInô
();

164 #i‡(
deföed
 
HAL_LED
Ë&& (HAL_LED =
TRUE
)

165 
	`HÆLedInô
();

169 #i‡(
deföed
 
HAL_UART
Ë&& (HAL_UART =
TRUE
)

170 
	`HÆUARTInô
();

174 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

175 
	`HÆKeyInô
();

179 #i‡(
deföed
 
HAL_SPI
Ë&& (HAL_SPI =
TRUE
)

180 
	`HÆSpiInô
();

184 #i‡(
deföed
 
HAL_BUZZER
Ë&& (HAL_BUZZER =
TRUE
)

185 
	`HÆBuzzîInô
();

189 #i‡(
deföed
 
HAL_GPIO_DBG
Ë&& (HAL_GPIO_DBG =
TRUE
)

190 
	`HÆGpioDbgInô
();

192 
	}
}

211 
	$hÆDrivîBegPM
()

213 #i‡((
deföed
 
HAL_LED
Ë&& (HAL_LED =
TRUE
))

214 
	`HÆLedE¡îSÀï
();

216 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

217 
	`HÆKeyE¡îSÀï
();

219 #i‡((
deföed
 
HAL_I2C
Ë&& (HAL_I2C =
TRUE
))

220 
	`HÆI2CE¡îSÀï
();

222 
	}
}

241 
	$hÆDrivîEndPM
()

243 #i‡((
deföed
 
HAL_LED
Ë&& (HAL_LED =
TRUE
))

244 
	`HÆLedExôSÀï
();

246 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

247 
	`HÆKeyExôSÀï
();

249 #i‡((
deföed
 
HAL_I2C
Ë&& (HAL_I2C =
TRUE
))

250 
	`HÆI2CExôSÀï
();

252 
	}
}

264 
uöt16
 
	$HÆ_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

266 
uöt8
 *
msgPå
;

268 ()
èsk_id
;

270 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

272 
msgPå
 = 
	`oßl_msg_ª˚ive
(
HÆ_TaskID
);

274 
msgPå
)

279 
	`oßl_msg_dóŒoˇã
–
msgPå
 );

281 
msgPå
 = 
	`oßl_msg_ª˚ive
–
HÆ_TaskID
 );

283  
evíts
 ^ 
SYS_EVENT_MSG
;

286 i‡–
evíts
 & 
HAL_LED_BLINK_EVENT
 )

288 #i‡(
	`deföed
 (
BLINK_LEDS
)Ë&& (
HAL_LED
 =
TRUE
)

289 
	`HÆLedUpd©e
();

291  
evíts
 ^ 
HAL_LED_BLINK_EVENT
;

294 i‡(
evíts
 & 
HAL_KEY_EVENT
)

297 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

299 
	`HÆKeyPﬁl
();

302 i‡(!
HÆ_KeyI¡E«bÀ
)

304 
	`oßl_°¨t_timîEx
–
HÆ_TaskID
, 
HAL_KEY_EVENT
, 100);

308  
evíts
 ^ 
HAL_KEY_EVENT
;

311 #i‡(
deföed
 
HAL_MOTION
Ë&& (HAL_MOTION =
TRUE
Ë&& (!deföed 
NO_POINTING_LIB
)

312 i‡(
evíts
 & 
HAL_MOTION_EVENT
)

314 
uöt16
 
evítH™dÀd
 = 
	`HÆMŸi⁄H™dÀOSEvít
–
evíts
 );

315  
evíts
 ^ 
evítH™dÀd
;

318 #i‡(
deföed
 
HAL_I2C
Ë&& (HAL_I2C =
TRUE
)

319 i‡(
evíts
 & 
HAL_GYRO_REGISTER_ACCESS_READY_EVENT
)

321 
	`HÆGyroH™dÀGyroRegi°îAc˚ssRódyEvít
();

322  
evíts
 ^ 
HAL_GYRO_REGISTER_ACCESS_READY_EVENT
;

327 #i‡(
deföed
 
HAL_BUZZER
Ë&& (HAL_BUZZER =
TRUE
)

328 i‡(
evíts
 & 
HAL_BUZZER_EVENT
)

330 
	`HÆBuzzîSt›
();

331  
evíts
 ^ 
HAL_BUZZER_EVENT
;

338 
	}
}

349 
	$HÆ_Pro˚ssPﬁl
 ()

351 #i‡(
deföed
 
HAL_VDDMON
Ë&& (HAL_VDDMON =
TRUE
)

352 
	`HÆVddM⁄Pﬁl
();

354 #i‡((
deföed
 
HAL_I2C
Ë&& (HAL_I2C =
TRUE
Ë&& (deföed 
HAL_I2C_POLLED
) && (HAL_I2C_POLLED == TRUE))

355 
	`HÆI2CPﬁl
();

357 #i‡(
deföed
 
HAL_UART
Ë&& (HAL_UART =
TRUE
)

358 
	`HÆUARTPﬁl
();

360 #i‡(
deföed
 
HAL_SPI
Ë&& (HAL_SPI =
TRUE
)

361 
	`HÆSpiPﬁl
();

363 #i‡(
deföed
 
HAL_HID
Ë&& (HAL_HID =
TRUE
)

364 
	`usbHidPro˚ssEvíts
();

365 
	`usbHidPro˚ssEvíts
();

367 
	}
}

	@Components/hal/target/CC2541ARC/hal_drivers.h

39 #i‚de‡
HAL_DRIVER_H


40 
	#HAL_DRIVER_H


	)

42 #ifde‡
__˝lu•lus


51 
	#HAL_KEY_EVENT
 0x0001

	)

52 
	#HAL_LED_BLINK_EVENT
 0x0002

	)

54 
	#HAL_SLEEP_TIMER_EVENT
 0x00400

	)

55 
	#PERIOD_RSSI_RESET_EVT
 0x00800

	)

57 
	#PERIOD_RSSI_RESET_TIMEOUT
 10

	)

61 
	#HAL_MOTION_GYRO_POWERUP_DONE_EVENT
 0x0004

	)

62 
	#HAL_MOTION_GYRO_CALIBRATION_DONE_EVENT
 0x0008

	)

63 
	#HAL_MOTION_MEASUREMENT_START_EVENT
 0x0010

	)

64 
	#HAL_MOTION_MEASUREMENT_DONE_EVENT
 0x0020

	)

65 
	#HAL_BUZZER_EVENT
 0x0040

	)

66 
	#HAL_GYRO_REGISTER_ACCESS_READY_EVENT
 0x0080

	)

67 
	#HAL_MOTION_DETECTED_EVENT
 0x0100

	)

68 
	#HAL_GYRO_ACTIVE_EVENT
 0x0200

	)

69 
	#HAL_MOTION_EVENT
 \

70 –
HAL_MOTION_GYRO_POWERUP_DONE_EVENT
 | \

71 
HAL_MOTION_GYRO_CALIBRATION_DONE_EVENT
 | \

72 
HAL_MOTION_MEASUREMENT_START_EVENT
 | \

73 
HAL_MOTION_MEASUREMENT_DONE_EVENT
 | \

74 
HAL_MOTION_DETECTED_EVENT
 | \

75 
HAL_GYRO_ACTIVE_EVENT
 )

	)

80 
uöt8
 
HÆ_TaskID
;

82 
HÆ_Inô
 ( 
uöt8
 
èsk_id
 );

87 
uöt16
 
HÆ_Pro˚ssEvít
 ( 
uöt8
 
èsk_id
, uöt16 
evíts
 );

92 
HÆ_Pro˚ssPﬁl
 ();

97 
HÆDrivîInô
 ();

116 
hÆDrivîBegPM
();

135 
hÆDrivîEndPM
();

137 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ARC/hal_gyro.c

44 
	~"hÆ_ac˚l.h
"

45 
	~"hÆ_mcu.h
"

46 
	~"hÆ_drivîs.h
"

47 
	~"hÆ_gyro.h
"

48 
	~"hÆ_mŸi⁄.h
"

49 
	~"oßl.h
"

56 
	#HAL_GYRO_P0_GPIO_PINS
 ( 
	`BV
–7 ) | BV–5 ) )

	)

57 
	#HAL_GYRO_P1_GPIO_PINS
 ( 
	`BV
–3 ) )

	)

60 
	#HAL_GYRO_P0_OUTPUT_PINS
 ( 
	`BV
–7 ) | BV–5 ) )

	)

61 
	#HAL_GYRO_P1_OUTPUT_PINS
 ( 
	`BV
–3 ) )

	)

64 
	#HAL_GYRO_POWER_PIN
 
P0_7


	)

65 
	#HAL_GYRO_CLKIN_PIN
 
P0_5


	)

66 
	#HAL_GYRO_INT_PIN
 
P1_3


	)

69 
	#IMU3000_REG_ADDR_WHO_AM_I
 0x00

	)

70 
	#IMU3000_REG_ADDR_X_OFFS_USRH
 0x0C

	)

71 
	#IMU3000_REG_ADDR_X_OFFS_USRL
 0x0D

	)

72 
	#IMU3000_REG_ADDR_Y_OFFS_USRH
 0x0E

	)

73 
	#IMU3000_REG_ADDR_Y_OFFS_USRL
 0x0F

	)

74 
	#IMU3000_REG_ADDR_Z_OFFS_USRH
 0x10

	)

75 
	#IMU3000_REG_ADDR_Z_OFFS_USRL
 0x11

	)

76 
	#IMU3000_REG_ADDR_FIFO_EN
 0x12

	)

77 
	#IMU3000_REG_ADDR_AUX_VDDIO
 0x13

	)

78 
	#IMU3000_REG_ADDR_AUX_SLV_ADDR
 0x14

	)

79 
	#IMU3000_REG_ADDR_SMPLRT_DIV
 0x15

	)

80 
	#IMU3000_REG_ADDR_DLPF_FS
 0x16

	)

81 
	#IMU3000_REG_ADDR_INT_CFG
 0x17

	)

82 
	#IMU3000_REG_ADDR_AUX_BURST_ADDR
 0x18

	)

83 
	#IMU3000_REG_ADDR_INT_STATUS
 0x1A

	)

84 
	#IMU3000_REG_ADDR_TEMP_OUT_H
 0x1B

	)

85 
	#IMU3000_REG_ADDR_TEMP_OUT_L
 0x1C

	)

86 
	#IMU3000_REG_ADDR_GYRO_XOUT_H
 0x1D

	)

87 
	#IMU3000_REG_ADDR_GYRO_XOUT_L
 0x1E

	)

88 
	#IMU3000_REG_ADDR_GYRO_YOUT_H
 0x1F

	)

89 
	#IMU3000_REG_ADDR_GYRO_YOUT_L
 0x20

	)

90 
	#IMU3000_REG_ADDR_GYRO_ZOUT_H
 0x21

	)

91 
	#IMU3000_REG_ADDR_GYRO_ZOUT_L
 0x22

	)

92 
	#IMU3000_REG_ADDR_AUX_XOUT_H
 0x23

	)

93 
	#IMU3000_REG_ADDR_AUX_XOUT_L
 0x24

	)

94 
	#IMU3000_REG_ADDR_AUX_YOUT_H
 0x25

	)

95 
	#IMU3000_REG_ADDR_AUX_YOUT_L
 0x26

	)

96 
	#IMU3000_REG_ADDR_AUX_ZOUT_H
 0x27

	)

97 
	#IMU3000_REG_ADDR_AUX_ZOUT_L
 0x28

	)

98 
	#IMU3000_REG_ADDR_DMP_REG1
 0x35

	)

99 
	#IMU3000_REG_ADDR_DMP_REG2
 0x36

	)

100 
	#IMU3000_REG_ADDR_DMP_REG3
 0x37

	)

101 
	#IMU3000_REG_ADDR_DMP_REG4
 0x38

	)

102 
	#IMU3000_REG_ADDR_DMP_REG5
 0x39

	)

103 
	#IMU3000_REG_ADDR_FIFO_COUNTH
 0x3A

	)

104 
	#IMU3000_REG_ADDR_FIFO_COUNTL
 0x3B

	)

105 
	#IMU3000_REG_ADDR_FIFO_R
 0x3C

	)

106 
	#IMU3000_REG_ADDR_USER_CTRL
 0x3D

	)

107 
	#IMU3000_REG_ADDR_PWR_MGM
 0x3E

	)

110 
	#AUX_IF_RST
 0x08

	)

111 
	#AUX_IF_EN
 0x20

	)

114 
	#CLK_SRC_PLL_X_GYRO_REF
 0x01

	)

115 
	#PWR_MGM_SLEEP
 0x40

	)

116 
	#PWR_MGM_STBY_XG
 0x20

	)

117 
	#PWR_MGM_STBY_YG
 0x10

	)

118 
	#PWR_MGM_STBY_ZG
 0x08

	)

129 
uöt8
 
	maddr
;

130 
uöt8
 
	md©a
;

131 } 
	thÆGyroC⁄fig_t
;

136 
hÆGyroE«bÀCback_t
 
	gpHÆGyroE«bÀPro˚ssFun˘i⁄
;

137 
hÆGyroC⁄fig_t
 
	gHÆGyroC⁄figTabÀ
[] =

139 { 
IMU3000_REG_ADDR_AUX_SLV_ADDR
, 
HAL_ACCEL_I2C_ADDRESS
 },

140 { 
IMU3000_REG_ADDR_AUX_BURST_ADDR
, 
HAL_ACCEL_OUTPUT_DATA_ADDRESS
 },

141 { 
IMU3000_REG_ADDR_SMPLRT_DIV
, 4 },

142 { 
IMU3000_REG_ADDR_DLPF_FS
, 0x19 }

144 
	#HAL_GYRO_CONFIG_TABLE_SIZE
 ((
HÆGyroC⁄figTabÀ
Ë/ (HÆGyroC⁄figTabÀ[0]))

	)

149 
gyroSÀï
( );

150 
gyroWake
( );

165 
	$HÆGyroInô
( )

168 
HAL_GYRO_POWER_PIN
 = 1;

169 
HAL_GYRO_CLKIN_PIN
 = 0;

170 
HAL_GYRO_INT_PIN
 = 0;

173 
P0SEL
 &(
uöt8
Ë~
HAL_GYRO_P0_GPIO_PINS
;

174 
P1SEL
 &(
uöt8
Ë~
HAL_GYRO_P1_GPIO_PINS
;

177 
P0DIR
 |(
uöt8
Ë
HAL_GYRO_P0_OUTPUT_PINS
;

178 
P1DIR
 |(
uöt8
Ë
HAL_GYRO_P1_OUTPUT_PINS
;

181 
pHÆGyroE«bÀPro˚ssFun˘i⁄
 = 
NULL
;

184 
	`oßl_°¨t_timîEx
–
HÆ_TaskID
,

185 
HAL_GYRO_REGISTER_ACCESS_READY_EVENT
,

187 
	}
}

198 
	$HÆGyroE«bÀ
–
hÆGyroE«bÀCback_t
 
cback
 )

201 
pHÆGyroE«bÀPro˚ssFun˘i⁄
 = 
cback
;

204 
	`gyroWake
();

207 
	`oßl_°¨t_timîEx
–
HÆ_TaskID
,

208 
HAL_GYRO_REGISTER_ACCESS_READY_EVENT
,

210 
	}
}

221 
	$HÆGyroH™dÀGyroRegi°îAc˚ssRódyEvít
( )

223 
uöt8
 
i
;

225 i‡(
pHÆGyroE«bÀPro˚ssFun˘i⁄
 !
NULL
)

228 
i
 = 0; i < 
HAL_GYRO_CONFIG_TABLE_SIZE
; i++)

230 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_GYRO
,

231 
HÆGyroC⁄figTabÀ
[
i
].
addr
,

232 &
HÆGyroC⁄figTabÀ
[
i
].
d©a
,

237 
	`pHÆGyroE«bÀPro˚ssFun˘i⁄
();

242 
	`gyroSÀï
();

244 
	}
}

255 
	$HÆGyroDißbÀ
( )

258 
	`gyroSÀï
();

259 
	}
}

270 
	$HÆGyroRód
–
öt16
 *
x
, i¡16 *
y
, i¡16 *
z
 )

272 
uöt8
 
ãmp
[6];

275 
	`HÆMŸi⁄I2cRód
–
HAL_MOTION_DEVICE_GYRO
,

276 
IMU3000_REG_ADDR_GYRO_XOUT_H
,

278 (
uöt8
 *)
ãmp
 );

281 *
x
 = (
ãmp
[2] << 8) |Åemp[3];

282 *
y
 = (
ãmp
[0] << 8) |Åemp[1];

283 *
z
 = (
ãmp
[4] << 8) |Åemp[5];

284 
	}
}

303 
	$HÆGyroRódAc˚lD©a
–
öt8
 *
x
, i¡8 *
y
, i¡8 *
z
 )

305 
uöt8
 
ãmp
[6];

308 
	`HÆMŸi⁄I2cRód
–
HAL_MOTION_DEVICE_GYRO
,

309 
IMU3000_REG_ADDR_AUX_XOUT_H
,

311 (
uöt8
 *)
ãmp
 );

332 *
x
 = 
ãmp
[1];

333 *
y
 = 
ãmp
[3];

334 *
z
 = 
ãmp
[5];

335 
	}
}

347 
	$HÆGyroE«bÀI2CPassThru
( )

349 
uöt8
 
d©a
 = 
AUX_IF_RST
;

351 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_GYRO
,

352 
IMU3000_REG_ADDR_USER_CTRL
,

353 &
d©a
,

355 
	}
}

367 
	$HÆGyroDißbÀI2CPassThru
( )

369 
uöt8
 
d©a
 = 
AUX_IF_RST
 | 
AUX_IF_EN
;

371 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_GYRO
,

372 
IMU3000_REG_ADDR_USER_CTRL
,

373 &
d©a
,

375 
	}
}

387 
	$HÆGyroSèπGyroMósuªmíts
( )

389 
uöt8
 
d©a
 = 
CLK_SRC_PLL_X_GYRO_REF
;

391 
	`HÆGyroDißbÀI2CPassThru
();

392 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_GYRO
,

393 
IMU3000_REG_ADDR_PWR_MGM
,

394 &
d©a
,

396 
	}
}

407 
	$gyroSÀï
( )

410 
uöt8
 
ªg
 = 
PWR_MGM_SLEEP
 | 
PWR_MGM_STBY_XG
 | 
PWR_MGM_STBY_YG
 | 
PWR_MGM_STBY_ZG
;

411 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_GYRO
,

412 
IMU3000_REG_ADDR_PWR_MGM
,

413 &
ªg
,

415 
	}
}

426 
	$gyroWake
( )

429 
uöt8
 
ªg
 = 0;

431 
	`HÆMŸi⁄I2cWrôe
–
HAL_MOTION_DEVICE_GYRO
,

432 
IMU3000_REG_ADDR_PWR_MGM
,

433 &
ªg
,

435 
	}
}

	@Components/hal/target/CC2541ARC/hal_gyro.h

41 #i‚de‡
HAL_GYRO_H


42 
	#HAL_GYRO_H


	)

44 #ifde‡
__˝lu•lus


53 
	~"comdef.h
"

59 
	#HAL_GYRO_OUTPUT_SETTLING_TIME
 200

60 
	#HAL_GYRO_CAL_SETTLING_TIME
 10

61 
	#HAL_GYRO_I2C_ADDRESS
 0x68

	)

67 (*
hÆGyroE«bÀCback_t
) ( );

89 
HÆGyroInô
( );

106 
HÆGyroE«bÀ
–
hÆGyroE«bÀCback_t
 
cback
 );

117 
HÆGyroH™dÀGyroRegi°îAc˚ssRódyEvít
( );

134 
HÆGyroDißbÀ
( );

145 
HÆGyroRód
–
öt16
 *
x
, i¡16 *
y
, i¡16 *
z
 );

164 
HÆGyroRódAc˚lD©a
–
öt8
 *
x
, i¡8 *
y
, i¡8 *
z
 );

176 
HÆGyroE«bÀI2CPassThru
( );

188 
HÆGyroDißbÀI2CPassThru
( );

200 
HÆGyroSèπGyroMósuªmíts
( );

202 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ARC/hal_i2c.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_bﬂrd_cfg.h
"

47 #i‡(
deföed
 
HAL_I2C
Ë&& (HAL_I2C =
TRUE
)

48 
	~"hÆ_as£π.h
"

49 
	~"hÆ_i2c.h
"

50 
	~"oßl.h
"

57 
	#I2C_ENS1
 
	`BV
(6)

	)

58 
	#I2C_STA
 
	`BV
(5)

	)

59 
	#I2C_STO
 
	`BV
(4)

	)

60 
	#I2C_SI
 
	`BV
(3)

	)

61 
	#I2C_AA
 
	`BV
(2)

	)

62 
	#I2C_MST_RD_BIT
 
	`BV
(0)

63 

	)

64 
	#I2C_CLOCK_MASK
 0x83

	)

66 
	#I2C_PXIFG
 
P2IFG


	)

67 
	#I2C_IF
 
P2IF


	)

68 
	#I2C_IE
 
	`BV
(1)

	)

77 
	mm°Sèπed
 = 0x08,

78 
	mm°RïSèπ
 = 0x10,

79 
	mm°AddrAckW
 = 0x18,

80 
	mm°AddrNackW
 = 0x20,

81 
	mm°D©aAckW
 = 0x28,

82 
	mm°D©aNackW
 = 0x30,

83 
	mm°Lo°Arb
 = 0x38,

84 
	mm°AddrAckR
 = 0x40,

85 
	mm°AddrNackR
 = 0x48,

86 
	mm°D©aAckR
 = 0x50,

87 
	mm°D©aNackR
 = 0x58,

90 
	m¶vAddrAckR
 = 0x60,

91 
	mm°Lo°ArbR
 = 0x68,

92 
	m¶vAddrAckG
 = 0x70,

93 
	mm°Lo°ArbG
 = 0x78,

94 
	m¶vD©aAckR
 = 0x80,

95 
	m¶vD©aNackR
 = 0x88,

96 
	mgíD©aAckR
 = 0x90,

97 
	mgíD©aNackR
 = 0x98,

98 
	m¶vSt›≥d
 = 0xA0,

99 
	m¶vAddrAckW
 = 0xA8,

100 
	mm°Lo°ArbW
 = 0xB0,

101 
	m¶vD©aAckW
 = 0xB8,

102 
	m¶vD©aNackW
 = 0xC0,

103 
	m¶vLa°AckW
 = 0xC8,

106 
	mi2cIdÀ
 = 0xF8

107 } 
	ti2cSètus_t
;

114 
	#I2C_WRAPPER_DISABLE
(Ë
	`°
–
I2CWC
 = 0x0C; )

	)

115 
	#I2C_CLOCK_RATE
(
x
Ë
	`°
–
I2CCFG
 &~
I2C_CLOCK_MASK
; \

116 
I2CCFG
 |
x
; )

	)

118 
	#I2C_CLR_NACK
(Ë
	`°
–
I2CCFG
 |
I2C_AA
; I2CCFG &~
I2C_SI
; )

	)

119 
	#I2C_SET_NACK
(Ë
	`°
–
I2CCFG
 &~
I2C_AA
; )

	)

120 
	#I2C_SET_ACK
(Ë
	`°
–
I2CCFG
 |
I2C_AA
; )

	)

123 
	#I2C_ENABLE
(Ë
	`°
–
I2CCFG
 |(
I2C_ENS1
 | 
I2C_AA
); )

	)

126 
	#I2C_STRT
(Ë
	`°
 ( \

127 
I2CCFG
 &~
I2C_SI
; \

128 
I2CCFG
 |
I2C_STA
; \

129 (
I2CCFG
 & 
I2C_SI
) == 0); \

130 
I2CCFG
 &~
I2C_STA
; \

131 )

	)

134 
	#I2C_STOP
(Ë
	`°
 ( \

135 
I2CCFG
 |
I2C_STO
; \

136 
I2CCFG
 &~
I2C_SI
; \

137 (
I2CCFG
 & 
I2C_STO
) != 0); \

138 )

	)

141 
	#I2C_READ
(
_X_
Ë
	`°
 ( \

142 
I2CCFG
 &~
I2C_SI
; \

143 (
I2CCFG
 & 
I2C_SI
) == 0); \

144 (
_X_
Ë
I2CDATA
; \

145 )

	)

148 
	#I2C_WRITE
(
_X_
Ë
	`°
 ( \

149 
I2CDATA
 = (
_X_
); \

150 
I2CCFG
 &~
I2C_SI
; \

151 (
I2CCFG
 & 
I2C_SI
) == 0); \

152 )

	)

155 
	#SLV_READ
(
_X_
Ë
	`°
 ( \

156 
I2CCFG
 &~
I2C_SI
; \

157 ((
I2CCFG
 & 
I2C_SI
) == 0) \

158 && (
I2CSTAT
 !
¶vSt›≥d
)); \

159 (
_X_
Ë
I2CDATA
; \

160 )

	)

163 
	#SLV_WRITE
(
_X_
Ë
	`°
 ( \

164 
I2CDATA
 = (
_X_
); \

165 
I2CCFG
 &~
I2C_SI
; \

166 ((
I2CCFG
 & 
I2C_SI
) == 0) \

167 && (
I2CSTAT
 !
¶vSt›≥d
)); \

168 )

	)

170 #i‡
HAL_I2C_POLLED


171 
	#I2C_INT_ENABLE
()

	)

173 
	#I2C_INT_ENABLE
(Ë
	`°
–
IEN2
 |
I2C_IE
; )

	)

175 
	#I2C_INT_DISABLE
(Ë
	`°
–
IEN2
 &~
I2C_IE
; )

	)

176 
	#I2C_INT_ENABLED
(Ë–
IEN2
 & 
I2C_IE
 )

	)

183 
uöt8
 
	gi2cAddrSave
, 
	gi2cCfgSave
;

185 #i‡
HAL_I2C_SLAVE


186 
i2cCÆlback_t
 
	gi2cCB
;

187 vﬁ©ûê
i2cLí_t
 
	gi2cRxIdx
, 
	gi2cTxIdx
;

188 
uöt8
 
	gi2cRxBuf
[
HAL_I2C_BUF_MAX
+1], 
	gi2cTxBuf
[HAL_I2C_BUF_MAX+1];

191 vﬁ©ûê
i2cLí_t
 
	gi2cRxLí
, 
	gi2cTxLí
;

193 #i‡
HAL_I2C_MASTER


210 
uöt8
 
	$i2cM°Såt
(
uöt8
 
addªss
, uöt8 
RD_WRn
)

212 
	`I2C_STRT
();

214 i‡(
I2CSTAT
 =
m°Sèπed
)

216 
addªss
 <<= 1;

217 
	`I2C_WRITE
(
addªss
 | 
RD_WRn
);

220  
I2CSTAT
;

221 
	}
}

238 
	$HÆI2CInô
(
i2cClock_t
 
˛ockR©e
)

240 
	`I2C_WRAPPER_DISABLE
();

241 
I2CADDR
 = 0;

242 
	`I2C_CLOCK_RATE
(
˛ockR©e
);

243 
	`I2C_ENABLE
();

244 
	}
}

263 
i2cLí_t
 
	$HÆI2CRód
(
uöt8
 
addªss
, 
i2cLí_t
 
Àn
, uöt8 *
pBuf
)

265 
uöt8
 
˙t
 = 0;

267 i‡(
	`i2cM°Såt
(
addªss
, 
I2C_MST_RD_BIT
Ë!
m°AddrAckR
)

269 
Àn
 = 0;

275 i‡(
Àn
 > 1)

277 
	`I2C_SET_ACK
();

280 
Àn
 > 0)

283 i‡(
Àn
 == 1)

285 
	`I2C_SET_NACK
();

289 
	`I2C_READ
(*
pBuf
++);

290 
˙t
++;

291 
Àn
--;

293 i‡(
I2CSTAT
 !
m°D©aAckR
)

295 i‡(
I2CSTAT
 !
m°D©aNackR
)

298 
˙t
--;

304 
	`I2C_STOP
();

305  
˙t
;

306 
	}
}

325 
i2cLí_t
 
	$HÆI2CWrôe
(
uöt8
 
addªss
, 
i2cLí_t
 
Àn
, uöt8 *
pBuf
)

327 i‡(
	`i2cM°Såt
(
addªss
, 0Ë!
m°AddrAckW
)

329 
Àn
 = 0;

332 
i2cLí_t
 
˙t
 = 0; c¡ < 
Àn
; cnt++)

334 
	`I2C_WRITE
(*
pBuf
++);

336 i‡(
I2CSTAT
 !
m°D©aAckW
)

338 i‡(
I2CSTAT
 =
m°D©aNackW
)

340 
Àn
 = 
˙t
 + 1;

344 
Àn
 = 
˙t
;

350 
	`I2C_STOP
();

351  
Àn
;

352 
	}
}

371 
i2cLí_t
 
	$i2cSlvRx
()

373 
uöt8
 
ch
, 
idx
 = 0;

376 
	`SLV_READ
(
ch
);

378 i‡((
I2CSTAT
 =
¶vD©aAckR
Ë|| (I2CSTAT =
¶vD©aNackR
))

380 
i2cRxBuf
[
idx
++] = 
ch
;

383 i‡(
idx
 =
HAL_I2C_BUF_MAX
)

385 
	`I2C_SET_NACK
();

387 } 
I2CSTAT
 =
¶vD©aAckR
);

389 
i2cRxLí
 = 
idx
;

390 
i2cRxIdx
 = 0;

391 
	`I2C_CLR_NACK
();

393  
idx
;

394 
	}
}

411 
i2cLí_t
 
	$i2cSlvTx
()

413 
uöt8
 
idx
 = 
i2cTxIdx
, 
Àn
 = 
i2cTxLí
;

417 i‡(
Àn
 == 1)

419 
	`I2C_SET_NACK
();

421 
	`SLV_WRITE
(
i2cTxBuf
[
idx
]);

423 i‡((
I2CSTAT
 =
¶vD©aAckW
Ë|| (I2CSTAT =
¶vLa°AckW
Ë|| (I2CSTAT =
¶vD©aNackW
))

425 
idx
++;

427 i‡((--
Àn
 =0Ë|| (
I2CSTAT
 =
¶vD©aNackW
))

438 
i2cTxIdx
 = 
idx
;

439 
i2cTxLí
 = 
Àn
;

440 
	`I2C_CLR_NACK
();

442  
Àn
;

443 
	}
}

461 
	$HÆI2CInô
(
uöt8
 
addªss
, 
i2cCÆlback_t
 
i2cCÆlback
)

463 
i2cCB
 = 
i2cCÆlback
;

464 
	`HAL_ASSERT
(
i2cCB
);

466 
	`I2C_WRAPPER_DISABLE
();

467 
I2CADDR
 = 
addªss
 << 1;

468 
	`I2C_ENABLE
();

470 
I2C_PXIFG
 = 0;

471 
I2C_IF
 = 0;

472 
	`I2C_INT_ENABLE
();

473 
	}
}

491 
i2cLí_t
 
	$HÆI2CRód
(
i2cLí_t
 
Àn
, 
uöt8
 *
pBuf
)

493 
uöt8
 
rxLí
 = 
i2cRxLí
;

495 i‡(
Àn
 >
rxLí
)

497 
Àn
 = 
rxLí
;

498 
rxLí
 = 0;

502 
rxLí
 -
Àn
;

505 ()
	`oßl_mem˝y
(
pBuf
, 
i2cRxBuf
+
i2cRxIdx
, 
Àn
);

506 
i2cRxIdx
 +
Àn
;

507 
i2cRxLí
 = 
rxLí
;

509  
Àn
;

510 
	}
}

528 
i2cLí_t
 
	$HÆI2CWrôe
(
i2cLí_t
 
Àn
, 
uöt8
 *
pBuf
)

530 #i‡((
HAL_I2C_BUF_MAX
 != 255) && (HAL_I2C_BUF_MAX != 65535))

531 i‡(
Àn
 > 
HAL_I2C_BUF_MAX
)

533 
Àn
 = 
HAL_I2C_BUF_MAX
;

537 i‡(
i2cTxLí
 != 0)

542 ()
	`oßl_mem˝y
(
i2cTxBuf
, 
pBuf
, 
Àn
);

543 
i2cTxIdx
 = 0;

544 
i2cTxLí
 = 
Àn
;

546 #i‡
HAL_I2C_POLLED


547 i‡(
I2CSTAT
 =
¶vAddrAckW
)

549 
	`i2cSlvTx
();

558 i‡(!
	`I2C_INT_ENABLED
())

560 
	`I2C_INT_ENABLE
();

564  
Àn
;

565 
	}
}

582 #i‡
HAL_I2C_POLLED


583 
	$HÆI2CPﬁl
()

585 
	$HAL_ISR_FUNCTION
(
hÆI2CI§
, 
I2C_VECTOR
)

588 
	`HAL_ENTER_ISR
();

590 
I2CSTAT
)

592 
¶vAddrAckR
:

593 i‡(
i2cRxLí
 == 0)

595 
	`i2cSlvRx
();

599 vﬁ©ûê
uöt8
 
ch
;

601 
	`I2C_SET_NACK
();

602 
	`SLV_READ
(
ch
);

603 
	`I2C_CLR_NACK
();

606 ()
	`i2cCB
(
i2cRxLí
);

609 
¶vAddrAckW
:

610 i‡(
i2cTxLí
 != 0)

612 
	`i2cSlvTx
();

614 i‡(
	`i2cCB
(0Ë=
FALSE
)

616 
	`I2C_SET_NACK
();

617 
	`SLV_WRITE
(0);

618 
	`I2C_CLR_NACK
();

627 
	`I2C_INT_DISABLE
();

631 
i2cIdÀ
:

635 
	`I2C_STOP
();

636 
	`I2C_CLR_NACK
();

641 
I2C_PXIFG
 = 0;

642 
I2C_IF
 = 0;

644 
	`HAL_EXIT_ISR
();

645 
	}
}

663 
uöt8
 
	$HÆI2CRódy2SÀï
()

665  ((
i2cRxLí
 =0Ë&& (
i2cTxLí
 =0Ë&& (
I2CSTAT
 =
i2cIdÀ
));

666 
	}
}

683 
	$HÆI2CE¡îSÀï
()

685 
i2cCfgSave
 = 
I2CCFG
;

686 
i2cAddrSave
 = 
I2CADDR
;

687 
	}
}

704 
	$HÆI2CExôSÀï
()

706 
I2CCFG
 = 
i2cCfgSave
;

707 
I2CADDR
 = 
i2cAddrSave
;

708 
	}
}

	@Components/hal/target/CC2541ARC/hal_i2c.h

43 #i‚de‡
HAL_I2C_H


44 
	#HAL_I2C_H


	)

51 
	~"hÆ_ty≥s.h
"

52 #i‡(
deföed
 
HAL_I2C
Ë&& (HAL_I2C =
TRUE
)

59 #i‡!
deföed
 
HAL_I2C_MASTER


60 
	#HAL_I2C_MASTER
 
FALSE


	)

63 #i‡!
deföed
 
HAL_I2C_SLAVE


64 #i‡
HAL_I2C_MASTER


65 
	#HAL_I2C_SLAVE
 
FALSE


	)

67 
	#HAL_I2C_SLAVE
 
TRUE


	)

71 #i‡
HAL_I2C_MASTER


72 
	#HAL_I2C_POLLED
 
FALSE


73 #ñ£ // i‡HAL_I2C_SLAVE

	)

74 #i‡!
deföed
 
HAL_I2C_POLLED


75 
	#HAL_I2C_POLLED
 
FALSE


78 

	)

79 #i‡!
deföed
 
HAL_I2C_BUF_MAX


80 
	#HAL_I2C_BUF_MAX
 255

	)

83 
	#HAL_I2C_SLAVE_ADDR_DEF
 0x41

	)

90 #i‡(
HAL_I2C_BUF_MAX
 < 256)

91 
uöt8
 
	ti2cLí_t
;

93 
uöt16
 
	ti2cLí_t
;

96 #i‡
HAL_I2C_MASTER


98 
	mi2cClock_123KHZ
 = 0x00,

99 
	mi2cClock_144KHZ
 = 0x01,

100 
	mi2cClock_165KHZ
 = 0x02,

101 
	mi2cClock_197KHZ
 = 0x03,

102 
	mi2cClock_33KHZ
 = 0x80,

103 
	mi2cClock_267KHZ
 = 0x81,

104 
	mi2cClock_533KHZ
 = 0x82

105 } 
	ti2cClock_t
;

126 
	$uöt8
 (*
	ti2cCÆlback_t
)(
	tuöt8
 
	t˙t
);

134 #i‡
HAL_I2C_MASTER


135 
	`HÆI2CInô
(
i2cClock_t
 
˛ockR©e
);

136 
i2cLí_t
 
	`HÆI2CRód
(
uöt8
 
addªss
, i2cLí_à
Àn
, uöt8 *
pBuf
);

137 
i2cLí_t
 
	`HÆI2CWrôe
(
uöt8
 
addªss
, i2cLí_à
Àn
, uöt8 *
pBuf
);

139 
	`HÆI2CInô
(
uöt8
 
addªss
, 
i2cCÆlback_t
 
i2cCÆlback
);

140 
i2cLí_t
 
	`HÆI2CRód
(i2cLí_à
Àn
, 
uöt8
 *
pBuf
);

141 
i2cLí_t
 
	`HÆI2CWrôe
(i2cLí_à
Àn
, 
uöt8
 *
pBuf
);

142 #i‡
HAL_I2C_POLLED


143 
	`HÆI2CPﬁl
();

146 
uöt8
 
	`HÆI2CRódy2SÀï
();

147 
	`HÆI2CE¡îSÀï
();

148 
	`HÆI2CExôSÀï
();

	@Components/hal/target/CC2541ARC/hal_key.c

83 
	~"hÆ_mcu.h
"

84 
	~"hÆ_defs.h
"

85 
	~"hÆ_ty≥s.h
"

86 
	~"hÆ_drivîs.h
"

87 
	~"hÆ_adc.h
"

88 
	~"hÆ_key.h
"

89 
	~"oßl.h
"

90 
	~"oßl_˛ock.h
"

91 
	~"hÆ_¶ìp.h
"

101 
	#HAL_KEY_BIT0
 0x01

	)

102 
	#HAL_KEY_BIT1
 0x02

	)

103 
	#HAL_KEY_BIT2
 0x04

	)

104 
	#HAL_KEY_BIT3
 0x08

	)

105 
	#HAL_KEY_BIT4
 0x10

	)

106 
	#HAL_KEY_BIT5
 0x20

	)

107 
	#HAL_KEY_BIT6
 0x40

	)

108 
	#HAL_KEY_BIT7
 0x80

	)

110 
	#HAL_KEY_RISING_EDGE
 0

	)

111 
	#HAL_KEY_FALLING_EDGE
 1

	)

113 
	#HAL_KEY_PDUP2
 0x80

	)

114 
	#HAL_KEY_PDUP1
 0x40

	)

115 
	#HAL_KEY_PDUP0
 0x20

	)

117 
	#HAL_KEY_DEBOUNCE_VALUE
 25

118 
	#HAL_KEY_POLLING_VALUE
 100

	)

120 
	#HAL_KEY_CODE_NOKEY
 0xFF

	)

123 
	#HAL_KEY_NUM_ROWS
 3

	)

124 
	#HAL_KEY_NUM_COLUMNS
 16

	)

127 
	#HAL_KEY_P0_GPIO_PINS
 ( 
HAL_KEY_BIT0
 | 
HAL_KEY_BIT1
 | 
HAL_KEY_BIT2
 | 
HAL_KEY_BIT3
 | 
HAL_KEY_BIT4
)

	)

128 
	#HAL_KEY_P1_GPIO_PINS
 ( 
HAL_KEY_BIT4
 )

	)

131 
	#HAL_KEY_P0_INPUT_PINS
 ( 
HAL_KEY_BIT0
 | 
HAL_KEY_BIT1
 | 
HAL_KEY_BIT2
 )

	)

132 
	#HAL_KEY_P0_OUTPUT_PINS
 ( 
HAL_KEY_BIT3
 | 
HAL_KEY_BIT4
 )

	)

133 
	#HAL_KEY_P1_INPUT_PINS
 0x00

	)

134 
	#HAL_KEY_P1_OUTPUT_PINS
 ( 
HAL_KEY_BIT4
 )

	)

137 
	#HAL_KEY_P0_INTERRUPT_PINS
 ( 
HAL_KEY_BIT0
 | 
HAL_KEY_BIT1
 | 
HAL_KEY_BIT2
 )

	)

140 
	#HAL_KEY_SHIFT_REGISTER_CLOCK_PIN
 
P0_3


	)

141 
	#HAL_KEY_SHIFT_REGISTER_POWER_PIN
 
P0_4


	)

142 
	#HAL_KEY_SHIFT_REGISTER_DATA_PIN
 
P1_4


	)

143 
	#HAL_KEY_SHIFT_REGISTER_POWER_OFF
 0

	)

144 
	#HAL_KEY_SHIFT_REGISTER_POWER_ON
 1

	)

154 
uöt8
 
	ghÆKeySavedKeys
;

155 
hÆKeyCBack_t
 
	gpHÆKeyPro˚ssFun˘i⁄
;

156 
boﬁ
 
	gHÆ_KeyI¡E«bÀ
;

157 
uöt8
 
	ghÆSaveI¡Key
;

159 
uöt8
 
	gHÆKeyC⁄figuªd
;

160 
uöt8
 
	ghÆKeyTimîRu¬ög
;

166 
hÆPro˚ssKeyI¡îru±
 ();

167 
hÆClockShi·Regi°î
 ();

168 
hÆPowîDownShi·Regi°î
 ();

169 
hÆSëShi·Regi°îD©a
–
uöt8
 
d©a
 );

170 
hÆPowîUpShi·Regi°î
( );

184 
	$HÆKeyInô
( )

186 #i‡(
HAL_KEY
 =
TRUE
)

188 
hÆKeySavedKeys
 = 
HAL_KEY_CODE_NOKEY
;

201 
P0SEL
 &(
uöt8
Ë~
HAL_KEY_P0_GPIO_PINS
;

202 
P1SEL
 &(
uöt8
Ë~
HAL_KEY_P1_GPIO_PINS
;

205 
P0DIR
 |(
uöt8
Ë
HAL_KEY_P0_OUTPUT_PINS
;

206 
P0DIR
 &(
uöt8
Ë~
HAL_KEY_P0_INPUT_PINS
;

208 
P1DIR
 |(
uöt8
Ë
HAL_KEY_P1_OUTPUT_PINS
;

209 
P1DIR
 &(
uöt8
Ë~
HAL_KEY_P1_INPUT_PINS
;

211 
P0INP
 = 0x00;

214 
P1_0
 = 
P1_1
 = 
P1_4
 = 0x00;

217 
	`hÆPowîDownShi·Regi°î
();

220 
pHÆKeyPro˚ssFun˘i⁄
 = 
NULL
;

223 
HÆKeyC⁄figuªd
 = 
FALSE
;

225 
hÆKeyTimîRu¬ög
 = 
FALSE
;

227 
	}
}

239 
	$HÆKeyC⁄fig
 (
boﬁ
 
öãºu±E«bÀ
, 
hÆKeyCBack_t
 
cback
)

241 #i‡(
HAL_KEY
 =
TRUE
)

243 
HÆ_KeyI¡E«bÀ
 = 
öãºu±E«bÀ
;

246 
pHÆKeyPro˚ssFun˘i⁄
 = 
cback
;

249 i‡(
HÆ_KeyI¡E«bÀ
)

252 
PICTL
 |
HAL_KEY_BIT0
;

255 
P0IEN
 |
HAL_KEY_P0_INTERRUPT_PINS
;

258 
IEN1
 |
HAL_KEY_BIT5
;

261 i‡(
HÆKeyC⁄figuªd
 =
TRUE
)

263 
	`oßl_°›_timîEx
–
HÆ_TaskID
, 
HAL_KEY_EVENT
);

269 
P0IEN
 &~(
HAL_KEY_P0_INTERRUPT_PINS
);

270 
IEN1
 &~(
HAL_KEY_BIT5
);

272 
	`oßl_°¨t_timîEx
 (
HÆ_TaskID
, 
HAL_KEY_EVENT
, 
HAL_KEY_POLLING_VALUE
);

276 
HÆKeyC⁄figuªd
 = 
TRUE
;

278 
	}
}

289 
uöt8
 
	$HÆKeyRód
 ( )

291 
uöt8
 
cﬁkeys
 = 0, 
rowkeys
 = 0;

292 
uöt8
 
keys
, 
cﬁcode
 = 
HAL_KEY_NUM_COLUMNS
, 
rowcode
 = 
HAL_KEY_NUM_ROWS
;

294 #i‡(
HAL_KEY
 =
TRUE
)

298 
P0IEN
 &~(
HAL_KEY_P0_INTERRUPT_PINS
);

301 
keys
 = (
P0
 & 
HAL_KEY_P0_INPUT_PINS
);

302 
uöt8
 
row
 = 0;Ñow < 
HAL_KEY_NUM_ROWS
;Ñow++)

304 i‡(((1 << 
row
Ë& 
keys
) == 0)

306 i‡(++
rowkeys
 == 1)

309 
rowcode
 = 
row
;

325 
P2INP
 |
HAL_KEY_BIT5
;

326 
	`hÆPowîUpShi·Regi°î
();

329 
	`hÆSÀïWaô
( 50 );

332 
	`hÆSëShi·Regi°îD©a
( 0 );

333 
	`hÆClockShi·Regi°î
();

336 
	`hÆSëShi·Regi°îD©a
( 1 );

337 
	`hÆClockShi·Regi°î
();

338 
	`hÆSëShi·Regi°îD©a
( 0 );

340 
uöt8
 
cﬁ
 = 0; cﬁ < 
HAL_KEY_NUM_COLUMNS
; col++)

343 
keys
 = (
P0
 & 
HAL_KEY_P0_INPUT_PINS
);

346 
	`hÆClockShi·Regi°î
();

349 i‡(
keys
 & ((
uöt8
)1 << 
rowcode
))

351 i‡(++
cﬁkeys
 == 1)

354 
cﬁcode
 = 
cﬁ
;

365 
	`hÆPowîDownShi·Regi°î
();

368 
P2INP
 &~
HAL_KEY_BIT5
;

370 i‡(
HÆ_KeyI¡E«bÀ
)

374 
P0IFG
 = (
uöt8
Ë(~
HAL_KEY_P0_INTERRUPT_PINS
);

375 
P0IF
 = 0;

378 
P0IEN
 |
HAL_KEY_P0_INTERRUPT_PINS
;

384 i‡((
cﬁcode
 =
HAL_KEY_NUM_COLUMNS
) ||

385 (
rowcode
 =
HAL_KEY_NUM_ROWS
) ||

386 (
rowkeys
 > 1) ||

387 (
cﬁkeys
 > 1))

389 
keys
 = 
HAL_KEY_CODE_NOKEY
;

393 
keys
 = (
rowcode
 << 4Ë| 
cﬁcode
;

396  
keys
;

397 
	}
}

409 
	$HÆKeyPﬁl
 ()

411 #i‡(
HAL_KEY
 =
TRUE
)

413 
uöt8
 
keys
 = 0;

419 
keys
 = 
	`HÆKeyRód
();

422 i‡(!
HÆ_KeyI¡E«bÀ
)

424 i‡(
keys
 =
hÆKeySavedKeys
)

428 
hÆKeySavedKeys
 = 
keys
;

432 i‡((
keys
 !
HAL_KEY_CODE_NOKEY
 || 
HÆ_KeyI¡E«bÀ
) &&

433 (
pHÆKeyPro˚ssFun˘i⁄
))

437 (
pHÆKeyPro˚ssFun˘i⁄
Ë(
keys
, 
HAL_KEY_STATE_NORMAL
);

440 i‡(
HÆ_KeyI¡E«bÀ
)

442 i‡(
keys
 !
HAL_KEY_CODE_NOKEY
)

446 
	`oßl_°¨t_timîEx
(
HÆ_TaskID
, 
HAL_KEY_EVENT
, 50);

450 
hÆKeyTimîRu¬ög
 = 
FALSE
;

455 
	}
}

467 
	$hÆPro˚ssKeyI¡îru±
 ()

470 #i‡(
HAL_KEY
 =
TRUE
)

472 i‡(
P0IFG
 & 
HAL_KEY_P0_INTERRUPT_PINS
)

475 
P0IEN
 &(
uöt8
Ë~
HAL_KEY_P0_INTERRUPT_PINS
;

478 
P0IFG
 = (
uöt8
Ë(~
HAL_KEY_P0_INTERRUPT_PINS
);

479 i‡(!
hÆKeyTimîRu¬ög
)

481 
hÆKeyTimîRu¬ög
 = 
TRUE
;

482 
	`oßlTimeUpd©e
();

483 
	`oßl_°¨t_timîEx
 (
HÆ_TaskID
, 
HAL_KEY_EVENT
, 
HAL_KEY_DEBOUNCE_VALUE
);

486 
P0IEN
 |
HAL_KEY_P0_INTERRUPT_PINS
;

489 
	}
}

500 
	$HÆKeyE¡îSÀï
 ( )

505 
	}
}

516 
uöt8
 
	$HÆKeyExôSÀï
 ( )

524  
TRUE
;

525 
	}
}

540 
	$HAL_ISR_FUNCTION
–
hÆKeyP‹t0I§
, 
P0INT_VECTOR
 )

542 
	`HAL_ENTER_ISR
();

544 
	`hÆPro˚ssKeyI¡îru±
();

546 #i‡
HAL_KEY


547 
P0IFG
 = (
uöt8
Ë(~
HAL_KEY_P0_INTERRUPT_PINS
);

548 
P0IF
 = 0;

551 
	`HAL_EXIT_ISR
();

552 
	}
}

563 
	$hÆClockShi·Regi°î
( )

565 
HAL_KEY_SHIFT_REGISTER_CLOCK_PIN
 = 1;

566 
HAL_KEY_SHIFT_REGISTER_CLOCK_PIN
 = 0;

567 
	}
}

578 
	$hÆPowîDownShi·Regi°î
( )

580 
HAL_KEY_SHIFT_REGISTER_CLOCK_PIN
 = 0;

581 
HAL_KEY_SHIFT_REGISTER_POWER_PIN
 = 
HAL_KEY_SHIFT_REGISTER_POWER_OFF
;

582 
HAL_KEY_SHIFT_REGISTER_DATA_PIN
 = 0;

583 
	}
}

594 
	$hÆPowîUpShi·Regi°î
( )

596 
HAL_KEY_SHIFT_REGISTER_POWER_PIN
 = 
HAL_KEY_SHIFT_REGISTER_POWER_ON
;

597 
	}
}

608 
	$hÆSëShi·Regi°îD©a
–
uöt8
 
d©a
 )

611 
HAL_KEY_SHIFT_REGISTER_DATA_PIN
 = (
d©a
 & 0x01);

612 
	}
}

	@Components/hal/target/CC2541ARC/hal_mcu.h

40 #i‚de‡
_HAL_MCU_H


41 
	#_HAL_MCU_H


	)

53 
	~"hÆ_defs.h
"

54 
	~"hÆ_ty≥s.h
"

61 
	#HAL_MCU_CC2540


	)

70 #ifde‡
__IAR_SYSTEMS_ICC__


72 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

73 
	~<ioCC2541.h
>

75 
	~<ioCC2540.h
>

78 
	#HAL_COMPILER_IAR


	)

79 
	#HAL_MCU_LITTLE_ENDIAN
(Ë
__LITTLE_ENDIAN__


	)

80 
	#_PRAGMA
(
x
Ë
	`_Pøgma
(#x)

	)

81 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

82 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

83 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

86 #ñi‡
deföed
 
__KEIL__


88 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

89 
	~<CC2541.h
>

91 
	~<CC2540.h
>

94 
	#HAL_COMPILER_KEIL


	)

95 
	#HAL_MCU_LITTLE_ENDIAN
(Ë0

	)

96 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`f
(Ë
öãºu±
 
	)
v

97 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`f
()

	)

98 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

110 
	#HAL_ENABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 1; )

	)

111 
	#HAL_DISABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 0; )

	)

112 
	#HAL_INTERRUPTS_ARE_ENABLED
(Ë(
EA
)

	)

114 
	thÆI¡Sèã_t
;

115 
	#HAL_ENTER_CRITICAL_SECTION
(
x
Ë
	`°
–x = 
EA
; 
	`HAL_DISABLE_INTERRUPTS
(); )

	)

116 
	#HAL_EXIT_CRITICAL_SECTION
(
x
Ë
	`°
–
EA
 = x; )

	)

117 
	#HAL_CRITICAL_STATEMENT
(
x
Ë
	`°
–
hÆI¡Sèã_t
 
_s
; 
	`HAL_ENTER_CRITICAL_SECTION
(_s); x; 
	`HAL_EXIT_CRITICAL_SECTION
(_s); )

	)

119 #ifde‡
__IAR_SYSTEMS_ICC__


125 
	#HAL_ENTER_ISR
(Ë{ 
hÆI¡Sèã_t
 
_i§I¡Sèã
 = 
EA
; 
	`HAL_ENABLE_INTERRUPTS
();

	)

126 
	#HAL_EXIT_ISR
(Ë
EA
 = 
_i§I¡Sèã
; }

	)

128 
	#HAL_ENTER_ISR
()

	)

129 
	#HAL_EXIT_ISR
()

	)

136 
	#WD_EN
 
	`BV
(3)

	)

137 
	#WD_MODE
 
	`BV
(2)

	)

138 
	#WD_INT_1900_USEC
 (
	`BV
(0Ë| BV(1))

	)

139 
	#WD_RESET1
 (0xA0 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

140 
	#WD_RESET2
 (0x50 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

141 
	#WD_KICK
(Ë
	`°
–
WDCTL
 = (0xA0 | WDCTL & 0x0F); WDCTL = (0x50 | WDCTL & 0x0F); )

	)

144 
	#HAL_SYSTEM_RESET
(Ë
	`°
–
	`HAL_DISABLE_INTERRUPTS
(); 
WDCTL
 = 
WD_RESET1
; WDCTL = 
WD_RESET2
; ;;); )

	)

150 
	#REV_A
 0x00

	)

151 
	#REV_B
 0x11

	)

152 
	#REV_C
 0x20

	)

153 
	#REV_D
 0x21

	)

161 
	#PCON_IDLE
 
	`BV
(0Ë

	)

164 
	#OSC_PD
 
	`BV
(2Ë

	)

165 
	#PMODE
 (
	`BV
(1Ë| BV(0)Ë

	)

168 
	#XOSC_STB
 
	`BV
(6Ë

	)

169 
	#HFRC_STB
 
	`BV
(5Ë

	)

172 
	#OSC_PD
 
	`BV
(2Ë

	)

176 
	#OSC
 
	`BV
(6)

	)

177 
	#TICKSPD
(
x
Ë(x << 3)

	)

178 
	#CLKSPD
(
x
Ë(x << 0)

	)

179 
	#CLKCONCMD_32MHZ
 (0)

	)

180 
	#CLKCONCMD_16MHZ
 (
	`CLKSPD
(1Ë| 
	`TICKSPD
(1Ë| 
OSC
)

	)

183 
	#LDRDY
 
	`BV
(0Ë

	)

187 #ifde‡
POWER_SAVING


188 vﬁ©ûê
__d©a
 
uöt8
 
hÆSÀïPc⁄VÆue
;

193 
	#CLEAR_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 0; )

	)

194 
	#ALLOW_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; )

	)

196 
	#CLEAR_SLEEP_MODE
()

	)

197 
	#ALLOW_SLEEP_MODE
()

	)

	@Components/hal/target/CC2541ARC/hal_motion.c

43 
	~"hÆ_mcu.h
"

44 
	~"hÆ_bﬂrd_cfg.h
"

45 
	~"hÆ_ac˚l.h
"

46 
	~"hÆ_defs.h
"

47 
	~"hÆ_gyro.h
"

48 
	~"hÆ_i2c.h
"

49 
	~"hÆ_ty≥s.h
"

50 
	~"hÆ_drivîs.h
"

51 
	~"hÆ_adc.h
"

52 
	~"hÆ_key.h
"

53 
	~"hÆ_mŸi⁄.h
"

54 
	~"oßl.h
"

55 
	~"oßl_¢v.h
"

58 
	~"AIR_MOTION_Lib.h
"

64 
	#HAL_MOTION_TIME_BETWEEN_MEASUREMENTS
 10

65 

	)

67 
	#HAL_MOTION_NUM_CAL_SAMPLES
 8

	)

70 
	#HAL_MOTION_ENABLE_ROLL_COMPENSATION
 
TRUE


	)

73 #i‡!
deföed
 
HAL_MOTION_NV_ID_BEG


74 
	#HAL_MOTION_NV_ID_BEG
 0xF0

76 

	)

77 
	#HAL_MOTION_NV_ITEM_GYRO_OFFSETS_ID
 ( 
HAL_MOTION_NV_ID_BEG
 + 0 )

	)

88 
	mHAL_MOTION_STATE_OFF
,

89 
	mHAL_MOTION_STATE_INIT
,

90 
	mHAL_MOTION_STATE_POWERING_ON
,

91 
	mHAL_MOTION_STATE_CALIBRATING
,

92 
	mHAL_MOTION_STATE_WAITING_FOR_NEXT_MEASUREMENT
,

93 
	mHAL_MOTION_STATE_MEASURING
,

94 
	mHAL_MOTION_STATE_STANDBY


96 
uöt8
 
	thÆMŸi⁄Sèã_t
;

100 
öt8
 
	mgaöX
;

101 
öt8
 
	mgaöY
;

102 } 
	thÆMŸi⁄GaöSëtögs_t
;

107 
hÆMŸi⁄CBack_t
 
	gpHÆMŸi⁄Pro˚ssFun˘i⁄
;

108 
hÆMŸi⁄CÆCBack_t
 
	gpHÆMŸi⁄CÆCom∂ëeNŸifiˇti⁄Fun˘i⁄
;

109 
hÆMŸi⁄Sèã_t
 
	gHÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_OFF
;

110 
boﬁ
 
	gHÆMŸi⁄CÆibøãGyro
;

112 c⁄° 
hÆMŸi⁄GaöSëtögs_t
 
	gHÆMŸi⁄Mou£GaöTabÀ
[] =

114 #i‡(
HAL_MOTION_ENABLE_ROLL_COMPENSATION
 =
TRUE
)

126 
uöt8
 
	gHÆMŸi⁄Mou£GaöTabÀIndex
;

128 
	#HAL_MOTION_MOUSE_GAIN_TABLE_SIZE
 ((
HÆMŸi⁄Mou£GaöTabÀ
Ë/ (HÆMŸi⁄Mou£GaöTabÀ[0]))

	)

129 
	#HAL_MOTION_DEFAULT_GAIN_TABLE_INDEX
 1;

	)

131 °ru˘ { 
öt16
 
	mx
,
	my
,
	mz
; } 
	gHÆMŸi⁄GyroOff£ts
;

133 c⁄° 
uöt8
 
	gHÆMŸi⁄Devi˚AddªssTabÀ
[] =

135 
HAL_GYRO_I2C_ADDRESS
,

136 
HAL_ACCEL_I2C_ADDRESS


139 
t_°ru˘_AIR_MOTION_Pro˚ssDñèSam∂es
 
	gßm∂es
;

140 
t_°ru˘_AIR_MOTION_Pro˚ssDñèSètus
 
	gmŸi⁄_°©us
;

143 
t_°ru˘_AIR_MOTION_Inô
 
	gmŸi⁄_öô
 = {

152 
AúMŸi⁄N‹mÆ
,

153 
HAL_MOTION_ENABLE_ROLL_COMPENSATION
,

158 
	gHÆNbSam∂esCÆC¡
 = 0;

163 
HÆMŸi⁄H™dÀMósuªmítSèπEvít
( );

164 
HÆMŸi⁄H™dÀCÆPowîupD⁄eEvít
( );

165 
HÆMŸi⁄H™dÀGyroA˘iveEvít
( );

166 
HÆMŸi⁄GyroRódy
( );

180 
	$HÆMŸi⁄Inô
( )

183 
pHÆMŸi⁄Pro˚ssFun˘i⁄
 = 
NULL
;

184 
pHÆMŸi⁄CÆCom∂ëeNŸifiˇti⁄Fun˘i⁄
 = 
NULL
;

187 
	`HÆI2CInô
–
i2cClock_267KHZ
 );

190 
	`HÆAc˚lInô
();

191 
	`HÆGyroInô
();

194 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_INIT
;

195 
	}
}

206 
	$HÆMŸi⁄C⁄fig
–
hÆMŸi⁄CBack_t
 
mósCback
 )

208 
uöt8
 
¢vSètus
;

211 
pHÆMŸi⁄Pro˚ssFun˘i⁄
 = 
mósCback
;

214 
HÆMŸi⁄Mou£GaöTabÀIndex
 = 
HAL_MOTION_DEFAULT_GAIN_TABLE_INDEX
;

215 
¢vSètus
 = 
	`oßl_¢v_ªad
–
HAL_MOTION_NV_ITEM_GYRO_OFFSETS_ID
,

216 –
HÆMŸi⁄GyroOff£ts
 ),

217 (
uöt8
 *)&
HÆMŸi⁄GyroOff£ts
 );

218 i‡(
¢vSètus
 !
SUCCESS
)

221 
HÆMŸi⁄GyroOff£ts
.
x
 = 0;

222 
HÆMŸi⁄GyroOff£ts
.
y
 = 0;

223 
HÆMŸi⁄GyroOff£ts
.
z
 = 0;

225 
	}
}

236 
	$HÆMŸi⁄E«bÀ
( )

239 
mŸi⁄_öô
.
DñèGaö
.
X
 = 
HÆMŸi⁄Mou£GaöTabÀ
[
HÆMŸi⁄Mou£GaöTabÀIndex
].
gaöX
;

240 
mŸi⁄_öô
.
DñèGaö
.
Y
 = 
HÆMŸi⁄Mou£GaöTabÀ
[
HÆMŸi⁄Mou£GaöTabÀIndex
].
gaöY
;

241 
mŸi⁄_öô
.
GyroOff£ts
.
X
 = 
HÆMŸi⁄GyroOff£ts
.
x
;

242 
mŸi⁄_öô
.
GyroOff£ts
.
Y
 = 
HÆMŸi⁄GyroOff£ts
.
y
;

243 
mŸi⁄_öô
.
GyroOff£ts
.
Z
 = 
HÆMŸi⁄GyroOff£ts
.
z
;

245 
	`AIR_MOTION_Inô
(&
mŸi⁄_öô
);

251 
	`HÆGyroE«bÀ
–
HÆMŸi⁄GyroRódy
 );

254 
HÆMŸi⁄CÆibøãGyro
 = 
FALSE
;

257 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_POWERING_ON
;

258 
	}
}

270 
uöt8
 
	$HÆMŸi⁄CÆ
–
hÆMŸi⁄CÆCBack_t
 
ˇlCback
,

271 
uöt16
 
ˇlDuøti⁄
 )

273 i‡(
HÆMŸi⁄Sèã
 =
HAL_MOTION_STATE_INIT
)

276 
pHÆMŸi⁄CÆCom∂ëeNŸifiˇti⁄Fun˘i⁄
 = 
ˇlCback
;

279 
	`oßl_°¨t_timîEx
–
HÆ_TaskID
,

280 
HAL_MOTION_GYRO_POWERUP_DONE_EVENT
,

281 
ˇlDuøti⁄
 );

284 
mŸi⁄_öô
.
GyroOff£ts
.
X
 = 0;

285 
mŸi⁄_öô
.
GyroOff£ts
.
Y
 = 0;

286 
mŸi⁄_öô
.
GyroOff£ts
.
Z
 = 0;

287 
	`AIR_MOTION_Inô
(&
mŸi⁄_öô
);

290 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_POWERING_ON
;

292  
TRUE
;

295  
FALSE
;

296 
	}
}

307 
	$HÆMŸi⁄DißbÀ
( )

310 
	`HÆGyroE«bÀI2CPassThru
();

311 
	`HÆAc˚lDißbÀ
();

312 
	`HÆGyroDißbÀ
();

315 
	`oßl_°›_timîEx
–
HÆ_TaskID
,

316 
HAL_MOTION_MEASUREMENT_START_EVENT
 );

319 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_INIT
;

320 
	}
}

333 
	$HÆMŸi⁄Sèndby
( )

336 
	`oßl_°›_timîEx
–
HÆ_TaskID
,

337 
HAL_MOTION_MEASUREMENT_START_EVENT
 );

340 
	`HÆGyroE«bÀI2CPassThru
();

341 
	`HÆAc˚lMŸi⁄Dëe˘
–
HÆMŸi⁄E«bÀ
 );

344 
	`HÆGyroDißbÀ
();

347 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_STANDBY
;

348 
	}
}

359 
	$HÆMŸi⁄ModifyAúMou£Resﬁuti⁄
–
hÆMŸi⁄Mou£Resﬁuti⁄_t
 
a˘i⁄
 )

361 i‡(
a˘i⁄
 =
HAL_MOTION_RESOLUTION_INCREASE
)

363 i‡(
HÆMŸi⁄Mou£GaöTabÀIndex
 < 
HAL_MOTION_MOUSE_GAIN_TABLE_SIZE
 - 1)

365 
HÆMŸi⁄Mou£GaöTabÀIndex
 += 1;

370 i‡(
HÆMŸi⁄Mou£GaöTabÀIndex
 > 0)

372 
HÆMŸi⁄Mou£GaöTabÀIndex
 -= 1;

377 
mŸi⁄_öô
.
DñèGaö
.
X
 = 
HÆMŸi⁄Mou£GaöTabÀ
[
HÆMŸi⁄Mou£GaöTabÀIndex
].
gaöX
;

378 
mŸi⁄_öô
.
DñèGaö
.
Y
 = 
HÆMŸi⁄Mou£GaöTabÀ
[
HÆMŸi⁄Mou£GaöTabÀIndex
].
gaöY
;

379 
mŸi⁄_öô
.
GyroOff£ts
.
X
 = 
HÆMŸi⁄GyroOff£ts
.
x
;

380 
mŸi⁄_öô
.
GyroOff£ts
.
Y
 = 
HÆMŸi⁄GyroOff£ts
.
y
;

381 
mŸi⁄_öô
.
GyroOff£ts
.
Z
 = 
HÆMŸi⁄GyroOff£ts
.
z
;

383 
	`AIR_MOTION_Inô
(&
mŸi⁄_öô
);

384 
	}
}

396 
uöt16
 
	$HÆMŸi⁄H™dÀOSEvít
–
uöt16
 
evíts
 )

398 
uöt16
 
πnVÆ
 = 0;

400 i‡(
evíts
 & 
HAL_MOTION_MEASUREMENT_START_EVENT
)

402 
	`HÆMŸi⁄H™dÀMósuªmítSèπEvít
();

403 
πnVÆ
 = 
HAL_MOTION_MEASUREMENT_START_EVENT
;

405 i‡(
evíts
 & 
HAL_MOTION_GYRO_POWERUP_DONE_EVENT
)

407 
	`HÆMŸi⁄H™dÀCÆPowîupD⁄eEvít
();

408 
πnVÆ
 = 
HAL_MOTION_GYRO_POWERUP_DONE_EVENT
;

410 i‡(
evíts
 & 
HAL_GYRO_ACTIVE_EVENT
)

412 
	`HÆMŸi⁄H™dÀGyroA˘iveEvít
();

413 
πnVÆ
 = 
HAL_GYRO_ACTIVE_EVENT
;

415 i‡(
evíts
 & 
HAL_MOTION_DETECTED_EVENT
)

417 
	`hÆAc˚lPro˚ssMŸi⁄Dëe˘Evít
();

418 
πnVÆ
 = 
HAL_MOTION_DETECTED_EVENT
;

421  
πnVÆ
;

422 
	}
}

434 
	$HÆMŸi⁄GyroRódy
( )

436 i‡(
HÆMŸi⁄Sèã
 =
HAL_MOTION_STATE_POWERING_ON
)

438 i‡(
HÆMŸi⁄CÆibøãGyro
 =
FALSE
)

440 
	`HÆGyroE«bÀI2CPassThru
();

441 
	`HÆAc˚lE«bÀ
();

444 
	`HÆGyroSèπGyroMósuªmíts
();

447 
	`oßl_°¨t_timîEx
–
HÆ_TaskID
,

448 
HAL_GYRO_ACTIVE_EVENT
,

451 
	}
}

462 
	$HÆMŸi⁄H™dÀGyroA˘iveEvít
( )

464 i‡(
HÆMŸi⁄Sèã
 =
HAL_MOTION_STATE_POWERING_ON
)

467 
	`oßl_°¨t_ªlﬂd_timî
–
HÆ_TaskID
,

468 
HAL_MOTION_MEASUREMENT_START_EVENT
,

469 
HAL_MOTION_TIME_BETWEEN_MEASUREMENTS
 );

471 i‡(
HÆMŸi⁄CÆibøãGyro
 =
FALSE
)

474 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_WAITING_FOR_NEXT_MEASUREMENT
;

479 
mŸi⁄_öô
.
DñèGaö
.
X
 = 
HÆMŸi⁄Mou£GaöTabÀ
[
HÆMŸi⁄Mou£GaöTabÀIndex
].
gaöX
;

480 
mŸi⁄_öô
.
DñèGaö
.
Y
 = 
HÆMŸi⁄Mou£GaöTabÀ
[
HÆMŸi⁄Mou£GaöTabÀIndex
].
gaöY
;

481 
mŸi⁄_öô
.
GyroOff£ts
.
X
 = 
HÆMŸi⁄GyroOff£ts
.
x
;

482 
mŸi⁄_öô
.
GyroOff£ts
.
Y
 = 
HÆMŸi⁄GyroOff£ts
.
y
;

483 
mŸi⁄_öô
.
GyroOff£ts
.
Z
 = 
HÆMŸi⁄GyroOff£ts
.
z
;

484 
	`AIR_MOTION_Inô
(&
mŸi⁄_öô
);

487 
	}
}

499 
	$HÆMŸi⁄H™dÀCÆPowîupD⁄eEvít
( )

502 
	`HÆGyroE«bÀ
–
HÆMŸi⁄GyroRódy
 );

505 
HÆMŸi⁄CÆibøãGyro
 = 
TRUE
;

508 
HÆNbSam∂esCÆC¡
 = 
mŸi⁄_öô
.
SèticSam∂es
 * 2;

509 
	}
}

521 
	$HÆMŸi⁄H™dÀMósuªmítSèπEvít
( )

523 i‡(
HÆMŸi⁄Sèã
 =
HAL_MOTION_STATE_WAITING_FOR_NEXT_MEASUREMENT
)

525 
öt16
 
x
, 
y
, 
z
;

526 #i‡(
HAL_MOTION_ENABLE_ROLL_COMPENSATION
 =
TRUE
)

527 
öt8
 
ax
, 
ay
, 
az
;

531 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_MEASURING
;

533 
	`HÆGyroRód
(&
x
, &
y
, &
z
 );

535 
ßm∂es
.
GyroSam∂es
.
X
 = 
x
;

536 
ßm∂es
.
GyroSam∂es
.
Y
 = -
y
;

537 
ßm∂es
.
GyroSam∂es
.
Z
 = 
z
;

540 #i‡(
HAL_MOTION_ENABLE_ROLL_COMPENSATION
 =
TRUE
)

541 
	`HÆGyroRódAc˚lD©a
–&
ax
, &
ay
, &
az
 );

542 
ßm∂es
.
AccSam∂es
.
X
 = 
ax
;

543 
ßm∂es
.
AccSam∂es
.
Y
 = 
ay
;

544 
ßm∂es
.
AccSam∂es
.
Z
 = -
az
;

548 
mŸi⁄_°©us
 = 
	`AIR_MOTION_Pro˚ssDñè
(
ßm∂es
);

551 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_WAITING_FOR_NEXT_MEASUREMENT
;

553 i‡(
mŸi⁄_°©us
.
Sètus
.
IsDñèCompuãd
)

557 i‡(
pHÆMŸi⁄Pro˚ssFun˘i⁄
 !
NULL
)

559 
	`pHÆMŸi⁄Pro˚ssFun˘i⁄
–
mŸi⁄_°©us
.
Dñè
.
X
,

560 
mŸi⁄_°©us
.
Dñè
.
Y
 );

564 i‡(
HÆMŸi⁄CÆibøãGyro
 =
TRUE
 && 
HÆMŸi⁄Sèã
 =
HAL_MOTION_STATE_POWERING_ON
)

567 
öt16
 
x
, 
y
, 
z
;

568 #i‡(
HAL_MOTION_ENABLE_ROLL_COMPENSATION
 =
TRUE
)

569 
öt8
 
ax
, 
ay
, 
az
;

572 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_MEASURING
;

574 
	`HÆGyroRód
–&
x
, &
y
, &
z
 );

576 
ßm∂es
.
GyroSam∂es
.
X
 = 
x
;

577 
ßm∂es
.
GyroSam∂es
.
Y
 = -
y
;

578 
ßm∂es
.
GyroSam∂es
.
Z
 = 
z
;

581 #i‡(
HAL_MOTION_ENABLE_ROLL_COMPENSATION
 =
TRUE
)

582 
	`HÆGyroRódAc˚lD©a
–&
ax
, &
ay
, &
az
 );

583 
ßm∂es
.
AccSam∂es
.
X
 = 
ax
;

584 
ßm∂es
.
AccSam∂es
.
Y
 = 
ay
;

585 
ßm∂es
.
AccSam∂es
.
Z
 = -
az
;

589 
mŸi⁄_°©us
 = 
	`AIR_MOTION_Pro˚ssDñè
(
ßm∂es
);

591 i‡(
mŸi⁄_°©us
.
Sètus
.
NewGyroOff£t
 =
åue
)

594 
HÆMŸi⁄GyroOff£ts
.
x
 = 
mŸi⁄_°©us
.
GyroOff£ts
.
X
;

595 
HÆMŸi⁄GyroOff£ts
.
y
 = 
mŸi⁄_°©us
.
GyroOff£ts
.
Y
;

596 
HÆMŸi⁄GyroOff£ts
.
z
 = 
mŸi⁄_°©us
.
GyroOff£ts
.
Z
;

599 (Ë
	`oßl_¢v_wrôe
–
HAL_MOTION_NV_ITEM_GYRO_OFFSETS_ID
,

600 –
HÆMŸi⁄GyroOff£ts
 ),

601 (
uöt8
 *)&
HÆMŸi⁄GyroOff£ts
 );

604 
	`HÆMŸi⁄DißbÀ
();

607 i‡(
pHÆMŸi⁄CÆCom∂ëeNŸifiˇti⁄Fun˘i⁄
 !
NULL
)

609 
	`pHÆMŸi⁄CÆCom∂ëeNŸifiˇti⁄Fun˘i⁄
();

612 i‡(
HÆNbSam∂esCÆC¡
 == 0)

615 i‡(
pHÆMŸi⁄CÆCom∂ëeNŸifiˇti⁄Fun˘i⁄
 !
NULL
)

618 
	`pHÆMŸi⁄CÆCom∂ëeNŸifiˇti⁄Fun˘i⁄
();

620 
	`HÆMŸi⁄DißbÀ
();

624 
HÆNbSam∂esCÆC¡
--;

626 
HÆMŸi⁄Sèã
 = 
HAL_MOTION_STATE_POWERING_ON
;

629 
	}
}

649 
	$HÆMŸi⁄I2cRód
–
hÆMŸi⁄Devi˚_t
 
devi˚
, 
uöt8
 
addr
, uöt8 
numByãs
, uöt8 *
pBuf
 )

651 
uöt8
 
loˇlAddr
 = 
addr
;

654 
	`HÆI2CWrôe
–
HÆMŸi⁄Devi˚AddªssTabÀ
[
devi˚
], 1, &
loˇlAddr
 );

657 
	`HÆI2CRód
–
HÆMŸi⁄Devi˚AddªssTabÀ
[
devi˚
], 
numByãs
, 
pBuf
 );

658 
	}
}

678 
	$HÆMŸi⁄I2cWrôe
–
hÆMŸi⁄Devi˚_t
 
devi˚
, 
uöt8
 
addr
, uöt8 *
pD©a
, uöt8 
numByãs
 )

680 
uöt8
 
HÆMŸi⁄I2CBuf
[20];

681 
uöt8
 
i
;

682 
uöt8
 *
pBuf
 = 
HÆMŸi⁄I2CBuf
;

685 *
pBuf
++ = 
addr
;

686 
i
 = 0; i < 
numByãs
; i++)

688 *
pBuf
++ = *
pD©a
++;

692 
	`HÆI2CWrôe
–
HÆMŸi⁄Devi˚AddªssTabÀ
[
devi˚
], 
numByãs
 + 1, 
HÆMŸi⁄I2CBuf
 );

693 
	}
}

	@Components/hal/target/CC2541ARC/hal_motion.h

41 #i‚de‡
HAL_MOTION_H


42 
	#HAL_MOTION_H


	)

44 #ifde‡
__˝lu•lus


53 
	~"comdef.h
"

65 (*
hÆMŸi⁄CBack_t
Ë(
	töt16
 
	tgyroMickeysX
, i¡16 
	tgyroMickeysY
);

66 (*
hÆMŸi⁄CÆCBack_t
) ();

70 
HAL_MOTION_RESOLUTION_DECREASE
,

71 
HAL_MOTION_RESOLUTION_INCREASE


73 
uöt8
 
	thÆMŸi⁄Mou£Resﬁuti⁄_t
;

77 
HAL_MOTION_DEVICE_GYRO
,

78 
HAL_MOTION_DEVICE_ACCELEROMETER


80 
uöt8
 
	thÆMŸi⁄Devi˚_t
;

102 
HÆMŸi⁄Inô
();

119 
HÆMŸi⁄C⁄fig
(
hÆMŸi⁄CBack_t
 
mósCback
);

136 
HÆMŸi⁄E«bÀ
();

148 
uöt8
 
HÆMŸi⁄CÆ
–
hÆMŸi⁄CÆCBack_t
 
ˇlCback
,

149 
uöt16
 
ˇlDuøti⁄
 );

166 
HÆMŸi⁄DißbÀ
();

179 
HÆMŸi⁄Sèndby
( );

190 
HÆMŸi⁄ModifyAúMou£Resﬁuti⁄
–
hÆMŸi⁄Mou£Resﬁuti⁄_t
 
a˘i⁄
 );

201 
uöt16
 
HÆMŸi⁄H™dÀOSEvít
–uöt16 
evíts
 );

215 
HÆMŸi⁄I2cRód
–
hÆMŸi⁄Devi˚_t
 
devi˚
, 
uöt8
 
addr
, uöt8 
numByãs
, uöt8 *
pBuf
 );

229 
HÆMŸi⁄I2cWrôe
–
hÆMŸi⁄Devi˚_t
 
devi˚
, 
uöt8
 
addr
, uöt8 *
pD©a
, uöt8 
numByãs
 );

231 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ARC/hal_sleep.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"hÆ_mcu.h
"

45 
	~"hÆ_bﬂrd.h
"

46 
	~"hÆ_¶ìp.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"OSAL.h
"

50 
	~"OSAL_Timîs.h
"

51 
	~"OSAL_Tasks.h
"

52 
	~"OSAL_PwrMgr.h
"

53 
	~"hÆ_drivîs.h
"

54 
	~"hÆ_as£π.h
"

55 
	~"Œ_¶ìp.h
"

56 
	~"Œ_timî2.h
"

57 
	~"Œ_m©h.h
"

63 #i‚de‡
HAL_SLEEP_DEBUG_POWER_MODE


65 
	#HAL_SLEEP_PREP_POWER_MODE
(
mode
) \

66 
	`°
–
SLEEPCMD
 &~
PMODE
; \

67 
SLEEPCMD
 |
mode
; \

68 !(
STLOAD
 & 
LDRDY
)); \

69 
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; \

70 )

	)

71 
	#HAL_SLEEP_SET_POWER_MODE
() \

72 
	`hÆSëSÀïMode
()

	)

77 
	#HAL_SLEEP_PREP_POWER_MODE
(
mode
Ë

	)

78 
	#HAL_SLEEP_SET_POWER_MODE
() \

79 
	`°
–
hÆSÀïI¡
 =
FALSE
); \

80 
hÆSÀïI¡
 = 
FALSE
; \

81 
	`HAL_DISABLE_INTERRUPTS
(); \

82 )

	)

86 
	#HAL_SLEEP_TIMER_ENABLE_INT
(Ë
	`°
(
IEN0
 |
STIE_BV
;)

87 
	#HAL_SLEEP_TIMER_DISABLE_INT
(Ë
	`°
(
IEN0
 &~
STIE_BV
;)

88 
	#HAL_SLEEP_TIMER_CLEAR_INT
(Ë
	`°
(
IRCON
 &= ~0x80;)

89 

	)

91 
	#HAL_SLEEP_IE_BACKUP_AND_DISABLE
–
õn0
, 
õn1
, 
õn2
 ) \

92 
	`°
–(
õn0
Ë
IEN0
; \

93 (
õn1
Ë
IEN1
; \

94 (
õn2
Ë
IEN2
; \

95 
IEN0
 &
STIE_BV
; \

96 
IEN1
 &
P0IE_BV
; \

97 
IEN2
 &(
P1IE_BV
|
P2IE_BV
); \

98 )

	)

101 
	#HAL_SLEEP_IE_RESTORE
–
õn0
, 
õn1
, 
õn2
 ) \

102 
	`°
–
IEN0
 = (
õn0
); \

103 
IEN1
 = (
õn1
); \

104 
IEN2
 = (
õn2
); \

105 )

	)

108 
	#HAL_SLEEP_MS_TO_625US
–
ms
 ) (((((
uöt32
Ë(ms)Ë* 8Ë+ 4Ë/ 5)

	)

112 
	#HAL_SLEEP_MS_TO_32KHZ
–
ms
 ) ((((
uöt32
Ë(ms)Ë* 4096Ë/ 125)

	)

115 
	#MAX_16BIT_TIMEOUT
 0xFFFF

	)

117 #i‡!
deföed
 
NOP


118 
	#NOP
(Ë
	`asm
("NOP")

	)

127 
	#CC2540_PM0
 0

128 
	#CC2540_PM1
 1

129 
	#CC2540_PM2
 2

130 
	#CC2540_PM3
 3

131 

	)

138 
	#HAL_SLEEP_OFF
 
CC2540_PM0


	)

139 
	#HAL_SLEEP_TIMER
 
CC2540_PM2


	)

140 
	#HAL_SLEEP_DEEP
 
CC2540_PM3


	)

145 
	#MAX_SLEEP_TIME
 16711680

146 

	)

150 #i‡!
deföed
 (
PM_MIN_SLEEP_TIME
)

151 
	#PM_MIN_SLEEP_TIME
 66

153 

	)

160 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

161 
	#HAL_SLEEP_ADJ_TICKS
 25

162 #ñ£ // CC2540

	)

163 
	#HAL_SLEEP_ADJ_TICKS
 35

165 

	)

167 
	#STIE_BV
 
	`BV
(5)

	)

168 
	#P0IE_BV
 
	`BV
(5)

	)

169 
	#P1IE_BV
 
	`BV
(4)

	)

170 
	#P2IE_BV
 
	`BV
(1)

	)

173 #i‡
HAL_MCU_LITTLE_ENDIAN
()

174 
	#UINT32_NDX0
 0

	)

175 
	#UINT32_NDX1
 1

	)

176 
	#UINT32_NDX2
 2

	)

177 
	#UINT32_NDX3
 3

	)

179 
	#UINT32_NDX0
 3

	)

180 
	#UINT32_NDX1
 2

	)

181 
	#UINT32_NDX2
 1

	)

182 
	#UINT32_NDX3
 0

	)

194 
uöt8
 
	ghÆPwrMgtMode
 = 
HAL_SLEEP_OFF
;

197 
uöt8
 
	gwakeF‹RF
;

199 #ifde‡
HAL_SLEEP_DEBUG_POWER_MODE


200 
boﬁ
 
	ghÆSÀïI¡
 = 
FALSE
;

208 vﬁ©ûê
__d©a
 
uöt8
 
	ghÆSÀïPc⁄VÆue
 = 
PCON_IDLE
;

217 #¥agm®
loˇti⁄
 = "SLEEP_CODE"

218 
hÆSëSÀïMode
();

220 
hÆSÀïSëTimî
–
uöt32
 
¶ìpTime
, uöt32 
timeout
 );

221 
uöt32
 
hÆSÀïRódTimî
( );

222 
uöt32
 
TimîEœp£d
( );

242 #¥agm®
›timize
=
n⁄e


243 
	$hÆSëSÀïMode
()

246 
PCON
 = 
hÆSÀïPc⁄VÆue
;

248 
	`HAL_DISABLE_INTERRUPTS
();

249 
	}
}

268 
	$hÆSÀï
–
uöt32
 
oßl_timeout
 )

270 
uöt32
 
timeout
;

271 
uöt32
 
ŒTimeout
;

272 
uöt32
 
¶ìpTimî
;

274 
	`hÆDrivîBegPM
();

276 #ifde‡
DEBUG_GPIO


278 
P1_0
 = 1;

281 i‡(
oßl_timeout
 > 
MAX_16BIT_TIMEOUT
)

283 
oßl_timeout
 = 
MAX_16BIT_TIMEOUT
;

287 
	`LL_TimeToNextRfEvít
–&
¶ìpTimî
, &
ŒTimeout
 );

293 i‡(
oßl_timeout
 == 0)

296 
timeout
 = 
ŒTimeout
;

301 
wakeF‹RF
 = (
timeout
 !0Ë? 
TRUE
 : 
FALSE
;

307 
timeout
 = 
	`HAL_SLEEP_MS_TO_32KHZ
–
oßl_timeout
 );

310 i‡((
ŒTimeout
 !0Ë&& (ŒTimeouà< 
timeout
))

313 
timeout
 = 
ŒTimeout
;

316 
wakeF‹RF
 = 
TRUE
;

321 
¶ìpTimî
 = 
	`hÆSÀïRódTimî
();

324 
wakeF‹RF
 = 
FALSE
;

329 
hÆPwrMgtMode
 = (
timeout
 =0Ë? 
HAL_SLEEP_DEEP
 : 
HAL_SLEEP_TIMER
;

331 #ifde‡
DEBUG_GPIO


333 
P1_0
 = 0;

337 i‡–(
timeout
 > 
PM_MIN_SLEEP_TIME
) || (timeout == 0) )

339 
hÆI¡Sèã_t
 
õn0
, 
õn1
, 
õn2
;

341 #ifde‡
DEBUG_GPIO


343 
P1_0
 = 1;

346 
	`HAL_ASSERT
–
	`HAL_INTERRUPTS_ARE_ENABLED
() );

347 
	`HAL_DISABLE_INTERRUPTS
();

350 i‡–
	`LL_PowîOffReq
(
hÆPwrMgtMode
Ë=
LL_SLEEP_REQUEST_ALLOWED
 )

352 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

354 
	`HÆKeyE¡îSÀï
();

357 #ifde‡
HAL_SLEEP_DEBUG_LED


358 
	`HAL_TURN_OFF_LED3
();

361 
	`HÆLedE¡îSÀï
();

365 i‡(
timeout
 != 0)

368 i‡(
timeout
 > 
MAX_SLEEP_TIME
 )

371 
	`hÆSÀïSëTimî
–
¶ìpTimî
, 
MAX_SLEEP_TIME
 );

376 
	`hÆSÀïSëTimî
–
¶ìpTimî
, 
timeout
 );

381 
	`HAL_SLEEP_PREP_POWER_MODE
(
hÆPwrMgtMode
);

384 
	`HAL_SLEEP_IE_BACKUP_AND_DISABLE
(
õn0
, 
õn1
, 
õn2
);

385 
	`HAL_ENABLE_INTERRUPTS
();

387 #ifde‡
DEBUG_GPIO


389 
P1_0
 = 0;

397 
	`HAL_SLEEP_SET_POWER_MODE
();

399 #ifde‡
DEBUG_GPIO


401 
P1_0
 = 1;

414 i‡–(
wakeF‹RF
 =
TRUE
Ë&& !(
IRCON
 & 0x80) )

416 
wakeF‹RF
 = 
FALSE
;

420 
	`HAL_SLEEP_IE_RESTORE
(
õn0
, 
õn1
, 
õn2
);

425 
	`LL_PowîOnReq
–(
hÆPwrMgtMode
 =
CC2540_PM3
), 
wakeF‹RF
 );

427 #ifde‡
HAL_SLEEP_DEBUG_LED


428 
	`HAL_TURN_ON_LED3
();

431 
	`HÆLedExôSÀï
();

434 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

436 ()
	`HÆKeyExôSÀï
();

440 
	`HAL_ENABLE_INTERRUPTS
();

443 
	`hÆDrivîEndPM
();

445 #ifde‡
DEBUG_GPIO


447 
P1_0
 = 0;

451 
	}
}

479 
	$hÆSÀïSëTimî
–
uöt32
 
¶ìpTimî
, uöt32 
timeout
 )

481 
	`HAL_SLEEP_TIMER_DISABLE_INT
();

484 
¶ìpTimî
 +
timeout
;

487 
¶ìpTimî
 -
HAL_SLEEP_ADJ_TICKS
;

490 
ST2
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX2
];

491 
ST1
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX1
];

492 
ST0
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX0
];

494 
	`HAL_SLEEP_TIMER_CLEAR_INT
();

495 
	`HAL_SLEEP_TIMER_ENABLE_INT
();

498 
	}
}

516 
uöt32
 
	$hÆSÀïRódTimî
( )

518 
uöt32
 
¶ìpTimî
;

522 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX0
] = 
ST0
;

523 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX1
] = 
ST1
;

524 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX2
] = 
ST2
;

525 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX3
] = 0;

527 –
¶ìpTimî
 );

528 
	}
}

546 
uöt32
 
	$TimîEœp£d
( )

549 
	}
}

567 
	$hÆRe°‹eSÀïLevñ
( )

570 #ifde‡
PM_TEST


571 
	`oßl_°¨t_timîEx
 (
HÆ_TaskID
, 
HAL_SLEEP_TIMER_EVENT
, 1000);

573 
	}
}

591 
	$HAL_ISR_FUNCTION
(
hÆSÀïTimîI§
, 
ST_VECTOR
)

593 
	`HAL_ENTER_ISR
();

595 
	`HAL_SLEEP_TIMER_CLEAR_INT
();

597 #ifde‡
HAL_SLEEP_DEBUG_POWER_MODE


598 
hÆSÀïI¡
 = 
TRUE
;

601 
	`CLEAR_SLEEP_MODE
();

603 
	`HAL_EXIT_ISR
();

606 
	}
}

627 #¥agm®
›timize
=
n⁄e


628 
	$hÆSÀïWaô
(
uöt16
 
duøti⁄
)

630 
duøti⁄
 >>= 1;

632 
duøti⁄
-- > 0)

634 
	`NOP
(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP();

635 
	`NOP
(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP(); NOP();

637 
	}
}

	@Components/hal/target/CC2541ARC/hal_types.h

44 #i‚de‡
_HAL_TYPES_H


45 
	#_HAL_TYPES_H


	)

56 sig√d 
	töt8
;

57 
	tuöt8
;

59 sig√d 
	töt16
;

60 
	tuöt16
;

62 sig√d 
	töt32
;

63 
	tuöt32
;

65 
	tboﬁ
;

67 
uöt8
 
	thÆD©aAlign_t
;

76 #ifde‡
__IAR_SYSTEMS_ICC__


77 
	#CODE
 
__code


	)

78 
	#XDATA
 
__xd©a


	)

79 
	#DATA
 
__d©a


	)

80 
	#NEAR_FUNC
 
__√¨_func


	)

81 
	#ASM_NOP
 
	`asm
("NOP")

	)

84 #ñi‡
deföed
 
__KEIL__


85 
	#CODE
 
code


	)

86 
	#XDATA
 
xd©a


	)

87 
	#ASM_NOP
 
	`__n›
()

	)

90 #ñi‡
deföed
 
__GNUC__


91 
	#ASM_NOP
 
__asm__
 
	`__vﬁ©ûe__
 ("n›")

	)

94 #ñi‡
_MSC_VER


95 
	#ASM_NOP
 
__asm
 
NOP


	)

98 #ñi‡
deföed
 
__TI_COMPILER_VERSION


99 
	#ASM_NOP
 
	`asm
(" NOP")

	)

111 #i‚de‡
TRUE


112 
	#TRUE
 1

	)

115 #i‚de‡
FALSE


116 
	#FALSE
 0

	)

119 #i‚de‡
NULL


120 
	#NULL
 0

	)

	@Components/hal/target/CC2541ARC/stdbool.h

2 #i‚de‡
__STDBOOL_H


3 
	#__STDBOOL_H


	)

7 
	#åue
 1

	)

8 
	#Ál£
 0

	)

10 
	#__boﬁ_åue_Ál£_¨e_deföed
 1

	)

12 
	#boﬁ
 

	)

	@Components/hal/target/CC2541ARC/stdint.h

2 #i‚de‡
__STDINT_H


3 
	#__STDINT_H


	)

7 sig√d 
	töt8_t
;

8 
	tuöt8_t
;

11 sig√d 
	töt16_t
;

12 
	tuöt16_t
;

15 sig√d 
	töt32_t
;

16 
	tuöt32_t
;

	@Components/hal/target/CC2541ST/hal_acc.c

45 
	~"hÆ_acc.h
"

46 
	~"hÆ_£ns‹.h
"

47 
	~"hÆ_i2c.h
"

48 
	~"hÆ_bﬂrd_cfg.h
"

55 
	#HAL_KXTI9_I2C_ADDRESS
 0x0F

	)

58 
	#ACC_REG_ADDR_XOUT_HPF_L
 0x00

59 
	#ACC_REG_ADDR_XOUT_HPF_H
 0x01

60 
	#ACC_REG_ADDR_YOUT_HPF_L
 0x02

61 
	#ACC_REG_ADDR_YOUT_HPF_H
 0x03

62 
	#ACC_REG_ADDR_ZOUT_HPF_L
 0x04

63 
	#ACC_REG_ADDR_ZOUT_HPF_H
 0x05

64 
	#ACC_REG_ADDR_XOUT_L
 0x06

65 
	#ACC_REG_ADDR_XOUT_H
 0x07

66 
	#ACC_REG_ADDR_YOUT_L
 0x08

67 
	#ACC_REG_ADDR_YOUT_H
 0x09

68 
	#ACC_REG_ADDR_ZOUT_L
 0x0A

69 
	#ACC_REG_ADDR_ZOUT_H
 0x0B

70 
	#ACC_REG_ADDR_DCST_RESP
 0x0C

71 
	#ACC_REG_ADDR_WHO_AM_I
 0x0F

72 
	#ACC_REG_ADDR_TILT_POS_CUR
 0x10

73 
	#ACC_REG_ADDR_TILT_POS_PRE
 0x11

74 

	)

75 
	#ACC_REG_ADDR_INT_SRC_REG1
 0x15

76 
	#ACC_REG_ADDR_INT_SRC_REG2
 0x16

77 
	#ACC_REG_ADDR_STATUS_REG
 0x18

78 
	#ACC_REG_ADDR_INT_REL
 0x1A

79 

	)

80 
	#ACC_REG_ADDR_CTRL_REG1
 0x1B

81 
	#ACC_REG_ADDR_CTRL_REG2
 0x1C

82 
	#ACC_REG_ADDR_CTRL_REG3
 0x1D

83 

	)

84 
	#ACC_REG_ADDR_INT_CTRL_REG1
 0x1E

85 
	#ACC_REG_ADDR_INT_CTRL_REG2
 0x1F

86 
	#ACC_REG_ADDR_INT_CTRL_REG3
 0x20

87 
	#ACC_REG_ADDR_DATA_CTRL_REG
 0x21

88 

	)

89 
	#ACC_REG_ADDR_TILT_TIMER
 0x28

90 
	#ACC_REG_ADDR_WUF_TIMER
 0x29

91 
	#ACC_REG_ADDR_TDT_TIMER
 0x2B

92 
	#ACC_REG_ADDR_TDT_H_THRESH
 0x2C

93 
	#ACC_REG_ADDR_TDT_L_THRESH
 0x2D

94 
	#ACC_REG_ADDR_TDT_TAP_TIMER
 0x2E

95 
	#ACC_REG_ADDR_TDT_TOTAL_TIMER
 0x2F

96 
	#ACC_REG_ADDR_TDT_LATENCY_TIMER
 0x30

97 
	#ACC_REG_ADDR_TDT_WINDOW_TIMER
 0x31

98 

	)

99 
	#ACC_REG_ADDR_BUF_CTRL1
 0x32

100 
	#ACC_REG_ADDR_BUF_CTRL2
 0x33

101 
	#ACC_REG_ADDR_BUF_STATUS_REG1
 0x34

102 
	#ACC_REG_ADDR_BUF_STATUS_REG2
 0x35

103 
	#ACC_REG_ADDR_BUF_CLEAR
 0x36

104 

	)

105 
	#ACC_REG_ADDR_SELF_TEST
 0x3A

106 

	)

107 
	#ACC_REG_ADDR_WUF_THRESH
 0x5A

108 
	#ACC_REG_ADDR_TILT_ANGLE
 0x5C

109 
	#ACC_REG_ADDR_HYST_SET
 0x5F

110 
	#ACC_REG_ADDR_BUF_READ
 0x7F

111 

	)

113 
	#REG_VAL_WHO_AM_I
 0x08

114 

	)

116 
	#ACC_REG_CTRL_PC
 0x80

117 
	#ACC_REG_CTRL_RES
 0x40

118 
	#ACC_REG_CTRL_DRDYE
 0x20

119 
	#ACC_REG_CTRL_GSEL_HI
 0x10

120 
	#ACC_REG_CTRL_GSEL_LO
 0x08

121 
	#ACC_REG_CTRL_GSEL_TDTE
 0x04

122 
	#ACC_REG_CTRL_GSEL_WUFE
 0x02

123 
	#ACC_REG_CTRL_GSEL_TPE
 0x01

124 

	)

125 #ifde‡
ACC_RANGE_8G


127 
	#ACC_REG_CTRL_ON
 ( 
ACC_REG_CTRL_PC
 | 
ACC_REG_CTRL_GSEL_HI
)

	)

128 
	#ACC_REG_CTRL_OFF
 ( 
ACC_REG_CTRL_GSEL_HI
)

	)

131 
	#ACC_REG_CTRL_ON
 ( 
ACC_REG_CTRL_PC
 )

	)

132 
	#ACC_REG_CTRL_OFF
 ( 0 )

	)

149 
HÆAccSñe˘
();

155 
uöt8
 
	gaccSís‹C⁄fig
;

156 
uöt8
 
	gaccSís‹Off
;

165 
	$HÆAccInô
()

167 
accSís‹C⁄fig
 = 
ACC_REG_CTRL_ON
;

168 
accSís‹Off
 = 
ACC_REG_CTRL_OFF
;

169 
	}
}

179 
boﬁ
 
	$HÆAccRód
(
uöt8
 *
pBuf
 )

181 
uöt8
 
x
;

182 
uöt8
 
y
;

183 
uöt8
 
z
;

184 
boﬁ
 
suc˚ss
;

187 
	`HÆAccSñe˘
();

189 
	`HÆSís‹WrôeReg
(
ACC_REG_ADDR_CTRL_REG1
, &
accSís‹C⁄fig
, (accSensorConfig));

192 
	`ST_HAL_DELAY
(180);

195 
suc˚ss
 = 
	`HÆSís‹RódReg
–
ACC_REG_ADDR_XOUT_H
, &
x
, (x));

196 i‡(
suc˚ss
)

198 
suc˚ss
 = 
	`HÆSís‹RódReg
–
ACC_REG_ADDR_YOUT_H
, &
y
, (y));

199 i‡(
suc˚ss
)

201 
suc˚ss
 = 
	`HÆSís‹RódReg
–
ACC_REG_ADDR_ZOUT_H
, &
z
, (z));

205 i‡(
suc˚ss
)

208 
pBuf
[0] = 
x
;

209 
pBuf
[1] = 
y
;

210 
pBuf
[2] = 
z
;

213 
	`HÆSís‹WrôeReg
(
ACC_REG_ADDR_CTRL_REG1
, &
accSís‹Off
, (accSensorOff));

215  
suc˚ss
;

216 
	}
}

226 
boﬁ
 
	$HÆAccTe°
()

228 
uöt8
 
vÆ
;

231 
	`HÆAccSñe˘
();

234 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
ACC_REG_ADDR_DCST_RESP
, &
vÆ
, 1));

235 
	`ST_ASSERT
(
vÆ
==0x55);

238 
vÆ
 = 0x10;

239 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
ACC_REG_ADDR_CTRL_REG3
, &
vÆ
, 1));

240 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
ACC_REG_ADDR_DCST_RESP
, &
vÆ
, 1));

241 
	`ST_ASSERT
(
vÆ
==0xAA);

244 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
ACC_REG_ADDR_WHO_AM_I
, &
vÆ
, 1));

245 
	`ST_ASSERT
(
vÆ
==
REG_VAL_WHO_AM_I
);

247  
TRUE
;

248 
	}
}

262 
	$HÆAccSñe˘
()

265 
	`HÆI2CInô
(
HAL_KXTI9_I2C_ADDRESS
,
i2cClock_267KHZ
);

266 
	}
}

	@Components/hal/target/CC2541ST/hal_acc.h

39 #i‚de‡
HAL_ACC_H


40 
	#HAL_ACC_H


	)

42 #ifde‡
__˝lu•lus


51 
	~"comdef.h
"

68 
HÆAccInô
();

69 
boﬁ
 
HÆAccRód
(
uöt8
 *
pBuf
);

70 
boﬁ
 
HÆAccTe°
();

76 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_aes.c

42 
	~"oßl.h
"

43 
	~"hÆ_´s.h
"

44 
	~"hÆ_dma.h
"

66 (*
pS•AesEn¸y±
)–
uöt8
 *, uöt8 * ) = (*)
NULL
;

71 
	`´sDmaInô
( );

73 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

85 
	$´sDmaInô
( )

87 
hÆDMADesc_t
 *
ch
;

90 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

91 
	`HAL_DMA_SET_DEST
–
ch
, 
HAL_AES_IN_ADDR
 );

92 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

93 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

94 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

95 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
HAL_DMA_TRIG_ENC_DW
 );

96 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_1
 );

97 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_0
 );

98 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

99 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

100 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

103 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_OUT
 );

104 
	`HAL_DMA_SET_SOURCE
–
ch
, 
HAL_AES_OUT_ADDR
 );

105 
	`HAL_DMA_SET_VLEN
–
ch
, 
HAL_DMA_VLEN_USE_LEN
 );

106 
	`HAL_DMA_SET_WORD_SIZE
–
ch
, 
HAL_DMA_WORDSIZE_BYTE
 );

107 
	`HAL_DMA_SET_TRIG_MODE
–
ch
, 
HAL_DMA_TMODE_SINGLE
 );

108 
	`HAL_DMA_SET_TRIG_SRC
–
ch
, 
HAL_DMA_TRIG_ENC_UP
 );

109 
	`HAL_DMA_SET_SRC_INC
–
ch
, 
HAL_DMA_SRCINC_0
 );

110 
	`HAL_DMA_SET_DST_INC
–
ch
, 
HAL_DMA_DSTINC_1
 );

111 
	`HAL_DMA_SET_IRQ
–
ch
, 
HAL_DMA_IRQMASK_DISABLE
 );

112 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
 );

113 
	`HAL_DMA_SET_PRIORITY
–
ch
, 
HAL_DMA_PRI_HIGH
 );

114 
	}
}

117 #i‡(!
deföed
 
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

129 
	$AesLﬂdBlock
–
uöt8
 *
±r
 )

131 
uöt8
 
i
;

134 
	`AES_START
();

137 
i
 = 0; i < 
STATE_BLENGTH
; i++)

139 
ENCDI
 = *
±r
++;

141 
	}
}

155 
	$AesSèπBlock
–
uöt8
 *
out
, uöt8 *
ö
 )

157 
uöt8
 
i
;

160 
	`AES_START
();

163 
i
 = 0; i < 
STATE_BLENGTH
; i++)

165 
ENCDI
 = *
ö
++;

169 
	`HAL_AES_DELAY
();

172 
i
 = 0; i < 
STATE_BLENGTH
; i++)

174 *
out
++ = 
ENCDO
;

176 
	}
}

192 
	$AesSèπSh‹tBlock
–
uöt8
 *
out
, uöt8 *
ö
 )

194 
uöt8
 
i
, 
j
;

196 
	`AES_START
();

197 
i
 = 0; i < 4; i++)

200 
j
 = 0; j < 4; j++)

202 
ENCDI
 = *
ö
++;

206 
	`HAL_AES_DELAY
();

209 
j
 = 0; j < 4; j++)

211 *
out
++ = 
ENCDO
;

214 
	}
}

228 
	$AesLﬂdIV
–
uöt8
 *
IV
 )

230 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

231 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

234 
	`HAL_DMA_SET_SOURCE
–
ch
, 
IV
 );

235 
	`HAL_DMA_SET_LEN
–
ch
, 
STATE_BLENGTH
 );

238 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

239 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

241 
	`asm
("NOP");

242 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

245 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_IV
 );

248 
	`AES_START
();

249  !(
ENCCS
 & 0x08) );

252 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_IV
 );

255 
	`AesLﬂdBlock
–
IV
 );

257 
	}
}

270 
	$AesLﬂdKey
–
uöt8
 *
AesKey
 )

272 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

273 
hÆDMADesc_t
 *
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

276 
	`HAL_DMA_SET_SOURCE
–
ch
, 
AesKey
 );

277 
	`HAL_DMA_SET_LEN
–
ch
, 
KEY_BLENGTH
 );

280 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

281 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

283 
	`asm
("NOP");

284 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

287 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_KEY
 );

290 
	`AES_START
();

291  !(
ENCCS
 & 0x08) );

294 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_LOAD_KEY
 );

297 
	`AesLﬂdBlock
–
AesKey
 );

299 
	}
}

301 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

321 
	$AesDmaSëup
–
uöt8
 *
C°©e
, 
uöt16
 
msg_out_Àn
, uöt8 *
msg_ö
, uöt16 
msg_ö_Àn
 )

323 
hÆDMADesc_t
 *
ch
;

326 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_IN
 );

327 
	`HAL_DMA_SET_SOURCE
–
ch
, 
msg_ö
 );

328 
	`HAL_DMA_SET_LEN
–
ch
, 
msg_ö_Àn
 );

331 
ch
 = 
	`HAL_DMA_GET_DESC1234
–
HAL_DMA_AES_OUT
 );

332 
	`HAL_DMA_SET_DEST
–
ch
, 
C°©e
 );

333 
	`HAL_DMA_SET_LEN
–
ch
, 
msg_out_Àn
 );

336 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_IN
 );

337 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_IN
 );

339 
	`asm
("NOP");

340 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_IN
));

341 
	`HAL_DMA_CLEAR_IRQ
–
HAL_DMA_AES_OUT
 );

342 
	`HAL_DMA_ARM_CH
–
HAL_DMA_AES_OUT
 );

344 
	`asm
("NOP");

345 } !
	`HAL_DMA_CH_ARMED
(
HAL_DMA_AES_OUT
));

346 
	}
}

360 
	$HÆAesInô
( )

362 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

364 
	`´sDmaInô
();

366 
	}
}

379 
	$s•_HW_KeyInô
–
uöt8
 *
AesKey
 )

381 
	`AES_SETMODE
(
ECB
);

382 
	`AesLﬂdKey
–
AesKey
 );

383 
	}
}

402 
	$s•AesEn¸y±HW
–
uöt8
 *
AesKey
, uöt8 *
C°©e
 )

404 ()
AesKey
;

406 #i‡(
deföed
 
HAL_AES_DMA
Ë&& (HAL_AES_DMA =
TRUE
)

408 
	`AesDmaSëup
–
C°©e
, 
STATE_BLENGTH
, Cstate, STATE_BLENGTH );

409 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_ENCRYPT
 );

412 
	`AES_START
();

413  !
	`HAL_DMA_CHECK_IRQ
–
HAL_DMA_AES_OUT
 ) );

416 
	`AES_SETMODE
(
ECB
);

417 
	`AES_SET_ENCR_DECR_KEY_IV
–
AES_ENCRYPT
 );

420 
	`AesSèπBlock
–
C°©e
, Cstate );

422 
	}
}

	@Components/hal/target/CC2541ST/hal_aes.h

39 #i‚de‡
HAL_AES_H_


40 
	#HAL_AES_H_


	)

42 
	~"hÆ_ty≥s.h
"

44 
	#STATE_BLENGTH
 16

45 
	#KEY_BLENGTH
 16

46 
	#KEY_EXP_LENGTH
 176

47 

	)

52 #i‡((
deföed
 
SOFTWARE_AES
Ë&& (SOFTWARE_AES =
TRUE
)Ë&& ((deföed 
SW_AES_AND_KEY_EXP
) && (SW_AES_AND_KEY_EXP == TRUE))

56 
HÆAesInô
( );

57 
AesLﬂdBlock
–
uöt8
 * );

58 
AesSèπBlock
–
uöt8
 *, uint8 * );

59 
AesSèπSh‹tBlock
–
uöt8
 *, uint8 * );

60 
AesLﬂdIV
(
uöt8
 *);

61 
AesDmaSëup
–
uöt8
 *, 
uöt16
, uint8 *, uint16 );

62 
AesLﬂdKey
–
uöt8
 * );

64 (*
pS•AesEn¸y±
)–
uöt8
 *, uint8 * );

65 
	`s•_HW_KeyInô
 (
uöt8
 *);

66 
	`s•KeyEx∑nsi⁄
 (
uöt8
 *, uint8 *);

68 
	`s•AesEn¸y±HW
 (
uöt8
 *, uint8 *);

69 
	`s•AesEn¸y±KeyExp
 (
uöt8
 *, uint8 *);

70 
	`s•AesEn¸y±Basic
 (
uöt8
 *, uint8 *);

72 
	`s•AesDe¸y±HW
–
uöt8
 *, uint8 * );

73 
	`s•AesDe¸y±
–
uöt8
 *
key
, uöt8 *
buf
 );

76 
	#AES_BUSY
 0x08

	)

77 
	#ENCRYPT
 0x00

	)

78 
	#DECRYPT
 0x01

	)

81 
	#AES_SETMODE
(
mode
) \

83 
ENCCS
 = (ENCCS & ~0x70Ë| (
mode
); \

84 
	}
} 0)

	)

87 
	#CBC
 0x00

	)

88 
	#CFB
 0x10

	)

89 
	#OFB
 0x20

	)

90 
	#CTR
 0x30

	)

91 
	#ECB
 0x40

	)

92 
	#CBC_MAC
 0x50

	)

95 
	#AES_SET_ENCR_DECR_KEY_IV
(
cmd
) \

97 
ENCCS
 = (ENCCS & ~0x07Ë| (
cmd
); \

98 } 0)

	)

101 
	#AES_ENCRYPT
 0x00

	)

102 
	#AES_DECRYPT
 0x02

	)

103 
	#AES_LOAD_KEY
 0x04

	)

104 
	#AES_LOAD_IV
 0x06

	)

108 
	#AES_START
(Ë
ENCCS
 |0x01

	)

111 
	#HAL_DMA_AES_IN
 1

	)

112 
	#HAL_DMA_AES_OUT
 2

	)

115 
	#HAL_AES_IN_ADDR
 0x70B1

	)

116 
	#HAL_AES_OUT_ADDR
 0x70B2

	)

118 #i‡!
deföed
 (
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

119 
	#HAL_AES_DELAY
() \

121 vﬁ©ûê
uöt8
 
dñay
 = 15; \

122 
dñay
--); \

123 } 0)

	)

	@Components/hal/target/CC2541ST/hal_assert.c

45 
	~"hÆ_as£π.h
"

46 
	~"hÆ_ty≥s.h
"

47 
	~"hÆ_bﬂrd.h
"

48 
	~"hÆ_defs.h
"

49 
	~"hÆ_mcu.h
"

55 #ifde‡
HAL_LED_BLINK_DELAY


56 #unde‡
HAL_LED_BLINK_DELAY


59 
	#HAL_LED_BLINK_DELAY
(Ë
	`°
–{ vﬁ©ûê
uöt32
 
i
; i=0; i<0x1450; i++) { }; } )

60 

	)

65 
hÆAs£πHaz¨dLights
();

78 
	$hÆAs£πH™dÀr
()

81 #ifde‡
ASSERT_RESET


82 
	`HAL_SYSTEM_RESET
();

83 #ñi‡!
deföed
 
ASSERT_WHILE


84 
	`hÆAs£πHaz¨dLights
();

88 
	}
}

90 #i‡!
deföed
 
ASSERT_WHILE


101 
	$hÆAs£πHaz¨dLights
()

105 
	`HAL_DISABLE_INTERRUPTS
();

112 
	`HAL_LED_BLINK_DELAY
();

115 
	`HAL_TOGGLE_LED1
();

116 
	`HAL_TOGGLE_LED2
();

118 
	}
}

127 
HAL_ASSERT_SIZE
–
öt8
, 1);

128 
HAL_ASSERT_SIZE
–
uöt8
, 1);

129 
HAL_ASSERT_SIZE
–
öt16
, 2);

130 
HAL_ASSERT_SIZE
(
uöt16
, 2);

131 
HAL_ASSERT_SIZE
–
öt32
, 4);

132 
HAL_ASSERT_SIZE
(
uöt32
, 4);

	@Components/hal/target/CC2541ST/hal_bar.c

44 
	~"hÆ_b¨.h
"

45 
	~"hÆ_£ns‹.h
"

46 
	~"hÆ_i2c.h
"

53 
	#HAL_C953_I2C_ADDRESS
 0x77

	)

56 
	#C953_DATA_LEN
 2

	)

57 
	#C953_CAL_LEN
 16

	)

60 
	#C953_REG_ADDR_IFACE_SETTINGS
 0x87

61 
	#C953_REG_ADDR_I2C_SLAVE
 0x88

62 
	#C953_REG_ADDR_RESET
 0xF0

63 
	#C953_REG_ADDR_COMMAND
 0xF1

64 
	#C953_REG_ADDR_TEMP_LSB
 0xF3

65 
	#C953_REG_ADDR_TEMP_MSB
 0xF4

66 
	#C953_REG_ADDR_PRESS_LSB
 0xF5

67 
	#C953_REG_ADDR_PRESS_MSB
 0xF6

68 

	)

70 
	#C953_REG_CALIBRATION_1_LSB
 0x8E

	)

71 
	#C953_REG_CALIBRATION_1_MSB
 0x8F

	)

72 
	#C953_REG_CALIBRATION_2_LSB
 0x90

	)

73 
	#C953_REG_CALIBRATION_2_MSB
 0x91

	)

74 
	#C953_REG_CALIBRATION_3_LSB
 0x92

	)

75 
	#C953_REG_CALIBRATION_3_MSB
 0x93

	)

76 
	#C953_REG_CALIBRATION_4_LSB
 0x94

	)

77 
	#C953_REG_CALIBRATION_4_MSB
 0x95

	)

78 
	#C953_REG_CALIBRATION_5_LSB
 0x96

	)

79 
	#C953_REG_CALIBRATION_5_MSB
 0x97

	)

80 
	#C953_REG_CALIBRATION_6_LSB
 0x98

	)

81 
	#C953_REG_CALIBRATION_6_MSB
 0x99

	)

82 
	#C953_REG_CALIBRATION_7_LSB
 0x9A

	)

83 
	#C953_REG_CALIBRATION_7_MSB
 0x9B

	)

84 
	#C953_REG_CALIBRATION_8_LSB
 0x9C

	)

85 
	#C953_REG_CALIBRATION_8_MSB
 0x9D

	)

88 
	#C953_LOW_RES_LOW
 0x00

89 
	#C953_LOW_RES_STANDARD
 0x08

90 
	#C953_LOW_RES_HIGH
 0x10

91 
	#C953_LOW_RES_ULTRA_HIGH
 0x18

92 

	)

94 
	#C953_PRESSURE_ONLY
 0x00

95 
	#C953_TEMPERATURE_ONLY
 0x02

96 

	)

98 
	#C953_TEMP_READ_COMMAND
 ( 
C953_TEMPERATURE_ONLY
 | 
C953_LOW_RES_LOW
 | 0x01 )

	)

99 
	#C953_PRESS_READ_COMMAND
 ( 
C953_PRESSURE_ONLY
 | 
C953_LOW_RES_LOW
 | 0x01 )

	)

100 
	#C953_OFF_COMMAND
 0x00

	)

101 
	#C953_RESET_COMMAND
 0x73

	)

102 
	#C953_TEST_COMMAND
 0x1E

103 

	)

113 
HÆB¨Sñe˘
();

119 
uöt8
 
	gb¨D©a
[4];

120 
uöt8
 
	gb¨Cmd
 = 
C953_TEMP_READ_COMMAND
;

121 
boﬁ
 
	gfCmdOk
;

130 
	$HÆB¨Inô
()

132 
uöt8
 
vÆ
 = 
C953_OFF_COMMAND
;

134 
	`HÆB¨Sñe˘
();

135 
	`HÆSís‹WrôeReg
(
C953_REG_ADDR_COMMAND
, &
vÆ
, (val));

136 
b¨Cmd
 = 
C953_TEMP_READ_COMMAND
;

137 
	}
}

147 
	$HÆB¨SèπMósuªmít
()

149 
	`HÆB¨Sñe˘
();

150 
fCmdOk
 = 
	`HÆSís‹WrôeReg
(
C953_REG_ADDR_COMMAND
, &
b¨Cmd
, (barCmd));

151 
	}
}

163 
boﬁ
 
	$HÆB¨RódMósuªmít
(
uöt8
 *
pBuf
)

165 
boﬁ
 
suc˚ss
;

166 
uöt8
 
dOff£t
 = 0;

168 i‡(!
fCmdOk
)

170  
FALSE
;

173 
	`HÆB¨Sñe˘
();

175 i‡(
b¨Cmd
==
C953_PRESS_READ_COMMAND
)

177 
dOff£t
 = 2;

180 
suc˚ss
 = 
	`HÆSís‹RódReg
–
C953_REG_ADDR_PRESS_LSB
, &
b¨D©a
[
dOff£t
], 
C953_DATA_LEN
 );

181 i‡(
suc˚ss
)

183 
pBuf
[0] = 
b¨D©a
[0];

184 
pBuf
[1] = 
b¨D©a
[1];

185 
pBuf
[2] = 
b¨D©a
[2];

186 
pBuf
[3] = 
b¨D©a
[3];

189 i‡(
b¨Cmd
==
C953_PRESS_READ_COMMAND
)

191 
b¨Cmd
 = 
C953_TEMP_READ_COMMAND
;

194 
b¨Cmd
 = 
C953_PRESS_READ_COMMAND
;

198  
suc˚ss
;

199 
	}
}

211 
	$HÆB¨RódCÆibøti⁄
(
uöt8
 *
pBuf
)

213 
	`HÆB¨Sñe˘
();

214 
	`HÆSís‹RódReg
(
C953_REG_CALIBRATION_1_LSB
, 
pBuf
, 
C953_CAL_LEN
);

215 
	}
}

225 
boﬁ
 
	$HÆB¨Te°
()

227 
uöt8
 
vÆ
;

230 
	`HÆB¨Sñe˘
();

233 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
C953_REG_ADDR_I2C_SLAVE
, &
vÆ
, (val)));

234 
	`ST_ASSERT
(
vÆ
==
HAL_C953_I2C_ADDRESS
);

237 
vÆ
 = 
C953_TEST_COMMAND
;

238 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
C953_REG_ADDR_COMMAND
, &
vÆ
, (val)));

239 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
C953_REG_ADDR_COMMAND
, &
vÆ
, (val)));

240 
	`ST_ASSERT
(
vÆ
==
C953_TEST_COMMAND
);

243 
vÆ
 = 
C953_OFF_COMMAND
;

244 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
C953_REG_ADDR_COMMAND
, &
vÆ
, (val)));

246  
TRUE
;

247 
	}
}

261 
	$HÆB¨Sñe˘
()

264 
	`HÆI2CInô
(
HAL_C953_I2C_ADDRESS
,
i2cClock_267KHZ
);

265 
	}
}

	@Components/hal/target/CC2541ST/hal_bar.h

39 #i‚de‡
HAL_BAR_H


40 
	#HAL_BAR_H


	)

42 #ifde‡
__˝lu•lus


50 
	~"hÆ_ty≥s.h
"

63 
HÆB¨Inô
();

64 
HÆB¨SèπMósuªmít
();

65 
boﬁ
 
HÆB¨RódMósuªmít
(
uöt8
 *
pBuf
);

66 
HÆB¨RódCÆibøti⁄
(
uöt8
 *
pBuf
);

67 
boﬁ
 
HÆB¨Te°
();

72 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_board_cfg.h

40 #i‚de‡
HAL_BOARD_CFG_H


41 
	#HAL_BOARD_CFG_H


	)

52 
	#ACTIVE_LOW
 !

	)

53 
	#ACTIVE_HIGH
 !!

	)

60 
	~"hÆ_mcu.h
"

61 
	~"hÆ_defs.h
"

62 
	~"hÆ_ty≥s.h
"

71 
	#CC2541_SB


	)

77 
	#HAL_CPU_CLOCK_MHZ
 32

	)

78 
	#EXTERNAL_CRYSTAL_OSC
 0x00

	)

79 
	#INTERNAL_RC_OSC
 0x80

	)

89 #i‡–!
deföed
 ( 
POWER_SAVING
 ) ) && ( !deföed ( 
OSC32K_CRYSTAL_INSTALLED
 ) )

90 
	#OSC32K_CRYSTAL_INSTALLED
 
FALSE


	)

94 #i‡!
deföed
 (
OSC32K_CRYSTAL_INSTALLED
Ë|| (deföed (OSC32K_CRYSTAL_INSTALLEDË&& (OSC32K_CRYSTAL_INSTALLED =
TRUE
))

95 
	#OSC_32KHZ
 
EXTERNAL_CRYSTAL_OSC


	)

97 
	#OSC_32KHZ
 
INTERNAL_RC_OSC


	)

101 
	#MIN_TIME_TO_STABLE_32KHZ_XOSC
 400

	)

108 
	#HAL_NUM_LEDS
 2

	)

110 
	#HAL_LED_BLINK_DELAY
(Ë
	`°
–{ vﬁ©ûê
uöt32
 
i
; i=0; i<0x5800; i++Ë{ }; } )

	)

113 
	#LED1_BV
 
	`BV
(0)

	)

114 
	#LED1_SBIT
 
P1_0


	)

115 
	#LED1_DDR
 
P1DIR


	)

116 
	#LED1_POLARITY
 
ACTIVE_LOW


	)

119 
	#LED2_BV
 
	`BV
(4)

	)

120 
	#LED2_SBIT
 
P0_4


	)

121 
	#LED2_DDR
 
P0DIR


	)

122 
	#LED2_POLARITY
 
ACTIVE_LOW


	)

130 
	#GYRO_VDD_BV
 
	`BV
(1)

	)

131 
	#GYRO_VDD_SBIT
 
P1_1


	)

132 
	#GYRO_VDD_DDR
 
P1DIR


	)

135 
	#GYRO_INT_BV
 
	`BV
(1)

	)

136 
	#GYRO_INT_SBIT
 
P0_1


	)

137 
	#GYRO_INT_DDR
 
P0DIR


	)

140 
	#IRTEMP_DRDY_BV
 
	`BV
(3)

	)

141 
	#IRTEMP_DRDY_SBIT
 
P0_3


	)

142 
	#IRTEMP_DRDY_DDR
 
P0DIR


	)

145 
	#MAG_INT_BV
 
	`BV
(6)

	)

146 
	#MAG_INT_SBIT
 
P0_6


	)

147 
	#MAG_INT_DDR
 
P0DIR


	)

150 
	#DCDC_BV
 
	`BV
(7)

	)

151 
	#DCDC_SBIT
 
P0_7


	)

152 
	#DCDC_DDR
 
P0DIR


	)

153 
	#DCDC_SEL
 
P0SEL


	)

156 
	#ACC_INT_BV
 
	`BV
(2)

	)

157 
	#ACC_INT_SBIT
 
P0_2


	)

158 
	#ACC_INT_DDR
 
P0DIR


	)

159 
	#ACC_INT_SEL
 
P0SEL


	)

174 
	#HAL_FLASH_PAGE_PER_BANK
 16

	)

176 
	#HAL_FLASH_PAGE_SIZE
 2048

	)

177 
	#HAL_FLASH_WORD_SIZE
 4

	)

180 
	#HAL_FLASH_PAGE_MAP
 0x8000

	)

184 #i‡
deföed
 
NON_BANKED


185 
	#HAL_FLASH_LOCK_BITS
 16

	)

186 
	#HAL_NV_PAGE_END
 30

	)

188 
	#HAL_FLASH_LOCK_BITS
 16

	)

189 
	#HAL_NV_PAGE_END
 126

	)

193 
	#HAL_FLASH_IEEE_SIZE
 8

	)

194 
	#HAL_FLASH_IEEE_PAGE
 (
HAL_NV_PAGE_END
+1)

	)

195 
	#HAL_FLASH_IEEE_OSET
 (
HAL_FLASH_PAGE_SIZE
 - 
HAL_FLASH_LOCK_BITS
 - 
HAL_FLASH_IEEE_SIZE
)

	)

196 
	#HAL_INFOP_IEEE_OSET
 0xC

	)

198 
	#HAL_NV_PAGE_CNT
 2

	)

199 
	#HAL_NV_PAGE_BEG
 (
HAL_NV_PAGE_END
-
HAL_NV_PAGE_CNT
+1)

	)

202 
	#HAL_NV_DMA_CH
 0

	)

203 
	#HAL_DMA_CH_RX
 3

	)

204 
	#HAL_DMA_CH_TX
 4

	)

206 
	#HAL_NV_DMA_GET_DESC
(Ë
	`HAL_DMA_GET_DESC0
()

	)

207 
	#HAL_NV_DMA_SET_ADDR
(
a
Ë
	`HAL_DMA_SET_ADDR_DESC0
(◊))

	)

216 
	#PREFETCH_ENABLE
(Ë
	`°
–
FCTL
 = 0x08; )

	)

217 
	#PREFETCH_DISABLE
(Ë
	`°
–
FCTL
 = 0x04; )

	)

222 
	#SET_OSC_TO_HSOSC
() \

224 
CLKCONCMD
 = (CLKCONCMD & 0x80Ë| 
CLKCONCMD_16MHZ
; \

225  (
CLKCONSTA
 & ~0x80Ë!
CLKCONCMD_16MHZ
 ); \

226 }

	)

229 
	#SET_OSC_TO_XOSC
() \

231 
CLKCONCMD
 = (CLKCONCMD & 0x80Ë| 
CLKCONCMD_32MHZ
; \

232  (
CLKCONSTA
 & ~0x80Ë!
CLKCONCMD_32MHZ
 ); \

233 }

	)

236 
	#SET_32KHZ_OSC
() \

238 
CLKCONCMD
 = (CLKCONCMD & ~0x80Ë| 
OSC_32KHZ
; \

239  (
CLKCONSTA
 & 0x80Ë!
OSC_32KHZ
 ); \

240 }

	)

242 
	#START_HSOSC_XOSC
() \

244 
SLEEPCMD
 &~
OSC_PD
; \

245 !(
SLEEPSTA
 & 
XOSC_STB
)); \

246 }

	)

248 
	#STOP_HSOSC
() \

250 
SLEEPCMD
 |
OSC_PD
; \

251 }

	)

254 
	#HAL_BOARD_INIT
() \

257 
	`START_HSOSC_XOSC
(); \

258 
	`SET_OSC_TO_HSOSC
(); \

259 
	`SET_32KHZ_OSC
(); \

260 
	`SET_OSC_TO_XOSC
(); \

261 
	`STOP_HSOSC
(); \

264 
	`PREFETCH_ENABLE
(); \

267 
LED1_DDR
 |
LED1_BV
; \

268 
LED2_DDR
 |
LED2_BV
; \

269 
GYRO_VDD_DDR
 |
GYRO_VDD_BV
; \

270 
DCDC_DDR
 |
DCDC_BV
; \

271 
GYRO_VDD_SBIT
 = 1; \

272 
P0DIR
 |
	`BV
(5); \

273 
P2DIR
 |
	`BV
(0); \

274 
P1DIR
 |= 0x3C; \

275 
P0INP
 = 0x4E; \

276 }

	)

281 
	#HAL_TURN_OFF_LED1
(Ë
	`°
–
LED1_SBIT
 = 
	`LED1_POLARITY
 (0); )

	)

282 
	#HAL_TURN_OFF_LED2
(Ë
	`°
–
LED2_SBIT
 = 
	`LED2_POLARITY
 (0); )

	)

284 
	#HAL_TURN_ON_LED1
(Ë
	`°
–
LED1_SBIT
 = 
	`LED1_POLARITY
 (1); )

	)

285 
	#HAL_TURN_ON_LED2
(Ë
	`°
–
LED2_SBIT
 = 
	`LED2_POLARITY
 (1); )

	)

287 
	#HAL_TOGGLE_LED1
(Ë
	`°
–i‡(
LED1_SBIT
Ë{ LED1_SBIT = 0; } { LED1_SBIT = 1;} )

	)

288 
	#HAL_TOGGLE_LED2
(Ë
	`°
–i‡(
LED2_SBIT
Ë{ LED2_SBIT = 0; } { LED2_SBIT = 1;} )

	)

290 
	#HAL_STATE_LED1
(Ë(
	`LED1_POLARITY
 (
LED1_SBIT
))

	)

291 
	#HAL_STATE_LED2
(Ë(
	`LED2_POLARITY
 (
LED2_SBIT
))

	)

299 #i‚de‡
HAL_TIMER


300 
	#HAL_TIMER
 
FALSE


	)

304 #i‚de‡
HAL_ADC


305 
	#HAL_ADC
 
FALSE


	)

309 #i‚de‡
HAL_DMA


310 
	#HAL_DMA
 
TRUE


	)

314 #i‚de‡
HAL_FLASH


315 
	#HAL_FLASH
 
TRUE


	)

319 #i‚de‡
HAL_AES


320 
	#HAL_AES
 
FALSE


	)

323 #i‚de‡
HAL_AES_DMA


324 
	#HAL_AES_DMA
 
FALSE


	)

328 #i‚de‡
HAL_LCD


329 
	#HAL_LCD
 
FALSE


	)

333 #i‚de‡
HAL_LED


334 
	#HAL_LED
 
TRUE


	)

336 #i‡(!
deföed
 
BLINK_LEDS
Ë&& (
HAL_LED
 =
TRUE
)

337 
	#BLINK_LEDS


	)

341 #i‚de‡
HAL_KEY


342 
	#HAL_KEY
 
TRUE


	)

	@Components/hal/target/CC2541ST/hal_crc.c

45 
	~"hÆ_bﬂrd.h
"

46 
	~"hÆ_¸c.h
"

47 
	~"hÆ_ty≥s.h
"

64 
uöt16
 
	$HÆCRCCÆc
()

66 
uöt16
 
¸c
 = 
RNDH
;

67 
¸c
 = (¸¯<< 8Ë| 
RNDL
;

69  
¸c
;

70 
	}
}

87 
	$HÆCRCExec
(
uöt8
 
ch
)

89 
RNDH
 = 
ch
;

90 
	}
}

107 
	$HÆCRCInô
(
uöt16
 
£ed
)

109 
ADCCON1
 &= 0xF3;

111 
RNDL
 = 
	`HI_UINT16
(
£ed
);

112 
RNDL
 = 
	`LO_UINT16
(
£ed
);

113 
	}
}

	@Components/hal/target/CC2541ST/hal_crc.h

39 #i‚de‡
HAL_CRC_H


40 
	#HAL_CRC_H


	)

47 
	~"hÆ_ty≥s.h
"

64 
uöt16
 
HÆCRCCÆc
();

81 
HÆCRCExec
(
uöt8
 
ch
);

98 
HÆCRCInô
(
uöt16
 
£ed
);

	@Components/hal/target/CC2541ST/hal_dma.c

44 
	~"hÆ_dma.h
"

45 
	~"hÆ_mcu.h
"

46 
	~"hÆ_ty≥s.h
"

47 
	~"hÆ_u¨t.h
"

49 #i‡(
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)

50 
	~"hÆ_úgí.h
"

53 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

59 
hÆDMADesc_t
 
	gdmaCh0
;

60 
hÆDMADesc_t
 
	gdmaCh1234
[4];

71 
	$HÆDmaInô
( )

73 
	`HAL_DMA_SET_ADDR_DESC0
–&
dmaCh0
 );

74 
	`HAL_DMA_SET_ADDR_DESC1234
–
dmaCh1234
 );

75 #i‡(
HAL_UART_DMA
 || \

76 ((
deföed
 
HAL_UART_SPI
) && (HAL_UART_SPI != 0)) || \

77 ((
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)))

78 
DMAIE
 = 1;

80 
	}
}

82 #i‡(
HAL_UART_DMA
 || \

83 ((
deföed
 
	gHAL_UART_SPI
) && (HAL_UART_SPI != 0)) || \

84 ((
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)))

94 
	$HAL_ISR_FUNCTION
–
hÆDmaI§
, 
DMA_VECTOR
 )

96 
	`HAL_ENTER_ISR
();

98 
DMAIF
 = 0;

100 #i‡(((
deföed
 
HAL_UART_DMA
) && (HAL_UART_DMA != 0)) || \

101 ((
deföed
 
HAL_UART_SPI
) && (HAL_UART_SPI != 0)))

102 i‡(
	`HAL_DMA_CHECK_IRQ
(
HAL_DMA_CH_TX
))

104 
	`HAL_DMA_CLEAR_IRQ
(
HAL_DMA_CH_TX
);

105 
	`HÆUARTI§DMA
();

106 
	`HÆUARTI§DMA
();

110 #i‡(
deföed
 
HAL_IRGEN
Ë&& (HAL_IRGEN =
TRUE
)

111 i‡–
HAL_IRGEN
 =
TRUE
 && 
	`HAL_DMA_CHECK_IRQ
–
HAL_IRGEN_DMA_CH
 ) )

113 
	`HAL_DMA_CLEAR_IRQ
–
HAL_IRGEN_DMA_CH
 );

114 
	`HÆIrGíDmaI§
();

118 
	`CLEAR_SLEEP_MODE
();

119 
	`HAL_EXIT_ISR
();

122 
	}
}

	@Components/hal/target/CC2541ST/hal_dma.h

40 #i‚de‡
HAL_DMA_H


41 
	#HAL_DMA_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"hÆ_bﬂrd.h
"

53 
	~"hÆ_ty≥s.h
"

55 #i‡((
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
))

61 
	#HAL_DMA_SET_ADDR_DESC0
–
a
 ) \

62 
	`°
( \

63 
DMA0CFGH
 = (
uöt8
)–(
uöt16
)(
a
) >> 8 ); \

64 
DMA0CFGL
 = (
uöt8
)–(
uöt16
)(
a
) & 0xFF ); \

65 )

	)

67 
	#HAL_DMA_SET_ADDR_DESC1234
–
a
 ) \

68 
	`°
( \

69 
DMA1CFGH
 = (
uöt8
)–(
uöt16
)(
a
) >> 8 ); \

70 
DMA1CFGL
 = (
uöt8
)–(
uöt16
)(
a
) & 0xFF); \

71 )

	)

73 
	#HAL_DMA_GET_DESC0
(Ë&
dmaCh0


	)

75 
	#HAL_DMA_GET_DESC1234
–
a
 ) (
dmaCh1234
+(◊)-1))

	)

77 
	#HAL_DMA_ARM_CH
–
ch
 ) 
DMAARM
 = (0x01 << (ch))

	)

79 
	#HAL_DMA_CH_ARMED
–
ch
 ) (
DMAARM
 & (0x01 << (ch)))

	)

81 
	#HAL_DMA_ABORT_CH
–
ch
 ) 
DMAARM
 = (0x80 | (0x01 << (ch)))

	)

82 
	#HAL_DMA_MAN_TRIGGER
–
ch
 ) 
DMAREQ
 = (0x01 << (ch))

	)

83 
	#HAL_DMA_START_CH
–
ch
 ) 
	`HAL_DMA_MAN_TRIGGER
–(chË)

	)

85 
	#HAL_DMA_CLEAR_IRQ
–
ch
 ) 
DMAIRQ
 &~–1 << (chË)

	)

87 
	#HAL_DMA_CHECK_IRQ
–
ch
 ) (
DMAIRQ
 & ( 1 << (chË))

	)

90 
	#HAL_DMA_SET_SOURCE
–
pDesc
, 
§c
 ) \

91 
	`°
( \

92 
pDesc
->
§cAddrH
 = (
uöt8
)((
uöt16
)(
§c
) >> 8); \

93 
pDesc
->
§cAddrL
 = (
uöt8
)((
uöt16
)(
§c
) & 0xFF); \

94 )

	)

97 
	#HAL_DMA_SET_DEST
–
pDesc
, 
d°
 ) \

98 
	`°
( \

99 
pDesc
->
d°AddrH
 = (
uöt8
)((
uöt16
)(
d°
) >> 8); \

100 
pDesc
->
d°AddrL
 = (
uöt8
)((
uöt16
)(
d°
) & 0xFF); \

101 )

	)

105 
	#HAL_DMA_SET_LEN
–
pDesc
, 
Àn
 ) \

106 
	`°
( \

107 
pDesc
->
x„rLíL
 = (
uöt8
)(
uöt16
)(
Àn
); \

108 
pDesc
->
x„rLíV
 &~
HAL_DMA_LEN_H
; \

109 
pDesc
->
x„rLíV
 |(
uöt8
)((
uöt16
)(
Àn
) >> 8); \

110 )

	)

112 
	#HAL_DMA_GET_LEN
–
pDesc
 ) \

113 (((
uöt16
)(
pDesc
->
x„rLíV
 & 
HAL_DMA_LEN_H
Ë<< 8Ë|ÖDesc->
x„rLíL
)

	)

115 
	#HAL_DMA_SET_VLEN
–
pDesc
, 
vMode
 ) \

116 
	`°
( \

117 
pDesc
->
x„rLíV
 &~
HAL_DMA_LEN_V
; \

118 
pDesc
->
x„rLíV
 |(
vMode
 << 5); \

119 )

	)

121 
	#HAL_DMA_SET_WORD_SIZE
–
pDesc
, 
xSz
 ) \

122 
	`°
( \

123 
pDesc
->
˘æA
 &~
HAL_DMA_WORD_SIZE
; \

124 
pDesc
->
˘æA
 |(
xSz
 << 7); \

125 )

	)

127 
	#HAL_DMA_SET_TRIG_MODE
–
pDesc
, 
tMode
 ) \

128 
	`°
( \

129 
pDesc
->
˘æA
 &~
HAL_DMA_TRIG_MODE
; \

130 
pDesc
->
˘æA
 |(
tMode
 << 5); \

131 )

	)

133 
	#HAL_DMA_GET_TRIG_MODE
–
pDesc
 ) (’Desc->
˘æA
 >> 5Ë& 0x3)

	)

135 
	#HAL_DMA_SET_TRIG_SRC
–
pDesc
, 
tSrc
 ) \

136 
	`°
( \

137 
pDesc
->
˘æA
 &~
HAL_DMA_TRIG_SRC
; \

138 
pDesc
->
˘æA
 |
tSrc
; \

139 )

	)

141 
	#HAL_DMA_SET_SRC_INC
–
pDesc
, 
§cInc
 ) \

142 
	`°
( \

143 
pDesc
->
˘æB
 &~
HAL_DMA_SRC_INC
; \

144 
pDesc
->
˘æB
 |(
§cInc
 << 6); \

145 )

	)

147 
	#HAL_DMA_SET_DST_INC
–
pDesc
, 
d°Inc
 ) \

148 
	`°
( \

149 
pDesc
->
˘æB
 &~
HAL_DMA_DST_INC
; \

150 
pDesc
->
˘æB
 |(
d°Inc
 << 4); \

151 )

	)

153 
	#HAL_DMA_SET_IRQ
–
pDesc
, 
íabÀ
 ) \

154 
	`°
( \

155 
pDesc
->
˘æB
 &~
HAL_DMA_IRQ_MASK
; \

156 
pDesc
->
˘æB
 |(
íabÀ
 << 3); \

157 )

	)

159 
	#HAL_DMA_SET_M8
–
pDesc
, 
m8
 ) \

160 
	`°
( \

161 
pDesc
->
˘æB
 &~
HAL_DMA_M8
; \

162 
pDesc
->
˘æB
 |(
m8
 << 2); \

163 )

	)

165 
	#HAL_DMA_SET_PRIORITY
–
pDesc
, 
¥i
 ) \

166 
	`°
( \

167 
pDesc
->
˘æB
 &~
HAL_DMA_PRIORITY
; \

168 
pDesc
->
˘æB
 |
¥i
; \

169 )

	)

176 
	#HAL_DMA_VLEN_USE_LEN
 0x00

	)

178 
	#HAL_DMA_VLEN_1_P_VALOFFIRST
 0x01

	)

180 
	#HAL_DMA_VLEN_VALOFFIRST
 0x02

	)

182 
	#HAL_DMA_VLEN_1_P_VALOFFIRST_P_1
 0x03

	)

184 
	#HAL_DMA_VLEN_1_P_VALOFFIRST_P_2
 0x04

	)

186 
	#HAL_DMA_WORDSIZE_BYTE
 0x00

	)

187 
	#HAL_DMA_WORDSIZE_WORD
 0x01

	)

189 
	#HAL_DMA_TMODE_SINGLE
 0x00

	)

190 
	#HAL_DMA_TMODE_BLOCK
 0x01

	)

191 
	#HAL_DMA_TMODE_SINGLE_REPEATED
 0x02

	)

192 
	#HAL_DMA_TMODE_BLOCK_REPEATED
 0x03

	)

194 
	#HAL_DMA_TRIG_NONE
 0

	)

195 
	#HAL_DMA_TRIG_PREV
 1

	)

196 
	#HAL_DMA_TRIG_T1_CH0
 2

	)

197 
	#HAL_DMA_TRIG_T1_CH1
 3

	)

198 
	#HAL_DMA_TRIG_T1_CH2
 4

	)

199 
	#HAL_DMA_TRIG_T2_COMP
 5

	)

200 
	#HAL_DMA_TRIG_T2_OVFL
 6

	)

201 
	#HAL_DMA_TRIG_T3_CH0
 7

	)

202 
	#HAL_DMA_TRIG_T3_CH1
 8

	)

203 
	#HAL_DMA_TRIG_T4_CH0
 9

	)

204 
	#HAL_DMA_TRIG_T4_CH1
 10

	)

205 
	#HAL_DMA_TRIG_ST
 11

	)

206 
	#HAL_DMA_TRIG_IOC_0
 12

	)

207 
	#HAL_DMA_TRIG_IOC_1
 13

	)

208 
	#HAL_DMA_TRIG_URX0
 14

	)

209 
	#HAL_DMA_TRIG_UTX0
 15

	)

210 
	#HAL_DMA_TRIG_URX1
 16

	)

211 
	#HAL_DMA_TRIG_UTX1
 17

	)

212 
	#HAL_DMA_TRIG_FLASH
 18

	)

213 
	#HAL_DMA_TRIG_RADIO
 19

	)

214 
	#HAL_DMA_TRIG_ADC_CHALL
 20

	)

215 
	#HAL_DMA_TRIG_ADC_CH0
 21

	)

216 
	#HAL_DMA_TRIG_ADC_CH1
 22

	)

217 
	#HAL_DMA_TRIG_ADC_CH2
 23

	)

218 
	#HAL_DMA_TRIG_ADC_CH3
 24

	)

219 
	#HAL_DMA_TRIG_ADC_CH4
 25

	)

220 
	#HAL_DMA_TRIG_ADC_CH5
 26

	)

221 
	#HAL_DMA_TRIG_ADC_CH6
 27

	)

222 
	#HAL_DMA_TRIG_ADC_CH7
 28

	)

223 
	#HAL_DMA_TRIG_ENC_DW
 29

	)

224 
	#HAL_DMA_TRIG_ENC_UP
 30

	)

226 
	#HAL_DMA_SRCINC_0
 0x00

	)

227 
	#HAL_DMA_SRCINC_1
 0x01

	)

228 
	#HAL_DMA_SRCINC_2
 0x02

	)

229 
	#HAL_DMA_SRCINC_M1
 0x03

	)

231 
	#HAL_DMA_DSTINC_0
 0x00

	)

232 
	#HAL_DMA_DSTINC_1
 0x01

	)

233 
	#HAL_DMA_DSTINC_2
 0x02

	)

234 
	#HAL_DMA_DSTINC_M1
 0x03

	)

236 
	#HAL_DMA_IRQMASK_DISABLE
 0x00

	)

237 
	#HAL_DMA_IRQMASK_ENABLE
 0x01

	)

239 
	#HAL_DMA_M8_USE_8_BITS
 0x00

	)

240 
	#HAL_DMA_M8_USE_7_BITS
 0x01

	)

242 
	#HAL_DMA_PRI_LOW
 0x00

	)

243 
	#HAL_DMA_PRI_GUARANTEED
 0x01

	)

244 
	#HAL_DMA_PRI_HIGH
 0x02

	)

245 
	#HAL_DMA_PRI_ABSOLUTE
 0x03

	)

247 
	#HAL_DMA_MAX_ARM_CLOCKS
 45

248 

	)

254 
	#HAL_DMA_LEN_V
 0xE0

	)

255 
	#HAL_DMA_LEN_H
 0x1F

	)

258 
	#HAL_DMA_WORD_SIZE
 0x80

	)

259 
	#HAL_DMA_TRIG_MODE
 0x60

	)

260 
	#HAL_DMA_TRIG_SRC
 0x1F

	)

263 
	#HAL_DMA_SRC_INC
 0xC0

	)

264 
	#HAL_DMA_DST_INC
 0x30

	)

265 
	#HAL_DMA_IRQ_MASK
 0x08

	)

266 
	#HAL_DMA_M8
 0x04

	)

267 
	#HAL_DMA_PRIORITY
 0x03

	)

270 
uöt8
 
§cAddrH
;

271 
uöt8
 
§cAddrL
;

272 
uöt8
 
d°AddrH
;

273 
uöt8
 
d°AddrL
;

274 
uöt8
 
x„rLíV
;

275 
uöt8
 
x„rLíL
;

276 
uöt8
 
˘æA
;

277 
uöt8
 
˘æB
;

278 } 
	thÆDMADesc_t
;

284 
hÆDMADesc_t
 
dmaCh0
;

285 
hÆDMADesc_t
 
dmaCh1234
[4];

291 
HÆDmaInô
( );

295 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_flash.c

45 
	~"hÆ_bﬂrd_cfg.h
"

46 
	~"hÆ_dma.h
"

47 
	~"hÆ_Êash.h
"

48 
	~"hÆ_ty≥s.h
"

69 
	$HÆFœshRód
(
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
buf
, uöt16 
˙t
)

72 
uöt8
 *
±r
 = (uöt8 *)(
off£t
 + 
HAL_FLASH_PAGE_MAP
) +

73 ((
pg
 % 
HAL_FLASH_PAGE_PER_BANK
Ë* 
HAL_FLASH_PAGE_SIZE
);

74 
uöt8
 
mem˘r
 = 
MEMCTR
;

76 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


77 
hÆI¡Sèã_t
 
is
;

80 
pg
 /
HAL_FLASH_PAGE_PER_BANK
;

82 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


83 
	`HAL_ENTER_CRITICAL_SECTION
(
is
);

87 
MEMCTR
 = (MEMCTR & 0xF8Ë| 
pg
;

89 
˙t
--)

91 *
buf
++ = *
±r
++;

94 
MEMCTR
 = 
mem˘r
;

96 #i‡!
deföed
 
HAL_OAD_BOOT_CODE


97 
	`HAL_EXIT_CRITICAL_SECTION
(
is
);

99 
	}
}

119 
	$HÆFœshWrôe
(
uöt16
 
addr
, 
uöt8
 *
buf
, uöt16 
˙t
)

121 #i‡(
deföed
 
HAL_DMA
Ë&& (HAL_DMA =
TRUE
)

122 
hÆDMADesc_t
 *
ch
 = 
	`HAL_NV_DMA_GET_DESC
();

124 
	`HAL_DMA_SET_SOURCE
(
ch
, 
buf
);

125 
	`HAL_DMA_SET_DEST
(
ch
, &
FWDATA
);

126 
	`HAL_DMA_SET_VLEN
(
ch
, 
HAL_DMA_VLEN_USE_LEN
);

127 
	`HAL_DMA_SET_LEN
(
ch
, (
˙t
 * 
HAL_FLASH_WORD_SIZE
));

128 
	`HAL_DMA_SET_WORD_SIZE
(
ch
, 
HAL_DMA_WORDSIZE_BYTE
);

129 
	`HAL_DMA_SET_TRIG_MODE
(
ch
, 
HAL_DMA_TMODE_SINGLE
);

130 
	`HAL_DMA_SET_TRIG_SRC
(
ch
, 
HAL_DMA_TRIG_FLASH
);

131 
	`HAL_DMA_SET_SRC_INC
(
ch
, 
HAL_DMA_SRCINC_1
);

132 
	`HAL_DMA_SET_DST_INC
(
ch
, 
HAL_DMA_DSTINC_0
);

134 
	`HAL_DMA_SET_IRQ
(
ch
, 
HAL_DMA_IRQMASK_DISABLE
);

135 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
);

136 
	`HAL_DMA_SET_PRIORITY
(
ch
, 
HAL_DMA_PRI_HIGH
);

137 
	`HAL_DMA_CLEAR_IRQ
(
HAL_NV_DMA_CH
);

138 
	`HAL_DMA_ARM_CH
(
HAL_NV_DMA_CH
);

140 
FADDRL
 = (
uöt8
)
addr
;

141 
FADDRH
 = (
uöt8
)(
addr
 >> 8);

142 
FCTL
 |= 0x02;

143 
FCTL
 & 0x80);

145 
	}
}

163 
	$HÆFœshEø£
(
uöt8
 
pg
)

165 
FADDRH
 = 
pg
 * (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
 / 256);

166 
FCTL
 |= 0x01;

167 
	}
}

	@Components/hal/target/CC2541ST/hal_gyro.c

45 
	~"hÆ_gyro.h
"

46 
	~"hÆ_i2c.h
"

47 
	~"hÆ_£ns‹.h
"

55 
	#HAL_GYRO_I2C_ADDRESS
 0x68

	)

56 
	#HAL_GYRO_DATA_SIZE
 6

	)

60 
	#HAL_GYRO_REG_WHOAMI
 0x00

61 

	)

63 
	#HAL_GYRO_REG_XOFFS_USRH
 0x0C

64 
	#HAL_GYRO_REG_XOFFS_USRL
 0x0D

65 
	#HAL_GYRO_REG_YOFFS_USRH
 0x0E

66 
	#HAL_GYRO_REG_YOFFS_USRL
 0x0F

67 
	#HAL_GYRO_REG_ZOFFS_USRH
 0x10

68 
	#HAL_GYRO_REG_ZOFFS_USRL
 0x11

69 

	)

71 
	#HAL_GYRO_REG_FIFO_EN
 0x12

72 
	#HAL_GYRO_REG_AUX_VDDIO
 0x13

73 
	#HAL_GYRO_REG_AUX_SLV_ADDR
 0x14

74 
	#HAL_GYRO_REG_SMPLRT_DIV
 0x15

75 
	#HAL_GYRO_REG_DLPF_FS
 0x16

76 
	#HAL_GYRO_REG_INT_CFG
 0x17

77 
	#HAL_GYRO_REG_AUX_BURST_ADDR
 0x18

78 
	#HAL_GYRO_REG_INT_STATUS
 0x1A

79 

	)

81 
	#HAL_GYRO_REG_TEMP_OUT_H
 0x1B

82 
	#HAL_GYRO_REG_TEMP_OUT_L
 0x1C

83 
	#HAL_GYRO_REG_GYRO_XOUT_H
 0x1D

84 
	#HAL_GYRO_REG_GYRO_XOUT_L
 0x1E

85 
	#HAL_GYRO_REG_GYRO_YOUT_H
 0x1F

86 
	#HAL_GYRO_REG_GYRO_YOUT_L
 0x20

87 
	#HAL_GYRO_REG_GYRO_ZOUT_H
 0x21

88 
	#HAL_GYRO_REG_GYRO_ZOUT_L
 0x22

89 
	#HAL_GYRO_REG_AUX_XOUT_H
 0x23

90 
	#HAL_GYRO_REG_AUX_XOUT_L
 0x24

91 
	#HAL_GYRO_REG_AUX_YOUT_H
 0x25

92 
	#HAL_GYRO_REG_AUX_YOUT_L
 0x26

93 
	#HAL_GYRO_REG_AUX_ZOUT_H
 0x27

94 
	#HAL_GYRO_REG_AUX_ZOUT_L
 0x28

95 

	)

97 
	#HAL_GYRO_REG_FIFO_COUNTH
 0x3A

98 
	#HAL_GYRO_REG_FIFO_COUNTL
 0x3B

99 
	#HAL_GYRO_REG_FIFO_R
 0x3C

100 

	)

102 
	#HAL_GYRO_REG_USER_CTRL
 0x3D

103 
	#HAL_GYRO_REG_PWR_MGM
 0x3E

104 

	)

106 
	#HAL_GYRO_REG_FIFO_EN_TEMP_OUT
 0x80

	)

107 
	#HAL_GYRO_REG_FIFO_EN_GYRO_XOUT
 0x40

	)

108 
	#HAL_GYRO_REG_FIFO_EN_GYRO_YOUT
 0x20

	)

109 
	#HAL_GYRO_REG_FIFO_EN_GYRO_ZOUT
 0x10

	)

110 
	#HAL_GYRO_REG_FIFO_EN_AUX_XOUT
 0x08

	)

111 
	#HAL_GYRO_REG_FIFO_EN_AUX_YOUT
 0x04

	)

112 
	#HAL_GYRO_REG_FIFO_EN_AUX_ZOUT
 0x02

	)

113 
	#HAL_GYRO_REG_FIFO_EN_FIFO_FOOTER
 0x01

	)

115 
	#HAL_GYRO_USER_CTRL_DMP_EN
 0x80

	)

116 
	#HAL_GYRO_USER_CTRL_FIFO_EN
 0x40

	)

117 
	#HAL_GYRO_USER_CTRL_AUX_IF_EN
 0x20

	)

118 
	#HAL_GYRO_USER_CTRL_AUX_IF_RST_EN
 0x08

	)

119 
	#HAL_GYRO_USER_CTRL_DMP_RST
 0x04

	)

120 
	#HAL_GYRO_USER_CTRL_FIFO_RST
 0x02

	)

121 
	#HAL_GYRO_USER_CTRL_GYRO_RST
 0x01

	)

123 
	#HAL_GYRO_PWR_MGM_H_RESET
 0x80

	)

124 
	#HAL_GYRO_PWR_MGM_SLEEP
 0x40

	)

125 
	#HAL_GYRO_PWR_MGM_STBY_XG
 0x20

	)

126 
	#HAL_GYRO_PWR_MGM_STBY_YG
 0x10

	)

127 
	#HAL_GYRO_PWR_MGM_STBY_ZG
 0x08

	)

128 
	#HAL_GYRO_PWR_MGM_STBY_ALL
 0x38

129 

	)

131 
	#HAL_GYRO_PWR_MGM_CLOCK_INT_OSC
 0x00

	)

132 
	#HAL_GYRO_PWR_MGM_CLOCK_PLL_X
 0x01

	)

133 
	#HAL_GYRO_PWR_MGM_CLOCK_PLL_Y
 0x02

	)

134 
	#HAL_GYRO_PWR_MGM_CLOCK_PLL_Z
 0x03

	)

135 
	#HAL_GYRO_PWR_MGM_CLOCK_PLL_32768KHZ
 0x04

	)

136 
	#HAL_GYRO_PWR_MGM_CLOCK_PLL_19_2MHZ
 0x05

	)

137 
	#HAL_GYRO_PWR_MGM_CLOCK_STOP
 0x07

	)

143 
HÆGyroSñe˘
();

149 
uöt8
 
	gmSètus
;

156 
uöt8
 
	gmDißbÀdAxes
;

157 
uöt8
 
	gcfgOn
;

172 
	$HÆGyroInô
()

174 
mSètus
 = 
HAL_GYRO_STOPPED
;

175 
mDißbÀdAxes
 = 
HAL_GYRO_PWR_MGM_STBY_ALL
;

177 
	`HÆGyroTu∫Off
();

178 
	}
}

188 
	$HÆGyroTu∫On
()

190 
boﬁ
 
suc˚ss
;

191 
uöt8
 
˛k_£À˘
;

193 
	`HÆDcDcC⁄åﬁ
(
ST_GYRO
,
åue
);

195 
	`HÆGyroSñe˘
();

198 
˛k_£À˘
 = 
HAL_GYRO_PWR_MGM_CLOCK_INT_OSC
;

199 if(!(
mDißbÀdAxes
 & 
HAL_GYRO_PWR_MGM_STBY_XG
))

201 
˛k_£À˘
 = 
HAL_GYRO_PWR_MGM_CLOCK_PLL_X
;

203 if(!(
mDißbÀdAxes
 & 
HAL_GYRO_PWR_MGM_STBY_YG
))

205 
˛k_£À˘
 = 
HAL_GYRO_PWR_MGM_CLOCK_PLL_Y
;

207 if(!(
mDißbÀdAxes
 & 
HAL_GYRO_PWR_MGM_STBY_ZG
))

209 
˛k_£À˘
 = 
HAL_GYRO_PWR_MGM_CLOCK_PLL_Z
;

213 
cfgOn
 = 
mDißbÀdAxes
 & (~
HAL_GYRO_PWR_MGM_SLEEP
 | 
˛k_£À˘
);

214 
suc˚ss
 = 
	`HÆSís‹WrôeReg
(
HAL_GYRO_REG_PWR_MGM
,&
cfgOn
,1);

215 if(
suc˚ss
)

217 
mSètus
 = 
HAL_GYRO_DATA_READY
;

221 
mSètus
 = 
HAL_GYRO_STATE_ERROR
;

223 
	}
}

232 
	$HÆGyroTu∫Off
()

234 
boﬁ
 
suc˚ss
;

235 
uöt8
 
vÆ
;

237 
	`HÆGyroSñe˘
();

240 
vÆ
 = 
HAL_GYRO_PWR_MGM_SLEEP
;

241 
suc˚ss
 = 
	`HÆSís‹WrôeReg
(
HAL_GYRO_REG_PWR_MGM
,&
vÆ
,1);

243 if(
suc˚ss
)

245 
uöt8
 
rv
;

247 
suc˚ss
 = 
	`HÆSís‹RódReg
(
HAL_GYRO_REG_PWR_MGM
,&
rv
,1);

248 i‡(
suc˚ss
 && 
rv
 =
vÆ
)

250 
mSètus
 = 
HAL_GYRO_STOPPED
;

251 
mDißbÀdAxes
 = 
HAL_GYRO_PWR_MGM_STBY_ALL
;

255 i‡(!
suc˚ss
)

257 
mSètus
 = 
HAL_GYRO_STATE_ERROR
;

260 
	`HÆDcDcC⁄åﬁ
(
ST_GYRO
,
Ál£
);

261 
	}
}

273 
boﬁ
 
	$HÆGyroRód
(
uöt8
 *
pBuf
)

275 
boﬁ
 
suc˚ss
;

276 
uöt8
 
buf
[
HAL_GYRO_DATA_SIZE
];

277 
uöt8
 
vÆ
;

279 
	`HÆGyroSñe˘
();

282 
suc˚ss
 = 
	`HÆSís‹RódReg
(
HAL_GYRO_REG_GYRO_XOUT_H
,
buf
,
HAL_GYRO_DATA_SIZE
);

284 i‡(
suc˚ss
)

287 
pBuf
[0] = 
buf
[1];

288 
pBuf
[1] = 
buf
[0];

289 
pBuf
[2] = 
buf
[3];

290 
pBuf
[3] = 
buf
[2];

291 
pBuf
[4] = 
buf
[5];

292 
pBuf
[5] = 
buf
[4];

296 
vÆ
 = 
HAL_GYRO_PWR_MGM_SLEEP
;

297 
suc˚ss
 = 
	`HÆSís‹WrôeReg
(
HAL_GYRO_REG_PWR_MGM
,&
vÆ
,1);

298 
mSètus
 = 
HAL_GYRO_SLEEP
;

300  
suc˚ss
;

301 
	}
}

311 
boﬁ
 
	$HÆGyroWakeUp
()

313 
	`HÆGyroSñe˘
();

315 
mSètus
 = 
HAL_GYRO_DATA_READY
;

318  
	`HÆSís‹WrôeReg
(
HAL_GYRO_REG_PWR_MGM
,&
cfgOn
,1);

319 
	}
}

329 
uöt8
 
	$HÆGyroSètus
()

331  
mSètus
;

332 
	}
}

346 
	$HÆGyroSñe˘Axes
(
uöt8
 
axes
)

348 
mDißbÀdAxes
 = 
HAL_GYRO_PWR_MGM_STBY_ALL
;

350 if(
axes
 & 0x01)

352 
mDißbÀdAxes
 ^
HAL_GYRO_PWR_MGM_STBY_XG
;

355 if(
axes
 & 0x02)

357 
mDißbÀdAxes
 ^
HAL_GYRO_PWR_MGM_STBY_YG
;

360 if(
axes
 & 0x04)

362 
mDißbÀdAxes
 ^
HAL_GYRO_PWR_MGM_STBY_ZG
;

365 if(
	`HÆGyroSètus
(Ë!
HAL_GYRO_STOPPED
)

367 
	`HÆGyroTu∫On
();

369 
	}
}

378 
boﬁ
 
	$HÆGyroTe°
()

380 
uöt8
 
vÆ
;

382 
	`HÆGyroSñe˘
();

385 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
HAL_GYRO_REG_WHOAMI
, &
vÆ
, 1));

386 
	`ST_ASSERT
((
vÆ
&
HAL_GYRO_I2C_ADDRESS
) == HAL_GYRO_I2C_ADDRESS);

388  
TRUE
;

389 
	}
}

403 
	$HÆGyroSñe˘
()

406 
	`HÆI2CInô
(
HAL_GYRO_I2C_ADDRESS
, 
i2cClock_533KHZ
);

407 
	}
}

	@Components/hal/target/CC2541ST/hal_gyro.h

40 #i‚de‡
HAL_GYRO_H


41 
	#HAL_GYRO_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"comdef.h
"

58 
	#HAL_GYRO_STOPPED
 0x00

	)

59 
	#HAL_GYRO_SLEEP
 0x01

	)

60 
	#HAL_GYRO_DATA_READY
 0x02

	)

61 
	#HAL_GYRO_STATE_ERROR
 0xFF

	)

70 
HÆGyroInô
();

71 
HÆGyroTu∫On
();

72 
HÆGyroTu∫Off
();

73 
boﬁ
 
HÆGyroWakeUp
();

74 
boﬁ
 
HÆGyroRód
(
uöt8
 *
úTempD©a
);

75 
boﬁ
 
HÆGyroTe°
();

76 
HÆGyroSñe˘Axes
(
uöt8
 
axes
);

77 
uöt8
 
HÆGyroSètus
();

79 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_humi.c

45 
	~"hÆ_humi.h
"

46 
	~"hÆ_£ns‹.h
"

47 
	~"hÆ_i2c.h
"

55 
	#HAL_SHT21_I2C_ADDRESS
 0x40

	)

57 
	#S_REG_LEN
 2

	)

58 
	#DATA_LEN
 3

	)

61 
	#SHT21_CMD_TEMP_T_H
 0xE3

62 
	#SHT21_CMD_HUMI_T_H
 0xE5

63 
	#SHT21_CMD_TEMP_T_NH
 0xF3

64 
	#SHT21_CMD_HUMI_T_NH
 0xF5

65 
	#SHT21_CMD_WRITE_U_R
 0xE6

66 
	#SHT21_CMD_READ_U_R
 0xE7

67 
	#SHT21_CMD_SOFT_RST
 0xFE

68 

	)

69 
	#HUMIDITY
 0x00

	)

70 
	#TEMPERATURE
 0x01

	)

72 
	#USR_REG_MASK
 0x38

73 
	#USR_REG_DEFAULT
 0x02

74 
	#USR_REG_RES_MASK
 0x7E

75 
	#USR_REG_11BITRES
 0x81

76 

	)

86 
HÆHumiSñe˘
();

87 
boﬁ
 
HÆHumiRódD©a
(
uöt8
 *
pBuf
,uöt8 
nByãs
);

88 
boﬁ
 
HÆHumiWrôeCmd
(
uöt8
 
cmd
);

94 
uöt8
 
	gu§
;

95 
uöt8
 
	gbuf
[6];

96 
boﬁ
 
	gsuc˚ss
;

105 
	$HÆHumiInô
()

107 
	`HÆHumiSñe˘
();

110 
	`HÆSís‹RódReg
(
SHT21_CMD_READ_U_R
,&
u§
,1);

111 
u§
 &
USR_REG_RES_MASK
;

112 
u§
 |
USR_REG_11BITRES
;

113 
	`HÆSís‹WrôeReg
(
SHT21_CMD_WRITE_U_R
,&
u§
,1);

114 
suc˚ss
 = 
FALSE
;

115 
	}
}

125 
boﬁ
 
	$HÆHumiExecMósuªmítSãp
(
uöt8
 
°©e
)

127 
	`HÆHumiSñe˘
();

129 
°©e
)

133 
	`HÆDcDcC⁄åﬁ
(
ST_HUMID
,
åue
);

136 
suc˚ss
 = 
	`HÆHumiWrôeCmd
(
SHT21_CMD_TEMP_T_NH
);

141 i‡(
suc˚ss
)

143 
suc˚ss
 = 
	`HÆHumiRódD©a
(
buf
, 
DATA_LEN
);

146 i‡(
suc˚ss
)

148 
suc˚ss
 = 
	`HÆHumiWrôeCmd
(
SHT21_CMD_HUMI_T_NH
);

155 i‡(
suc˚ss
)

157 
suc˚ss
 = 
	`HÆHumiRódD©a
(
buf
+
DATA_LEN
, DATA_LEN);

161 
	`HÆDcDcC⁄åﬁ
(
ST_HUMID
,
Ál£
);

165  
suc˚ss
;

166 
	}
}

176 
boﬁ
 
	$HÆHumiRódMósuªmít
(
uöt8
 *
pBuf
)

179 
pBuf
[0] = 
buf
[1];

180 
pBuf
[1] = 
buf
[0];

183 
pBuf
[2] = 
buf
[4];

184 
pBuf
[3] = 
buf
[3];

186  
suc˚ss
;

187 
	}
}

198 
boﬁ
 
	$HÆHumiTe°
()

200 
uöt8
 
vÆ
;

202 
	`HÆHumiSñe˘
();

205 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
SHT21_CMD_READ_U_R
,&
vÆ
,1));

206 
	`ST_ASSERT
(
vÆ
==
u§
);

208  
TRUE
;

209 
	}
}

224 
	$HÆHumiSñe˘
()

227 
	`HÆI2CInô
(
HAL_SHT21_I2C_ADDRESS
,
i2cClock_267KHZ
);

228 
	}
}

240 
boﬁ
 
	$HÆHumiWrôeCmd
(
uöt8
 
cmd
)

243  
	`HÆI2CWrôe
(1,&
cmd
) == 1;

244 
	}
}

258 
boﬁ
 
	$HÆHumiRódD©a
(
uöt8
 *
pBuf
, uöt8 
nByãs
)

261  
	`HÆI2CRód
(
nByãs
,
pBuf
 ) ==ÇBytes;

262 
	}
}

	@Components/hal/target/CC2541ST/hal_humi.h

38 #i‚de‡
HAL_HUMI_H


39 
	#HAL_HUMI_H


	)

41 #ifde‡
__˝lu•lus


49 
	~"hÆ_ty≥s.h
"

54 
	#HAL_HUM_MEAS_STATE_1
 0

55 
	#HAL_HUM_MEAS_STATE_2
 1

56 
	#HAL_HUM_MEAS_STATE_3
 2

57 

	)

61 
HÆHumiInô
();

62 
boﬁ
 
HÆHumiExecMósuªmítSãp
(
uöt8
 
°©e
);

63 
boﬁ
 
HÆHumiRódMósuªmít
(
uöt8
 *
pBuf
);

64 
boﬁ
 
HÆHumiTe°
();

68 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_i2c.c

45 
	~"hÆ_as£π.h
"

46 
	~"hÆ_bﬂrd_cfg.h
"

47 
	~"hÆ_i2c.h
"

53 
	#I2C_ENS1
 
	`BV
(6)

	)

54 
	#I2C_STA
 
	`BV
(5)

	)

55 
	#I2C_STO
 
	`BV
(4)

	)

56 
	#I2C_SI
 
	`BV
(3)

	)

57 
	#I2C_AA
 
	`BV
(2)

	)

58 
	#I2C_MST_RD_BIT
 
	`BV
(0)

59 

	)

60 
	#I2C_CLOCK_MASK
 0x83

	)

62 
	#I2C_PXIFG
 
P2IFG


	)

63 
	#I2C_IF
 
P2IF


	)

64 
	#I2C_IE
 
	`BV
(1)

	)

74 
	mm°Sèπed
 = 0x08,

75 
	mm°RïSèπ
 = 0x10,

76 
	mm°AddrAckW
 = 0x18,

77 
	mm°AddrNackW
 = 0x20,

78 
	mm°D©aAckW
 = 0x28,

79 
	mm°D©aNackW
 = 0x30,

80 
	mm°Lo°Arb
 = 0x38,

81 
	mm°AddrAckR
 = 0x40,

82 
	mm°AddrNackR
 = 0x48,

83 
	mm°D©aAckR
 = 0x50,

84 
	mm°D©aNackR
 = 0x58,

85 } 
	ti2cSètus_t
;

92 
	#I2C_WRAPPER_DISABLE
(Ë
	`°
–
I2CWC
 = 0x00; )

	)

93 
	#I2C_CLOCK_RATE
(
x
Ë
	`°
–
I2CCFG
 &~
I2C_CLOCK_MASK
; \

94 
I2CCFG
 |
x
; )

	)

95 
	#I2C_SET_NACK
(Ë
	`°
–
I2CCFG
 &~
I2C_AA
; )

	)

96 
	#I2C_SET_ACK
(Ë
	`°
–
I2CCFG
 |
I2C_AA
; )

	)

99 
	#I2C_ENABLE
(Ë
	`°
–
I2CCFG
 |(
I2C_ENS1
); )

	)

100 
	#I2C_DISABLE
(Ë
	`°
–
I2CCFG
 &~(
I2C_ENS1
); )

	)

103 
	#I2C_STRT
(Ë
	`°
 ( \

104 
I2CCFG
 &~
I2C_SI
; \

105 
I2CCFG
 |
I2C_STA
; \

106 (
I2CCFG
 & 
I2C_SI
) == 0); \

107 
I2CCFG
 &~
I2C_STA
; \

108 )

	)

111 
	#I2C_STOP
(Ë
	`°
 ( \

112 
I2CCFG
 |
I2C_STO
; \

113 
I2CCFG
 &~
I2C_SI
; \

114 (
I2CCFG
 & 
I2C_STO
) != 0); \

115 )

	)

118 
	#I2C_READ
(
_X_
Ë
	`°
 ( \

119 
I2CCFG
 &~
I2C_SI
; \

120 (
I2CCFG
 & 
I2C_SI
) == 0); \

121 (
_X_
Ë
I2CDATA
; \

122 )

	)

125 
	#I2C_WRITE
(
_X_
Ë
	`°
 ( \

126 
I2CDATA
 = (
_X_
); \

127 
I2CCFG
 &~
I2C_SI
; \

128 (
I2CCFG
 & 
I2C_SI
) == 0); \

129 )

	)

136 
uöt8
 
	gi2cAddr
;

149 
uöt8
 
	$i2cM°Såt
(
uöt8
 
RD_WRn
)

151 
	`I2C_STRT
();

153 i‡(
I2CSTAT
 =
m°Sèπed
)

155 
	`I2C_WRITE
(
i2cAddr
 | 
RD_WRn
);

158  
I2CSTAT
;

159 
	}
}

177 
	$HÆI2CInô
(
uöt8
 
addªss
, 
i2cClock_t
 
˛ockR©e
)

179 
i2cAddr
 = 
addªss
 << 1;

181 
	`I2C_WRAPPER_DISABLE
();

182 
I2CADDR
 = 0;

183 
	`I2C_CLOCK_RATE
(
˛ockR©e
);

184 
	`I2C_ENABLE
();

185 
	}
}

203 
uöt8
 
	$HÆI2CRód
(
uöt8
 
Àn
, uöt8 *
pBuf
)

205 
uöt8
 
˙t
 = 0;

207 i‡(
	`i2cM°Såt
(
I2C_MST_RD_BIT
Ë!
m°AddrAckR
)

209 
Àn
 = 0;

215 i‡(
Àn
 > 1)

217 
	`I2C_SET_ACK
();

220 
Àn
 > 0)

223 i‡(
Àn
 == 1)

225 
	`I2C_SET_NACK
();

229 
	`I2C_READ
(*
pBuf
++);

230 
˙t
++;

231 
Àn
--;

233 i‡(
I2CSTAT
 !
m°D©aAckR
)

235 i‡(
I2CSTAT
 !
m°D©aNackR
)

238 
˙t
--;

243 
	`I2C_STOP
();

245  
˙t
;

246 
	}
}

264 
uöt8
 
	$HÆI2CWrôe
(
uöt8
 
Àn
, uöt8 *
pBuf
)

266 i‡(
	`i2cM°Såt
(0Ë!
m°AddrAckW
)

268 
Àn
 = 0;

271 
uöt8
 
˙t
 = 0; c¡ < 
Àn
; cnt++)

273 
	`I2C_WRITE
(*
pBuf
++);

275 i‡(
I2CSTAT
 !
m°D©aAckW
)

277 i‡(
I2CSTAT
 =
m°D©aNackW
)

279 
Àn
 = 
˙t
 + 1;

283 
Àn
 = 
˙t
;

289 
	`I2C_STOP
();

291  
Àn
;

292 
	}
}

309 
	$HÆI2CDißbÀ
()

311 
	`I2C_DISABLE
();

312 
	}
}

	@Components/hal/target/CC2541ST/hal_i2c.h

39 #i‚de‡
HAL_I2C_H


40 
	#HAL_I2C_H


	)

46 
	~"comdef.h
"

52 
	#HAL_I2C_SLAVE_ADDR_DEF
 0x41

	)

60 
	mi2cClock_123KHZ
 = 0x00,

61 
	mi2cClock_144KHZ
 = 0x01,

62 
	mi2cClock_165KHZ
 = 0x02,

63 
	mi2cClock_197KHZ
 = 0x03,

64 
	mi2cClock_33KHZ
 = 0x80,

65 
	mi2cClock_267KHZ
 = 0x81,

66 
	mi2cClock_533KHZ
 = 0x82

67 } 
	ti2cClock_t
;

74 
HÆI2CInô
(
uöt8
 
addªss
, 
i2cClock_t
 
˛ockR©e
);

75 
uöt8
 
HÆI2CRód
(uöt8 
Àn
, uöt8 *
pBuf
);

76 
uöt8
 
HÆI2CWrôe
(uöt8 
Àn
, uöt8 *
pBuf
);

77 
HÆI2CDißbÀ
();

	@Components/hal/target/CC2541ST/hal_interrupt.c

44 
	~"hÆ_keys.h
"

45 
	~"hÆ_acc.h
"

46 
	~"hÆ_mag.h
"

47 
	~"hÆ_i2c.h
"

52 
	$HAL_ISR_FUNCTION
–
hÆKeyP‹t0I§
, 
P0INT_VECTOR
 )

55 
	`HAL_ENTER_ISR
();

56 i‡(
HAL_KEY_SW_1_PXIFG
 & 
HAL_KEY_SW_1_BIT
)

58 
	`hÆPro˚ssKeyI¡îru±
();

65 
P0IFG
 = 0;

66 
P0IF
 = 0;

67 
	`HAL_EXIT_ISR
();

68 
	}
}

76 
	$HAL_ISR_FUNCTION
–
hÆKeyP‹t1I§
, 
P1INT_VECTOR
 )

78 
	`HAL_ENTER_ISR
();

79 i‡((
HAL_KEY_SW_2_PXIFG
 & 
HAL_KEY_SW_2_BIT
Ë|| (
HAL_KEY_SW_3_PXIFG
 & 
HAL_KEY_SW_3_BIT
))

81 
	`hÆPro˚ssKeyI¡îru±
();

87 
HAL_KEY_SW_2_PXIFG
 = 0;

88 
HAL_KEY_SW_3_PXIFG
 = 0;

89 
P1IF
 = 0;

90 
	`HAL_EXIT_ISR
();

91 
	}
}

100 
	$HAL_ISR_FUNCTION
–
hÆI2CI§
, 
I2C_VECTOR
 )

102 
	`HAL_ENTER_ISR
();

109 
P2IFG
 = 0;

110 
P2IF
 = 0;

112 
	`HAL_EXIT_ISR
();

113 
	}
}

	@Components/hal/target/CC2541ST/hal_irtemp.c

44 
	~"hÆ_úãmp.h
"

45 
	~"hÆ_i2c.h
"

46 
	~"hÆ_£ns‹.h
"

54 
	#TMP006_I2C_ADDRESS
 0x44

	)

57 
	#TMP006_REG_ADDR_VOLTAGE
 0x00

	)

58 
	#TMP006_REG_ADDR_TEMPERATURE
 0x01

	)

59 
	#TMP006_REG_ADDR_CONFIG
 0x02

	)

60 
	#TMP006_REG_MANF_ID
 0xFE

	)

61 
	#TMP006_REG_PROD_ID
 0xFE

	)

64 
	#TMP006_VAL_CONFIG_RESET
 0x7400

65 
	#TMP006_VAL_CONFIG_ON
 0x7000

66 
	#TMP006_VAL_CONFIG_OFF
 0x0000

67 
	#TMP006_VAL_MANF_ID
 0x5449

68 
	#TMP006_VAL_PROD_ID
 0x0067

69 

	)

71 
	#DATA_RDY_BIT
 0x8000

72 

	)

74 
	#IRTEMP_REG_LEN
 2

	)

81 
HÆIRTempSñe˘
();

88 
IRTem≥øtuª_Sèãs_t
 
	gútSís‹Sèã
 = 
TMP006_OFF
;

90 
uöt8
 
	gc⁄figSís‹Re£t
[2] = {0x80, 0x00};

91 
uöt8
 
	gc⁄figSís‹Off
[2] = {0x00, 0x80};

92 
uöt8
 
	gc⁄figSís‹On
[2] = {0x70, 0x00};

107 
	$HALIRTempInô
()

109 
útSís‹Sèã
 = 
TMP006_OFF
;

110 
	`HÆIRTempTu∫Off
();

111 
	}
}

121 
	$HÆIRTempTu∫On
()

123 
	`HÆDcDcC⁄åﬁ
(
ST_IRTEMP
,
åue
);

124 
	`HÆIRTempSñe˘
();

126 i‡(
	`HÆSís‹WrôeReg
(
TMP006_REG_ADDR_CONFIG
, 
c⁄figSís‹On
, 
IRTEMP_REG_LEN
))

128 
útSís‹Sèã
 = 
TMP006_IDLE
;

130 
	}
}

139 
	$HÆIRTempTu∫Off
()

141 
	`HÆIRTempSñe˘
();

143 i‡(
	`HÆSís‹WrôeReg
(
TMP006_REG_ADDR_CONFIG
, 
c⁄figSís‹Off
, 
IRTEMP_REG_LEN
))

145 
útSís‹Sèã
 = 
TMP006_OFF
;

147 
	`HÆDcDcC⁄åﬁ
(
ST_IRTEMP
,
Ál£
);

148 
	}
}

159 
boﬁ
 
	$HÆIRTempRód
(
uöt8
 *
pBuf
)

161 
uöt16
 
v
;

162 
uöt16
 
t
;

163 
boﬁ
 
suc˚ss
;

165 i‡(
útSís‹Sèã
 !
TMP006_DATA_READY
)

167  
FALSE
;

170 
	`HÆIRTempSñe˘
();

173 
suc˚ss
 = 
	`HÆSís‹RódReg
(
TMP006_REG_ADDR_VOLTAGE
, (
uöt8
 *)&
v
,
IRTEMP_REG_LEN
 );

174 i‡(
suc˚ss
)

176 
suc˚ss
 = 
	`HÆSís‹RódReg
(
TMP006_REG_ADDR_TEMPERATURE
, (
uöt8
 *)&
t
,
IRTEMP_REG_LEN
 );

179 i‡(
suc˚ss
)

182 
pBuf
[0] = 
	`HI_UINT16
–
v
 );

183 
pBuf
[1] = 
	`LO_UINT16
–
v
 );

184 
pBuf
[2] = 
	`HI_UINT16
–
t
 );

185 
pBuf
[3] = 
	`LO_UINT16
–
t
 );

189 i‡(
	`HÆSís‹WrôeReg
(
TMP006_REG_ADDR_CONFIG
, 
c⁄figSís‹Off
, 
IRTEMP_REG_LEN
))

191 
útSís‹Sèã
 = 
TMP006_OFF
;

193 
	`HÆDcDcC⁄åﬁ
(
ST_IRTEMP
,
Ál£
);

195  
suc˚ss
;

196 
	}
}

206 
IRTem≥øtuª_Sèãs_t
 
	$HÆIRTempSètus
()

208 i‡(
útSís‹Sèã
 !
TMP006_OFF
)

210 
boﬁ
 
suc˚ss
;

211 
uöt16
 
v
;

214 
	`HÆIRTempSñe˘
();

217 
suc˚ss
 = 
	`HÆSís‹RódReg
(
TMP006_REG_ADDR_CONFIG
, (
uöt8
 *)&
v
,
IRTEMP_REG_LEN
 );

218 i‡((
v
 & 
DATA_RDY_BIT
Ë&& 
suc˚ss
)

220 
útSís‹Sèã
 = 
TMP006_DATA_READY
;

224  
útSís‹Sèã
;

225 
	}
}

235 
boﬁ
 
	$HÆIRTempTe°
()

237 
uöt16
 
vÆ
;

240 
	`HÆIRTempSñe˘
();

243 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
TMP006_REG_MANF_ID
, (
uöt8
 *)&
vÆ
, 
IRTEMP_REG_LEN
));

244 
vÆ
 = (
	`LO_UINT16
(vÆË<< 8Ë| 
	`HI_UINT16
(val);

245 
	`ST_ASSERT
(
vÆ
 =
TMP006_VAL_MANF_ID
);

248 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
TMP006_REG_ADDR_CONFIG
, 
c⁄figSís‹Re£t
, 
IRTEMP_REG_LEN
));

251 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
TMP006_REG_ADDR_CONFIG
, (
uöt8
 *)&
vÆ
, 
IRTEMP_REG_LEN
));

252 
vÆ
 = ((
	`LO_UINT16
(vÆË<< 8Ë| 
	`HI_UINT16
(val));

253 
	`ST_ASSERT
(
vÆ
 =
TMP006_VAL_CONFIG_RESET
);

256 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
TMP006_REG_ADDR_CONFIG
, 
c⁄figSís‹Off
,
IRTEMP_REG_LEN
));

259 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
TMP006_REG_ADDR_CONFIG
, (
uöt8
 *)&
vÆ
, 
IRTEMP_REG_LEN
));

260 
vÆ
 = ((
	`LO_UINT16
(vÆË<< 8Ë| 
	`HI_UINT16
(val));

261 
	`ST_ASSERT
(
vÆ
 =
TMP006_VAL_CONFIG_OFF
);

264 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
TMP006_REG_ADDR_CONFIG
, 
c⁄figSís‹On
, 
IRTEMP_REG_LEN
));

267 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
TMP006_REG_ADDR_CONFIG
, (
uöt8
 *)&
vÆ
, 
IRTEMP_REG_LEN
));

268 
vÆ
 = ((
	`LO_UINT16
(vÆË<< 8Ë| 
	`HI_UINT16
(val));

269 
	`ST_ASSERT
(
vÆ
 =
TMP006_VAL_CONFIG_ON
);

272 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
TMP006_REG_ADDR_CONFIG
, 
c⁄figSís‹Off
, 
IRTEMP_REG_LEN
));

274  
TRUE
;

275 
	}
}

289 
	$HÆIRTempSñe˘
()

292 
	`HÆI2CInô
(
TMP006_I2C_ADDRESS
, 
i2cClock_533KHZ
);

293 
	}
}

	@Components/hal/target/CC2541ST/hal_irtemp.h

39 #i‚de‡
HAL_IRTEMP_H


40 
	#HAL_IRTEMP_H


	)

42 #ifde‡
__˝lu•lus


50 
	~"comdef.h
"

62 
TMP006_OFF
,

63 
TMP006_IDLE
,

64 
TMP006_DATA_READY


65 } 
	tIRTem≥øtuª_Sèãs_t
;

71 
HALIRTempInô
();

72 
HÆIRTempTu∫On
();

73 
HÆIRTempTu∫Off
();

74 
boﬁ
 
HÆIRTempRód
(
uöt8
 *
úTempD©a
);

75 
boﬁ
 
HÆIRTempTe°
();

76 
IRTem≥øtuª_Sèãs_t
 
HÆIRTempSètus
();

79 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_keys.c

83 
	~"hÆ_mcu.h
"

84 
	~"hÆ_defs.h
"

85 
	~"hÆ_ty≥s.h
"

86 
	~"hÆ_drivîs.h
"

87 
	~"hÆ_adc.h
"

88 
	~"hÆ_keys.h
"

89 
	~"oßl.h
"

91 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

114 
uöt8
 
	ghÆKeySavedKeys
;

115 
hÆKeyCBack_t
 
	gpHÆKeyPro˚ssFun˘i⁄
;

116 
uöt8
 
	gHÆKeyC⁄figuªd
;

117 
boﬁ
 
	gHÆ_KeyI¡E«bÀ
;

139 
	$HÆKeyInô
( )

142 
hÆKeySavedKeys
 = 0;

144 
HAL_KEY_SW_1_SEL
 &~(
HAL_KEY_SW_1_BIT
);

145 
HAL_KEY_SW_1_DIR
 &~(
HAL_KEY_SW_1_BIT
);

147 
HAL_KEY_SW_2_SEL
 &~(
HAL_KEY_SW_2_BIT
);

148 
HAL_KEY_SW_2_DIR
 &~(
HAL_KEY_SW_2_BIT
);

150 
HAL_KEY_SW_3_SEL
 &~(
HAL_KEY_SW_3_BIT
);

151 
HAL_KEY_SW_3_DIR
 &~(
HAL_KEY_SW_3_BIT
);

155 
pHÆKeyPro˚ssFun˘i⁄
 = 
NULL
;

158 
HÆKeyC⁄figuªd
 = 
FALSE
;

159 
	}
}

172 
	$HÆKeyC⁄fig
 (
boﬁ
 
öãºu±E«bÀ
, 
hÆKeyCBack_t
 
cback
)

175 
HÆ_KeyI¡E«bÀ
 = 
öãºu±E«bÀ
;

178 
pHÆKeyPro˚ssFun˘i⁄
 = 
cback
;

181 i‡(
HÆ_KeyI¡E«bÀ
)

184 
PICTL
 |(
HAL_KEY_SW_1_EDGEBIT
 | 
HAL_KEY_SW_2_3_EDGEBIT
);

186 
HAL_KEY_SW_1_ICTL
 |
HAL_KEY_SW_1_ICTLBIT
;

187 
HAL_KEY_SW_1_IEN
 |
HAL_KEY_SW_1_IENBIT
;

188 
HAL_KEY_SW_1_PXIFG
 = ~(
HAL_KEY_SW_1_BIT
);

190 
HAL_KEY_SW_2_ICTL
 |
HAL_KEY_SW_2_ICTLBIT
;

191 
HAL_KEY_SW_2_IEN
 |
HAL_KEY_SW_2_IENBIT
;

192 
HAL_KEY_SW_2_PXIFG
 = ~(
HAL_KEY_SW_2_BIT
);

194 
HAL_KEY_SW_3_ICTL
 |
HAL_KEY_SW_3_ICTLBIT
;

195 
HAL_KEY_SW_3_IEN
 |
HAL_KEY_SW_3_IENBIT
;

196 
HAL_KEY_SW_3_PXIFG
 = (
uöt8
)(~(
HAL_KEY_SW_3_BIT
));

199 i‡(
HÆKeyC⁄figuªd
 =
TRUE
)

201 
	`oßl_°›_timîEx
(
HÆ_TaskID
, 
HAL_KEY_EVENT
);

206 
HAL_KEY_SW_1_ICTL
 &~(
HAL_KEY_SW_1_ICTLBIT
);

207 
HAL_KEY_SW_1_IEN
 &~(
HAL_KEY_SW_1_IENBIT
);

209 
HAL_KEY_SW_2_ICTL
 &~(
HAL_KEY_SW_2_ICTLBIT
);

210 
HAL_KEY_SW_2_IEN
 &~(
HAL_KEY_SW_2_IENBIT
);

212 
HAL_KEY_SW_3_ICTL
 &~(
HAL_KEY_SW_3_ICTLBIT
);

213 
HAL_KEY_SW_3_IEN
 &~(
HAL_KEY_SW_3_IENBIT
);

215 
	`oßl_£t_evít
(
HÆ_TaskID
, 
HAL_KEY_EVENT
);

219 
HÆKeyC⁄figuªd
 = 
TRUE
;

220 
	}
}

232 
uöt8
 
	$HÆKeyRód
 ( )

234 
uöt8
 
keys
 = 0;

236 i‡(!(
HAL_KEY_SW_1_PORT
 & 
HAL_KEY_SW_1_BIT
))

238 
keys
 |
HAL_KEY_SW_1
;

240 i‡(!(
HAL_KEY_SW_2_PORT
 & 
HAL_KEY_SW_2_BIT
))

242 
keys
 |
HAL_KEY_SW_2
;

244 i‡(!(
HAL_KEY_SW_3_PORT
 & 
HAL_KEY_SW_3_BIT
))

246 
keys
 |
HAL_KEY_SW_3
;

249  
keys
;

250 
	}
}

262 
	$HÆKeyPﬁl
 ()

264 
uöt8
 
keys
 = 0;

265 
uöt8
 
nŸify
 = 0;

267 i‡(!(
HAL_KEY_SW_1_PORT
 & 
HAL_KEY_SW_1_BIT
))

269 
keys
 |
HAL_KEY_SW_1
;

271 i‡(!(
HAL_KEY_SW_2_PORT
 & 
HAL_KEY_SW_2_BIT
))

273 
keys
 |
HAL_KEY_SW_2
;

275 i‡(!(
HAL_KEY_SW_3_PORT
 & 
HAL_KEY_SW_3_BIT
))

277 
keys
 |
HAL_KEY_SW_3
;

280 (Ë
keys
;

285 i‡(!
HÆ_KeyI¡E«bÀ
)

287 i‡(
keys
 =
hÆKeySavedKeys
)

294 
nŸify
 = 1;

300 i‡(
keys
)

302 
nŸify
 = 1;

307 
hÆKeySavedKeys
 = 
keys
;

310 i‡(
nŸify
 && (
pHÆKeyPro˚ssFun˘i⁄
))

312 (
pHÆKeyPro˚ssFun˘i⁄
Ë(
keys
, 
HAL_KEY_STATE_NORMAL
);

315 
	}
}

327 
	$hÆPro˚ssKeyI¡îru±
 ()

329 
boﬁ
 
vÆid
=
FALSE
;

331 if–
HAL_KEY_SW_1_PXIFG
 & 
HAL_KEY_SW_1_BIT
)

333 
HAL_KEY_SW_1_PXIFG
 = ~(
HAL_KEY_SW_1_BIT
);

334 
vÆid
 = 
TRUE
;

337 i‡(
HAL_KEY_SW_2_PXIFG
 & 
HAL_KEY_SW_2_BIT
)

339 
HAL_KEY_SW_2_PXIFG
 = ~(
HAL_KEY_SW_2_BIT
);

340 
vÆid
 = 
TRUE
;

342 i‡(
HAL_KEY_SW_3_PXIFG
 & 
HAL_KEY_SW_3_BIT
)

344 
HAL_KEY_SW_3_PXIFG
 = (
uöt8
)(~(
HAL_KEY_SW_3_BIT
));

345 
vÆid
 = 
TRUE
;

348 i‡(
vÆid
)

350 
	`oßl_°¨t_timîEx
 (
HÆ_TaskID
, 
HAL_KEY_EVENT
, 
HAL_KEY_DEBOUNCE_VALUE
);

352 
	}
}

363 
	$HÆKeyE¡îSÀï
 ( )

365 
	}
}

376 
uöt8
 
	$HÆKeyExôSÀï
 ( )

379  ( 
	`HÆKeyRód
 () );

380 
	}
}

385 
	$HÆKeyInô
(){
	}
}

386 
	$HÆKeyC⁄fig
(
boﬁ
 
öãºu±E«bÀ
, 
hÆKeyCBack_t
 
cback
){
	}
}

387 
uöt8
 
	$HÆKeyRód
(){  0;
	}
}

388 
	$HÆKeyPﬁl
(){
	}
}

	@Components/hal/target/CC2541ST/hal_keys.h

40 #i‚de‡
HAL_KEYS_H


41 
	#HAL_KEYS_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"hÆ_bﬂrd.h
"

62 
	#HAL_KEY_INTERRUPT_DISABLE
 0x00

	)

63 
	#HAL_KEY_INTERRUPT_ENABLE
 0x01

	)

66 
	#HAL_KEY_STATE_NORMAL
 0x00

	)

67 
	#HAL_KEY_STATE_SHIFT
 0x01

	)

70 
	#HAL_KEY_SW_1
 0x01

71 
	#HAL_KEY_SW_2
 0x02

72 
	#HAL_KEY_SW_3
 0x04

73 

	)

74 
	#HAL_KEY_DEBOUNCE_VALUE
 25

	)

77 
	#HAL_KEY_CPU_PORT_0_IF
 
P0IF


	)

78 
	#HAL_KEY_CPU_PORT_2_IF
 
P2IF


	)

81 
	#HAL_KEY_SW_1_PORT
 
P0


	)

82 
	#HAL_KEY_SW_1_BIT
 
	`BV
(0)

	)

83 
	#HAL_KEY_SW_1_SEL
 
P0SEL


	)

84 
	#HAL_KEY_SW_1_DIR
 
P0DIR


	)

87 
	#HAL_KEY_SW_2_PORT
 
P1


	)

88 
	#HAL_KEY_SW_2_BIT
 
	`BV
(6)

	)

89 
	#HAL_KEY_SW_2_SEL
 
P1SEL


	)

90 
	#HAL_KEY_SW_2_DIR
 
P1DIR


	)

93 
	#HAL_KEY_SW_3_PORT
 
P1


	)

94 
	#HAL_KEY_SW_3_BIT
 
	`BV
(7)

	)

95 
	#HAL_KEY_SW_3_SEL
 
P1SEL


	)

96 
	#HAL_KEY_SW_3_DIR
 
P1DIR


	)

99 
	#HAL_KEY_SW_1_IEN
 
IEN1


	)

100 
	#HAL_KEY_SW_1_ICTL
 
P0IEN


	)

101 
	#HAL_KEY_SW_1_ICTLBIT
 
	`BV
(0Ë

	)

102 
	#HAL_KEY_SW_1_IENBIT
 
	`BV
(5Ë

	)

103 
	#HAL_KEY_SW_1_PXIFG
 
P0IFG


	)

105 
	#HAL_KEY_SW_2_IEN
 
IEN2


	)

106 
	#HAL_KEY_SW_2_ICTL
 
P1IEN


	)

107 
	#HAL_KEY_SW_2_ICTLBIT
 
	`BV
(6Ë

	)

108 
	#HAL_KEY_SW_2_IENBIT
 
	`BV
(4Ë

	)

109 
	#HAL_KEY_SW_2_PXIFG
 
P1IFG


	)

111 
	#HAL_KEY_SW_3_IEN
 
IEN2


	)

112 
	#HAL_KEY_SW_3_ICTL
 
P1IEN


	)

113 
	#HAL_KEY_SW_3_ICTLBIT
 
	`BV
(7Ë

	)

114 
	#HAL_KEY_SW_3_IENBIT
 
	`BV
(4Ë

	)

115 
	#HAL_KEY_SW_3_PXIFG
 
P1IFG


	)

117 
	#HAL_KEY_SW_1_EDGEBIT
 
	`BV
(0)

	)

118 
	#HAL_KEY_SW_2_3_EDGEBIT
 
	`BV
(2)

	)

123 (*
hÆKeyCBack_t
Ë(
	tuöt8
 
	tkeys
, uöt8 
	t°©e
);

128 
boﬁ
 
HÆ_KeyI¡E«bÀ
;

137 
HÆKeyInô
( );

142 
HÆKeyC⁄fig
–
boﬁ
 
öãºu±E«bÀ
, c⁄° 
hÆKeyCBack_t
 
cback
);

147 
uöt8
 
HÆKeyRód
( );

152 
HÆKeyE¡îSÀï
 ( );

157 
uöt8
 
HÆKeyExôSÀï
 ( );

162 
HÆKeyPﬁl
 ( );

167 
boﬁ
 
HÆKeyPªs£d
( );

169 
hÆPro˚ssKeyI¡îru±
();

175 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_led.c

43 
	~"hÆ_mcu.h
"

44 
	~"hÆ_defs.h
"

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_drivîs.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"oßl.h
"

49 
	~"hÆ_bﬂrd.h
"

64 
uöt8
 
	mmode
;

65 
uöt8
 
	mtodo
;

66 
uöt8
 
	m⁄P˘
;

67 
uöt16
 
	mtime
;

68 
uöt32
 
	m√xt
;

69 } 
	tHÆLedC⁄åﬁ_t
;

73 
HÆLedC⁄åﬁ_t
 
	mHÆLedC⁄åﬁTabÀ
[
HAL_LED_DEFAULT_MAX_LEDS
];

74 
uöt8
 
	m¶ìpA˘ive
;

75 } 
	tHÆLedSètus_t
;

83 
uöt8
 
	gHÆLedSèã
;

85 #i‡
HAL_LED
 =
TRUE


86 
uöt8
 
	gHÆSÀïLedSèã
;

87 
uöt8
 
	g¥eBlökSèã
;

91 #ifde‡
BLINK_LEDS


92 
HÆLedSètus_t
 
	gHÆLedSètusC⁄åﬁ
;

98 #i‡(
HAL_LED
 =
TRUE
)

99 
HÆLedUpd©e
 ();

100 
HÆLedOnOff
 (
uöt8
 
Àds
, uöt8 
mode
);

116 
	$HÆLedInô
 ()

118 #i‡(
HAL_LED
 =
TRUE
)

120 
	`HÆLedSë
 (
HAL_LED_ALL
, 
HAL_LED_MODE_OFF
);

122 #ifde‡
BLINK_LEDS


124 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
FALSE
;

126 
	}
}

137 
uöt8
 
	$HÆLedSë
 (
uöt8
 
Àds
, uöt8 
mode
)

140 #i‡(
	`deföed
 (
BLINK_LEDS
)Ë&& (
HAL_LED
 =
TRUE
)

141 
uöt8
 
Àd
;

142 
HÆLedC⁄åﬁ_t
 *
°s
;

144 
mode
)

146 
HAL_LED_MODE_BLINK
:

148 
	`HÆLedBlök
 (
Àds
, 1, 
HAL_LED_DEFAULT_DUTY_CYCLE
, 
HAL_LED_DEFAULT_FLASH_TIME
);

151 
HAL_LED_MODE_FLASH
:

153 
	`HÆLedBlök
 (
Àds
, 
HAL_LED_DEFAULT_FLASH_COUNT
, 
HAL_LED_DEFAULT_DUTY_CYCLE
, 
HAL_LED_DEFAULT_FLASH_TIME
);

156 
HAL_LED_MODE_ON
:

157 
HAL_LED_MODE_OFF
:

158 
HAL_LED_MODE_TOGGLE
:

160 
Àd
 = 
HAL_LED_1
;

161 
Àds
 &
HAL_LED_ALL
;

162 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

164 
Àds
)

166 i‡(
Àds
 & 
Àd
)

168 i‡(
mode
 !
HAL_LED_MODE_TOGGLE
)

170 
°s
->
mode
 = mode;

174 
°s
->
mode
 ^
HAL_LED_MODE_ON
;

176 
	`HÆLedOnOff
 (
Àd
, 
°s
->
mode
);

177 
Àds
 ^
Àd
;

179 
Àd
 <<= 1;

180 
°s
++;

188 #ñi‡(
HAL_LED
 =
TRUE
)

189 
	`LedOnOff
(
Àds
, 
mode
);

192 (Ë
Àds
;

193 (Ë
mode
;

196  ( 
HÆLedSèã
 );

198 
	}
}

213 
	$HÆLedBlök
 (
uöt8
 
Àds
, uöt8 
numBlöks
, uöt8 
≥r˚¡
, 
uöt16
 
≥riod
)

215 #i‡(
	`deföed
 (
BLINK_LEDS
)Ë&& (
HAL_LED
 =
TRUE
)

216 
uöt8
 
Àd
;

217 
HÆLedC⁄åﬁ_t
 *
°s
;

219 i‡(
Àds
 && 
≥r˚¡
 && 
≥riod
)

221 i‡(
≥r˚¡
 < 100)

223 
Àd
 = 
HAL_LED_1
;

224 
Àds
 &
HAL_LED_ALL
;

225 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

227 
Àds
)

229 i‡(
Àds
 & 
Àd
)

232 if(
°s
->
mode
 < 
HAL_LED_MODE_BLINK
 )

233 
¥eBlökSèã
 |(
Àd
 & 
HÆLedSèã
);

235 
°s
->
mode
 = 
HAL_LED_MODE_OFF
;

236 
°s
->
time
 = 
≥riod
;

237 
°s
->
⁄P˘
 = 
≥r˚¡
;

238 
°s
->
todo
 = 
numBlöks
;

239 i‡(!
numBlöks
Ë
°s
->
mode
 |
HAL_LED_MODE_FLASH
;

240 
°s
->
√xt
 = 
	`oßl_GëSy°emClock
();

241 
°s
->
mode
 |
HAL_LED_MODE_BLINK
;

242 
Àds
 ^
Àd
;

244 
Àd
 <<= 1;

245 
°s
++;

247 
	`oßl_£t_evít
 (
HÆ_TaskID
, 
HAL_LED_BLINK_EVENT
);

251 
	`HÆLedSë
 (
Àds
, 
HAL_LED_MODE_ON
);

256 
	`HÆLedSë
 (
Àds
, 
HAL_LED_MODE_OFF
);

258 #ñi‡(
HAL_LED
 =
TRUE
)

259 
≥r˚¡
 = (
Àds
 & 
HÆLedSèã
Ë? 
HAL_LED_MODE_OFF
 : 
HAL_LED_MODE_ON
;

260 
	`HÆLedOnOff
 (
Àds
, 
≥r˚¡
);

263 (Ë
Àds
;

264 (Ë
numBlöks
;

265 (Ë
≥r˚¡
;

266 (Ë
≥riod
;

268 
	}
}

270 #i‡(
HAL_LED
 =
TRUE
)

280 
	$HÆLedUpd©e
 ()

282 
uöt8
 
Àd
;

283 
uöt8
 
p˘
;

284 
uöt8
 
Àds
;

285 
HÆLedC⁄åﬁ_t
 *
°s
;

286 
uöt32
 
time
;

287 
uöt16
 
√xt
;

288 
uöt16
 
waô
;

290 
√xt
 = 0;

291 
Àd
 = 
HAL_LED_1
;

292 
Àds
 = 
HAL_LED_ALL
;

293 
°s
 = 
HÆLedSètusC⁄åﬁ
.
HÆLedC⁄åﬁTabÀ
;

296 i‡(!
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
)

298 
Àds
)

300 i‡(
Àds
 & 
Àd
)

302 i‡(
°s
->
mode
 & 
HAL_LED_MODE_BLINK
)

304 
time
 = 
	`oßl_GëSy°emClock
();

305 i‡(
time
 >
°s
->
√xt
)

307 i‡(
°s
->
mode
 & 
HAL_LED_MODE_ON
)

309 
p˘
 = 100 - 
°s
->
⁄P˘
;

310 
°s
->
mode
 &~
HAL_LED_MODE_ON
;

311 
	`HÆLedOnOff
 (
Àd
, 
HAL_LED_MODE_OFF
);

313 i‡(!(
°s
->
mode
 & 
HAL_LED_MODE_FLASH
))

315 
°s
->
todo
--;

316 i‡(!
°s
->
todo
)

318 
°s
->
mode
 ^
HAL_LED_MODE_BLINK
;

324 
p˘
 = 
°s
->
⁄P˘
;

325 
°s
->
mode
 |
HAL_LED_MODE_ON
;

326 
	`HÆLedOnOff
 (
Àd
, 
HAL_LED_MODE_ON
);

329 i‡(
°s
->
mode
 & 
HAL_LED_MODE_BLINK
)

331 
waô
 = (((
uöt32
)
p˘
 * (uöt32)
°s
->
time
) / 100);

332 
°s
->
√xt
 = 
time
 + 
waô
;

337 
waô
 = 0;

339 
	`HÆLedSë
 (
Àd
, ((
¥eBlökSèã
 &Üed)!=0)?
HAL_LED_MODE_ON
:
HAL_LED_MODE_OFF
);

341 
¥eBlökSèã
 &(
Àd
 ^ 0xFF);

346 
waô
 = 
°s
->
√xt
 - 
time
;

349 i‡(!
√xt
 || ( 
waô
 && (wait <Çext) ))

351 
√xt
 = 
waô
;

354 
Àds
 ^
Àd
;

356 
Àd
 <<= 1;

357 
°s
++;

360 i‡(
√xt
)

362 
	`oßl_°¨t_timîEx
(
HÆ_TaskID
, 
HAL_LED_BLINK_EVENT
, 
√xt
);

365 
	}
}

377 
	$HÆLedOnOff
 (
uöt8
 
Àds
, uöt8 
mode
)

379 i‡(
Àds
 & 
HAL_LED_1
)

381 i‡(
mode
 =
HAL_LED_MODE_ON
)

383 
	`HAL_TURN_ON_LED1
();

387 
	`HAL_TURN_OFF_LED1
();

391 i‡(
Àds
 & 
HAL_LED_2
)

393 i‡(
mode
 =
HAL_LED_MODE_ON
)

395 
	`HAL_TURN_ON_LED2
();

399 
	`HAL_TURN_OFF_LED2
();

404 i‡(
mode
)

406 
HÆLedSèã
 |
Àds
;

410 
HÆLedSèã
 &(
Àds
 ^ 0xFF);

412 
	}
}

424 
uöt8
 
	$HÆLedGëSèã
 ()

426 #i‡(
HAL_LED
 =
TRUE
)

427  
HÆLedSèã
;

431 
	}
}

442 
	$HÆLedE¡îSÀï
( )

444 #ifde‡
BLINK_LEDS


446 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
TRUE
;

449 #i‡(
HAL_LED
 =
TRUE
)

451 
HÆSÀïLedSèã
 = 0;

452 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED1
();

453 
HÆSÀïLedSèã
 |
	`HAL_STATE_LED2
() << 1;

456 
	`HÆLedOnOff
 (
HAL_LED_ALL
, 
HAL_LED_MODE_OFF
);

460 
	}
}

471 
	$HÆLedExôSÀï
( )

473 #i‡(
HAL_LED
 =
TRUE
)

476 
	`HÆLedOnOff
(
HÆSÀïLedSèã
, 
HAL_LED_MODE_ON
);

479 
	`HÆLedUpd©e
();

482 #ifde‡
BLINK_LEDS


484 
HÆLedSètusC⁄åﬁ
.
¶ìpA˘ive
 = 
FALSE
;

486 
	}
}

	@Components/hal/target/CC2541ST/hal_mag.c

44 
	~"hÆ_mag.h
"

45 
	~"hÆ_£ns‹.h
"

46 
	~"hÆ_i2c.h
"

52 
	#MAG_REG_READ_ALL_LEN
 6

	)

53 
	#MAG_REG_FAST_READ_LEN
 3

	)

56 
	#MAG_REG_ADDR_DR_STATUS
 0x00

57 
	#MAG_REG_ADDR_X_MSB
 0x01

58 
	#MAG_REG_ADDR_X_LSB
 0x02

59 
	#MAG_REG_ADDR_Y_MSB
 0x03

60 
	#MAG_REG_ADDR_Y_LSB
 0x04

61 
	#MAG_REG_ADDR_Z_MSB
 0x05

62 
	#MAG_REG_ADDR_Z_LSB
 0x06

63 
	#MAG_REG_ADDR_WHO_AM_I
 0x07

64 
	#MAG_REG_ADDR_SYSMOD
 0x08

65 
	#MAG_REG_ADDR_OFF_X_MSB
 0x09

66 
	#MAG_REG_ADDR_OFF_X_LSB
 0x0A

67 
	#MAG_REG_ADDR_OFF_Y_MSB
 0x0B

68 
	#MAG_REG_ADDR_OFF_Y_LSB
 0x0C

69 
	#MAG_REG_ADDR_OFF_Z_MSB
 0x0D

70 
	#MAG_REG_ADDR_OFF_Z_LSB
 0x0E

71 
	#MAG_REG_ADDR_DIE_TEMP
 0x0F

72 
	#MAG_REG_ADDR_CTRL_1
 0x10

73 
	#MAG_REG_ADDR_CTRL_2
 0x11

74 

	)

75 
	#MAG_REG_ADDR_READ_START
 
MAG_REG_ADDR_X_MSB


	)

78 
	#MAG_REG_CTRL_FR
 0x04

79 
	#MAG_REG_CTRL_TM
 0x02

80 
	#MAG_REG_CTRL_EN
 0x01

81 

	)

82 
	#MAG_REG_CTRL_DR_10HZ_OSR_1
 0x60

	)

83 
	#MAG_REG_CTRL_DR_10HZ_OSR_2
 0x48

	)

84 
	#MAG_REG_CTRL_DR_10HZ_OSR_4
 0x30

	)

85 
	#MAG_REG_CTRL_DR_10HZ_OSR_8
 0x10

	)

88 
	#WHO_AM_I_VALUE
 0xC4

	)

89 
	#CTRL1_TEST_VALUE
 0xF8

	)

92 
	#MAG_REG_CTRL_ON
 
MAG_REG_CTRL_DR_10HZ_OSR_1
 | 
MAG_REG_CTRL_EN


	)

93 
	#MAG_REG_CTRL2_AMN
 0x80

	)

94 
	#MAG_REG_CTRL_OFF
 0x00

	)

110 
HÆMagSñe˘
();

116 
Mag√tomëî_Sèãs_t
 
	g£ns‹Sèã
 = 
MAG3110_OFF
;

117 
uöt8
 
	ghÆMagSís‹C⁄fig
 = 
MAG_REG_CTRL_ON
;

118 
uöt8
 
	ghÆMagSís‹Off
 = 
MAG_REG_CTRL_OFF
;

119 
uöt8
 
	ghÆMagAutoMr°En
 = 
MAG_REG_CTRL2_AMN
;

129 
	$HÆMagInô
()

131 
£ns‹Sèã
 = 
MAG3110_OFF
;

132 
	}
}

142 
Mag√tomëî_Sèãs_t
 
	$HÆMagSètus
( )

144 if–
£ns‹Sèã
 =
MAG3110_IDLE
)

146 
uöt8
 
°©us
 = 0;

148 
	`HÆMagSñe˘
();

149 
	`HÆSís‹RódReg
–
MAG_REG_ADDR_DR_STATUS
, &
°©us
, 1);

150 if(
°©us
!=0)

152 
£ns‹Sèã
 = 
MAG3110_DATA_READY
;

156  
£ns‹Sèã
;

157 
	}
}

166 
	$HÆMagTu∫On
()

168 
	`HÆMagSñe˘
();

170 
	`HÆSís‹WrôeReg
(
MAG_REG_ADDR_CTRL_1
, &
hÆMagSís‹C⁄fig
, (halMagSensorConfig));

171 
	`HÆSís‹WrôeReg
(
MAG_REG_ADDR_CTRL_2
, &
hÆMagAutoMr°En
, (halMagAutoMrstEn));

172 
£ns‹Sèã
 = 
MAG3110_IDLE
;

173 
	}
}

183 
	$HÆMagTu∫Off
()

185 
	`HÆMagSñe˘
();

187 
	`HÆSís‹WrôeReg
(
MAG_REG_ADDR_CTRL_1
, &
hÆMagSís‹Off
, (halMagSensorOff));

188 
£ns‹Sèã
 = 
MAG3110_OFF
;

189 
	}
}

201 
boﬁ
 
	$HÆMagRód
(
uöt8
 *
pBuf
)

203 
uöt8
 
tmp
[
MAG_REG_READ_ALL_LEN
];

204 
boﬁ
 
f
;

206 
	`HÆMagSñe˘
();

208 
f
 = 
	`HÆSís‹RódReg
(
MAG_REG_ADDR_READ_START
,
tmp
,
MAG_REG_READ_ALL_LEN
);

209 i‡(
f
)

212 
pBuf
[0] = 
tmp
[1];

213 
pBuf
[1] = 
tmp
[0];

214 
pBuf
[2] = 
tmp
[3];

215 
pBuf
[3] = 
tmp
[2];

216 
pBuf
[4] = 
tmp
[5];

217 
pBuf
[5] = 
tmp
[4];

219 
£ns‹Sèã
 = 
MAG3110_IDLE
;

221  
f
;

222 
	}
}

232 
boﬁ
 
	$HÆMagTe°
()

234 
uöt8
 
vÆ
;

237 
	`HÆMagSñe˘
();

240 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
MAG_REG_ADDR_WHO_AM_I
, &
vÆ
, (val)));

241 
	`ST_ASSERT
(
vÆ
==
WHO_AM_I_VALUE
);

244 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
MAG_REG_ADDR_CTRL_1
, &
vÆ
, (val)));

245 
	`ST_ASSERT
(
vÆ
==
MAG_REG_CTRL_OFF
);

248 
vÆ
 = 
CTRL1_TEST_VALUE
;

249 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
MAG_REG_ADDR_CTRL_1
, &
vÆ
, (val)));

250 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
MAG_REG_ADDR_CTRL_1
, &
vÆ
, (val)));

251 
	`ST_ASSERT
(
vÆ
==
CTRL1_TEST_VALUE
);

254 
vÆ
 = 
MAG_REG_CTRL_OFF
;

255 
	`ST_ASSERT
(
	`HÆSís‹WrôeReg
(
MAG_REG_ADDR_CTRL_1
, &
vÆ
, (val)));

258 
	`ST_ASSERT
(
	`HÆSís‹RódReg
(
MAG_REG_ADDR_SYSMOD
, &
vÆ
, (val)));

259 
	`ST_ASSERT
(
vÆ
==0);

261  
TRUE
;

262 
	}
}

276 
	$HÆMagSñe˘
()

279 
	`HÆI2CInô
(
HAL_MAG3110_I2C_ADDRESS
,
i2cClock_267KHZ
);

280 
	}
}

	@Components/hal/target/CC2541ST/hal_mag.h

38 #i‚de‡
HAL_MAG_H


39 
	#HAL_MAG_H


	)

41 #ifde‡
__˝lu•lus


49 
	~"comdef.h
"

55 
	#HAL_MAG3110_I2C_ADDRESS
 0x0E

	)

56 
	#HAL_MAG3110_PERIOD_MASK
 0x10

	)

57 
	#HAL_MAG3110_ENABLE_MASK
 0x01

	)

65 
MAG3110_OFF
,

66 
MAG3110_IDLE
,

67 
MAG3110_DATA_READY
,

68 } 
	tMag√tomëî_Sèãs_t
;

74 
HÆMagInô
();

75 
HÆMagTu∫On
();

76 
HÆMagTu∫Off
();

77 
boﬁ
 
HÆMagRód
(
uöt8
 *
pBuf
);

78 
boﬁ
 
HÆMagTe°
();

79 
Mag√tomëî_Sèãs_t
 
HÆMagSètus
( );

84 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_mcu.h

40 #i‚de‡
_HAL_MCU_H


41 
	#_HAL_MCU_H


	)

53 
	~"hÆ_defs.h
"

54 
	~"hÆ_ty≥s.h
"

61 
	#HAL_MCU_CC2540


	)

70 #ifde‡
__IAR_SYSTEMS_ICC__


72 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

73 
	~<ioCC2541.h
>

75 
	~<ioCC2540.h
>

78 
	#HAL_COMPILER_IAR


	)

79 
	#HAL_MCU_LITTLE_ENDIAN
(Ë
__LITTLE_ENDIAN__


	)

80 
	#_PRAGMA
(
x
Ë
	`_Pøgma
(#x)

	)

81 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

82 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

83 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

86 #ñi‡
deföed
 
__KEIL__


88 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

89 
	~<CC2541.h
>

91 
	~<CC2540.h
>

94 
	#HAL_COMPILER_KEIL


	)

95 
	#HAL_MCU_LITTLE_ENDIAN
(Ë0

	)

96 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`f
(Ë
öãºu±
 
	)
v

97 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`f
()

	)

98 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

110 
	#HAL_ENABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 1; )

	)

111 
	#HAL_DISABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 0; )

	)

112 
	#HAL_INTERRUPTS_ARE_ENABLED
(Ë(
EA
)

	)

114 
	thÆI¡Sèã_t
;

115 
	#HAL_ENTER_CRITICAL_SECTION
(
x
Ë
	`°
–x = 
EA
; 
	`HAL_DISABLE_INTERRUPTS
(); )

	)

116 
	#HAL_EXIT_CRITICAL_SECTION
(
x
Ë
	`°
–
EA
 = x; )

	)

117 
	#HAL_CRITICAL_STATEMENT
(
x
Ë
	`°
–
hÆI¡Sèã_t
 
_s
; 
	`HAL_ENTER_CRITICAL_SECTION
(_s); x; 
	`HAL_EXIT_CRITICAL_SECTION
(_s); )

	)

119 #ifde‡
__IAR_SYSTEMS_ICC__


125 
	#HAL_ENTER_ISR
(Ë{ 
hÆI¡Sèã_t
 
_i§I¡Sèã
 = 
EA
; 
	`HAL_ENABLE_INTERRUPTS
();

	)

126 
	#HAL_EXIT_ISR
(Ë
EA
 = 
_i§I¡Sèã
; }

	)

128 
	#HAL_ENTER_ISR
()

	)

129 
	#HAL_EXIT_ISR
()

	)

136 
	#WD_EN
 
	`BV
(3)

	)

137 
	#WD_MODE
 
	`BV
(2)

	)

138 
	#WD_INT_1900_USEC
 (
	`BV
(0Ë| BV(1))

	)

139 
	#WD_RESET1
 (0xA0 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

140 
	#WD_RESET2
 (0x50 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

141 
	#WD_KICK
(Ë
	`°
–
WDCTL
 = (0xA0 | WDCTL & 0x0F); WDCTL = (0x50 | WDCTL & 0x0F); )

	)

144 
	#HAL_SYSTEM_RESET
(Ë
	`°
–
	`HAL_DISABLE_INTERRUPTS
(); 
WDCTL
 = 
WD_RESET1
; WDCTL = 
WD_RESET2
; ;;); )

	)

150 
	#REV_A
 0x00

	)

151 
	#REV_B
 0x11

	)

152 
	#REV_C
 0x20

	)

153 
	#REV_D
 0x21

	)

161 
	#PCON_IDLE
 
	`BV
(0Ë

	)

164 
	#OSC_PD
 
	`BV
(2Ë

	)

165 
	#PMODE
 (
	`BV
(1Ë| BV(0)Ë

	)

168 
	#XOSC_STB
 
	`BV
(6Ë

	)

169 
	#HFRC_STB
 
	`BV
(5Ë

	)

172 
	#OSC_PD
 
	`BV
(2Ë

	)

176 
	#OSC
 
	`BV
(6)

	)

177 
	#TICKSPD
(
x
Ë(x << 3)

	)

178 
	#CLKSPD
(
x
Ë(x << 0)

	)

179 
	#CLKCONCMD_32MHZ
 (0)

	)

180 
	#CLKCONCMD_16MHZ
 (
	`CLKSPD
(1Ë| 
	`TICKSPD
(1Ë| 
OSC
)

	)

183 
	#LDRDY
 
	`BV
(0Ë

	)

187 #ifde‡
POWER_SAVING


188 vﬁ©ûê
__d©a
 
uöt8
 
hÆSÀïPc⁄VÆue
;

193 
	#CLEAR_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 0; )

	)

194 
	#ALLOW_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; )

	)

196 
	#CLEAR_SLEEP_MODE
()

	)

197 
	#ALLOW_SLEEP_MODE
()

	)

	@Components/hal/target/CC2541ST/hal_sensor.c

44 
	~"hÆ_£ns‹.h
"

45 
	~"hÆ_i2c.h
"

46 
	~"hÆ_Àd.h
"

47 
	~"hÆ_úãmp.h
"

48 
	~"hÆ_humi.h
"

49 
	~"hÆ_b¨.h
"

50 
	~"hÆ_mag.h
"

51 
	~"hÆ_acc.h
"

52 
	~"hÆ_gyro.h
"

58 
	#N_TEST_RUNS
 10

	)

64 
uöt8
 
	gbuf„r
[24];

65 
uöt8
 
	ghÆSís‹E«bÀM≠
;

79 
boﬁ
 
	$HÆSís‹RódReg
(
uöt8
 
addr
, uöt8 *
pBuf
, uöt8 
nByãs
)

81 
uöt8
 
i
 = 0;

84 i‡(
	`HÆI2CWrôe
(1,&
addr
) == 1)

87 
i
 = 
	`HÆI2CRód
(
nByãs
,
pBuf
);

90  
i
 =
nByãs
;

91 
	}
}

104 
boﬁ
 
	$HÆSís‹WrôeReg
(
uöt8
 
addr
, uöt8 *
pBuf
, uöt8 
nByãs
)

106 
uöt8
 
i
;

107 
uöt8
 *
p
 = 
buf„r
;

110 *
p
++ = 
addr
;

111 
i
 = 0; i < 
nByãs
; i++)

113 *
p
++ = *
pBuf
++;

115 
nByãs
++;

118 
i
 = 
	`HÆI2CWrôe
(
nByãs
, 
buf„r
);

119 i‡–
i
!
nByãs
)

120 
	`HAL_TOGGLE_LED2
();

122  (
i
 =
nByãs
);

123 
	}
}

134 
uöt16
 
	$HÆSís‹Te°
()

136 
uöt16
 
i
;

137 
uöt8
 
£lfTe°Resu…
;

139 
hÆSís‹E«bÀM≠
 = 0;

140 
£lfTe°Resu…
 = 0;

141 
	`HÆGyroTu∫On
();

143 
i
=0; i<
N_TEST_RUNS
; i++)

145 
	`HÆLedSë
(
HAL_LED_2
,
HAL_LED_MODE_TOGGLE
);

148 i‡(
	`HÆIRTempTe°
())

149 
£lfTe°Resu…
 |
ST_IRTEMP
;

152 i‡(
	`HÆHumiTe°
())

153 
£lfTe°Resu…
 |
ST_HUMID
;

156 i‡(
	`HÆMagTe°
())

157 
£lfTe°Resu…
 |
ST_MAGN
;

160 i‡(
	`HÆAccTe°
())

161 
£lfTe°Resu…
 |
ST_ACC
;

164 i‡(
	`HÆB¨Te°
())

165 
£lfTe°Resu…
 |
ST_PRESS
;

168 i‡(
	`HÆGyroTe°
())

169 
£lfTe°Resu…
 |
ST_GYRO
;

172 
	`HÆGyroTu∫Off
();

174  
£lfTe°Resu…
;

175 
	}
}

191 
	$HÆDcDcC⁄åﬁ
(
uöt8
 
£ns‹ID
, 
boﬁ
 
powîOn
)

193 i‡(
powîOn
)

195 
hÆSís‹E«bÀM≠
 |
£ns‹ID
;

199 
hÆSís‹E«bÀM≠
 &~
£ns‹ID
;

202 i‡(
hÆSís‹E«bÀM≠
 & 
HIGH_SUPPLY_SENSOR_MAP
)

205 
DCDC_SBIT
 = 0;

210 
DCDC_SBIT
 = 1;

212 
	}
}

	@Components/hal/target/CC2541ST/hal_sensor.h

40 #i‚de‡
HAL_SENSOR_H


41 
	#HAL_SENSOR_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"hÆ_ty≥s.h
"

58 
	#ST_IRTEMP
 0x01

	)

59 
	#ST_HUMID
 0x02

	)

60 
	#ST_MAGN
 0x04

	)

61 
	#ST_ACC
 0x08

	)

62 
	#ST_PRESS
 0x10

	)

63 
	#ST_GYRO
 0x20

	)

65 
	#HIGH_SUPPLY_SENSOR_MAP
 ( 
ST_IRTEMP
 | 
ST_HUMID
 | 
ST_GYRO
)

	)

68 
	#ST_ASSERT
(
c⁄d
Ë
	`°
–i‡(!(c⁄d)Ë 
FALSE
; )

	)

71 
	#ST_HAL_DELAY
(
n
Ë
	`°
–{ vﬁ©ûê
uöt32
 
i
; i=0; i<“); i++Ë{ }; } )

	)

76 
boﬁ
 
HÆSís‹RódReg
(
uöt8
 
addr
, uöt8 *
pBuf
, uöt8 
nByãs
);

77 
boﬁ
 
HÆSís‹WrôeReg
(
uöt8
 
addr
, uöt8 *
pBuf
, uöt8 
nByãs
);

78 
uöt16
 
HÆSís‹Te°
();

79 
HÆDcDcC⁄åﬁ
(
uöt8
 
£ns‹ID
, 
boﬁ
 
powîOn
);

83 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_sleep.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"hÆ_mcu.h
"

45 
	~"hÆ_bﬂrd.h
"

46 
	~"hÆ_¶ìp.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"hÆ_i2c.h
"

50 
	~"OSAL.h
"

51 
	~"OSAL_Timîs.h
"

52 
	~"OSAL_Tasks.h
"

53 
	~"OSAL_PwrMgr.h
"

54 
	~"hÆ_drivîs.h
"

55 
	~"hÆ_as£π.h
"

56 
	~"Œ_¶ìp.h
"

57 
	~"Œ_timî2.h
"

58 
	~"Œ_m©h.h
"

64 
	#I2C_DISABLE
(Ë
	`°
–
I2CCFG
 &~(
I2C_ENS1
); )

	)

66 #i‚de‡
HAL_SLEEP_DEBUG_POWER_MODE


68 
	#HAL_SLEEP_PREP_POWER_MODE
(
mode
) \

69 
	`°
–
SLEEPCMD
 &~
PMODE
; \

70 
SLEEPCMD
 |
mode
; \

71 !(
STLOAD
 & 
LDRDY
)); \

72 
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; \

73 )

	)

74 
	#HAL_SLEEP_SET_POWER_MODE
() \

75 
	`hÆSëSÀïMode
()

	)

80 
	#HAL_SLEEP_PREP_POWER_MODE
(
mode
Ë

	)

81 
	#HAL_SLEEP_SET_POWER_MODE
() \

82 
	`°
–
hÆSÀïI¡
 =
FALSE
); \

83 
hÆSÀïI¡
 = 
FALSE
; \

84 
	`HAL_DISABLE_INTERRUPTS
(); \

85 )

	)

89 
	#HAL_SLEEP_TIMER_ENABLE_INT
(Ë
	`°
(
IEN0
 |
STIE_BV
;)

90 
	#HAL_SLEEP_TIMER_DISABLE_INT
(Ë
	`°
(
IEN0
 &~
STIE_BV
;)

91 
	#HAL_SLEEP_TIMER_CLEAR_INT
(Ë
	`°
(
IRCON
 &= ~0x80;)

92 

	)

94 
	#HAL_SLEEP_IE_BACKUP_AND_DISABLE
–
õn0
, 
õn1
, 
õn2
 ) \

95 
	`°
–(
õn0
Ë
IEN0
; \

96 (
õn1
Ë
IEN1
; \

97 (
õn2
Ë
IEN2
; \

98 
IEN0
 &
STIE_BV
; \

99 
IEN1
 &
P0IE_BV
; \

100 
IEN2
 &(
P1IE_BV
|
P2IE_BV
); \

101 )

	)

104 
	#HAL_SLEEP_IE_RESTORE
–
õn0
, 
õn1
, 
õn2
 ) \

105 
	`°
–
IEN0
 = (
õn0
); \

106 
IEN1
 = (
õn1
); \

107 
IEN2
 = (
õn2
); \

108 )

	)

111 
	#HAL_SLEEP_MS_TO_625US
–
ms
 ) (((((
uöt32
Ë(ms)Ë* 8Ë+ 4Ë/ 5)

	)

115 
	#HAL_SLEEP_MS_TO_32KHZ
–
ms
 ) ((((
uöt32
Ë(ms)Ë* 4096Ë/ 125)

	)

118 
	#MAX_16BIT_TIMEOUT
 0xFFFF

	)

126 
	#CC2540_PM0
 0

127 
	#CC2540_PM1
 1

128 
	#CC2540_PM2
 2

129 
	#CC2540_PM3
 3

130 

	)

137 
	#HAL_SLEEP_OFF
 
CC2540_PM0


	)

138 
	#HAL_SLEEP_TIMER
 
CC2540_PM2


	)

139 
	#HAL_SLEEP_DEEP
 
CC2540_PM3


	)

144 
	#MAX_SLEEP_TIME
 16711680

145 

	)

149 #i‡!
deföed
 (
PM_MIN_SLEEP_TIME
)

150 
	#PM_MIN_SLEEP_TIME
 66

152 

	)

159 #i‡
deföed
–
CC2541
Ë|| deföed–
CC2541S
 )

160 
	#HAL_SLEEP_ADJ_TICKS
 25

161 #ñ£ // CC2540

	)

162 
	#HAL_SLEEP_ADJ_TICKS
 35

164 

	)

166 
	#STIE_BV
 
	`BV
(5)

	)

167 
	#P0IE_BV
 
	`BV
(5)

	)

168 
	#P1IE_BV
 
	`BV
(4)

	)

169 
	#P2IE_BV
 
	`BV
(1)

	)

172 #i‡
HAL_MCU_LITTLE_ENDIAN
()

173 
	#UINT32_NDX0
 0

	)

174 
	#UINT32_NDX1
 1

	)

175 
	#UINT32_NDX2
 2

	)

176 
	#UINT32_NDX3
 3

	)

178 
	#UINT32_NDX0
 3

	)

179 
	#UINT32_NDX1
 2

	)

180 
	#UINT32_NDX2
 1

	)

181 
	#UINT32_NDX3
 0

	)

193 
uöt8
 
	ghÆPwrMgtMode
 = 
HAL_SLEEP_OFF
;

196 
uöt8
 
	gwakeF‹RF
;

198 #ifde‡
HAL_SLEEP_DEBUG_POWER_MODE


199 
boﬁ
 
	ghÆSÀïI¡
 = 
FALSE
;

207 vﬁ©ûê
__d©a
 
uöt8
 
	ghÆSÀïPc⁄VÆue
 = 
PCON_IDLE
;

216 #¥agm®
loˇti⁄
 = "SLEEP_CODE"

217 
hÆSëSÀïMode
();

219 
hÆSÀïSëTimî
–
uöt32
 
¶ìpTime
, uöt32 
timeout
 );

220 
uöt32
 
hÆSÀïRódTimî
( );

221 
uöt32
 
TimîEœp£d
( );

241 #¥agm®
›timize
=
n⁄e


242 
	$hÆSëSÀïMode
()

245 
PCON
 = 
hÆSÀïPc⁄VÆue
;

247 
	`HAL_DISABLE_INTERRUPTS
();

248 
	}
}

267 
	$hÆSÀï
–
uöt32
 
oßl_timeout
 )

269 
uöt32
 
timeout
;

270 
uöt32
 
ŒTimeout
;

271 
uöt32
 
¶ìpTimî
;

273 #ifde‡
DEBUG_GPIO


275 
P1_0
 = 1;

278 i‡(
oßl_timeout
 > 
MAX_16BIT_TIMEOUT
)

280 
oßl_timeout
 = 
MAX_16BIT_TIMEOUT
;

284 
	`LL_TimeToNextRfEvít
–&
¶ìpTimî
, &
ŒTimeout
 );

290 i‡(
oßl_timeout
 == 0)

293 
timeout
 = 
ŒTimeout
;

298 
wakeF‹RF
 = (
timeout
 !0Ë? 
TRUE
 : 
FALSE
;

304 
timeout
 = 
	`HAL_SLEEP_MS_TO_32KHZ
–
oßl_timeout
 );

307 i‡((
ŒTimeout
 !0Ë&& (ŒTimeouà< 
timeout
))

310 
timeout
 = 
ŒTimeout
;

313 
wakeF‹RF
 = 
TRUE
;

318 
¶ìpTimî
 = 
	`hÆSÀïRódTimî
();

321 
wakeF‹RF
 = 
FALSE
;

326 
hÆPwrMgtMode
 = (
timeout
 =0Ë? 
HAL_SLEEP_DEEP
 : 
HAL_SLEEP_TIMER
;

328 #ifde‡
DEBUG_GPIO


330 
P1_0
 = 0;

334 i‡–(
timeout
 > 
PM_MIN_SLEEP_TIME
) || (timeout == 0) )

336 
hÆI¡Sèã_t
 
õn0
, 
õn1
, 
õn2
;

338 #ifde‡
DEBUG_GPIO


340 
P1_0
 = 1;

343 
	`HAL_ASSERT
–
	`HAL_INTERRUPTS_ARE_ENABLED
() );

344 
	`HAL_DISABLE_INTERRUPTS
();

347 i‡–
	`LL_PowîOffReq
(
hÆPwrMgtMode
Ë=
LL_SLEEP_REQUEST_ALLOWED
 )

349 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

351 
	`HÆKeyE¡îSÀï
();

354 #ifde‡
HAL_SLEEP_DEBUG_LED


355 
	`HAL_TURN_OFF_LED3
();

358 
	`HÆLedE¡îSÀï
();

362 i‡(
timeout
 != 0)

365 i‡(
timeout
 > 
MAX_SLEEP_TIME
 )

368 
	`hÆSÀïSëTimî
–
¶ìpTimî
, 
MAX_SLEEP_TIME
 );

373 
	`hÆSÀïSëTimî
–
¶ìpTimî
, 
timeout
 );

378 
	`HAL_SLEEP_PREP_POWER_MODE
(
hÆPwrMgtMode
);

381 
	`HAL_SLEEP_IE_BACKUP_AND_DISABLE
(
õn0
, 
õn1
, 
õn2
);

382 
	`HAL_ENABLE_INTERRUPTS
();

385 
	`HÆI2CDißbÀ
();

388 
DCDC_SBIT
 = 0;

390 #ifde‡
DEBUG_GPIO


392 
P1_0
 = 0;

400 
	`HAL_SLEEP_SET_POWER_MODE
();

402 #ifde‡
DEBUG_GPIO


404 
P1_0
 = 1;

417 i‡–(
wakeF‹RF
 =
TRUE
Ë&& !(
IRCON
 & 0x80) )

419 
wakeF‹RF
 = 
FALSE
;

423 
	`HAL_SLEEP_IE_RESTORE
(
õn0
, 
õn1
, 
õn2
);

428 
	`LL_PowîOnReq
–(
hÆPwrMgtMode
 =
CC2540_PM3
), 
wakeF‹RF
 );

430 #ifde‡
HAL_SLEEP_DEBUG_LED


431 
	`HAL_TURN_ON_LED3
();

434 
	`HÆLedExôSÀï
();

437 #i‡((
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
))

439 ()
	`HÆKeyExôSÀï
();

443 
	`HAL_ENABLE_INTERRUPTS
();

446 #ifde‡
DEBUG_GPIO


448 
P1_0
 = 0;

452 
DCDC_SBIT
 = 1;

455 
	}
}

483 
	$hÆSÀïSëTimî
–
uöt32
 
¶ìpTimî
, uöt32 
timeout
 )

485 
	`HAL_SLEEP_TIMER_DISABLE_INT
();

488 
¶ìpTimî
 +
timeout
;

491 
¶ìpTimî
 -
HAL_SLEEP_ADJ_TICKS
;

494 
ST2
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX2
];

495 
ST1
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX1
];

496 
ST0
 = ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX0
];

498 
	`HAL_SLEEP_TIMER_CLEAR_INT
();

499 
	`HAL_SLEEP_TIMER_ENABLE_INT
();

502 
	}
}

520 
uöt32
 
	$hÆSÀïRódTimî
( )

522 
uöt32
 
¶ìpTimî
;

526 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX0
] = 
ST0
;

527 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX1
] = 
ST1
;

528 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX2
] = 
ST2
;

529 ((
uöt8
 *)&
¶ìpTimî
)[
UINT32_NDX3
] = 0;

531 –
¶ìpTimî
 );

532 
	}
}

550 
uöt32
 
	$TimîEœp£d
( )

553 
	}
}

571 
	$hÆRe°‹eSÀïLevñ
( )

574 #ifde‡
PM_TEST


575 
	`oßl_°¨t_timîEx
 (
HÆ_TaskID
, 
HAL_SLEEP_TIMER_EVENT
, 1000);

577 
	}
}

595 
	$HAL_ISR_FUNCTION
(
hÆSÀïTimîI§
, 
ST_VECTOR
)

597 
	`HAL_ENTER_ISR
();

599 
	`HAL_SLEEP_TIMER_CLEAR_INT
();

601 #ifde‡
HAL_SLEEP_DEBUG_POWER_MODE


602 
hÆSÀïI¡
 = 
TRUE
;

605 
	`CLEAR_SLEEP_MODE
();

607 
	`HAL_EXIT_ISR
();

610 
	}
}

	@Components/hal/target/CC2541ST/hal_startup.c

42 
	~"hÆ_bﬂrd.h
"

43 
	~"hÆ_ty≥s.h
"

45 #ifde‡
__˝lu•lus


49 #¥agm®
œnguage
=
exãnded


54 #¥agm®
loˇti⁄
="CSTART"

59 #i‡(
__CODE_MODEL__
 == 2)

60 
__√¨_func
 
__roŸ
 

62 
__roŸ
 

64 
__low_Àvñ_öô
();

77 #i‡(
__CODE_MODEL__
 == 2)

78 
__√¨_func
 
__roŸ
 

80 
__roŸ
 

82 
__low_Àvñ_öô
()

88 #i‡
deföed
 
HAL_IMAGE_A


89 
MEMCTR
 = (MEMCTR & 0xF8) | 0x05;

90 #ñi‡
deföed
 
HAL_IMAGE_B


91 
MEMCTR
 = (MEMCTR & 0xF8) | 0x04;

93 
MEMCTR
 = (MEMCTR & 0xF8) | 0x01;

105 #¥agm®
œnguage
=

107 #ifde‡
__˝lu•lus


	@Components/hal/target/CC2541ST/hal_timer.c

	@Components/hal/target/CC2541ST/hal_types.h

44 #i‚de‡
_HAL_TYPES_H


45 
	#_HAL_TYPES_H


	)

56 sig√d 
	töt8
;

57 
	tuöt8
;

59 sig√d 
	töt16
;

60 
	tuöt16
;

62 sig√d 
	töt32
;

63 
	tuöt32
;

65 
	tboﬁ
;

67 
uöt8
 
	thÆD©aAlign_t
;

76 #ifde‡
__IAR_SYSTEMS_ICC__


77 
	#CODE
 
__code


	)

78 
	#XDATA
 
__xd©a


	)

79 
	#DATA
 
__d©a


	)

80 
	#NEAR_FUNC
 
__√¨_func


	)

81 
	#ASM_NOP
 
	`asm
("NOP")

	)

84 #ñi‡
deföed
 
__KEIL__


85 
	#CODE
 
code


	)

86 
	#XDATA
 
xd©a


	)

87 
	#ASM_NOP
 
	`__n›
()

	)

90 #ñi‡
deföed
 
__GNUC__


91 
	#ASM_NOP
 
__asm__
 
	`__vﬁ©ûe__
 ("n›")

	)

94 #ñi‡
_MSC_VER


95 
	#ASM_NOP
 
__asm
 
NOP


	)

98 #ñi‡
deföed
 
__TI_COMPILER_VERSION


99 
	#ASM_NOP
 
	`asm
(" NOP")

	)

111 #i‚de‡
TRUE


112 
	#TRUE
 1

	)

115 #i‚de‡
FALSE


116 
	#FALSE
 0

	)

119 #i‚de‡
NULL


120 
	#NULL
 0

	)

	@Components/osal/common/OSAL.c

46 
	~<°rög.h
>

48 
	~"comdef.h
"

49 
	~"hÆ_bﬂrd.h
"

50 
	~"OSAL.h
"

51 
	~"OSAL_Tasks.h
"

52 
	~"OSAL_Mem‹y.h
"

53 
	~"OSAL_PwrMgr.h
"

54 
	~"OSAL_Clock.h
"

56 
	~"OnBﬂrd.h
"

59 
	~"hÆ_drivîs.h
"

61 #ifde‡
IAR_ARMCM3_LM


62 
	~"FªeRTOSC⁄fig.h
"

63 
	~"oßl_èsk.h
"

83 
oßl_msg_q_t
 
	goßl_qHód
;

98 
uöt8
 
	ga˘iveTaskID
 = 
TASK_NO_TASK
;

104 
uöt8
 
oßl_msg_íqueue_push
–uöt8 
de°ö©i⁄_èsk
, uöt8 *
msg_±r
, uöt8 
urgít
 );

110 #ifde‡
__KEIL__


111 * 
	$ôﬂ
 ( 
vÆue
, * 
buf„r
, 
ødix
 )

113 (
buf„r
);

114 
	}
}

129 
	$oßl_°æí
–*
pSåög
 )

131  ()–
	`°æí
–
pSåög
 ) );

132 
	}
}

151 *
	$oßl_mem˝y
–*
d°
, c⁄° 
GENERIC
 *
§c
, 
Àn
 )

153 
uöt8
 *
pD°
;

154 c⁄° 
uöt8
 
GENERIC
 *
pSrc
;

156 
pSrc
 = 
§c
;

157 
pD°
 = 
d°
;

159  
Àn
-- )

160 *
pD°
++ = *
pSrc
++;

162  ( 
pD°
 );

163 
	}
}

182 *
	$oßl_ªvmem˝y
–*
d°
, c⁄° 
GENERIC
 *
§c
, 
Àn
 )

184 
uöt8
 *
pD°
;

185 c⁄° 
uöt8
 
GENERIC
 *
pSrc
;

187 
pSrc
 = 
§c
;

188 
pSrc
 +(
Àn
-1);

189 
pD°
 = 
d°
;

191  
Àn
-- )

192 *
pD°
++ = *
pSrc
--;

194  ( 
pD°
 );

195 
	}
}

209 *
	$oßl_memdup
–c⁄° 
GENERIC
 *
§c
, 
Àn
 )

211 
uöt8
 *
pD°
;

213 
pD°
 = 
	`oßl_mem_Æloc
–
Àn
 );

214 i‡–
pD°
 )

216 
VOID
 
	`oßl_mem˝y
–
pD°
, 
§c
, 
Àn
 );

219  ( (*)
pD°
 );

220 
	}
}

235 
uöt8
 
	$oßl_memcmp
–c⁄° 
GENERIC
 *
§c1
, c⁄° GENERIC *
§c2
, 
Àn
 )

237 c⁄° 
uöt8
 
GENERIC
 *
pSrc1
;

238 c⁄° 
uöt8
 
GENERIC
 *
pSrc2
;

240 
pSrc1
 = 
§c1
;

241 
pSrc2
 = 
§c2
;

243  
Àn
-- )

245 if–*
pSrc1
++ !*
pSrc2
++ )

246  
FALSE
;

248  
TRUE
;

249 
	}
}

265 *
	$oßl_mem£t
–*
de°
, 
uöt8
 
vÆue
, 
Àn
 )

267  
	`mem£t
–
de°
, 
vÆue
, 
Àn
 );

268 
	}
}

281 
uöt16
 
	$oßl_buûd_uöt16
–
uöt8
 *
sw≠≥d
 )

283  ( 
	`BUILD_UINT16
–
sw≠≥d
[0], swapped[1] ) );

284 
	}
}

298 
uöt32
 
	$oßl_buûd_uöt32
–
uöt8
 *
sw≠≥d
, uöt8 
Àn
 )

300 i‡–
Àn
 == 2 )

301  ( 
	`BUILD_UINT32
–
sw≠≥d
[0], swapped[1], 0L, 0L ) );

302 i‡–
Àn
 == 3 )

303  ( 
	`BUILD_UINT32
–
sw≠≥d
[0], swapped[1], swapped[2], 0L ) );

304 i‡–
Àn
 == 4 )

305  ( 
	`BUILD_UINT32
–
sw≠≥d
[0], swapped[1], swapped[2], swapped[3] ) );

307  ( (
uöt32
)
sw≠≥d
[0] );

308 
	}
}

310 #i‡!
deföed
 ( 
ZBIT
 ) && !deföed ( 
ZBIT2
 ) && !deföed (
UBIT
)

324 * 
	$_…ﬂ
(
l
, *
buf
, 
ødix
)

326 #i‡
	`deföed
–
__GNUC__
 )

327  ( (*)
	`…ﬂ
–
l
, 
buf
, 
ødix
 ) );

329 
tmp1
[10] = "", 
tmp2
[10] = "", 
tmp3
[10] = "";

330 
num1
, 
num2
, 
num3
;

331 
i
;

333 
buf
[0] = '\0';

335 i‡–
ødix
 == 10 )

337 
num1
 = 
l
 % 10000;

338 
num2
 = (
l
 / 10000) % 10000;

339 
num3
 = ()(
l
 / 100000000);

341 i‡(
num3
Ë
	`_ôﬂ
“um3, 
tmp3
, 10);

342 i‡(
num2
Ë
	`_ôﬂ
“um2, 
tmp2
, 10);

343 i‡(
num1
Ë
	`_ôﬂ
“um1, 
tmp1
, 10);

345 i‡(
num3
)

347 
	`°r˝y
((*)
buf
, (c⁄°*)
tmp3
);

348 
i
 = 0; i < 4 - 
	`°æí
((c⁄°*)
tmp2
); i++)

349 
	`°rˇt
((*)
buf
, "0");

351 
	`°rˇt
((*)
buf
, (c⁄°*)
tmp2
);

352 i‡(
num3
 || 
num2
)

354 
i
 = 0; i < 4 - 
	`°æí
((c⁄°*)
tmp1
); i++)

355 
	`°rˇt
((*)
buf
, "0");

357 
	`°rˇt
((*)
buf
, (c⁄°*)
tmp1
);

358 i‡(!
num3
 && !
num2
 && !
num1
)

359 
	`°r˝y
((*)
buf
, "0");

361 i‡–
ødix
 == 16 )

363 
num1
 = 
l
 & 0x0000FFFF;

364 
num2
 = 
l
 >> 16;

366 i‡(
num2
Ë
	`_ôﬂ
“um2, 
tmp2
, 16);

367 i‡(
num1
Ë
	`_ôﬂ
“um1, 
tmp1
, 16);

369 i‡(
num2
)

371 
	`°r˝y
((*)
buf
,(c⁄°*)
tmp2
);

372 
i
 = 0; i < 4 - 
	`°æí
((c⁄°*)
tmp1
); i++)

373 
	`°rˇt
((*)
buf
, "0");

375 
	`°rˇt
((*)
buf
, (c⁄°*)
tmp1
);

376 i‡(!
num2
 && !
num1
)

377 
	`°r˝y
((*)
buf
, "0");

380  
NULL
;

382  
buf
;

384 
	}
}

396 
uöt16
 
	$oßl_ønd
( )

398  ( 
	`Onbﬂrd_ønd
() );

399 
	}
}

427 
uöt8
 * 
	$oßl_msg_Æloˇã
–
uöt16
 
Àn
 )

429 
oßl_msg_hdr_t
 *
hdr
;

431 i‡–
Àn
 == 0 )

432  ( 
NULL
 );

434 
hdr
 = (
oßl_msg_hdr_t
 *Ë
	`oßl_mem_Æloc
–()(
Àn
 + ( osal_msg_hdr_t )) );

435 i‡–
hdr
 )

437 
hdr
->
√xt
 = 
NULL
;

438 
hdr
->
Àn
 =Üen;

439 
hdr
->
de°_id
 = 
TASK_NO_TASK
;

440  ( (
uöt8
 *Ë(
hdr
 + 1) );

443  ( 
NULL
 );

444 
	}
}

460 
uöt8
 
	$oßl_msg_dóŒoˇã
–
uöt8
 *
msg_±r
 )

462 
uöt8
 *
x
;

464 i‡–
msg_±r
 =
NULL
 )

465  ( 
INVALID_MSG_POINTER
 );

468 i‡–
	`OSAL_MSG_ID
–
msg_±r
 ) !
TASK_NO_TASK
 )

469  ( 
MSG_BUFFER_NOT_AVAIL
 );

471 
x
 = (
uöt8
 *)((uöt8 *)
msg_±r
 - –
oßl_msg_hdr_t
 ));

473 
	`oßl_mem_‰ì
–(*)
x
 );

475  ( 
SUCCESS
 );

476 
	}
}

495 
uöt8
 
	$oßl_msg_£nd
–
uöt8
 
de°ö©i⁄_èsk
, uöt8 *
msg_±r
 )

497  ( 
	`oßl_msg_íqueue_push
–
de°ö©i⁄_èsk
, 
msg_±r
, 
FALSE
 ) );

498 
	}
}

516 
uöt8
 
	$oßl_msg_push_‰⁄t
–
uöt8
 
de°ö©i⁄_èsk
, uöt8 *
msg_±r
 )

518  ( 
	`oßl_msg_íqueue_push
–
de°ö©i⁄_èsk
, 
msg_±r
, 
TRUE
 ) );

519 
	}
}

539 
uöt8
 
	$oßl_msg_íqueue_push
–
uöt8
 
de°ö©i⁄_èsk
, uöt8 *
msg_±r
, uöt8 
push
 )

541 i‡–
msg_±r
 =
NULL
 )

543  ( 
INVALID_MSG_POINTER
 );

546 i‡–
de°ö©i⁄_èsk
 >
èsksC¡
 )

548 
	`oßl_msg_dóŒoˇã
–
msg_±r
 );

549  ( 
INVALID_TASK
 );

553 i‡–
	`OSAL_MSG_NEXT
–
msg_±r
 ) !
NULL
 ||

554 
	`OSAL_MSG_ID
–
msg_±r
 ) !
TASK_NO_TASK
 )

556 
	`oßl_msg_dóŒoˇã
–
msg_±r
 );

557  ( 
INVALID_MSG_POINTER
 );

560 
	`OSAL_MSG_ID
–
msg_±r
 ) = 
de°ö©i⁄_èsk
;

562 i‡–
push
 =
TRUE
 )

565 
	`oßl_msg_push
–&
oßl_qHód
, 
msg_±r
 );

570 
	`oßl_msg_íqueue
–&
oßl_qHód
, 
msg_±r
 );

574 
	`oßl_£t_evít
–
de°ö©i⁄_èsk
, 
SYS_EVENT_MSG
 );

576  ( 
SUCCESS
 );

577 
	}
}

592 
uöt8
 *
	$oßl_msg_ª˚ive
–
uöt8
 
èsk_id
 )

594 
oßl_msg_hdr_t
 *
li°Hdr
;

595 
oßl_msg_hdr_t
 *
¥evHdr
 = 
NULL
;

596 
oßl_msg_hdr_t
 *
foundHdr
 = 
NULL
;

597 
hÆI¡Sèã_t
 
ötSèã
;

600 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

603 
li°Hdr
 = 
oßl_qHód
;

606  
li°Hdr
 !
NULL
 )

608 i‡–(
li°Hdr
 - 1)->
de°_id
 =
èsk_id
 )

610 i‡–
foundHdr
 =
NULL
 )

613 
foundHdr
 = 
li°Hdr
;

621 i‡–
foundHdr
 =
NULL
 )

623 
¥evHdr
 = 
li°Hdr
;

625 
li°Hdr
 = 
	`OSAL_MSG_NEXT
(ÜistHdr );

629 i‡–
li°Hdr
 !
NULL
 )

632 
	`oßl_£t_evít
–
èsk_id
, 
SYS_EVENT_MSG
 );

637 
	`oßl_˛ór_evít
–
èsk_id
, 
SYS_EVENT_MSG
 );

641 i‡–
foundHdr
 !
NULL
 )

644 
	`oßl_msg_exåa˘
–&
oßl_qHód
, 
foundHdr
, 
¥evHdr
 );

648 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

650  ( (
uöt8
*Ë
foundHdr
 );

651 
	}
}

671 
oßl_evít_hdr_t
 *
	$oßl_msg_föd
(
uöt8
 
èsk_id
, uöt8 
evít
)

673 
oßl_msg_hdr_t
 *
pHdr
;

674 
hÆI¡Sèã_t
 
ötSèã
;

676 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

678 
pHdr
 = 
oßl_qHód
;

681 
pHdr
 !
NULL
)

683 i‡(((
pHdr
-1)->
de°_id
 =
èsk_id
Ë&& (((
oßl_evít_hdr_t
 *ÌHdr)->
evít
 ==Évent))

688 
pHdr
 = 
	`OSAL_MSG_NEXT
(pHdr);

691 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

693  (
oßl_evít_hdr_t
 *)
pHdr
;

694 
	}
}

708 
	$oßl_msg_íqueue
–
oßl_msg_q_t
 *
q_±r
, *
msg_±r
 )

710 *
li°
;

711 
hÆI¡Sèã_t
 
ötSèã
;

714 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

716 
	`OSAL_MSG_NEXT
–
msg_±r
 ) = 
NULL
;

718 i‡–*
q_±r
 =
NULL
 )

720 *
q_±r
 = 
msg_±r
;

725  
li°
 = *
q_±r
; 
	`OSAL_MSG_NEXT
–li° ) !
NULL
;Üist = OSAL_MSG_NEXT(Üist ) );

728 
	`OSAL_MSG_NEXT
–
li°
 ) = 
msg_±r
;

732 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

733 
	}
}

746 *
	$oßl_msg_dequeue
–
oßl_msg_q_t
 *
q_±r
 )

748 *
msg_±r
 = 
NULL
;

749 
hÆI¡Sèã_t
 
ötSèã
;

752 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

754 i‡–*
q_±r
 !
NULL
 )

757 
msg_±r
 = *
q_±r
;

758 *
q_±r
 = 
	`OSAL_MSG_NEXT
–
msg_±r
 );

759 
	`OSAL_MSG_NEXT
–
msg_±r
 ) = 
NULL
;

760 
	`OSAL_MSG_ID
–
msg_±r
 ) = 
TASK_NO_TASK
;

764 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

766  
msg_±r
;

767 
	}
}

782 
	$oßl_msg_push
–
oßl_msg_q_t
 *
q_±r
, *
msg_±r
 )

784 
hÆI¡Sèã_t
 
ötSèã
;

787 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

790 
	`OSAL_MSG_NEXT
–
msg_±r
 ) = *
q_±r
;

791 *
q_±r
 = 
msg_±r
;

794 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

795 
	}
}

811 
	$oßl_msg_exåa˘
–
oßl_msg_q_t
 *
q_±r
, *
msg_±r
, *
¥ev_±r
 )

813 
hÆI¡Sèã_t
 
ötSèã
;

816 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

818 i‡–
msg_±r
 =*
q_±r
 )

821 *
q_±r
 = 
	`OSAL_MSG_NEXT
–
msg_±r
 );

826 
	`OSAL_MSG_NEXT
–
¥ev_±r
 ) = OSAL_MSG_NEXT–
msg_±r
 );

828 
	`OSAL_MSG_NEXT
–
msg_±r
 ) = 
NULL
;

829 
	`OSAL_MSG_ID
–
msg_±r
 ) = 
TASK_NO_TASK
;

832 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

833 
	}
}

849 
uöt8
 
	$oßl_msg_íqueue_max
–
oßl_msg_q_t
 *
q_±r
, *
msg_±r
, 
uöt8
 
max
 )

851 *
li°
;

852 
uöt8
 
ªt
 = 
FALSE
;

853 
hÆI¡Sèã_t
 
ötSèã
;

856 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

859 i‡–*
q_±r
 =
NULL
 )

861 *
q_±r
 = 
msg_±r
;

862 
ªt
 = 
TRUE
;

867 
li°
 = *
q_±r
;

868 
max
--;

869  (
	`OSAL_MSG_NEXT
–
li°
 ) !
NULL
Ë&& (
max
 > 0) )

871 
li°
 = 
	`OSAL_MSG_NEXT
(Üist );

872 
max
--;

876 i‡–
max
 != 0 )

878 
	`OSAL_MSG_NEXT
–
li°
 ) = 
msg_±r
;

879 
ªt
 = 
TRUE
;

884 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

886  
ªt
;

887 
	}
}

902 
uöt8
 
	$oßl_£t_evít
–
uöt8
 
èsk_id
, 
uöt16
 
evít_Êag
 )

904 i‡–
èsk_id
 < 
èsksC¡
 )

906 
hÆI¡Sèã_t
 
ötSèã
;

907 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

908 
èsksEvíts
[
èsk_id
] |
evít_Êag
;

909 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

910  ( 
SUCCESS
 );

914  ( 
INVALID_TASK
 );

916 
	}
}

931 
uöt8
 
	$oßl_˛ór_evít
–
uöt8
 
èsk_id
, 
uöt16
 
evít_Êag
 )

933 i‡–
èsk_id
 < 
èsksC¡
 )

935 
hÆI¡Sèã_t
 
ötSèã
;

936 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

937 
èsksEvíts
[
èsk_id
] &~(
evít_Êag
);

938 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

939  ( 
SUCCESS
 );

943  ( 
INVALID_TASK
 );

945 
	}
}

960 
uöt8
 
oßl_i§_ªgi°î
–uöt8 
öãºu±_id
, (*
i§_±r
)( uint8* ) )

963 ()
öãºu±_id
;

964 ()
i§_±r
;

965  ( 
SUCCESS
 );

966 
	}
}

985 
uöt8
 
	$oßl_öt_íabÀ
–
uöt8
 
öãºu±_id
 )

988 i‡–
öãºu±_id
 =
INTS_ALL
 )

990 
	`HAL_ENABLE_INTERRUPTS
();

991  ( 
SUCCESS
 );

995  ( 
INVALID_INTERRUPT_ID
 );

997 
	}
}

1015 
uöt8
 
	$oßl_öt_dißbÀ
–
uöt8
 
öãºu±_id
 )

1018 i‡–
öãºu±_id
 =
INTS_ALL
 )

1020 
	`HAL_DISABLE_INTERRUPTS
();

1021  ( 
SUCCESS
 );

1025  ( 
INVALID_INTERRUPT_ID
 );

1027 
	}
}

1041 
uöt8
 
	$oßl_öô_sy°em
( )

1044 
	`oßl_mem_öô
();

1047 
oßl_qHód
 = 
NULL
;

1050 
	`oßlTimîInô
();

1053 
	`oßl_pwrmgr_öô
();

1056 
	`oßlInôTasks
();

1059 
	`oßl_mem_kick
();

1061  ( 
SUCCESS
 );

1062 
	}
}

1076 
	$oßl_°¨t_sy°em
( )

1078 #i‡!
	`deföed
 ( 
ZBIT
 ) && !deföed ( 
UBIT
 )

1082 
	`oßl_run_sy°em
();

1084 
	}
}

1100 
	$oßl_run_sy°em
( )

1102 
uöt8
 
idx
 = 0;

1104 #i‚de‡
HAL_BOARD_CC2538


1105 
	`oßlTimeUpd©e
();

1108 
	`HÆ_Pro˚ssPﬁl
();

1111 i‡(
èsksEvíts
[
idx
])

1115 } ++
idx
 < 
èsksC¡
);

1117 i‡(
idx
 < 
èsksC¡
)

1119 
uöt16
 
evíts
;

1120 
hÆI¡Sèã_t
 
ötSèã
;

1122 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

1123 
evíts
 = 
èsksEvíts
[
idx
];

1124 
èsksEvíts
[
idx
] = 0;

1125 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

1127 
a˘iveTaskID
 = 
idx
;

1128 
evíts
 = (
èsksAº
[
idx
])( idx,Évents );

1129 
a˘iveTaskID
 = 
TASK_NO_TASK
;

1131 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

1132 
èsksEvíts
[
idx
] |
evíts
;

1133 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

1135 #i‡
	`deföed
–
POWER_SAVING
 )

1138 
	`oßl_pwrmgr_powîc⁄£rve
();

1143 #i‡
	`deföed
 (
c⁄figUSE_PREEMPTION
) && (configUSE_PREEMPTION == 0)

1145 
	`oßl_èsk_yõld
();

1148 
	}
}

1162 
uöt8
* 
	$oßl_buf„r_uöt32
–
uöt8
 *
buf
, 
uöt32
 
vÆ
 )

1164 *
buf
++ = 
	`BREAK_UINT32
–
vÆ
, 0 );

1165 *
buf
++ = 
	`BREAK_UINT32
–
vÆ
, 1 );

1166 *
buf
++ = 
	`BREAK_UINT32
–
vÆ
, 2 );

1167 *
buf
++ = 
	`BREAK_UINT32
–
vÆ
, 3 );

1169  
buf
;

1170 
	}
}

1185 
uöt8
* 
	$oßl_buf„r_uöt24
–
uöt8
 *
buf
, 
uöt24
 
vÆ
 )

1187 *
buf
++ = 
	`BREAK_UINT32
–
vÆ
, 0 );

1188 *
buf
++ = 
	`BREAK_UINT32
–
vÆ
, 1 );

1189 *
buf
++ = 
	`BREAK_UINT32
–
vÆ
, 2 );

1191  
buf
;

1192 
	}
}

1208 
uöt8
 
	$oßl_isbuf£t
–
uöt8
 *
buf
, uöt8 
vÆ
, uöt8 
Àn
 )

1210 
uöt8
 
x
;

1212 i‡–
buf
 =
NULL
 )

1214  ( 
FALSE
 );

1217  
x
 = 0; x < 
Àn
; x++ )

1220 i‡–
buf
[
x
] !
vÆ
 )

1222  ( 
FALSE
 );

1225  ( 
TRUE
 );

1226 
	}
}

1239 
uöt8
 
	$oßl_£lf
( )

1241  ( 
a˘iveTaskID
 );

1242 
	}
}

	@Components/osal/common/OSAL_ClockBLE.c

43 
	~"comdef.h
"

44 
	~"OnBﬂrd.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_Clock.h
"

52 
	#YórLígth
(
yr
Ë(
	`IsLópYór
(yrË? 366 : 365)

	)

60 
	#MAXCALCTICKS
 ((
uöt16
)(13105))

	)

62 
	#BEGYEAR
 2000

63 

	)

64 
	#DAY
 86400UL

65 

	)

81 
uöt16
 
Œ_McuPªcisi⁄Cou¡
();

86 
uöt16
 
	g¥eviousLLTimîTick
 = 0;

87 
uöt16
 
	gªmUsTicks
 = 0;

88 
uöt16
 
	gtimeMSec
 = 0;

92 
UTCTime
 
	gOSAL_timeSec⁄ds
 = 0;

97 
uöt8
 
m⁄thLígth
–uöt8 
Õyr
, uöt8 
m⁄
 );

99 
oßlClockUpd©e
–
uöt16
 
ñ≠£dMSec
 );

119 
	$oßlTimeUpd©e
( )

121 
uöt16
 
tmp
;

122 
uöt16
 
ticks625us
;

123 
uöt16
 
ñ≠£dMSec
 = 0;

126 
tmp
 = 
	`Œ_McuPªcisi⁄Cou¡
();

128 i‡–
tmp
 !
¥eviousLLTimîTick
 )

131 
ticks625us
 = 
tmp
 - 
¥eviousLLTimîTick
;

134 
¥eviousLLTimîTick
 = 
tmp
;

139  
ticks625us
 > 
MAXCALCTICKS
 )

141 
ticks625us
 -
MAXCALCTICKS
;

142 
ñ≠£dMSec
 +
MAXCALCTICKS
 * 5 / 8;

143 
ªmUsTicks
 +
MAXCALCTICKS
 * 5 % 8;

148 
tmp
 = (
ticks625us
 * 5Ë+ 
ªmUsTicks
;

151 
ñ≠£dMSec
 +
tmp
 / 8;

152 
ªmUsTicks
 = 
tmp
 % 8;

155 i‡–
ñ≠£dMSec
 )

157 
	`oßlClockUpd©e
–
ñ≠£dMSec
 );

158 
	`oßlTimîUpd©e
–
ñ≠£dMSec
 );

161 
	}
}

172 
	$oßlClockUpd©e
–
uöt16
 
ñ≠£dMSec
 )

175 
timeMSec
 +
ñ≠£dMSec
;

178 i‡–
timeMSec
 >= 1000 )

180 
OSAL_timeSec⁄ds
 +
timeMSec
 / 1000;

181 
timeMSec
 =ÅimeMSec % 1000;

183 
	}
}

196 
	$oßl_£tClock
–
UTCTime
 
√wTime
 )

198 
OSAL_timeSec⁄ds
 = 
√wTime
;

199 
	}
}

213 
UTCTime
 
	$oßl_gëClock
( )

215  ( 
OSAL_timeSec⁄ds
 );

216 
	}
}

230 
	$oßl_C⁄vîtUTCTime
–
UTCTimeSåu˘
 *
tm
, 
UTCTime
 
£cTime
 )

234 
uöt32
 
day
 = 
£cTime
 % 
DAY
;

235 
tm
->
£c⁄ds
 = 
day
 % 60UL;

236 
tm
->
möuãs
 = (
day
 % 3600UL) / 60UL;

237 
tm
->
hour
 = 
day
 / 3600UL;

242 
uöt16
 
numDays
 = 
£cTime
 / 
DAY
;

243 
tm
->
yór
 = 
BEGYEAR
;

244  
numDays
 >
	`YórLígth
–
tm
->
yór
 ) )

246 
numDays
 -
	`YórLígth
–
tm
->
yór
 );

247 
tm
->
yór
++;

250 
tm
->
m⁄th
 = 0;

251  
numDays
 >
	`m⁄thLígth
–
	`IsLópYór
–
tm
->
yór
 ),Åm->
m⁄th
 ) )

253 
numDays
 -
	`m⁄thLígth
–
	`IsLópYór
–
tm
->
yór
 ),Åm->
m⁄th
 );

254 
tm
->
m⁄th
++;

257 
tm
->
day
 = 
numDays
;

259 
	}
}

270 
uöt8
 
	$m⁄thLígth
–
uöt8
 
Õyr
, uöt8 
m⁄
 )

272 
uöt8
 
days
 = 31;

274 i‡–
m⁄
 == 1 )

276 
days
 = ( 28 + 
Õyr
 );

280 i‡–
m⁄
 > 6 )

282 
m⁄
--;

285 i‡–
m⁄
 & 1 )

287 
days
 = 30;

291  ( 
days
 );

292 
	}
}

303 
UTCTime
 
	$oßl_C⁄vîtUTCSecs
–
UTCTimeSåu˘
 *
tm
 )

305 
uöt32
 
£c⁄ds
;

308 
£c⁄ds
 = (((
tm
->
hour
 * 60ULË+Åm->
möuãs
) * 60UL) +Åm->seconds;

313 
uöt16
 
days
 = 
tm
->
day
;

317 
öt8
 
m⁄th
 = 
tm
->month;

318  --
m⁄th
 >= 0 )

320 
days
 +
	`m⁄thLígth
–
	`IsLópYór
–
tm
->
yór
 ), 
m⁄th
 );

326 
uöt16
 
yór
 = 
tm
->year;

327  --
yór
 >
BEGYEAR
 )

329 
days
 +
	`YórLígth
–
yór
 );

334 
£c⁄ds
 +(
days
 * 
DAY
);

337  ( 
£c⁄ds
 );

338 
	}
}

	@Components/osal/common/OSAL_Memory.c

46 
	~"comdef.h
"

47 
	~"OSAL.h
"

48 
	~"OSAL_Mem‹y.h
"

49 
	~"OnBﬂrd.h
"

50 
	~"hÆ_mcu.h
"

51 
	~"hÆ_as£π.h
"

58 
	#OSALMEM_IN_USE
 0x8000

	)

59 #i‡(
MAXMEMHEAP
 & 
OSALMEM_IN_USE
)

60 #îr‹ 
MAXMEMHEAP
 
is
 
too
 
big
 
to
 
m™age
!

63 
	#OSALMEM_HDRSZ
 (
oßlMemHdr_t
)

	)

66 
	#OSALMEM_ROUND
(
X
Ë((((XË+ 
OSALMEM_HDRSZ
 - 1Ë/ OSALMEM_HDRSZË* OSALMEM_HDRSZ)

	)

74 #i‡!
deföed
 
OSALMEM_MIN_BLKSZ


75 
	#OSALMEM_MIN_BLKSZ
 (
	`OSALMEM_ROUND
((
OSALMEM_HDRSZ
 * 2)))

	)

78 #i‡!
deföed
 
OSALMEM_LL_BLKSZ


79 #i‡
deföed
 
NONWK


80 
	#OSALMEM_LL_BLKSZ
 (
	`OSALMEM_ROUND
(6Ë+ (1 * 
OSALMEM_HDRSZ
))

	)

92 #i‡
deföed
 
ZCL_KEY_ESTABLISH


93 
	#OSALMEM_LL_BLKSZ
 (
	`OSALMEM_ROUND
(526Ë+ (32 * 
OSALMEM_HDRSZ
))

	)

94 #ñi‡
deföed
 
TC_LINKKEY_JOIN


95 
	#OSALMEM_LL_BLKSZ
 (
	`OSALMEM_ROUND
(454Ë+ (21 * 
OSALMEM_HDRSZ
))

	)

96 #ñi‡((
deföed
 
SECURE
) && (SECURE != 0))

97 
	#OSALMEM_LL_BLKSZ
 (
	`OSALMEM_ROUND
(418Ë+ (19 * 
OSALMEM_HDRSZ
))

	)

99 
	#OSALMEM_LL_BLKSZ
 (
	`OSALMEM_ROUND
(417Ë+ (19 * 
OSALMEM_HDRSZ
))

	)

109 #i‡!
deföed
 
OSALMEM_SMALL_BLKSZ


110 
	#OSALMEM_SMALL_BLKSZ
 (
	`OSALMEM_ROUND
(16))

	)

112 #i‡!
deföed
 
OSALMEM_SMALL_BLKCNT


113 
	#OSALMEM_SMALL_BLKCNT
 8

	)

123 
	#OSALMEM_SMALLBLK_BUCKET
 ((
OSALMEM_SMALL_BLKSZ
 * 
OSALMEM_SMALL_BLKCNT
Ë+ 
OSALMEM_LL_BLKSZ
)

	)

126 
	#OSALMEM_SMALLBLK_HDRCNT
 (
OSALMEM_SMALLBLK_BUCKET
 / 
OSALMEM_HDRSZ
)

	)

128 
	#OSALMEM_BIGBLK_IDX
 (
OSALMEM_SMALLBLK_HDRCNT
 + 1)

	)

131 
	#OSALMEM_BIGBLK_SZ
 (
MAXMEMHEAP
 - 
OSALMEM_SMALLBLK_BUCKET
 - 
OSALMEM_HDRSZ
*2)

	)

134 
	#OSALMEM_LASTBLK_IDX
 ((
MAXMEMHEAP
 / 
OSALMEM_HDRSZ
Ë- 1)

	)

137 #i‡!
deföed
 
OSALMEM_PROFILER


138 
	#OSALMEM_PROFILER
 
FALSE


140 #i‡!
deföed
 
OSALMEM_PROFILER_LL


	)

141 
	#OSALMEM_PROFILER_LL
 
FALSE


143 

	)

144 #i‡
OSALMEM_PROFILER


145 
	#OSALMEM_INIT
 'X'

	)

146 
	#OSALMEM_ALOC
 'A'

	)

147 
	#OSALMEM_REIN
 'F'

	)

157 
	mÀn
 : 15;

159 
	möU£
 : 1;

160 } 
	toßlMemHdrHdr_t
;

166 
hÆD©aAlign_t
 
	mÆignDummy
;

167 
uöt16
 
	mvÆ
;

168 
oßlMemHdrHdr_t
 
	mhdr
;

169 } 
	toßlMemHdr_t
;

176 #i‡!
deföed
 ( 
ZBIT
 )

177 
__no_öô
 
oßlMemHdr_t
 
	gtheHóp
[
MAXMEMHEAP
 / 
OSALMEM_HDRSZ
];

178 
__no_öô
 
oßlMemHdr_t
 *
	gff1
;

180 
oßlMemHdr_t
 
	gtheHóp
[
MAXMEMHEAP
 / 
OSALMEM_HDRSZ
];

181 
oßlMemHdr_t
 *
	gff1
;

184 
uöt8
 
	goßlMemSèt
;

186 #i‡
OSALMEM_METRICS


187 
uöt16
 
	gblkMax
;

188 
uöt16
 
	gblkC¡
;

189 
uöt16
 
	gblkFªe
;

190 
uöt16
 
	gmemAlo
;

191 
uöt16
 
	gmemMax
;

194 #i‡
OSALMEM_PROFILER


195 
	#OSALMEM_PROMAX
 8

	)

200 
uöt16
 
	g¥oC¡
[
OSALMEM_PROMAX
] = {

201 
OSALMEM_SMALL_BLKSZ
, 48, 112, 176, 192, 224, 256, 65535 };

202 
uöt16
 
	g¥oCur
[
OSALMEM_PROMAX
] = { 0 };

203 
uöt16
 
	g¥oMax
[
OSALMEM_PROMAX
] = { 0 };

204 
uöt16
 
	g¥oTŸ
[
OSALMEM_PROMAX
] = { 0 };

205 
uöt16
 
	g¥oSmÆlBlkMiss
;

213 #ifde‡
DPRINTF_HEAPTRACE


214 
d¥ötf
(c⁄° *
fmt
, ...);

232 
	$oßl_mem_öô
()

234 
	`HAL_ASSERT
(((
OSALMEM_MIN_BLKSZ
 % 
OSALMEM_HDRSZ
) == 0));

235 
	`HAL_ASSERT
(((
OSALMEM_LL_BLKSZ
 % 
OSALMEM_HDRSZ
) == 0));

236 
	`HAL_ASSERT
(((
OSALMEM_SMALL_BLKSZ
 % 
OSALMEM_HDRSZ
) == 0));

238 #i‡
OSALMEM_PROFILER


239 ()
	`oßl_mem£t
(
theHóp
, 
OSALMEM_INIT
, 
MAXMEMHEAP
);

243 
theHóp
[
OSALMEM_LASTBLK_IDX
].
vÆ
 = 0;

246 
ff1
 = 
theHóp
;

247 
ff1
->
vÆ
 = 
OSALMEM_SMALLBLK_BUCKET
;

250 
theHóp
[
OSALMEM_SMALLBLK_HDRCNT
].
vÆ
 = (
OSALMEM_HDRSZ
 | 
OSALMEM_IN_USE
);

253 
theHóp
[
OSALMEM_BIGBLK_IDX
].
vÆ
 = 
OSALMEM_BIGBLK_SZ
;

255 #i‡–
OSALMEM_METRICS
 )

259 
blkC¡
 = 
blkFªe
 = 2;

261 
	}
}

281 
	$oßl_mem_kick
()

283 
hÆI¡Sèã_t
 
ötSèã
;

284 
oßlMemHdr_t
 *
tmp
 = 
	`oßl_mem_Æloc
(1);

286 
	`HAL_ASSERT
((
tmp
 !
NULL
));

287 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

293 
ff1
 = 
tmp
 - 1;

294 
	`oßl_mem_‰ì
(
tmp
);

295 
oßlMemSèt
 = 0x01;

297 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

298 
	}
}

315 #ifde‡
DPRINTF_OSALHEAPTRACE


316 *
	$oßl_mem_Æloc_dbg
–
uöt16
 
size
, c⁄° *
‚ame
, 
 um
 )

318 *
	$oßl_mem_Æloc
–
uöt16
 
size
 )

321 
oßlMemHdr_t
 *
¥ev
 = 
NULL
;

322 
oßlMemHdr_t
 *
hdr
;

323 
hÆI¡Sèã_t
 
ötSèã
;

324 
uöt8
 
cﬂl
 = 0;

326 
size
 +
OSALMEM_HDRSZ
;

329 i‡––
hÆD©aAlign_t
 ) == 2 )

331 
size
 += (size & 0x01);

333 i‡––
hÆD©aAlign_t
 ) != 1 )

335 c⁄° 
uöt8
 
mod
 = 
size
 % –
hÆD©aAlign_t
 );

337 i‡–
mod
 != 0 )

339 
size
 +(–
hÆD©aAlign_t
 ) - 
mod
);

343 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

347 i‡((
oßlMemSèt
 =0Ë|| (
size
 <
OSALMEM_SMALL_BLKSZ
))

349 
hdr
 = 
ff1
;

353 
hdr
 = (
theHóp
 + 
OSALMEM_BIGBLK_IDX
);

358 i‡–
hdr
->hdr.
öU£
 )

360 
cﬂl
 = 0;

364 i‡–
cﬂl
 != 0 )

366 #i‡–
OSALMEM_METRICS
 )

367 
blkC¡
--;

368 
blkFªe
--;

371 
¥ev
->
hdr
.
Àn
 += hdr->hdr.len;

373 i‡–
¥ev
->
hdr
.
Àn
 >
size
 )

375 
hdr
 = 
¥ev
;

381 i‡–
hdr
->hdr.
Àn
 >
size
 )

386 
cﬂl
 = 1;

387 
¥ev
 = 
hdr
;

391 
hdr
 = (
oßlMemHdr_t
 *)((
uöt8
 *)hd∏+ hdr->hdr.
Àn
);

393 i‡–
hdr
->
vÆ
 == 0 )

395 
hdr
 = 
NULL
;

400 i‡–
hdr
 !
NULL
 )

402 
uöt16
 
tmp
 = 
hdr
->hdr.
Àn
 - 
size
;

405 i‡–
tmp
 >
OSALMEM_MIN_BLKSZ
 )

408 
oßlMemHdr_t
 *
√xt
 = (oßlMemHdr_à*)((
uöt8
 *)
hdr
 + 
size
);

409 
√xt
->
vÆ
 = 
tmp
;

410 
hdr
->
vÆ
 = (
size
 | 
OSALMEM_IN_USE
);

412 #i‡–
OSALMEM_METRICS
 )

413 
blkC¡
++;

414 i‡–
blkMax
 < 
blkC¡
 )

416 
blkMax
 = 
blkC¡
;

418 
memAlo
 +
size
;

423 #i‡–
OSALMEM_METRICS
 )

424 
memAlo
 +
hdr
->hdr.
Àn
;

425 
blkFªe
--;

428 
hdr
->hdr.
öU£
 = 
TRUE
;

431 #i‡–
OSALMEM_METRICS
 )

432 i‡–
memMax
 < 
memAlo
 )

434 
memMax
 = 
memAlo
;

438 #i‡–
OSALMEM_PROFILER
 )

439 #i‡!
OSALMEM_PROFILER_LL


440 i‡(
oßlMemSèt
 != 0)

443 
uöt8
 
idx
;

445  
idx
 = 0; idx < 
OSALMEM_PROMAX
; idx++ )

447 i‡–
hdr
->hdr.
Àn
 <
¥oC¡
[
idx
] )

452 
¥oCur
[
idx
]++;

453 i‡–
¥oMax
[
idx
] < 
¥oCur
[idx] )

455 
¥oMax
[
idx
] = 
¥oCur
[idx];

457 
¥oTŸ
[
idx
]++;

467 i‡((
hdr
->hdr.
Àn
 <
OSALMEM_SMALL_BLKSZ
Ë&& (hd∏>(
theHóp
 + 
OSALMEM_BIGBLK_IDX
)))

469 
¥oSmÆlBlkMiss
++;

473 ()
	`oßl_mem£t
((
uöt8
 *)(
hdr
+1), 
OSALMEM_ALOC
, (hdr->hdr.
Àn
 - 
OSALMEM_HDRSZ
));

476 i‡((
oßlMemSèt
 !0Ë&& (
ff1
 =
hdr
))

478 
ff1
 = (
oßlMemHdr_t
 *)((
uöt8
 *)
hdr
 + hdr->hdr.
Àn
);

481 
hdr
++;

484 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

486 #i‡!
	`deföed
 ( 
ZBIT
 )

487 #¥agm®
düg_suµªss
=
Pe767


488 
	`HAL_ASSERT
(((
hÆD©aAlign_t
)
hdr
 % (halDataAlign_t)) == 0);

489 #¥agm®
düg_deÁu…
=
Pe767


491 
	`HAL_ASSERT
(((
hÆD©aAlign_t
)
hdr
 % (halDataAlign_t)) == 0);

493 #ifde‡
DPRINTF_OSALHEAPTRACE


494 
	`d¥ötf
("oßl_mem_Æloc(%u)->%lx:%s:%u\n", 
size
, (Ë
hdr
, 
‚ame
, 
 um
);

496  (*)
hdr
;

497 
	}
}

514 #ifde‡
DPRINTF_OSALHEAPTRACE


515 
	$oßl_mem_‰ì_dbg
(*
±r
, c⁄° *
‚ame
, 
 um
)

517 
	$oßl_mem_‰ì
(*
±r
)

520 
oßlMemHdr_t
 *
hdr
 = (oßlMemHdr_à*)
±r
 - 1;

521 
hÆI¡Sèã_t
 
ötSèã
;

523 #ifde‡
DPRINTF_OSALHEAPTRACE


524 
	`d¥ötf
("oßl_mem_‰ì(%lx):%s:%u\n", (Ë
±r
, 
‚ame
, 
 um
);

527 
	`HAL_ASSERT
(((
uöt8
 *)
±r
 >(uöt8 *)
theHóp
Ë&& ((uöt8 *Ìå < (uöt8 *ÈheHóp+
MAXMEMHEAP
));

528 
	`HAL_ASSERT
(
hdr
->hdr.
öU£
);

530 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

531 
hdr
->hdr.
öU£
 = 
FALSE
;

533 i‡(
ff1
 > 
hdr
)

535 
ff1
 = 
hdr
;

538 #i‡
OSALMEM_PROFILER


539 #i‡!
OSALMEM_PROFILER_LL


540 i‡(
oßlMemSèt
 != 0)

543 
uöt8
 
idx
;

545 
idx
 = 0; idx < 
OSALMEM_PROMAX
; idx++)

547 i‡(
hdr
->hdr.
Àn
 <
¥oC¡
[
idx
])

553 
¥oCur
[
idx
]--;

556 ()
	`oßl_mem£t
((
uöt8
 *)(
hdr
+1), 
OSALMEM_REIN
, (hdr->hdr.
Àn
 - 
OSALMEM_HDRSZ
) );

558 #i‡
OSALMEM_METRICS


559 
memAlo
 -
hdr
->hdr.
Àn
;

560 
blkFªe
++;

563 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

564 
	}
}

566 #i‡
OSALMEM_METRICS


576 
uöt16
 
	$oßl_hóp_block_max
( )

578  
blkMax
;

579 
	}
}

590 
uöt16
 
	$oßl_hóp_block_˙t
( )

592  
blkC¡
;

593 
	}
}

604 
uöt16
 
	$oßl_hóp_block_‰ì
( )

606  
blkFªe
;

607 
	}
}

618 
uöt16
 
	$oßl_hóp_mem_u£d
( )

620  
memAlo
;

621 
	}
}

624 #i‡
deföed
 (
ZTOOL_P1
Ë|| deföed (
ZTOOL_P2
)

634 
uöt16
 
	$oßl_hóp_high_w©î
( )

636 #i‡–
OSALMEM_METRICS
 )

637  
memMax
;

639  
MAXMEMHEAP
;

641 
	}
}

	@Components/osal/common/OSAL_PwrMgr.c

44 
	~"comdef.h
"

45 
	~"OnBﬂrd.h
"

46 
	~"OSAL.h
"

47 
	~"OSAL_Tasks.h
"

48 
	~"OSAL_Timîs.h
"

49 
	~"OSAL_PwrMgr.h
"

69 
pwrmgr_©åibuã_t
 
	gpwrmgr_©åibuã
;

100 
	$oßl_pwrmgr_öô
( )

102 
pwrmgr_©åibuã
.
pwrmgr_devi˚
 = 
PWRMGR_ALWAYS_ON
;

103 
pwrmgr_©åibuã
.
pwrmgr_èsk_°©e
 = 0;

104 
	}
}

118 
	$oßl_pwrmgr_devi˚
–
uöt8
 
pwrmgr_devi˚
 )

120 
pwrmgr_©åibuã
.
pwrmgr_devi˚
 =Öwrmgr_device;

121 
	}
}

135 
uöt8
 
	$oßl_pwrmgr_èsk_°©e
–
uöt8
 
èsk_id
, uöt8 
°©e
 )

137 i‡–
èsk_id
 >
èsksC¡
 )

138  ( 
INVALID_TASK
 );

140 i‡–
°©e
 =
PWRMGR_CONSERVE
 )

143 
pwrmgr_©åibuã
.
pwrmgr_èsk_°©e
 &~(1 << 
èsk_id
 );

148 
pwrmgr_©åibuã
.
pwrmgr_èsk_°©e
 |(1 << 
èsk_id
);

151  ( 
SUCCESS
 );

152 
	}
}

154 #i‡
deföed
–
POWER_SAVING
 )

165 
	$oßl_pwrmgr_powîc⁄£rve
( )

167 
uöt32
 
√xt
;

168 
hÆI¡Sèã_t
 
ötSèã
;

171 i‡–
pwrmgr_©åibuã
.
pwrmgr_devi˚
 !
PWRMGR_ALWAYS_ON
 )

174 i‡–
pwrmgr_©åibuã
.
pwrmgr_èsk_°©e
 == 0 )

177 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

180 
√xt
 = 
	`oßl_√xt_timeout
();

183 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

186 
	`OSAL_SET_CPU_INTO_SLEEP
–
√xt
 );

189 
	}
}

	@Components/osal/common/OSAL_Timers.c

44 
	~"comdef.h
"

45 
	~"OnBﬂrd.h
"

46 
	~"OSAL.h
"

47 
	~"OSAL_Timîs.h
"

48 
	~"hÆ_timî.h
"

63 
uöt32
 
	mtime32
;

64 
uöt16
 
	mtime16
[2];

65 
uöt8
 
	mtime8
[4];

66 } 
	toßlTime_t
;

70 *
	m√xt
;

71 
oßlTime_t
 
	mtimeout
;

72 
uöt16
 
	mevít_Êag
;

73 
uöt8
 
	mèsk_id
;

74 
uöt32
 
	mªlﬂdTimeout
;

75 } 
	toßlTimîRec_t
;

81 
oßlTimîRec_t
 *
	gtimîHód
;

95 
uöt32
 
	goßl_sy°emClock
;

100 
oßlTimîRec_t
 *
oßlAddTimî
–
uöt8
 
èsk_id
, 
uöt16
 
evít_Êag
, 
uöt32
 
timeout
 );

101 
oßlTimîRec_t
 *
oßlFödTimî
–
uöt8
 
èsk_id
, 
uöt16
 
evít_Êag
 );

102 
oßlDñëeTimî
–
oßlTimîRec_t
 *
rmTimî
 );

117 
	$oßlTimîInô
( )

119 
oßl_sy°emClock
 = 0;

120 
	}
}

134 
oßlTimîRec_t
 * 
	$oßlAddTimî
–
uöt8
 
èsk_id
, 
uöt16
 
evít_Êag
, 
uöt32
 
timeout
 )

136 
oßlTimîRec_t
 *
√wTimî
;

137 
oßlTimîRec_t
 *
§chTimî
;

140 
√wTimî
 = 
	`oßlFödTimî
–
èsk_id
, 
evít_Êag
 );

141 i‡–
√wTimî
 )

144 
√wTimî
->
timeout
.
time32
 =Åimeout;

146  ( 
√wTimî
 );

151 
√wTimî
 = 
	`oßl_mem_Æloc
––
oßlTimîRec_t
 ) );

153 i‡–
√wTimî
 )

156 
√wTimî
->
èsk_id
 =Åask_id;

157 
√wTimî
->
evít_Êag
 =Évent_flag;

158 
√wTimî
->
timeout
.
time32
 =Åimeout;

159 
√wTimî
->
√xt
 = (*)
NULL
;

160 
√wTimî
->
ªlﬂdTimeout
 = 0;

163 i‡–
timîHód
 =
NULL
 )

166 
timîHód
 = 
√wTimî
;

171 
§chTimî
 = 
timîHód
;

174  
§chTimî
->
√xt
 )

175 
§chTimî
 = srchTimî->
√xt
;

178 
§chTimî
->
√xt
 = 
√wTimî
;

181  ( 
√wTimî
 );

185  ( (
oßlTimîRec_t
 *)
NULL
 );

188 
	}
}

201 
oßlTimîRec_t
 *
	$oßlFödTimî
–
uöt8
 
èsk_id
, 
uöt16
 
evít_Êag
 )

203 
oßlTimîRec_t
 *
§chTimî
;

206 
§chTimî
 = 
timîHód
;

209  
§chTimî
 )

211 i‡–
§chTimî
->
evít_Êag
 ==Évent_flag &&

212 
§chTimî
->
èsk_id
 ==Åask_id )

218 
§chTimî
 = srchTimî->
√xt
;

221  ( 
§chTimî
 );

222 
	}
}

234 
	$oßlDñëeTimî
–
oßlTimîRec_t
 *
rmTimî
 )

237 i‡–
rmTimî
 )

241 
rmTimî
->
evít_Êag
 = 0;

243 
	}
}

259 
uöt8
 
	$oßl_°¨t_timîEx
–
uöt8
 
èskID
, 
uöt16
 
evít_id
, 
uöt32
 
timeout_vÆue
 )

261 
hÆI¡Sèã_t
 
ötSèã
;

262 
oßlTimîRec_t
 *
√wTimî
;

264 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

267 
√wTimî
 = 
	`oßlAddTimî
–
èskID
, 
evít_id
, 
timeout_vÆue
 );

269 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

271  ( (
√wTimî
 !
NULL
Ë? 
SUCCESS
 : 
NO_TIMER_AVAIL
 );

272 
	}
}

289 
uöt8
 
	$oßl_°¨t_ªlﬂd_timî
–
uöt8
 
èskID
, 
uöt16
 
evít_id
, 
uöt32
 
timeout_vÆue
 )

291 
hÆI¡Sèã_t
 
ötSèã
;

292 
oßlTimîRec_t
 *
√wTimî
;

294 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

297 
√wTimî
 = 
	`oßlAddTimî
–
èskID
, 
evít_id
, 
timeout_vÆue
 );

298 i‡–
√wTimî
 )

301 
√wTimî
->
ªlﬂdTimeout
 = 
timeout_vÆue
;

304 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

306  ( (
√wTimî
 !
NULL
Ë? 
SUCCESS
 : 
NO_TIMER_AVAIL
 );

307 
	}
}

323 
uöt8
 
	$oßl_°›_timîEx
–
uöt8
 
èsk_id
, 
uöt16
 
evít_id
 )

325 
hÆI¡Sèã_t
 
ötSèã
;

326 
oßlTimîRec_t
 *
foundTimî
;

328 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

331 
foundTimî
 = 
	`oßlFödTimî
–
èsk_id
, 
evít_id
 );

332 i‡–
foundTimî
 )

334 
	`oßlDñëeTimî
–
foundTimî
 );

337 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

339  ( (
foundTimî
 !
NULL
Ë? 
SUCCESS
 : 
INVALID_EVENT_ID
 );

340 
	}
}

352 
uöt32
 
	$oßl_gë_timeoutEx
–
uöt8
 
èsk_id
, 
uöt16
 
evít_id
 )

354 
hÆI¡Sèã_t
 
ötSèã
;

355 
uöt32
 
π∫
 = 0;

356 
oßlTimîRec_t
 *
tmr
;

358 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

360 
tmr
 = 
	`oßlFödTimî
–
èsk_id
, 
evít_id
 );

362 i‡–
tmr
 )

364 
π∫
 = 
tmr
->
timeout
.
time32
;

367 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

369  
π∫
;

370 
	}
}

381 
uöt8
 
	$oßl_timî_num_a˘ive
( )

383 
hÆI¡Sèã_t
 
ötSèã
;

384 
uöt8
 
num_timîs
 = 0;

385 
oßlTimîRec_t
 *
§chTimî
;

387 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

390 
§chTimî
 = 
timîHód
;

393  
§chTimî
 !
NULL
 )

395 
num_timîs
++;

396 
§chTimî
 = srchTimî->
√xt
;

399 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

401  
num_timîs
;

402 
	}
}

413 
	$oßlTimîUpd©e
–
uöt32
 
upd©eTime
 )

415 
hÆI¡Sèã_t
 
ötSèã
;

416 
oßlTimîRec_t
 *
§chTimî
;

417 
oßlTimîRec_t
 *
¥evTimî
;

419 
oßlTime_t
 
timeUni⁄
;

420 
timeUni⁄
.
time32
 = 
upd©eTime
;

422 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

424 
oßl_sy°emClock
 +
upd©eTime
;

425 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

428 i‡–
timîHód
 !
NULL
 )

431 
§chTimî
 = 
timîHód
;

432 
¥evTimî
 = (*)
NULL
;

435  
§chTimî
 )

437 
oßlTimîRec_t
 *
‰ìTimî
 = 
NULL
;

439 
	`HAL_ENTER_CRITICAL_SECTION
–
ötSèã
 );

442 i‡((
timeUni⁄
.
time16
[1] =0Ë&& (timeUni⁄.
time8
[1] == 0))

445 i‡(
§chTimî
->
timeout
.
time8
[0] >
timeUni⁄
.time8[0])

448 
§chTimî
->
timeout
.
time8
[0] -
timeUni⁄
.time8[0];

453 i‡(
§chTimî
->
timeout
.
time32
 > 
timeUni⁄
.time32)

455 
§chTimî
->
timeout
.
time32
 -
timeUni⁄
.time32;

459 
§chTimî
->
timeout
.
time32
 = 0;

466 i‡(
§chTimî
->
timeout
.
time32
 > 
timeUni⁄
.time32)

468 
§chTimî
->
timeout
.
time32
 -
timeUni⁄
.time32;

472 
§chTimî
->
timeout
.
time32
 = 0;

477 i‡–(
§chTimî
->
timeout
.
time16
[0] == 0) && (srchTimer->timeout.time16[1] == 0) &&

478 (
§chTimî
->
ªlﬂdTimeout
Ë&& (§chTimî->
evít_Êag
) )

481 
	`oßl_£t_evít
–
§chTimî
->
èsk_id
, srchTimî->
evít_Êag
 );

484 
§chTimî
->
timeout
.
time32
 = srchTimî->
ªlﬂdTimeout
;

488 i‡–((
§chTimî
->
timeout
.
time16
[0] == 0) && (srchTimer->timeout.time16[1] == 0)) ||

489 (
§chTimî
->
evít_Êag
 == 0) )

492 i‡–
¥evTimî
 =
NULL
 )

494 
timîHód
 = 
§chTimî
->
√xt
;

498 
¥evTimî
->
√xt
 = 
§chTimî
->next;

502 
‰ìTimî
 = 
§chTimî
;

505 
§chTimî
 = srchTimî->
√xt
;

510 
¥evTimî
 = 
§chTimî
;

511 
§chTimî
 = srchTimî->
√xt
;

514 
	`HAL_EXIT_CRITICAL_SECTION
–
ötSèã
 );

516 i‡–
‰ìTimî
 )

518 i‡–(
‰ìTimî
->
timeout
.
time16
[0] == 0) && (freeTimer->timeout.time16[1] == 0) )

520 
	`oßl_£t_evít
–
‰ìTimî
->
èsk_id
, fªeTimî->
evít_Êag
 );

522 
	`oßl_mem_‰ì
–
‰ìTimî
 );

526 
	}
}

528 #ifde‡
POWER_SAVING


538 
	$oßl_adju°_timîs
( )

540 
uöt32
 
eTime
;

542 i‡–
timîHód
 !
NULL
 )

545 
eTime
 = 
	`TimîEœp£d
(Ë/ 
TICK_COUNT
;

547 i‡–
eTime
 )

549 
	`oßlTimîUpd©e
–
eTime
 );

552 
	}
}

566 
uöt32
 
	$oßl_√xt_timeout
( )

568 
uöt32
 
√xtTimeout
;

569 
oßlTimîRec_t
 *
§chTimî
;

571 i‡–
timîHód
 !
NULL
 )

574 
§chTimî
 = 
timîHód
;

575 
√xtTimeout
 = 
OSAL_TIMERS_MAX_TIMEOUT
;

578  
§chTimî
 !
NULL
 )

580 i‡(
§chTimî
->
timeout
.
time32
 < 
√xtTimeout
)

582 
√xtTimeout
 = 
§chTimî
->
timeout
.
time32
;

585 
§chTimî
 = srchTimî->
√xt
;

591 
√xtTimeout
 = 0;

594  ( 
√xtTimeout
 );

595 
	}
}

607 
uöt32
 
	$oßl_GëSy°emClock
( )

609  ( 
oßl_sy°emClock
 );

610 
	}
}

	@Components/osal/common/osal_bufmgr.c

46 
	~"OSAL.h
"

47 
	~"OnBﬂrd.h
"

49 
	~"oßl_bufmgr.h
"

55 
	#START_PTR
–
bd_±r
 ) ( (bd_±rË+ 1 )

	)

56 
	#END_PTR
–
bd_±r
 ) ( (
uöt8
 *)
	`START_PTR
–bd_±∏Ë+ (bd_±r)->
∑ylﬂd_Àn
 )

	)

65 
	sbm_desc


67 
bm_desc
 *
	m√xt_±r
;

68 
uöt16
 
	m∑ylﬂd_Àn
;

69 } 
	tbm_desc_t
;

83 
bm_desc_t
 *
	gbm_li°_±r
 = 
NULL
;

88 
bm_desc_t
 *
bm_desc_‰om_∑ylﬂd
 ( 
uöt8
 *
∑ylﬂd_±r
 );

103 *
	$oßl_bm_Æloc
–
uöt16
 
size
 )

105 
bm_desc_t
 *
bd_±r
;

107 
bd_±r
 = 
	`oßl_mem_Æloc
––
bm_desc_t
 ) + 
size
 );

108 i‡–
bd_±r
 !
NULL
 )

111 
bd_±r
->
∑ylﬂd_Àn
 = 
size
;

114 
bd_±r
->
√xt_±r
 = 
bm_li°_±r
;

115 
bm_li°_±r
 = 
bd_±r
;

118  ( (*)
	`START_PTR
–
bd_±r
 ) );

121  ( (*)
NULL
 );

122 
	}
}

133 
	$oßl_bm_‰ì
–*
∑ylﬂd_±r
 )

135 
bm_desc_t
 *
lo›_±r
;

136 
bm_desc_t
 *
¥ev_±r
 = 
NULL
;

138 
lo›_±r
 = 
bm_li°_±r
;

139  
lo›_±r
 !
NULL
 )

141 i‡–
∑ylﬂd_±r
 >(*)
	`START_PTR
–
lo›_±r
 ) &&

142 
∑ylﬂd_±r
 <(*)
	`END_PTR
–
lo›_±r
) )

145 i‡–
¥ev_±r
 =
NULL
 )

148 
bm_li°_±r
 = 
lo›_±r
->
√xt_±r
;

152 
¥ev_±r
->
√xt_±r
 = 
lo›_±r
->next_ptr;

156 
	`oßl_mem_‰ì
–
lo›_±r
 );

163 
¥ev_±r
 = 
lo›_±r
;

164 
lo›_±r
 =Üo›_±r->
√xt_±r
;

166 
	}
}

179 *
	$oßl_bm_adju°_hódî
–*
∑ylﬂd_±r
, 
öt16
 
size
 )

181 
bm_desc_t
 *
bd_±r
;

182 
uöt8
 *
√w_∑ylﬂd_±r
;

184 
bd_±r
 = 
	`bm_desc_‰om_∑ylﬂd
–(
uöt8
 *)
∑ylﬂd_±r
 );

185 i‡–
bd_±r
 !
NULL
 )

187 
√w_∑ylﬂd_±r
 = (
uöt8
 *)–(uöt8 *)
∑ylﬂd_±r
 - 
size
 );

190 i‡–
√w_∑ylﬂd_±r
 >(
uöt8
 *)
	`START_PTR
–
bd_±r
 ) &&

191 
√w_∑ylﬂd_±r
 <(
uöt8
 *)
	`END_PTR
–
bd_±r
 ) )

194  ( (*)
√w_∑ylﬂd_±r
 );

199  ( 
∑ylﬂd_±r
 );

200 
	}
}

213 *
	$oßl_bm_adju°_èû
–*
∑ylﬂd_±r
, 
öt16
 
size
 )

215 
bm_desc_t
 *
bd_±r
;

216 
uöt8
 *
√w_∑ylﬂd_±r
;

218 
bd_±r
 = 
	`bm_desc_‰om_∑ylﬂd
–(
uöt8
 *)
∑ylﬂd_±r
 );

219 i‡–
bd_±r
 !
NULL
 )

221 
√w_∑ylﬂd_±r
 = (
uöt8
 *)
	`END_PTR
–
bd_±r
 ) - 
size
;

224 i‡–
√w_∑ylﬂd_±r
 >(
uöt8
 *)
	`START_PTR
–
bd_±r
 ) &&

225 
√w_∑ylﬂd_±r
 <(
uöt8
 *)
	`END_PTR
–
bd_±r
 ) )

228  ( (*)
√w_∑ylﬂd_±r
 );

233  ( 
∑ylﬂd_±r
 );

234 
	}
}

245 
bm_desc_t
 *
	$bm_desc_‰om_∑ylﬂd
 ( 
uöt8
 *
∑ylﬂd_±r
 )

247 
bm_desc_t
 *
lo›_±r
;

249 
lo›_±r
 = 
bm_li°_±r
;

250  
lo›_±r
 !
NULL
 )

252 i‡–
∑ylﬂd_±r
 >(
uöt8
 *)
	`START_PTR
–
lo›_±r
 ) &&

253 
∑ylﬂd_±r
 <(
uöt8
 *)
	`END_PTR
–
lo›_±r
) )

260 
lo›_±r
 =Üo›_±r->
√xt_±r
;

263  ( 
lo›_±r
 );

264 
	}
}

	@Components/osal/common/osal_cbtimer.c

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

47 
	~"oßl_cbtimî.h
"

56 
	#EVENT_ID
–
timîId
 ) ( 0x0001 << ( (ÅimîId ) % 
NUM_CBTIMERS_PER_TASK
 ) )

	)

59 
	#TASK_ID
–
timîId
 ) ( ( (ÅimîId ) / 
NUM_CBTIMERS_PER_TASK
 ) + 
ba£TaskID
 )

	)

62 
	#BANK_TASK_ID
–
èskId
 ) ( ( 
ba£TaskID
 - (ÅaskId ) ) * 
NUM_CBTIMERS
 )

	)

68 
	#NUM_CBTIMERS_PER_TASK
 15

	)

71 
	#NUM_CBTIMERS
 ( 
OSAL_CBTIMER_NUM_TASKS
 * 
NUM_CBTIMERS_PER_TASK
 )

	)

79 
p‚CbTimî_t
 
	mp‚CbTimî
;

80 
uöt8
 *
	mpD©a
;

81 } 
	tcbTimî_t
;

87 
uöt16
 
	gba£TaskID
 = 
TASK_NO_TASK
;

101 #i‡–
NUM_CBTIMERS
 > 0 )

102 
cbTimî_t
 
	gcbTimîs
[
NUM_CBTIMERS
];

123 
	$oßl_CbTimîInô
–
uöt8
 
èskId
 )

125 i‡–
ba£TaskID
 =
TASK_NO_TASK
 )

128 
ba£TaskID
 = 
èskId
;

131 
	`oßl_mem£t
–
cbTimîs
, 0, ( cbTimers ) );

133 
	}
}

145 
uöt16
 
	$oßl_CbTimîPro˚ssEvít
–
uöt8
 
èskId
, 
uöt16
 
evíts
 )

147 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

152  ( 
evíts
 ^ 
SYS_EVENT_MSG
 );

155 i‡–
evíts
 )

157 
uöt8
 
i
;

158 
uöt16
 
evít
;

161  
i
 = 0; i < 
NUM_CBTIMERS_PER_TASK
; i++ )

163 i‡––
evíts
 >> 
i
 ) & 0x0001 )

165 
cbTimî_t
 *
pTimî
 = &
cbTimîs
[
	`BANK_TASK_ID
–
èskId
 )+
i
];

168 
evít
 = 0x0001 << 
i
;

171 
pTimî
->
	`p‚CbTimî
–pTimî->
pD©a
 );

174 
pTimî
->
p‚CbTimî
 = 
NULL
;

177 
pTimî
->
pD©a
 = 
NULL
;

185  ( 
evíts
 ^ 
evít
 );

191 
	}
}

207 
Sètus_t
 
	$oßl_CbTimîSèπ
–
p‚CbTimî_t
 
p‚CbTimî
, 
uöt8
 *
pD©a
,

208 
uöt16
 
timeout
, 
uöt8
 *
pTimîId
 )

210 
uöt8
 
i
;

213 i‡–
p‚CbTimî
 =
NULL
 )

215  ( 
INVALIDPARAMETER
 );

219  
i
 = 0; i < 
NUM_CBTIMERS
; i++ )

221 i‡–
cbTimîs
[
i
].
p‚CbTimî
 =
NULL
 )

224 i‡–
	`oßl_°¨t_timîEx
–
	`TASK_ID
–
i
 ), 
	`EVENT_ID
–ò), 
timeout
 ) =
SUCCESS
 )

227 
cbTimîs
[
i
].
p‚CbTimî
 =ÖfnCbTimer;

228 
cbTimîs
[
i
].
pD©a
 =ÖData;

230 i‡–
pTimîId
 !
NULL
 )

233 *
pTimîId
 = 
i
;

236  ( 
SUCCESS
 );

242  ( 
NO_TIMER_AVAIL
 );

243 
	}
}

258 
Sètus_t
 
	$oßl_CbTimîUpd©e
–
uöt8
 
timîId
, 
uöt16
 
timeout
 )

261 i‡–
timîId
 < 
NUM_CBTIMERS
 )

263 i‡–
cbTimîs
[
timîId
].
p‚CbTimî
 !
NULL
 )

266 i‡–
	`oßl_gë_timeoutEx
–
	`TASK_ID
–
timîId
 ), 
	`EVENT_ID
(ÅimerId ) ) != 0 )

269 
	`oßl_°¨t_timîEx
–
	`TASK_ID
–
timîId
 ), 
	`EVENT_ID
–timîId ), 
timeout
 );

271  ( 
SUCCESS
 );

277  ( 
INVALIDPARAMETER
 );

278 
	}
}

292 
Sètus_t
 
	$oßl_CbTimîSt›
–
uöt8
 
timîId
 )

295 i‡–
timîId
 < 
NUM_CBTIMERS
 )

297 i‡–
cbTimîs
[
timîId
].
p‚CbTimî
 !
NULL
 )

300 
	`oßl_°›_timîEx
–
	`TASK_ID
–
timîId
 ), 
	`EVENT_ID
(ÅimerId ) );

303 
cbTimîs
[
timîId
].
p‚CbTimî
 = 
NULL
;

306 
cbTimîs
[
timîId
].
pD©a
 = 
NULL
;

308  ( 
SUCCESS
 );

313  ( 
INVALIDPARAMETER
 );

314 
	}
}

	@Components/osal/include/OSAL.h

43 #i‚de‡
OSAL_H


44 
	#OSAL_H


	)

46 #ifde‡
__˝lu•lus


55 
	~<limôs.h
>

57 
	~"comdef.h
"

58 
	~"OSAL_Mem‹y.h
"

59 
	~"OSAL_Timîs.h
"

64 #i‡–
UINT_MAX
 == 65535 )

65 
	#oßl_off£tof
(
ty≥
, 
membî
Ë((
uöt16
Ë&((—y≥ *Ë0)->membî))

	)

67 
	#oßl_off£tof
(
ty≥
, 
membî
Ë((
uöt32
Ë&((—y≥ *Ë0)->membî))

	)

70 
	#OSAL_MSG_NEXT
(
msg_±r
Ë((
oßl_msg_hdr_t
 *Ë(msg_±rË- 1)->
√xt


	)

72 
	#OSAL_MSG_Q_INIT
(
q_±r
Ë*(q_±rË
NULL


	)

74 
	#OSAL_MSG_Q_EMPTY
(
q_±r
Ë(*(q_±rË=
NULL
)

	)

76 
	#OSAL_MSG_Q_HEAD
(
q_±r
Ë(*(q_±r))

	)

78 
	#OSAL_MSG_LEN
(
msg_±r
Ë((
oßl_msg_hdr_t
 *Ë(msg_±rË- 1)->
Àn


	)

80 
	#OSAL_MSG_ID
(
msg_±r
Ë((
oßl_msg_hdr_t
 *Ë(msg_±rË- 1)->
de°_id


	)

87 
	#INTS_ALL
 0xFF

	)

94 *
√xt
;

95 
uöt16
 
Àn
;

96 
uöt8
 
de°_id
;

97 } 
	toßl_msg_hdr_t
;

101 
uöt8
 
evít
;

102 
uöt8
 
°©us
;

103 } 
	toßl_evít_hdr_t
;

105 * 
	toßl_msg_q_t
;

120 
uöt8
 * 
oßl_msg_Æloˇã
(
uöt16
 
Àn
 );

125 
uöt8
 
oßl_msg_dóŒoˇã
–uöt8 *
msg_±r
 );

130 
uöt8
 
oßl_msg_£nd
–uöt8 
de°ö©i⁄_èsk
, uöt8 *
msg_±r
 );

135 
uöt8
 
oßl_msg_push_‰⁄t
–uöt8 
de°ö©i⁄_èsk
, uöt8 *
msg_±r
 );

140 
uöt8
 *
oßl_msg_ª˚ive
–uöt8 
èsk_id
 );

145 
oßl_evít_hdr_t
 *
oßl_msg_föd
(
uöt8
 
èsk_id
, uöt8 
evít
);

150 
oßl_msg_íqueue
–
oßl_msg_q_t
 *
q_±r
, *
msg_±r
 );

155 
uöt8
 
oßl_msg_íqueue_max
–
oßl_msg_q_t
 *
q_±r
, *
msg_±r
, uöt8 
max
 );

160 *
oßl_msg_dequeue
–
oßl_msg_q_t
 *
q_±r
 );

165 
oßl_msg_push
–
oßl_msg_q_t
 *
q_±r
, *
msg_±r
 );

170 
oßl_msg_exåa˘
–
oßl_msg_q_t
 *
q_±r
, *
msg_±r
, *
¥ev_±r
 );

178 
uöt8
 
oßl_£t_evít
–uöt8 
èsk_id
, 
uöt16
 
evít_Êag
 );

184 
uöt8
 
oßl_˛ór_evít
–uöt8 
èsk_id
, 
uöt16
 
evít_Êag
 );

192 
uöt8
 
oßl_i§_ªgi°î
–uöt8 
öãºu±_id
, (*
i§_±r
)( uint8* ) );

197 
uöt8
 
oßl_öt_íabÀ
–uöt8 
öãºu±_id
 );

202 
uöt8
 
oßl_öt_dißbÀ
–uöt8 
öãºu±_id
 );

210 
uöt8
 
oßl_öô_sy°em
( );

215 #i‡
deföed
 (
ZBIT
)

216 
__de˛•ec
(
dŒexp‹t
Ë
oßl_°¨t_sy°em
( );

218 
oßl_°¨t_sy°em
( );

224 
oßl_run_sy°em
( );

229 
uöt8
 
oßl_£lf
( );

237 
oßl_°æí
–*
pSåög
 );

242 *
oßl_mem˝y
–*, c⁄° 
GENERIC
 *, );

247 *
oßl_memdup
–c⁄° 
GENERIC
 *
§c
, 
Àn
 );

252 *
oßl_ªvmem˝y
–*, c⁄° 
GENERIC
 *, );

257 
uöt8
 
oßl_memcmp
–c⁄° 
GENERIC
 *
§c1
, c⁄° GENERIC *
§c2
, 
Àn
 );

262 *
oßl_mem£t
–*
de°
, 
uöt8
 
vÆue
, 
Àn
 );

267 
uöt16
 
oßl_buûd_uöt16
–
uöt8
 *
sw≠≥d
 );

272 
uöt32
 
oßl_buûd_uöt32
–
uöt8
 *
sw≠≥d
, uöt8 
Àn
 );

277 #i‡!
deföed
 ( 
ZBIT
 ) && !deföed ( 
ZBIT2
 ) && !deföed (
UBIT
)

278 
uöt8
 *
_…ﬂ
–
uöt32
 
l
, uöt8 * 
buf
, uöt8 
ødix
 );

284 
uöt16
 
oßl_ønd
( );

289 
uöt8
* 
oßl_buf„r_uöt32
–uöt8 *
buf
, 
uöt32
 
vÆ
 );

294 
uöt8
* 
oßl_buf„r_uöt24
–uöt8 *
buf
, 
uöt24
 
vÆ
 );

299 
uöt8
 
oßl_isbuf£t
–uöt8 *
buf
, uöt8 
vÆ
, uöt8 
Àn
 );

304 #ifde‡
__˝lu•lus


	@Components/osal/include/OSAL_Clock.h

40 #i‚de‡
OSAL_CLOCK_H


41 
	#OSAL_CLOCK_H


	)

43 #ifde‡
__˝lu•lus


56 
	#IsLópYór
(
yr
Ë(!((yrË% 400Ë|| (((yrË% 100Ë&& !((yrË% 4)))

	)

68 
uöt32
 
	tUTCTime
;

73 
uöt8
 
£c⁄ds
;

74 
uöt8
 
möuãs
;

75 
uöt8
 
hour
;

76 
uöt8
 
day
;

77 
uöt8
 
m⁄th
;

78 
uöt16
 
yór
;

79 } 
	tUTCTimeSåu˘
;

92 
oßlTimeUpd©e
( );

100 
oßl_£tClock
–
UTCTime
 
√wTime
 );

108 
UTCTime
 
oßl_gëClock
( );

117 
oßl_C⁄vîtUTCTime
–
UTCTimeSåu˘
 *
tm
, 
UTCTime
 
£cTime
 );

124 
UTCTime
 
oßl_C⁄vîtUTCSecs
–
UTCTimeSåu˘
 *
tm
 );

130 
oßlAdju°Timî
–
uöt32
 
M£c
 );

135 #ifde‡
__˝lu•lus


	@Components/osal/include/OSAL_Memory.h

40 #i‚de‡
OSAL_MEMORY_H


41 
	#OSAL_MEMORY_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"comdef.h
"

57 #i‡!
deföed
 ( 
OSALMEM_METRICS
 )

58 
	#OSALMEM_METRICS
 
FALSE


	)

65 
	#oßl_°ack_u£d
(Ë
	`OnBﬂrd_°ack_u£d
()

	)

82 
oßl_mem_öô
( );

87 
oßl_mem_kick
( );

92 #ifde‡
DPRINTF_OSALHEAPTRACE


93 *
oßl_mem_Æloc_dbg
–
uöt16
 
size
, c⁄° *
‚ame
, 
 um
 );

94 
	#oßl_mem_Æloc
(
_size
 ) 
	`oßl_mem_Æloc_dbg
(_size, 
__FILE__
, 
__LINE__
)

	)

96 *
oßl_mem_Æloc
–
uöt16
 
size
 );

102 #ifde‡
DPRINTF_OSALHEAPTRACE


103 
oßl_mem_‰ì_dbg
–*
±r
, c⁄° *
‚ame
, 
 um
 );

104 
	#oßl_mem_‰ì
(
_±r
 ) 
	`oßl_mem_‰ì_dbg
(_±r, 
__FILE__
, 
__LINE__
)

	)

106 
oßl_mem_‰ì
–*
±r
 );

109 #i‡–
OSALMEM_METRICS
 )

113 
uöt16
 
oßl_hóp_block_max
( );

118 
uöt16
 
oßl_hóp_block_˙t
( );

123 
uöt16
 
oßl_hóp_block_‰ì
( );

128 
uöt16
 
oßl_hóp_mem_u£d
( );

131 #i‡
deföed
 (
ZTOOL_P1
Ë|| deföed (
ZTOOL_P2
)

135 
uöt16
 
oßl_hóp_high_w©î
( );

141 #ifde‡
__˝lu•lus


	@Components/osal/include/OSAL_Nv.h

40 #i‚de‡
OSAL_NV_H


41 
	#OSAL_NV_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"hÆ_ty≥s.h
"

77 
oßl_nv_öô
–*
p
 );

82 
uöt8
 
oßl_nv_ôem_öô
–
uöt16
 
id
, uöt16 
Àn
, *
buf
 );

87 
uöt8
 
oßl_nv_ªad
–
uöt16
 
id
, uöt16 
off£t
, uöt16 
Àn
, *
buf
 );

92 
uöt8
 
oßl_nv_wrôe
–
uöt16
 
id
, uöt16 
off£t
, uöt16 
Àn
, *
buf
 );

97 
uöt16
 
oßl_nv_ôem_Àn
–uöt16 
id
 );

102 
uöt8
 
oßl_nv_dñëe
–
uöt16
 
id
, uöt16 
Àn
 );

107 #ifde‡
__˝lu•lus


	@Components/osal/include/OSAL_PwrMgr.h

40 #i‚de‡
OSAL_PWRMGR_H


41 
	#OSAL_PWRMGR_H


	)

43 #ifde‡
__˝lu•lus


65 
uöt16
 
pwrmgr_èsk_°©e
;

66 
uöt16
 
pwrmgr_√xt_timeout
;

67 
uöt16
 
accumuœãd_¶ìp_time
;

68 
uöt8
 
pwrmgr_devi˚
;

69 } 
	tpwrmgr_©åibuã_t
;

75 
	#PWRMGR_ALWAYS_ON
 0

	)

76 
	#PWRMGR_BATTERY
 1

	)

81 
	#PWRMGR_CONSERVE
 0

	)

82 
	#PWRMGR_HOLD
 1

	)

91 
pwrmgr_©åibuã_t
 
pwrmgr_©åibuã
;

102 
oßl_pwrmgr_öô
( );

115 
uöt8
 
oßl_pwrmgr_èsk_°©e
–uöt8 
èsk_id
, uöt8 
°©e
 );

124 
oßl_pwrmgr_devi˚
–
uöt8
 
pwrmgr_devi˚
 );

130 
oßl_pwrmgr_powîc⁄£rve
( );

135 #ifde‡
__˝lu•lus


	@Components/osal/include/OSAL_Tasks.h

40 #i‚de‡
OSAL_TASKS_H


41 
	#OSAL_TASKS_H


	)

43 #ifde‡
__˝lu•lus


59 
	#TASK_NO_TASK
 0xFF

	)

68 (*
	tpTaskEvítH™dÀrFn
)–
	tèsk_id
, 
	tevít
 );

74 c⁄° 
pTaskEvítH™dÀrFn
 
èsksAº
[];

75 c⁄° 
uöt8
 
èsksC¡
;

76 
uöt16
 *
èsksEvíts
;

85 
oßlInôTasks
( );

90 #ifde‡
__˝lu•lus


	@Components/osal/include/OSAL_Timers.h

40 #i‚de‡
OSAL_TIMERS_H


41 
	#OSAL_TIMERS_H


	)

43 #ifde‡
__˝lu•lus


61 
	#OSAL_TIMERS_MAX_TIMEOUT
 0x28f5c28ê

	)

78 
oßlTimîInô
( );

83 
uöt8
 
oßl_°¨t_timîEx
–uöt8 
èsk_id
, 
uöt16
 
evít_id
, 
uöt32
 
timeout_vÆue
 );

88 
uöt8
 
oßl_°¨t_ªlﬂd_timî
–uöt8 
èskID
, 
uöt16
 
evít_id
, 
uöt32
 
timeout_vÆue
 );

93 
uöt8
 
oßl_°›_timîEx
–uöt8 
èsk_id
, 
uöt16
 
evít_id
 );

98 
uöt32
 
oßl_gë_timeoutEx
–
uöt8
 
èsk_id
, 
uöt16
 
evít_id
 );

104 
oßl_timî_ISR
( );

109 
oßl_adju°_timîs
( );

114 
oßlTimîUpd©e
–
uöt32
 
upd©eTime
 );

119 
uöt8
 
oßl_timî_num_a˘ive
( );

125 
oßl_¶ìp_timîs
( );

126 
oßl_un¶ìp_timîs
( );

131 
uöt32
 
oßl_GëSy°emClock
( );

137 
uöt32
 
oßl_√xt_timeout
( );

142 #ifde‡
__˝lu•lus


	@Components/osal/include/ZComDef.h

40 #i‚de‡
ZCOMDEF_H


41 
	#ZCOMDEF_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"comdef.h
"

53 
	~"ßddr.h
"

59 
	#oßl_˝yExtAddr
(
a
, 
b
Ë
	`sAddrExtCpy
(◊), (c⁄° 
uöt8
 *)(b))

	)

60 
	#oßl_ExtAddrEquÆ
(
a
, 
b
Ë
	`sAddrExtCmp
((c⁄° 
uöt8
 *)◊), (c⁄° uöt8 *)(b))

	)

61 
	#oßl_c›yAddªss
(
a
, 
b
Ë
	`sAddrCpy
–(
sAddr_t
 *)◊), (c⁄° sAddr_à*)(bË)

	)

70 
	#DEVICE_BUILD_COORDINATOR
 0x01

	)

71 
	#DEVICE_BUILD_ROUTER
 0x02

	)

72 
	#DEVICE_BUILD_ENDDEVICE
 0x04

	)

75 
	#ZSUCCESS
 
SUCCESS


	)

78 
	#COMPID_OSAL
 0

	)

79 
	#COMPID_MTEL
 1

	)

80 
	#COMPID_MTSPCI
 2

	)

81 
	#COMPID_NWK
 3

	)

82 
	#COMPID_NWKIF
 4

	)

83 
	#COMPID_MACCB
 5

	)

84 
	#COMPID_MAC
 6

	)

85 
	#COMPID_APP
 7

	)

86 
	#COMPID_TEST
 8

	)

88 
	#COMPID_RTG
 9

	)

89 
	#COMPID_DATA
 11

	)

92 
	#COMPID_TEST_NWK_STARTUP
 20

	)

93 
	#COMPID_TEST_SCAN_CONFIRM
 21

	)

94 
	#COMPID_TEST_ASSOC_CONFIRM
 22

	)

95 
	#COMPID_TEST_REMOTE_DATA_CONFIRM
 23

	)

98 
	#ZCD_NV_EXTADDR
 0x0001

	)

99 
	#ZCD_NV_BOOTCOUNTER
 0x0002

	)

100 
	#ZCD_NV_STARTUP_OPTION
 0x0003

	)

101 
	#ZCD_NV_START_DELAY
 0x0004

	)

104 
	#ZCD_NV_NIB
 0x0021

	)

105 
	#ZCD_NV_DEVICE_LIST
 0x0022

	)

106 
	#ZCD_NV_ADDRMGR
 0x0023

	)

107 
	#ZCD_NV_POLL_RATE
 0x0024

	)

108 
	#ZCD_NV_QUEUED_POLL_RATE
 0x0025

	)

109 
	#ZCD_NV_RESPONSE_POLL_RATE
 0x0026

	)

110 
	#ZCD_NV_REJOIN_POLL_RATE
 0x0027

	)

111 
	#ZCD_NV_DATA_RETRIES
 0x0028

	)

112 
	#ZCD_NV_POLL_FAILURE_RETRIES
 0x0029

	)

113 
	#ZCD_NV_STACK_PROFILE
 0x002A

	)

114 
	#ZCD_NV_INDIRECT_MSG_TIMEOUT
 0x002B

	)

115 
	#ZCD_NV_ROUTE_EXPIRY_TIME
 0x002C

	)

116 
	#ZCD_NV_EXTENDED_PAN_ID
 0x002D

	)

117 
	#ZCD_NV_BCAST_RETRIES
 0x002E

	)

118 
	#ZCD_NV_PASSIVE_ACK_TIMEOUT
 0x002F

	)

119 
	#ZCD_NV_BCAST_DELIVERY_TIME
 0x0030

	)

120 
	#ZCD_NV_NWK_MODE
 0x0031

	)

121 
	#ZCD_NV_CONCENTRATOR_ENABLE
 0x0032

	)

122 
	#ZCD_NV_CONCENTRATOR_DISCOVERY
 0x0033

	)

123 
	#ZCD_NV_CONCENTRATOR_RADIUS
 0x0034

	)

124 
	#ZCD_NV_CONCENTRATOR_RC
 0x0036

	)

125 
	#ZCD_NV_NWK_MGR_MODE
 0x0037

	)

126 
	#ZCD_NV_SRC_RTG_EXPIRY_TIME
 0x0038

	)

127 
	#ZCD_NV_ROUTE_DISCOVERY_TIME
 0x0039

	)

128 
	#ZCD_NV_NWK_ACTIVE_KEY_INFO
 0x003A

	)

129 
	#ZCD_NV_NWK_ALTERN_KEY_INFO
 0x003B

	)

130 
	#ZCD_NV_ROUTER_OFF_ASSOC_CLEANUP
 0x003C

	)

131 
	#ZCD_NV_NWK_LEAVE_REQ_ALLOWED
 0x003D

	)

132 
	#ZCD_NV_NWK_CHILD_AGE_ENABLE
 0x003E

	)

133 
	#ZCD_NV_DEVICE_LIST_KA_TIMEOUT
 0x003F

	)

136 
	#ZCD_NV_BINDING_TABLE
 0x0041

	)

137 
	#ZCD_NV_GROUP_TABLE
 0x0042

	)

138 
	#ZCD_NV_APS_FRAME_RETRIES
 0x0043

	)

139 
	#ZCD_NV_APS_ACK_WAIT_DURATION
 0x0044

	)

140 
	#ZCD_NV_APS_ACK_WAIT_MULTIPLIER
 0x0045

	)

141 
	#ZCD_NV_BINDING_TIME
 0x0046

	)

142 
	#ZCD_NV_APS_USE_EXT_PANID
 0x0047

	)

143 
	#ZCD_NV_APS_USE_INSECURE_JOIN
 0x0048

	)

144 
	#ZCD_NV_COMMISSIONED_NWK_ADDR
 0x0049

	)

146 
	#ZCD_NV_APS_NONMEMBER_RADIUS
 0x004B

147 
	#ZCD_NV_APS_LINK_KEY_TABLE
 0x004C

	)

148 
	#ZCD_NV_APS_DUPREJ_TIMEOUT_INC
 0x004D

	)

149 
	#ZCD_NV_APS_DUPREJ_TIMEOUT_COUNT
 0x004E

	)

150 
	#ZCD_NV_APS_DUPREJ_TABLE_SIZE
 0x004F

	)

153 
	#ZCD_NV_SECURITY_LEVEL
 0x0061

	)

154 
	#ZCD_NV_PRECFGKEY
 0x0062

	)

155 
	#ZCD_NV_PRECFGKEYS_ENABLE
 0x0063

	)

156 
	#ZCD_NV_SECURITY_MODE
 0x0064

	)

157 
	#ZCD_NV_SECURE_PERMIT_JOIN
 0x0065

	)

158 
	#ZCD_NV_APS_LINK_KEY_TYPE
 0x0066

	)

159 
	#ZCD_NV_APS_ALLOW_R19_SECURITY
 0x0067

	)

161 
	#ZCD_NV_IMPLICIT_CERTIFICATE
 0x0069

	)

162 
	#ZCD_NV_DEVICE_PRIVATE_KEY
 0x006A

	)

163 
	#ZCD_NV_CA_PUBLIC_KEY
 0x006B

	)

165 
	#ZCD_NV_USE_DEFAULT_TCLK
 0x006D

	)

166 
	#ZCD_NV_TRUSTCENTER_ADDR
 0x006E

	)

167 
	#ZCD_NV_RNG_COUNTER
 0x006F

	)

168 
	#ZCD_NV_RANDOM_SEED
 0x0070

	)

171 
	#ZCD_NV_USERDESC
 0x0081

	)

172 
	#ZCD_NV_NWKKEY
 0x0082

	)

173 
	#ZCD_NV_PANID
 0x0083

	)

174 
	#ZCD_NV_CHANLIST
 0x0084

	)

175 
	#ZCD_NV_LEAVE_CTRL
 0x0085

	)

176 
	#ZCD_NV_SCAN_DURATION
 0x0086

	)

177 
	#ZCD_NV_LOGICAL_TYPE
 0x0087

	)

178 
	#ZCD_NV_NWKMGR_MIN_TX
 0x0088

	)

179 
	#ZCD_NV_NWKMGR_ADDR
 0x0089

	)

181 
	#ZCD_NV_ZDO_DIRECT_CB
 0x008F

	)

184 
	#ZCD_NV_SCENE_TABLE
 0x0091

	)

185 
	#ZCD_NV_MIN_FREE_NWK_ADDR
 0x0092

	)

186 
	#ZCD_NV_MAX_FREE_NWK_ADDR
 0x0093

	)

187 
	#ZCD_NV_MIN_FREE_GRP_ID
 0x0094

	)

188 
	#ZCD_NV_MAX_FREE_GRP_ID
 0x0095

	)

189 
	#ZCD_NV_MIN_GRP_IDS
 0x0096

	)

190 
	#ZCD_NV_MAX_GRP_IDS
 0x0097

	)

193 
	#ZCD_NV_SAPI_ENDPOINT
 0x00A1

	)

199 
	#ZCD_NV_SAS_SHORT_ADDR
 0x00B1

	)

200 
	#ZCD_NV_SAS_EXT_PANID
 0x00B2

	)

201 
	#ZCD_NV_SAS_PANID
 0x00B3

	)

202 
	#ZCD_NV_SAS_CHANNEL_MASK
 0x00B4

	)

203 
	#ZCD_NV_SAS_PROTOCOL_VER
 0x00B5

	)

204 
	#ZCD_NV_SAS_STACK_PROFILE
 0x00B6

	)

205 
	#ZCD_NV_SAS_STARTUP_CTRL
 0x00B7

	)

207 
	#ZCD_NV_SAS_TC_ADDR
 0x00C1

	)

208 
	#ZCD_NV_SAS_TC_MASTER_KEY
 0x00C2

	)

209 
	#ZCD_NV_SAS_NWK_KEY
 0x00C3

	)

210 
	#ZCD_NV_SAS_USE_INSEC_JOIN
 0x00C4

	)

211 
	#ZCD_NV_SAS_PRECFG_LINK_KEY
 0x00C5

	)

212 
	#ZCD_NV_SAS_NWK_KEY_SEQ_NUM
 0x00C6

	)

213 
	#ZCD_NV_SAS_NWK_KEY_TYPE
 0x00C7

	)

214 
	#ZCD_NV_SAS_NWK_MGR_ADDR
 0x00C8

	)

216 
	#ZCD_NV_SAS_CURR_TC_MASTER_KEY
 0x00D1

	)

217 
	#ZCD_NV_SAS_CURR_NWK_KEY
 0x00D2

	)

218 
	#ZCD_NV_SAS_CURR_PRECFG_LINK_KEY
 0x00D3

	)

222 
	#ZCD_NV_TCLK_TABLE_START
 0x0101

	)

223 
	#ZCD_NV_TCLK_TABLE_END
 0x01FF

	)

227 
	#ZCD_NV_APS_LINK_KEY_DATA_START
 0x0201

228 
	#ZCD_NV_APS_LINK_KEY_DATA_END
 0x02FF

	)

232 
	#ZCD_NV_MASTER_KEY_DATA_START
 0x0301

233 
	#ZCD_NV_MASTER_KEY_DATA_END
 0x03FF

	)

243 
	#ZCD_STARTOPT_DEFAULT_CONFIG_STATE
 0x01

	)

244 
	#ZCD_STARTOPT_DEFAULT_NETWORK_STATE
 0x02

	)

245 
	#ZCD_STARTOPT_AUTO_START
 0x04

	)

246 
	#ZCD_STARTOPT_CLEAR_CONFIG
 
ZCD_STARTOPT_DEFAULT_CONFIG_STATE


	)

247 
	#ZCD_STARTOPT_CLEAR_STATE
 
ZCD_STARTOPT_DEFAULT_NETWORK_STATE


	)

250 
	#ZCL_KE_IMPLICIT_CERTIFICATE_LEN
 48

	)

251 
	#ZCL_KE_CA_PUBLIC_KEY_LEN
 22

	)

252 
	#ZCL_KE_DEVICE_PRIVATE_KEY_LEN
 21

	)

259 
uöt8
 
	tbyã
;

260 
uöt16
 
	tUINT16
;

261 
öt16
 
	tINT16
;

265 
AddrNŸPª£¡
 = 0,

266 
AddrGroup
 = 1,

267 
Addr16Bô
 = 2,

268 
Addr64Bô
 = 3,

269 
AddrBrﬂdˇ°
 = 15

272 
	#Z_EXTADDR_LEN
 8

	)

274 
byã
 
	tZL⁄gAddr_t
[
Z_EXTADDR_LEN
];

280 
uöt16
 
sh‹tAddr
;

281 
ZL⁄gAddr_t
 
extAddr
;

282 } 
addr
;

283 
byã
 
addrMode
;

284 } 
	tzAddrTy≥_t
;

287 
	#ZSuc˚ss
 
SUCCESS


	)

288 
	#ZFaûuª
 
FAILURE


	)

289 
	#ZInvÆidP¨amëî
 
INVALIDPARAMETER


	)

292 
	#ZMemEº‹
 0x10

	)

293 
	#ZBuf„rFuŒ
 0x11

	)

294 
	#ZUnsuµ‹ãdMode
 0x12

	)

295 
	#ZMacMemEº‹
 0x13

	)

297 
	#ZS≠iInProgªss
 0x20

	)

298 
	#ZS≠iTimeout
 0x21

	)

299 
	#ZS≠iInô
 0x22

	)

301 
	#ZNŸAuth‹ized
 0x7E

	)

303 
	#ZMÆf‹medCmd
 0x80

	)

304 
	#ZUnsupClu°îCmd
 0x81

	)

307 
	#ZOèAb‹t
 0x95

	)

308 
	#ZOèImageInvÆid
 0x96

	)

309 
	#ZOèWaôF‹D©a
 0x97

	)

310 
	#ZOèNoImageAvaûabÀ
 0x98

	)

311 
	#ZOèRequúeM‹eImage
 0x99

	)

314 
	#ZApsFaû
 0xb1

	)

315 
	#ZApsTabÀFuŒ
 0xb2

	)

316 
	#ZApsIŒegÆReque°
 0xb3

	)

317 
	#ZApsInvÆidBödög
 0xb4

	)

318 
	#ZApsUnsuµ‹ãdAârib
 0xb5

	)

319 
	#ZApsNŸSuµ‹ãd
 0xb6

	)

320 
	#ZApsNoAck
 0xb7

	)

321 
	#ZApsDu∂iˇãE¡ry
 0xb8

	)

322 
	#ZApsNoBoundDevi˚
 0xb9

	)

323 
	#ZApsNŸAŒowed
 0xba

	)

324 
	#ZApsNŸAuthítiˇãd
 0xbb

	)

327 
	#ZSecNoKey
 0xa1

	)

328 
	#ZSecOldFrmCou¡
 0xa2

	)

329 
	#ZSecMaxFrmCou¡
 0xa3

	)

330 
	#ZSecCcmFaû
 0xa4

	)

333 
	#ZNwkInvÆidP¨am
 0xc1

	)

334 
	#ZNwkInvÆidReque°
 0xc2

	)

335 
	#ZNwkNŸPîmôãd
 0xc3

	)

336 
	#ZNwkSèπupFaûuª
 0xc4

	)

337 
	#ZNwkAÃódyPª£¡
 0xc5

	)

338 
	#ZNwkSyncFaûuª
 0xc6

	)

339 
	#ZNwkTabÀFuŒ
 0xc7

	)

340 
	#ZNwkUnknownDevi˚
 0xc8

	)

341 
	#ZNwkUnsuµ‹ãdAâribuã
 0xc9

	)

342 
	#ZNwkNoNëw‹ks
 0xˇ

	)

343 
	#ZNwkLóveUnc⁄fúmed
 0xcb

	)

344 
	#ZNwkNoAck
 0xcc

345 
	#ZNwkNoRouã
 0xcd

	)

348 
	#ZMacSuc˚ss
 0x00

	)

349 
	#ZMacBóc⁄Loss
 0xe0

	)

350 
	#ZMacCh™√lAc˚ssFaûuª
 0xe1

	)

351 
	#ZMacDíõd
 0xe2

	)

352 
	#ZMacDißbÀTrxFaûuª
 0xe3

	)

353 
	#ZMacFaûedSecurôyCheck
 0xe4

	)

354 
	#ZMacFømeTooL⁄g
 0xe5

	)

355 
	#ZMacInvÆidGTS
 0xe6

	)

356 
	#ZMacInvÆidH™dÀ
 0xe7

	)

357 
	#ZMacInvÆidP¨amëî
 0xe8

	)

358 
	#ZMacNoACK
 0xe9

	)

359 
	#ZMacNoBóc⁄
 0xó

	)

360 
	#ZMacNoD©a
 0xeb

	)

361 
	#ZMacNoSh‹tAddr
 0xec

	)

362 
	#ZMacOutOfC≠
 0xed

	)

363 
	#ZMacPANIDC⁄Êi˘
 0xì

	)

364 
	#ZMacRólignmít
 0xef

	)

365 
	#ZMacTønß˘i⁄Expúed
 0xf0

	)

366 
	#ZMacTønß˘i⁄OvîFlow
 0xf1

	)

367 
	#ZMacTxA˘ive
 0xf2

	)

368 
	#ZMacUnAvaûabÀKey
 0xf3

	)

369 
	#ZMacUnsuµ‹ãdAâribuã
 0xf4

	)

370 
	#ZMacUnsuµ‹ãd
 0xf5

	)

371 
	#ZMacSrcM©chInvÆidIndex
 0xff

	)

373 
Sètus_t
 
	tZSètus_t
;

377 
uöt8
 
txCou¡î
;

378 
uöt8
 
txCo°
;

380 
uöt8
 
rxLqi
;

382 
uöt8
 
öKeySeqNum
;

383 
uöt32
 
öFrmC¡r
;

384 
uöt16
 
txFaûuª
;

385 } 
	tlökInfo_t
;

391 
	#SPI_INCOMING_ZTOOL_PORT
 0x21

392 
	#SPI_INCOMING_ZAPP_DATA
 0x22

393 
	#MT_SYS_APP_MSG
 0x23

394 
	#MT_SYS_APP_RSP_MSG
 0x24

395 
	#MT_SYS_OTA_MSG
 0x25

396 

	)

397 
	#AF_DATA_CONFIRM_CMD
 0xFD

398 
	#AF_REFLECT_ERROR_CMD
 0xFE

399 
	#AF_INCOMING_MSG_CMD
 0x1A

400 
	#AF_INCOMING_KVP_CMD
 0x1B

401 
	#AF_INCOMING_GRP_KVP_CMD
 0x1C

402 

	)

405 
	#ZDO_NEW_DSTADDR
 0xD0

406 
	#ZDO_STATE_CHANGE
 0xD1

407 
	#ZDO_MATCH_DESC_RSP_SENT
 0xD2

408 
	#ZDO_CB_MSG
 0xD3

409 
	#ZDO_NETWORK_REPORT
 0xD4

410 
	#ZDO_NETWORK_UPDATE
 0xD5

411 
	#ZDO_ADDR_CHANGE_IND
 0xD6

412 

	)

413 
	#NM_CHANNEL_INTERFERE
 0x31

414 
	#NM_ED_SCAN_CONFIRM
 0x32

415 
	#SAPS_CHANNEL_CHANGE
 0x33

416 
	#ZCL_INCOMING_MSG
 0x34

417 
	#ZCL_KEY_ESTABLISH_IND
 0x35

418 
	#ZCL_OTA_CALLBACK_IND
 0x36

419 

	)

435 #ifde‡
__˝lu•lus


	@Components/osal/include/comdef.h

40 #i‚de‡
COMDEF_H


41 
	#COMDEF_H


	)

43 #ifde‡
__˝lu•lus


54 
	~"hÆ_ty≥s.h
"

55 
	~"hÆ_defs.h
"

60 
	#VOID
 ()

	)

62 
	#NULL_OK


	)

63 
	#INP


	)

64 
	#OUTP


	)

65 
	#UNUSED


	)

66 
	#ONLY


	)

67 
	#READONLY


	)

68 
	#SHARED


	)

69 
	#KEEP


	)

70 
	#RELAX


	)

76 #i‚de‡
Ál£


77 
	#Ál£
 0

	)

80 #i‚de‡
åue


81 
	#åue
 1

	)

84 #i‚de‡
CONST


85 
	#CONST
 c⁄°

	)

88 #i‚de‡
GENERIC


89 
	#GENERIC


	)

93 
	#SUCCESS
 0x00

	)

94 
	#FAILURE
 0x01

	)

95 
	#INVALIDPARAMETER
 0x02

	)

96 
	#INVALID_TASK
 0x03

	)

97 
	#MSG_BUFFER_NOT_AVAIL
 0x04

	)

98 
	#INVALID_MSG_POINTER
 0x05

	)

99 
	#INVALID_EVENT_ID
 0x06

	)

100 
	#INVALID_INTERRUPT_ID
 0x07

	)

101 
	#NO_TIMER_AVAIL
 0x08

	)

102 
	#NV_ITEM_UNINIT
 0x09

	)

103 
	#NV_OPER_FAILED
 0x0A

	)

104 
	#INVALID_MEM_SIZE
 0x0B

	)

105 
	#NV_BAD_ITEM_LEN
 0x0C

	)

112 
uöt8
 
	tSètus_t
;

115 
öt32
 
	töt24
;

116 
uöt32
 
	tuöt24
;

122 
	#SYS_EVENT_MSG
 0x8000

123 

	)

128 
	#KEY_CHANGE
 0xC0

129 

	)

148 #ifde‡
__˝lu•lus


	@Components/osal/include/osal_bufmgr.h

40 #i‚de‡
OSAL_BUFMGR_H


41 
	#OSAL_BUFMGR_H


	)

43 #ifde‡
__˝lu•lus


83 *
oßl_bm_Æloc
–
uöt16
 
size
 );

88 *
oßl_bm_adju°_hódî
–*
∑ylﬂd_±r
, 
öt16
 
size
 );

93 *
oßl_bm_adju°_èû
–*
∑ylﬂd_±r
, 
öt16
 
size
 );

98 
oßl_bm_‰ì
–*
∑ylﬂd_±r
 );

103 #ifde‡
__˝lu•lus


	@Components/osal/include/osal_cbtimer.h

40 #i‚de‡
OSAL_CBTIMER_H


41 
	#OSAL_CBTIMER_H


	)

43 #ifde‡
__˝lu•lus


56 
	#INVALID_TIMER_ID
 0xFF

	)

59 
	#TIMEOUT_TIMER_ID
 0xFE

	)

68 #i‡–
OSAL_CBTIMER_NUM_TASKS
 == 0 )

69 #îr‹ 
CÆlback
 
Timî
 
moduÀ
 
shouldn
't be included (no callbackÅimer isÇeeded)!

70 #ñi‡–
OSAL_CBTIMER_NUM_TASKS
 == 1 )

71 
	#OSAL_CBTIMER_PROCESS_EVENT
–
a
 ) (á )

	)

72 #ñi‡–
OSAL_CBTIMER_NUM_TASKS
 == 2 )

73 
	#OSAL_CBTIMER_PROCESS_EVENT
–
a
 ) (á ), (á )

	)

75 #îr‹ 
Maximum
 
of
 2 
ˇŒback
 
timî
 
èsks
 
¨e
 
suµ‹ãd
! 
Modify
 
ô
 
hîe
.

87 (*
p‚CbTimî_t
)–
	tuöt8
 *
	tpD©a
 );

100 
oßl_CbTimîInô
–
uöt8
 
èskId
 );

105 
uöt16
 
oßl_CbTimîPro˚ssEvít
–
uöt8
 
èskId
, uöt16 
evíts
 );

110 
Sètus_t
 
oßl_CbTimîSèπ
–
p‚CbTimî_t
 
p‚CbTimî
, 
uöt8
 *
pD©a
,

111 
uöt16
 
timeout
, 
uöt8
 *
pTimîId
 );

116 
Sètus_t
 
oßl_CbTimîUpd©e
–
uöt8
 
timîId
, 
uöt16
 
timeout
 );

121 
Sètus_t
 
oßl_CbTimîSt›
–
uöt8
 
timîId
 );

126 #ifde‡
__˝lu•lus


	@Components/osal/include/osal_snv.h

40 #i‚de‡
OSAL_SNV_H


41 
	#OSAL_SNV_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"hÆ_ty≥s.h
"

65 #ifde‡
OSAL_SNV_UINT16_ID


66 
uöt16
 
	toßlSnvId_t
;

67 
uöt16
 
	toßlSnvLí_t
;

69 
uöt8
 
	toßlSnvId_t
;

70 
uöt8
 
	toßlSnvLí_t
;

88 
uöt8
 
oßl_¢v_öô
( );

102 
uöt8
 
oßl_¢v_ªad
–
oßlSnvId_t
 
id
, 
oßlSnvLí_t
 
Àn
, *
pBuf
);

115 
uöt8
 
oßl_¢v_wrôe
–
oßlSnvId_t
 
id
, 
oßlSnvLí_t
 
Àn
, *
pBuf
);

128 
uöt8
 
oßl_¢v_com∑˘
–uöt8 
thªshﬁd
 );

133 #ifde‡
__˝lu•lus


	@Components/osal/mcu/cc2540/osal_snv.c

44 
	~"hÆ_adc.h
"

45 
	~"hÆ_Êash.h
"

46 
	~"hÆ_ty≥s.h
"

47 
	~"comdef.h
"

48 
	~"OSAL.h
"

49 
	~"oßl_¢v.h
"

50 
	~"hÆ_as£π.h
"

51 
	~"ßddr.h
"

53 #ifde‡
OSAL_SNV_UINT16_ID


62 
	#OSAL_NV_PAGE_SIZE
 
HAL_FLASH_PAGE_SIZE


	)

63 
	#OSAL_NV_PAGES_USED
 
HAL_NV_PAGE_CNT


	)

64 
	#OSAL_NV_PAGE_BEG
 
HAL_NV_PAGE_BEG


	)

65 
	#OSAL_NV_PAGE_END
 (
OSAL_NV_PAGE_BEG
 + 
OSAL_NV_PAGES_USED
 - 1)

	)

68 
	#OSAL_NV_ERASED
 0xFF

	)

71 
	#OSAL_NV_PAGE_HDR_SIZE
 4

	)

74 
	#OSAL_NV_PAGE_NULL
 0

	)

77 
	#OSAL_NV_ITEM_NULL
 0

	)

80 
	#OSAL_NV_WORD_SIZE
 
HAL_FLASH_WORD_SIZE


	)

83 
	#OSAL_NV_PAGE_HDR_OFFSET
 0

	)

88 
	#OSAL_NV_INVALID_LEN_MARK
 0x8000

	)

92 
	#OSAL_NV_INVALID_ID_MARK
 0x8000

	)

97 
	#OSAL_NV_ACTIVE_XFER_DIFF
 0x00100000

	)

100 
	#OSAL_NV_ACTIVE_PAGE_STATE
 
OSAL_NV_ACTIVE_XFER_DIFF


	)

103 
	#OSAL_NV_XFER_PAGE_STATE
 (
OSAL_NV_ACTIVE_PAGE_STATE
 ^ 
OSAL_NV_ACTIVE_XFER_DIFF
)

	)

105 
	#OSAL_NV_MIN_COMPACT_THRESHOLD
 70

106 
	#OSAL_NV_MAX_COMPACT_THRESHOLD
 95

107 

	)

113 #i‡(
deföed
 
HAL_MCU_CC2530
 || deföed 
HAL_MCU_CC2531
)

114 
	#OSAL_NV_CHECK_BUS_VOLTAGE
 (
	`HÆAdcCheckVdd
(
VDD_MIN_FLASH
))

	)

115 #ñi‡
deföed
 
HAL_MCU_CC2533


116 
	#OSAL_NV_CHECK_BUS_VOLTAGE
 (
	`HÆB©M⁄Ród
–
HAL_BATMON_MIN_FLASH
 ))

	)

119 
	#OSAL_NV_CHECK_BUS_VOLTAGE
 
TRUE


	)

129 
uöt16
 
	mid
;

130 
uöt16
 
	mÀn
;

131 } 
	toßlNvIãmHdr_t
;

138 
boﬁ
 
HÆAdcCheckVdd
(
uöt8
 
limô
);

144 #i‚de‡
OAD_KEEP_NV_PAGES


147 #¥agm®
loˇti⁄
="BLENV_ADDRESS_SPACE"

148 
__no_öô
 
uöt8
 
	g_nvBuf
[
OSAL_NV_PAGES_USED
 * 
OSAL_NV_PAGE_SIZE
];

149 #¥agm®
ªquúed
=
_nvBuf


152 #i‡
deföed
 
MAKE_CRC_SHDW


153 #¥agm®
loˇti⁄
="CRC_SHDW"

154 c⁄° 
CODE
 
uöt16
 
	g_¸cShdw
 = 0xFFFF;

155 #¥agm®
ªquúed
=
_¸cShdw


163 
uöt8
 
	ga˘ivePg
;

166 
uöt16
 
	gpgOff
;

171 
uöt8
 
	gÁûF
;

177 
uöt8
 
öôNV
( );

179 
£tA˘ivePage
–
uöt8
 
pg
 );

180 
£tX„rPage
();

181 
îa£Page
–
uöt8
 
pg
 );

182 
˛ónEø£dPage
–
uöt8
 
pg
 );

183 
födOff£t
( );

184 
com∑˘Page
–
uöt8
 
pg
 );

186 
wrôeW‹d
–
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
pBuf
 );

187 
wrôeW‹dM
–
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
pBuf
, 
oßlSnvLí_t
 
˙t
 );

204 
uöt8
 
	$öôNV
( )

206 
uöt32
 
pgHdr
;

207 
uöt8
 
x„rPg
 = 
OSAL_NV_PAGE_NULL
;

208 
uöt8
 
pg
;

210 
ÁûF
 = 
FALSE
;

211 
a˘ivePg
 = 
OSAL_NV_PAGE_NULL
;

214  
pg
 = 
OSAL_NV_PAGE_BEG
;Ög <
OSAL_NV_PAGE_END
;Ög++ )

216 
	`HÆFœshRód
(
pg
, 
OSAL_NV_PAGE_HDR_OFFSET
, (
uöt8
 *)(&
pgHdr
), 
OSAL_NV_PAGE_HDR_SIZE
);

218 i‡–
pgHdr
 =
OSAL_NV_ACTIVE_PAGE_STATE
)

220 i‡(
a˘ivePg
 !
OSAL_NV_PAGE_NULL
)

227 
	`˛ónEø£dPage
(
a˘ivePg
);

228 
	`˛ónEø£dPage
(
pg
);

229 
a˘ivePg
 = 
OSAL_NV_PAGE_NULL
;

233 
a˘ivePg
 = 
pg
;

236 i‡–
pgHdr
 =
OSAL_NV_XFER_PAGE_STATE
)

238 
x„rPg
 = 
pg
;

245 
	`˛ónEø£dPage
(
pg
);

249 i‡(
a˘ivePg
 =
OSAL_NV_PAGE_NULL
)

251 i‡(
x„rPg
 =
OSAL_NV_PAGE_NULL
)

255 
	`£tA˘ivePage
(
OSAL_NV_PAGE_BEG
);

256 
pgOff
 = 
OSAL_NV_PAGE_HDR_SIZE
;

262  (!
ÁûF
);

268 
a˘ivePg
 = 
x„rPg
;

269 
	`födOff£t
();

271 
	`com∑˘Page
(
x„rPg
);

276 i‡(
x„rPg
 !
OSAL_NV_PAGE_NULL
)

280 
	`îa£Page
(
x„rPg
);

284 
	`födOff£t
();

287  
TRUE
;

288 
	}
}

299 
	$£tA˘ivePage
–
uöt8
 
pg
 )

301 
uöt32
 
pgHdr
;

303 
pgHdr
 = 
OSAL_NV_ACTIVE_PAGE_STATE
;

305 
	`wrôeW‹d
–
pg
, 
OSAL_NV_PAGE_HDR_OFFSET
, (
uöt8
*Ë&
pgHdr
 );

306 i‡(!
ÁûF
)

308 
a˘ivePg
 = 
pg
;

310 
	}
}

321 
	$£tX„rPage
()

323 
uöt32
 
pgHdr
;

326 
pgHdr
 = 
OSAL_NV_XFER_PAGE_STATE
;

328 
	`wrôeW‹d
–
a˘ivePg
, 
OSAL_NV_PAGE_HDR_OFFSET
, (
uöt8
*)&
pgHdr
 );

329 
	}
}

340 
	$îa£Page
–
uöt8
 
pg
 )

342 i‡–!
OSAL_NV_CHECK_BUS_VOLTAGE
 || 
ÁûF
)

344 
ÁûF
 = 
TRUE
;

348 
	`HÆFœshEø£
(
pg
);

352 
uöt16
 
off£t
;

353 
uöt8
 
tmp
;

355 
off£t
 = 0; off£à< 
OSAL_NV_PAGE_SIZE
; offset ++)

357 
	`HÆFœshRód
(
pg
, 
off£t
, &
tmp
, 1);

358 i‡(
tmp
 !
OSAL_NV_ERASED
)

360 
ÁûF
 = 
TRUE
;

365 
	}
}

376 
	$˛ónEø£dPage
–
uöt8
 
pg
 )

378 
uöt8
 
buf
;

379 
uöt16
 
off£t
;

381 
off£t
 = 0; off£à< 
OSAL_NV_PAGE_SIZE
; offset ++)

383 
	`HÆFœshRód
(
pg
, 
off£t
, &
buf
, 1);

384 i‡(
buf
 !
OSAL_NV_ERASED
)

386 
	`îa£Page
(
pg
);

390 
	}
}

402 
	$födOff£t
()

404 
uöt16
 
off£t
;

405 
off£t
 = 
OSAL_NV_PAGE_SIZE
 - 
OSAL_NV_WORD_SIZE
;

406 
off£t
 >
OSAL_NV_PAGE_HDR_SIZE
;

407 
off£t
 -
OSAL_NV_WORD_SIZE
)

409 
uöt32
 
tmp
;

411 
	`HÆFœshRód
(
a˘ivePg
, 
off£t
, (
uöt8
 *)&
tmp
, 
OSAL_NV_WORD_SIZE
);

412 i‡(
tmp
 != 0xFFFFFFFF)

417 
pgOff
 = 
off£t
 + 
OSAL_NV_WORD_SIZE
;

418 
	}
}

434 
uöt16
 
	$födIãm
(
uöt8
 
pg
, 
uöt16
 
off£t
, 
oßlSnvId_t
 
id
)

436 
off£t
 -
OSAL_NV_WORD_SIZE
;

438 
off£t
 >
OSAL_NV_PAGE_HDR_SIZE
)

440 
oßlNvIãmHdr_t
 
hdr
;

442 
	`HÆFœshRód
(
pg
, 
off£t
, (
uöt8
 *Ë&
hdr
, 
OSAL_NV_WORD_SIZE
);

444 i‡(
hdr
.
id
 == id)

448 
uöt8
 
Àn
 = 
hdr
.À¿& ~
OSAL_NV_INVALID_LEN_MARK
;

449  
off£t
 - 
Àn
;

451 i‡(
hdr
.
Àn
 & 
OSAL_NV_INVALID_LEN_MARK
)

453 
off£t
 -
OSAL_NV_WORD_SIZE
;

458 i‡(
hdr
.
Àn
 + 
OSAL_NV_WORD_SIZE
 <
off£t
)

461 
off£t
 -
hdr
.
Àn
 + 
OSAL_NV_WORD_SIZE
;

468 
	`HAL_ASSERT_FORCED
();

474 
	}
}

490 
	$wrôeIãm
–
uöt8
 
pg
, 
uöt16
 
off£t
, 
oßlSnvId_t
 
id
, uöt16 
Æig√dLí
, uöt8 *
pBuf
 )

492 
oßlNvIãmHdr_t
 
hdr
;

494 
hdr
.
id
 = 0xFFFF;

495 
hdr
.
Àn
 = 
Æig√dLí
 | 
OSAL_NV_INVALID_LEN_MARK
;

498 
	`wrôeW‹d
(
pg
, 
off£t
 + 
Æig√dLí
, (
uöt8
 *Ë&
hdr
);

501 
hdr
.
Àn
 &~
OSAL_NV_INVALID_LEN_MARK
;

502 
	`wrôeW‹d
(
pg
, 
off£t
 + 
Æig√dLí
, (
uöt8
 *Ë&
hdr
);

505 
	`wrôeW‹dM
(
pg
, 
off£t
, 
pBuf
, 
Æig√dLí
 / 
OSAL_NV_WORD_SIZE
);

508 
hdr
.
id
 = id | 
OSAL_NV_INVALID_ID_MARK
;

509 
	`wrôeW‹d
(
pg
, 
off£t
 + 
Æig√dLí
, (
uöt8
 *Ë&
hdr
);

512 
hdr
.
id
 &~
OSAL_NV_INVALID_ID_MARK
;

513 
	`wrôeW‹d
(
pg
, 
off£t
 + 
Æig√dLí
, (
uöt8
 *Ë&
hdr
);

514 
	}
}

529 
	$x„rIãm
–
uöt8
 
pg
, 
uöt16
 
off£t
, uöt16 
Æig√dLí
, uöt16 
§cOff
 )

531 
uöt8
 
tmp
[
OSAL_NV_WORD_SIZE
];

532 
uöt16
 
i
 = 0;

535 
i
 <
Æig√dLí
)

537 
	`HÆFœshRód
(
a˘ivePg
, 
§cOff
 + 
i
, 
tmp
, 
OSAL_NV_WORD_SIZE
);

538 
	`wrôeW‹d
(
pg
, 
off£t
 + 
i
, 
tmp
);

540 
i
 +
OSAL_NV_WORD_SIZE
;

542 
	}
}

557 
	$com∑˘Page
–
uöt8
 
§cPg
 )

559 
uöt16
 
§cOff
, 
d°Off
;

560 
uöt8
 
d°Pg
;

561 
oßlSnvId_t
 
œ°Id
 = (osalSnvId_t) 0xFFFF;

563 
d°Pg
 = (
§cPg
 =
OSAL_NV_PAGE_BEG
)? 
OSAL_NV_PAGE_END
 : OSAL_NV_PAGE_BEG;

565 
d°Off
 = 
OSAL_NV_PAGE_HDR_SIZE
;

568 
§cOff
 = 
pgOff
 - (
oßlNvIãmHdr_t
);

570 
§cOff
 >
OSAL_NV_PAGE_HDR_SIZE
)

572 
oßlNvIãmHdr_t
 
hdr
;

574 i‡(
ÁûF
)

580 
	`HÆFœshRód
(
§cPg
, 
§cOff
, (
uöt8
 *Ë&
hdr
, 
OSAL_NV_WORD_SIZE
);

582 i‡(
hdr
.
id
 == 0xFFFF)

585 i‡(
hdr
.
Àn
 & 
OSAL_NV_INVALID_LEN_MARK
)

587 
§cOff
 -
OSAL_NV_WORD_SIZE
;

591 i‡(
hdr
.
Àn
 + 
OSAL_NV_WORD_SIZE
 <
§cOff
)

593 
§cOff
 -
hdr
.
Àn
 + 
OSAL_NV_WORD_SIZE
;

611 
	`HAL_ASSERT_FORCED
();

620 i‡(!(
hdr
.
id
 & 
OSAL_NV_INVALID_ID_MARK
Ë&& hdr.id !
œ°Id
)

624 
œ°Id
 = (
oßlSnvId_t
Ë
hdr
.
id
;

627 i‡(
	`födIãm
(
d°Pg
, 
d°Off
, 
œ°Id
) == 0)

633 
	`x„rIãm
(
d°Pg
, 
d°Off
, 
hdr
.
Àn
, 
§cOff
 - hdr.len);

635 
d°Off
 +
hdr
.
Àn
 + 
OSAL_NV_WORD_SIZE
;

638 
§cOff
 -
hdr
.
Àn
 + 
OSAL_NV_WORD_SIZE
;

643 
	`£tA˘ivePage
(
d°Pg
);

645 i‡(!
ÁûF
)

647 
pgOff
 = 
d°Off
;

651 
	`îa£Page
(
§cPg
);

652 
	}
}

666 
	$vîifyW‹dM
–
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
pBuf
, 
oßlSnvLí_t
 
˙t
 )

668 
uöt8
 
tmp
[
OSAL_NV_WORD_SIZE
];

670 
˙t
--)

674 
	`HÆFœshRód
(
pg
, 
off£t
, 
tmp
, 
OSAL_NV_WORD_SIZE
);

675 i‡(
FALSE
 =
	`oßl_memcmp
(
tmp
, 
pBuf
, 
OSAL_NV_WORD_SIZE
))

677 
ÁûF
 = 
TRUE
;

680 
off£t
 +
OSAL_NV_WORD_SIZE
;

681 
pBuf
 +
OSAL_NV_WORD_SIZE
;

683 
	}
}

696 
	$wrôeW‹d
–
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
pBuf
 )

698 
uöt16
 
addr
 = (
off£t
 >> 2Ë+ ((uöt16)
pg
 << 9);

700 i‡–!
ÁûF
 )

702 
	`HÆFœshWrôe
(
addr
, 
pBuf
, 1);

703 
	`vîifyW‹dM
(
pg
, 
off£t
, 
pBuf
, 1);

705 
	}
}

719 
	$wrôeW‹dM
–
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
buf
, 
oßlSnvLí_t
 
˙t
 )

721 
uöt16
 
addr
 = (
off£t
 >> 2Ë+ ((uöt16)
pg
 << 9);

723 i‡–!
ÁûF
 )

725 
	`HÆFœshWrôe
(
addr
, 
buf
, 
˙t
);

726 
	`vîifyW‹dM
(
pg
, 
off£t
, 
buf
, 
˙t
);

728 
	}
}

737 
uöt8
 
	$oßl_¢v_öô
( )

739 i‡(!
	`öôNV
())

742 
	`HAL_ASSERT_FORCED
();

744  
FAILURE
;

747  
SUCCESS
;

748 
	}
}

761 
uöt8
 
	$oßl_¢v_wrôe
–
oßlSnvId_t
 
id
, 
oßlSnvLí_t
 
Àn
, *
pBuf
 )

763 
uöt16
 
Æig√dLí
;

766 
uöt16
 
off£t
 = 
	`födIãm
(
a˘ivePg
, 
pgOff
, 
id
);

768 i‡(
off£t
 > 0)

770 
uöt8
 
tmp
;

771 
oßlSnvLí_t
 
i
;

773 
i
 = 0; i < 
Àn
; i++)

775 
	`HÆFœshRód
(
a˘ivePg
, 
off£t
, &
tmp
, 1);

776 i‡(
tmp
 !((
uöt8
 *)
pBuf
)[
i
])

780 
off£t
++;

783 i‡(
i
 =
Àn
)

787  
SUCCESS
;

792 
Æig√dLí
 = ((
Àn
 + 
OSAL_NV_WORD_SIZE
 - 1) / OSAL_NV_WORD_SIZE) * OSAL_NV_WORD_SIZE;

794 i‡–
pgOff
 + 
Æig√dLí
 + 
OSAL_NV_WORD_SIZE
 > 
OSAL_NV_PAGE_SIZE
 )

796 
	`£tX„rPage
();

797 
	`com∑˘Page
(
a˘ivePg
);

801 
	`wrôeIãm
(
a˘ivePg
, 
pgOff
, 
id
, 
Æig√dLí
, 
pBuf
);

802 i‡(
ÁûF
)

804  
NV_OPER_FAILED
;

807 
pgOff
 +
Æig√dLí
 + 
OSAL_NV_WORD_SIZE
;

809  
SUCCESS
;

810 
	}
}

824 
uöt8
 
	$oßl_¢v_ªad
–
oßlSnvId_t
 
id
, 
oßlSnvLí_t
 
Àn
, *
pBuf
 )

826 
uöt16
 
off£t
 = 
	`födIãm
(
a˘ivePg
, 
pgOff
, 
id
);

828 i‡(
off£t
 != 0)

830 
	`HÆFœshRód
(
a˘ivePg
, 
off£t
, 
pBuf
, 
Àn
);

831  
SUCCESS
;

833  
NV_OPER_FAILED
;

834 
	}
}

847 
uöt8
 
	$oßl_¢v_com∑˘
–
uöt8
 
thªshﬁd
 )

849 i‡––
thªshﬁd
 < 
OSAL_NV_MIN_COMPACT_THRESHOLD
 ) ||

850 –
thªshﬁd
 > 
OSAL_NV_MAX_COMPACT_THRESHOLD
 ) )

852  
INVALIDPARAMETER
;

856 i‡––(
uöt32
)
pgOff
 * 100 ) >–
OSAL_NV_PAGE_SIZE
 * (uöt32)
thªshﬁd
 ) )

858 
	`£tX„rPage
();

859 
	`com∑˘Page
(
a˘ivePg
);

861  
SUCCESS
;

864  
NV_OPER_FAILED
;

865 
	}
}

	@Components/services/saddr/saddr.h

40 #i‚de‡
SADDR_H


41 
	#SADDR_H


	)

44 #ifde‡
__˝lu•lus


53 
	#SADDR_EXT_LEN
 8

	)

56 
	#SADDR_MODE_NONE
 0

	)

57 
	#SADDR_MODE_SHORT
 2

	)

58 
	#SADDR_MODE_EXT
 3

	)

65 
uöt8
 
	tsAddrExt_t
[
SADDR_EXT_LEN
];

72 
uöt16
 
sh‹tAddr
;

73 
sAddrExt_t
 
extAddr
;

74 } 
addr
;

75 
uöt8
 
addrMode
;

76 } 
	tsAddr_t
;

92 
boﬁ
 
sAddrCmp
(c⁄° 
sAddr_t
 *
pAddr1
, c⁄° sAddr_à*
pAddr2
);

119 
boﬁ
 
sAddrIdí
(c⁄° 
sAddr_t
 *
pAddr1
, c⁄° sAddr_à*
pAddr2
);

136 
sAddrCpy
(
sAddr_t
 *
pDe°
, c⁄° sAddr_à*
pSrc
);

152 
boﬁ
 
sAddrExtCmp
(c⁄° 
uöt8
 * 
pAddr1
, c⁄° uöt8 * 
pAddr2
);

169 *
sAddrExtCpy
(
uöt8
 * 
pDe°
, c⁄° uöt8 * 
pSrc
);

171 #ifde‡
__˝lu•lus


	@Projects/ble/BloodPressure/Source/BloodPressure_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

69 
	$maö
()

72 
	`HAL_BOARD_INIT
();

75 
	`InôBﬂrd
–
OB_COLD
 );

78 
	`HÆDrivîInô
();

81 
	`oßl_¢v_öô
();

86 
	`oßl_öô_sy°em
();

89 
	`HAL_ENABLE_INTERRUPTS
();

92 
	`InôBﬂrd
–
OB_READY
 );

94 #i‡
	`deföed
 ( 
POWER_SAVING
 )

95 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

99 
	`oßl_°¨t_sy°em
();

102 
	}
}

	@Projects/ble/BloodPressure/Source/OSAL_BloodPressure.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 
	~"≥rùhîÆ.h
"

77 
	~"bloodPªssuª.h
"

84 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

86 
LL_Pro˚ssEvít
,

87 
HÆ_Pro˚ssEvít
,

88 
HCI_Pro˚ssEvít
,

89 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

90 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

92 
L2CAP_Pro˚ssEvít
,

93 
GAP_Pro˚ssEvít
,

94 
GATT_Pro˚ssEvít
,

95 
SM_Pro˚ssEvít
,

96 
GAPRﬁe_Pro˚ssEvít
,

97 
GAPB⁄dMgr_Pro˚ssEvít
,

98 
GATTSîvAµ_Pro˚ssEvít
,

99 
BloodPªssuª_Pro˚ssEvít


102 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

103 
uöt16
 *
	gèsksEvíts
;

118 
	$oßlInôTasks
( )

120 
uöt8
 
èskID
 = 0;

122 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

123 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

126 
	`LL_Inô
–
èskID
++ );

129 
	`HÆ_Inô
–
èskID
++ );

132 
	`HCI_Inô
–
èskID
++ );

134 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

136 
	`oßl_CbTimîInô
–
èskID
 );

137 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

141 
	`L2CAP_Inô
–
èskID
++ );

144 
	`GAP_Inô
–
èskID
++ );

147 
	`GATT_Inô
–
èskID
++ );

150 
	`SM_Inô
–
èskID
++ );

153 
	`GAPRﬁe_Inô
–
èskID
++ );

154 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

156 
	`GATTSîvAµ_Inô
–
èskID
++ );

159 
	`BloodPªssuª_Inô
–
èskID
 );

160 
	}
}

	@Projects/ble/BloodPressure/Source/bloodPressure.c

46 
	~"bcomdef.h
"

47 
	~"OSAL.h
"

48 
	~"OSAL_PwrMgr.h
"

49 
	~"OnBﬂrd.h
"

50 
	~"hÆ_adc.h
"

51 
	~"hÆ_Àd.h
"

52 
	~"hÆ_lcd.h
"

53 
	~"hÆ_key.h
"

54 
	~"g©t.h
"

55 
	~"hci.h
"

56 
	~"g≠g©t£rvî.h
"

57 
	~"g©t£rv≠p.h
"

58 
	~"lökdb.h
"

59 
	~"≥rùhîÆ.h
"

60 
	~"g≠b⁄dmgr.h
"

61 
	~"bp£rvi˚.h
"

62 
	~"devöfo£rvi˚.h
"

63 
	~"bloodPªssuª.h
"

64 
	~"timóµ.h
"

65 
	~"OSAL_Clock.h
"

76 
	#DEFAULT_DISCOVERABLE_MODE
 
GAP_ADTYPE_FLAGS_LIMITED


	)

80 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

83 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 200

	)

86 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 1600

	)

89 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 1

	)

92 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

95 
	#FLAGS_IDX_MAX
 7

96 

	)

98 
	#B_ADDR_STR_LEN
 15

	)

101 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

104 
	#DEFAULT_PAIRING_MODE
 
GAPBOND_PAIRING_MODE_INITIATE


	)

107 
	#DEFAULT_MITM_MODE
 
FALSE


	)

110 
	#DEFAULT_BONDING_MODE
 
TRUE


	)

113 
	#DEFAULT_IO_CAPABILITIES
 
GAPBOND_IO_CAP_DISPLAY_ONLY


	)

116 
	#DEFAULT_DISCOVERY_DELAY
 1000

	)

118 
	#BP_DISCONNECT_PERIOD
 6000

	)

120 
	#CUFF_MAX
 40

	)

122 
	#TIMER_CUFF_PERIOD
 500

	)

124 
	#BP_STORE_MAX
 4

125 

	)

136 
uöt8
 
	gbloodPªssuªTaskId
;

139 
uöt16
 
	gg≠C⁄nH™dÀ
;

142 
uöt8
 
	gtimeC⁄figD⁄e
;

158 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

161 
uöt8
 
	gtimeAµDiscSèã
 = 
DISC_IDLE
;

164 
uöt8
 
	gtimeAµDiscovîyCm∂
 = 
FALSE
;

167 
uöt8
 
	gtimeAµC⁄figSèã
 = 
TIMEAPP_CONFIG_START
;

170 
uöt8
 
	gtimeAµPaúögSèπed
 = 
FALSE
;

173 
uöt8
 
	gtimeAµDiscPo°p⁄ed
 = 
FALSE
;

177 
uöt8
 
	gsˇnRe•⁄£D©a
[] =

180 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

203 
GAP_ADTYPE_SLAVE_CONN_INTERVAL_RANGE
,

204 
LO_UINT16
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
 ),

205 
HI_UINT16
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
 ),

206 
LO_UINT16
–
DEFAULT_DESIRED_MAX_CONN_INTERVAL
 ),

207 
HI_UINT16
–
DEFAULT_DESIRED_MAX_CONN_INTERVAL
 ),

209 
GAP_ADTYPE_POWER_LEVEL
,

214 
uöt8
 
	gadvîtD©a
[] =

220 
GAP_ADTYPE_FLAGS
,

221 
DEFAULT_DISCOVERABLE_MODE
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

225 
GAP_ADTYPE_16BIT_MORE
,

226 
LO_UINT16
–
BLOODPRESSURE_SERV_UUID
 ),

227 
HI_UINT16
–
BLOODPRESSURE_SERV_UUID
 )

236 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "BloodPressure Sensor";

239 
boﬁ
 
	gtimeAµB⁄ded
 = 
FALSE
;

242 
uöt8
 
	gtimeAµB⁄dedAddr
[
B_ADDR_LEN
];

245 
uöt8
 
	gœ°C⁄nAddr
[
B_ADDR_LEN
] = {0xf,0xf,0xf,0xf,0xf,0xe};;

247 
boﬁ
 
	gc⁄√˘edToLa°Addªss
 = 
Ál£
;

251 
uöt16
 
	gg≠C⁄nH™dÀ
;

258 
©tH™dÀVÆueInd_t
 
	gbloodPªssuªMós
;

259 
©tH™dÀVÆueNŸi_t
 
	gbloodPªssuªIMós
;

260 
uöt16
 
	gbpSy°ﬁic
 = 120;

261 
uöt16
 
	gbpDü°ﬁic
 = 80;

262 
uöt16
 
	gbpMAP
 = 90;

263 
uöt16
 
	gbpPul£R©e
 = 60;

264 
uöt8
 
	gbpU£rId
 = 1;

265 
uöt16
 
	gbpMósSètus
 = 0;

271 c⁄° 
uöt8
 
	gbloodPªssuªFœgs
[
FLAGS_IDX_MAX
] =

273 
BLOODPRESSURE_FLAGS_MMHG
 | 
BLOODPRESSURE_FLAGS_TIMESTAMP
 |
BLOODPRESSURE_FLAGS_PULSE
| 
BLOODPRESSURE_FLAGS_USER
 | 
BLOODPRESSURE_FLAGS_STATUS
,

274 
BLOODPRESSURE_FLAGS_MMHG
 | 
BLOODPRESSURE_FLAGS_TIMESTAMP
,

275 
BLOODPRESSURE_FLAGS_MMHG
,

276 
BLOODPRESSURE_FLAGS_KPA
,

277 
BLOODPRESSURE_FLAGS_KPA
 | 
BLOODPRESSURE_FLAGS_TIMESTAMP
,

278 
BLOODPRESSURE_FLAGS_KPA
 | 
BLOODPRESSURE_FLAGS_TIMESTAMP
 | 
BLOODPRESSURE_FLAGS_PULSE
,

285 
	mBPM_STATE_IDLE
,

286 
	mBPM_STATE_ADVERTISING
,

287 
	mBPM_STATE_CONNECTED


293 
	mBPM_MEAS_STATE_IDLE
,

294 
	mBPM_MEAS_STATE_ACTIVE
,

295 
	mBPM_MEAS_STATE_READY


299 
uöt8
 
	gbloodPªssuªFœgsIdx
 = 0;

302 
uöt8
 
	gcuffCou¡
 = 0;

304 
©tH™dÀVÆueInd_t
 
	gbpSt‹eMós
[10];

305 
uöt8
 
	gbpSt‹eSèπIndex
 =0;

306 
uöt8
 
	gbpSt‹eIndex
 = 0;

314 
bloodPªssuªPro˚ssG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

315 
bloodPªssuª_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

316 
≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

317 
bloodPªssuª_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

318 
bpFöÆMós
();

319 
cuffMós
();

320 
bpSîvi˚CB
(
uöt8
 
evít
);

321 
timeAµPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

322 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 );

323 
timeAµPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 );

324 
simuœãMós
( );

325 
bpSt‹eIndiˇti⁄s
(
©tH™dÀVÆueInd_t
* 
pInd
);

326 
bpSídSt‹edMós
();

327 
upd©eUI
( );

329 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

330 *
bdAddr2Så
 ( 
uöt8
 *
pAddr
 );

338 
g≠RﬁesCBs_t
 
	gbloodPªssuª_PîùhîÆCBs
 =

340 
≥rùhîÆSèãNŸifiˇti⁄CB
,

341 
NULL


345 c⁄° 
g≠B⁄dCBs_t
 
	gtimeAµB⁄dCB
 =

347 
timeAµPasscodeCB
,

348 
timeAµPaúSèãCB


369 
	$BloodPªssuª_Inô
–
uöt8
 
èsk_id
 )

371 
bloodPªssuªTaskId
 = 
èsk_id
;

384 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

389 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

391 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

392 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

393 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

394 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

395 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

398 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

399 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

401 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnRe•⁄£D©a
 ), scanResponseData );

403 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

405 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

406 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

407 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

408 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

409 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

413 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
©tDevi˚Name
 );

417 
uöt32
 
∑sskey
 = 0;

418 
uöt8
 
∑úMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

419 
uöt8
 
môm
 = 
FALSE
;

420 
uöt8
 
ioC≠
 = 
GAPBOND_IO_CAP_DISPLAY_ONLY
;

421 
uöt8
 
b⁄dög
 = 
TRUE
;

422 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
,  ( 
uöt32
 ), &
∑sskey
 );

423 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

424 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

425 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

426 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

430 
timeC⁄figD⁄e
 = 
FALSE
;

433 
VOID
 
	`GATT_InôClõ¡
();

436 
	`GATT_Regi°îF‹Ind
–
bloodPªssuªTaskId
 );

439 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

440 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

441 
	`BloodPªssuª_AddSîvi˚
–
GATT_ALL_SERVICES
 );

442 
	`DevInfo_AddSîvi˚
( );

445 
	`BloodPªssuª_Regi°î
–
bpSîvi˚CB
 );

448 
	`Regi°îF‹Keys
–
bloodPªssuªTaskId
 );

450 #i‡
	`deföed
–
CC2540_MINIDK
 )

452 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

458 
P0SEL
 = 0;

459 
P1SEL
 = 0;

460 
P2SEL
 = 0;

462 
P0DIR
 = 0xFC;

464 
P1DIR
 = 0xFF;

465 
P2DIR
 = 0x1F;

467 
P0
 = 0x03;

468 
P1
 = 0;

469 
P2
 = 0;

474 
	`oßl_£t_evít
–
bloodPªssuªTaskId
, 
BP_START_DEVICE_EVT
 );

477 
	`upd©eUI
();

479 
	}
}

494 
uöt16
 
	$BloodPªssuª_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

497 
VOID
 
èsk_id
;

499 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

501 
uöt8
 *
pMsg
;

503 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
bloodPªssuªTaskId
 )Ë!
NULL
 )

505 
	`bloodPªssuª_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

508 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

512  (
evíts
 ^ 
SYS_EVENT_MSG
);

515 i‡–
evíts
 & 
BP_START_DEVICE_EVT
 )

518 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
bloodPªssuª_PîùhîÆCBs
 );

521 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
timeAµB⁄dCB
 );

523 
	`upd©eUI
();

525  ( 
evíts
 ^ 
BP_START_DEVICE_EVT
 );

528 i‡–
evíts
 & 
BP_START_DISCOVERY_EVT
 )

530 i‡–
timeAµPaúögSèπed
 )

533 
timeAµDiscPo°p⁄ed
 = 
TRUE
;

537 
timeAµDiscSèã
 = 
	`timeAµDiscSèπ
();

539  ( 
evíts
 ^ 
BP_START_DISCOVERY_EVT
 );

545 i‡–
evíts
 & 
TIMER_BPMEAS_EVT
 )

548 
	`bpFöÆMós
();

550  (
evíts
 ^ 
TIMER_BPMEAS_EVT
);

556 i‡–
evíts
 & 
BP_TIMER_CUFF_EVT
 )

559 
	`cuffMós
();

561 
cuffCou¡
++;

564 if(
cuffCou¡
 < 
CUFF_MAX
)

567 
	`oßl_°¨t_timîEx
–
bloodPªssuªTaskId
, 
BP_TIMER_CUFF_EVT
, 
TIMER_CUFF_PERIOD
 );

574 
	`oßl_°¨t_timîEx
–
bloodPªssuªTaskId
, 
TIMER_BPMEAS_EVT
, 
TIMER_CUFF_PERIOD
 );

577  (
evíts
 ^ 
BP_TIMER_CUFF_EVT
);

581 i‡–
evíts
 & 
BP_CCC_UPDATE_EVT
 )

583 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

587 if–
c⁄√˘edToLa°Addªss
 =
åue
)

590 
	`bpSídSt‹edMós
();

594  (
evíts
 ^ 
BP_CCC_UPDATE_EVT
);

598 i‡–
evíts
 & 
BP_DISCONNECT_EVT
 )

601 
uöt8
 
advE«bÀ
 = 
FALSE
;

604 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advE«bÀ
 );

606 
	`HÆLedSë
 ( 
HAL_LED_1
, 
HAL_LED_MODE_ON
 );

609 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

611  (
evíts
 ^ 
BP_DISCONNECT_EVT
);

615 
	}
}

626 
	$bloodPªssuª_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

628  
pMsg
->
evít
 )

630 
KEY_CHANGE
:

631 
	`bloodPªssuª_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

634 
GATT_MSG_EVENT
:

635 
	`bloodPªssuªPro˚ssG©tMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

640 
	}
}

654 
	$bloodPªssuª_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

657 i‡–
keys
 & 
HAL_KEY_SW_1
 )

660 i‡(++
bloodPªssuªFœgsIdx
 =
FLAGS_IDX_MAX
)

662 
bloodPªssuªFœgsIdx
 = 0;

666 i‡–
keys
 & 
HAL_KEY_SW_2
 )

670 if–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

672 
uöt8
 
cuºít_adv_íabÀd_°©us
;

673 
uöt8
 
√w_adv_íabÀd_°©us
;

676 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
cuºít_adv_íabÀd_°©us
 );

678 if–
cuºít_adv_íabÀd_°©us
 =
FALSE
 )

679 
√w_adv_íabÀd_°©us
 = 
TRUE
;

681 
√w_adv_íabÀd_°©us
 = 
FALSE
;

684 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
√w_adv_íabÀd_°©us
 );

687 
	`oßl_°¨t_timîEx
–
bloodPªssuªTaskId
, 
BP_TIMER_CUFF_EVT
, 
TIMER_CUFF_PERIOD
 );

690 
cuffCou¡
 = 0;

695 
	`simuœãMós
();

698 
	}
}

707 
	$bpFöÆMós
()

711 
uöt8
 *
p
 = 
bloodPªssuªMós
.
vÆue
;

714 
uöt8
 
Êags
 = 
bloodPªssuªFœgs
[
bloodPªssuªFœgsIdx
];

717 *
p
++ = 
Êags
;

720 *
p
++ = 
bpSy°ﬁic
;

721 *
p
++;

722 *
p
++ = 
bpDü°ﬁic
;

723 *
p
++;

724 *
p
++ = 
bpMAP
;

725 *
p
++;

728 i‡(
Êags
 & 
BLOODPRESSURE_FLAGS_TIMESTAMP
)

731 
UTCTimeSåu˘
 
time
;

734 
	`oßl_C⁄vîtUTCTime
–&
time
, 
	`oßl_gëClock
() );

736 *
p
++ = 0x07;

737 *
p
++ = 0xdb;

738 *
p
++=
time
.
m⁄th
;

739 *
p
++=
time
.
day
;

740 *
p
++=
time
.
hour
;

741 *
p
++=
time
.
möuãs
;

742 *
p
++=
time
.
£c⁄ds
;

745 if(
Êags
 & 
BLOODPRESSURE_FLAGS_PULSE
)

747 *
p
++ = 
bpPul£R©e
;

748 *
p
++;

751 if(
Êags
 & 
BLOODPRESSURE_FLAGS_USER
)

753 *
p
++ = 
bpU£rId
;

756 if(
Êags
 & 
BLOODPRESSURE_FLAGS_STATUS
)

758 *
p
++ = 
bpMósSètus
;

759 *
p
++;

762 
bloodPªssuªMós
.
Àn
 = (
uöt8
Ë(
p
 - bloodPªssuªMós.
vÆue
);

765 
	`bpSt‹eIndiˇti⁄s
(&
bloodPªssuªMós
);

768 
	`bpSídSt‹edMós
();

771 
	`oßl_°¨t_timîEx
–
bloodPªssuªTaskId
, 
BP_DISCONNECT_EVT
, 
BP_DISCONNECT_PERIOD
 );

773 
	}
}

784 
	$bpSt‹eIndiˇti⁄s
(
©tH™dÀVÆueInd_t
* 
pInd
)

788 
	`oßl_mem˝y
(&
bpSt‹eMós
[
bpSt‹eIndex
],
pInd
, 
ATT_MTU_SIZE
);

791 
bpSt‹eIndex
 = bpStoreIndex +1;

792 if(
bpSt‹eIndex
 > 
BP_STORE_MAX
)

794 
bpSt‹eIndex
 = 0;

797 if(
bpSt‹eIndex
 =
bpSt‹eSèπIndex
)

799 
bpSt‹eSèπIndex
 = bpStoreStartIndex +1;

800 if(
bpSt‹eSèπIndex
 > 
BP_STORE_MAX
)

802 
bpSt‹eSèπIndex
 = 0;

805 
	}
}

816 
	$bpSídSt‹edMós
()

818 
bSètus_t
 
°©us
;

821 if(
bpSt‹eSèπIndex
 !
bpSt‹eIndex
 )

824 
°©us
 = 
	`BloodPªssuª_MósIndiˇã
–
g≠C⁄nH™dÀ
, &
bpSt‹eMós
[
bpSt‹eSèπIndex
], 
bloodPªssuªTaskId
);

828 if(
°©us
 =
SUCCESS
)

830 
bpSt‹eSèπIndex
 = bpStoreStartIndex +1;

833 if(
bpSt‹eSèπIndex
 > 
BP_STORE_MAX
)

835 
bpSt‹eSèπIndex
 = 0;

839 
	}
}

853 
	$bloodPªssuªPro˚ssG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

857 if–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_CFM
)

859 
	`bpSídSt‹edMós
();

862 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_NOTI
 ||

863 
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_IND
 )

865 
	`timeAµIndG©tMsg
–
pMsg
 );

867 i‡–
pMsg
->
mëhod
 =
ATT_READ_RSP
 ||

868 
pMsg
->
mëhod
 =
ATT_WRITE_RSP
 )

870 
timeAµC⁄figSèã
 = 
	`timeAµC⁄figG©tMsg
 (ÅimeAµC⁄figSèã, 
pMsg
 );

871 i‡–
timeAµC⁄figSèã
 =
TIMEAPP_CONFIG_CMPL
 )

873 
timeAµDiscovîyCm∂
 = 
TRUE
;

878 
timeAµDiscSèã
 = 
	`timeAµDiscG©tMsg
–timeAµDiscSèã, 
pMsg
 );

879 i‡–
timeAµDiscSèã
 =
DISC_IDLE
 )

882 
timeAµC⁄figSèã
 = 
	`timeAµC⁄figNext
–
TIMEAPP_CONFIG_START
 );

885 
	}
}

894 
	$timeAµDisc⁄√˘ed
( )

897 
timeAµDiscSèã
 = 
DISC_IDLE
;

898 
timeAµPaúögSèπed
 = 
FALSE
;

899 
timeAµDiscPo°p⁄ed
 = 
FALSE
;

903 
	`oßl_°›_timîEx
–
bloodPªssuªTaskId
, 
BP_TIMER_CUFF_EVT
 );

907 
uöt16
 
∑øm
 = 0;

908 
	`BloodPªssuª_SëP¨amëî
(
BLOODPRESSURE_MEAS_CHAR_CFG
, (
uöt16
), (
uöt8
 *Ë&
∑øm
);

911 
	`BloodPªssuª_SëP¨amëî
(
BLOODPRESSURE_IMEAS_CHAR_CFG
, (
uöt16
), (
uöt8
 *Ë&
∑øm
);

914 
uöt8
 
advE«bÀ
 = 
FALSE
;

917 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advE«bÀ
 );

919 
	}
}

930 
	$≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

936 i‡–
√wSèã
 =
GAPROLE_CONNECTED
 )

938 
lökDBIãm_t
 *
pIãm
;

941 
	`HÆLedSë
 ( 
HAL_LED_1
, 
HAL_LED_MODE_OFF
 );

944 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_CONNHANDLE
, &
g≠C⁄nH™dÀ
 );

947 i‡–(
pIãm
 = 
	`lökDB_Föd
–
g≠C⁄nH™dÀ
 )Ë!
NULL
)

950 i‡–!
	`oßl_memcmp
–
pIãm
->
addr
, 
timeAµB⁄dedAddr
, 
B_ADDR_LEN
 ) )

952 
timeAµDiscovîyCm∂
 = 
FALSE
;

956 
timeAµDiscovîyCm∂
 = 
TRUE
;

960 if(
	`oßl_memcmp
–
pIãm
->
addr
, 
œ°C⁄nAddr
, 
B_ADDR_LEN
 ))

962 
timeAµDiscovîyCm∂
 = 
TRUE
;

963 
c⁄√˘edToLa°Addªss
 = 
åue
;

968 
	`oßl_mem˝y
(
œ°C⁄nAddr
, 
pIãm
->
addr
, 
B_ADDR_LEN
 );

972 i‡–
timeAµDiscovîyCm∂
 =
FALSE
 )

981 i‡–
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 &&

982 
√wSèã
 !
GAPROLE_CONNECTED
 )

984 
	`timeAµDisc⁄√˘ed
();

987 
	`oßl_°›_timîEx
–
bloodPªssuªTaskId
, 
BP_TIMER_CUFF_EVT
 );

991 i‡–
√wSèã
 =
GAPROLE_STARTED
 )

997 
g≠ProfûeSèã
 = 
√wSèã
;

999 
	`upd©eUI
();

1001 
	}
}

1018 
	$bpSîvi˚CB
(
uöt8
 
evít
)

1022 
evít
)

1024 
BLOODPRESSURE_MEAS_NOTI_ENABLED
:

1026 
	`oßl_£t_evít
–
bloodPªssuªTaskId
, 
BP_CCC_UPDATE_EVT
 );

1033 
	}
}

1043 
	$timeAµPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 )

1045 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_STARTED
 )

1047 
timeAµPaúögSèπed
 = 
TRUE
;

1049 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_COMPLETE
 )

1051 
timeAµPaúögSèπed
 = 
FALSE
;

1053 i‡–
°©us
 =
SUCCESS
 )

1055 
lökDBIãm_t
 *
pIãm
;

1057 i‡–(
pIãm
 = 
	`lökDB_Föd
–
g≠C⁄nH™dÀ
 )Ë!
NULL
 )

1060 
timeAµB⁄ded
 = ( (
pIãm
->
°©eFœgs
 & 
LINK_BOUND
) == LINK_BOUND );

1062 i‡–
timeAµB⁄ded
 )

1064 
	`oßl_mem˝y
–
timeAµB⁄dedAddr
, 
pIãm
->
addr
, 
B_ADDR_LEN
 );

1069 i‡–
timeAµDiscPo°p⁄ed
 && 
timeAµDiscovîyCm∂
 =
FALSE
 )

1071 
timeAµDiscPo°p⁄ed
 = 
FALSE
;

1072 
	`oßl_£t_evít
–
bloodPªssuªTaskId
, 
BP_START_DISCOVERY_EVT
 );

1076 
	}
}

1085 
	$timeAµPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

1086 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 )

1089 
	`GAPB⁄dMgr_PasscodeR•
–
c⁄√˘i⁄H™dÀ
, 
SUCCESS
, 0 );

1090 
	}
}

1100 
	$cuffMós
()

1104 
	`HÆLedSë
 ( 
HAL_LED_2
, 
HAL_LED_MODE_BLINK
 );

1105 
	`HÆLedSë
 ( 
HAL_LED_3
, 
HAL_LED_MODE_BLINK
 );

1106 
	`HÆLedSë
 ( 
HAL_LED_4
, 
HAL_LED_MODE_BLINK
 );

1109 
uöt8
 *
p
 = 
bloodPªssuªIMós
.
vÆue
;

1112 
uöt8
 
Êags
 = 
BLOODPRESSURE_FLAGS_MMHG
 |
BLOODPRESSURE_FLAGS_PULSE
 | 
BLOODPRESSURE_FLAGS_USER
| 
BLOODPRESSURE_FLAGS_STATUS
;

1115 *
p
++ = 
Êags
;

1120 *
p
++ = 
bpSy°ﬁic
;

1121 *
p
++;

1122 *
p
++ = 0xFF;

1123 *
p
++ = 0x07;

1124 *
p
++ = 0xFF;

1125 *
p
++ = 0x07;

1127 if(
Êags
 & 
BLOODPRESSURE_FLAGS_PULSE
)

1129 *
p
++ = 
bpPul£R©e
;

1130 *
p
++;

1133 if(
Êags
 & 
BLOODPRESSURE_FLAGS_USER
)

1135 *
p
++ = 
bpU£rId
;

1138 if(
Êags
 & 
BLOODPRESSURE_FLAGS_STATUS
)

1140 *
p
++ = 
bpMósSètus
;

1141 *
p
++;

1144 
bloodPªssuªIMós
.
Àn
 = (
uöt8
Ë(
p
 - bloodPªssuªIMós.
vÆue
);

1147 
	`BloodPªssuª_IMósNŸify
–
g≠C⁄nH™dÀ
, &
bloodPªssuªIMós
, 
bloodPªssuªTaskId
);

1149 
	}
}

1161 
	$simuœãMós
( )

1164 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

1167 if(
bpSy°ﬁic
 < 150)

1168 
bpSy°ﬁic
 +=1;

1170 
bpSy°ﬁic
 = 80;

1172 if(
bpDü°ﬁic
 < 110)

1173 
bpDü°ﬁic
 +=1;

1175 
bpDü°ﬁic
 = 90;

1177 if(
bpMAP
 < 110)

1178 
bpMAP
 +=1;

1180 
bpMAP
 =70;

1182 if(
bpPul£R©e
 < 140)

1183 
bpPul£R©e
 +=1;

1185 
bpPul£R©e
 =40;

1187 if(
bpU£rId
 < 5)

1188 
bpU£rId
 +=1;

1190 
bpU£rId
 =1;

1192 
	}
}

1194 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

1203 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

1205 
uöt8
 
i
;

1206 
hex
[] = "0123456789ABCDEF";

1207 
°r
[
B_ADDR_STR_LEN
];

1208 *
pSå
 = 
°r
;

1210 *
pSå
++ = '0';

1211 *
pSå
++ = 'x';

1214 
pAddr
 +
B_ADDR_LEN
;

1216  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

1218 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

1219 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

1222 *
pSå
 = 0;

1224  
°r
;

1225 
	}
}

1237 
	$upd©eUI
( )

1240 
	`LCD_WRITE_STRING
–"Blood Pªssuª", 
HAL_LCD_LINE_1
 );

1242 
uöt8
 
ownAddªss
[
B_ADDR_LEN
];

1244 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

1246 
uöt16
 
cou¡
 =0;

1249 if–
bpSt‹eIndex
 > 
bpSt‹eSèπIndex
 )

1251 
cou¡
 = 
bpSt‹eIndex
 - 
bpSt‹eSèπIndex
;

1254 if–
bpSt‹eSèπIndex
 > 
bpSt‹eIndex
 )

1256 
cou¡
 = ( 
BP_STORE_MAX
-
bpSt‹eSèπIndex
 ) + 
bpSt‹eIndex
+1;

1261 
g≠ProfûeSèã
)

1263 
GAPROLE_INIT
:

1264 
	`LCD_WRITE_STRING
–"Inôülized", 
HAL_LCD_LINE_2
 );

1266 
GAPROLE_STARTED
:

1267 
	`LCD_WRITE_STRING
–"Sèπed", 
HAL_LCD_LINE_2
 );

1268 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
ownAddªss
);

1269 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
ownAddªss
 ), 
HAL_LCD_LINE_3
 );

1271 
GAPROLE_ADVERTISING
:

1272 
	`LCD_WRITE_STRING
–"Advîtisög", 
HAL_LCD_LINE_2
 );

1273 
	`LCD_WRITE_STRING
–" ", 
HAL_LCD_LINE_3
 );

1274 
	`LCD_WRITE_STRING_VALUE
("St‹ed", 
cou¡
, 10, 
HAL_LCD_LINE_3
 );

1276 
GAPROLE_WAITING
:

1277 
GAPROLE_WAITING_AFTER_TIMEOUT
:

1278 
	`LCD_WRITE_STRING
–"Waôög ", 
HAL_LCD_LINE_2
 );

1279 
	`LCD_WRITE_STRING_VALUE
("St‹ed", 
cou¡
, 10, 
HAL_LCD_LINE_3
 );

1281 
GAPROLE_CONNECTED
:

1282 
	`LCD_WRITE_STRING
–"C⁄√˘ed ", 
HAL_LCD_LINE_2
 );

1284 
GAPROLE_ERROR
:

1285 
	`LCD_WRITE_STRING
–"Eº‹ ", 
HAL_LCD_LINE_2
 );

1291 
	}
}

	@Projects/ble/BloodPressure/Source/bloodPressure.h

40 #i‚de‡
BLOODPRESSURE_H


41 
	#BLOODPRESSURE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#BP_START_DEVICE_EVT
 0x0001

	)

58 
	#TIMER_BPMEAS_EVT
 0x0002

	)

59 
	#BP_TIMER_CUFF_EVT
 0x0004

	)

60 
	#BP_START_DISCOVERY_EVT
 0x0010

	)

61 
	#CLOCK_UPDATE_EVT
 0x0020

	)

62 
	#ADV_IN_CONNECTION_EVT
 0x0040

	)

63 
	#BP_DISCONNECT_EVT
 0x0080

	)

64 
	#BP_CCC_UPDATE_EVT
 0x0100

	)

73 #i‡
HAL_LCD
 =
TRUE


74 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
Ë
	`HÆLcdWrôeSåög
–(°r), (›ti⁄))

	)

75 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
Ë
	`HÆLcdWrôeS¸ìn
–÷öe1), (löe2Ë)

	)

76 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
Ë
	`HÆLcdWrôeSåögVÆue
–—ôÀ), (vÆue), (f‹m©), (löeË)

	)

78 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
)

	)

79 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
)

	)

80 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
)

	)

94 
BloodPªssuª_Inô
–
uöt8
 
èsk_id
 );

99 
uöt16
 
BloodPªssuª_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

104 #ifde‡
__˝lu•lus


	@Projects/ble/BloodPressure/Source/timeapp.h

40 #i‚de‡
TIMEAPP_H


41 
	#TIMEAPP_H


	)

43 
	~"g©t.h
"

45 #ifde‡
__˝lu•lus


61 
DISC_IDLE
 = 0x00,

62 
DISC_CURR_TIME_START
 = 0x10,

63 
DISC_CURR_TIME_SVC
,

64 
DISC_CURR_TIME_CHAR
,

65 
DISC_CURR_TIME_CT_TIME_CCCD
,

66 
DISC_FAILED
 = 0xFF

72 
HDL_CURR_TIME_CT_TIME_START
,

73 
HDL_CURR_TIME_CT_TIME_END
,

74 
HDL_CURR_TIME_CT_TIME_CCCD
,

75 
HDL_CACHE_LEN


79 
	#TIMEAPP_CONFIG_START
 0x00

	)

80 
	#TIMEAPP_CONFIG_CMPL
 0xFF

	)

92 
uöt8
 
bloodPªssuªTaskId
;

95 
uöt16
 
g≠C⁄nH™dÀ
;

98 
uöt16
 
timeAµHdlCache
[
HDL_CACHE_LEN
];

101 
uöt8
 
timeC⁄figD⁄e
;

110 
TimeAµ_Inô
–
uöt8
 
èsk_id
 );

115 
uöt16
 
TimeAµ_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

120 
timeAµClockSë
–
uöt8
 *
pD©a
 );

125 
uöt8
 
timeAµDiscSèπ
( );

126 
uöt8
 
timeAµDiscG©tMsg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

131 
uöt8
 
timeAµC⁄figNext
–uöt8 
°©e
 );

132 
uöt8
 
timeAµC⁄figG©tMsg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

137 
timeAµIndG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

142 #ifde‡
__˝lu•lus


	@Projects/ble/BloodPressure/Source/timeapp_clock.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Clock.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"timóµ.h
"

95 
	$timeAµClockSë
–
uöt8
 *
pD©a
 )

97 
UTCTimeSåu˘
 
time
;

100 
time
.
yór
 = 
	`BUILD_UINT16
(
pD©a
[0],ÖData[1]);

101 i‡–
time
.
yór
 == 0 )

103 
time
.
yór
 = 2000;

105 
pD©a
 += 2;

106 
time
.
m⁄th
 = *
pD©a
++;

107 i‡–
time
.
m⁄th
 > 0 )

111 
time
.
day
 = *
pD©a
++;

112 i‡–
time
.
day
 > 0 )

116 
time
.
hour
 = *
pD©a
++;

117 
time
.
möuãs
 = *
pD©a
++;

118 
time
.
£c⁄ds
 = *
pD©a
;

121 
	`oßl_£tClock
–
	`oßl_C⁄vîtUTCSecs
–&
time
 ) );

123 
	}
}

	@Projects/ble/BloodPressure/Source/timeapp_config.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OnBﬂrd.h
"

46 
	~"g©t.h
"

47 
	~"g©t_uuid.h
"

48 
	~"g©t£rv≠p.h
"

49 
	~"timóµ.h
"

56 
	#TIMEAPP_CONFIG_MAX
 ( (
timeAµC⁄figLi°
Ë/ (
uöt8
Ë)

	)

64 c⁄° 
uöt8
 
	gtimeAµC⁄figLi°
[] =

66 
HDL_CURR_TIME_CT_TIME_START
,

67 
HDL_CURR_TIME_CT_TIME_CCCD
,

91 
uöt8
 
	gtimeC⁄figD⁄e
;

107 
uöt8
 
	$timeAµC⁄figNext
–
uöt8
 
°©e
 )

109 
©tRódReq_t
 
ªadReq
;

110 
©tWrôeReq_t
 
wrôeReq
;

111 
boﬁ
 
ªad
;

114  
°©e
 < 
TIMEAPP_CONFIG_MAX
 &&

115 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]] == 0 )

117 
°©e
++;

121 i‡–
°©e
 =
TIMEAPP_CONFIG_MAX
 )

123  
TIMEAPP_CONFIG_CMPL
;

127  
timeAµC⁄figLi°
[
°©e
] )

130 
HDL_CURR_TIME_CT_TIME_START
:

131 
ªad
 = 
TRUE
;

135 
HDL_CURR_TIME_CT_TIME_CCCD
:

137 
ªad
 = 
FALSE
;

138 
wrôeReq
.
Àn
 = 2;

139 
wrôeReq
.
vÆue
[0] = 
	`LO_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

140 
wrôeReq
.
vÆue
[1] = 
	`HI_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

141 
wrôeReq
.
sig
 = 0;

142 
wrôeReq
.
cmd
 = 0;

149 if(
timeC⁄figD⁄e
==
TRUE
)

151  
°©e
;

155 i‡–
ªad
 )

157 
ªadReq
.
h™dÀ
 = 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]];

158 
	`GATT_RódCh¨VÆue
–
g≠C⁄nH™dÀ
, &
ªadReq
, 
bloodPªssuªTaskId
 );

161 
timeC⁄figD⁄e
 = 
TRUE
;

165 
wrôeReq
.
h™dÀ
 = 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]];

166 
	`GATT_WrôeCh¨VÆue
–
g≠C⁄nH™dÀ
, &
wrôeReq
, 
bloodPªssuªTaskId
 );

169  
°©e
;

170 
	}
}

182 
uöt8
 
	$timeAµC⁄figG©tMsg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

185 i‡–(
pMsg
->
mëhod
 =
ATT_READ_RSP
 ||ÖMsg->mëhod =
ATT_WRITE_RSP
) &&

186 (
pMsg
->
hdr
.
°©us
 =
SUCCESS
) )

189  
timeAµC⁄figLi°
[
°©e
] )

191 
HDL_CURR_TIME_CT_TIME_START
:

193 
	`timeAµClockSë
–
pMsg
->
msg
.
ªadR•
.
vÆue
 );

200  
	`timeAµC⁄figNext
–
°©e
 + 1 );

201 
	}
}

	@Projects/ble/BloodPressure/Source/timeapp_discovery.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OnBﬂrd.h
"

46 
	~"g©t.h
"

47 
	~"g©t_uuid.h
"

48 
	~"timóµ.h
"

56 
	#CURRENT_TIME_SVC_UUID
 0x1805

	)

59 
	#CT_TIME_UUID
 0x2A2B

60 

	)

62 
	#CHAR_DESC_HDL_UUID16_LEN
 7

	)

81 
uöt16
 
	gtimeAµHdlCache
[
HDL_CACHE_LEN
];

92 
uöt16
 
	gtimeAµSvcSèπHdl
;

93 
uöt16
 
	gtimeAµSvcEndHdl
;

94 
uöt8
 
	gtimeAµEndHdlIdx
;

100 
uöt8
 
TimeAµDiscCuºTime
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

110 
uöt8
 
	$timeAµDiscSèπ
( )

113 
	`oßl_mem£t
–
timeAµHdlCache
, 0, (timeAppHdlCache) );

116  
	`timeAµDiscG©tMsg
–
DISC_CURR_TIME_START
, 
NULL
 );

117 
	}
}

129 
uöt8
 
	$timeAµDiscG©tMsg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

134  
°©e
 & 0xF0 )

137 
DISC_CURR_TIME_START
:

138 
°©e
 = 
	`TimeAµDiscCuºTime
–°©e, 
pMsg
 );

139 i‡–
°©e
 =
DISC_FAILED
 )

141 
°©e
 = 
DISC_FAILED
;

143 i‡–
°©e
 =
DISC_IDLE
 )

145 
°©e
 = 
DISC_IDLE
;

153 }  (
°©e
 != 0) && ((state & 0x0F) == 0) );

155  
°©e
;

156 
	}
}

168 
uöt8
 
	$TimeAµDiscCuºTime
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

170 
uöt8
 
√wSèã
 = 
°©e
;

172  
°©e
 )

174 
DISC_CURR_TIME_START
:

176 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
CURRENT_TIME_SVC_UUID
),

177 
	`HI_UINT16
(
CURRENT_TIME_SVC_UUID
) };

180 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

181 
timeAµEndHdlIdx
 = 0;

184 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
g≠C⁄nH™dÀ
, 
uuid
,

185 
ATT_BT_UUID_SIZE
, 
bloodPªssuªTaskId
 );

187 
√wSèã
 = 
DISC_CURR_TIME_SVC
;

191 
DISC_CURR_TIME_SVC
:

193 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

194 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

196 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

197 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

201 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

202 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

203 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

206 i‡–
timeAµSvcSèπHdl
 != 0 )

209 
	`GATT_DiscAŒCh¨s
–
g≠C⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

210 
timeAµSvcEndHdl
, 
bloodPªssuªTaskId
 );

212 
√wSèã
 = 
DISC_CURR_TIME_CHAR
;

217 
√wSèã
 = 
DISC_FAILED
;

222 
DISC_CURR_TIME_CHAR
:

225 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

226 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

227 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
)

229 
uöt8
 
i
;

230 
uöt8
 *
p
;

231 
uöt16
 
h™dÀ
;

232 
uöt16
 
uuid
;

234 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

235  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

238 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

239 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

242 i‡–
timeAµEndHdlIdx
 != 0 )

245 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
	`BUILD_UINT16
(
p
[0],Ö[1]) - 1;

247 
timeAµEndHdlIdx
 = 0;

251  
uuid
 )

253 
CT_TIME_UUID
:

254 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] = 
h™dÀ
;

255 
timeAµEndHdlIdx
 = 
HDL_CURR_TIME_CT_TIME_END
;

262 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

268 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

269 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

270 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

273 i‡–
timeAµEndHdlIdx
 != 0 )

275 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
timeAµSvcEndHdl
;

276 
timeAµEndHdlIdx
 = 0;

280 i‡–
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] == 0 )

282 
√wSèã
 = 
DISC_FAILED
;

285 i‡–
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] <timeAµHdlCache[
HDL_CURR_TIME_CT_TIME_END
] )

288 
	`GATT_DiscAŒCh¨Descs
–
g≠C⁄nH™dÀ
,

289 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] + 1,

290 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_END
],

291 
bloodPªssuªTaskId
 );

293 
√wSèã
 = 
DISC_CURR_TIME_CT_TIME_CCCD
;

297 
√wSèã
 = 
DISC_IDLE
;

303 
DISC_CURR_TIME_CT_TIME_CCCD
:

306 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

307 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

308 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

310 
uöt8
 
i
;

312  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

315 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

316 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

317 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

318 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

321 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_CCCD
] =

322 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

330 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

331 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

332 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

334 
√wSèã
 = 
DISC_IDLE
;

343  
√wSèã
;

344 
	}
}

	@Projects/ble/BloodPressure/Source/timeapp_ind.c

43 
	~"°rög.h
"

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"timóµ.h
"

57 
	#ALERT_CAT_ID_MAX
 9

	)

60 
	#ALERT_MAJOR_CAT
(
x
Ë–(xË>> 3 )

	)

63 
	#ALERT_SUBCAT
(
x
Ë–(xË& 0x07 )

	)

103 
	$timeAµIndG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

105 
uöt8
 
i
;

108  
i
 = 0; i < 
HDL_CACHE_LEN
; i++ )

110 i‡–
pMsg
->
msg
.
h™dÀVÆueNŸi
.
h™dÀ
 =
timeAµHdlCache
[
i
] )

117  
i
 )

119 
HDL_CURR_TIME_CT_TIME_START
:

121 
	`timeAµClockSë
–
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
 );

130 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_IND
 )

132 
	`ATT_H™dÀVÆueCfm
–
pMsg
->
c⁄nH™dÀ
 );

134 
	}
}

	@Projects/ble/CyclingSensor/Source/OSAL_cyclingSensor.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

70 
	~"g©t£rv≠p.h
"

73 
	~"≥rùhîÆ.h
"

74 
	~"cy˛ög£rvi˚.h
"

78 
	~"cy˛ögSís‹.h
"

85 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

87 
LL_Pro˚ssEvít
,

88 
HÆ_Pro˚ssEvít
,

89 
HCI_Pro˚ssEvít
,

90 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

91 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

93 
L2CAP_Pro˚ssEvít
,

94 
GAP_Pro˚ssEvít
,

95 
GATT_Pro˚ssEvít
,

96 
SM_Pro˚ssEvít
,

97 
GAPRﬁe_Pro˚ssEvít
,

98 
GAPB⁄dMgr_Pro˚ssEvít
,

99 
GATTSîvAµ_Pro˚ssEvít
,

100 
Cy˛ögSîvi˚_Pro˚ssEvít
,

101 
Cy˛ögSís‹_Pro˚ssEvít


104 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

105 
uöt16
 *
	gèsksEvíts
;

120 
	$oßlInôTasks
( )

122 
uöt8
 
èskID
 = 0;

124 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

125 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

128 
	`LL_Inô
–
èskID
++ );

131 
	`HÆ_Inô
–
èskID
++ );

134 
	`HCI_Inô
–
èskID
++ );

136 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

138 
	`oßl_CbTimîInô
–
èskID
 );

139 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

143 
	`L2CAP_Inô
–
èskID
++ );

146 
	`GAP_Inô
–
èskID
++ );

149 
	`GATT_Inô
–
èskID
++ );

152 
	`SM_Inô
–
èskID
++ );

155 
	`GAPRﬁe_Inô
–
èskID
++ );

156 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

158 
	`GATTSîvAµ_Inô
–
èskID
++ );

160 
	`Cy˛ögSîvi˚_Inô
–
èskID
++ );

163 
	`Cy˛ögSís‹_Inô
–
èskID
 );

164 
	}
}

	@Projects/ble/CyclingSensor/Source/cyclingSensor.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"lökdb.h
"

50 
	~"g©t.h
"

51 
	~"hci.h
"

52 
	~"g≠g©t£rvî.h
"

53 
	~"g©t£rv≠p.h
"

54 
	~"cy˛ög£rvi˚.h
"

55 
	~"devöfo£rvi˚.h
"

56 
	~"≥rùhîÆ.h
"

57 
	~"g≠b⁄dmgr.h
"

58 
	~"cy˛ögSís‹.h
"

71 
	#DEFAULT_FAST_ADV_INTERVAL
 32

	)

74 
	#DEFAULT_FAST_ADV_DURATION
 20000

	)

77 
	#DEFAULT_WHITE_LIST_ADV_DURATION
 10000

	)

80 
	#DEFAULT_SLOW_ADV_INTERVAL
 1704

	)

83 
	#DEFAULT_SLOW_ADV_DURATION
 20000

	)

86 
	#DEFAULT_CSC_PERIOD
 1000

	)

89 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

92 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 200

	)

95 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 1600

	)

98 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 0

	)

101 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

104 
	#DEFAULT_PAIRING_PARAMETER
 
GAPBOND_PAIRING_MODE_INITIATE


	)

107 
	#USING_WHITE_LIST
 
TRUE


	)

110 
	#REQ_BONDING
 
TRUE


	)

113 
	#SVC_DISC_DELAY
 5000

	)

116 
	#NEGLECT_TIMEOUT_DELAY
 15000

	)

119 
	#USING_NEGLECT_TIMEOUT
 
TRUE


	)

122 
	#CSC_RESET_DELAY
 3000

123 

	)

125 
	#FLAGS_IDX_MAX
 4

	)

128 
	#CRANK_REV_INCREMENT
 2

	)

129 
	#WHEEL_REV_INCREMENT
 2

	)

132 
	#WHEEL_EVT_INCREMENT
 512

	)

133 
	#CRANK_EVT_INCREMENT
 512

	)

154 
uöt8
 
	g£ns‹_TaskID
;

156 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

158 
uöt8
 
	g£ns‹UsögWhôeLi°
 = 
FALSE
;

161 
uöt8
 
	gsˇnD©a
[] =

164 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

178 
GAP_ADTYPE_POWER_LEVEL
,

182 
uöt8
 
	gadvîtD©a
[] =

186 
GAP_ADTYPE_FLAGS
,

187 
GAP_ADTYPE_FLAGS_GENERAL
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

190 
GAP_ADTYPE_16BIT_MORE
,

191 
LO_UINT16
(
CSC_SERV_UUID
),

192 
HI_UINT16
(
CSC_SERV_UUID
),

196 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "CSC Sensor";

199 
uöt16
 
	gg≠C⁄nH™dÀ
;

202 
©tH™dÀVÆueNŸi_t
 
	g£ns‹Mós
;

205 c⁄° 
uöt8
 
	g£ns‹Fœgs
[
FLAGS_IDX_MAX
] =

207 
CSC_FLAGS_SPEED_CADENCE
,

208 
CSC_FLAGS_AT_REST
,

209 
CSC_FLAGS_SPEED
,

210 
CSC_FLAGS_CADENCE


214 
uöt8
 
	g£ns‹FœgsIdx
 = 0;

217 
boﬁ
 
	g£ns‹AdvC™˚Œed
 = 
FALSE
;

220 
uöt32
 
	gcummWhìlRevs
 = 100;

221 
uöt16
 
	gcummCønkRevs
 = 50;

222 
uöt16
 
	gœ°WhìlEvtTime
 = 60;

223 
uöt16
 
	gœ°CønkEvtTime
 = 70;

224 
uöt8
 
	g£ns‹Loˇti⁄
 = 
CSC_SENSOR_LOC_OTHER
;

227 
uöt8
 
	gª£tInProgªss
 = 
FALSE
;

232 
£ns‹_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

233 
Sís‹G≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

234 
£ns‹PîiodicTask
( );

235 
£ns‹_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

236 
£ns‹MósNŸify
( );

237 
Sís‹CB
–
uöt8
 
evít
, 
uöt32
 *
pNewCummVÆ
 );

244 
g≠RﬁesCBs_t
 
	gcy˛ögPîùhîÆCB
 =

246 
Sís‹G≠SèãCB
,

247 
NULL


251 c⁄° 
g≠B⁄dCBs_t
 
	gcy˛ögB⁄dCB
 =

253 
NULL
,

254 
NULL


275 
	$Cy˛ögSís‹_Inô
–
uöt8
 
èsk_id
 )

277 
£ns‹_TaskID
 = 
èsk_id
;

282 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

287 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

289 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

290 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

291 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

292 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

293 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

296 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

297 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

299 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnD©a
 ), scanData );

300 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

302 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

303 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

304 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

305 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

306 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

310 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
©tDevi˚Name
 );

314 
uöt32
 
∑sskey
 = 0;

315 
uöt8
 
∑úMode
 = 
DEFAULT_PAIRING_PARAMETER
;

316 
uöt8
 
môm
 = 
FALSE
;

317 
uöt8
 
ioC≠
 = 
GAPBOND_IO_CAP_NO_INPUT_NO_OUTPUT
;

318 
uöt8
 
b⁄dög
 = 
REQ_BONDING
;

319 
uöt8
 
autoSync
 = 
USING_WHITE_LIST
;

321 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
,  ( 
uöt32
 ), &
∑sskey
 );

322 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

323 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

324 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

325 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

326 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_AUTO_SYNC_WL
,  ( 
uöt8
 ), &
autoSync
 );

330 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

331 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

332 
	`Cy˛ög_AddSîvi˚
–
GATT_ALL_SERVICES
 );

333 
	`DevInfo_AddSîvi˚
( );

336 
	`Cy˛ög_Regi°î
–
Sís‹CB
 );

340 
uöt8
 
„©uªs
 = 
CSC_FULL_SUPPORT
;

341 
uöt8
 
£ns‹Loˇti⁄Cuºít
 = 
CSC_SENSOR_LOC_REAR_DROPOUT
;

342 
uöt8
 
£ns‹Loˇti⁄1
 = 
CSC_SENSOR_LOC_REAR_DROPOUT
;

343 
uöt8
 
£ns‹Loˇti⁄2
 = 
CSC_SENSOR_LOC_LEFT_CRANK
;

344 
uöt8
 
£ns‹Loˇti⁄3
 = 
CSC_SENSOR_LOC_REAR_WHEEL
;

345 
uöt8
 
£ns‹Loˇti⁄4
 = 
CSC_SENSOR_LOC_HIP
;

348 
	`Cy˛ög_SëP¨amëî
(
CSC_AVAIL_SENS_LOCS
, 1, &
£ns‹Loˇti⁄1
);

349 
	`Cy˛ög_SëP¨amëî
(
CSC_AVAIL_SENS_LOCS
, 1, &
£ns‹Loˇti⁄2
);

350 
	`Cy˛ög_SëP¨amëî
(
CSC_AVAIL_SENS_LOCS
, 1, &
£ns‹Loˇti⁄3
);

351 
	`Cy˛ög_SëP¨amëî
(
CSC_AVAIL_SENS_LOCS
, 1, &
£ns‹Loˇti⁄4
);

354 
	`Cy˛ög_SëP¨amëî
(
CSC_SENS_LOC
, 1, &
£ns‹Loˇti⁄Cuºít
);

357 
	`Cy˛ög_SëP¨amëî
(
CSC_FEATURE
, 1, &
„©uªs
);

361 
	`Regi°îF‹Keys
–
£ns‹_TaskID
 );

364 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

370 
P0SEL
 = 0;

371 
P1SEL
 = 0;

372 
P2SEL
 = 0;

374 
P0DIR
 = 0xFC;

376 
P1DIR
 = 0xFF;

377 
P2DIR
 = 0x1F;

379 
P0
 = 0x03;

380 
P1
 = 0;

381 
P2
 = 0;

384 
	`oßl_£t_evít
–
£ns‹_TaskID
, 
START_DEVICE_EVT
 );

385 
	}
}

400 
uöt16
 
	$Cy˛ögSís‹_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

403 
VOID
 
èsk_id
;

405 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

407 
uöt8
 *
pMsg
;

409 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
£ns‹_TaskID
 )Ë!
NULL
 )

411 
	`£ns‹_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

414 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

418  (
evíts
 ^ 
SYS_EVENT_MSG
);

421 i‡–
evíts
 & 
START_DEVICE_EVT
 )

424 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
cy˛ögPîùhîÆCB
 );

427 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
cy˛ögB⁄dCB
 );

429  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

432 i‡–
evíts
 & 
CSC_PERIODIC_EVT
 )

435 
	`£ns‹PîiodicTask
();

437  (
evíts
 ^ 
CSC_PERIODIC_EVT
);

440 i‡–
evíts
 & 
CSC_CONN_PARAM_UPDATE_EVT
 )

443 
	`GAPRﬁe_SídUpd©eP¨am
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
, 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
,

444 
DEFAULT_DESIRED_SLAVE_LATENCY
, 
DEFAULT_DESIRED_CONN_TIMEOUT
,

445 
GAPROLE_RESEND_PARAM_UPDATE
 );

448 i‡–
USING_NEGLECT_TIMEOUT
 )

450 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

453  (
evíts
 ^ 
CSC_CONN_PARAM_UPDATE_EVT
);

456 i‡–
evíts
 & 
CSC_NEGLECT_TIMEOUT_EVT
 )

459 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

461  ( 
evíts
 ^ 
CSC_NEGLECT_TIMEOUT_EVT
 );

464 i‡–
evíts
 & 
CSC_RESET_EVT
 )

467 i‡–
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 )

470 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

473 
g≠ProfûeSèã
 = 
GAPROLE_WAITING
;

476 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_RESET_EVT
, 500 );

478 i‡–
g≠ProfûeSèã
 =
GAPROLE_ADVERTISING
 )

480 
uöt8
 
vÆue
 = 
FALSE
;

483 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
vÆue
 );

486 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_RESET_EVT
, 500 );

488 i‡–
USING_WHITE_LIST
 =
TRUE
 )

491 
uöt8
 
vÆue
 = 
GAP_FILTER_POLICY_ALL
;

494 
	`GAPRﬁe_SëP¨amëî
(
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
vÆue
);

496 
£ns‹UsögWhôeLi°
 = 
FALSE
;

499 
	`HCI_LE_CÀ¨WhôeLi°Cmd
();

502 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_RESET_EVT
, 500 );

504 i‡–(
g≠ProfûeSèã
 =
GAPROLE_STARTED
) ||

505 (
g≠ProfûeSèã
 =
GAPROLE_WAITING
) ||

506 (
g≠ProfûeSèã
 =
GAPROLE_WAITING_AFTER_TIMEOUT
) )

508 
uöt8
 
îa£B⁄ds
 = 
TRUE
;

511 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_ERASE_ALLBONDS
, 0, &
îa£B⁄ds
 );

514 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_BLINK
 );

517  (
evíts
 ^ 
CSC_RESET_EVT
);

522 
	}
}

533 
	$£ns‹_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

535  
pMsg
->
evít
 )

537 
KEY_CHANGE
:

538 
	`£ns‹_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

541 
	}
}

555 
	$£ns‹_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

558 i‡–
keys
 =–
HAL_KEY_SW_1
 | 
HAL_KEY_SW_2
 ) )

561 
ª£tInProgªss
 = 
TRUE
;

564 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_RESET_EVT
, 
CSC_RESET_DELAY
 );

566 i‡–
keys
 & 
HAL_KEY_SW_1
 )

568 i‡–
ª£tInProgªss
 =
TRUE
 )

571 
ª£tInProgªss
 = 
FALSE
;

572 
	`oßl_°›_timîEx
 ( 
£ns‹_TaskID
, 
CSC_RESET_EVT
 );

576 i‡(++
£ns‹FœgsIdx
 =
FLAGS_IDX_MAX
)

578 
£ns‹FœgsIdx
 = 0;

581 i‡–
keys
 & 
HAL_KEY_SW_2
 )

583 i‡–
ª£tInProgªss
 =
TRUE
 )

586 
ª£tInProgªss
 = 
FALSE
;

587 
	`oßl_°›_timîEx
 ( 
£ns‹_TaskID
, 
CSC_RESET_EVT
 );

591 i‡–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

593 
uöt8
 
°©us
;

596 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

597 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

598 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_WHITE_LIST_ADV_DURATION
 );

601 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
°©us
 );

602 
°©us
 = !status;

606 i‡–
USING_WHITE_LIST
 && 
°©us
 =
TRUE
 )

608 
uöt8
 
b⁄dCou¡
 = 0;

610 
	`GAPB⁄dMgr_GëP¨amëî
–
GAPBOND_BOND_COUNT
, &
b⁄dCou¡
 );

612 i‡((
£ns‹UsögWhôeLi°
 =
FALSE
Ë&& (
b⁄dCou¡
 > 0) )

614 
uöt8
 
vÆue
 = 
GAP_FILTER_POLICY_WHITE
;

616 
	`GAPRﬁe_SëP¨amëî
(
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
vÆue
);

618 
£ns‹UsögWhôeLi°
 = 
TRUE
;

622 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
°©us
 );

625 i‡(
°©us
 =
FALSE
)

627 
£ns‹AdvC™˚Œed
 = 
TRUE
;

632 i‡–
keys
 == 0x00 )

634 i‡–
ª£tInProgªss
 =
TRUE
 )

636 
ª£tInProgªss
 = 
FALSE
;

638 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
CSC_RESET_EVT
 );

641 
	}
}

650 
	$£ns‹MósNŸify
( )

652 
uöt8
 *
p
 = 
£ns‹Mós
.
vÆue
;

653 
uöt8
 
Êags
 = 
£ns‹Fœgs
[
£ns‹FœgsIdx
];

657 *
p
++ = 
Êags
;

660 i‡(
Êags
 & 
CSC_FLAGS_SPEED
)

662 *
p
++ = 
	`BREAK_UINT32
(
cummWhìlRevs
, 0);

663 *
p
++ = 
	`BREAK_UINT32
(
cummWhìlRevs
, 1);

664 *
p
++ = 
	`BREAK_UINT32
(
cummWhìlRevs
, 2);

665 *
p
++ = 
	`BREAK_UINT32
(
cummWhìlRevs
, 3);

667 *
p
++ = 
	`LO_UINT16
(
œ°WhìlEvtTime
);

668 *
p
++ = 
	`HI_UINT16
(
œ°WhìlEvtTime
);

671 i‡(
cummWhìlRevs
 < 
WHEEL_REV_INCREMENT
)

673 
cummWhìlRevs
 = 0;

677 
cummWhìlRevs
 -
WHEEL_REV_INCREMENT
;

680 
œ°WhìlEvtTime
 +
WHEEL_EVT_INCREMENT
;

684 i‡(
Êags
 & 
CSC_FLAGS_CADENCE
)

686 *
p
++ = 
	`LO_UINT16
(
cummCønkRevs
);

687 *
p
++ = 
	`HI_UINT16
(
cummCønkRevs
);

689 *
p
++ = 
	`LO_UINT16
(
œ°CønkEvtTime
);

690 *
p
++ = 
	`HI_UINT16
(
œ°CønkEvtTime
);

693 
cummCønkRevs
 +
CRANK_REV_INCREMENT
;

694 
œ°CønkEvtTime
 +
CRANK_EVT_INCREMENT
;

698 
£ns‹Mós
.
Àn
 = (
uöt8
Ë(
p
 - sís‹Mós.
vÆue
);

701 
	`Cy˛ög_MósNŸify
–
g≠C⁄nH™dÀ
, &
£ns‹Mós
 );

702 
	}
}

713 
	$Sís‹G≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

716 i‡(
√wSèã
 =
GAPROLE_CONNECTED
)

719 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_CONNHANDLE
, &
g≠C⁄nH™dÀ
);

723 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_CONN_PARAM_UPDATE_EVT
, 
SVC_DISC_DELAY
);

726 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 &&

727 
√wSèã
 !
GAPROLE_CONNECTED
)

729 
uöt8
 
advSèã
 = 
TRUE
;

730 
uöt8
 
b⁄dCou¡
 = 0;

733 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
CSC_PERIODIC_EVT
 );

736 
	`Cy˛ög_H™dÀC⁄nSètusCB
–
g≠C⁄nH™dÀ
, 
LINKDB_STATUS_UPDATE_REMOVED
 );

739 
	`GAPB⁄dMgr_GëP¨amëî
–
GAPBOND_BOND_COUNT
, &
b⁄dCou¡
 );

741 if–
USING_WHITE_LIST
 && 
£ns‹UsögWhôeLi°
 =
FALSE
 && 
b⁄dCou¡
 > 0 )

743 
uöt8
 
vÆue
 = 
GAP_FILTER_POLICY_WHITE
;

745 
	`GAPRﬁe_SëP¨amëî
(
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
vÆue
);

747 
£ns‹UsögWhôeLi°
 = 
TRUE
;

750 i‡–
√wSèã
 =
GAPROLE_WAITING_AFTER_TIMEOUT
 )

753 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

754 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

755 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_WHITE_LIST_ADV_DURATION
 );

760 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

761 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

762 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_WHITE_LIST_ADV_DURATION
 );

766 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

769 i‡–
g≠ProfûeSèã
 =
GAPROLE_ADVERTISING
 &&

770 
√wSèã
 =
GAPROLE_WAITING
 )

772 
uöt8
 
whôeLi°U£d
 = 
FALSE
;

775 if–
£ns‹UsögWhôeLi°
 =
TRUE
 )

777 
uöt8
 
vÆue
 = 
GAP_FILTER_POLICY_ALL
;

779 
	`GAPRﬁe_SëP¨amëî
(
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
), &
vÆue
);

781 
whôeLi°U£d
 = 
TRUE
;

783 
£ns‹UsögWhôeLi°
 = 
FALSE
;

787 i‡–
£ns‹AdvC™˚Œed
 )

789 
£ns‹AdvC™˚Œed
 = 
FALSE
;

792 i‡––(!
USING_WHITE_LIST
Ë|| 
whôeLi°U£d
) &&

793 (
	`GAP_GëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
 ) =
DEFAULT_FAST_ADV_INTERVAL
 ) )

795 
uöt8
 
advSèã
 = 
TRUE
;

797 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

798 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

799 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_FAST_ADV_DURATION
 );

800 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

803 i‡–((!
USING_WHITE_LIST
Ë|| 
whôeLi°U£d
) ||

804 (
	`GAP_GëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
 ) =
DEFAULT_FAST_ADV_INTERVAL
) )

806 
uöt8
 
advSèã
 = 
TRUE
;

808 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

809 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

810 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_SLOW_ADV_DURATION
 );

811 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

815 i‡(
√wSèã
 =
GAPROLE_STARTED
)

818 
uöt8
 
sy°emId
[
DEVINFO_SYSTEM_ID_LEN
];

819 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
sy°emId
);

822 
sy°emId
[7] = systemId[5];

823 
sy°emId
[6] = systemId[4];

824 
sy°emId
[5] = systemId[3];

827 
sy°emId
[4] = 0;

828 
sy°emId
[3] = 0;

830 
	`DevInfo_SëP¨amëî
(
DEVINFO_SYSTEM_ID
, 
DEVINFO_SYSTEM_ID_LEN
, 
sy°emId
);

833 
g≠ProfûeSèã
 = 
√wSèã
;

834 
	}
}

846 
	$Sís‹CB
–
uöt8
 
evít
, 
uöt32
 *
pNewCummVÆ
 )

848  
evít
 )

850 
CSC_CMD_SET_CUMM_VAL
:

852 i‡–
USING_NEGLECT_TIMEOUT
 )

854 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
 );

857 
cummWhìlRevs
 = *
pNewCummVÆ
;

860 i‡–
USING_NEGLECT_TIMEOUT
 )

862 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

866 
CSC_CMD_UPDATE_SENS_LOC
:

868 i‡–
USING_NEGLECT_TIMEOUT
 )

870 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
 );

874 
	`Cy˛ög_GëP¨amëî
–
CSC_SENS_LOC
, &
£ns‹Loˇti⁄
 );

877 i‡–
USING_NEGLECT_TIMEOUT
 )

879 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

883 
CSC_MEAS_NOTI_ENABLED
:

885 i‡–
USING_NEGLECT_TIMEOUT
 )

887 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
 );

891 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

893 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_PERIODIC_EVT
, 
DEFAULT_CSC_PERIOD
 );

897 
CSC_MEAS_NOTI_DISABLED
:

899 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
CSC_PERIODIC_EVT
 );

902 i‡–
USING_NEGLECT_TIMEOUT
 )

904 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

908 
CSC_READ_ATTR
:

909 
CSC_WRITE_ATTR
:

910 i‡–
USING_NEGLECT_TIMEOUT
 )

913 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
 );

916 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

923 
	}
}

934 
	$£ns‹PîiodicTask
( )

936 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

939 
	`£ns‹MósNŸify
();

942 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
CSC_PERIODIC_EVT
, 
DEFAULT_CSC_PERIOD
 );

944 
	}
}

	@Projects/ble/CyclingSensor/Source/cyclingSensor.h

40 #i‚de‡
CYCLINGSENSOR_H


41 
	#CYCLINGSENSOR_H


	)

43 #ifde‡
__˝lu•lus


58 
	#START_DEVICE_EVT
 0x0001

	)

59 
	#CSC_PERIODIC_EVT
 0x0002

	)

60 
	#CSC_CONN_PARAM_UPDATE_EVT
 0x0004

	)

61 
	#CSC_NEGLECT_TIMEOUT_EVT
 0x0008

	)

62 
	#CSC_RESET_EVT
 0x0010

	)

76 
Cy˛ögSís‹_Inô
–
uöt8
 
èsk_id
 );

81 
uöt16
 
Cy˛ögSís‹_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

86 #ifde‡
__˝lu•lus


	@Projects/ble/CyclingSensor/Source/cyclingSensor_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

69 
	$maö
()

72 
	`HAL_BOARD_INIT
();

75 
	`InôBﬂrd
–
OB_COLD
 );

78 
	`HÆDrivîInô
();

81 
	`oßl_¢v_öô
();

86 
	`oßl_öô_sy°em
();

89 
	`HAL_ENABLE_INTERRUPTS
();

92 
	`InôBﬂrd
–
OB_READY
 );

94 #i‡
	`deföed
 ( 
POWER_SAVING
 )

95 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

99 
	`oßl_°¨t_sy°em
();

102 
	}
}

	@Projects/ble/GlucoseCollector/Source/OSAL_glucoseCollector.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

46 
	~"OSAL_˛ock.h
"

49 
	~"hÆ_drivîs.h
"

52 
	~"Œ.h
"

55 
	~"hci_é.h
"

57 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

58 
	~"oßl_cbTimî.h
"

62 
	~"l2ˇp.h
"

65 
	~"g≠.h
"

66 
	~"g≠g©t£rvî.h
"

67 
	~"g≠b⁄dmgr.h
"

70 
	~"g©t.h
"

72 
	~"g©t£rv≠p.h
"

75 
	~"˚¡øl.h
"

78 
	~"gluco£CﬁÀ˘‹.h
"

85 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

87 
LL_Pro˚ssEvít
,

88 
HÆ_Pro˚ssEvít
,

89 
HCI_Pro˚ssEvít
,

90 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

91 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

93 
L2CAP_Pro˚ssEvít
,

94 
GAP_Pro˚ssEvít
,

95 
GATT_Pro˚ssEvít
,

96 
SM_Pro˚ssEvít
,

97 
GAPCíåÆRﬁe_Pro˚ssEvít
,

98 
GAPB⁄dMgr_Pro˚ssEvít
,

99 
GATTSîvAµ_Pro˚ssEvít
,

100 
GlucCﬁl_Pro˚ssEvít


103 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

104 
uöt16
 *
	gèsksEvíts
;

119 
	$oßlInôTasks
( )

121 
uöt8
 
èskID
 = 0;

123 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

124 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

127 
	`LL_Inô
–
èskID
++ );

130 
	`HÆ_Inô
–
èskID
++ );

133 
	`HCI_Inô
–
èskID
++ );

135 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

137 
	`oßl_CbTimîInô
–
èskID
 );

138 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

142 
	`L2CAP_Inô
–
èskID
++ );

145 
	`GAP_Inô
–
èskID
++ );

148 
	`GATT_Inô
–
èskID
++ );

151 
	`SM_Inô
–
èskID
++ );

154 
	`GAPCíåÆRﬁe_Inô
–
èskID
++ );

155 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

157 
	`GATTSîvAµ_Inô
–
èskID
++ );

160 
	`GlucCﬁl_Inô
–
èskID
 );

161 
	}
}

	@Projects/ble/GlucoseCollector/Source/glucoseCollector.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_PwrMgr.h
"

47 
	~"OSAL_˛ock.h
"

48 
	~"OnBﬂrd.h
"

49 
	~"hÆ_Àd.h
"

50 
	~"hÆ_key.h
"

51 
	~"hÆ_lcd.h
"

52 
	~"g©t.h
"

53 
	~"Œ.h
"

54 
	~"hci.h
"

55 
	~"g≠g©t£rvî.h
"

56 
	~"g©t£rv≠p.h
"

57 
	~"˚¡øl.h
"

58 
	~"g≠b⁄dmgr.h
"

59 
	~"sim∂eGATT¥ofûe.h
"

60 
	~"gluco£CﬁÀ˘‹.h
"

61 
	~"gluc£rvi˚.h
"

68 
	#B_ADDR_STR_LEN
 15

	)

75 
	#GLUCOSE_FILTER_ENABLED
 
FALSE


	)

78 
	#DEFAULT_FILTER_TYPE
 
CTL_PNT_FILTER_SEQNUM


	)

81 
	#DEFAULT_MAX_SCAN_RES
 8

	)

84 
	#DEFAULT_SCAN_DURATION
 4000

	)

87 
	#DEFAULT_DISCOVERY_MODE
 
DEVDISC_MODE_ALL


	)

90 
	#DEFAULT_DISCOVERY_ACTIVE_SCAN
 
TRUE


	)

93 
	#DEFAULT_DISCOVERY_WHITE_LIST
 
FALSE


	)

96 
	#DEFAULT_LINK_HIGH_DUTY_CYCLE
 
FALSE


	)

99 
	#DEFAULT_LINK_WHITE_LIST
 
FALSE


	)

102 
	#DEFAULT_RSSI_PERIOD
 1000

	)

105 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

108 
	#DEFAULT_UPDATE_MIN_CONN_INTERVAL
 400

	)

111 
	#DEFAULT_UPDATE_MAX_CONN_INTERVAL
 800

	)

114 
	#DEFAULT_UPDATE_SLAVE_LATENCY
 0

	)

117 
	#DEFAULT_UPDATE_CONN_TIMEOUT
 600

	)

120 
	#DEFAULT_PASSCODE
 19655

	)

123 
	#DEFAULT_PAIRING_MODE
 
GAPBOND_PAIRING_MODE_INITIATE


	)

126 
	#DEFAULT_MITM_MODE
 
TRUE


127 

	)

129 
	#DEFAULT_BONDING_MODE
 
TRUE


	)

132 
	#DEFAULT_IO_CAPABILITIES
 
GAPBOND_IO_CAP_KEYBOARD_DISPLAY


133 

	)

135 
	#DEFAULT_SVC_DISCOVERY_DELAY
 1000

	)

138 
	#DEFAULT_DEV_DISC_BY_SVC_UUID
 
FALSE


	)

143 
	mBLE_STATE_IDLE
,

144 
	mBLE_STATE_CONNECTING
,

145 
	mBLE_STATE_CONNECTED
,

146 
	mBLE_STATE_DISCONNECTING


158 
uöt8
 
	gglucCﬁlTaskId
;

161 
uöt16
 
	gglucCﬁlC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

163 
uöt16
 
	ggluco£Fótuªs
 = 0;

166 
boﬁ
 
	gglucCﬁlCh¨Hdls
 = 
Ál£
;

168 
boﬁ
 
	gglucCﬁlWrôePídög
 = 
Ál£
;

170 
boﬁ
 
	gglucCﬁlCÀ¨Pídög
 = 
Ál£
;

186 #i‡
GLUCOSE_FILTER_ENABLED


187 #i‡
DEFAULT_FILTER_TYPE
 =
CTL_PNT_FILTER_TIME


190 
UTCTimeSåu˘
 
	gfûãrTime1
 = {0,0,0,0,0,2011};

191 
UTCTimeSåu˘
 
	gfûãrTime2
 = {0,0,0,27,1,2011};

192 *
	gpFûãr1
 = &
fûãrTime1
;

193 *
	gpFûãr2
 = &
fûãrTime2
;

196 
uöt16
 
	gfûãrSeqNum1
 = 1;

197 
uöt16
 
	gfûãrSeqnum2
 = 10;

198 *
	gpFûãr1
 = &
fûãrSeqNum1
;

199 *
	gpFûãr2
 = &
fûãrSeqnum2
;

204 c⁄° 
uöt8
 
	gglucCﬁlDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "Glucose Collector";

207 
uöt8
 
	gglucCﬁlSˇnRes
;

208 
uöt8
 
	gglucCﬁlSˇnIdx
;

211 
g≠DevRec_t
 
	gglucCﬁlDevLi°
[
DEFAULT_MAX_SCAN_RES
];

214 
uöt8
 
	gglucCﬁlSˇ¬ög
 = 
FALSE
;

217 
uöt8
 
	gglucCﬁlSèã
 = 
BLE_STATE_IDLE
;

220 
uöt8
 
	gglucCﬁlDiscSèã
 = 
DISC_IDLE
;

223 
uöt8
 
	gglucCﬁlC⁄figSèã
 = 
GLUCOSE_CONFIG_START
;

226 
uöt8
 
	gglucCﬁlPaúögSèπed
 = 
FALSE
;

229 
uöt8
 
	gglucCﬁlDiscPo°p⁄ed
 = 
FALSE
;

234 
glucCﬁlPro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 );

235 
glucCﬁlCíåÆRssiCB
–
uöt16
 
c⁄nH™dÀ
, 
öt8
 
rssi
 );

236 
glucCﬁlCíåÆEvítCB
–
g≠CíåÆRﬁeEvít_t
 *
pEvít
 );

237 
glucCﬁlCíåÆPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

238 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 );

239 
glucCﬁlCíåÆPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 );

240 
glucCﬁl_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

241 
glucCﬁlCíåÆ_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

242 
glucCﬁlCíåÆSèπDiscovîy
( );

243 
boﬁ
 
glucCﬁlFödSvcUuid
–
uöt16
 
uuid
, 
uöt8
 *
pD©a
, uöt8 
d©aLí
 );

244 
glucCﬁlAddDevi˚Info
–
uöt8
 *
pAddr
, uöt8 
addrTy≥
 );

245 *
bdAddr2Så
 ( 
uöt8
 *
pAddr
 );

252 c⁄° 
g≠CíåÆRﬁeCB_t
 
	gglucCﬁlRﬁeCB
 =

254 
glucCﬁlCíåÆRssiCB
,

255 
glucCﬁlCíåÆEvítCB


259 c⁄° 
g≠B⁄dCBs_t
 
	gglucCﬁlB⁄dCB
 =

261 
glucCﬁlCíåÆPasscodeCB
,

262 
glucCﬁlCíåÆPaúSèãCB


283 
	$GlucCﬁl_Inô
–
uöt8
 
èsk_id
 )

285 
glucCﬁlTaskId
 = 
èsk_id
;

289 
uöt8
 
sˇnRes
 = 
DEFAULT_MAX_SCAN_RES
;

290 
	`GAPCíåÆRﬁe_SëP¨amëî
 ( 
GAPCENTRALROLE_MAX_SCAN_RES
, –
uöt8
 ), &
sˇnRes
 );

294 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

295 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

296 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, (
uöt8
 *Ë
glucCﬁlDevi˚Name
 );

300 
uöt32
 
∑sskey
 = 
DEFAULT_PASSCODE
;

301 
uöt8
 
∑úMode
 = 
DEFAULT_PAIRING_MODE
;

302 
uöt8
 
môm
 = 
DEFAULT_MITM_MODE
;

303 
uöt8
 
ioC≠
 = 
DEFAULT_IO_CAPABILITIES
;

304 
uöt8
 
b⁄dög
 = 
DEFAULT_BONDING_MODE
;

305 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
, –
uöt32
 ), &
∑sskey
 );

306 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
, –
uöt8
 ), &
∑úMode
 );

307 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
, –
uöt8
 ), &
môm
 );

308 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
, –
uöt8
 ), &
ioC≠
 );

309 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
, –
uöt8
 ), &
b⁄dög
 );

313 
VOID
 
	`GATT_InôClõ¡
();

316 
	`GATT_Regi°îF‹Ind
–
glucCﬁlTaskId
 );

319 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

320 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

323 
	`Regi°îF‹Keys
–
glucCﬁlTaskId
 );

326 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

329 
	`oßl_£t_evít
–
glucCﬁlTaskId
, 
START_DEVICE_EVT
 );

330 
	}
}

345 
uöt16
 
	$GlucCﬁl_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

348 
VOID
 
èsk_id
;

350 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

352 
uöt8
 *
pMsg
;

354 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
glucCﬁlTaskId
 )Ë!
NULL
 )

356 
	`glucCﬁlCíåÆ_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

359 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

363  (
evíts
 ^ 
SYS_EVENT_MSG
);

366 i‡–
evíts
 & 
PROCEDURE_TIMEOUT_EVT
 )

368 i‡–
glucCﬁlSèã
 =
BLE_STATE_CONNECTED
 )

371 
glucCﬁlSèã
 = 
BLE_STATE_DISCONNECTING
;

373 
	`GAPCíåÆRﬁe_Tîmö©eLök
–
glucCﬁlC⁄nH™dÀ
 );

375 
	`LCD_WRITE_STRING
–"Timeout", 
HAL_LCD_LINE_1
 );

376 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

377 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

381  ( 
evíts
 ^ 
PROCEDURE_TIMEOUT_EVT
 );

384 i‡–
evíts
 & 
START_DEVICE_EVT
 )

387 
VOID
 
	`GAPCíåÆRﬁe_SèπDevi˚
–(
g≠CíåÆRﬁeCB_t
 *Ë&
glucCﬁlRﬁeCB
 );

390 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
glucCﬁlB⁄dCB
 );

392  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

395 i‡–
evíts
 & 
START_DISCOVERY_EVT
 )

397 i‡–
glucCﬁlPaúögSèπed
 )

400 
glucCﬁlDiscPo°p⁄ed
 = 
TRUE
;

404 
	`glucCﬁlCíåÆSèπDiscovîy
( );

406  ( 
evíts
 ^ 
START_DISCOVERY_EVT
 );

411 
	}
}

422 
	$glucCﬁlCíåÆ_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

424  
pMsg
->
evít
 )

426 
KEY_CHANGE
:

427 
	`glucCﬁl_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

430 
GATT_MSG_EVENT
:

431 
	`glucCﬁlPro˚ssGATTMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

434 
	}
}

448 
uöt8
 
	ggSètus
;

449 
	$glucCﬁl_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

451 ()
shi·
;

453 i‡–
keys
 & 
HAL_KEY_UP
 )

456 i‡–
glucCﬁlSèã
 !
BLE_STATE_CONNECTED
 )

458 i‡–!
glucCﬁlSˇ¬ög
 )

460 
glucCﬁlSˇ¬ög
 = 
TRUE
;

461 
glucCﬁlSˇnRes
 = 0;

463 
	`LCD_WRITE_STRING
–"Discovîög...", 
HAL_LCD_LINE_1
 );

464 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

465 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

467 
	`GAPCíåÆRﬁe_SèπDiscovîy
–
DEFAULT_DISCOVERY_MODE
,

468 
DEFAULT_DISCOVERY_ACTIVE_SCAN
,

469 
DEFAULT_DISCOVERY_WHITE_LIST
 );

473 
	`GAPCíåÆRﬁe_C™˚lDiscovîy
();

476 i‡–
glucCﬁlSèã
 =
BLE_STATE_CONNECTED
 &&

477 
glucCﬁlCh¨Hdls
 =
åue
 &&

478 
glucCﬁlWrôePídög
 =
Ál£
)

480 
uöt8
 
°©us
;

481 #i‡
GLUCOSE_FILTER_ENABLED


483 
°©us
 = 
	`gluco£CéP¡WrôeFûãr
(
CTL_PNT_OP_GET_NUM
, 
CTL_PNT_OPER_RANGE
,

484 
DEFAULT_FILTER_TYPE
, 
pFûãr1
, 
pFûãr2
);

487 
°©us
 = 
	`gluco£CéP¡Wrôe
(
CTL_PNT_OP_GET_NUM
, 
CTL_PNT_OPER_ALL
);

490 if(
°©us
 == 0)

491 
glucCﬁlWrôePídög
 = 
åue
;

495 i‡–
keys
 & 
HAL_KEY_LEFT
 )

498 i‡–
glucCﬁlSèã
 !
BLE_STATE_CONNECTED
 && !
glucCﬁlSˇ¬ög
 && 
glucCﬁlSˇnRes
 > 0 )

501 
glucCﬁlSˇnIdx
++;

502 i‡–
glucCﬁlSˇnIdx
 >
glucCﬁlSˇnRes
 )

504 
glucCﬁlSˇnIdx
 = 0;

507 
	`LCD_WRITE_STRING_VALUE
–"Devi˚", 
glucCﬁlSˇnIdx
 + 1,

508 10, 
HAL_LCD_LINE_1
 );

509 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
glucCﬁlDevLi°
[
glucCﬁlSˇnIdx
].
addr
 ),

510 
HAL_LCD_LINE_2
 );

511 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

513 i‡–
glucCﬁlSèã
 =
BLE_STATE_CONNECTED
 )

515 
uöt8
 
°©us
;

518 
°©us
 = 
	`gluco£CéP¡Wrôe
(
CTL_PNT_OP_ABORT
, 
CTL_PNT_OPER_NULL
);

520 if(
°©us
 == 0)

521 
glucCﬁlWrôePídög
 = 
Ál£
;

525 i‡–
keys
 & 
HAL_KEY_RIGHT
 )

528 i‡–
glucCﬁlSèã
 =
BLE_STATE_CONNECTED
 &&

529 
glucCﬁlCh¨Hdls
 =
åue
 &&

530 
glucCﬁlWrôePídög
 =
Ál£
)

532 
uöt8
 
°©us
;

533 #i‡
GLUCOSE_FILTER_ENABLED


534 
°©us
 = 
	`gluco£CéP¡WrôeFûãr
(
CTL_PNT_OP_REQ
, 
CTL_PNT_OPER_RANGE
,

535 
DEFAULT_FILTER_TYPE
, 
pFûãr1
, 
pFûãr2
);

537 
°©us
 = 
	`gluco£CéP¡Wrôe
(
CTL_PNT_OP_REQ
, 
CTL_PNT_OPER_ALL
);

539 if(
°©us
 =
SUCCESS
)

540 
glucCﬁlWrôePídög
 = 
åue
;

544 i‡–
keys
 & 
HAL_KEY_CENTER
 )

546 
uöt8
 
addrTy≥
;

547 
uöt8
 *
≥îAddr
;

550 i‡–
glucCﬁlSèã
 =
BLE_STATE_IDLE
 )

553 i‡–
glucCﬁlSˇnRes
 > 0 )

556 
≥îAddr
 = 
glucCﬁlDevLi°
[
glucCﬁlSˇnIdx
].
addr
;

557 
addrTy≥
 = 
glucCﬁlDevLi°
[
glucCﬁlSˇnIdx
].addrType;

559 
glucCﬁlSèã
 = 
BLE_STATE_CONNECTING
;

561 
	`GAPCíåÆRﬁe_E°ablishLök
–
DEFAULT_LINK_HIGH_DUTY_CYCLE
,

562 
DEFAULT_LINK_WHITE_LIST
,

563 
addrTy≥
, 
≥îAddr
 );

565 
	`LCD_WRITE_STRING
–"C⁄√˘ög", 
HAL_LCD_LINE_1
 );

566 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
≥îAddr
 ), 
HAL_LCD_LINE_2
 );

567 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

570 i‡–
glucCﬁlSèã
 =
BLE_STATE_CONNECTING
 ||

571 
glucCﬁlSèã
 =
BLE_STATE_CONNECTED
 )

574 
glucCﬁlSèã
 = 
BLE_STATE_DISCONNECTING
;

576 
gSètus
 = 
	`GAPCíåÆRﬁe_Tîmö©eLök
–
glucCﬁlC⁄nH™dÀ
 );

578 
	`LCD_WRITE_STRING
–"Disc⁄√˘ög", 
HAL_LCD_LINE_1
 );

579 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

580 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

584 i‡–
keys
 & 
HAL_KEY_DOWN
 )

587 i‡–
glucCﬁlSèã
 =
BLE_STATE_CONNECTED
 &&

588 
glucCﬁlCh¨Hdls
 =
åue
 &&

589 
glucCﬁlWrôePídög
 =
Ál£
)

591 
uöt8
 
°©us
;

592 #i‡
GLUCOSE_FILTER_ENABLED


593 
°©us
 = 
	`gluco£CéP¡WrôeFûãr
(
CTL_PNT_OP_CLR
, 
CTL_PNT_OPER_RANGE
,

594 
DEFAULT_FILTER_TYPE
, 
pFûãr1
, 
pFûãr2
);

596 
°©us
 = 
	`gluco£CéP¡Wrôe
(
CTL_PNT_OP_CLR
, 
CTL_PNT_OPER_ALL
);

598 if(
°©us
 == 0)

600 
glucCﬁlWrôePídög
 = 
åue
;

601 
glucCﬁlCÀ¨Pídög
 = 
åue
;

604 i‡–
glucCﬁlSèã
 !
BLE_STATE_CONNECTED
 )

607 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_ERASE_ALLBONDS
, 0, 
NULL
 );

608 
	`LCD_WRITE_STRING
–"Eøsög b⁄ds", 
HAL_LCD_LINE_1
 );

609 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

610 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

613 
glucCﬁlCh¨Hdls
 = 
Ál£
;

616 
	}
}

625 
	$glucCﬁlPro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 )

627 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_NOTI
 ||

628 
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_IND
 )

630 
	`gluco£IndG©tMsg
–
pMsg
 );

632 i‡–
pMsg
->
mëhod
 =
ATT_READ_RSP
 ||

633 
pMsg
->
mëhod
 =
ATT_WRITE_RSP
)

635 if(
glucCﬁlCh¨Hdls
 =
åue
)

637 
	`gluco£CéP¡G©tMsg
(
pMsg
);

641 
glucCﬁlC⁄figSèã
 = 
	`gluco£C⁄figG©tMsg
 ( glucCﬁlC⁄figSèã, 
pMsg
 );

644 if(
glucCﬁlDiscSèã
 !
DISC_IDLE
)

646 
glucCﬁlDiscSèã
 = 
	`gluco£DiscG©tMsg
(glucCﬁlDiscSèã, 
pMsg
);

647 i‡–
glucCﬁlDiscSèã
 =
DISC_IDLE
 )

650 
glucCﬁlC⁄figSèã
 = 
	`gluco£C⁄figNext
–
GLUCOSE_CONFIG_START
 );

653 i‡(
pMsg
->
mëhod
 =
ATT_ERROR_RSP
)

655 if(
glucCﬁlCh¨Hdls
 =
åue
)

657 
	`gluco£CéP¡G©tMsg
(
pMsg
);

661 
glucCﬁlC⁄figSèã
 = 
	`gluco£C⁄figG©tMsg
 ( glucCﬁlC⁄figSèã, 
pMsg
 );

664 
	}
}

676 
	$glucCﬁlCíåÆRssiCB
–
uöt16
 
c⁄nH™dÀ
, 
öt8
 
rssi
 )

679 
	}
}

690 
	$glucCﬁlCíåÆEvítCB
–
g≠CíåÆRﬁeEvít_t
 *
pEvít
 )

692  
pEvít
->
g≠
.
›code
 )

694 
GAP_DEVICE_INIT_DONE_EVENT
:

696 
	`LCD_WRITE_STRING
–"Gluc. CﬁÀ˘‹", 
HAL_LCD_LINE_1
 );

697 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
pEvít
->
öôD⁄e
.
devAddr
 ), 
HAL_LCD_LINE_2
 );

701 
GAP_DEVICE_INFO_EVENT
:

704 i‡–
DEFAULT_DEV_DISC_BY_SVC_UUID
 =
TRUE
 )

706 i‡–
	`glucCﬁlFödSvcUuid
–
GLUCOSE_SERV_UUID
,

707 
pEvít
->
devi˚Info
.
pEvtD©a
,

708 
pEvít
->
devi˚Info
.
d©aLí
 ) )

710 
	`glucCﬁlAddDevi˚Info
–
pEvít
->
devi˚Info
.
addr
,ÖEvít->devi˚Info.
addrTy≥
 );

716 
GAP_DEVICE_DISCOVERY_EVENT
:

719 
glucCﬁlSˇ¬ög
 = 
FALSE
;

722 i‡–
DEFAULT_DEV_DISC_BY_SVC_UUID
 =
FALSE
 )

725 
glucCﬁlSˇnRes
 = 
pEvít
->
discCm∂
.
numDevs
;

726 
	`oßl_mem˝y
–
glucCﬁlDevLi°
, 
pEvít
->
discCm∂
.
pDevLi°
,

727 (–
g≠DevRec_t
 ) * 
pEvít
->
discCm∂
.
numDevs
) );

730 
	`LCD_WRITE_STRING_VALUE
–"Devi˚†Found", 
glucCﬁlSˇnRes
,

731 10, 
HAL_LCD_LINE_1
 );

732 i‡–
glucCﬁlSˇnRes
 > 0 )

734 
	`LCD_WRITE_STRING
–"<- TÿSñe˘", 
HAL_LCD_LINE_2
 );

738 
glucCﬁlSˇnIdx
 = 
glucCﬁlSˇnRes
;

743 
GAP_LINK_ESTABLISHED_EVENT
:

745 i‡–
pEvít
->
g≠
.
hdr
.
°©us
 =
SUCCESS
 )

747 
glucCﬁlSèã
 = 
BLE_STATE_CONNECTED
;

748 
glucCﬁlC⁄nH™dÀ
 = 
pEvít
->
lökCm∂
.
c⁄√˘i⁄H™dÀ
;

752 i‡–
glucCﬁlCh¨Hdls
 =
Ál£
)

754 
	`oßl_°¨t_timîEx
–
glucCﬁlTaskId
, 
START_DISCOVERY_EVT
, 
DEFAULT_SVC_DISCOVERY_DELAY
 );

757 
	`LCD_WRITE_STRING
–"C⁄√˘ed", 
HAL_LCD_LINE_1
 );

758 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
pEvít
->
lökCm∂
.
devAddr
 ), 
HAL_LCD_LINE_2
 );

762 
glucCﬁlSèã
 = 
BLE_STATE_IDLE
;

763 
glucCﬁlC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

764 
glucCﬁlDiscSèã
 = 
DISC_IDLE
;

766 
	`LCD_WRITE_STRING
–"C⁄√˘ Faûed", 
HAL_LCD_LINE_1
 );

767 
	`LCD_WRITE_STRING_VALUE
–"Rós⁄:", 
pEvít
->
g≠
.
hdr
.
°©us
, 10, 
HAL_LCD_LINE_2
 );

768 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

773 
GAP_LINK_TERMINATED_EVENT
:

775 
glucCﬁlSèã
 = 
BLE_STATE_IDLE
;

776 
glucCﬁlC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

777 
glucCﬁlDiscSèã
 = 
DISC_IDLE
;

778 
glucCﬁlPaúögSèπed
 = 
Ál£
;

779 
glucCﬁlDiscPo°p⁄ed
 = 
Ál£
;

780 
glucCﬁlCÀ¨Pídög
 = 
Ál£
;

783 
	`oßl_°›_timîEx
–
glucCﬁlTaskId
, 
PROCEDURE_TIMEOUT_EVT
 );

785 
	`LCD_WRITE_STRING
–"Disc⁄√˘ed", 
HAL_LCD_LINE_1
 );

786 
	`LCD_WRITE_STRING_VALUE
–"Rós⁄:", 
pEvít
->
lökTîmö©e
.
ªas⁄
,

787 10, 
HAL_LCD_LINE_2
 );

788 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

792 
GAP_LINK_PARAM_UPDATE_EVENT
:

794 
	`LCD_WRITE_STRING
–"P¨am Upd©e", 
HAL_LCD_LINE_1
 );

795 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

796 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

803 
	}
}

812 
	$glucCﬁlCíåÆPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 )

814 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_STARTED
 )

816 
glucCﬁlPaúögSèπed
 = 
åue
;

818 
	`LCD_WRITE_STRING
–"Paúög sèπed", 
HAL_LCD_LINE_1
 );

820 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_COMPLETE
 )

822 
glucCﬁlPaúögSèπed
 = 
Ál£
;

824 i‡–
°©us
 =
SUCCESS
 )

827 i‡–
glucCﬁlDiscPo°p⁄ed
 && 
glucCﬁlCh¨Hdls
 =
Ál£
)

829 
glucCﬁlDiscPo°p⁄ed
 = 
Ál£
;

830 
	`oßl_£t_evít
–
glucCﬁlTaskId
, 
START_DISCOVERY_EVT
 );

833 
	`LCD_WRITE_STRING
–"Paúög suc˚ss", 
HAL_LCD_LINE_1
 );

837 
	`LCD_WRITE_STRING_VALUE
–"Paúög faû", 
°©us
, 10, 
HAL_LCD_LINE_1
 );

840 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_BONDED
 )

842 i‡–
°©us
 =
SUCCESS
 )

844 
	`LCD_WRITE_STRING
–"B⁄dög suc˚ss", 
HAL_LCD_LINE_1
 );

847 
	}
}

856 
	$glucCﬁlCíåÆPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

857 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 )

859 #i‡(
HAL_LCD
 =
TRUE
)

861 
uöt32
 
∑sscode
;

862 
uöt8
 
°r
[7];

865 i‡–
uiI≈uts
 != 0 )

868 
∑sscode
 = 
DEFAULT_PASSCODE
;

873 
	`LL_R™d
–((
uöt8
 *Ë&
∑sscode
), –
uöt32
 ));

876 
∑sscode
 %= 1000000;

879 i‡–
uiOuçuts
 != 0 )

881 
	`LCD_WRITE_STRING
–"Passcode:", 
HAL_LCD_LINE_1
 );

882 
	`LCD_WRITE_STRING
–(*Ë
	`_…ﬂ
(
∑sscode
, 
°r
, 10), 
HAL_LCD_LINE_2
 );

886 
	`GAPB⁄dMgr_PasscodeR•
–
c⁄√˘i⁄H™dÀ
, 
SUCCESS
, 
∑sscode
 );

888 
	}
}

897 
	$glucCﬁlCíåÆSèπDiscovîy
( )

899 
glucCﬁlDiscSèã
 = 
	`gluco£DiscSèπ
();

900 
	}
}

910 
boﬁ
 
	$glucCﬁlFödSvcUuid
–
uöt16
 
uuid
, 
uöt8
 *
pD©a
, uöt8 
d©aLí
 )

912 
uöt8
 
adLí
;

913 
uöt8
 
adTy≥
;

914 
uöt8
 *
pEnd
;

916 
pEnd
 = 
pD©a
 + 
d©aLí
 - 1;

919  
pD©a
 < 
pEnd
 )

922 
adLí
 = *
pD©a
++;

923 i‡–
adLí
 > 0 )

925 
adTy≥
 = *
pD©a
;

928 i‡–
adTy≥
 =
GAP_ADTYPE_16BIT_MORE
 ||ádTy≥ =
GAP_ADTYPE_16BIT_COMPLETE
 )

930 
pD©a
++;

931 
adLí
--;

934  
adLí
 >2 && 
pD©a
 < 
pEnd
 )

937 i‡–
pD©a
[0] =
	`LO_UINT16
(
uuid
Ë&&ÖD©a[1] =
	`HI_UINT16
(uuid) )

940  
TRUE
;

944 
pD©a
 += 2;

945 
adLí
 -= 2;

949 i‡–
adLí
 == 1 )

951 
pD©a
++;

957 
pD©a
 +
adLí
;

963  
FALSE
;

964 
	}
}

973 
	$glucCﬁlAddDevi˚Info
–
uöt8
 *
pAddr
, uöt8 
addrTy≥
 )

975 
uöt8
 
i
;

978 i‡–
glucCﬁlSˇnRes
 < 
DEFAULT_MAX_SCAN_RES
 )

981  
i
 = 0; i < 
glucCﬁlSˇnRes
; i++ )

983 i‡–
	`oßl_memcmp
–
pAddr
, 
glucCﬁlDevLi°
[
i
].
addr
 , 
B_ADDR_LEN
 ) )

990 
	`oßl_mem˝y
–
glucCﬁlDevLi°
[
glucCﬁlSˇnRes
].
addr
, 
pAddr
, 
B_ADDR_LEN
 );

991 
glucCﬁlDevLi°
[
glucCﬁlSˇnRes
].
addrTy≥
 =áddrType;

994 
glucCﬁlSˇnRes
++;

996 
	}
}

1005 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

1007 
uöt8
 
i
;

1008 
hex
[] = "0123456789ABCDEF";

1009 
°r
[
B_ADDR_STR_LEN
];

1010 *
pSå
 = 
°r
;

1012 *
pSå
++ = '0';

1013 *
pSå
++ = 'x';

1016 
pAddr
 +
B_ADDR_LEN
;

1018  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

1020 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

1021 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

1024 *
pSå
 = 0;

1026  
°r
;

1027 
	}
}

	@Projects/ble/GlucoseCollector/Source/glucoseCollector.h

40 #i‚de‡
GLUCOSECOLLECTOR_H


41 
	#GLUCOSECOLLECTOR_H


	)

43 #ifde‡
__˝lu•lus


59 
DISC_IDLE
 = 0x00,

61 
DISC_GLUCOSE_START
 = 0x10,

62 
DISC_GLUCOSE_SVC
,

63 
DISC_GLUCOSE_CHAR
,

64 
DISC_GLUCOSE_CCCD
,

65 
DISC_GLUCOSE_CONTEXT_CCCD
,

66 
DISC_GLUCOSE_CTL_PNT_CCCD
,

68 
DISC_DEVINFO_START
 = 0x20,

69 
DISC_DEVINFO_SVC
,

70 
DISC_DEVINFO_CHAR
,

72 
DISC_FAILED
 = 0xFF

79 
HDL_GLUCOSE_START
,

80 
HDL_GLUCOSE_END
,

81 
HDL_GLUCOSE_MEAS_CCCD
,

82 
HDL_GLUCOSE_CONTEXT_START
,

83 
HDL_GLUCOSE_CONTEXT_END
,

84 
HDL_GLUCOSE_CONTEXT_CCCD
,

85 
HDL_GLUCOSE_FEATURE
,

86 
HDL_GLUCOSE_CTL_PNT_START
,

87 
HDL_GLUCOSE_CTL_PNT_END
,

88 
HDL_GLUCOSE_CTL_PNT_CCCD
,

89 
HDL_DEVINFO_SYSTEM_ID
,

90 
HDL_DEVINFO_MODEL_NUM
,

91 
HDL_DEVINFO_MANUFACTURER_NAME
,

93 
HDL_CACHE_LEN


97 
	#GLUCOSE_CONFIG_START
 0x00

	)

98 
	#GLUCOSE_CONFIG_CMPL
 0xFF

	)

101 
	#START_DEVICE_EVT
 0x0001

	)

102 
	#START_DISCOVERY_EVT
 0x0002

	)

103 
	#PROCEDURE_TIMEOUT_EVT
 0x0004

	)

110 #i‡
HAL_LCD
 =
TRUE


111 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
Ë
	`HÆLcdWrôeSåög
–(°r), (›ti⁄))

	)

112 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
Ë
	`HÆLcdWrôeS¸ìn
–÷öe1), (löe2Ë)

	)

113 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
Ë
	`HÆLcdWrôeSåögVÆue
–—ôÀ), (vÆue), (f‹m©), (löeË)

	)

115 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
)

	)

116 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
)

	)

117 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
)

	)

124 
uöt8
 
glucCﬁlTaskId
;

127 
uöt16
 
glucCﬁlC⁄nH™dÀ
;

130 
uöt16
 
gluco£Fótuªs
;

133 
uöt16
 
gluco£HdlCache
[
HDL_CACHE_LEN
];

136 
boﬁ
 
glucCﬁlWrôePídög
;

139 
boﬁ
 
glucCﬁlCÀ¨Pídög
;

149 
GlucCﬁl_Inô
–
uöt8
 
èsk_id
 );

154 
uöt16
 
GlucCﬁl_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

160 
uöt8
 
gluco£DiscSèπ
( );

161 
uöt8
 
gluco£DiscG©tMsg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

166 
uöt8
 
gluco£C⁄figNext
–uöt8 
°©e
 );

167 
uöt8
 
gluco£C⁄figG©tMsg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

172 
gluco£IndG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

177 
uöt8
 
gluco£CéP¡Wrôe
(uöt8 
›code
, uöt8 
›î
);

178 
uöt8
 
gluco£CéP¡WrôeFûãr
(uöt8 
›code
, uöt8 
›î
, uöt8 
fûãrTy≥
,

179 * 
∑øm1
, * 
∑øm2
);

180 
gluco£CéP¡G©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

185 #ifde‡
__˝lu•lus


	@Projects/ble/GlucoseCollector/Source/glucoseCollector_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

72 
	$maö
()

75 
	`HAL_BOARD_INIT
();

78 
	`InôBﬂrd
–
OB_COLD
 );

81 
	`HÆDrivîInô
();

84 
	`oßl_¢v_öô
();

89 
	`oßl_öô_sy°em
();

92 
	`HAL_ENABLE_INTERRUPTS
();

95 
	`InôBﬂrd
–
OB_READY
 );

97 #i‡
	`deföed
 ( 
POWER_SAVING
 )

98 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

102 
	`oßl_°¨t_sy°em
();

105 
	}
}

	@Projects/ble/GlucoseCollector/Source/glucose_config.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_˛ock.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_lcd.h
"

48 
	~"g©t.h
"

49 
	~"g©t_uuid.h
"

50 
	~"g©t£rv≠p.h
"

51 
	~"gluc£rvi˚.h
"

52 
	~"gluco£CﬁÀ˘‹.h
"

59 
	#GLUCOSE_CONFIG_MAX
 ( (
gluco£C⁄figLi°
Ë/ (
uöt8
Ë)

	)

67 c⁄° 
uöt8
 
	ggluco£C⁄figLi°
[] =

69 
HDL_DEVINFO_SYSTEM_ID
,

70 
HDL_DEVINFO_MANUFACTURER_NAME
,

71 
HDL_DEVINFO_MODEL_NUM
,

72 
HDL_GLUCOSE_FEATURE
,

73 
HDL_GLUCOSE_MEAS_CCCD
,

74 
HDL_GLUCOSE_CONTEXT_CCCD
,

75 
HDL_GLUCOSE_CTL_PNT_CCCD


89 
boﬁ
 
glucCﬁlCh¨Hdls
;

113 
uöt8
 
	$gluco£C⁄figNext
–
uöt8
 
°©e
 )

115 
©tRódReq_t
 
ªadReq
;

116 
©tWrôeReq_t
 
wrôeReq
;

117 
boﬁ
 
ªad
;

120  
°©e
 < 
GLUCOSE_CONFIG_MAX
 &&

121 
gluco£HdlCache
[
gluco£C⁄figLi°
[
°©e
]] == 0 )

123 
°©e
++;

127 i‡–
°©e
 =
GLUCOSE_CONFIG_MAX
 )

129 
glucCﬁlCh¨Hdls
 = 
åue
;

130  
GLUCOSE_CONFIG_CMPL
;

134  
gluco£C⁄figLi°
[
°©e
] )

137 
HDL_DEVINFO_SYSTEM_ID
:

138 
HDL_DEVINFO_MANUFACTURER_NAME
:

139 
HDL_DEVINFO_MODEL_NUM
:

140 
HDL_GLUCOSE_FEATURE
:

141 
ªad
 = 
TRUE
;

145 
HDL_GLUCOSE_MEAS_CCCD
:

146 
HDL_GLUCOSE_CONTEXT_CCCD
:

147 
ªad
 = 
FALSE
;

148 
wrôeReq
.
Àn
 = 2;

149 
wrôeReq
.
vÆue
[0] = 
	`LO_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

150 
wrôeReq
.
vÆue
[1] = 
	`HI_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

151 
wrôeReq
.
sig
 = 0;

152 
wrôeReq
.
cmd
 = 0;

156 
HDL_GLUCOSE_CTL_PNT_CCCD
:

157 
ªad
 = 
FALSE
;

158 
wrôeReq
.
Àn
 = 2;

159 
wrôeReq
.
vÆue
[0] = 
	`LO_UINT16
(
GATT_CLIENT_CFG_INDICATE
);

160 
wrôeReq
.
vÆue
[1] = 
	`HI_UINT16
(
GATT_CLIENT_CFG_INDICATE
);

161 
wrôeReq
.
sig
 = 0;

162 
wrôeReq
.
cmd
 = 0;

170 i‡–
ªad
 )

172 
ªadReq
.
h™dÀ
 = 
gluco£HdlCache
[
gluco£C⁄figLi°
[
°©e
]];

173 
	`GATT_RódCh¨VÆue
–
glucCﬁlC⁄nH™dÀ
, &
ªadReq
, 
glucCﬁlTaskId
 );

177 
wrôeReq
.
h™dÀ
 = 
gluco£HdlCache
[
gluco£C⁄figLi°
[
°©e
]];

178 
	`GATT_WrôeCh¨VÆue
–
glucCﬁlC⁄nH™dÀ
, &
wrôeReq
, 
glucCﬁlTaskId
 );

181  
°©e
;

182 
	}
}

194 
uöt8
 
	$gluco£C⁄figG©tMsg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

196 i‡–(
pMsg
->
mëhod
 =
ATT_READ_RSP
 ||ÖMsg->mëhod =
ATT_WRITE_RSP
) &&

197 (
pMsg
->
hdr
.
°©us
 =
SUCCESS
) )

200  
gluco£C⁄figLi°
[
°©e
] )

202 
HDL_GLUCOSE_MEAS_CCCD
:

204 
HDL_GLUCOSE_CONTEXT_CCCD
:

206 
HDL_GLUCOSE_CTL_PNT_CCCD
:

208 
HDL_GLUCOSE_FEATURE
:

209 
gluco£Fótuªs
 = 
	`BUILD_UINT16
(
pMsg
->
msg
.
ªadR•
.
vÆue
[0],ÖMsg->msg.readRsp.value[1]);

211 
HDL_DEVINFO_SYSTEM_ID
:

213 
HDL_DEVINFO_MANUFACTURER_NAME
:

215 
HDL_DEVINFO_MODEL_NUM
:

222  
	`gluco£C⁄figNext
–
°©e
 + 1 );

223 
	}
}

	@Projects/ble/GlucoseCollector/Source/glucose_ctlpnt.c

42 
	~"bcomdef.h
"

43 
	~"OSAL.h
"

44 
	~"hÆ_lcd.h
"

45 
	~"g©t.h
"

46 
	~"gluc£rvi˚.h
"

47 
	~"gluco£CﬁÀ˘‹.h
"

94 
uöt8
 
	$gluco£CéP¡Wrôe
(
uöt8
 
›code
, uöt8 
›î
)

96 
©tWrôeReq_t
 
wrôeReq
;

98 
wrôeReq
.
vÆue
[0] = 
›code
;

99 
wrôeReq
.
vÆue
[1] = 
›î
;

101 
wrôeReq
.
Àn
 = 2;

102 
wrôeReq
.
sig
 = 0;

103 
wrôeReq
.
cmd
 = 0;

105 
wrôeReq
.
h™dÀ
 = 
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_START
];

106  
	`GATT_WrôeCh¨VÆue
–
glucCﬁlC⁄nH™dÀ
, &
wrôeReq
, 
glucCﬁlTaskId
 );

107 
	}
}

124 
uöt8
 
	$gluco£CéP¡WrôeFûãr
(
uöt8
 
›code
, uöt8 
›î
, uöt8 
fûãrTy≥
,

125 * 
∑øm1
, * 
∑øm2
)

127 
©tWrôeReq_t
 
wrôeReq
;

128 
UTCTimeSåu˘
 *
time1
, *
time2
;

129 
uöt16
 *
£qNum1
, *
£qNum2
;

131 
uöt8
 *
p
 = 
wrôeReq
.
vÆue
;

133 *
p
++ = 
›code
;

134 *
p
++ = 
›î
;

138 
›î
)

140 
CTL_PNT_OPER_LESS_EQUAL
:

141 
CTL_PNT_OPER_GREATER_EQUAL
:

142 *
p
++ = 
fûãrTy≥
;

143 i‡(
fûãrTy≥
 =
CTL_PNT_FILTER_SEQNUM
)

145 
£qNum1
 = 
∑øm1
;

146 *
p
++ = 
	`LO_UINT16
(*
£qNum1
);

147 *
p
++ = 
	`HI_UINT16
(*
£qNum1
);

151 
time1
 = 
∑øm1
;

152 *
p
++ = 
	`LO_UINT16
(
time1
->
yór
);

153 *
p
++ = 
	`HI_UINT16
(
time1
->
yór
);

154 *
p
++ = (
time1
->
m⁄th
 + 1);

155 *
p
++ = (
time1
->
day
 + 1);

156 *
p
++ = 
time1
->
hour
;

157 *
p
++ = 
time1
->
möuãs
;

158 *
p
++ = 
time1
->
£c⁄ds
;

161 
CTL_PNT_OPER_RANGE
:

162 *
p
++ = 
fûãrTy≥
;

163 i‡(
fûãrTy≥
 =
CTL_PNT_FILTER_SEQNUM
)

165 
£qNum1
 = 
∑øm1
;

166 
£qNum2
 = 
∑øm2
;

167 *
p
++ = 
	`LO_UINT16
(*
£qNum1
);

168 *
p
++ = 
	`HI_UINT16
(*
£qNum1
);

169 *
p
++ = 
	`LO_UINT16
(*
£qNum2
);

170 *
p
++ = 
	`HI_UINT16
(*
£qNum2
);

174 
time1
 = 
∑øm1
;

175 
time2
 = 
∑øm2
;

176 *
p
++ = 
	`LO_UINT16
(
time1
->
yór
);

177 *
p
++ = 
	`HI_UINT16
(
time1
->
yór
);

178 *
p
++ = (
time1
->
m⁄th
 + 1);

179 *
p
++ = (
time1
->
day
 + 1);

180 *
p
++ = 
time1
->
hour
;

181 *
p
++ = 
time1
->
möuãs
;

182 *
p
++ = 
time1
->
£c⁄ds
;

184 *
p
++ = 
	`LO_UINT16
(
time2
->
yór
);

185 *
p
++ = 
	`HI_UINT16
(
time2
->
yór
);

186 *
p
++ = (
time2
->
m⁄th
 + 1);

187 *
p
++ = (
time2
->
day
 + 1);

188 *
p
++ = 
time2
->
hour
;

189 *
p
++ = 
time2
->
möuãs
;

190 *
p
++ = 
time2
->
£c⁄ds
;

197 
wrôeReq
.
Àn
 = (
p
 - wrôeReq.
vÆue
);

198 
wrôeReq
.
sig
 = 0;

199 
wrôeReq
.
cmd
 = 0;

201 
wrôeReq
.
h™dÀ
 = 
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_START
];

202  
	`GATT_WrôeCh¨VÆue
–
glucCﬁlC⁄nH™dÀ
, &
wrôeReq
, 
glucCﬁlTaskId
 );

203 
	}
}

213 
	$gluco£CéP¡G©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

215 i‡(
pMsg
->
mëhod
 =
ATT_ERROR_RSP
)

217 
glucCﬁlCÀ¨Pídög
 = 
Ál£
;

218 
	`LCD_WRITE_STRING
("WrôêEº‹", 
HAL_LCD_LINE_1
);

219 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

220 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

222 i‡(
pMsg
->
mëhod
 =
ATT_WRITE_RSP
)

225 
	`oßl_°¨t_timîEx
–
glucCﬁlTaskId
, 
PROCEDURE_TIMEOUT_EVT
, 
GLUCOSE_PROCEDURE_TIMEOUT
 );

228 
glucCﬁlWrôePídög
 = 
Ál£
;

229 
	}
}

	@Projects/ble/GlucoseCollector/Source/glucose_discovery.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_˛ock.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_lcd.h
"

48 
	~"g©t.h
"

49 
	~"g©t_uuid.h
"

50 
	~"gluco£CﬁÀ˘‹.h
"

51 
	~"gluc£rvi˚.h
"

52 
	~"devöfo£rvi˚.h
"

59 
	#CHAR_DESC_HDL_UUID16_LEN
 7

	)

74 
uöt16
 
	ggluco£HdlCache
[
HDL_CACHE_LEN
];

89 
uöt16
 
	ggluco£SvcSèπHdl
;

90 
uöt16
 
	ggluco£SvcEndHdl
;

91 
uöt8
 
	ggluco£EndHdlIdx
;

97 
uöt8
 
Gluco£Disc
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

98 
uöt8
 
Gluco£DevInfoDisc
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

108 
uöt8
 
	$gluco£DiscSèπ
( )

111 
	`oßl_mem£t
–
gluco£HdlCache
, 0, (glucoseHdlCache) );

114  
	`gluco£DiscG©tMsg
–
DISC_GLUCOSE_START
, 
NULL
 );

115 
	}
}

127 
uöt8
 
	$gluco£DiscG©tMsg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

132  
°©e
 & 0xF0 )

135 
DISC_GLUCOSE_START
:

136 
°©e
 = 
	`Gluco£Disc
–°©e, 
pMsg
 );

137 if(
°©e
 =
DISC_IDLE
)

138 
°©e
 = 
DISC_DEVINFO_START
;

141 
DISC_DEVINFO_START
:

142 
°©e
 = 
	`Gluco£DevInfoDisc
–°©e, 
pMsg
);

148 }  (
°©e
 != 0) && ((state & 0x0F) == 0) );

150  
°©e
;

151 
	}
}

163 
uöt8
 
	$Gluco£Disc
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

165 
uöt8
 
√wSèã
 = 
°©e
;

167  
°©e
 )

169 
DISC_GLUCOSE_START
:

171 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
GLUCOSE_SERV_UUID
),

172 
	`HI_UINT16
(
GLUCOSE_SERV_UUID
) };

175 
gluco£SvcSèπHdl
 = 
gluco£SvcEndHdl
 = 0;

176 
gluco£EndHdlIdx
 = 0;

179 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
glucCﬁlC⁄nH™dÀ
, 
uuid
,

180 
ATT_BT_UUID_SIZE
, 
glucCﬁlTaskId
 );

182 
√wSèã
 = 
DISC_GLUCOSE_SVC
;

186 
DISC_GLUCOSE_SVC
:

188 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

189 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

191 
gluco£SvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

192 
gluco£SvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

196 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

197 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

198 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

201 i‡–
gluco£SvcSèπHdl
 != 0 )

204 
	`GATT_DiscAŒCh¨s
–
glucCﬁlC⁄nH™dÀ
, 
gluco£SvcSèπHdl
,

205 
gluco£SvcEndHdl
, 
glucCﬁlTaskId
 );

207 
√wSèã
 = 
DISC_GLUCOSE_CHAR
;

212 
√wSèã
 = 
DISC_FAILED
;

217 
DISC_GLUCOSE_CHAR
:

219 
uöt8
 
i
;

220 
uöt8
 *
p
;

221 
uöt16
 
h™dÀ
;

222 
uöt16
 
uuid
;

225 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

226 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

227 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
)

230 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

231  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

234 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

235 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

238 i‡–
gluco£EndHdlIdx
 != 0 )

241 
gluco£HdlCache
[
gluco£EndHdlIdx
] = 
	`BUILD_UINT16
(
p
[0],Ö[1]) - 1;

243 
gluco£EndHdlIdx
 = 0;

247  
uuid
 )

249 
GLUCOSE_MEAS_UUID
:

250 
gluco£HdlCache
[
HDL_GLUCOSE_START
] = 
h™dÀ
;

251 
gluco£EndHdlIdx
 = 
HDL_GLUCOSE_END
;

254 
GLUCOSE_CONTEXT_UUID
:

255 
gluco£HdlCache
[
HDL_GLUCOSE_CONTEXT_START
] = 
h™dÀ
;

256 
gluco£EndHdlIdx
 = 
HDL_GLUCOSE_CONTEXT_END
;

259 
RECORD_CONTROL_POINT_UUID
:

260 
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_START
] = 
h™dÀ
;

261 
gluco£EndHdlIdx
 = 
HDL_GLUCOSE_CTL_PNT_END
;

264 
GLUCOSE_FEATURE_UUID
:

265 
gluco£HdlCache
[
HDL_GLUCOSE_FEATURE
] = 
h™dÀ
;

272 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

278 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

279 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

280 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

283 i‡–
gluco£EndHdlIdx
 != 0 )

285 
gluco£HdlCache
[
gluco£EndHdlIdx
] = 
gluco£SvcEndHdl
;

286 
gluco£EndHdlIdx
 = 0;

290 i‡–
gluco£HdlCache
[
HDL_GLUCOSE_START
] == 0 )

292 
√wSèã
 = 
DISC_FAILED
;

294 i‡–
gluco£HdlCache
[
HDL_GLUCOSE_START
] <

295 
gluco£HdlCache
[
HDL_GLUCOSE_END
] )

298 
	`GATT_DiscAŒCh¨Descs
–
glucCﬁlC⁄nH™dÀ
,

299 
gluco£HdlCache
[
HDL_GLUCOSE_START
] + 1,

300 
gluco£HdlCache
[
HDL_GLUCOSE_END
],

301 
glucCﬁlTaskId
 );

303 
√wSèã
 = 
DISC_GLUCOSE_CCCD
;

307 
√wSèã
 = 
DISC_IDLE
;

313 
DISC_GLUCOSE_CCCD
:

315 
uöt8
 
i
;

318 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

319 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

320 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

323  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

326 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

327 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

328 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

329 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

332 
gluco£HdlCache
[
HDL_GLUCOSE_MEAS_CCCD
] =

333 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

341 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

342 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

343 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

346 i‡–
gluco£HdlCache
[
HDL_GLUCOSE_MEAS_CCCD
] != 0 )

349 i‡–
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_START
] <

350 
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_END
] )

353 
	`GATT_DiscAŒCh¨Descs
–
glucCﬁlC⁄nH™dÀ
,

354 
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_START
] + 1,

355 
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_END
],

356 
glucCﬁlTaskId
 );

358 
√wSèã
 = 
DISC_GLUCOSE_CTL_PNT_CCCD
;

363 
√wSèã
 = 
DISC_FAILED
;

369 
gluco£HdlCache
[
HDL_GLUCOSE_MEAS_CCCD
] = 0;

370 
√wSèã
 = 
DISC_FAILED
;

376 
DISC_GLUCOSE_CTL_PNT_CCCD
:

378 
uöt8
 
i
;

381 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

382 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

383 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

386  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

389 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

390 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

391 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

392 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

395 
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_CCCD
] =

396 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

404 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

405 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

406 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

409 i‡–
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_CCCD
] != 0 )

412 i‡–
gluco£HdlCache
[
HDL_GLUCOSE_CONTEXT_START
] <

413 
gluco£HdlCache
[
HDL_GLUCOSE_CONTEXT_END
] )

416 
	`GATT_DiscAŒCh¨Descs
–
glucCﬁlC⁄nH™dÀ
,

417 
gluco£HdlCache
[
HDL_GLUCOSE_CONTEXT_START
] + 1,

418 
gluco£HdlCache
[
HDL_GLUCOSE_CONTEXT_END
],

419 
glucCﬁlTaskId
 );

421 
√wSèã
 = 
DISC_GLUCOSE_CONTEXT_CCCD
;

426 
√wSèã
 = 
DISC_IDLE
;

432 
gluco£HdlCache
[
HDL_GLUCOSE_CTL_PNT_CCCD
] = 0;

433 
√wSèã
 = 
DISC_FAILED
;

439 
DISC_GLUCOSE_CONTEXT_CCCD
:

441 
uöt8
 
i
;

444 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

445 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

446 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

449  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

452 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

453 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

454 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

455 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

458 
gluco£HdlCache
[
HDL_GLUCOSE_CONTEXT_CCCD
] =

459 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

467 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

468 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

469 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

471 
√wSèã
 = 
DISC_IDLE
;

480  
√wSèã
;

481 
	}
}

493 
uöt8
 
	$Gluco£DevInfoDisc
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

495 
uöt8
 
√wSèã
 = 
°©e
;

497  
°©e
 )

499 
DISC_DEVINFO_START
:

501 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
DEVINFO_SERV_UUID
),

502 
	`HI_UINT16
(
DEVINFO_SERV_UUID
) };

505 
gluco£SvcSèπHdl
 = 
gluco£SvcEndHdl
 = 0;

506 
gluco£EndHdlIdx
 = 0;

509 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
glucCﬁlC⁄nH™dÀ
, 
uuid
,

510 
ATT_BT_UUID_SIZE
, 
glucCﬁlTaskId
 );

512 
√wSèã
 = 
DISC_DEVINFO_SVC
;

516 
DISC_DEVINFO_SVC
:

518 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

519 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

521 
gluco£SvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

522 
gluco£SvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

526 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

527 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

528 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

531 i‡–
gluco£SvcSèπHdl
 != 0 )

534 
	`GATT_DiscAŒCh¨s
–
glucCﬁlC⁄nH™dÀ
, 
gluco£SvcSèπHdl
,

535 
gluco£SvcEndHdl
, 
glucCﬁlTaskId
 );

537 
√wSèã
 = 
DISC_DEVINFO_CHAR
;

542 
√wSèã
 = 
DISC_FAILED
;

547 
DISC_DEVINFO_CHAR
:

549 
uöt8
 
i
;

550 
uöt8
 *
p
;

551 
uöt16
 
h™dÀ
;

552 
uöt16
 
uuid
;

555 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

556 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

557 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
)

560 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

561  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

564 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

565 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

568  
uuid
 )

570 
DEVINFO_MANUFACTURER_NAME_UUID
:

571 
gluco£HdlCache
[
HDL_DEVINFO_MANUFACTURER_NAME
] = 
h™dÀ
;

574 
DEVINFO_SYSTEM_ID_UUID
:

575 
gluco£HdlCache
[
HDL_DEVINFO_SYSTEM_ID
] = 
h™dÀ
;

578 
DEVINFO_MODEL_NUMBER_UUID
:

579 
gluco£HdlCache
[
HDL_DEVINFO_MODEL_NUM
] = 
h™dÀ
;

586 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

592 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

593 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

594 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

598 i‡–
gluco£HdlCache
[
HDL_DEVINFO_MANUFACTURER_NAME
] == 0 ||

599 
gluco£HdlCache
[
HDL_DEVINFO_SYSTEM_ID
] == 0 ||

600 
gluco£HdlCache
[
HDL_DEVINFO_MODEL_NUM
] == 0)

602 
√wSèã
 = 
DISC_FAILED
;

606 
√wSèã
 = 
DISC_IDLE
;

616  
√wSèã
;

617 
	}
}

	@Projects/ble/GlucoseCollector/Source/glucose_ind.c

43 
	~"°rög.h
"

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_˛ock.h
"

47 
	~"OnBﬂrd.h
"

48 
	~"hÆ_lcd.h
"

49 
	~"g©t.h
"

50 
	~"g©t_uuid.h
"

51 
	~"g©t£rv≠p.h
"

52 
	~"gluc£rvi˚.h
"

53 
	~"gluco£CﬁÀ˘‹.h
"

63 
	#STR_MG_PER_DL
 "mg/dL:"

	)

64 
	#STR_MMOL_PER_L
 "mmﬁ/L:"

	)

72 
uöt8
 
	mÊags
;

73 
uöt16
 
	m£qNum
;

74 
uöt8
 
	mba£Time
[7];

75 
öt16
 
	mtimeOff£t
;

76 
uöt16
 
	mc⁄˚¡øti⁄
;

77 
uöt8
 
	mty≥Sam∂eLoˇti⁄
;

78 
uöt16
 
	m£ns‹Sètus
;

79 } 
	tgluco£Mós_t
;

83 
uöt8
 
	mÊags
;

84 
uöt16
 
	m£qNum
;

85 
uöt8
 
	mexãndedFœgs
;

86 
uöt8
 
	mˇrboId
;

87 
uöt16
 
	mˇrboVÆ
;

88 
uöt8
 
	mmólVÆ
;

89 
uöt8
 
	mTe°îHó…hVÆ
;

90 
uöt16
 
	mexîci£Duøti⁄
;

91 
uöt8
 
	mexîci£I¡ísôy
;

92 
uöt8
 
	mmedId
;

93 
uöt16
 
	mmedVÆ
;

94 
uöt16
 
	mHbA1cVÆ
;

95 } 
	tgluco£C⁄ãxt_t
;

114 
gluco£Mós_t
 
	ggluco£Mós
;

115 
gluco£C⁄ãxt_t
 
	ggluco£C⁄ãxt
;

131 
	$gluco£IndG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

133 
uöt8
 
i
;

136  
i
 = 0; i < 
HDL_CACHE_LEN
; i++ )

138 i‡–
pMsg
->
msg
.
h™dÀVÆueInd
.
h™dÀ
 =
gluco£HdlCache
[
i
] )

145  
i
 )

147 
HDL_GLUCOSE_START
:

149 
uöt8
* 
p
 = 
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
;

152 i‡(
glucCﬁlWrôePídög
 =
åue
)

154 
	`oßl_°¨t_timîEx
–
glucCﬁlTaskId
, 
PROCEDURE_TIMEOUT_EVT
, 
GLUCOSE_PROCEDURE_TIMEOUT
 );

157 
	`mem£t
(&
gluco£Mós
, 0, (glucoseMeas));

160 
gluco£Mós
.
Êags
 = *
p
++;

163 
gluco£Mós
.
£qNum
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

164 
	`LCD_WRITE_STRING_VALUE
–"SeqNum:", 
gluco£Mós
.
£qNum
, 10, 
HAL_LCD_LINE_1
 );

165 
p
 += 2;

168 
	`mem˝y
(
gluco£Mós
.
ba£Time
, 
p
, 7);

169 
p
 += 7;

172 i‡(
gluco£Mós
.
Êags
 & 
GLUCOSE_MEAS_FLAG_TIME_OFFSET
)

174 
gluco£Mós
.
timeOff£t
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

175 
p
 += 2;

179 if(
gluco£Mós
.
Êags
 & 
GLUCOSE_MEAS_FLAG_CONCENTRATION
)

181 
gluco£Mós
.
c⁄˚¡øti⁄
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

182 if(
gluco£Mós
.
Êags
 & 
GLUCOSE_MEAS_FLAG_UNITS
)

183 
	`LCD_WRITE_STRING_VALUE
–
STR_MMOL_PER_L
, 
gluco£Mós
.
c⁄˚¡øti⁄
, 10, 
HAL_LCD_LINE_2
 );

185 
	`LCD_WRITE_STRING_VALUE
–
STR_MG_PER_DL
, 
gluco£Mós
.
c⁄˚¡øti⁄
, 10, 
HAL_LCD_LINE_2
 );

186 
p
 += 2;

189 
gluco£Mós
.
ty≥Sam∂eLoˇti⁄
 = *
p
++;

193 i‡(
gluco£Mós
.
Êags
 & 
GLUCOSE_MEAS_FLAG_STATUS_ANNUNCIATION
)

195 
gluco£Mós
.
£ns‹Sètus
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

196 
p
 += 2;

201 
HDL_GLUCOSE_CONTEXT_START
:

203 
uöt8
* 
p
 = 
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
;

206 i‡(
glucCﬁlWrôePídög
 =
åue
)

208 
	`oßl_°¨t_timîEx
–
glucCﬁlTaskId
, 
PROCEDURE_TIMEOUT_EVT
, 
GLUCOSE_PROCEDURE_TIMEOUT
 );

211 
	`mem£t
(&
gluco£C⁄ãxt
, 0, (glucoseContext));

214 
gluco£C⁄ãxt
.
Êags
 = *
p
++;

217 
gluco£C⁄ãxt
.
£qNum
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

218 
p
 += 2;

221 if(
gluco£C⁄ãxt
.
Êags
 & 
GLUCOSE_CONTEXT_FLAG_EXTENDED
)

223 
gluco£C⁄ãxt
.
exãndedFœgs
 = *
p
++;

227 if(
gluco£C⁄ãxt
.
Êags
 & 
GLUCOSE_CONTEXT_FLAG_CARBO
)

230 
gluco£C⁄ãxt
.
ˇrboId
 = *
p
++;

233 
gluco£C⁄ãxt
.
ˇrboVÆ
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

234 
p
 += 2;

238 if(
gluco£C⁄ãxt
.
Êags
 & 
GLUCOSE_CONTEXT_FLAG_MEAL
)

240 
gluco£C⁄ãxt
.
mólVÆ
 = *
p
++;

244 if(
gluco£C⁄ãxt
.
Êags
 & 
GLUCOSE_CONTEXT_FLAG_TESTER_HEALTH
)

246 
gluco£C⁄ãxt
.
Te°îHó…hVÆ
 = *
p
++;

250 if(
gluco£C⁄ãxt
.
Êags
 & 
GLUCOSE_CONTEXT_FLAG_EXERCISE
)

253 
gluco£C⁄ãxt
.
exîci£Duøti⁄
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

254 
p
 += 2;

257 
gluco£C⁄ãxt
.
exîci£I¡ísôy
 = *
p
++;

261 if(
gluco£C⁄ãxt
.
Êags
 & 
GLUCOSE_CONTEXT_FLAG_MEDICATION
)

264 
gluco£C⁄ãxt
.
medId
 = *
p
++;

267 
gluco£C⁄ãxt
.
medVÆ
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

268 
p
 += 2;

272 if(
gluco£C⁄ãxt
.
Êags
 & 
GLUCOSE_CONTEXT_FLAG_HbA1c
)

274 
gluco£C⁄ãxt
.
HbA1cVÆ
 = 
	`BUILD_UINT16
(
p
[0],Ö[1]);

275 
	`LCD_WRITE_STRING_VALUE
–"HbA1c:", 
gluco£C⁄ãxt
.
HbA1cVÆ
, 10, 
HAL_LCD_LINE_3
 );

276 
p
 += 2;

282 
HDL_GLUCOSE_CTL_PNT_START
:

284 
uöt8
* 
pVÆue
 = 
pMsg
->
msg
.
h™dÀVÆueInd
.
vÆue
;

287 
	`oßl_°›_timîEx
–
glucCﬁlTaskId
, 
PROCEDURE_TIMEOUT_EVT
 );

289 if(
pVÆue
[0] =
CTL_PNT_OP_NUM_RSP
)

291 if(
pMsg
->
msg
.
h™dÀVÆueInd
.
Àn
 >= 3)

293 
	`LCD_WRITE_STRING
("M©chög ", 
HAL_LCD_LINE_1
);

294 
	`LCD_WRITE_STRING
–"Rec‹ds:", 
HAL_LCD_LINE_2
 );

295 
	`LCD_WRITE_STRING_VALUE
("", 
	`BUILD_UINT16
(
pVÆue
[2],ÖVÆue[3]), 10, 
HAL_LCD_LINE_3
 );

298 if(
pVÆue
[0] =
CTL_PNT_OP_REQ_RSP
 && 
glucCﬁlCÀ¨Pídög
)

300 
glucCﬁlCÀ¨Pídög
 = 
Ál£
;

302 if(
pMsg
->
msg
.
h™dÀVÆueInd
.
Àn
 >= 3)

304 
pVÆue
[3])

306 
CTL_PNT_RSP_SUCCESS
:

307 
	`LCD_WRITE_STRING
("Rec‹ds", 
HAL_LCD_LINE_1
);

308 
	`LCD_WRITE_STRING
("CÀ¨ed", 
HAL_LCD_LINE_2
 );

309 
	`LCD_WRITE_STRING
("", 
HAL_LCD_LINE_3
 );

311 
CTL_PNT_RSP_NO_RECORDS
:

312 
	`LCD_WRITE_STRING
("NÿM©chög", 
HAL_LCD_LINE_1
);

313 
	`LCD_WRITE_STRING
("Rec‹ds", 
HAL_LCD_LINE_2
 );

314 
	`LCD_WRITE_STRING
("tÿDñëe", 
HAL_LCD_LINE_3
 );

317 
	`LCD_WRITE_STRING
("Eº‹:", 
HAL_LCD_LINE_1
);

318 
	`LCD_WRITE_STRING_VALUE
("", 
pVÆue
[3], 10, 
HAL_LCD_LINE_2
 );

319 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

324 if(
pVÆue
[0] =
CTL_PNT_OP_REQ_RSP
)

326 if(
pMsg
->
msg
.
h™dÀVÆueInd
.
Àn
 >= 3)

328 
pVÆue
[3])

330 
CTL_PNT_RSP_SUCCESS
:

332 
CTL_PNT_RSP_NO_RECORDS
:

333 
	`LCD_WRITE_STRING
("NÿM©chög", 
HAL_LCD_LINE_1
);

334 
	`LCD_WRITE_STRING
("Rec‹ds", 
HAL_LCD_LINE_2
 );

335 
	`LCD_WRITE_STRING
("Found", 
HAL_LCD_LINE_3
 );

338 
	`LCD_WRITE_STRING
("Eº‹:", 
HAL_LCD_LINE_1
);

339 
	`LCD_WRITE_STRING_VALUE
("", 
pVÆue
[3], 10, 
HAL_LCD_LINE_2
 );

340 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

353 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_IND
 )

355 
	`ATT_H™dÀVÆueCfm
–
pMsg
->
c⁄nH™dÀ
 );

358 
	}
}

	@Projects/ble/GlucoseSensor/Source/Glucose_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

69 
	$maö
()

72 
	`HAL_BOARD_INIT
();

75 
	`InôBﬂrd
–
OB_COLD
 );

78 
	`HÆDrivîInô
();

81 
	`oßl_¢v_öô
();

86 
	`oßl_öô_sy°em
();

89 
	`HAL_ENABLE_INTERRUPTS
();

92 
	`InôBﬂrd
–
OB_READY
 );

94 #i‡
	`deföed
 ( 
POWER_SAVING
 )

95 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

99 
	`oßl_°¨t_sy°em
();

102 
	}
}

	@Projects/ble/GlucoseSensor/Source/OSAL_Glucose.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 
	~"≥rùhîÆ.h
"

77 
	~"gluco£.h
"

84 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

86 
LL_Pro˚ssEvít
,

87 
HÆ_Pro˚ssEvít
,

88 
HCI_Pro˚ssEvít
,

89 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

90 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

92 
L2CAP_Pro˚ssEvít
,

93 
GAP_Pro˚ssEvít
,

94 
GATT_Pro˚ssEvít
,

95 
SM_Pro˚ssEvít
,

96 
GAPRﬁe_Pro˚ssEvít
,

97 
GAPB⁄dMgr_Pro˚ssEvít
,

98 
GATTSîvAµ_Pro˚ssEvít
,

99 
Gluco£_Pro˚ssEvít


102 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

103 
uöt16
 *
	gèsksEvíts
;

118 
	$oßlInôTasks
( )

120 
uöt8
 
èskID
 = 0;

122 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

123 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

126 
	`LL_Inô
–
èskID
++ );

129 
	`HÆ_Inô
–
èskID
++ );

132 
	`HCI_Inô
–
èskID
++ );

134 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

136 
	`oßl_CbTimîInô
–
èskID
 );

137 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

141 
	`L2CAP_Inô
–
èskID
++ );

144 
	`GAP_Inô
–
èskID
++ );

147 
	`GATT_Inô
–
èskID
++ );

150 
	`SM_Inô
–
èskID
++ );

153 
	`GAPRﬁe_Inô
–
èskID
++ );

154 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

156 
	`GATTSîvAµ_Inô
–
èskID
++ );

159 
	`Gluco£_Inô
–
èskID
 );

160 
	}
}

	@Projects/ble/GlucoseSensor/Source/glucose.c

46 
	~"bcomdef.h
"

47 
	~"OSAL.h
"

48 
	~"OSAL_PwrMgr.h
"

49 
	~"OnBﬂrd.h
"

50 
	~"hÆ_adc.h
"

51 
	~"hÆ_Àd.h
"

52 
	~"hÆ_key.h
"

53 
	~"g©t.h
"

54 
	~"hci.h
"

55 
	~"g≠g©t£rvî.h
"

56 
	~"g©t£rv≠p.h
"

57 
	~"lökdb.h
"

58 
	~"≥rùhîÆ.h
"

59 
	~"g≠b⁄dmgr.h
"

60 
	~"gluc£rvi˚.h
"

61 
	~"devöfo£rvi˚.h
"

62 
	~"gluco£.h
"

63 
	~"OSAL_Clock.h
"

74 
	#DEFAULT_FAST_ADV_INTERVAL
 32

	)

77 
	#DEFAULT_FAST_ADV_DURATION
 30

	)

80 
	#DEFAULT_SLOW_ADV_INTERVAL
 1600

	)

83 
	#DEFAULT_SLOW_ADV_DURATION
 30

	)

86 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

89 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 200

	)

92 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 1600

	)

95 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 1

	)

98 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

101 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

104 
	#DEFAULT_PASSCODE
 19655

	)

107 
	#DEFAULT_PAIRING_MODE
 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ


	)

110 
	#DEFAULT_MITM_MODE
 
TRUE


111 

	)

113 
	#DEFAULT_BONDING_MODE
 
TRUE


	)

116 
	#DEFAULT_IO_CAPABILITIES
 
GAPBOND_IO_CAP_DISPLAY_ONLY


117 

	)

119 
	#DEFAULT_NOTI_PERIOD
 100

	)

122 
	#GLUCOSE_MEAS_STATE_VALID
 0x01

	)

123 
	#GLUCOSE_MEAS_STATE_FILTER_PASS
 0x02

	)

124 
	#GLUCOSE_MEAS_STATE_ALL
 (
GLUCOSE_MEAS_STATE_VALID
 | 
GLUCOSE_MEAS_STATE_FILTER_PASS
)

	)

127 
	#MEAS_IDX_MAX
 (
gluco£MósAºay
)/(
gluco£Mós_t
)

	)

130 
	#DYNAMIC_REC_MAX
 3

	)

138 
oßl_evít_hdr_t
 
	mhdr
;

139 
uöt8
 
	mÀn
;

140 
uöt8
 
	md©a
[
GLUCOSE_CTL_PNT_MAX_SIZE
];

141 } 
	tgluco£CéP¡Msg_t
;

146 
uöt8
 
	m°©e
;

147 
uöt8
 
	mÊags
;

148 
uöt16
 
	m£qNum
;

149 
UTCTimeSåu˘
 
	mba£Time
;

150 
öt16
 
	mtimeOff£t
;

151 
uöt16
 
	mc⁄˚¡øti⁄
;

152 
uöt8
 
	mty≥Sam∂eLoˇti⁄
;

153 
uöt16
 
	m£ns‹Sètus
;

154 } 
	tgluco£Mós_t
;

158 
uöt8
 
	mÊags
;

159 
uöt16
 
	m£qNum
;

160 
uöt8
 
	mexãndedFœgs
;

161 
uöt8
 
	mˇrboId
;

162 
uöt16
 
	mˇrboVÆ
;

163 
uöt8
 
	mmólVÆ
;

164 
uöt8
 
	mTe°îHó…hVÆ
;

165 
uöt16
 
	mexîci£Duøti⁄
;

166 
uöt8
 
	mexîci£I¡ísôy
;

167 
uöt8
 
	mmedId
;

168 
uöt16
 
	mmedVÆ
;

169 
uöt16
 
	mHbA1cVÆ
;

170 } 
	tgluco£C⁄ãxt_t
;

177 
uöt8
 
	ggluco£TaskId
;

180 
uöt16
 
	gg≠C⁄nH™dÀ
;

195 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

198 
uöt8
 
	gsˇnD©a
[] =

211 
uöt8
 
	gadvîtD©a
[] =

215 
GAP_ADTYPE_FLAGS
,

216 
GAP_ADTYPE_FLAGS_LIMITED
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

219 
GAP_ADTYPE_16BIT_MORE
,

220 
LO_UINT16
(
GLUCOSE_SERV_UUID
),

221 
HI_UINT16
(
GLUCOSE_SERV_UUID
),

222 
LO_UINT16
(
DEVINFO_SERV_UUID
),

223 
HI_UINT16
(
DEVINFO_SERV_UUID
)

227 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "Glucose Sensor";

230 
boﬁ
 
	ggluco£B⁄ded
 = 
FALSE
;

233 
uöt8
 
	ggluco£B⁄dedAddr
[
B_ADDR_LEN
];

236 
uöt16
 
	gg≠C⁄nH™dÀ
;

239 
©tH™dÀVÆueNŸi_t
 
	ggluco£Mós
;

240 
©tH™dÀVÆueNŸi_t
 
	ggluco£C⁄ãxt
;

241 
©tH™dÀVÆueInd_t
 
	ggluco£CéP¡R•
;

244 
boﬁ
 
	ggluco£SídC⁄ãxt
 = 
Ál£
;

247 
boﬁ
 
	ggluco£AdvC™˚Œed
 = 
FALSE
;

250 
boﬁ
 
	ggluco£SídAŒRec‹ds
 = 
Ál£
;

254 
gluco£Mós_t
 
	ggluco£MósAºay
[] =

258 
GLUCOSE_MEAS_STATE_ALL
,

259 
GLUCOSE_MEAS_FLAG_ALL
,

264 (
GLUCOSE_LOCATION_FINGER
 | 
GLUCOSE_TYPE_CAPILLARY_WHOLE
),

269 
GLUCOSE_MEAS_STATE_ALL
,

270 
GLUCOSE_MEAS_FLAG_ALL
,

275 (
GLUCOSE_LOCATION_AST
 | 
GLUCOSE_TYPE_CAPILLARY_PLASMA
),

280 
GLUCOSE_MEAS_STATE_ALL
,

281 
GLUCOSE_MEAS_FLAG_ALL
,

286 (
GLUCOSE_LOCATION_EARLOBE
 | 
GLUCOSE_TYPE_VENOUS_WHOLE
),

292 
GLUCOSE_MEAS_STATE_ALL
,

293 
GLUCOSE_MEAS_FLAG_ALL
,

298 (
GLUCOSE_LOCATION_CONTROL
 | 
GLUCOSE_TYPE_VENOUS_PLASMA
),

303 
GLUCOSE_MEAS_STATE_ALL
,

304 
GLUCOSE_MEAS_FLAG_ALL
,

309 (
GLUCOSE_LOCATION_NOT_AVAIL
 | 
GLUCOSE_TYPE_ARTERIAL_WHOLE
),

314 
GLUCOSE_MEAS_STATE_ALL
,

315 
GLUCOSE_MEAS_FLAG_ALL
 & ~
GLUCOSE_MEAS_FLAG_UNITS
,

320 (
GLUCOSE_LOCATION_FINGER
 | 
GLUCOSE_TYPE_ARTERIAL_PLASMA
),

326 
GLUCOSE_MEAS_STATE_ALL
,

327 
GLUCOSE_MEAS_FLAG_ALL
 & ~
GLUCOSE_MEAS_FLAG_UNITS
,

332 (
GLUCOSE_LOCATION_FINGER
 | 
GLUCOSE_TYPE_UNDETER_WHOLE
),

337 
GLUCOSE_MEAS_STATE_ALL
,

338 
GLUCOSE_MEAS_FLAG_ALL
 & ~
GLUCOSE_MEAS_FLAG_UNITS
,

343 (
GLUCOSE_LOCATION_AST
 | 
GLUCOSE_TYPE_UNDETER_PLASMA
),

348 
GLUCOSE_MEAS_STATE_ALL
,

349 
GLUCOSE_MEAS_FLAG_ALL
 & ~
GLUCOSE_MEAS_FLAG_UNITS
,

354 (
GLUCOSE_LOCATION_EARLOBE
 | 
GLUCOSE_TYPE_ISF
),

361 
gluco£C⁄ãxt_t
 
	ggluco£C⁄ãxtAºay
[] =

365 
GLUCOSE_CONTEXT_FLAG_ALL
 & ~
GLUCOSE_CONTEXT_FLAG_MEDICATION_UNITS
,

368 
GLUCOSE_CARBO_BREAKFAST
,

370 
GLUCOSE_MEAL_PREPRANDIAL
,

371 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

374 
GLUCOSE_MEDICATION_RAPID
,

380 
GLUCOSE_CONTEXT_FLAG_ALL
 & ~
GLUCOSE_CONTEXT_FLAG_MEDICATION_UNITS
,

383 
GLUCOSE_CARBO_BREAKFAST
,

385 
GLUCOSE_MEAL_PREPRANDIAL
,

386 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

389 
GLUCOSE_MEDICATION_RAPID
,

395 
GLUCOSE_CONTEXT_FLAG_ALL
,

398 
GLUCOSE_CARBO_BREAKFAST
,

400 
GLUCOSE_MEAL_PREPRANDIAL
,

401 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

404 
GLUCOSE_MEDICATION_RAPID
,

410 
GLUCOSE_CONTEXT_FLAG_ALL
 & ~
GLUCOSE_CONTEXT_FLAG_MEDICATION_UNITS
,

413 
GLUCOSE_CARBO_BREAKFAST
,

415 
GLUCOSE_MEAL_PREPRANDIAL
,

416 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

419 
GLUCOSE_MEDICATION_RAPID
,

425 
GLUCOSE_CONTEXT_FLAG_ALL
 & ~
GLUCOSE_CONTEXT_FLAG_MEDICATION_UNITS
,

428 
GLUCOSE_CARBO_BREAKFAST
,

430 
GLUCOSE_MEAL_PREPRANDIAL
,

431 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

434 
GLUCOSE_MEDICATION_RAPID
,

440 
GLUCOSE_CONTEXT_FLAG_ALL
,

443 
GLUCOSE_CARBO_BREAKFAST
,

445 
GLUCOSE_MEAL_PREPRANDIAL
,

446 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

449 
GLUCOSE_MEDICATION_RAPID
,

455 
GLUCOSE_CONTEXT_FLAG_ALL
 & ~
GLUCOSE_CONTEXT_FLAG_MEDICATION_UNITS
,

458 
GLUCOSE_CARBO_BREAKFAST
,

460 
GLUCOSE_MEAL_PREPRANDIAL
,

461 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

464 
GLUCOSE_MEDICATION_RAPID
,

470 
GLUCOSE_CONTEXT_FLAG_ALL
 & ~
GLUCOSE_CONTEXT_FLAG_MEDICATION_UNITS
,

473 
GLUCOSE_CARBO_BREAKFAST
,

475 
GLUCOSE_MEAL_PREPRANDIAL
,

476 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

479 
GLUCOSE_MEDICATION_RAPID
,

485 
GLUCOSE_CONTEXT_FLAG_ALL
,

488 
GLUCOSE_CARBO_BREAKFAST
,

490 
GLUCOSE_MEAL_PREPRANDIAL
,

491 
GLUCOSE_HEALTH_NONE
 | 
GLUCOSE_TESTER_SELF
,

494 
GLUCOSE_MEDICATION_RAPID
,

501 
uöt8
 
	ggluco£MósIdx
 = 0;

503 
uöt16
 
	g£qNum
 = 
MEAS_IDX_MAX
;

509 
gluco£SídNext
( );

510 
gluco£_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

511 
gluco£Pro˚ssCéP¡Msg
–
gluco£CéP¡Msg_t
* 
pMsg
);

512 
gluco£G≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

513 
gluco£_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

514 
gluco£MósSíd
();

515 
gluco£C⁄ãxtSíd
();

516 
gluco£CéP¡Re•⁄£
(
uöt8
 
r•Code
, uöt8 
›code
);

517 
gluco£CéP¡NumRec‹dsRe•⁄£
(
uöt16
 
numRec‹ds
);

518 
gluco£CB
(
uöt8
 
evít
, uöt8* 
vÆueP
, uöt8 
Àn
);

519 
uöt8
 
gluco£M¨kAŒRec‹ds
(
boﬁ
 
£tBôs
, uöt8 
mask
);

520 
uöt8
 
gluco£M¨kFú°VÆidRec‹d
(
boﬁ
 
£tBôs
, uöt8 
mask
);

521 
uöt8
 
gluco£M¨kLa°VÆidRec‹d
(
boﬁ
 
£tBôs
, uöt8 
mask
);

522 
uöt8
 
gluco£VîifyTime
(
UTCTimeSåu˘
* 
pTime
);

523 
uöt8
 
gluco£M¨kAŒRec‹dsE¨lõrTh™SeqNum
(
uöt16
* 
pSeqNum
, 
boﬁ
 
£t
, uöt8 
mask
);

524 
uöt8
 
gluco£M¨kAŒRec‹dsL©îTh™SeqNum
(
uöt16
* 
pSeqNum
, 
boﬁ
 
£t
, uöt8 
mask
);

525 
uöt8
 
gluco£M¨kAŒRec‹dsInR™geSeqNum
(
uöt16
* 
pSeqNum1
, uöt16* 
pSeqNum2
, 
boﬁ
 
£t
, uöt8 
mask
);

526 
uöt8
 
gluco£M¨kAŒRec‹dsE¨lõrTh™Time
(
UTCTimeSåu˘
* 
time
, 
boﬁ
 
£t
, uöt8 
mask
);

527 
uöt8
 
gluco£M¨kAŒRec‹dsL©îTh™Time
(
UTCTimeSåu˘
* 
time
, 
boﬁ
 
£t
, uöt8 
mask
);

528 
uöt8
 
gluco£M¨kAŒRec‹dsInR™geTime
(
UTCTimeSåu˘
* 
time1
, UTCTimeSåu˘* 
time2
, 
boﬁ
 
£t
, uöt8 
mask
);

529 
uöt8
 
gluco£FûãrRec‹ds
(uöt8 
›î
, uöt8 
fûãrTy≥
, * 
∑øm1
, * 
∑øm2
, 
boﬁ
 
£t
, uöt8 
mask
, uöt8 
›code
);

530 
uöt8
 
gluco£FödNumVÆidRec‹ds
();

531 
uöt8
 
gluco£FödFú°VÆidFûãªdIndex
(uöt8 
°¨tIndex
);

532 
gluco£CéP¡H™dÀOpcode
(
uöt8
 
›code
, uöt8 
›î
, uöt8 
fûãrTy≥
, * 
∑øm1
, * 
∑øm2
);

533 
gluco£PasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

534 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 );

535 
gluco£PaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 );

542 
g≠RﬁesCBs_t
 
	ggluco£_PîùhîÆCBs
 =

544 
gluco£G≠SèãCB
,

545 
NULL


549 c⁄° 
g≠B⁄dCBs_t
 
	ggluco£B⁄dCB
 =

551 
gluco£PasscodeCB
,

552 
gluco£PaúSèãCB


573 
	$Gluco£_Inô
–
uöt8
 
èsk_id
 )

575 
gluco£TaskId
 = 
èsk_id
;

579 #i‡
	`deföed
–
CC2540_MINIDK
 )

581 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

584 
uöt8
 
öôül_advîtisög_íabÀ
 = 
TRUE
;

589 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

591 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

592 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

593 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

594 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

595 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

598 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

599 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

601 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnD©a
 ), scanData );

602 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

604 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

605 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

606 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

607 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

608 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

612 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
©tDevi˚Name
 );

616 
uöt32
 
∑sskey
 = 
DEFAULT_PASSCODE
;

617 
uöt8
 
∑úMode
 = 
DEFAULT_PAIRING_MODE
;

618 
uöt8
 
môm
 = 
DEFAULT_MITM_MODE
;

619 
uöt8
 
ioC≠
 = 
DEFAULT_IO_CAPABILITIES
;

620 
uöt8
 
b⁄dög
 = 
DEFAULT_BONDING_MODE
;

622 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
,  ( 
uöt32
 ), &
∑sskey
 );

623 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

624 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

625 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

626 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

630 
VOID
 
	`GATT_InôClõ¡
();

633 
	`GATT_Regi°îF‹Ind
–
gluco£TaskId
 );

636 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

637 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

638 
	`Gluco£_AddSîvi˚
–
GATT_ALL_SERVICES
 );

639 
	`DevInfo_AddSîvi˚
( );

642 
	`Gluco£_Regi°î
 ( 
gluco£CB
);

645 
	`Regi°îF‹Keys
–
gluco£TaskId
 );

647 #i‡
	`deföed
–
CC2540_MINIDK
 )

649 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

655 
P0SEL
 = 0;

656 
P1SEL
 = 0;

657 
P2SEL
 = 0;

659 
P0DIR
 = 0xFC;

661 
P1DIR
 = 0xFF;

662 
P2DIR
 = 0x1F;

664 
P0
 = 0x03;

665 
P1
 = 0;

666 
P2
 = 0;

671 
	`oßl_£t_evít
–
gluco£TaskId
, 
START_DEVICE_EVT
 );

672 
	}
}

687 
uöt16
 
	$Gluco£_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

690 
VOID
 
èsk_id
;

692 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

694 
uöt8
 *
pMsg
;

696 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
gluco£TaskId
 )Ë!
NULL
 )

698 
	`gluco£_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

701 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

705  (
evíts
 ^ 
SYS_EVENT_MSG
);

708 i‡–
evíts
 & 
START_DEVICE_EVT
 )

711 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
gluco£_PîùhîÆCBs
 );

714 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
gluco£B⁄dCB
 );

716  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

719 i‡–
evíts
 & 
NOTI_TIMEOUT_EVT
 )

722 
	`gluco£SídNext
();

724  ( 
evíts
 ^ 
NOTI_TIMEOUT_EVT
 );

728 
	}
}

739 
	$gluco£_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

741  
pMsg
->
evít
 )

743 
KEY_CHANGE
:

744 
	`gluco£_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

747 
CTL_PNT_MSG
:

748 
	`gluco£Pro˚ssCéP¡Msg
–(
gluco£CéP¡Msg_t
 *Ë
pMsg
);

754 
	}
}

768 
	$gluco£_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

770 i‡–
keys
 & 
HAL_KEY_SW_1
 )

772 if(!
gluco£SídAŒRec‹ds
)

776 if(
	`gluco£FödNumVÆidRec‹ds
() > 0)

778 
	`gluco£M¨kAŒRec‹ds
(
åue
, 
GLUCOSE_MEAS_STATE_FILTER_PASS
);

780 
gluco£MósIdx
 = 
	`gluco£FödFú°VÆidFûãªdIndex
(glucoseMeasIdx+1);

781 i‡(
gluco£MósIdx
 =
MEAS_IDX_MAX
)

783 
gluco£MósIdx
 = 
	`gluco£FödFú°VÆidFûãªdIndex
(0);

786 if–
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

788 
	`gluco£MósSíd
();

794  
uöt8
 
i
 = 0; i < 
DYNAMIC_REC_MAX
; i++ )

796 
gluco£MósAºay
[
i
].
°©e
 |
GLUCOSE_MEAS_STATE_VALID
;

797 
gluco£MósAºay
[
i
].
£qNum
 = ++seqNum;

798 
gluco£C⁄ãxtAºay
[
i
].
£qNum
 = seqNum;

801 i‡–
i
 % 2 )

803 
gluco£MósAºay
[
i
].
Êags
 |
GLUCOSE_MEAS_FLAG_CONTEXT_INFO
;

807 
gluco£MósAºay
[
i
].
Êags
 &~
GLUCOSE_MEAS_FLAG_CONTEXT_INFO
;

814 i‡–
keys
 & 
HAL_KEY_SW_2
 )

818 if–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

820 
uöt8
 
°©us
;

823 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

824 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

825 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_ADV_TIMEOUT
, 
DEFAULT_FAST_ADV_DURATION
 );

828 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
°©us
 );

829 
°©us
 = !status;

830 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
°©us
 );

833 i‡(
°©us
 =
FALSE
)

835 
gluco£AdvC™˚Œed
 = 
TRUE
;

839 
	}
}

848 
	$gluco£SídNext
( )

850 if(
gluco£SídC⁄ãxt
)

852 
gluco£SídC⁄ãxt
 = 
Ál£
;

853 
	`gluco£C⁄ãxtSíd
();

855 if(
gluco£SídAŒRec‹ds
)

857 
gluco£MósIdx
 = 
	`gluco£FödFú°VÆidFûãªdIndex
(glucoseMeasIdx + 1);

859 i‡(
gluco£MósIdx
 =
MEAS_IDX_MAX
)

861 
gluco£MósIdx
 = 0;

862 
gluco£SídAŒRec‹ds
 = 
Ál£
;

863 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_SUCCESS
, 
CTL_PNT_OP_REQ
);

867 
	`gluco£MósSíd
();

870 
	}
}

879 
	$gluco£Pro˚ssCéP¡Msg
–
gluco£CéP¡Msg_t
* 
pMsg
)

881 
uöt8
 
›code
 = 
pMsg
->
d©a
[0];

882 
uöt8
 
›î
 = 
pMsg
->
d©a
[1];

883 
UTCTimeSåu˘
 
time1
, 
time2
;

884 
boﬁ
 
›codeVÆid
 = 
åue
;

885 
uöt16
 
£qNum1
, 
£qNum2
;

887 
›code
)

889 
CTL_PNT_OP_REQ
:

890 
CTL_PNT_OP_CLR
:

891 
CTL_PNT_OP_GET_NUM
:

892 if(
›î
 =
CTL_PNT_OPER_NULL
)

894 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPER_INVALID
, 
›code
);

895 
›codeVÆid
 = 
Ál£
;

899 
CTL_PNT_OP_ABORT
:

900 if(
›î
 !
CTL_PNT_OPER_NULL
)

902 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPER_INVALID
, 
›code
);

903 
›codeVÆid
 = 
Ál£
;

908 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPCODE_NOT_SUPPORTED
, 
›code
);

909 
›codeVÆid
 = 
Ál£
;

913 if(
›codeVÆid
)

915 
›î
)

917 
CTL_PNT_OPER_NULL
:

918 
CTL_PNT_OPER_ALL
:

919 
CTL_PNT_OPER_FIRST
:

920 
CTL_PNT_OPER_LAST
:

921 if(
pMsg
->
Àn
 == 2)

923 
	`gluco£CéP¡H™dÀOpcode
(
›code
, 
›î
, 0, 
NULL
, NULL);

928 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPERAND_INVALID
, 
›code
);

933 
CTL_PNT_OPER_RANGE
:

935 i‡(
pMsg
->
d©a
[2] =
CTL_PNT_FILTER_SEQNUM
 &&ÖMsg->
Àn
 == 7)

937 
£qNum1
 = 
	`BUILD_UINT16
(
pMsg
->
d©a
[3],ÖMsg->data[4]);

938 
£qNum2
 = 
	`BUILD_UINT16
(
pMsg
->
d©a
[5],ÖMsg->data[6]);

940 i‡–
£qNum1
 <
£qNum2
 )

942 
	`gluco£CéP¡H™dÀOpcode
(
›code
, 
›î
, 
pMsg
->
d©a
[2], &
£qNum1
, &
£qNum2
);

946 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPERAND_INVALID
, 
›code
);

949 i‡(
pMsg
->
d©a
[2] =
CTL_PNT_FILTER_TIME
 &&ÖMsg->
Àn
 == 17)

951 
time1
.
yór
 = 
	`BUILD_UINT16
(
pMsg
->
d©a
[3],ÖMsg->data[4]);

952 
time1
.
m⁄th
 = 
pMsg
->
d©a
[5];

953 
time1
.
day
 = 
pMsg
->
d©a
[6];

954 
time1
.
hour
 = 
pMsg
->
d©a
[7];

955 
time1
.
möuãs
 = 
pMsg
->
d©a
[8];

956 
time1
.
£c⁄ds
 = 
pMsg
->
d©a
[9];

958 
time2
.
yór
 = 
	`BUILD_UINT16
(
pMsg
->
d©a
[10],ÖMsg->data[11]);

959 
time2
.
m⁄th
 = 
pMsg
->
d©a
[12];

960 
time2
.
day
 = 
pMsg
->
d©a
[13];

961 
time2
.
hour
 = 
pMsg
->
d©a
[14];

962 
time2
.
möuãs
 = 
pMsg
->
d©a
[15];

963 
time2
.
£c⁄ds
 = 
pMsg
->
d©a
[16];

965 
	`gluco£CéP¡H™dÀOpcode
(
›code
, 
›î
, 
pMsg
->
d©a
[2], &
time1
, &
time2
);

969 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPERAND_INVALID
, 
›code
);

973 
CTL_PNT_OPER_LESS_EQUAL
:

974 
CTL_PNT_OPER_GREATER_EQUAL
:

976 i‡(
pMsg
->
d©a
[2] =
CTL_PNT_FILTER_SEQNUM
 &&ÖMsg->
Àn
 == 5)

978 
£qNum1
 = 
	`BUILD_UINT16
(
pMsg
->
d©a
[3],ÖMsg->data[4]);

980 
	`gluco£CéP¡H™dÀOpcode
(
›code
, 
›î
, 
pMsg
->
d©a
[2], &
£qNum1
, 
NULL
);

982 i‡(
pMsg
->
d©a
[2] =
CTL_PNT_FILTER_TIME
 &&ÖMsg->
Àn
 == 10)

984 
time1
.
yór
 = 
	`BUILD_UINT16
(
pMsg
->
d©a
[3],ÖMsg->data[4]);

985 
time1
.
m⁄th
 = 
pMsg
->
d©a
[5];

986 
time1
.
day
 = 
pMsg
->
d©a
[6];

987 
time1
.
hour
 = 
pMsg
->
d©a
[7];

988 
time1
.
möuãs
 = 
pMsg
->
d©a
[8];

989 
time1
.
£c⁄ds
 = 
pMsg
->
d©a
[9];

991 
	`gluco£CéP¡H™dÀOpcode
(
›code
, 
›î
, 
pMsg
->
d©a
[2], &
time1
, 
NULL
);

995 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_FILTER_NOT_SUPPORTED
, 
›code
);

1000 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPER_NOT_SUPPORTED
, 
›code
);

1004 
	}
}

1015 
	$gluco£G≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

1018 i‡–
√wSèã
 =
GAPROLE_CONNECTED
 )

1023 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 &&

1024 
√wSèã
 !
GAPROLE_CONNECTED
)

1026 
uöt8
 
advSèã
 = 
TRUE
;

1029 
gluco£SídAŒRec‹ds
 = 
Ál£
;

1030 
gluco£SídC⁄ãxt
 = 
Ál£
;

1033 
	`oßl_°›_timîEx
(
gluco£TaskId
, 
NOTI_TIMEOUT_EVT
);

1035 i‡–
√wSèã
 =
GAPROLE_WAITING_AFTER_TIMEOUT
 )

1038 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

1039 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

1040 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_ADV_TIMEOUT
, 
DEFAULT_FAST_ADV_DURATION
 );

1045 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

1046 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

1047 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_ADV_TIMEOUT
, 
DEFAULT_SLOW_ADV_DURATION
 );

1051 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

1054 i‡–
g≠ProfûeSèã
 =
GAPROLE_ADVERTISING
 &&

1055 
√wSèã
 =
GAPROLE_WAITING
 )

1058 i‡–
gluco£AdvC™˚Œed
 )

1060 
gluco£AdvC™˚Œed
 = 
FALSE
;

1063 i‡–
	`GAP_GëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
 ) =
DEFAULT_FAST_ADV_INTERVAL
 )

1065 
uöt8
 
advSèã
 = 
TRUE
;

1067 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

1068 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

1069 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_ADV_TIMEOUT
, 
DEFAULT_SLOW_ADV_DURATION
 );

1070 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

1074 i‡–
√wSèã
 =
GAPROLE_STARTED
 )

1077 
uöt8
 
sy°emId
[
DEVINFO_SYSTEM_ID_LEN
];

1078 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
sy°emId
);

1081 
sy°emId
[7] = systemId[5];

1082 
sy°emId
[6] = systemId[4];

1083 
sy°emId
[5] = systemId[3];

1086 
sy°emId
[4] = 0;

1087 
sy°emId
[3] = 0;

1089 
	`DevInfo_SëP¨amëî
(
DEVINFO_SYSTEM_ID
, 
DEVINFO_SYSTEM_ID_LEN
, 
sy°emId
);

1091 
g≠ProfûeSèã
 = 
√wSèã
;

1092 
	}
}

1101 
	$gluco£PaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 )

1103 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_COMPLETE
 )

1105 i‡–
°©us
 =
SUCCESS
 )

1107 
lökDBIãm_t
 *
pIãm
;

1109 i‡–(
pIãm
 = 
	`lökDB_Föd
–
g≠C⁄nH™dÀ
 )Ë!
NULL
 )

1112 
gluco£B⁄ded
 = ( (
pIãm
->
°©eFœgs
 & 
LINK_BOUND
) == LINK_BOUND );

1114 i‡–
gluco£B⁄ded
 )

1116 
	`oßl_mem˝y
–
gluco£B⁄dedAddr
, 
pIãm
->
addr
, 
B_ADDR_LEN
 );

1121 
	}
}

1130 
	$gluco£PasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

1131 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 )

1134 
	`GAPB⁄dMgr_PasscodeR•
–
c⁄√˘i⁄H™dÀ
, 
SUCCESS
, 
DEFAULT_PASSCODE
 );

1135 
	}
}

1144 
	$gluco£MósSíd
()

1147 
uöt8
 *
p
 = 
gluco£Mós
.
vÆue
;

1149 
uöt8
 
Êags
 = 
gluco£MósAºay
[
gluco£MósIdx
].flags;

1152 *
p
++ = 
Êags
;

1155 *
p
++ = 
	`LO_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
£qNum
);

1156 *
p
++ = 
	`HI_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
£qNum
);

1159 *
p
++ = 
	`LO_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
ba£Time
.
yór
);

1160 *
p
++ = 
	`HI_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
ba£Time
.
yór
);

1161 *
p
++ = (
gluco£MósAºay
[
gluco£MósIdx
].
ba£Time
.
m⁄th
 + 1);

1162 *
p
++ = (
gluco£MósAºay
[
gluco£MósIdx
].
ba£Time
.
day
 + 1);

1163 *
p
++ = 
gluco£MósAºay
[
gluco£MósIdx
].
ba£Time
.
hour
;

1164 *
p
++ = 
gluco£MósAºay
[
gluco£MósIdx
].
ba£Time
.
möuãs
;

1165 *
p
++ = 
gluco£MósAºay
[
gluco£MósIdx
].
ba£Time
.
£c⁄ds
;

1168 if(
Êags
 & 
GLUCOSE_MEAS_FLAG_TIME_OFFSET
)

1170 *
p
++ = 
	`LO_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
timeOff£t
);

1171 *
p
++ = 
	`HI_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
timeOff£t
);

1175 if(
Êags
 & 
GLUCOSE_MEAS_FLAG_CONCENTRATION
)

1177 *
p
++ = 
	`LO_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
c⁄˚¡øti⁄
);

1178 *
p
++ = 
	`HI_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
c⁄˚¡øti⁄
);

1179 *
p
++ = 
gluco£MósAºay
[
gluco£MósIdx
].
ty≥Sam∂eLoˇti⁄
;

1182 if(
Êags
 & 
GLUCOSE_MEAS_FLAG_STATUS_ANNUNCIATION
)

1184 *
p
++ = 
	`LO_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
£ns‹Sètus
);

1185 *
p
++ = 
	`HI_UINT16
(
gluco£MósAºay
[
gluco£MósIdx
].
£ns‹Sètus
);

1188 
gluco£Mós
.
Àn
 = (
uöt8
Ë(
p
 - gluco£Mós.
vÆue
);

1191 if(
gluco£MósAºay
[
gluco£MósIdx
].
°©e
 =
GLUCOSE_MEAS_STATE_ALL
)

1193 if(
Êags
 & 
GLUCOSE_MEAS_FLAG_CONTEXT_INFO
)

1195 
gluco£SídC⁄ãxt
 = 
åue
;

1198 
	`Gluco£_MósSíd
–
g≠C⁄nH™dÀ
, &
gluco£Mós
, 
gluco£TaskId
);

1199 
	`oßl_°¨t_timîEx
(
gluco£TaskId
, 
NOTI_TIMEOUT_EVT
, 
DEFAULT_NOTI_PERIOD
);

1201 
	}
}

1210 
	$gluco£C⁄ãxtSíd
()

1213 
uöt8
 *
p
 = 
gluco£C⁄ãxt
.
vÆue
;

1215 
uöt8
 
Êags
 = 
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].flags;

1218 *
p
++ = 
Êags
;

1221 *
p
++ = 
	`LO_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
£qNum
);

1222 *
p
++ = 
	`HI_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
£qNum
);

1224 if(
Êags
 & 
GLUCOSE_CONTEXT_FLAG_EXTENDED
)

1225 *
p
++ = 
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
exãndedFœgs
;

1227 if(
Êags
 & 
GLUCOSE_CONTEXT_FLAG_CARBO
)

1229 *
p
++ = 
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
ˇrboId
;

1230 *
p
++ = 
	`LO_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
ˇrboVÆ
);

1231 *
p
++ = 
	`HI_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
ˇrboVÆ
);

1234 i‡(
Êags
 & 
GLUCOSE_CONTEXT_FLAG_MEAL
)

1236 *
p
++ = 
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
mólVÆ
;

1239 if(
Êags
 & 
GLUCOSE_CONTEXT_FLAG_TESTER_HEALTH
)

1241 *
p
++ = 
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
Te°îHó…hVÆ
;

1244 if(
Êags
 & 
GLUCOSE_CONTEXT_FLAG_EXERCISE
)

1246 *
p
++ = 
	`LO_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
exîci£Duøti⁄
);

1247 *
p
++ = 
	`HI_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
exîci£Duøti⁄
);

1248 *
p
++ = 
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
exîci£I¡ísôy
;

1251 if(
Êags
 & 
GLUCOSE_CONTEXT_FLAG_MEDICATION
)

1253 *
p
++ = 
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
medId
;

1254 *
p
++ = 
	`LO_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
medVÆ
);

1255 *
p
++ = 
	`HI_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
medVÆ
);

1258 if(
Êags
 & 
GLUCOSE_CONTEXT_FLAG_HbA1c
)

1260 *
p
++ = 
	`LO_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
HbA1cVÆ
);

1261 *
p
++ = 
	`HI_UINT16
(
gluco£C⁄ãxtAºay
[
gluco£MósIdx
].
HbA1cVÆ
);

1265 
gluco£C⁄ãxt
.
Àn
 = (
uöt8
Ë(
p
 - gluco£C⁄ãxt.
vÆue
);

1268 if(
gluco£MósAºay
[
gluco£MósIdx
].
°©e
 =
GLUCOSE_MEAS_STATE_ALL
)

1270 
	`Gluco£_C⁄ãxtSíd
–
g≠C⁄nH™dÀ
, &
gluco£C⁄ãxt
, 
gluco£TaskId
);

1271 
	`oßl_°¨t_timîEx
(
gluco£TaskId
, 
NOTI_TIMEOUT_EVT
, 
DEFAULT_NOTI_PERIOD
);

1273 
	}
}

1285 
	$gluco£CéP¡Re•⁄£
(
uöt8
 
r•Code
, uöt8 
›code
)

1287 
gluco£CéP¡R•
.
Àn
 = 4;

1288 
gluco£CéP¡R•
.
vÆue
[0] = 
CTL_PNT_OP_REQ_RSP
;

1289 
gluco£CéP¡R•
.
vÆue
[1] = 
CTL_PNT_OPER_NULL
;

1290 
gluco£CéP¡R•
.
vÆue
[2] = 
›code
;

1291 
gluco£CéP¡R•
.
vÆue
[3] = 
r•Code
;

1293 
	`Gluco£_CéP¡Indiˇã
(
g≠C⁄nH™dÀ
, &
gluco£CéP¡R•
, 
gluco£TaskId
);

1294 
	}
}

1306 
	$gluco£CéP¡NumRec‹dsRe•⁄£
(
uöt16
 
numRec‹ds
)

1308 
gluco£CéP¡R•
.
Àn
 = 4;

1309 
gluco£CéP¡R•
.
vÆue
[0] = 
CTL_PNT_OP_NUM_RSP
;

1310 
gluco£CéP¡R•
.
vÆue
[1] = 
CTL_PNT_OPER_NULL
;

1311 
gluco£CéP¡R•
.
vÆue
[2] = 
	`LO_UINT16
(
numRec‹ds
);

1312 
gluco£CéP¡R•
.
vÆue
[3] = 
	`HI_UINT16
(
numRec‹ds
);

1314 
	`Gluco£_CéP¡Indiˇã
(
g≠C⁄nH™dÀ
, &
gluco£CéP¡R•
, 
gluco£TaskId
);

1315 
	}
}

1326 
	$gluco£CB
(
uöt8
 
evít
, uöt8* 
vÆueP
, uöt8 
Àn
)

1329 
evít
)

1331 
GLUCOSE_CTL_PNT_CMD
:

1333 
gluco£CéP¡Msg_t
* 
msgPå
;

1336 
msgPå
 = (
gluco£CéP¡Msg_t
 *)
	`oßl_msg_Æloˇã
( (glucoseCtlPntMsg_t) );

1337 i‡–
msgPå
 )

1339 
msgPå
->
hdr
.
evít
 = 
CTL_PNT_MSG
;

1340 
msgPå
->
Àn
 =Üen;

1341 
	`oßl_mem˝y
(
msgPå
->
d©a
, 
vÆueP
, 
Àn
);

1343 
	`oßl_msg_£nd
–
gluco£TaskId
, (
uöt8
 *)
msgPå
 );

1351 
	}
}

1363 
uöt8
 
	$gluco£M¨kAŒRec‹ds
(
boﬁ
 
£tBôs
, 
uöt8
 
mask
)

1365 
uöt8
 
i
;

1366 
uöt8
 
cou¡
 = 0;

1368 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1370 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1371 
cou¡
++;

1373 if(
£tBôs
)

1374 
gluco£MósAºay
[
i
].
°©e
 |
mask
;

1376 
gluco£MósAºay
[
i
].
°©e
 &~
mask
;

1380  
cou¡
;

1381 
	}
}

1393 
uöt8
 
	$gluco£M¨kFú°VÆidRec‹d
(
boﬁ
 
£tBôs
, 
uöt8
 
mask
)

1395 
uöt8
 
i
;

1397 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1399 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1401 if(
£tBôs
)

1402 
gluco£MósAºay
[
i
].
°©e
 |
mask
;

1404 
gluco£MósAºay
[
i
].
°©e
 &~
mask
;

1411 
	}
}

1423 
uöt8
 
	$gluco£M¨kLa°VÆidRec‹d
(
boﬁ
 
£tBôs
, 
uöt8
 
mask
)

1425 
uöt8
 
i
;

1427 
i
 = 
MEAS_IDX_MAX
; i > 0; i--)

1429 if(
gluco£MósAºay
[
i
-1].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1431 if(
£tBôs
)

1432 
gluco£MósAºay
[
i
-1].
°©e
 |
mask
;

1434 
gluco£MósAºay
[
i
-1].
°©e
 &~
mask
;

1441 
	}
}

1452 
uöt8
 
	$gluco£VîifyTime
(
UTCTimeSåu˘
* 
pTime
)

1455 i‡(
pTime
->
yór
 < 2000 ||ÖTime->year > 2111)

1457  
Ál£
;

1460 i‡(
pTime
->
day
 == 0 ||ÖTime->day > 31)

1462  
Ál£
;

1465 i‡(
pTime
->
m⁄th
 == 0 ||ÖTime->month > 12)

1467  
Ál£
;

1471 
pTime
->
day
--;

1472 
pTime
->
m⁄th
--;

1474  
åue
;

1475 
	}
}

1488 
uöt8
 
	$gluco£M¨kAŒRec‹dsE¨lõrTh™Time
(
UTCTimeSåu˘
* 
time
, 
boﬁ
 
£t
, 
uöt8
 
mask
)

1490 
uöt8
 
i
;

1491 
uöt8
 
cou¡
 = 0;

1492 
UTCTime
 
ã°Time
;

1493 
UTCTime
 
ªc‹dTime
;

1495 i‡(
	`gluco£VîifyTime
–
time
 ) =
Ál£
)

1500 
ã°Time
 = 
	`oßl_C⁄vîtUTCSecs
–
time
 );

1502 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1504 
ªc‹dTime
 = 
	`oßl_C⁄vîtUTCSecs
(&
gluco£MósAºay
[
i
].
ba£Time
 ) + gluco£MósAºay[i].
timeOff£t
;

1506 if(
ªc‹dTime
 <
ã°Time
)

1508 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1509 
cou¡
++;

1511 if(
£t
)

1512 
gluco£MósAºay
[
i
].
°©e
 |
mask
;

1514 
gluco£MósAºay
[
i
].
°©e
 &~
mask
;

1517  
cou¡
;

1518 
	}
}

1531 
uöt8
 
	$gluco£M¨kAŒRec‹dsL©îTh™Time
(
UTCTimeSåu˘
* 
time
, 
boﬁ
 
£t
, 
uöt8
 
mask
)

1533 
uöt8
 
i
;

1534 
uöt8
 
cou¡
 = 0;

1535 
UTCTime
 
ã°Time
;

1536 
UTCTime
 
ªc‹dTime
;

1538 i‡(
	`gluco£VîifyTime
–
time
 ) =
Ál£
)

1543 
ã°Time
 = 
	`oßl_C⁄vîtUTCSecs
–
time
 );

1545 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1547 
ªc‹dTime
 = 
	`oßl_C⁄vîtUTCSecs
(&
gluco£MósAºay
[
i
].
ba£Time
 ) + gluco£MósAºay[i].
timeOff£t
;

1548 if(
ªc‹dTime
 >
ã°Time
)

1550 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1551 
cou¡
++;

1553 if(
£t
)

1554 
gluco£MósAºay
[
i
].
°©e
 |
mask
;

1556 
gluco£MósAºay
[
i
].
°©e
 &~
mask
;

1560  
cou¡
;

1561 
	}
}

1575 
uöt8
 
	$gluco£M¨kAŒRec‹dsInR™geTime
(
UTCTimeSåu˘
* 
time1
, UTCTimeSåu˘* 
time2
, 
boﬁ
 
£t
, 
uöt8
 
mask
)

1577 
uöt8
 
i
;

1578 
uöt8
 
cou¡
 = 0;

1579 
UTCTime
 
lowEnd
, 
highEnd
;

1580 
UTCTime
 
ªc‹dTime
;

1582 i‡(
	`gluco£VîifyTime
–
time1
 ) =
Ál£
)

1586 i‡(
	`gluco£VîifyTime
–
time2
 ) =
Ál£
)

1591 
lowEnd
 = 
	`oßl_C⁄vîtUTCSecs
–
time1
 );

1592 
highEnd
 = 
	`oßl_C⁄vîtUTCSecs
–
time2
 );

1594 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1596 
ªc‹dTime
 = 
	`oßl_C⁄vîtUTCSecs
(&
gluco£MósAºay
[
i
].
ba£Time
 ) + gluco£MósAºay[i].
timeOff£t
;

1597 if((
ªc‹dTime
 >
lowEnd
Ë&& (ªc‹dTimê<
highEnd
))

1599 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1600 
cou¡
++;

1602 if(
£t
)

1603 
gluco£MósAºay
[
i
].
°©e
 |
mask
;

1605 
gluco£MósAºay
[
i
].
°©e
 &~
mask
;

1609  
cou¡
;

1610 
	}
}

1624 
uöt8
 
	$gluco£M¨kAŒRec‹dsE¨lõrTh™SeqNum
(
uöt16
 *
pSeqNum
, 
boﬁ
 
£t
, 
uöt8
 
mask
)

1626 
uöt8
 
i
;

1627 
uöt8
 
cou¡
 = 0;

1629 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1631 if(
gluco£MósAºay
[
i
].
£qNum
 <*
pSeqNum
)

1633 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1634 
cou¡
++;

1636 if(
£t
)

1637 
gluco£MósAºay
[
i
].
°©e
 |
mask
;

1639 
gluco£MósAºay
[
i
].
°©e
 &~
mask
;

1642  
cou¡
;

1643 
	}
}

1656 
uöt8
 
	$gluco£M¨kAŒRec‹dsL©îTh™SeqNum
(
uöt16
 *
pSeqNum
, 
boﬁ
 
£t
, 
uöt8
 
mask
)

1658 
uöt8
 
i
;

1659 
uöt8
 
cou¡
 = 0;

1661 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1663 if(
gluco£MósAºay
[
i
].
£qNum
 >*
pSeqNum
)

1665 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1666 
cou¡
++;

1668 if(
£t
)

1669 
gluco£MósAºay
[
i
].
°©e
 |
mask
;

1671 
gluco£MósAºay
[
i
].
°©e
 &~
mask
;

1675  
cou¡
;

1676 
	}
}

1690 
uöt8
 
	$gluco£M¨kAŒRec‹dsInR™geSeqNum
(
uöt16
 *
pSeqNum1
, uöt16 *
pSeqNum2
, 
boﬁ
 
£t
, 
uöt8
 
mask
)

1692 
uöt8
 
i
;

1693 
uöt8
 
cou¡
 = 0;

1695 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1697 if((
gluco£MósAºay
[
i
].
£qNum
 >*
pSeqNum1
Ë&& (gluco£MósAºay[i].£qNum <*
pSeqNum2
))

1699 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1700 
cou¡
++;

1702 if(
£t
)

1703 
gluco£MósAºay
[
i
].
°©e
 |
mask
;

1705 
gluco£MósAºay
[
i
].
°©e
 &~
mask
;

1709  
cou¡
;

1710 
	}
}

1727 
uöt8
 
	$gluco£FûãrRec‹ds
(
uöt8
 
›î
, uöt8 
fûãrTy≥
, * 
∑øm1
, * 
∑øm2
, 
boﬁ
 
£t
, uöt8 
mask
, uöt8 
›code
)

1729 
uöt8
 
numFûãªd
 = 0;

1731 
›î
)

1733 
CTL_PNT_OPER_NULL
:

1734 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPER_NOT_SUPPORTED
, 
›code
);

1737 
CTL_PNT_OPER_ALL
:

1738 
numFûãªd
 = 
	`gluco£M¨kAŒRec‹ds
(
£t
, 
mask
);

1741 
CTL_PNT_OPER_FIRST
:

1742 
numFûãªd
 = 
	`gluco£M¨kFú°VÆidRec‹d
(
£t
, 
mask
);

1745 
CTL_PNT_OPER_LAST
:

1746 
numFûãªd
 = 
	`gluco£M¨kLa°VÆidRec‹d
(
£t
, 
mask
);

1749 
CTL_PNT_OPER_RANGE
:

1750 i‡(
fûãrTy≥
 =
CTL_PNT_FILTER_SEQNUM
)

1752 
numFûãªd
 = 
	`gluco£M¨kAŒRec‹dsInR™geSeqNum
(
∑øm1
, 
∑øm2
, 
£t
, 
mask
);

1756 
numFûãªd
 = 
	`gluco£M¨kAŒRec‹dsInR™geTime
(
∑øm1
, 
∑øm2
, 
£t
, 
mask
);

1760 
CTL_PNT_OPER_LESS_EQUAL
:

1761 i‡(
fûãrTy≥
 =
CTL_PNT_FILTER_SEQNUM
)

1763 
numFûãªd
 = 
	`gluco£M¨kAŒRec‹dsE¨lõrTh™SeqNum
(
∑øm1
, 
£t
, 
mask
);

1767 
numFûãªd
 = 
	`gluco£M¨kAŒRec‹dsE¨lõrTh™Time
(
∑øm1
, 
£t
, 
mask
);

1771 
CTL_PNT_OPER_GREATER_EQUAL
:

1772 i‡(
fûãrTy≥
 =
CTL_PNT_FILTER_SEQNUM
)

1774 
numFûãªd
 = 
	`gluco£M¨kAŒRec‹dsL©îTh™SeqNum
(
∑øm1
, 
£t
, 
mask
);

1778 
numFûãªd
 = 
	`gluco£M¨kAŒRec‹dsL©îTh™Time
(
∑øm1
, 
£t
, 
mask
);

1783 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_OPER_INVALID
, 
›code
);

1788  
numFûãªd
;

1789 
	}
}

1798 
uöt8
 
	$gluco£FödNumVÆidRec‹ds
()

1800 
uöt8
 
i
;

1801 
uöt8
 
cou¡
 = 0;

1803 
i
 = 0; i < 
MEAS_IDX_MAX
; i++)

1805 if(
gluco£MósAºay
[
i
].
°©e
 & 
GLUCOSE_MEAS_STATE_VALID
)

1806 
cou¡
++;

1809  
cou¡
;

1810 
	}
}

1821 
uöt8
 
	$gluco£FödFú°VÆidFûãªdIndex
(
uöt8
 
°¨tIndex
)

1823 
uöt8
 
i
;

1825 if(
°¨tIndex
 >
MEAS_IDX_MAX
)

1826  
MEAS_IDX_MAX
;

1828 
i
 = 
°¨tIndex
; i < 
MEAS_IDX_MAX
; i++)

1830 if(
gluco£MósAºay
[
i
].
°©e
 =
GLUCOSE_MEAS_STATE_ALL
)

1834  
i
;

1835 
	}
}

1851 
	$gluco£CéP¡H™dÀOpcode
(
uöt8
 
›code
, uöt8 
›î
, uöt8 
fûãrTy≥
, * 
∑øm1
, * 
∑øm2
)

1853 
›code
)

1855 
CTL_PNT_OP_REQ
:

1857 
	`gluco£M¨kAŒRec‹ds
(
Ál£
, 
GLUCOSE_MEAS_STATE_FILTER_PASS
);

1858 if(
	`gluco£FûãrRec‹ds
(
›î
, 
fûãrTy≥
, 
∑øm1
, 
∑øm2
, 
åue
, 
GLUCOSE_MEAS_STATE_FILTER_PASS
, 
›code
) > 0)

1860 
gluco£SídAŒRec‹ds
 = 
åue
;

1861 
gluco£MósIdx
 = 
	`gluco£FödFú°VÆidFûãªdIndex
(0);

1862 
	`gluco£MósSíd
();

1866 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_NO_RECORDS
, 
›code
);

1870 
CTL_PNT_OP_CLR
:

1871 if(
	`gluco£FûãrRec‹ds
(
›î
, 
fûãrTy≥
, 
∑øm1
, 
∑øm2
, 
Ál£
, 
GLUCOSE_MEAS_STATE_VALID
, 
›code
) > 0)

1873 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_SUCCESS
, 
›code
);

1877 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_NO_RECORDS
, 
›code
);

1881 
CTL_PNT_OP_ABORT
:

1882 
gluco£SídAŒRec‹ds
 = 
Ál£
;

1883 
gluco£SídC⁄ãxt
 = 
Ál£
;

1884 
	`oßl_°›_timîEx
(
gluco£TaskId
, 
NOTI_TIMEOUT_EVT
);

1885 
	`gluco£CéP¡Re•⁄£
(
CTL_PNT_RSP_SUCCESS
, 
›code
);

1888 
CTL_PNT_OP_GET_NUM
:

1890 
	`gluco£M¨kAŒRec‹ds
(
Ál£
, 
GLUCOSE_MEAS_STATE_FILTER_PASS
);

1891 
	`gluco£CéP¡NumRec‹dsRe•⁄£
(
	`gluco£FûãrRec‹ds
(
›î
, 
fûãrTy≥
, 
∑øm1
, 
∑øm2
, 
åue
, 
GLUCOSE_MEAS_STATE_FILTER_PASS
, 
›code
));

1897 
	}
}

	@Projects/ble/GlucoseSensor/Source/glucose.h

40 #i‚de‡
GLUCOSE_H


41 
	#GLUCOSE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#START_DEVICE_EVT
 0x0001

	)

58 
	#NOTI_TIMEOUT_EVT
 0x0002

	)

61 
	#CTL_PNT_MSG
 0xE0

	)

78 
Gluco£_Inô
–
uöt8
 
èsk_id
 );

83 
uöt16
 
Gluco£_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

88 #ifde‡
__˝lu•lus


	@Projects/ble/HIDAdvRemote/Source/OSAL_hidAdvRemote.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_Tasks.h
"

49 
	~"hÆ_drivîs.h
"

52 
	~"hci_é.h
"

55 
	~"Œ.h
"

57 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

58 
	~"oßl_cbTimî.h
"

62 
	~"l2ˇp.h
"

65 
	~"g≠.h
"

66 
	~"g≠g©t£rvî.h
"

67 
	~"g≠b⁄dmgr.h
"

70 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 
	~"≥rùhîÆ.h
"

75 
	~"hiddev.h
"

78 
	~"hidAdvRemŸe.h
"

85 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

87 
LL_Pro˚ssEvít
,

88 
HÆ_Pro˚ssEvít
,

89 
HCI_Pro˚ssEvít
,

90 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

91 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

93 
L2CAP_Pro˚ssEvít
,

94 
GAP_Pro˚ssEvít
,

95 
GATT_Pro˚ssEvít
,

96 
SM_Pro˚ssEvít
,

97 
GAPRﬁe_Pro˚ssEvít
,

98 
GAPB⁄dMgr_Pro˚ssEvít
,

99 
GATTSîvAµ_Pro˚ssEvít
,

100 
HidDev_Pro˚ssEvít
,

101 
HidAdvRemŸe_Pro˚ssEvít


104 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

105 
uöt16
 *
	gèsksEvíts
;

120 
	$oßlInôTasks
( )

122 
uöt8
 
èskID
 = 0;

124 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

125 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

128 
	`LL_Inô
–
èskID
++ );

131 
	`HÆ_Inô
–
èskID
++ );

134 
	`HCI_Inô
–
èskID
++ );

136 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

138 
	`oßl_CbTimîInô
–
èskID
 );

139 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

143 
	`L2CAP_Inô
–
èskID
++ );

146 
	`GAP_Inô
–
èskID
++ );

149 
	`GATT_Inô
–
èskID
++ );

152 
	`SM_Inô
–
èskID
++ );

155 
	`GAPRﬁe_Inô
–
èskID
++ );

156 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

159 
	`GATTSîvAµ_Inô
–
èskID
++ );

162 
	`HidDev_Inô
–
èskID
++ );

165 
	`HidAdvRemŸe_Inô
–
èskID
 );

166 
	}
}

	@Projects/ble/HIDAdvRemote/Source/hidAdvRemote.c

42 
	~"bcomdef.h
"

43 
	~"OSAL.h
"

44 
	~"OSAL_PwrMgr.h
"

45 
	~"oßl_bufmgr.h
"

46 
	~"OnBﬂrd.h
"

48 
	~"HAL_mŸi⁄.h
"

49 
	~"hÆ_drivîs.h
"

50 
	~"hÆ_buzzî.h
"

51 
	~"hÆ_key.h
"

52 
	~"hÆ_adc.h
"

54 
	~"hci.h
"

55 
	~"g©t.h
"

56 
	~"g≠g©t£rvî.h
"

57 
	~"g©t£rv≠p.h
"

58 
	~"lökdb.h
"

59 
	~"≥rùhîÆ.h
"

60 
	~"g≠b⁄dmgr.h
"

62 
	~"hidkbm£rvi˚.h
"

63 
	~"devöfo£rvi˚.h
"

64 
	~"b©t£rvi˚.h
"

65 
	~"hiddev.h
"

67 
	~"hidAdvRemŸe.h
"

78 
	#DEFAULT_HID_IDLE_TIMEOUT
 60000

	)

81 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 8

	)

84 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 8

	)

87 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 50

	)

90 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 500

	)

93 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
TRUE


	)

96 
	#DEFAULT_CONN_PAUSE_PERIPHERAL
 15

	)

99 
	#DEFAULT_PASSCODE
 0

	)

102 
	#DEFAULT_PAIRING_MODE
 
GAPBOND_PAIRING_MODE_INITIATE


	)

105 
	#DEFAULT_MITM_MODE
 
TRUE


106 

	)

108 
	#DEFAULT_BONDING_MODE
 
TRUE


	)

111 
	#DEFAULT_IO_CAPABILITIES
 
GAPBOND_IO_CAP_KEYBOARD_ONLY


112 

	)

114 
	#DEFAULT_BATT_CRITICAL_LEVEL
 6

	)

116 
	#PASSCODE_LEN
 6

	)

119 
	#HID_MOUSE_IN_RPT_LEN
 4

	)

122 
	#HID_KEYBOARD_IN_RPT_LEN
 8

	)

125 
	#HID_CC_IN_RPT_LEN
 2

	)

128 
	#HID_LED_OUT_RPT_LEN
 1

	)

130 
	#HID_CC_RPT_MAX_NUM_SELECTIONS
 3

	)

133 
	#HAR_CAL_DURATION
 5000

	)

136 
	#LED_NUM_LOCK
 0x01

	)

137 
	#LED_CAPS_LOCK
 0x02

	)

140 
	#USAGE_PAGE_UNDEFINED
 0x00

141 
	#USAGE_PAGE_GD
 0x01

142 
	#USAGE_PAGE_CC
 0x02

143 

	)

144 #i‚de‡
KEY_INT_ENABLED


145 
	#KEY_INT_ENABLED
 
TRUE


	)

148 #i‚de‡
HAL_KEY_CODE_NOKEY


149 
	#HAL_KEY_CODE_NOKEY
 0xFF

	)

153 
	#TARGET_TYPE
 0xC0

	)

156 
	#TARGET_RESERVED_INVALID
 0x00

	)

157 
	#TARGET_TV
 0x01

	)

158 
	#TARGET_FAV
 0x02

	)

159 
	#TARGET_VOD
 0x03

	)

162 
	#ACT_START
 0xF0

	)

163 
	#ACT_PAIR
 0xF0

	)

164 
	#ACT_UNPAIR
 0xF1

	)

165 
	#ACT_AIR_MOUSE_CAL
 0xF2

	)

166 
	#ACT_MOUSE_RESOLUTION_DECREASE
 0xF3

	)

167 
	#ACT_MOUSE_RESOLUTION_INCREASE
 0xF4

	)

168 
	#ACT_AIR_MOUSE_CURSOR_CTL
 0xF5

	)

170 
	#MOUSE_DATA_MAX
 127

	)

173 
	#START_DEVICE_EVT
 0x0001

	)

174 
	#DOUBLE_CLICK_TIMER_EVT
 0x0002

	)

175 
	#MOTION_SENSOR_TIMER_EVT
 0x0004

	)

176 
	#CAL_PROGRESS_TIMER_EVT
 0x0008

	)

178 
	#DOUBLE_CLICK_OFF_TIMEOUT
 500

179 
	#MOTION_SENSOR_OFF_TIMEOUT
 5000

180 
	#CAL_PROGRESS_TIMEOUT
 1000

181 

	)

183 
	#MOTION_SENSOR_EXIT_TIMEOUT
 45000

184 

	)

186 
	#BATT_ADC_LEVEL_4_5V
 429

187 
	#BATT_ADC_LEVEL_2_0V
 119

188 

	)

196 
	mMOTION_DETECTOR_DISABLED
,

197 
	mMOTION_DETECTOR_STANDBY
,

198 
	mMOTION_DETECTOR_ENABLED


200 
uöt8
 
	tmŸi⁄Dëe˘‹Sèã_t
;

203 (*
	th¨A˘i⁄Fn_t
)();

208 
uöt8
 
keycode
;

209 
uöt8
 
ußgePage
;

210 } 
	tkeycodeM≠_t
;

217 
uöt8
 
hidAdvRemŸe_TaskId
;

232 
uöt8
 
sˇnR•D©a
[] =

235 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

249 
	}
};

251 
uöt8
 
	gadvîtD©a
[] =

255 
GAP_ADTYPE_FLAGS
,

256 
GAP_ADTYPE_FLAGS_LIMITED
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

260 
GAP_ADTYPE_APPEARANCE
,

261 
LO_UINT16
(
GAP_APPEARE_GENERIC_HID
),

262 
HI_UINT16
(
GAP_APPEARE_GENERIC_HID
),

266 
GAP_ADTYPE_16BIT_MORE
,

267 
LO_UINT16
(
HID_SERVICE_UUID
),

268 
HI_UINT16
(
HID_SERVICE_UUID
),

269 
LO_UINT16
(
BATT_SERVICE_UUID
),

270 
HI_UINT16
(
BATT_SERVICE_UUID
)

273 
uöt8
 
	göôül_advîtisög_íabÀ
 = 
TRUE
;

274 
uöt16
 
	gg≠Rﬁe_AdvîtOffTime
 = 20;

277 
uöt8
 
	g©tDevi˚Name
[] = "HID AdvRemote\0";

280 
uöt16
 
	g≠≥¨™˚
 = 
GAP_APPEARE_GENERIC_HID
;

283 
hidDevCfg_t
 
	ghidAdvRemŸeCfg
 =

285 
DEFAULT_HID_IDLE_TIMEOUT
,

286 
HID_KBD_FLAGS


289 
boﬁ
 
	gdoubÀClickTimîRu¬ög
;

292 
uöt8
 
	gkeyRïóãd
;

293 
boﬁ
 
	gdißbÀMou£MovemítA·îKeyRñó£
;

295 
uöt16
 
	g¨cNoMŸi⁄Cou¡
;

296 
boﬁ
 
	g¨cNoMŸi⁄TimîRu¬ög
=
FALSE
;

299 
uöt8
 
	gmou£Buâ⁄Sèãs
;

300 
uöt8
 
	gßvedMou£Buâ⁄Sèãs
 = 0;

301 
boﬁ
 
	gblockMou£Movemíts
;

302 
boﬁ
 
	gkeyPªs£d
;

303 
mŸi⁄Dëe˘‹Sèã_t
 
	g¨cMŸi⁄Dëe˘‹Sèã
 = 
MOTION_DETECTOR_DISABLED
;

305 
uöt8
 
	gªmaöögPasscodeDigôs
 = 0;

306 
uöt32
 
	g∑sscode
;

309 
CONST
 
keycodeM≠_t
 
	gkeycodeM≠
[48] =

314 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_GD
 },

315 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_GD
 },

316 { 
HID_KEYBOARD_LEFT_GUI
, 
USAGE_PAGE_GD
 },

317 { 
HID_KEYBOARD_LEFT_ARROW
, 
USAGE_PAGE_GD
 },

318 { 
HID_CONSUMER_SCAN_PREV_TRK
, 
USAGE_PAGE_CC
 },

319 { 
HID_MOUSE_BUTTON_LEFT
, 
USAGE_PAGE_GD
 },

320 { 
HID_CONSUMER_VOLUME_DOWN
, 
USAGE_PAGE_CC
 },

321 { 
HID_CONSUMER_VOLUME_UP
, 
USAGE_PAGE_CC
 },

322 { 
HID_CONSUMER_RECORD
, 
USAGE_PAGE_CC
 },

323 { 
HID_KEYBOARD_1
, 
USAGE_PAGE_GD
 },

324 { 
ACT_MOUSE_RESOLUTION_DECREASE
, 
USAGE_PAGE_UNDEFINED
 },

325 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_GD
 },

326 { 
ACT_UNPAIR
, 
USAGE_PAGE_UNDEFINED
 },

327 { 
HID_KEYBOARD_7
, 
USAGE_PAGE_GD
 },

328 { 
HID_KEYBOARD_4
, 
USAGE_PAGE_GD
 },

329 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_GD
 },

330 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_UNDEFINED
 },

331 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_UNDEFINED
 },

332 { 
HID_KEYBOARD_DOWN_ARROW
, 
USAGE_PAGE_GD
 },

333 { 
HID_KEYBOARD_RETURN
, 
USAGE_PAGE_GD
 },

334 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_GD
 },

335 { 
ACT_AIR_MOUSE_CURSOR_CTL
, 
USAGE_PAGE_UNDEFINED
 },

336 { 
HID_KEYBOARD_UP_ARROW
, 
USAGE_PAGE_GD
 },

337 { 
HID_CONSUMER_MUTE
, 
USAGE_PAGE_CC
 },

338 { 
HID_CONSUMER_PLAY
, 
USAGE_PAGE_CC
 },

339 { 
HID_KEYBOARD_2
, 
USAGE_PAGE_GD
 },

340 { 
HID_KEYBOARD_0
, 
USAGE_PAGE_GD
 },

341 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_UNDEFINED
 },

342 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_UNDEFINED
 },

343 { 
HID_KEYBOARD_8
, 
USAGE_PAGE_GD
 },

344 { 
HID_KEYBOARD_5
, 
USAGE_PAGE_GD
 },

345 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_GD
 },

346 { 
HID_CONSUMER_POWER
, 
USAGE_PAGE_CC
 },

347 { 
TARGET_TYPE
 + 
TARGET_TV
, 
USAGE_PAGE_UNDEFINED
 },

348 { 
HID_KEYBOARD_DELETE
, 
USAGE_PAGE_GD
 },

349 { 
HID_KEYBOARD_RIGHT_ARROW
, 
USAGE_PAGE_GD
 },

350 { 
HID_CONSUMER_SCAN_NEXT_TRK
, 
USAGE_PAGE_CC
 },

351 { 
HID_MOUSE_BUTTON_RIGHT
, 
USAGE_PAGE_GD
 },

352 { 
HID_CONSUMER_CHANNEL_DOWN
, 
USAGE_PAGE_CC
 },

353 { 
HID_CONSUMER_CHANNEL_UP
, 
USAGE_PAGE_CC
 },

354 { 
HID_CONSUMER_STOP
, 
USAGE_PAGE_CC
 },

355 { 
HID_KEYBOARD_3
, 
USAGE_PAGE_GD
 },

356 { 
ACT_MOUSE_RESOLUTION_INCREASE
, 
USAGE_PAGE_UNDEFINED
 },

357 { 
ACT_AIR_MOUSE_CAL
, 
USAGE_PAGE_UNDEFINED
 },

358 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_GD
 },

359 { 
HID_KEYBOARD_9
, 
USAGE_PAGE_GD
 },

360 { 
HID_KEYBOARD_6
, 
USAGE_PAGE_GD
 },

361 { 
HID_KEYBOARD_RESERVED
, 
USAGE_PAGE_GD
 }

367 
hidAdvRemŸe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

368 
hidAdvRemŸeH™dÀKeys
–
uöt8
 
keycode
, 
boﬁ
 
keyPªs£d
, uöt8 
keyRïóãd
 );

369 
hidAdvRemŸeGëPasscode
–
uöt8
 
keycode
 );

370 
hidKeybﬂrdSídRï‹t
–
uöt8
 
modifõrs
, uöt8 
keycode
 );

371 
hidMou£SídRï‹t
–
uöt8
 
mou£Sèãs
, 
öt8
 
mickeysX
, i¡8 
mickeysY
 );

372 
hidCCSídRï‹t
–
uöt8
 
cmd
, 
boﬁ
 
keyPªs£d
, uöt8 
keyRïóãd
 );

373 
hidCCBuûdRï‹t
–
uöt8
 *
pBuf
, uöt8 
cmd
 );

375 
hidAdvRemŸePaúKeyA˘i⁄
( );

376 
hidAdvRemŸeU≈aúKeyA˘i⁄
( );

378 
hidAdvRemŸeAúMou£CÆKeyA˘i⁄
( );

379 
hidAdvRemŸeAúMou£Resﬁuti⁄De¸ó£
( );

380 
hidAdvRemŸeAúMou£Resﬁuti⁄In¸ó£
( );

381 
hidAdvRemŸeAúMou£Curs‹CéKeyPªss
( );

382 
hidAdvRemŸeAúMou£Curs‹CéKeyRñó£
( );

384 
uöt8
 
hidAdvRemŸeRcvRï‹t
–uöt8 
Àn
, uöt8 *
pD©a
 );

385 
uöt8
 
hidAdvRemŸeR±CB
–uöt8 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
,

386 
uöt8
 
›î
, uöt8 *
pLí
, uöt8 *
pD©a
 );

387 
hidAdvRemŸeEvtCB
–
uöt8
 
evt
 );

388 
hidAdvRemŸePasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

389 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 );

396 
hidDevCB_t
 
	ghidAdvRemŸeHidCBs
 =

398 
hidAdvRemŸeR±CB
,

399 
hidAdvRemŸeEvtCB
,

400 
hidAdvRemŸePasscodeCB


404 
CONST
 
h¨A˘i⁄Fn_t
 
	gh¨S≥cülKeyA˘i⁄s
[] =

406 
hidAdvRemŸePaúKeyA˘i⁄
,

407 
hidAdvRemŸeU≈aúKeyA˘i⁄
,

408 
hidAdvRemŸeAúMou£CÆKeyA˘i⁄
,

409 
hidAdvRemŸeAúMou£Resﬁuti⁄De¸ó£
,

410 
hidAdvRemŸeAúMou£Resﬁuti⁄In¸ó£
,

411 
hidAdvRemŸeAúMou£Curs‹CéKeyPªss


415 
hidAdvRemŸeKeyCback
–
uöt8
 
keys
, uöt8 
°©e
 );

416 
hidAdvRemŸeCÆBuzzîRög
–
uöt16
 
timeout
, 
uöt8
 
t⁄e
 );

417 
hidAdvRemŸeCÆCom∂ëeCback
( );

418 
hidAdvRemŸeMŸi⁄Sís‹Cback
–
öt16
 
gyroMickeysX
, i¡16 
gyroMickeysY
 );

419 
hidAdvRemŸeBuzzîCom∂ëeCback
( );

422 
hidAdvRemŸeB©tMósSëupCB
( );

423 
hidAdvRemŸeB©tMósTórdownCB
( );

443 
	$HidAdvRemŸe_Inô
–
uöt8
 
èsk_id
 )

445 
hidAdvRemŸe_TaskId
 = 
èsk_id
;

448 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_PAUSE_PERIPHERAL
, 
DEFAULT_CONN_PAUSE_PERIPHERAL
 );

452 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

457 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

459 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

460 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

461 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

462 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

463 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

466 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

467 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

469 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnR•D©a
 ), scanRspData );

470 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

472 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

473 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

474 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

475 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

476 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

481 
g≠PîiC⁄√˘P¨ams_t
 
c⁄nP¨ams
 =

483 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
,

484 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
,

485 
DEFAULT_DESIRED_SLAVE_LATENCY
,

486 
DEFAULT_DESIRED_CONN_TIMEOUT


489 
	`GGS_SëP¨amëî
–
GGS_PERI_CONN_PARAM_ATT
, –
g≠PîiC⁄√˘P¨ams_t
 ), (*)&
c⁄nP¨ams
 );

490 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
,  ( 
©tDevi˚Name
 ) ,áttDeviceName );

491 
	`GGS_SëP¨amëî
–
GGS_APPEARANCE_ATT
, –
uöt16
 ), (*)&
≠≥¨™˚
 );

496 
uöt32
 
∑sskey
 = 
DEFAULT_PASSCODE
;

497 
uöt8
 
∑úMode
 = 
DEFAULT_PAIRING_MODE
;

498 
uöt8
 
môm
 = 
DEFAULT_MITM_MODE
;

499 
uöt8
 
ioC≠
 = 
DEFAULT_IO_CAPABILITIES
;

500 
uöt8
 
b⁄dög
 = 
DEFAULT_BONDING_MODE
;

502 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
, –
uöt32
 ), &
∑sskey
 );

503 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
, –
uöt8
 ), &
∑úMode
 );

504 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
, –
uöt8
 ), &
môm
 );

505 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
, –
uöt8
 ), &
ioC≠
 );

506 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
, –
uöt8
 ), &
b⁄dög
 );

511 
uöt8
 
¸ôiˇl
 = 
DEFAULT_BATT_CRITICAL_LEVEL
;

513 
	`B©t_SëP¨amëî
–
BATT_PARAM_CRITICAL_LEVEL
,  (
uöt8
), &
¸ôiˇl
 );

515 
	`B©t_Sëup
–
HAL_ADC_CHN_AIN6
, 
BATT_ADC_LEVEL_2_0V
, 
BATT_ADC_LEVEL_4_5V
,

516 
hidAdvRemŸeB©tMósSëupCB
, 
hidAdvRemŸeB©tMósTórdownCB
, 
NULL
 );

519 
P1DIR
 |= (1<<5);

520 
P1SEL
 &= ~(1<<5);

521 
P1_5
 = 0;

524 
P0DIR
 |= (1<<6);

525 
P0SEL
 &= ~(1<<6);

526 
P0_6
 = 0;

530 
	`HidKbM_AddSîvi˚
();

533 
	`HidDev_Regi°î
–&
hidAdvRemŸeCfg
, &
hidAdvRemŸeHidCBs
 );

535 
	`HÆKeyInô
();

536 
	`HÆKeyC⁄fig
–
KEY_INT_ENABLED
, 
hidAdvRemŸeKeyCback
 );

537 
	`HÆMŸi⁄C⁄fig
–
hidAdvRemŸeMŸi⁄Sís‹Cback
 );

539 
VOID
 
	`HCI_EXT_HÆtDurögRfCmd
–
HCI_EXT_HALT_DURING_RF_DISABLE
 );

542 
	`oßl_°¨t_timîEx
–
hidAdvRemŸe_TaskId
, 
START_DEVICE_EVT
, 500 );

543 
	}
}

558 
uöt16
 
	$HidAdvRemŸe_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

560 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

562 
uöt8
 *
pMsg
;

564 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
hidAdvRemŸe_TaskId
 )Ë!
NULL
 )

566 
	`hidAdvRemŸe_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

569 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

573  (
evíts
 ^ 
SYS_EVENT_MSG
);

576 i‡–
evíts
 & 
START_DEVICE_EVT
 )

578 
	`HÆKeyInô
();

579 
	`HÆKeyC⁄fig
–
KEY_INT_ENABLED
, 
hidAdvRemŸeKeyCback
 );

581  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

584 i‡–
evíts
 & 
DOUBLE_CLICK_TIMER_EVT
 )

587 
doubÀClickTimîRu¬ög
 = 
FALSE
;

589  ( 
evíts
 ^ 
DOUBLE_CLICK_TIMER_EVT
 );

592 i‡–
evíts
 & 
MOTION_SENSOR_TIMER_EVT
 )

595 
	`HÆMŸi⁄DißbÀ
();

596 
¨cMŸi⁄Dëe˘‹Sèã
 = 
MOTION_DETECTOR_DISABLED
;

599 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

601  ( 
evíts
 ^ 
MOTION_SENSOR_TIMER_EVT
 );

604 i‡–
evíts
 & 
CAL_PROGRESS_TIMER_EVT
 )

606 
	`hidAdvRemŸeCÆBuzzîRög
–1, 
HAL_BUZZER_HIGH_TONE
 );

608  ( 
evíts
 ^ 
CAL_PROGRESS_TIMER_EVT
 );

613 
	}
}

624 
	$hidAdvRemŸe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

627 
	}
}

640 
	$hidAdvRemŸeKeyCback
(
uöt8
 
keys
, uöt8 
°©e
)

642 
uöt8
 
œ°Key
 = 
HAL_KEY_CODE_NOKEY
;

643 
uöt8
 
œ°Cmd
 = 
HID_KEYBOARD_RESERVED
;

644 
boﬁ
 
£ndMou£Rï‹t
 = 
FALSE
;

647 
uöt8
 
cmd
 = 
keycodeM≠
[
keys
].
keycode
;

649 (Ë
°©e
;

651 i‡–
keys
 =
HAL_KEY_CODE_NOKEY
 )

654 
cmd
 = 
HID_KEYBOARD_RESERVED
;

655 
keyRïóãd
 = 0;

657 i‡–
mou£Buâ⁄Sèãs
 != 0 )

665 
œ°Key
 = 
HAL_KEY_CODE_NOKEY
;

666 
mou£Buâ⁄Sèãs
 = 0;

667 
£ndMou£Rï‹t
 = 
TRUE
;

669 i‡–
œ°Cmd
 =
ACT_AIR_MOUSE_CURSOR_CTL
 )

671 
	`hidAdvRemŸeAúMou£Curs‹CéKeyRñó£
();

672 
œ°Cmd
 = 
HID_KEYBOARD_RESERVED
;

675 i‡–
œ°Key
 =
keys
 )

678 i‡–
keyRïóãd
 < 255 )

680 
keyRïóãd
++;

686 
œ°Key
 = 
keys
;

687 
œ°Cmd
 = 
cmd
;

688 
keyRïóãd
 = 0;

694 i‡–
cmd
 =
HID_MOUSE_BUTTON_LEFT
 )

696 
mou£Buâ⁄Sèãs
 |= 0x01;

697 
£ndMou£Rï‹t
 = 
TRUE
;

699 i‡–
cmd
 =
HID_MOUSE_BUTTON_RIGHT
 )

701 
mou£Buâ⁄Sèãs
 |= 0x02;

702 
£ndMou£Rï‹t
 = 
TRUE
;

704 i‡–
cmd
 >
ACT_START
 )

707 
h¨S≥cülKeyA˘i⁄s
[
cmd
 - 
ACT_START
]();

709 i‡–
£ndMou£Rï‹t
 =
FALSE
 )

711 
uöt8
 
key
;

712 
uöt8
 
ußgePage
;

714 i‡–
keys
 =
HAL_KEY_CODE_NOKEY
 )

717 
key
 = 0;

718 
keyPªs£d
 = 
FALSE
;

721 
cmd
 = 
keycodeM≠
[
œ°Key
].
keycode
;

722 
ußgePage
 = 
keycodeM≠
[
œ°Key
].usagePage;

723 
œ°Key
 = 
HAL_KEY_CODE_NOKEY
;

728 
key
 = 
cmd
;

729 
keyPªs£d
 = 
TRUE
;

731 
ußgePage
 = 
keycodeM≠
[
keys
].usagePage;

735 i‡–
ußgePage
 =
USAGE_PAGE_GD
 )

738 
	`hidAdvRemŸeH™dÀKeys
–
key
, 
keyPªs£d
, 
keyRïóãd
 );

740 i‡–
ußgePage
 =
USAGE_PAGE_CC
 )

743 
	`hidCCSídRï‹t
–
cmd
, 
keyPªs£d
, 
keyRïóãd
 );

751 i‡––
£ndMou£Rï‹t
 =
TRUE
 ) &&

752 –
¨cMŸi⁄Dëe˘‹Sèã
 =
MOTION_DETECTOR_DISABLED
 ) &&

753 –
mou£Buâ⁄Sèãs
 !
ßvedMou£Buâ⁄Sèãs
 ) )

755 
	`hidMou£SídRï‹t
–
mou£Buâ⁄Sèãs
, 0, 0 );

757 
ßvedMou£Buâ⁄Sèãs
 = 
mou£Buâ⁄Sèãs
;

759 
	}
}

770 
	$hidAdvRemŸeH™dÀKeys
–
uöt8
 
keycode
, 
boﬁ
 
keyPªs£d
, uöt8 
keyRïóãd
 )

773 i‡–
ªmaöögPasscodeDigôs
 == 0 )

775 i‡–
keycode
 =
HID_KEYBOARD_LEFT_GUI
 )

778 
	`hidKeybﬂrdSídRï‹t
–(0x01 << 3), 
HID_KEYBOARD_RESERVED
 );

783 
	`hidKeybﬂrdSídRï‹t
–
HID_KEYBOARD_RESERVED
, 
keycode
 );

788 i‡–
keyRïóãd
 == 0 )

790 
	`hidAdvRemŸeGëPasscode
–
keycode
 );

793 
	}
}

804 
	$hidAdvRemŸeGëPasscode
–
uöt8
 
keycode
 )

806 i‡–
keycode
 !
HID_KEYBOARD_RESERVED
 )

808 i‡––
keycode
 >
HID_KEYBOARD_1
 ) && ( keycodê<
HID_KEYBOARD_0
 ) )

811 
∑sscode
 *= 10;

812 
∑sscode
 +––
keycode
 - 
HID_KEYBOARD_1
 + 1 ) % 10 );

814 i‡–--
ªmaöögPasscodeDigôs
 == 0 )

817 
	`HidDev_PasscodeR•
–
SUCCESS
, 
∑sscode
 );

823 
	`HidDev_PasscodeR•
–
SMP_PAIRING_FAILED_PASSKEY_ENTRY_FAILED
, 
∑sscode
 );

825 
ªmaöögPasscodeDigôs
 = 0;

828 
	}
}

840 
	$hidKeybﬂrdSídRï‹t
–
uöt8
 
modifõrs
, uöt8 
keycode
 )

842 
uöt8
 
¥evKeycode
 = 
HAL_KEY_CODE_NOKEY
;

843 
uöt8
 
¥evModifõrs
 = 
HID_KEYBOARD_RESERVED
;

846 i‡––
¥evKeycode
 !
keycode
 ) || ( 
¥evModifõrs
 !
modifõrs
 ) )

848 
uöt8
 
buf
[
HID_KEYBOARD_IN_RPT_LEN
];

851 
buf
[0] = 
modifõrs
;

852 
buf
[1] = 0;

853 
buf
[2] = 
keycode
;

854 
buf
[3] = 0;

855 
buf
[4] = 0;

856 
buf
[5] = 0;

857 
buf
[6] = 0;

858 
buf
[7] = 0;

860 
	`HidDev_Rï‹t
–
HID_RPT_ID_KEY_IN
, 
HID_REPORT_TYPE_INPUT
,

861 
HID_KEYBOARD_IN_RPT_LEN
, 
buf
 );

864 
¥evKeycode
 = 
keycode
;

865 
¥evModifõrs
 = 
modifõrs
;

867 
	}
}

880 
	$hidMou£SídRï‹t
–
uöt8
 
mou£Sèãs
, 
öt8
 
mickeysX
, i¡8 
mickeysY
 )

882 
uöt8
 
buf
[
HID_MOUSE_IN_RPT_LEN
];

885 
buf
[0] = 
mou£Sèãs
;

886 
buf
[1] = 
mickeysX
;

887 
buf
[2] = 
mickeysY
;

888 
buf
[3] = 0;

890 
	`HidDev_Rï‹t
–
HID_RPT_ID_MOUSE_IN
, 
HID_REPORT_TYPE_INPUT
,

891 
HID_MOUSE_IN_RPT_LEN
, 
buf
 );

892 
	}
}

905 
	$hidCCSídRï‹t
–
uöt8
 
cmd
, 
boﬁ
 
keyPªs£d
, uöt8 
keyRïóãd
 )

908 i‡–
keyRïóãd
 == 0 )

910 
uöt8
 
buf
[
HID_CC_IN_RPT_LEN
] = { 0, 0 };

913 i‡–
keyPªs£d
 )

915 
	`hidCCBuûdRï‹t
–
buf
, 
cmd
 );

918 
	`HidDev_Rï‹t
–
HID_RPT_ID_CC_IN
, 
HID_REPORT_TYPE_INPUT
,

919 
HID_CC_IN_RPT_LEN
, 
buf
 );

921 
	}
}

933 
	$hidCCBuûdRï‹t
–
uöt8
 *
pBuf
, uöt8 
cmd
 )

935  
cmd
 )

937 
HID_CONSUMER_CHANNEL_UP
:

938 
	`HID_CC_RPT_SET_CHANNEL
–
pBuf
, 
HID_CC_RPT_CHANNEL_UP
 );

941 
HID_CONSUMER_CHANNEL_DOWN
:

942 
	`HID_CC_RPT_SET_CHANNEL
–
pBuf
, 
HID_CC_RPT_CHANNEL_DOWN
 );

945 
HID_CONSUMER_VOLUME_UP
:

946 
	`HID_CC_RPT_SET_VOLUME_UP
–
pBuf
 );

949 
HID_CONSUMER_VOLUME_DOWN
:

950 
	`HID_CC_RPT_SET_VOLUME_DOWN
–
pBuf
 );

953 
HID_CONSUMER_MUTE
:

954 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_MUTE
 );

957 
HID_CONSUMER_POWER
:

958 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_POWER
 );

961 
HID_CONSUMER_RECALL_LAST
:

962 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_LAST
 );

965 
HID_CONSUMER_ASSIGN_SEL
:

966 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_ASSIGN_SEL
 );

969 
HID_CONSUMER_PLAY
:

970 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_PLAY
 );

973 
HID_CONSUMER_PAUSE
:

974 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_PAUSE
 );

977 
HID_CONSUMER_RECORD
:

978 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_RECORD
 );

981 
HID_CONSUMER_FAST_FORWARD
:

982 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_FAST_FWD
 );

985 
HID_CONSUMER_REWIND
:

986 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_REWIND
 );

989 
HID_CONSUMER_SCAN_NEXT_TRK
:

990 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_SCAN_NEXT_TRK
 );

993 
HID_CONSUMER_SCAN_PREV_TRK
:

994 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_SCAN_PREV_TRK
 );

997 
HID_CONSUMER_STOP
:

998 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, 
HID_CC_RPT_STOP
 );

1002 i‡––
cmd
 >
HID_KEYBOARD_1
 ) && ( cmd <
HID_KEYBOARD_0
 ) )

1004 
	`HID_CC_RPT_SET_BUTTON
–
pBuf
, (
cmd
 - 
HID_KEYBOARD_1
 + 1) % 10 );

1008 
	}
}

1026 
	$hidAdvRemŸeAúMou£Curs‹CéKeyPªss
( )

1028 i‡–
keyRïóãd
 == 0 )

1031 
	`oßl_°›_timîEx
–
hidAdvRemŸe_TaskId
, 
MOTION_SENSOR_TIMER_EVT
 );

1033 
¨cNoMŸi⁄Cou¡
 = 0;

1034 
blockMou£Movemíts
 = 
FALSE
;

1035 
dißbÀMou£MovemítA·îKeyRñó£
 = 
TRUE
;

1036 
¨cNoMŸi⁄TimîRu¬ög
 = 
FALSE
;

1038 i‡–
¨cMŸi⁄Dëe˘‹Sèã
 !
MOTION_DETECTOR_ENABLED
 )

1040 
	`HÆMŸi⁄E«bÀ
();

1041 
¨cMŸi⁄Dëe˘‹Sèã
 = 
MOTION_DETECTOR_ENABLED
;

1044 
	`oßl_pwrmgr_devi˚
–
PWRMGR_ALWAYS_ON
 );

1047 
	}
}

1065 
	$hidAdvRemŸeAúMou£Curs‹CéKeyRñó£
( )

1068 i‡–
doubÀClickTimîRu¬ög
 =
TRUE
 )

1071 
dißbÀMou£MovemítA·îKeyRñó£
 = 
FALSE
;

1076 
doubÀClickTimîRu¬ög
 = 
TRUE
;

1078 
	`oßl_°¨t_timîEx
–
hidAdvRemŸe_TaskId
,

1079 
DOUBLE_CLICK_TIMER_EVT
,

1080 
DOUBLE_CLICK_OFF_TIMEOUT
 );

1082 
	`oßl_°¨t_timîEx
–
hidAdvRemŸe_TaskId
,

1083 
MOTION_SENSOR_TIMER_EVT
,

1084 
MOTION_SENSOR_OFF_TIMEOUT
 );

1088 i‡–
dißbÀMou£MovemítA·îKeyRñó£
 =
TRUE
 )

1090 
blockMou£Movemíts
 = 
TRUE
;

1092 
	}
}

1110 
	$hidAdvRemŸePaúKeyA˘i⁄
()

1113 
	}
}

1131 
	$hidAdvRemŸeAúMou£CÆKeyA˘i⁄
( )

1133 i‡–
keyRïóãd
 == 0 )

1135 i‡–
	`HÆMŸi⁄CÆ
–
hidAdvRemŸeCÆCom∂ëeCback
, 
HAR_CAL_DURATION
 ) =
TRUE
 )

1137 
	`hidAdvRemŸeCÆBuzzîRög
–1, 
HAL_BUZZER_HIGH_TONE
 );

1139 
	`oßl_°¨t_ªlﬂd_timî
–
hidAdvRemŸe_TaskId
,

1140 
CAL_PROGRESS_TIMER_EVT
,

1141 
CAL_PROGRESS_TIMEOUT
 );

1146 
	`hidAdvRemŸeCÆBuzzîRög
–500, 
HAL_BUZZER_LOW_TONE
 );

1149 
	}
}

1167 
	$hidAdvRemŸeAúMou£Resﬁuti⁄De¸ó£
( )

1170 i‡–
keyRïóãd
 == 0 )

1172 
	`HÆMŸi⁄ModifyAúMou£Resﬁuti⁄
–
HAL_MOTION_RESOLUTION_DECREASE
 );

1174 
	}
}

1192 
	$hidAdvRemŸeAúMou£Resﬁuti⁄In¸ó£
( )

1195 i‡–
keyRïóãd
 == 0 )

1197 
	`HÆMŸi⁄ModifyAúMou£Resﬁuti⁄
–
HAL_MOTION_RESOLUTION_INCREASE
 );

1199 
	}
}

1213 
	$hidAdvRemŸeCÆBuzzîRög
–
uöt16
 
timeout
, 
uöt8
 
t⁄e
 )

1216 #i‡(
deföed
 
HAL_BUZZER
Ë&& (HAL_BUZZER =
TRUE
)

1218 
	`oßl_pwrmgr_devi˚
–
PWRMGR_ALWAYS_ON
 );

1221 
	`HÆBuzzîRög
–
timeout
, 
t⁄e
, 
hidAdvRemŸeBuzzîCom∂ëeCback
 );

1223 
	}
}

1236 
	$hidAdvRemŸeCÆCom∂ëeCback
( )

1238 
	`oßl_°›_timîEx
–
hidAdvRemŸe_TaskId
, 
CAL_PROGRESS_TIMER_EVT
 );

1240 
	`hidAdvRemŸeCÆBuzzîRög
–500, 
HAL_BUZZER_HIGH_TONE
 );

1241 
	}
}

1253 
	$hidAdvRemŸeBuzzîCom∂ëeCback
( )

1255 #i‡(
deföed
 
HAL_BUZZER
Ë&& (HAL_BUZZER =
TRUE
)

1257 
	`oßl_pwrmgr_devi˚
– 
PWRMGR_BATTERY
 );

1259 
	}
}

1277 
	$hidAdvRemŸeU≈aúKeyA˘i⁄
()

1279 
	`HidDev_SëP¨amëî
–
HIDDEV_ERASE_ALLBONDS
, 0, 
NULL
 );

1280 
	}
}

1293 
	$hidAdvRemŸeMŸi⁄Sís‹Cback
–
öt16
 
gyroMickeysX
, i¡16 
gyroMickeysY
 )

1299 i‡––
gyroMickeysX
 =0 ) && ( 
gyroMickeysY
 == 0 ) )

1301 
¨cNoMŸi⁄Cou¡
 += 1;

1302 i‡–
¨cNoMŸi⁄Cou¡
 >= 1000 )

1304 
	`HÆMŸi⁄Sèndby
();

1305 
¨cMŸi⁄Dëe˘‹Sèã
 = 
MOTION_DETECTOR_STANDBY
;

1306 
¨cNoMŸi⁄Cou¡
 = 0;

1307 
	`oßl_°¨t_timîEx
(
hidAdvRemŸe_TaskId
, 
MOTION_SENSOR_TIMER_EVT
, 
MOTION_SENSOR_EXIT_TIMEOUT
);

1308 
¨cNoMŸi⁄TimîRu¬ög
 = 
TRUE
;

1313 
¨cMŸi⁄Dëe˘‹Sèã
 = 
MOTION_DETECTOR_ENABLED
;

1314 
¨cNoMŸi⁄Cou¡
 = 0;

1315 i‡(
¨cNoMŸi⁄TimîRu¬ög
 =
TRUE
)

1318 
	`oßl_°›_timîEx
(
hidAdvRemŸe_TaskId
, 
MOTION_SENSOR_TIMER_EVT
);

1319 
¨cNoMŸi⁄TimîRu¬ög
 = 
FALSE
;

1324 i‡–
gyroMickeysX
 > 
MOUSE_DATA_MAX
 )

1326 
gyroMickeysX
 = 
MOUSE_DATA_MAX
;

1328 i‡–
gyroMickeysX
 < -
MOUSE_DATA_MAX
 )

1330 
gyroMickeysX
 = -
MOUSE_DATA_MAX
;

1333 i‡–
gyroMickeysY
 > 
MOUSE_DATA_MAX
 )

1335 
gyroMickeysY
 = 
MOUSE_DATA_MAX
;

1337 i‡–
gyroMickeysY
 < -
MOUSE_DATA_MAX
 )

1339 
gyroMickeysY
 = -
MOUSE_DATA_MAX
;

1343 i‡––
mou£Buâ⁄Sèãs
 !
ßvedMou£Buâ⁄Sèãs
 ) ||

1344 ––
blockMou£Movemíts
 =
FALSE
 ) &&

1345 –
keyPªs£d
 =
FALSE
 ) &&

1346 ––
gyroMickeysX
 != 0 ) ||

1347 –
gyroMickeysY
 != 0 ) ) ) )

1349 i‡–
blockMou£Movemíts
 =
TRUE
 )

1352 
gyroMickeysX
 = 0;

1353 
gyroMickeysY
 = 0;

1356 
	`hidMou£SídRï‹t
–
mou£Buâ⁄Sèãs
,

1357 (
öt8
)
gyroMickeysX
,

1358 (
öt8
)
gyroMickeysY
 );

1360 
ßvedMou£Buâ⁄Sèãs
 = 
mou£Buâ⁄Sèãs
;

1362 
	}
}

1374 
uöt8
 
	$hidAdvRemŸeRcvRï‹t
–
uöt8
 
Àn
, uöt8 *
pD©a
 )

1377  
SUCCESS
;

1378 
	}
}

1394 
uöt8
 
	$hidAdvRemŸeR±CB
–
uöt8
 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
,

1395 
uöt8
 
›î
, uöt8 *
pLí
, uöt8 *
pD©a
 )

1397 
uöt8
 
°©us
 = 
SUCCESS
;

1400 i‡–
›î
 =
HID_DEV_OPER_WRITE
 )

1402 i‡–
uuid
 =
HID_REPORT_UUID
 )

1405 i‡–
ty≥
 =
HID_REPORT_TYPE_OUTPUT
 )

1407 
°©us
 = 
	`hidAdvRemŸeRcvRï‹t
–*
pLí
, 
pD©a
 );

1411 i‡–
°©us
 =
SUCCESS
 )

1413 
°©us
 = 
	`HidKbM_SëP¨amëî
–
id
, 
ty≥
, 
uuid
, *
pLí
, 
pD©a
 );

1417 i‡–
›î
 =
HID_DEV_OPER_READ
 )

1419 
°©us
 = 
	`HidKbM_GëP¨amëî
–
id
, 
ty≥
, 
uuid
, 
pLí
, 
pD©a
 );

1422  
°©us
;

1423 
	}
}

1434 
	$hidAdvRemŸeEvtCB
–
uöt8
 
evt
 )

1439 
	}
}

1453 
	$hidAdvRemŸePasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

1454 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 )

1456 
ªmaöögPasscodeDigôs
 = 
PASSCODE_LEN
;

1457 
∑sscode
 = 0;

1458 
	}
}

1469 
	$hidAdvRemŸeB©tMósSëupCB
( )

1471 
P1_5
 = 1;

1474 
	}
}

1485 
	$hidAdvRemŸeB©tMósTórdownCB
( )

1487 
P1_5
 = 0;

1490 
	}
}

	@Projects/ble/HIDAdvRemote/Source/hidAdvRemote.h

40 #i‚de‡
MOUSE_H


41 
	#MOUSE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#HID_CC_RPT_MUTE
 1

	)

58 
	#HID_CC_RPT_POWER
 2

	)

59 
	#HID_CC_RPT_LAST
 3

	)

60 
	#HID_CC_RPT_ASSIGN_SEL
 4

	)

61 
	#HID_CC_RPT_PLAY
 5

	)

62 
	#HID_CC_RPT_PAUSE
 6

	)

63 
	#HID_CC_RPT_RECORD
 7

	)

64 
	#HID_CC_RPT_FAST_FWD
 8

	)

65 
	#HID_CC_RPT_REWIND
 9

	)

66 
	#HID_CC_RPT_SCAN_NEXT_TRK
 10

	)

67 
	#HID_CC_RPT_SCAN_PREV_TRK
 11

	)

68 
	#HID_CC_RPT_STOP
 12

	)

70 
	#HID_CC_RPT_CHANNEL_UP
 0x01

	)

71 
	#HID_CC_RPT_CHANNEL_DOWN
 0x03

	)

72 
	#HID_CC_RPT_VOLUME_UP
 0x40

	)

73 
	#HID_CC_RPT_VOLUME_DOWN
 0x80

	)

76 
	#HID_CC_RPT_NUMERIC_BITS
 0xF0

	)

77 
	#HID_CC_RPT_CHANNEL_BITS
 0xCF

	)

78 
	#HID_CC_RPT_VOLUME_BITS
 0x3F

	)

79 
	#HID_CC_RPT_BUTTON_BITS
 0xF0

	)

80 
	#HID_CC_RPT_SELECTION_BITS
 0xCF

	)

87 
	#HID_CC_RPT_SET_NUMERIC
(
s
, 
x
Ë(s)[0] &
HID_CC_RPT_NUMERIC_BITS
; \

88 (
s
)[0] = (
x
)

	)

89 
	#HID_CC_RPT_SET_CHANNEL
(
s
, 
x
Ë(s)[0] &
HID_CC_RPT_CHANNEL_BITS
; \

90 (
s
)[0] |((
x
Ë& 0x03Ë<< 4

	)

91 
	#HID_CC_RPT_SET_VOLUME_UP
(
s
Ë(s)[0] &
HID_CC_RPT_VOLUME_BITS
; \

92 (
s
)[0] |0x40

	)

93 
	#HID_CC_RPT_SET_VOLUME_DOWN
(
s
Ë(s)[0] &
HID_CC_RPT_VOLUME_BITS
; \

94 (
s
)[0] |0x80

	)

95 
	#HID_CC_RPT_SET_BUTTON
(
s
, 
x
Ë(s)[1] &
HID_CC_RPT_BUTTON_BITS
; \

96 (
s
)[1] |(
x
)

	)

97 
	#HID_CC_RPT_SET_SELECTION
(
s
, 
x
Ë(s)[1] &
HID_CC_RPT_SELECTION_BITS
; \

98 (
s
)[1] |((
x
Ë& 0x03Ë<< 4

	)

107 
HidAdvRemŸe_Inô
–
uöt8
 
èsk_id
 );

112 
uöt16
 
HidAdvRemŸe_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

117 #ifde‡
__˝lu•lus


	@Projects/ble/HIDAdvRemote/Source/hidAdvRemote_main.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"hÆ_key.h
"

45 
	~"hÆ_timî.h
"

46 
	~"hÆ_drivîs.h
"

47 
	~"hÆ_Àd.h
"

50 
	~"OSAL.h
"

51 
	~"OSAL_Tasks.h
"

52 
	~"OSAL_PwrMgr.h
"

53 
	~"oßl_¢v.h
"

54 
	~"OnBﬂrd.h
"

61 
MSA_Maö_KeyCÆlback
(
uöt8
 
keys
, uöt8 
°©e
);

73 
	$maö
()

76 
	`HAL_BOARD_INIT
();

79 
	`InôBﬂrd
–
OB_COLD
 );

82 
	`HÆDrivîInô
();

85 
	`oßl_¢v_öô
();

90 
	`oßl_öô_sy°em
();

93 
	`HAL_ENABLE_INTERRUPTS
();

96 
	`InôBﬂrd
–
OB_READY
 );

98 #i‡
	`deföed
 ( 
POWER_SAVING
 )

99 
	`oßl_pwrmgr_devi˚
– 
PWRMGR_BATTERY
 );

103 
	`oßl_°¨t_sy°em
();

106 
	}
}

	@Projects/ble/HIDAdvRemoteDongle/Source/Hidapp_Main.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"hÆ_key.h
"

45 
	~"hÆ_timî.h
"

46 
	~"hÆ_drivîs.h
"

47 
	~"hÆ_Àd.h
"

50 
	~"usb_hid.h
"

53 
	~"OSAL.h
"

54 
	~"OSAL_Tasks.h
"

55 
	~"OSAL_PwrMgr.h
"

56 
	~"oßl_¢v.h
"

57 
	~"OnBﬂrd.h
"

64 
MSA_Maö_KeyCÆlback
(
uöt8
 
keys
, uöt8 
°©e
);

77 
	$maö
()

80 
	`HAL_BOARD_INIT
();

83 
	`InôBﬂrd
–
OB_COLD
 );

86 
	`HÆDrivîInô
();

89 
	`oßl_¢v_öô
();

94 
	`oßl_öô_sy°em
();

97 
	`HAL_ENABLE_INTERRUPTS
();

100 
	`InôBﬂrd
–
OB_READY
 );

102 #i‡
	`deföed
 ( 
POWER_SAVING
 )

103 
	`oßl_pwrmgr_devi˚
– 
PWRMGR_BATTERY
 );

106 
	`usbHidInô
();

109 
	`oßl_°¨t_sy°em
();

112 
	}
}

	@Projects/ble/HIDAdvRemoteDongle/Source/OSAL_Hidapp.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_Tasks.h
"

49 
	~"hÆ_drivîs.h
"

52 
	~"hci_é.h
"

55 
	~"Œ.h
"

57 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

58 
	~"oßl_cbTimî.h
"

62 
	~"l2ˇp.h
"

65 
	~"g≠.h
"

66 
	~"g≠g©t£rvî.h
"

67 
	~"g≠b⁄dmgr.h
"

70 
	~"g©t.h
"

73 
	~"˚¡øl.h
"

76 
	~"hid≠p.h
"

86 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

88 
LL_Pro˚ssEvít
,

89 
HÆ_Pro˚ssEvít
,

90 
HCI_Pro˚ssEvít
,

91 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

92 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

94 
L2CAP_Pro˚ssEvít
,

95 
GAP_Pro˚ssEvít
,

96 
GATT_Pro˚ssEvít
,

97 
SM_Pro˚ssEvít
,

98 
GAPCíåÆRﬁe_Pro˚ssEvít
,

99 
GAPB⁄dMgr_Pro˚ssEvít
,

100 
Hid≠p_Pro˚ssEvít


103 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

104 
uöt16
 *
	gèsksEvíts
;

119 
	$oßlInôTasks
( )

121 
uöt8
 
èskID
 = 0;

123 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

124 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

127 
	`LL_Inô
–
èskID
++ );

130 
	`HÆ_Inô
–
èskID
++ );

133 
	`HCI_Inô
–
èskID
++ );

135 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

137 
	`oßl_CbTimîInô
–
èskID
 );

138 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

142 
	`L2CAP_Inô
–
èskID
++ );

145 
	`GAP_Inô
–
èskID
++ );

148 
	`GATT_Inô
–
èskID
++ );

151 
	`SM_Inô
–
èskID
++ );

154 
	`GAPCíåÆRﬁe_Inô
–
èskID
++ );

157 
	`GAPB⁄dMgr_Inô
(
èskID
++ );

160 
	`Hid≠p_Inô
–
èskID
 );

161 
	}
}

	@Projects/ble/HIDAdvRemoteDongle/Source/hidapp.c

45 
	~"bcomdef.h
"

46 
	~"lökdb.h
"

49 
	~"hÆ_ty≥s.h
"

50 
	~"hÆ_bﬂrd.h
"

51 
	~"hÆ_drivîs.h
"

52 
	~"hÆ_key.h
"

53 
	~"hÆ_Àd.h
"

56 
	~"usb_‰amew‹k.h
"

57 
	~"usb_hid.h
"

58 
	~"usb_hid_ªp‹ts.h
"

59 
	~"usb_su•íd.h
"

62 
	~"OSAL.h
"

63 
	~"OSAL_PwrMgr.h
"

64 
	~"oßl_bufmgr.h
"

65 
	~"OSAL_Tasks.h
"

66 
	~"oßl_¢v.h
"

68 
	~"OnBﬂrd.h
"

70 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

71 
	~"oßl_cbTimî.h
"

75 
	~"g©t.h
"

76 
	~"g©t_uuid.h
"

79 
	~"hci.h
"

81 
	~"˚¡øl.h
"

82 
	~"g≠b⁄dmgr.h
"

83 
	~"g©t£rv≠p.h
"

86 
	~"hid_uuid.h
"

89 
	~"hid≠p.h
"

96 
	#OWN_ADDR
 { 0x11, 0x11, 0x11, 0x11, 0x11, 0x04 }

	)

99 
	#DEFAULT_DISCOVERY_MODE
 
DEVDISC_MODE_LIMITED


	)

102 
	#DEFAULT_DISCOVERY_ACTIVE_SCAN
 
TRUE


	)

105 
	#DEFAULT_DISCOVERY_WHITE_LIST
 
FALSE


	)

107 
	#DEFAULT_LINK_HIGH_DUTY_CYCLE
 
FALSE


	)

110 
	#DEFAULT_SCAN_DURATION
 900

	)

113 
	#INIT_CONNECT_TIMEOUT
 1000

	)

116 
	#MAX_NUM_SCANS
 5

	)

119 
	#DEFAULT_PASSCODE
 0

	)

122 
	#DEFAULT_PAIRING_MODE
 
GAPBOND_PAIRING_MODE_INITIATE


123 

	)

125 
	#DEFAULT_MITM_MODE
 
FALSE


	)

128 
	#DEFAULT_BONDING_MODE
 
TRUE


	)

130 
	#DEFAULT_IO_CAPABILITIES
 
GAPBOND_IO_CAP_NO_INPUT_NO_OUTPUT


	)

132 
	#DEFAULT_MAX_SCAN_RES
 8

	)

134 
	#APP_CONN_INTERVAL
 8

135 
	#APP_SLAVE_LATENCY
 0

136 
	#APP_CONN_TIMEOUT
 500

137 

	)

139 
	#HIDAPP_OUTBUF_SIZE
 3

	)

142 
	#HID_CMD_REPORT_ID
 1

	)

143 
	#HID_PAIR_ENTRY_REPORT_ID
 2

	)

146 
	#HIDAPP_OUTPUT_REPORT_ID
 
HID_CMD_REPORT_ID


	)

149 
	#USB_HID_INPUT_RETRY_COUNT
 3

	)

151 
	#HIDAPP_INPUT_RETRY_TIMEOUT
 5

152 

	)

154 
	#NO_CHANGE
 0x00

	)

155 
	#CHANGE_OCCURED
 0x01

	)

158 
	#UNPAIRED_STATE
 0x00

	)

159 
	#PAIRED_BONDED_STATE
 0x01

	)

168 
uöt16
 
	mmou£Ch¨H™dÀ
;

169 
uöt16
 
	mkeyCh¨H™dÀ
;

170 
uöt16
 
	mc⁄sumîCålCh¨H™dÀ
;

173 
uöt16
 
	mmou£CCCH™dÀ
;

174 
uöt16
 
	mkeyCCCH™dÀ
;

175 
uöt16
 
	mc⁄sumîCålCCCH™dÀ
;

176 
uöt16
 
	msvcCh™geH™dÀ
;

177 
uöt8
 
	mœ°RemŸeAddr
[
B_ADDR_LEN
];

178 } 
	thid≠pH™dÀInfo_t
;

183 
	mBLE_STATE_IDLE
,

184 
	mBLE_STATE_SCANNING
,

185 
	mBLE_STATE_CONNECTING
,

186 
	mBLE_STATE_CONNECTED
,

187 
	mBLE_STATE_DISCONNECTING


199 
hid≠pSèπ
( );

201 
uöt8
 
hid≠pSídInRï‹t
–
©tH™dÀVÆueNŸi_t
 *
pNŸi
 );

202 
hid≠pE°ablishLök
–
uöt8
 
whôeLi°
, uöt8 
addrTy≥
, uöt8 *
ªmŸeAddr
 );

203 
hid≠pSèπDiscovîy
( );

204 
hid≠pDiscovîDevi˚s
( );

205 
hid≠pSëIdÀ
( );

206 
hid≠pPro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 );

207 
hid≠pH™dÀKeys
–
uöt8
 
keys
, uöt8 
°©e
 );

208 
hid≠pE«bÀNŸifiˇti⁄
–
uöt16
 
c⁄nH™dÀ
, uöt16 
©åH™dÀ
 );

209 
hid≠pDiscovîSîvi˚
–
uöt16
 
c⁄nH™dÀ
, uöt16 
svcUuid
 );

210 
boﬁ
 
hid≠pFödSvcUuid
–
uöt16
 
uuid
, 
uöt8
 *
pD©a
, uöt8 
d©aLí
 );

211 
uöt8
 
hid≠pFödHIDRemŸe
–uöt8* 
pD©a
, uöt8 
Àngth
 );

212 
hid≠pSaveH™dÀs
( );

213 
hid≠pEø£H™dÀs
( );

214 
uöt8
 
hid≠pB⁄dCou¡
( );

217 
hid≠pCíåÆEvítCB
–
g≠CíåÆRﬁeEvít_t
 *
p
 );

218 
hid≠pPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 );

220 
hid≠pSu•ídE¡î
( );

221 
hid≠pSu•ídExô
( );

232 
©tH™dÀVÆueNŸi_t
 
	gœ°InRï‹t
;

233 
uöt8
 
	gªp‹tRërõs
 = 0;

236 
uöt8
 
	ghid≠pTaskId
;

239 
g≠CíåÆRﬁeCB_t
 
	ghidAµ_˚¡ølCBs
 =

241 
NULL
,

242 
hid≠pCíåÆEvítCB
,

246 
g≠B⁄dCBs_t
 
	gg≠B⁄dCBs
 =

248 
NULL
,

249 
hid≠pPaúSèãCB
,

253 
uöt8
 
	ghid≠pBLESèã
 = 
BLE_STATE_IDLE
;

255 
uöt16
 
	gc⁄nH™dÀ
 = 
INVALID_CONNHANDLE
;

258 
uöt16
 
	gmou£Ch¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

259 
uöt16
 
	gkeyCh¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

260 
uöt16
 
	gc⁄sumîCålCh¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

263 
uöt16
 
	gmou£CCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

264 
uöt16
 
	gkeyCCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

265 
uöt16
 
	gc⁄sumîCålCCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

268 
uöt16
 
	g£rvi˚Ch™geH™dÀ
 = 
GATT_INVALID_HANDLE
;

270 
uöt8
 
	g£rvi˚DiscCom∂ëe
 = 
FALSE
;

272 
uöt8
 
	gªmŸeAddr
[
B_ADDR_LEN
] = {0,0,0,0,0,0};

275 
hid≠pH™dÀInfo_t
 
	gªmŸeH™dÀs
;

277 
uöt8
 
	g£rvi˚Ch™ge
 = 
NO_CHANGE
;

279 
uöt8
 
	gg≠B⁄dMgrSèã
 = 
UNPAIRED_STATE
;

281 
uöt16
 
	g£rvi˚ToDiscovî
 = 
GATT_INVALID_HANDLE
;

283 
uöt8
 
	gíabÀCCCDs
 = 
TRUE
;

286 
©tRódByTy≥Req_t
 
	gªadReq
;

287 
©tAârTy≥_t
 
	gªadReqTy≥
;

288 
uöt16
 
	g£rvi˚SèπH™dÀ
;

289 
uöt16
 
	g£rvi˚EndH™dÀ
;

291 
uöt8
 
	gnumSˇns
 = 0;

308 
	$Hid≠p_Inô
–
uöt8
 
èskId
 )

311 
hid≠pTaskId
 = 
èskId
;

315 
uöt8
 
sˇnRes
 = 
DEFAULT_MAX_SCAN_RES
;

316 
VOID
 
	`GAPCíåÆRﬁe_SëP¨amëî
–
GAPCENTRALROLE_MAX_SCAN_RES
, –
uöt8
 ), &
sˇnRes
 );

321 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

322 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

325 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_SCAN_INT
, 48 );

328 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_SCAN_WIND
, 48 );

333 
uöt32
 
∑sskey
 = 
DEFAULT_PASSCODE
;

334 
uöt8
 
∑úMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

335 
uöt8
 
môm
 = 
DEFAULT_MITM_MODE
;

336 
uöt8
 
ioC≠
 = 
DEFAULT_IO_CAPABILITIES
;

337 
uöt8
 
b⁄dög
 = 
DEFAULT_BONDING_MODE
;

338 
uöt8
 
autoSync
 = 
TRUE
;

339 
uöt8
 
b⁄dFaûA˘i⁄
 = 
GAPBOND_FAIL_TERMINATE_ERASE_BONDS
;

341 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
, –
uöt32
 ), &
∑sskey
 );

342 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
, –
uöt8
 ), &
∑úMode
 );

343 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
, –
uöt8
 ), &
môm
 );

344 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
, –
uöt8
 ), &
ioC≠
 );

345 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
, –
uöt8
 ), &
b⁄dög
 );

346 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_AUTO_SYNC_WL
, –
uöt8
 ), &
autoSync
 );

347 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BOND_FAIL_ACTION
, –
uöt8
 ), &
b⁄dFaûA˘i⁄
 );

351 
pFnSu•ídE¡îHook
 = 
hid≠pSu•ídE¡î
;

352 
pFnSu•ídExôHook
 = 
hid≠pSu•ídExô
;

355 
VOID
 
	`GATT_InôClõ¡
();

358 
	`GATT_Regi°îF‹Ind
–
hid≠pTaskId
 );

362 
uöt16
 
c⁄√˘i⁄I¡îvÆ
 = 
APP_CONN_INTERVAL
;

363 
uöt16
 
¶aveL©ícy
 = 
APP_SLAVE_LATENCY
;

364 
uöt16
 
timeout
 = 
APP_CONN_TIMEOUT
;

366 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_EST_INT_MIN
, 
c⁄√˘i⁄I¡îvÆ
 );

367 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_EST_INT_MAX
, 
c⁄√˘i⁄I¡îvÆ
 );

368 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_EST_LATENCY
, 
¶aveL©ícy
 );

369 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_EST_SUPERV_TIMEOUT
, 
timeout
 );

373 
	`GAPB⁄dMgr_Regi°î
–&
g≠B⁄dCBs
 );

376 
	`Regi°îF‹Keys
–
hid≠pTaskId
 );

379 
VOID
 
	`oßl_°¨t_timîEx
–
èskId
, 
HIDAPP_EVT_START
, 100 );

382 
	`hid≠pEø£H™dÀs
();

384 
VOID
 
	`HCI_EXT_HÆtDurögRfCmd
–
HCI_EXT_HALT_DURING_RF_DISABLE
 );

385 
	}
}

405 
uöt16
 
	$Hid≠p_Pro˚ssEvít
(
uöt8
 
èskId
, 
uöt16
 
evíts
)

407 (Ë
èskId
;

409 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

411 
oßl_evít_hdr_t
 *
pMsg
;

413 (
pMsg
 = (
oßl_evít_hdr_t
 *Ë
	`oßl_msg_ª˚ive
(
hid≠pTaskId
)Ë!
NULL
)

415 
pMsg
->
evít
)

417 
GATT_MSG_EVENT
:

419 
	`hid≠pPro˚ssGATTMsg
–(
g©tMsgEvít_t
 *)
pMsg
 );

422 
KEY_CHANGE
:

424 
	`hid≠pH™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
keys
, ((keyCh™ge_à*ÌMsg)->
°©e
 );

432 
VOID
 
	`oßl_msg_dóŒoˇã
((
uöt8
 *Ë
pMsg
);

435  (
evíts
 ^ 
SYS_EVENT_MSG
);

438 i‡–
evíts
 & 
HIDAPP_EVT_START
 )

440 
	`hid≠pSèπ
();

442  (
evíts
 ^ 
HIDAPP_EVT_START
);

445 i‡–
evíts
 & 
HIDAPP_EVT_REPORT_RETRY
 )

448 i‡––
	`hid≠pSídInRï‹t
–&
œ°InRï‹t
 ) =
FALSE
 ) &&

449 –
ªp‹tRërõs
 < 
USB_HID_INPUT_RETRY_COUNT
 ) )

451 
ªp‹tRërõs
++;

452 
	`oßl_°¨t_timîEx
–
hid≠pTaskId
, 
HIDAPP_EVT_REPORT_RETRY
,

453 (
ªp‹tRërõs
*
HIDAPP_INPUT_RETRY_TIMEOUT
) );

458 
ªp‹tRërõs
 = 0;

461  (
evíts
 ^ 
HIDAPP_EVT_REPORT_RETRY
);

464 i‡–
evíts
 & 
HIDAPP_EVT_START_DISCOVERY
 )

467 
	`hid≠pSèπDiscovîy
();

469  ( 
evíts
 ^ 
HIDAPP_EVT_START_DISCOVERY
 );

472 i‡–
evíts
 & 
HIDAPP_EVT_INIT_CONNECT
 )

475 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_BLINK
 );

477  ( 
evíts
 ^ 
HIDAPP_EVT_INIT_CONNECT
 );

481 
	}
}

494 
	$hid≠pH™dÀKeys
–
uöt8
 
keys
, uöt8 
°©e
 )

497 (Ë
°©e
;

499 i‡(
keys
 & 
HAL_KEY_SW_1
)

502 i‡––
	`hid≠pB⁄dCou¡
(Ë> 0 ) && ( 
hid≠pBLESèã
 !
BLE_STATE_CONNECTED
 ) )

504 i‡–
hid≠pBLESèã
 =
BLE_STATE_CONNECTING
 )

506 
hid≠pBLESèã
 = 
BLE_STATE_DISCONNECTING
;

507 
VOID
 
	`GAPCíåÆRﬁe_Tîmö©eLök
–
GAP_CONNHANDLE_INIT
 );

510 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_ERASE_ALLBONDS
, 0, 
NULL
 );

514 i‡(
keys
 & 
HAL_KEY_SW_2
)

516 i‡–
hid≠pBLESèã
 =
BLE_STATE_CONNECTED
 )

518 
hid≠pBLESèã
 = 
BLE_STATE_DISCONNECTING
;

519 
VOID
 
	`GAPCíåÆRﬁe_Tîmö©eLök
–
c⁄nH™dÀ
 );

521 i‡–
hid≠pBLESèã
 =
BLE_STATE_IDLE
 )

523 #i‡
	`deföed
 ( 
NANO_DONGLE
 )

525 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_OFF
 );

528 
	`oßl_£t_evít
–
hid≠pTaskId
, 
HIDAPP_EVT_START_DISCOVERY
 );

533 
	}
}

545 
	$hid≠pSèπ
()

547 
	`GAPCíåÆRﬁe_SèπDevi˚
–&
hidAµ_˚¡ølCBs
 );

548 
	}
}

584 
	$hid≠pSu•ídE¡î
( )

587 
	}
}

599 
	$hid≠pSu•ídExô
( )

602 
	}
}

614 
	$hid≠pPro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pPkt
 )

617  
pPkt
->
mëhod
 )

619 
ATT_HANDLE_VALUE_NOTI
:

621 i‡–
ªp‹tRërõs
 > 0 )

623 
	`hid≠pSídInRï‹t
–&
œ°InRï‹t
 );

625 
ªp‹tRërõs
 = 0;

626 
	`oßl_°›_timîEx
–
hid≠pTaskId
, 
HIDAPP_EVT_REPORT_RETRY
 );

630 i‡–
	`hid≠pSídInRï‹t
–&(
pPkt
->
msg
.
h™dÀVÆueNŸi
ËË=
FALSE
 )

633 
	`oßl_mem˝y
–&
œ°InRï‹t
, &(
pPkt
->
msg
.
h™dÀVÆueNŸi
), –
©tH™dÀVÆueNŸi_t
 ) );

635 
ªp‹tRërõs
 = 1;

636 
	`oßl_°¨t_timîEx
–
hid≠pTaskId
, 
HIDAPP_EVT_REPORT_RETRY
, 
HIDAPP_INPUT_RETRY_TIMEOUT
 );

640 
ATT_FIND_BY_TYPE_VALUE_RSP
:

643 i‡–
pPkt
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

645 
£rvi˚SèπH™dÀ
 = 
pPkt
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

646 
£rvi˚EndH™dÀ
 = 
pPkt
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

649 i‡–
pPkt
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 )

651 i‡–
£rvi˚SèπH™dÀ
 != 0 )

653 i‡–
£rvi˚ToDiscovî
 =
GATT_SERVICE_UUID
 )

656 
ªadReq
.
°¨tH™dÀ
 = 
£rvi˚SèπH™dÀ
;

657 
ªadReq
.
ídH™dÀ
 = 
£rvi˚EndH™dÀ
;

658 
ªadReqTy≥
.
Àn
 = 2;

659 
ªadReqTy≥
.
uuid
[0] = 
	`LO_UINT16
(
SERVICE_CHANGED_UUID
);

660 
ªadReqTy≥
.
uuid
[1] = 
	`HI_UINT16
(
SERVICE_CHANGED_UUID
);

661 
ªadReq
.
ty≥
 = 
ªadReqTy≥
;

663 
	`GATT_DiscCh¨sByUUID
(
c⁄nH™dÀ
, &
ªadReq
, 
hid≠pTaskId
 );

665 i‡–
£rvi˚ToDiscovî
 =
HID_SERVICE_UUID
 )

668 
	`GATT_DiscAŒCh¨s
–
c⁄nH™dÀ
, 
£rvi˚SèπH™dÀ
, 
£rvi˚EndH™dÀ
, 
hid≠pTaskId
 );

674 
ATT_READ_BY_TYPE_RSP
:

677 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

679 
©tRódByTy≥R•_t
 
r•
 = 
pPkt
->
msg
.
ªadByTy≥R•
;

680 
uöt8
 
idx
 = 0;

682 i‡–
£rvi˚ToDiscovî
 =
GATT_SERVICE_UUID
 )

685 
uöt8
 
low
 = 
	`LO_UINT16
(
pPkt
->
msg
.
ªadByTy≥R•
.
d©aLi°
[3]);

686 
uöt8
 
high
 = 
	`HI_UINT16
(
pPkt
->
msg
.
ªadByTy≥R•
.
d©aLi°
[4]);

687 
£rvi˚Ch™geH™dÀ
 = 
	`BUILD_UINT16
(
low
, 
high
);

693  
idx
 < ((
r•
.
numPaús
 *Ñ•.
Àn
 ) - 1))

696 i‡–(
r•
.
d©aLi°
[
idx
+2] & 
GATT_PROP_NOTIFY
 ) )

698 
uöt16
* 
pH™dÀ
 = (
mou£Ch¨H™dÀ
 =
GATT_INVALID_HANDLE
Ë? &mou£Ch¨H™dÀ : &
keyCh¨H™dÀ
 ;

700 i‡–
pH™dÀ
 =&
keyCh¨H™dÀ
 && 
c⁄sumîCålCh¨H™dÀ
 =
GATT_INVALID_HANDLE
 )

702 
pH™dÀ
 = ( 
keyCh¨H™dÀ
 =
GATT_INVALID_HANDLE
 ) ? &keyCh¨H™dÀ : &
c⁄sumîCålCh¨H™dÀ
;

705 i‡–*
pH™dÀ
 =
GATT_INVALID_HANDLE
 )

707 *
pH™dÀ
 = 
	`BUILD_UINT16
–
r•
.
d©aLi°
[
idx
+3],Ñsp.dataList[idx+4] );

711 
idx
 +
r•
.
Àn
;

716 i‡–
pPkt
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 )

718 i‡–
£rvi˚ToDiscovî
 =
GATT_SERVICE_UUID
 )

721 
£rvi˚ToDiscovî
 = 
HID_SERVICE_UUID
;

722 
	`hid≠pDiscovîSîvi˚
–
c⁄nH™dÀ
, 
HID_SERVICE_UUID
 );

727 i‡–
íabÀCCCDs
 =
TRUE
 )

729 
mou£CCCH™dÀ
 = 
mou£Ch¨H™dÀ
 + 1;

732 
	`hid≠pE«bÀNŸifiˇti⁄
–
c⁄nH™dÀ
, 
mou£CCCH™dÀ
 );

736 
£rvi˚DiscCom∂ëe
 = 
TRUE
;

741 
ATT_WRITE_RSP
:

742 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 && !
£rvi˚DiscCom∂ëe
 )

744 
uöt16
 
h™dÀ
 = ( 
keyCCCH™dÀ
 =
GATT_INVALID_HANDLE
 ) ?

745 –
keyCCCH™dÀ
 = 
keyCh¨H™dÀ
 + 1 ) :

746 –
c⁄sumîCålCCCH™dÀ
 = 
c⁄sumîCålCh¨H™dÀ
 + 1 );

748 
	`hid≠pE«bÀNŸifiˇti⁄
–
c⁄nH™dÀ
, 
h™dÀ
 );

750 i‡–
c⁄sumîCålCCCH™dÀ
 !
GATT_INVALID_HANDLE
)

752 
£rvi˚DiscCom∂ëe
 = 
TRUE
;

758 
ATT_HANDLE_VALUE_IND
:

761 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

763 
£rvi˚Ch™ge
 = 
CHANGE_OCCURED
;

766 
	`ATT_H™dÀVÆueCfm
–
pPkt
->
c⁄nH™dÀ
 );

769 i‡––
g≠B⁄dMgrSèã
 =
PAIRED_BONDED_STATE
 ) &&

770 –
£rvi˚Ch™geH™dÀ
 =
pPkt
->
msg
.
h™dÀVÆueInd
.
h™dÀ
 ) )

773 
£rvi˚ToDiscovî
 = 
HID_SERVICE_UUID
;

774 
	`hid≠pDiscovîSîvi˚
–
c⁄nH™dÀ
, 
HID_SERVICE_UUID
 );

776 
£rvi˚Ch™ge
 = 
NO_CHANGE
;

785 
	}
}

796 
uöt8
 
	$hid≠pSídInRï‹t
–
©tH™dÀVÆueNŸi_t
 *
pNŸi
 )

798 
uöt8
 
ídPoöt
;

800 if–
pNŸi
->
h™dÀ
 =
keyCh¨H™dÀ
 )

803 
ídPoöt
 = 
USB_HID_KBD_EP
;

805 i‡(
pNŸi
->
h™dÀ
 =
mou£Ch¨H™dÀ
 )

808 
ídPoöt
 = 
USB_HID_MOUSE_EP
;

810 i‡–
pNŸi
->
h™dÀ
 =
c⁄sumîCålCh¨H™dÀ
 )

813 
ídPoöt
 = 
USB_HID_CC_EP
;

818  ( 
FALSE
 );

821 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_BLINK
 );

823  ( 
	`hidSídHidInRï‹t
(
pNŸi
->
vÆue
, 
ídPoöt
,ÖNŸi->
Àn
) );

824 
	}
}

835 
	$hid≠pCíåÆEvítCB
–
g≠CíåÆRﬁeEvít_t
 *
pEvít
 )

837 
uöt8
 
addrTy≥
;

838 
uöt8
 
≥îDevi˚Found
 = 
FALSE
;

840  
pEvít
->
g≠
.
›code
 )

842 
GAP_DEVICE_INIT_DONE_EVENT
:

844 
g≠Devi˚InôD⁄eEvít_t
 *
pEvt
 = (g≠Devi˚InôD⁄eEvít_à*)
pEvít
;

847 i‡–
	`oßl_isbuf£t
–
pEvt
->
devAddr
, 0xFF, 
B_ADDR_LEN
 ) =
FALSE
 )

849 #i‡
	`deföed
 ( 
NANO_DONGLE
 )

851 i‡–
	`hid≠pB⁄dCou¡
() > 0 )

854 
	`hid≠pE°ablishLök
–
TRUE
, 
addrTy≥
, 
ªmŸeAddr
 );

859 
	`hid≠pSëIdÀ
();

866 
uöt8
 
ownBDaddr
[] = 
OWN_ADDR
;

870 
	`HCI_EXT_SëBDADDRCmd
–
ownBDaddr
 );

873 
	`oßl_£t_evít
–
hid≠pTaskId
, 
HIDAPP_EVT_START
 );

878 
GAP_DEVICE_INFO_EVENT
:

883 i‡–
	`hid≠pFödSvcUuid
–
HID_SERVICE_UUID
,

884 
pEvít
->
devi˚Info
.
pEvtD©a
,

885 
pEvít
->
devi˚Info
.
d©aLí
 ) )

888 
addrTy≥
 = 
pEvít
->
devi˚Info
.addrType;

889 
	`oßl_mem˝y
–
ªmŸeAddr
, 
pEvít
->
devi˚Info
.
addr
, 
B_ADDR_LEN
 );

891 
≥îDevi˚Found
 = 
TRUE
;

894 i‡––
≥îDevi˚Found
 =
TRUE
 ) &&

895 –
pEvít
->
devi˚Info
.
evítTy≥
 =
GAP_ADTYPE_SCAN_RSP_IND
 ) &&

896 
	`hid≠pFödHIDRemŸe
–
pEvít
->
devi˚Info
.
pEvtD©a
,

897 
pEvít
->
devi˚Info
.
d©aLí
 ) )

900 
VOID
 
	`GAPCíåÆRﬁe_C™˚lDiscovîy
();

904 
GAP_DEVICE_DISCOVERY_EVENT
:

906 i‡–
≥îDevi˚Found
 =
TRUE
 )

908 
	`hid≠pE°ablishLök
–
FALSE
, 
addrTy≥
, 
ªmŸeAddr
 );

910 
≥îDevi˚Found
 = 
FALSE
;

911 
numSˇns
 = 0;

913 i‡–
numSˇns
 > 0 )

915 
numSˇns
--;

918 
	`hid≠pDiscovîDevi˚s
();

923 
	`hid≠pSëIdÀ
();

927 
GAP_LINK_ESTABLISHED_EVENT
:

929 
VOID
 
	`oßl_°›_timîEx
–
hid≠pTaskId
, 
HIDAPP_EVT_INIT_CONNECT
 );

931 i‡–
pEvít
->
g≠
.
hdr
.
°©us
 =
SUCCESS
 )

933 
hid≠pBLESèã
 = 
BLE_STATE_CONNECTED
;

935 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_ON
 );

937 
c⁄nH™dÀ
 = ((
g≠E°LökReqEvít_t
*)
pEvít
)->
c⁄√˘i⁄H™dÀ
;

939 i‡–
	`hid≠pB⁄dCou¡
() > 0 )

942 
	`hid≠pE°ablishLök
–
TRUE
, 
addrTy≥
, 
ªmŸeAddr
 );

947 
	`hid≠pSëIdÀ
();

951 
GAP_LINK_TERMINATED_EVENT
:

953 
VOID
 
	`oßl_°›_timîEx
–
hid≠pTaskId
, 
HIDAPP_EVT_INIT_CONNECT
 );

955 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_OFF
 );

957 
hid≠pBLESèã
 = 
BLE_STATE_IDLE
;

958 
g≠B⁄dMgrSèã
 = 
UNPAIRED_STATE
;

959 
c⁄nH™dÀ
 = 
INVALID_CONNHANDLE
;

961 i‡–
£rvi˚DiscCom∂ëe
 =
TRUE
 )

964 
	`oßl_mem˝y
–
ªmŸeH™dÀs
.
œ°RemŸeAddr
, 
ªmŸeAddr
, 
B_ADDR_LEN
 );

967 
	`hid≠pSaveH™dÀs
();

971 
£rvi˚DiscCom∂ëe
 = 
FALSE
;

972 
mou£Ch¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

973 
keyCh¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

974 
c⁄sumîCålCh¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

976 
mou£CCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

977 
keyCCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

978 
c⁄sumîCålCCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

979 
£rvi˚Ch™geH™dÀ
 = 
GATT_INVALID_HANDLE
;

980 
£rvi˚ToDiscovî
 = 
GATT_INVALID_HANDLE
;

982 
íabÀCCCDs
 = 
TRUE
;

984 i‡–
	`hid≠pB⁄dCou¡
() > 0 )

987 
	`hid≠pE°ablishLök
–
TRUE
, 
addrTy≥
, 
ªmŸeAddr
 );

992 
	`hid≠pSëIdÀ
();

999 
	}
}

1012 
	$hid≠pE°ablishLök
–
uöt8
 
whôeLi°
, uöt8 
addrTy≥
, uöt8 *
ªmŸeAddr
 )

1014 i‡–
hid≠pBLESèã
 !
BLE_STATE_CONNECTED
 )

1016 
hid≠pBLESèã
 = 
BLE_STATE_CONNECTING
;

1019 
VOID
 
	`GAPCíåÆRﬁe_E°ablishLök
–
DEFAULT_LINK_HIGH_DUTY_CYCLE
,

1020 
whôeLi°
, 
addrTy≥
, 
ªmŸeAddr
 );

1022 
VOID
 
	`oßl_°¨t_ªlﬂd_timî
–
hid≠pTaskId
, 
HIDAPP_EVT_INIT_CONNECT
,

1023 (
uöt32
)
INIT_CONNECT_TIMEOUT
 );

1025 
	}
}

1036 
	$hid≠pSèπDiscovîy
( )

1039 i‡–
hid≠pBLESèã
 !
BLE_STATE_CONNECTED
 )

1041 
hid≠pBLESèã
 = 
BLE_STATE_SCANNING
;

1043 
numSˇns
 = 
MAX_NUM_SCANS
;

1046 
	`hid≠pDiscovîDevi˚s
();

1048 
	}
}

1059 
	$hid≠pDiscovîDevi˚s
( )

1061 i‡–
hid≠pBLESèã
 =
BLE_STATE_SCANNING
 )

1063 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_BLINK
 );

1066 
VOID
 
	`GAPCíåÆRﬁe_SèπDiscovîy
–
DEFAULT_DISCOVERY_MODE
,

1067 
DEFAULT_DISCOVERY_ACTIVE_SCAN
,

1068 
DEFAULT_DISCOVERY_WHITE_LIST
 );

1070 
	}
}

1081 
	$hid≠pSëIdÀ
( )

1083 
hid≠pBLESèã
 = 
BLE_STATE_IDLE
;

1085 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_ON
 );

1086 
	}
}

1099 
	$hid≠pPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 )

1101  
°©e
 )

1103 
GAPBOND_PAIRING_STATE_BONDED
:

1104 i‡–
°©us
 =
SUCCESS
 )

1107 
g≠B⁄dMgrSèã
 = 
PAIRED_BONDED_STATE
;

1110 i‡–
	`oßl_memcmp
–
ªmŸeH™dÀs
.
œ°RemŸeAddr
, 
ªmŸeAddr
, 
B_ADDR_LEN
 ) =
TRUE
 )

1112 
£rvi˚Ch™geH™dÀ
 = 
ªmŸeH™dÀs
.
svcCh™geH™dÀ
;

1115 i‡––
ªmŸeH™dÀs
.
mou£Ch¨H™dÀ
 =
GATT_INVALID_HANDLE
 ) ||

1116 –
ªmŸeH™dÀs
.
keyCh¨H™dÀ
 =
GATT_INVALID_HANDLE
 ) ||

1117 –
ªmŸeH™dÀs
.
c⁄sumîCålCh¨H™dÀ
 =
GATT_INVALID_HANDLE
 ) ||

1118 –
£rvi˚Ch™ge
 =
CHANGE_OCCURED
 ) )

1121 i‡(
£rvi˚Ch™geH™dÀ
 =
GATT_INVALID_HANDLE
 )

1124 
£rvi˚ToDiscovî
 = 
GATT_SERVICE_UUID
;

1129 
£rvi˚ToDiscovî
 = 
HID_SERVICE_UUID
;

1134 
	`hid≠pDiscovîSîvi˚
–
c⁄nH™dÀ
, 
£rvi˚ToDiscovî
 );

1136 
£rvi˚DiscCom∂ëe
 = 
FALSE
;

1142 
£rvi˚DiscCom∂ëe
 = 
TRUE
;

1143 
mou£Ch¨H™dÀ
 = 
ªmŸeH™dÀs
.mouseCharHandle;

1144 
keyCh¨H™dÀ
 = 
ªmŸeH™dÀs
.keyCharHandle;

1145 
c⁄sumîCålCh¨H™dÀ
 = 
ªmŸeH™dÀs
.consumerCtrlCharHandle;

1146 
mou£CCCH™dÀ
 = 
ªmŸeH™dÀs
.mouseCCCHandle;

1147 
keyCCCH™dÀ
 = 
ªmŸeH™dÀs
.keyCCCHandle;

1148 
c⁄sumîCålCCCH™dÀ
 = 
ªmŸeH™dÀs
.consumerCtrlCCCHandle;

1151 i‡–
	`oßl_isbuf£t
–
ªmŸeH™dÀs
.
œ°RemŸeAddr
, 0x00, 
B_ADDR_LEN
 ) =
TRUE
 )

1156 
íabÀCCCDs
 = 
FALSE
;

1159 
£rvi˚ToDiscovî
 = 
HID_SERVICE_UUID
;

1160 
	`hid≠pDiscovîSîvi˚
–
c⁄nH™dÀ
, 
HID_SERVICE_UUID
 );

1165 
GAPBOND_PAIRING_STATE_COMPLETE
:

1166 i‡–
°©us
 =
SUCCESS
 )

1169 
g≠B⁄dMgrSèã
 = 
PAIRED_BONDED_STATE
;

1172 
£rvi˚ToDiscovî
 = 
GATT_SERVICE_UUID
;

1173 
	`hid≠pDiscovîSîvi˚
–
c⁄nH™dÀ
, 
GATT_SERVICE_UUID
 );

1180 
	}
}

1192 
	$hid≠pE«bÀNŸifiˇti⁄
–
uöt16
 
c⁄nH™dÀ
, uöt16 
©åH™dÀ
 )

1194 
©tWrôeReq_t
 
ªq
;

1195 
uöt8
 
nŸifiˇti⁄sOn
[] = {0x01, 0x00};

1197 
ªq
.
h™dÀ
 = 
©åH™dÀ
;

1199 
ªq
.
Àn
 = 2;

1200 
	`oßl_mem˝y
(
ªq
.
vÆue
, 
nŸifiˇti⁄sOn
, 2);

1202 
ªq
.
sig
 = 0;

1203 
ªq
.
cmd
 = 0;

1205 
VOID
 
	`GATT_WrôeCh¨VÆue
–
c⁄nH™dÀ
, &
ªq
, 
hid≠pTaskId
 );

1206 
	}
}

1218 
	$hid≠pDiscovîSîvi˚
–
uöt16
 
c⁄nH™dÀ
, uöt16 
svcUuid
 )

1220 
uöt8
 
uuid
[2] = {
	`LO_UINT16
(
svcUuid
), 
	`HI_UINT16
(svcUuid)};

1222 
VOID
 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
c⁄nH™dÀ
, 
uuid
, 
ATT_BT_UUID_SIZE
, 
hid≠pTaskId
 );

1223 
	}
}

1236 
boﬁ
 
	$hid≠pFödSvcUuid
–
uöt16
 
uuid
, 
uöt8
 *
pD©a
, uöt8 
d©aLí
 )

1238 
uöt8
 
adLí
;

1239 
uöt8
 
adTy≥
;

1240 
uöt8
 *
pEnd
;

1242 
pEnd
 = 
pD©a
 + 
d©aLí
 - 1;

1245  
pD©a
 < 
pEnd
 )

1248 
adLí
 = *
pD©a
++;

1249 i‡–
adLí
 > 0 )

1251 
adTy≥
 = *
pD©a
;

1254 i‡––
adTy≥
 =
GAP_ADTYPE_16BIT_MORE
 ) ||

1255 –
adTy≥
 =
GAP_ADTYPE_16BIT_COMPLETE
 ) )

1257 
pD©a
++;

1258 
adLí
--;

1261  ( 
adLí
 >2 ) && ( 
pD©a
 < 
pEnd
 ) )

1264 i‡––
pD©a
[0] =
	`LO_UINT16
(
uuid
) ) &&

1265 –
pD©a
[1] =
	`HI_UINT16
(
uuid
) ) )

1268  
TRUE
;

1272 
pD©a
 += 2;

1273 
adLí
 -= 2;

1277 i‡–
adLí
 == 1 )

1279 
pD©a
++;

1285 
pD©a
 +
adLí
;

1291  
FALSE
;

1292 
	}
}

1304 
uöt8
 
	$hid≠pFödHIDRemŸe
–
uöt8
* 
pD©a
, uöt8 
Àngth
 )

1306 
uöt8
 
ªmŸeName
[] =

1324 
pD©a
 += 2;

1327 
Àngth
 -= 2;

1329  
	`oßl_memcmp
–
ªmŸeName
, 
pD©a
, 
Àngth
 );

1330 
	}
}

1342 
	$hid≠pSaveH™dÀs
( )

1345 
ªmŸeH™dÀs
.
mou£Ch¨H™dÀ
 = mouseCharHandle;

1346 
ªmŸeH™dÀs
.
keyCh¨H™dÀ
 = keyCharHandle;

1347 
ªmŸeH™dÀs
.
c⁄sumîCålCh¨H™dÀ
 = consumerCtrlCharHandle;

1350 
ªmŸeH™dÀs
.
mou£CCCH™dÀ
 = mouseCCCHandle;

1351 
ªmŸeH™dÀs
.
keyCCCH™dÀ
 = keyCCCHandle;

1352 
ªmŸeH™dÀs
.
c⁄sumîCålCCCH™dÀ
 = consumerCtrlCCCHandle;

1353 
ªmŸeH™dÀs
.
svcCh™geH™dÀ
 = 
£rvi˚Ch™geH™dÀ
;

1354 
	}
}

1365 
	$hid≠pEø£H™dÀs
( )

1368 
ªmŸeH™dÀs
.
mou£Ch¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

1369 
ªmŸeH™dÀs
.
keyCh¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

1370 
ªmŸeH™dÀs
.
c⁄sumîCålCh¨H™dÀ
 = 
GATT_INVALID_HANDLE
;

1373 
ªmŸeH™dÀs
.
mou£CCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

1374 
ªmŸeH™dÀs
.
keyCCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

1375 
ªmŸeH™dÀs
.
c⁄sumîCålCCCH™dÀ
 = 
GATT_INVALID_HANDLE
;

1376 
ªmŸeH™dÀs
.
svcCh™geH™dÀ
 = 
GATT_INVALID_HANDLE
;

1379 
	`oßl_mem£t
–
ªmŸeH™dÀs
.
œ°RemŸeAddr
, 0x00, 
B_ADDR_LEN
 );

1380 
	}
}

1391 
uöt8
 
	$hid≠pB⁄dCou¡
( )

1393 
uöt8
 
b⁄dC¡
 = 0;

1395 
VOID
 
	`GAPB⁄dMgr_GëP¨amëî
–
GAPBOND_BOND_COUNT
, &
b⁄dC¡
 );

1397  ( 
b⁄dC¡
 );

1398 
	}
}

	@Projects/ble/HIDAdvRemoteDongle/Source/hidapp.h

40 #i‚de‡
HIDAPP_H


41 
	#HIDAPP_H


	)

43 #ifde‡
__˝lu•lus


57 
	#HIDAPP_EVT_START
 0x0001

58 
	#HIDAPP_EVT_START_DISCOVERY
 0x0002

59 
	#HIDAPP_EVT_INIT_CONNECT
 0x0004

60 
	#HIDAPP_EVT_REPORT_RETRY
 0x0008

61 

	)

67 
	#USB_HID_REPORT_REMOTE_INIT
(
_s
) \

68 
	`°
((
_s
).
d©a
[0] = 0; (_s).d©a[1] = 0;)

	)

69 
	#USB_HID_REPORT_REMOTE_HAS_SOME
(
_s
) \

70 ((
_s
).
d©a
[0] !0 || (_s).d©a[1] !0)

	)

79 
Hid≠p_Inô
–
uöt8
 
èsk_id
 );

84 
uöt16
 
Hid≠p_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

89 #ifde‡
__˝lu•lus


	@Projects/ble/HIDEmuKbd/Source/OSAL_hidemukbd.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 
	~"≥rùhîÆ.h
"

75 
	~"hiddev.h
"

78 
	~"hidemukbd.h
"

85 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

87 
LL_Pro˚ssEvít
,

88 
HÆ_Pro˚ssEvít
,

89 
HCI_Pro˚ssEvít
,

90 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

91 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

93 
L2CAP_Pro˚ssEvít
,

94 
GAP_Pro˚ssEvít
,

95 
GATT_Pro˚ssEvít
,

96 
SM_Pro˚ssEvít
,

97 
GAPRﬁe_Pro˚ssEvít
,

98 
GAPB⁄dMgr_Pro˚ssEvít
,

99 
GATTSîvAµ_Pro˚ssEvít
,

100 
HidDev_Pro˚ssEvít
,

101 
HidEmuKbd_Pro˚ssEvít


104 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

105 
uöt16
 *
	gèsksEvíts
;

120 
	$oßlInôTasks
( )

122 
uöt8
 
èskID
 = 0;

124 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

125 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

128 
	`LL_Inô
–
èskID
++ );

131 
	`HÆ_Inô
–
èskID
++ );

134 
	`HCI_Inô
–
èskID
++ );

136 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

138 
	`oßl_CbTimîInô
–
èskID
 );

139 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

143 
	`L2CAP_Inô
–
èskID
++ );

146 
	`GAP_Inô
–
èskID
++ );

149 
	`GATT_Inô
–
èskID
++ );

152 
	`SM_Inô
–
èskID
++ );

155 
	`GAPRﬁe_Inô
–
èskID
++ );

156 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

158 
	`GATTSîvAµ_Inô
–
èskID
++ );

160 
	`HidDev_Inô
–
èskID
++ );

163 
	`HidEmuKbd_Inô
–
èskID
 );

164 
	}
}

	@Projects/ble/HIDEmuKbd/Source/hidemukbd.c

46 
	~"bcomdef.h
"

47 
	~"OSAL.h
"

48 
	~"OSAL_PwrMgr.h
"

49 
	~"OnBﬂrd.h
"

50 
	~"hÆ_Àd.h
"

51 
	~"hÆ_key.h
"

52 
	~"g©t.h
"

53 
	~"hci.h
"

54 
	~"g≠g©t£rvî.h
"

55 
	~"g©t£rv≠p.h
"

56 
	~"lökdb.h
"

57 
	~"≥rùhîÆ.h
"

58 
	~"g≠b⁄dmgr.h
"

59 
	~"hidkbd£rvi˚.h
"

60 
	~"devöfo£rvi˚.h
"

61 
	~"b©t£rvi˚.h
"

62 
	~"hiddev.h
"

63 
	~"hidemukbd.h
"

70 
	#KEY_RIGHT_ARROW
 0x4F

	)

71 
	#KEY_LEFT_ARROW
 0x50

	)

72 
	#KEY_NONE
 0x00

	)

75 
	#LED_NUM_LOCK
 0x01

	)

76 
	#LED_CAPS_LOCK
 0x02

	)

79 
	#MOUSE_BUTTON_1
 0x01

	)

80 
	#MOUSE_BUTTON_NONE
 0x00

	)

83 
	#HID_KEYBOARD_IN_RPT_LEN
 8

	)

86 
	#HID_LED_OUT_RPT_LEN
 1

	)

89 
	#HID_MOUSE_IN_RPT_LEN
 5

	)

96 
	#DEFAULT_HID_IDLE_TIMEOUT
 60000

	)

99 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 8

	)

102 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 8

	)

105 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 50

	)

108 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 500

	)

111 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
TRUE


	)

114 
	#DEFAULT_CONN_PAUSE_PERIPHERAL
 10

	)

117 
	#DEFAULT_PASSCODE
 0

	)

120 
	#DEFAULT_PAIRING_MODE
 
GAPBOND_PAIRING_MODE_INITIATE


	)

123 
	#DEFAULT_MITM_MODE
 
FALSE


	)

126 
	#DEFAULT_BONDING_MODE
 
TRUE


	)

129 
	#DEFAULT_IO_CAPABILITIES
 
GAPBOND_IO_CAP_NO_INPUT_NO_OUTPUT


	)

132 
	#DEFAULT_BATT_CRITICAL_LEVEL
 6

	)

143 
uöt8
 
	ghidEmuKbdTaskId
;

158 
uöt8
 
	gsˇnD©a
[] =

161 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

177 
uöt8
 
	gadvD©a
[] =

181 
GAP_ADTYPE_FLAGS
,

182 
GAP_ADTYPE_FLAGS_LIMITED
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

186 
GAP_ADTYPE_APPEARANCE
,

187 
LO_UINT16
(
GAP_APPEARE_HID_KEYBOARD
),

188 
HI_UINT16
(
GAP_APPEARE_HID_KEYBOARD
),

192 
GAP_ADTYPE_16BIT_MORE
,

193 
LO_UINT16
(
HID_SERVICE_UUID
),

194 
HI_UINT16
(
HID_SERVICE_UUID
),

195 
LO_UINT16
(
BATT_SERVICE_UUID
),

196 
HI_UINT16
(
BATT_SERVICE_UUID
)

200 
CONST
 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "HID Keyboard";

203 
hidDevCfg_t
 
	ghidEmuKbdCfg
 =

205 
DEFAULT_HID_IDLE_TIMEOUT
,

206 
HID_KBD_FLAGS


210 
uöt8
 
	ghidBoŸMou£E«bÀd
 = 
FALSE
;

216 
hidEmuKbd_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

217 
hidEmuKbd_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

218 
hidEmuKbdSídRï‹t
–
uöt8
 
keycode
 );

219 
hidEmuKbdSídMou£Rï‹t
–
uöt8
 
buâ⁄s
 );

220 
uöt8
 
hidEmuKbdRcvRï‹t
–uöt8 
Àn
, uöt8 *
pD©a
 );

221 
uöt8
 
hidEmuKbdR±CB
–uöt8 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
,

222 
uöt8
 
›î
, uöt8 *
pLí
, uöt8 *
pD©a
 );

223 
hidEmuKbdEvtCB
–
uöt8
 
evt
 );

229 
hidDevCB_t
 
	ghidEmuKbdHidCBs
 =

231 
hidEmuKbdR±CB
,

232 
hidEmuKbdEvtCB
,

233 
NULL


254 
	$HidEmuKbd_Inô
–
uöt8
 
èsk_id
 )

256 
hidEmuKbdTaskId
 = 
èsk_id
;

259 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_PAUSE_PERIPHERAL
, 
DEFAULT_CONN_PAUSE_PERIPHERAL
 );

263 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

268 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

270 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

271 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

272 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

273 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

274 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

277 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

278 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

280 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advD©a
 ),ádvData );

281 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnD©a
 ), scanData );

283 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

284 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

285 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

286 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

287 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

291 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, (*Ë
©tDevi˚Name
 );

295 
uöt32
 
∑sskey
 = 
DEFAULT_PASSCODE
;

296 
uöt8
 
∑úMode
 = 
DEFAULT_PAIRING_MODE
;

297 
uöt8
 
môm
 = 
DEFAULT_MITM_MODE
;

298 
uöt8
 
ioC≠
 = 
DEFAULT_IO_CAPABILITIES
;

299 
uöt8
 
b⁄dög
 = 
DEFAULT_BONDING_MODE
;

300 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
, –
uöt32
 ), &
∑sskey
 );

301 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
, –
uöt8
 ), &
∑úMode
 );

302 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
, –
uöt8
 ), &
môm
 );

303 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
, –
uöt8
 ), &
ioC≠
 );

304 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
, –
uöt8
 ), &
b⁄dög
 );

309 
uöt8
 
¸ôiˇl
 = 
DEFAULT_BATT_CRITICAL_LEVEL
;

310 
	`B©t_SëP¨amëî
–
BATT_PARAM_CRITICAL_LEVEL
,  (
uöt8
), &
¸ôiˇl
 );

314 
	`HidKbd_AddSîvi˚
( );

317 
	`HidDev_Regi°î
–&
hidEmuKbdCfg
, &
hidEmuKbdHidCBs
 );

320 
	`Regi°îF‹Keys
–
hidEmuKbdTaskId
 );

322 #i‡
	`deföed
–
CC2540_MINIDK
 )

324 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

330 
P0SEL
 = 0;

331 
P1SEL
 = 0;

332 
P2SEL
 = 0;

334 
P0DIR
 = 0xFC;

336 
P1DIR
 = 0xFF;

337 
P2DIR
 = 0x1F;

339 
P0
 = 0x03;

340 
P1
 = 0;

341 
P2
 = 0;

346 
	`oßl_£t_evít
–
hidEmuKbdTaskId
, 
START_DEVICE_EVT
 );

347 
	}
}

362 
uöt16
 
	$HidEmuKbd_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

365 
VOID
 
èsk_id
;

367 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

369 
uöt8
 *
pMsg
;

371 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
hidEmuKbdTaskId
 )Ë!
NULL
 )

373 
	`hidEmuKbd_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

376 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

380  (
evíts
 ^ 
SYS_EVENT_MSG
);

383 i‡–
evíts
 & 
START_DEVICE_EVT
 )

385  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

389 
	}
}

400 
	$hidEmuKbd_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

402  
pMsg
->
evít
 )

404 
KEY_CHANGE
:

405 
	`hidEmuKbd_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

411 
	}
}

425 
	$hidEmuKbd_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

427 
uöt8
 
¥evKey1
 = 0;

428 
uöt8
 
¥evKey2
 = 0;

430 ()
shi·
;

432 i‡–(
keys
 & 
HAL_KEY_SW_1
Ë&& (
¥evKey1
 == 0) )

435 
	`hidEmuKbdSídRï‹t
–
KEY_LEFT_ARROW
 );

436 
¥evKey1
 = 1;

438 i‡–!(
keys
 & 
HAL_KEY_SW_1
Ë&& (
¥evKey1
 == 1) )

441 
	`hidEmuKbdSídRï‹t
–
KEY_NONE
 );

442 
¥evKey1
 = 0;

445 i‡–(
keys
 & 
HAL_KEY_SW_2
Ë&& (
¥evKey2
 == 0) )

448 i‡–!
hidBoŸMou£E«bÀd
 )

450 
	`hidEmuKbdSídRï‹t
–
KEY_RIGHT_ARROW
 );

454 
	`hidEmuKbdSídMou£Rï‹t
–
MOUSE_BUTTON_1
 );

456 
¥evKey2
 = 1;

458 i‡–!(
keys
 & 
HAL_KEY_SW_2
Ë&& (
¥evKey2
 == 1) )

461 i‡–!
hidBoŸMou£E«bÀd
 )

463 
	`hidEmuKbdSídRï‹t
–
KEY_NONE
 );

467 
	`hidEmuKbdSídMou£Rï‹t
 ( 
MOUSE_BUTTON_NONE
 );

469 
¥evKey2
 = 0;

471 
	}
}

482 
	$hidEmuKbdSídRï‹t
–
uöt8
 
keycode
 )

484 
uöt8
 
buf
[
HID_KEYBOARD_IN_RPT_LEN
];

486 
buf
[0] = 0;

487 
buf
[1] = 0;

488 
buf
[2] = 
keycode
;

489 
buf
[3] = 0;

490 
buf
[4] = 0;

491 
buf
[5] = 0;

492 
buf
[6] = 0;

493 
buf
[7] = 0;

495 
	`HidDev_Rï‹t
–
HID_RPT_ID_KEY_IN
, 
HID_REPORT_TYPE_INPUT
,

496 
HID_KEYBOARD_IN_RPT_LEN
, 
buf
 );

497 
	}
}

508 
	$hidEmuKbdSídMou£Rï‹t
–
uöt8
 
buâ⁄s
 )

510 
uöt8
 
buf
[
HID_MOUSE_IN_RPT_LEN
];

512 
buf
[0] = 
buâ⁄s
;

513 
buf
[1] = 0;

514 
buf
[2] = 0;

515 
buf
[3] = 0;

516 
buf
[4] = 0;

518 
	`HidDev_Rï‹t
–
HID_RPT_ID_MOUSE_IN
, 
HID_REPORT_TYPE_INPUT
,

519 
HID_MOUSE_IN_RPT_LEN
, 
buf
 );

520 
	}
}

532 
uöt8
 
	$hidEmuKbdRcvRï‹t
–
uöt8
 
Àn
, uöt8 *
pD©a
 )

535 i‡–
Àn
 =
HID_LED_OUT_RPT_LEN
 )

538 
	`HÆLedSë
–
HAL_LED_1
, ((*
pD©a
 & 
LED_CAPS_LOCK
) == LED_CAPS_LOCK) );

539 
	`HÆLedSë
–
HAL_LED_2
, ((*
pD©a
 & 
LED_NUM_LOCK
) == LED_NUM_LOCK) );

541  
SUCCESS
;

545  
ATT_ERR_INVALID_VALUE_SIZE
;

547 
	}
}

563 
uöt8
 
	$hidEmuKbdR±CB
–
uöt8
 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
,

564 
uöt8
 
›î
, uöt8 *
pLí
, uöt8 *
pD©a
 )

566 
uöt8
 
°©us
 = 
SUCCESS
;

569 i‡–
›î
 =
HID_DEV_OPER_WRITE
 )

571 i‡–
uuid
 =
HID_REPORT_UUID
 )

574 i‡–
ty≥
 =
HID_REPORT_TYPE_OUTPUT
 )

576 
°©us
 = 
	`hidEmuKbdRcvRï‹t
–*
pLí
, 
pD©a
 );

580 i‡–
°©us
 =
SUCCESS
 )

582 
°©us
 = 
	`HidKbd_SëP¨amëî
–
id
, 
ty≥
, 
uuid
, *
pLí
, 
pD©a
 );

586 i‡–
›î
 =
HID_DEV_OPER_READ
 )

588 
°©us
 = 
	`HidKbd_GëP¨amëî
–
id
, 
ty≥
, 
uuid
, 
pLí
, 
pD©a
 );

591 i‡–
›î
 =
HID_DEV_OPER_ENABLE
 )

593 i‡–
id
 =
HID_RPT_ID_MOUSE_IN
 && 
ty≥
 =
HID_REPORT_TYPE_INPUT
 )

595 
hidBoŸMou£E«bÀd
 = 
TRUE
;

599 i‡–
›î
 =
HID_DEV_OPER_DISABLE
 )

601 i‡–
id
 =
HID_RPT_ID_MOUSE_IN
 && 
ty≥
 =
HID_REPORT_TYPE_INPUT
 )

603 
hidBoŸMou£E«bÀd
 = 
FALSE
;

607  
°©us
;

608 
	}
}

619 
	$hidEmuKbdEvtCB
–
uöt8
 
evt
 )

624 
	}
}

	@Projects/ble/HIDEmuKbd/Source/hidemukbd.h

40 #i‚de‡
HIDEMUKBD_H


41 
	#HIDEMUKBD_H


	)

43 #ifde‡
__˝lu•lus


57 
	#START_DEVICE_EVT
 0x0001

	)

74 
HidEmuKbd_Inô
–
uöt8
 
èsk_id
 );

79 
uöt16
 
HidEmuKbd_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

84 #ifde‡
__˝lu•lus


	@Projects/ble/HIDEmuKbd/Source/hidemukbd_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

69 
	$maö
()

72 
	`HAL_BOARD_INIT
();

75 
	`InôBﬂrd
–
OB_COLD
 );

78 
	`HÆDrivîInô
();

81 
	`oßl_¢v_öô
();

86 
	`oßl_öô_sy°em
();

89 
	`HAL_ENABLE_INTERRUPTS
();

92 
	`InôBﬂrd
–
OB_READY
 );

94 #i‡
	`deföed
 ( 
POWER_SAVING
 )

95 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

99 
	`oßl_°¨t_sy°em
();

102 
	}
}

	@Projects/ble/HeartRate/Source/OSAL_heartrate.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"hci_é.h
"

54 
	~"Œ.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 
	~"≥rùhîÆ.h
"

77 
	~"hóπøã.h
"

84 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

86 
LL_Pro˚ssEvít
,

87 
HÆ_Pro˚ssEvít
,

88 
HCI_Pro˚ssEvít
,

89 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

90 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

92 
L2CAP_Pro˚ssEvít
,

93 
GAP_Pro˚ssEvít
,

94 
GATT_Pro˚ssEvít
,

95 
SM_Pro˚ssEvít
,

96 
GAPRﬁe_Pro˚ssEvít
,

97 
GAPB⁄dMgr_Pro˚ssEvít
,

98 
GATTSîvAµ_Pro˚ssEvít
,

99 
HóπR©e_Pro˚ssEvít


102 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

103 
uöt16
 *
	gèsksEvíts
;

118 
	$oßlInôTasks
( )

120 
uöt8
 
èskID
 = 0;

122 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

123 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

126 
	`LL_Inô
–
èskID
++ );

129 
	`HÆ_Inô
–
èskID
++ );

132 
	`HCI_Inô
–
èskID
++ );

134 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

136 
	`oßl_CbTimîInô
–
èskID
 );

137 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

141 
	`L2CAP_Inô
–
èskID
++ );

144 
	`GAP_Inô
–
èskID
++ );

147 
	`GATT_Inô
–
èskID
++ );

150 
	`SM_Inô
–
èskID
++ );

153 
	`GAPRﬁe_Inô
–
èskID
++ );

154 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

156 
	`GATTSîvAµ_Inô
–
èskID
++ );

159 
	`HóπR©e_Inô
–
èskID
 );

160 
	}
}

	@Projects/ble/HeartRate/Source/heartrate.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"lökdb.h
"

50 
	~"g©t.h
"

51 
	~"g≠g©t£rvî.h
"

52 
	~"g©t£rv≠p.h
"

53 
	~"hóπøã£rvi˚.h
"

54 
	~"devöfo£rvi˚.h
"

55 
	~"b©t£rvi˚.h
"

56 
	~"≥rùhîÆ.h
"

57 
	~"g≠b⁄dmgr.h
"

58 
	~"hóπøã.h
"

65 
	#HEARTRATE_BPM_TO_RR
(
bpm
Ë((
uöt16
Ë60 * 1024 / (uöt16Ë(bpm))

	)

72 
	#DEFAULT_FAST_ADV_INTERVAL
 32

	)

75 
	#DEFAULT_FAST_ADV_DURATION
 30000

	)

78 
	#DEFAULT_SLOW_ADV_INTERVAL
 1600

	)

81 
	#DEFAULT_SLOW_ADV_DURATION
 0

	)

84 
	#DEFAULT_HEARTRATE_PERIOD
 2000

	)

87 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

90 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 200

	)

93 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 1600

	)

96 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 1

	)

99 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

102 
	#DEFAULT_BATT_CRITICAL_LEVEL
 6

	)

105 
	#DEFAULT_BATT_PERIOD
 15000

	)

108 
	#BPM_DEFAULT
 73

	)

109 
	#BPM_MAX
 80

	)

110 
	#ENERGY_INCREMENT
 10

	)

111 
	#FLAGS_IDX_MAX
 7

	)

132 
uöt8
 
	ghóπR©e_TaskID
;

134 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

137 
uöt8
 
	gsˇnD©a
[] =

140 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

160 
uöt8
 
	gadvîtD©a
[] =

164 
GAP_ADTYPE_FLAGS
,

165 
GAP_ADTYPE_FLAGS_GENERAL
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

168 
GAP_ADTYPE_16BIT_MORE
,

169 
LO_UINT16
(
HEARTRATE_SERV_UUID
),

170 
HI_UINT16
(
HEARTRATE_SERV_UUID
),

171 
LO_UINT16
(
BATT_SERVICE_UUID
),

172 
HI_UINT16
(
BATT_SERVICE_UUID
)

176 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "Heart Rate Sensor";

179 
uöt16
 
	gg≠C⁄nH™dÀ
;

182 
©tH™dÀVÆueNŸi_t
 
	ghóπR©eMós
;

185 
uöt8
 
	ghóπR©eBpm
 = 
BPM_DEFAULT
;

186 
uöt16
 
	ghóπR©eE√rgy
 = 0;

187 
uöt16
 
	ghóπR©eRrI¡îvÆ1
 = 
HEARTRATE_BPM_TO_RR
(
BPM_DEFAULT
);

188 
uöt16
 
	ghóπR©eRrI¡îvÆ2
 = 
HEARTRATE_BPM_TO_RR
(
BPM_DEFAULT
);

191 c⁄° 
uöt8
 
	ghóπR©eFœgs
[
FLAGS_IDX_MAX
] =

193 
HEARTRATE_FLAGS_CONTACT_NOT_SUP
,

194 
HEARTRATE_FLAGS_CONTACT_NOT_DET
,

195 
HEARTRATE_FLAGS_CONTACT_DET
 | 
HEARTRATE_FLAGS_ENERGY_EXP
,

196 
HEARTRATE_FLAGS_CONTACT_DET
 | 
HEARTRATE_FLAGS_RR
,

197 
HEARTRATE_FLAGS_CONTACT_DET
 | 
HEARTRATE_FLAGS_ENERGY_EXP
 | 
HEARTRATE_FLAGS_RR
,

198 
HEARTRATE_FLAGS_FORMAT_UINT16
 | 
HEARTRATE_FLAGS_CONTACT_DET
 | 
HEARTRATE_FLAGS_ENERGY_EXP
 | 
HEARTRATE_FLAGS_RR
,

202 
uöt8
 
	ghóπR©eFœgsIdx
 = 0;

205 
boﬁ
 
	ghóπR©eAdvC™˚Œed
 = 
FALSE
;

210 
hóπR©e_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

211 
HóπR©eG≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

212 
hóπR©ePîiodicTask
( );

213 
hóπR©eB©tPîiodicTask
( );

214 
hóπR©e_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

215 
hóπR©eMósNŸify
();

216 
hóπR©eCB
(
uöt8
 
evít
);

217 
hóπR©eB©tCB
(
uöt8
 
evít
);

224 
g≠RﬁesCBs_t
 
	ghóπR©ePîùhîÆCB
 =

226 
HóπR©eG≠SèãCB
,

227 
NULL


231 c⁄° 
g≠B⁄dCBs_t
 
	ghóπR©eB⁄dCB
 =

233 
NULL
,

234 
NULL


255 
	$HóπR©e_Inô
–
uöt8
 
èsk_id
 )

257 
hóπR©e_TaskID
 = 
èsk_id
;

262 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

267 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

269 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

270 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

271 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

272 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

273 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

276 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

277 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

279 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnD©a
 ), scanData );

280 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

282 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

283 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

284 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

285 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

286 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

290 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
©tDevi˚Name
 );

294 
uöt32
 
∑sskey
 = 0;

295 
uöt8
 
∑úMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

296 
uöt8
 
môm
 = 
FALSE
;

297 
uöt8
 
ioC≠
 = 
GAPBOND_IO_CAP_DISPLAY_ONLY
;

298 
uöt8
 
b⁄dög
 = 
TRUE
;

299 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
,  ( 
uöt32
 ), &
∑sskey
 );

300 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

301 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

302 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

303 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

308 
uöt8
 
£nsLoc
 = 
HEARTRATE_SENS_LOC_WRIST
;

309 
	`HóπR©e_SëP¨amëî
–
HEARTRATE_SENS_LOC
,  ( 
uöt8
 ), &
£nsLoc
 );

314 
uöt8
 
¸ôiˇl
 = 
DEFAULT_BATT_CRITICAL_LEVEL
;

315 
	`B©t_SëP¨amëî
–
BATT_PARAM_CRITICAL_LEVEL
,  (
uöt8
 ), &
¸ôiˇl
 );

319 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

320 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

321 
	`HóπR©e_AddSîvi˚
–
GATT_ALL_SERVICES
 );

322 
	`DevInfo_AddSîvi˚
( );

323 
	`B©t_AddSîvi˚
( );

326 
	`HóπR©e_Regi°î
–
hóπR©eCB
 );

329 
	`B©t_Regi°î
 ( 
hóπR©eB©tCB
 );

332 
	`Regi°îF‹Keys
–
hóπR©e_TaskID
 );

335 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

341 
P0SEL
 = 0;

342 
P1SEL
 = 0;

343 
P2SEL
 = 0;

345 
P0DIR
 = 0xFC;

347 
P1DIR
 = 0xFF;

348 
P2DIR
 = 0x1F;

350 
P0
 = 0x03;

351 
P1
 = 0;

352 
P2
 = 0;

355 
	`oßl_£t_evít
–
hóπR©e_TaskID
, 
START_DEVICE_EVT
 );

356 
	}
}

371 
uöt16
 
	$HóπR©e_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

374 
VOID
 
èsk_id
;

376 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

378 
uöt8
 *
pMsg
;

380 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
hóπR©e_TaskID
 )Ë!
NULL
 )

382 
	`hóπR©e_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

385 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

389  (
evíts
 ^ 
SYS_EVENT_MSG
);

392 i‡–
evíts
 & 
START_DEVICE_EVT
 )

395 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
hóπR©ePîùhîÆCB
 );

398 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
hóπR©eB⁄dCB
 );

400  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

403 i‡–
evíts
 & 
HEART_PERIODIC_EVT
 )

406 
	`hóπR©ePîiodicTask
();

408  (
evíts
 ^ 
HEART_PERIODIC_EVT
);

411 i‡–
evíts
 & 
BATT_PERIODIC_EVT
 )

414 
	`hóπR©eB©tPîiodicTask
();

416  (
evíts
 ^ 
BATT_PERIODIC_EVT
);

421 
	}
}

432 
	$hóπR©e_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

434  
pMsg
->
evít
 )

436 
KEY_CHANGE
:

437 
	`hóπR©e_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

440 
	}
}

454 
	$hóπR©e_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

456 i‡–
keys
 & 
HAL_KEY_SW_1
 )

459 i‡(++
hóπR©eFœgsIdx
 =
FLAGS_IDX_MAX
)

461 
hóπR©eFœgsIdx
 = 0;

465 i‡–
keys
 & 
HAL_KEY_SW_2
 )

468 if–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

470 
uöt8
 
°©us
;

473 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

474 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

475 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_FAST_ADV_DURATION
 );

478 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
°©us
 );

479 
°©us
 = !status;

480 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
°©us
 );

483 i‡(
°©us
 =
FALSE
)

485 
hóπR©eAdvC™˚Œed
 = 
TRUE
;

489 
	}
}

498 
	$hóπR©eMósNŸify
()

500 
uöt8
 *
p
 = 
hóπR©eMós
.
vÆue
;

501 
uöt8
 
Êags
 = 
hóπR©eFœgs
[
hóπR©eFœgsIdx
];

504 *
p
++ = 
Êags
;

505 *
p
++ = 
hóπR©eBpm
;

506 i‡(
Êags
 & 
HEARTRATE_FLAGS_FORMAT_UINT16
)

509 *
p
++ = 0;

511 i‡(
Êags
 & 
HEARTRATE_FLAGS_ENERGY_EXP
)

513 *
p
++ = 
	`LO_UINT16
(
hóπR©eE√rgy
);

514 *
p
++ = 
	`HI_UINT16
(
hóπR©eE√rgy
);

516 i‡(
Êags
 & 
HEARTRATE_FLAGS_RR
)

518 *
p
++ = 
	`LO_UINT16
(
hóπR©eRrI¡îvÆ1
);

519 *
p
++ = 
	`HI_UINT16
(
hóπR©eRrI¡îvÆ1
);

520 *
p
++ = 
	`LO_UINT16
(
hóπR©eRrI¡îvÆ2
);

521 *
p
++ = 
	`HI_UINT16
(
hóπR©eRrI¡îvÆ2
);

523 
hóπR©eMós
.
Àn
 = (
uöt8
Ë(
p
 - hóπR©eMós.
vÆue
);

524 
	`HóπR©e_MósNŸify
–
g≠C⁄nH™dÀ
, &
hóπR©eMós
 );

527 
hóπR©eE√rgy
 +
ENERGY_INCREMENT
;

528 i‡(++
hóπR©eBpm
 =
BPM_MAX
)

530 
hóπR©eBpm
 = 
BPM_DEFAULT
;

532 
hóπR©eRrI¡îvÆ1
 = 
hóπR©eRrI¡îvÆ2
 = 
	`HEARTRATE_BPM_TO_RR
(
hóπR©eBpm
);

533 
	}
}

544 
	$HóπR©eG≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

547 i‡(
√wSèã
 =
GAPROLE_CONNECTED
)

550 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_CONNHANDLE
, &
g≠C⁄nH™dÀ
);

553 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 &&

554 
√wSèã
 !
GAPROLE_CONNECTED
)

556 
uöt8
 
advSèã
 = 
TRUE
;

559 
	`oßl_°›_timîEx
–
hóπR©e_TaskID
, 
HEART_PERIODIC_EVT
 );

562 
	`HóπR©e_H™dÀC⁄nSètusCB
–
g≠C⁄nH™dÀ
, 
LINKDB_STATUS_UPDATE_REMOVED
 );

563 
	`B©t_H™dÀC⁄nSètusCB
–
g≠C⁄nH™dÀ
, 
LINKDB_STATUS_UPDATE_REMOVED
 );

565 i‡–
√wSèã
 =
GAPROLE_WAITING_AFTER_TIMEOUT
 )

568 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

569 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

570 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_FAST_ADV_DURATION
 );

575 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

576 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

577 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_SLOW_ADV_DURATION
 );

581 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

584 i‡–
g≠ProfûeSèã
 =
GAPROLE_ADVERTISING
 &&

585 
√wSèã
 =
GAPROLE_WAITING
 )

588 i‡–
hóπR©eAdvC™˚Œed
 )

590 
hóπR©eAdvC™˚Œed
 = 
FALSE
;

593 i‡–
	`GAP_GëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
 ) =
DEFAULT_FAST_ADV_INTERVAL
 )

595 
uöt8
 
advSèã
 = 
TRUE
;

597 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

598 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

599 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_SLOW_ADV_DURATION
 );

600 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

604 i‡(
√wSèã
 =
GAPROLE_STARTED
)

607 
uöt8
 
sy°emId
[
DEVINFO_SYSTEM_ID_LEN
];

608 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
sy°emId
);

611 
sy°emId
[7] = systemId[5];

612 
sy°emId
[6] = systemId[4];

613 
sy°emId
[5] = systemId[3];

616 
sy°emId
[4] = 0;

617 
sy°emId
[3] = 0;

619 
	`DevInfo_SëP¨amëî
(
DEVINFO_SYSTEM_ID
, 
DEVINFO_SYSTEM_ID_LEN
, 
sy°emId
);

622 
g≠ProfûeSèã
 = 
√wSèã
;

623 
	}
}

634 
	$hóπR©eCB
(
uöt8
 
evít
)

636 i‡(
evít
 =
HEARTRATE_MEAS_NOTI_ENABLED
)

639 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

641 
	`oßl_°¨t_timîEx
–
hóπR©e_TaskID
, 
HEART_PERIODIC_EVT
, 
DEFAULT_HEARTRATE_PERIOD
 );

644 i‡(
evít
 =
HEARTRATE_MEAS_NOTI_DISABLED
)

647 
	`oßl_°›_timîEx
–
hóπR©e_TaskID
, 
HEART_PERIODIC_EVT
 );

649 i‡(
evít
 =
HEARTRATE_COMMAND_SET
)

652 
hóπR©eE√rgy
 = 0;

654 
	}
}

665 
	$hóπR©eB©tCB
(
uöt8
 
evít
)

667 i‡(
evít
 =
BATT_LEVEL_NOTI_ENABLED
)

670 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

672 
	`oßl_°¨t_timîEx
–
hóπR©e_TaskID
, 
BATT_PERIODIC_EVT
, 
DEFAULT_BATT_PERIOD
 );

675 i‡(
evít
 =
BATT_LEVEL_NOTI_DISABLED
)

678 
	`oßl_°›_timîEx
–
hóπR©e_TaskID
, 
BATT_PERIODIC_EVT
 );

680 
	}
}

691 
	$hóπR©ePîiodicTask
( )

693 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

696 
	`hóπR©eMósNŸify
();

699 
	`oßl_°¨t_timîEx
–
hóπR©e_TaskID
, 
HEART_PERIODIC_EVT
, 
DEFAULT_HEARTRATE_PERIOD
 );

701 
	}
}

712 
	$hóπR©eB©tPîiodicTask
( )

714 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

717 
	`B©t_MósLevñ
( );

720 
	`oßl_°¨t_timîEx
–
hóπR©e_TaskID
, 
BATT_PERIODIC_EVT
, 
DEFAULT_BATT_PERIOD
 );

722 
	}
}

	@Projects/ble/HeartRate/Source/heartrate.h

40 #i‚de‡
HEARTRATE_H


41 
	#HEARTRATE_H


	)

43 #ifde‡
__˝lu•lus


58 
	#START_DEVICE_EVT
 0x0001

	)

59 
	#HEART_PERIODIC_EVT
 0x0002

	)

60 
	#BATT_PERIODIC_EVT
 0x0004

	)

73 
HóπR©e_Inô
–
uöt8
 
èsk_id
 );

78 
uöt16
 
HóπR©e_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

83 #ifde‡
__˝lu•lus


	@Projects/ble/HeartRate/Source/heartrate_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

69 
	$maö
()

72 
	`HAL_BOARD_INIT
();

75 
	`InôBﬂrd
–
OB_COLD
 );

78 
	`HÆDrivîInô
();

81 
	`oßl_¢v_öô
();

86 
	`oßl_öô_sy°em
();

89 
	`HAL_ENABLE_INTERRUPTS
();

92 
	`InôBﬂrd
–
OB_READY
 );

94 #i‡
	`deföed
 ( 
POWER_SAVING
 )

95 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

99 
	`oßl_°¨t_sy°em
();

102 
	}
}

	@Projects/ble/HostTestApp/Source/HostTest_Main.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"hÆ_key.h
"

46 
	~"hÆ_timî.h
"

47 
	~"hÆ_drivîs.h
"

48 
	~"hÆ_Àd.h
"

51 
	~"OSAL.h
"

52 
	~"OSAL_Tasks.h
"

53 #i‡
deföed
 
POWER_SAVING


54 
	~"OSAL_PwrMgr.h
"

56 
	~"oßl_¢v.h
"

63 
MSA_Maö_KeyCÆlback
(
uöt8
 
keys
, uöt8 
°©e
);

75 
	$maö
()

78 
	`HAL_BOARD_INIT
();

81 
	`HÆDrivîInô
();

84 
	`oßl_¢v_öô
();

87 
	`oßl_öô_sy°em
();

90 
	`HAL_ENABLE_INTERRUPTS
();

93 
	`HÆKeyC⁄fig
(
Ál£
, 
MSA_Maö_KeyCÆlback
);

96 
	`HÆLedSë
 (
HAL_LED_4
, 
HAL_LED_MODE_ON
);

98 #i‡
deföed
 
POWER_SAVING


99 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

103 
	`oßl_°¨t_sy°em
();

106 
	}
}

123 
	$MSA_Maö_KeyCÆlback
(
uöt8
 
keys
, uöt8 
°©e
)

126 
	}
}

	@Projects/ble/HostTestApp/Source/OSAL_HostTest.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

53 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

54 
	~"oßl_cbTimî.h
"

58 
	~"l2ˇp.h
"

61 
	~"g≠.h
"

63 #i‡
deföed
 ( 
GAP_BOND_MGR
 )

64 
	~"g≠b⁄dmgr.h
"

68 
	~"g©t.h
"

71 
	~"hci_é.h
"

73 #i‡!
deföed
 ( 
GATT_DB_OFF_CHIP
 )

74 
	~"g©t£rv≠p.h
"

76 #i‡
deföed
 ( 
GATT_TEST
 )

77 
	~"g©âe°.h
"

81 
	~"hci_ext_≠p.h
"

88 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

90 
LL_Pro˚ssEvít
,

91 
HÆ_Pro˚ssEvít
,

92 
HCI_Pro˚ssEvít
,

93 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

94 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

96 
L2CAP_Pro˚ssEvít
,

97 
GAP_Pro˚ssEvít
,

98 
SM_Pro˚ssEvít
,

99 
GATT_Pro˚ssEvít
,

100 #i‡!
deföed
 ( 
GATT_DB_OFF_CHIP
 )

101 
GATTSîvAµ_Pro˚ssEvít
,

102 #i‡
deföed
 ( 
GATT_TEST
 )

103 
GATTTe°_Pro˚ssEvít
,

106 #i‡
deföed
 ( 
GAP_BOND_MGR
 )

107 
GAPB⁄dMgr_Pro˚ssEvít
,

109 
HCI_EXT_Aµ_Pro˚ssEvít


112 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

113 
uöt16
 *
	gèsksEvíts
;

128 
	$oßlInôTasks
( )

130 
uöt8
 
èskID
 = 0;

132 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

133 
VOID
 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

136 
	`LL_Inô
–
èskID
++ );

139 
	`HÆ_Inô
–
èskID
++ );

142 
	`HCI_Inô
–
èskID
++ );

144 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

146 
	`oßl_CbTimîInô
–
èskID
 );

147 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

151 
	`L2CAP_Inô
–
èskID
++ );

154 
	`GAP_Inô
–
èskID
++ );

157 
	`SM_Inô
–
èskID
++ );

160 
	`GATT_Inô
–
èskID
++ );

162 #i‡!
	`deföed
 ( 
GATT_DB_OFF_CHIP
 )

164 
	`GATTSîvAµ_Inô
–
èskID
++ );

166 #i‡
	`deföed
 ( 
GATT_TEST
 )

168 
	`GATTTe°_Inô
–
èskID
++ );

172 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

173 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

177 
	`HCI_EXT_Aµ_Inô
–
èskID
 );

178 
	}
}

	@Projects/ble/HostTestApp/Source/hci_ext_app.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"hÆ_lcd.h
"

46 
	~"hci.h
"

47 
	~"hci_é.h
"

48 
	~"l2ˇp.h
"

49 
	~"g≠.h
"

50 
	~"g©t.h
"

51 
	~"g©t_uuid.h
"

52 
	~"oßl_¢v.h
"

54 #i‡!
deföed
 ( 
GATT_DB_OFF_CHIP
 )

55 
	~"g©t£rv≠p.h
"

56 
	~"g≠g©t£rvî.h
"

58 #i‡
deföed
 ( 
GATT_TEST
 ) || deföed ( 
GATT_QUAL
 )

59 
	~"g©âe°.h
"

63 #i‡
deföed
 ( 
GAP_BOND_MGR
 )

64 
	~"g≠b⁄dmgr.h
"

67 
	~"OnBﬂrd.h
"

68 
	~"hci_ext_≠p.h
"

78 
	#HCI_EXT_RESET_EVENT
 0x0001

	)

79 
	#HCI_EXT_SOFT_RESET_EVENT
 0x0002

	)

81 
	#RESET_TIMEOUT
 100

82 

	)

83 
	#RSP_PAYLOAD_IDX
 6

	)

84 
	#MAX_RSP_DATA_LEN
 50

	)

85 
	#MAX_RSP_BUF
 ( 
RSP_PAYLOAD_IDX
 + 
MAX_RSP_DATA_LEN
 )

	)

87 #i‡!
deföed
 ( 
HCI_EXT_APP_OUT_BUF
 )

88 
	#HCI_EXT_APP_OUT_BUF
 40

	)

91 
	#KEYDIST_SENC
 0x01

	)

92 
	#KEYDIST_SID
 0x02

	)

93 
	#KEYDIST_SSIGN
 0x04

	)

94 
	#KEYDIST_MENC
 0x08

	)

95 
	#KEYDIST_MID
 0x10

	)

96 
	#KEYDIST_MSIGN
 0x20

	)

98 
	#HCI_EXT_HDR_LEN
 5

	)

101 
	#GATT_MAX_NUM_RELIABLE_WRITES
 5

	)

108 
uöt8
 
	mpktTy≥
;

109 
uöt16
 
	m›Code
;

110 
uöt8
 
	mÀn
;

111 
uöt8
 *
	mpD©a
;

112 } 
	thciExtCmd_t
;

129 
uöt8
 
	ghciExtAµ_TaskID
;

131 
uöt32
 
	ghciExtSignCou¡î
 = 0;

133 
uöt8
 
	gout_msg
[
HCI_EXT_APP_OUT_BUF
];

134 
uöt8
 
	gr•Buf
[
MAX_RSP_BUF
];

137 
uöt8
 
	gIRK
[
KEYLEN
] = {0};

138 
uöt8
 
	gSRK
[
KEYLEN
] = {0};

140 #i‡!
deföed
 ( 
GATT_DB_OFF_CHIP
 )

141 #i‡––
HOST_CONFIG
 & 
CENTRAL_CFG
 ) && ( HOST_CONFIG & 
PERIPHERAL_CFG
 ) )

142 
uöt8
 
	gdevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "TI BLE All";

143 #ñi‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

144 
uöt8
 
	gdevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "TI BLE Central";

146 
uöt8
 
	gdevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "TI BLE Peripheral";

148 
uöt16
 
	g≠≥¨™˚
 = 17;

151 #i‡
deföed
 ( 
GAP_BOND_MGR
 )

152 
uöt8
 
	ghciExtProfûeRﬁe
;

170 
uöt8
 
¥o˚ssExtMsg
–
hciPackë_t
 *
pMsg
 );

171 
uöt8
 
¥o˚ssExMsgUTIL
–uöt8 
cmdID
, 
hciExtCmd_t
 *
pCmd
, uöt8 *
pR•D©aLí
 );

172 
uöt8
 
checkNVLí
–
oßlSnvId_t
 
id
, 
oßlSnvLí_t
 
Àn
 );

173 
uöt8
 
¥o˚ssExMsgL2CAP
–uöt8 
cmdID
, 
hciExtCmd_t
 *
pCmd
 );

174 
uöt8
 
¥o˚ssExMsgATT
–uöt8 
cmdID
, 
hciExtCmd_t
 *
pCmd
 );

175 
uöt8
 
¥o˚ssExMsgGATT
–uöt8 
cmdID
, 
hciExtCmd_t
 *
pCmd
, uöt8 *
pR•D©aLí
 );

176 
uöt8
 
¥o˚ssExMsgGAP
–uöt8 
cmdID
, 
hciExtCmd_t
 *
pCmd
, uöt8 *
pR•D©aLí
 );

178 
uöt8
 
¥o˚ssEvíts
–
oßl_evít_hdr_t
 *
pMsg
 );

179 
uöt8
 *
¥o˚ssEvítsGAP
–
g≠EvítHdr_t
 *
pMsg
, uöt8 *
pOutMsg
, uöt8 *
pMsgLí
, uöt8 *
pAŒoˇãd
 );

180 
uöt8
 *
¥o˚ssEvítsL2CAP
–
l2ˇpSig«lEvít_t
 *
pPkt
, uöt8 *
pOutMsg
, uöt8 *
pMsgLí
 );

181 
uöt8
 *
¥o˚ssEvítsGATT
–
g©tMsgEvít_t
 *
pPkt
, uöt8 *
pMsg
, uöt8 *
pMsgLí
, uöt8 *
pAŒoˇãd
 );

183 #i‚de‡
GATT_DB_OFF_CHIP


184 
uöt8
 *
¥o˚ssEvítsGATTSîv
–
g©tEvítHdr_t
 *
pPkt
, uöt8 *
pMsg
, uöt8 *
pMsgLí
 );

186 
uöt8
 
addAârRec
–
g©tSîvi˚_t
 *
pSîv
, uöt8 *
pUUID
, uöt8 
Àn
,

187 
uöt8
 
≥rmissi⁄s
, 
uöt16
 *
pTŸÆAârs
, uöt8 *
pR•D©aLí
 );

188 
‰ìAârRecs
–
g©tSîvi˚_t
 *
pSîv
 );

189 c⁄° 
uöt8
 *
födUUIDRec
–uöt8 *
pUUID
, uöt8 
Àn
 );

192 
uöt8
 
buûdHCIExtHódî
–uöt8 *
pBuf
, 
uöt16
 
evít
, uöt8 
°©us
, uöt16 
c⁄nH™dÀ
 );

193 
uöt8
 
m≠ATT2BLESètus
–uöt8 
°©us
 );

209 
	$HCI_EXT_Aµ_Inô
–
uöt8
 
èsk_id
 )

211 
hciExtAµ_TaskID
 = 
èsk_id
;

213 
	`HCI_ExtTaskRegi°î
–
hciExtAµ_TaskID
 );

216 
	`GAP_Regi°îF‹HCIMsgs
–
hciExtAµ_TaskID
 );

219 
VOID
 
	`GATT_InôClõ¡
();

222 
	`GATT_Regi°îF‹Ind
–
hciExtAµ_TaskID
 );

224 #i‡!
	`deföed
 ( 
GATT_DB_OFF_CHIP
 )

226 
	`GATTSîvAµ_Regi°îF‹Msg
–
hciExtAµ_TaskID
 );

228 #i‡
	`deföed
 ( 
GATT_QUAL
 )

229 
VOID
 
	`GATTQuÆ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

232 
VOID
 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

233 
VOID
 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

234 #i‡
	`deföed
 ( 
GATT_TEST
 )

235 
VOID
 
	`GATTTe°_AddSîvi˚
–
GATT_ALL_SERVICES
 );

239 
VOID
 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
	`oßl_°æí
((*)
devi˚Name
) , deviceName );

240 
VOID
 
	`GGS_SëP¨amëî
–
GGS_APPEARANCE_ATT
, –
uöt16
 ), (*)&
≠≥¨™˚
 );

243 
	`GATT_Regi°îF‹Req
–
hciExtAµ_TaskID
 );

247 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

249 
	`HÆLcdWrôeSåög
–" TI BLEv1.3", 
HAL_LCD_LINE_1
 );

250 
	`HÆLcdWrôeSåög
–" Ho°Te°Aµ", 
HAL_LCD_LINE_2
 );

251 #i‡––
HOST_CONFIG
 & 
CENTRAL_CFG
 ) && ( HOST_CONFIG & 
PERIPHERAL_CFG
 ) )

252 
	`HÆLcdWrôeSåög
–" AŒ", 
HAL_LCD_LINE_3
 );

253 #ñi‡––
HOST_CONFIG
 & 
CENTRAL_CFG
 ) && ( HOST_CONFIG & 
BROADCASTER_CFG
 ) )

254 
	`HÆLcdWrôeSåög
–" Cít+Bˇ°", 
HAL_LCD_LINE_3
 );

255 #ñi‡––
HOST_CONFIG
 & 
PERIPHERAL_CFG
 ) && ( HOST_CONFIG & 
OBSERVER_CFG
 ) )

256 
	`HÆLcdWrôeSåög
–" Pîi+Ob£rv", 
HAL_LCD_LINE_3
 );

257 #ñi‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

258 
	`HÆLcdWrôeSåög
–" CíåÆ", 
HAL_LCD_LINE_3
 );

260 
	`HÆLcdWrôeSåög
–" PîùhîÆ", 
HAL_LCD_LINE_3
 );

265 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_IRK
, 
KEYLEN
, 
IRK
 );

266 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_CSRK
, 
KEYLEN
, 
SRK
 );

267 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
hciExtSignCou¡î
 );

268 
	}
}

283 
uöt16
 
	$HCI_EXT_Aµ_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

285 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

287 
hciPackë_t
 *
pMsg
;

289 i‡–(
pMsg
 = ( 
hciPackë_t
 *)
	`oßl_msg_ª˚ive
–
hciExtAµ_TaskID
 )Ë!
NULL
 )

291 
uöt8
 
dóŒoc
 = 
TRUE
;

294  
pMsg
->
hdr
.
evít
 )

297 
HCI_EXT_CMD_EVENT
:

298 
dóŒoc
 = 
	`¥o˚ssExtMsg
–
pMsg
 );

301 
HCI_GAP_EVENT_EVENT
:

303 i‡–
pMsg
->
hdr
.
°©us
 =
HCI_COMMAND_COMPLETE_EVENT_CODE
 )

305 
hciEvt_CmdCom∂ëe_t
 *
pkt
 = (hciEvt_CmdCom∂ëe_à*)
pMsg
;

306 
oßl_msg_hdr_t
 *
msgHdr
;

307 
uöt8
 
Àn
;

309 
msgHdr
 = (
oßl_msg_hdr_t
 *)
pMsg
;

310 
msgHdr
--;

312 
Àn
 = (
uöt8
)(
msgHdr
->À¿-  ( 
hciEvt_CmdCom∂ëe_t
 ));

314 
	`HCI_SídComm™dCom∂ëeEvít
–
HCI_COMMAND_COMPLETE_EVENT_CODE
, 
pkt
->
cmdOpcode
, 
Àn
,Ökt->
pRëu∫P¨am
 );

320 
dóŒoc
 = 
	`¥o˚ssEvíts
–(
oßl_evít_hdr_t
 *)
pMsg
 );

325 i‡–
dóŒoc
 )

327 
VOID
 
	`oßl_msg_dóŒoˇã
–(
uöt8
 *)
pMsg
 );

332  (
evíts
 ^ 
SYS_EVENT_MSG
);

335 i‡–
evíts
 & 
GAP_EVENT_SIGN_COUNTER_CHANGED
 )

338 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
hciExtSignCou¡î
 );

340  ( 
evíts
 ^ 
GAP_EVENT_SIGN_COUNTER_CHANGED
 );

343 i‡–
evíts
 & 
HCI_EXT_RESET_EVENT
 )

345 
	`Sy°emRe£t
();

351 i‡–
evíts
 & 
HCI_EXT_SOFT_RESET_EVENT
 )

353 
	`Sy°emRe£tSo·
();

356  ( 
evíts
 ^ 
HCI_EXT_SOFT_RESET_EVENT
 );

361 
	}
}

372 
uöt8
 
	$¥o˚ssExtMsg
–
hciPackë_t
 *
pMsg
 )

374 
uöt8
 
dóŒoˇãIncomög
;

375 
bSètus_t
 
°©
 = 
SUCCESS
;

376 
uöt8
 
r•D©aLí
 = 0;

377 
hciExtCmd_t
 
msg
;

378 
uöt8
 *
pBuf
 = 
pMsg
->
pD©a
;

381 
msg
.
pktTy≥
 = *
pBuf
++;

382 
msg
.
›Code
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

383 
pBuf
 += 2;

385 
msg
.
Àn
 = *
pBuf
++;

386 
msg
.
pD©a
 = 
pBuf
;

388  
msg
.
›Code
 >> 7 )

390 
HCI_EXT_L2CAP_SUBGRP
:

391 
°©
 = 
	`¥o˚ssExMsgL2CAP
–(
msg
.
›Code
 & 0x007F), &msg );

394 
HCI_EXT_ATT_SUBGRP
:

395 
°©
 = 
	`¥o˚ssExMsgATT
–(
msg
.
›Code
 & 0x007F), &msg );

398 
HCI_EXT_GATT_SUBGRP
:

399 
°©
 = 
	`¥o˚ssExMsgGATT
–(
msg
.
›Code
 & 0x007F), &msg, &
r•D©aLí
 );

402 
HCI_EXT_GAP_SUBGRP
:

403 
°©
 = 
	`¥o˚ssExMsgGAP
–(
msg
.
›Code
 & 0x007F), &msg, &
r•D©aLí
 );

406 
HCI_EXT_UTIL_SUBGRP
:

407 
°©
 = 
	`¥o˚ssExMsgUTIL
–(
msg
.
›Code
 & 0x007F), &msg, &
r•D©aLí
 );

411 
°©
 = 
FAILURE
;

416 
VOID
 
	`oßl_msg_dóŒoˇã
–(
uöt8
 *)
pMsg
 );

417 
dóŒoˇãIncomög
 = 
FALSE
;

420 
r•Buf
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_CMD_STATUS_EVENT
 );

421 
r•Buf
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_CMD_STATUS_EVENT
 );

422 
r•Buf
[2] = 
°©
;

423 
r•Buf
[3] = 
	`LO_UINT16
–0xFC00 | 
msg
.
›Code
 );

424 
r•Buf
[4] = 
	`HI_UINT16
–0xFC00 | 
msg
.
›Code
 );

425 
r•Buf
[5] = 
r•D©aLí
;

429 
	`HCI_SídC⁄åﬁÀrToHo°Evít
–
HCI_VE_EVENT_CODE
, (6 + 
r•D©aLí
), 
r•Buf
 );

431  ( 
dóŒoˇãIncomög
 );

432 
	}
}

445 
uöt8
 
	$¥o˚ssExMsgUTIL
–
uöt8
 
cmdID
, 
hciExtCmd_t
 *
pCmd
, uöt8 *
pR•D©aLí
 )

447 
uöt8
 *
pBuf
 = 
pCmd
->
pD©a
;

448 
bSètus_t
 
°©
 = 
SUCCESS
;

450 *
pR•D©aLí
 = 0;

452  
cmdID
 )

454 
HCI_EXT_UTIL_RESET
:

455 i‡–
pBuf
[0] == 0 )

457 
VOID
 
	`oßl_°¨t_timîEx
–
hciExtAµ_TaskID
, 
HCI_EXT_RESET_EVENT
, (
uöt32
)
RESET_TIMEOUT
 );

461 
VOID
 
	`oßl_°¨t_timîEx
–
hciExtAµ_TaskID
, 
HCI_EXT_SOFT_RESET_EVENT
, (
uöt32
)
RESET_TIMEOUT
 );

465 
HCI_EXT_UTIL_NV_READ
:

467 
oßlSnvId_t
 
id
 = 
pBuf
[0];

468 
oßlSnvLí_t
 
Àn
 = 
pBuf
[1];

471 i‡–(
Àn
 < 
MAX_RSP_DATA_LEN
Ë&& (
	`checkNVLí
–
id
,Üí ) =
SUCCESS
) )

473 
°©
 = 
	`oßl_¢v_ªad
–
id
, 
Àn
, &
r•Buf
[
RSP_PAYLOAD_IDX
] );

474 i‡–
°©
 =
SUCCESS
 )

476 *
pR•D©aLí
 = 
pBuf
[1];

481 
°©
 = 
INVALIDPARAMETER
;

486 
HCI_EXT_UTIL_NV_WRITE
:

488 
oßlSnvId_t
 
id
 = 
pBuf
[0];

489 
oßlSnvLí_t
 
Àn
 = 
pBuf
[1];

490 i‡–
	`checkNVLí
–
id
, 
Àn
 ) =
SUCCESS
 )

492 
°©
 = 
	`oßl_¢v_wrôe
–
id
, 
Àn
, &
pBuf
[2] );

494 i‡–
id
 =
BLE_NVID_SIGNCOUNTER
 )

496 
hciExtSignCou¡î
 = 
	`BUILD_UINT32
(
pBuf
[2],ÖBuf[3],ÖBuf[4],ÖBuf[5]);

501 
°©
 = 
INVALIDPARAMETER
;

506 
HCI_EXT_UTIL_FORCE_BOOT
:

508 
	`≠pF‹˚BoŸ
();

509 
	`≠pF‹˚BoŸ
();

512 
°©
 = 
INVALIDPARAMETER
;

517 
°©
 = 
FAILURE
;

521  ( 
°©
 );

522 
	}
}

534 
uöt8
 
	$checkNVLí
–
oßlSnvId_t
 
id
, 
oßlSnvLí_t
 
Àn
 )

536 
uöt8
 
°©
 = 
SUCCESS
;

538  
id
 )

540 
BLE_NVID_CSRK
:

541 
BLE_NVID_IRK
:

542 i‡–
Àn
 !
KEYLEN
 )

544 
°©
 = 
INVALIDPARAMETER
;

548 
BLE_NVID_SIGNCOUNTER
:

549 i‡–
Àn
 ! ( 
uöt32
 ) )

551 
°©
 = 
INVALIDPARAMETER
;

556 
°©
 = 
INVALIDPARAMETER
;

558 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

559 i‡–(
id
 >
BLE_NVID_GAP_BOND_START
Ë&& (id <
BLE_NVID_GAP_BOND_END
) )

561 
°©
 = 
	`GAPB⁄dMgr_CheckNVLí
–
id
, 
Àn
 );

567  ( 
°©
 );

568 
	}
}

579 
uöt8
 
	$¥o˚ssExMsgL2CAP
–
uöt8
 
cmdID
, 
hciExtCmd_t
 *
pCmd
 )

581 
uöt8
 *
pBuf
 = 
pCmd
->
pD©a
;

582 
uöt16
 
c⁄nH™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

583 
l2ˇpSig«lCmd_t
 
cmd
;

584 
bSètus_t
 
°©
;

586  
cmdID
 )

588 
L2CAP_PARAM_UPDATE_REQ
:

589 
°©
 = 
	`L2CAP_P¨£P¨amUpd©eReq
–&
cmd
, &
pBuf
[2], 
pCmd
->
Àn
-2 );

590 i‡–
°©
 =
SUCCESS
 )

592 
°©
 = 
	`L2CAP_C⁄nP¨amUpd©eReq
–
c⁄nH™dÀ
, &
cmd
.
upd©eReq
, 
hciExtAµ_TaskID
 );

596 
L2CAP_INFO_REQ
:

597 
°©
 = 
	`L2CAP_P¨£InfoReq
–&
cmd
, &
pBuf
[2], 
pCmd
->
Àn
-2 );

598 i‡–
°©
 =
SUCCESS
 )

600 
°©
 = 
	`L2CAP_InfoReq
–
c⁄nH™dÀ
, &
cmd
.
öfoReq
, 
hciExtAµ_TaskID
 );

605 
°©
 = 
FAILURE
;

609  ( 
°©
 );

610 
	}
}

623 
uöt8
 
	$¥o˚ssExMsgATT
–
uöt8
 
cmdID
, 
hciExtCmd_t
 *
pCmd
 )

625 
uöt8
 
numPª∑ªWrôes
 = 0;

626 
©tPª∑ªWrôeReq_t
 *
pPª∑ªWrôes
 = 
NULL
;

627 
uöt8
 *
pBuf
 = 
pCmd
->
pD©a
;

628 
uöt16
 
c⁄nH™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

629 
©tMsg_t
 
msg
;

630 
bSètus_t
 
°©
;

632  
cmdID
 )

634 
ATT_ERROR_RSP
:

635 
°©
 = 
	`ATT_P¨£Eº‹R•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

636 i‡–
°©
 =
SUCCESS
 )

638 
°©
 = 
	`ATT_Eº‹R•
–
c⁄nH™dÀ
, &
msg
.
îr‹R•
 );

642 
ATT_EXCHANGE_MTU_REQ
:

643 
°©
 = 
	`ATT_P¨£Exch™geMTUReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

644 i‡–
°©
 =
SUCCESS
 )

646 
°©
 = 
	`GATT_Exch™geMTU
–
c⁄nH™dÀ
, &
msg
.
exch™geMTUReq
, 
hciExtAµ_TaskID
 );

650 
ATT_EXCHANGE_MTU_RSP
:

651 
°©
 = 
	`ATT_P¨£Exch™geMTUR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

652 i‡–
°©
 =
SUCCESS
 )

654 
°©
 = 
	`ATT_Exch™geMTUR•
–
c⁄nH™dÀ
, &
msg
.
exch™geMTUR•
 );

658 
ATT_FIND_INFO_REQ
:

659 
°©
 = 
	`ATT_P¨£FödInfoReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

660 i‡–
°©
 =
SUCCESS
 )

662 
°©
 = 
	`GATT_DiscAŒCh¨Descs
–
c⁄nH™dÀ
, 
msg
.
födInfoReq
.
°¨tH™dÀ
,

663 
msg
.
födInfoReq
.
ídH™dÀ
, 
hciExtAµ_TaskID
 );

667 
ATT_FIND_INFO_RSP
:

668 
°©
 = 
	`ATT_P¨£FödInfoR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

669 i‡–
°©
 =
SUCCESS
 )

671 
°©
 = 
	`ATT_FödInfoR•
–
c⁄nH™dÀ
, &
msg
.
födInfoR•
 );

675 
ATT_FIND_BY_TYPE_VALUE_REQ
:

676 
°©
 = 
	`ATT_P¨£FödByTy≥VÆueReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

677 i‡–
°©
 =
SUCCESS
 )

679 
©tFödByTy≥VÆueReq_t
 *
pReq
 = &
msg
.
födByTy≥VÆueReq
;

682 i‡–
	`g©tPrim¨ySîvi˚Ty≥
–
pReq
->
ty≥
 ) &&

683 –
pReq
->
°¨tH™dÀ
 =
GATT_MIN_HANDLE
 ) &&

684 –
pReq
->
ídH™dÀ
 =
GATT_MAX_HANDLE
 ) )

687 
°©
 = 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
c⁄nH™dÀ
, 
pReq
->
vÆue
,

688 
pReq
->
Àn
, 
hciExtAµ_TaskID
 );

692 
°©
 = 
INVALIDPARAMETER
;

697 
ATT_FIND_BY_TYPE_VALUE_RSP
:

698 
°©
 = 
	`ATT_P¨£FödByTy≥VÆueR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

699 i‡–
°©
 =
SUCCESS
 )

701 
°©
 = 
	`ATT_FödByTy≥VÆueR•
–
c⁄nH™dÀ
, &
msg
.
födByTy≥VÆueR•
 );

705 
ATT_READ_BY_TYPE_REQ
:

706 
°©
 = 
	`ATT_P¨£RódByTy≥Req
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

707 i‡–
°©
 =
SUCCESS
 )

709 
©tRódByTy≥Req_t
 *
pReq
 = &
msg
.
ªadByTy≥Req
;

712 i‡–
	`g©tIn˛udeTy≥
–
pReq
->
ty≥
 ) )

715 
°©
 = 
	`GATT_FödIn˛udedSîvi˚s
–
c⁄nH™dÀ
, 
pReq
->
°¨tH™dÀ
,

716 
pReq
->
ídH™dÀ
, 
hciExtAµ_TaskID
 );

718 i‡–
	`g©tCh¨a˘îTy≥
–
pReq
->
ty≥
 ) )

721 
°©
 = 
	`GATT_DiscAŒCh¨s
–
c⁄nH™dÀ
, 
pReq
->
°¨tH™dÀ
,

722 
pReq
->
ídH™dÀ
, 
hciExtAµ_TaskID
 );

727 
°©
 = 
	`GATT_RódUsögCh¨UUID
–
c⁄nH™dÀ
, 
pReq
, 
hciExtAµ_TaskID
 );

732 
ATT_READ_BY_TYPE_RSP
:

733 
°©
 = 
	`ATT_P¨£RódByTy≥R•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

734 i‡–
°©
 =
SUCCESS
 )

736 
°©
 = 
	`ATT_RódByTy≥R•
–
c⁄nH™dÀ
, &
msg
.
ªadByTy≥R•
 );

740 
ATT_READ_REQ
:

741 
°©
 = 
	`ATT_P¨£RódReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

742 i‡–
°©
 =
SUCCESS
 )

745 
°©
 = 
	`GATT_RódCh¨VÆue
–
c⁄nH™dÀ
, &
msg
.
ªadReq
, 
hciExtAµ_TaskID
 );

749 
ATT_READ_RSP
:

750 
°©
 = 
	`ATT_P¨£RódR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

751 i‡–
°©
 =
SUCCESS
 )

753 
°©
 = 
	`ATT_RódR•
–
c⁄nH™dÀ
, &
msg
.
ªadR•
 );

757 
ATT_READ_BLOB_REQ
:

758 
°©
 = 
	`ATT_P¨£RódBlobReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

759 i‡–
°©
 =
SUCCESS
 )

762 
°©
 = 
	`GATT_RódL⁄gCh¨VÆue
–
c⁄nH™dÀ
, &
msg
.
ªadBlobReq
, 
hciExtAµ_TaskID
 );

766 
ATT_READ_BLOB_RSP
:

767 
°©
 = 
	`ATT_P¨£RódBlobR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

768 i‡–
°©
 =
SUCCESS
 )

770 
°©
 = 
	`ATT_RódBlobR•
–
c⁄nH™dÀ
, &
msg
.
ªadBlobR•
 );

774 
ATT_READ_MULTI_REQ
:

775 
°©
 = 
	`ATT_P¨£RódMu…iReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

776 i‡–
°©
 =
SUCCESS
 )

778 
°©
 = 
	`GATT_RódMu…iCh¨VÆues
–
c⁄nH™dÀ
, &
msg
.
ªadMu…iReq
, 
hciExtAµ_TaskID
 );

782 
ATT_READ_MULTI_RSP
:

783 
°©
 = 
	`ATT_P¨£RódMu…iR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

784 i‡–
°©
 =
SUCCESS
 )

786 
°©
 = 
	`ATT_RódMu…iR•
–
c⁄nH™dÀ
, &
msg
.
ªadMu…iR•
 );

790 
ATT_READ_BY_GRP_TYPE_REQ
:

791 
°©
 = 
	`ATT_P¨£RódByTy≥Req
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

792 i‡–
°©
 =
SUCCESS
 )

794 
©tRódByGΩTy≥Req_t
 *
pReq
 = &
msg
.
ªadByGΩTy≥Req
;

797 i‡–
	`g©tPrim¨ySîvi˚Ty≥
–
pReq
->
ty≥
 ) &&

798 –
pReq
->
°¨tH™dÀ
 =
GATT_MIN_HANDLE
 ) &&

799 –
pReq
->
ídH™dÀ
 =
GATT_MAX_HANDLE
 ) )

802 
°©
 = 
	`GATT_DiscAŒPrim¨ySîvi˚s
–
c⁄nH™dÀ
, 
hciExtAµ_TaskID
 );

806 
°©
 = 
INVALIDPARAMETER
;

811 
ATT_READ_BY_GRP_TYPE_RSP
:

812 
°©
 = 
	`ATT_P¨£RódByGΩTy≥R•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

813 i‡–
°©
 =
SUCCESS
 )

815 
°©
 = 
	`ATT_RódByGΩTy≥R•
–
c⁄nH™dÀ
, &
msg
.
ªadByGΩTy≥R•
 );

819 
ATT_WRITE_REQ
:

820 
°©
 = 
	`ATT_P¨£WrôeReq
–
pBuf
[2],ÖBuf[3], &pBuf[4], 
pCmd
->
Àn
-4, &
msg
 );

821 i‡–
°©
 =
SUCCESS
 )

823 
©tWrôeReq_t
 *
pReq
 = &
msg
.
wrôeReq
;

825 i‡–
pReq
->
cmd
 =
FALSE
 )

828 
°©
 = 
	`GATT_WrôeCh¨VÆue
–
c⁄nH™dÀ
, &
msg
.
wrôeReq
, 
hciExtAµ_TaskID
 );

832 i‡–
pReq
->
sig
 =
FALSE
 )

835 
°©
 = 
	`GATT_WrôeNoR•
–
c⁄nH™dÀ
, 
pReq
 );

840 
°©
 = 
	`GATT_Sig√dWrôeNoR•
–
c⁄nH™dÀ
, 
pReq
 );

846 
ATT_WRITE_RSP
:

847 
°©
 = 
	`ATT_P¨£WrôeR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

848 i‡–
°©
 =
SUCCESS
 )

850 
°©
 = 
	`ATT_WrôeR•
–
c⁄nH™dÀ
 );

854 
ATT_PREPARE_WRITE_REQ
:

855 
°©
 = 
	`ATT_P¨£Pª∑ªWrôeReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

856 i‡–
°©
 =
SUCCESS
 )

858 #i‡!
	`deföed
 ( 
GATT_DB_OFF_CHIP
 ) && deföed ( 
TESTMODES
 )

859 i‡–
	`GATTSîvAµ_GëP¨amVÆue
(Ë=
GATT_TESTMODE_PREPARE_WRITE
 )

862 
°©
 = 
	`GATT_Pª∑ªWrôeReq
–
c⁄nH™dÀ
, &
msg
.
¥ï¨eWrôeReq
, 
hciExtAµ_TaskID
 );

868 i‡–
pPª∑ªWrôes
 =
NULL
 )

871 
pPª∑ªWrôes
 = 
	`oßl_mem_Æloc
–
GATT_MAX_NUM_RELIABLE_WRITES
 * –
©tPª∑ªWrôeReq_t
 ) );

874 i‡–
pPª∑ªWrôes
 !
NULL
 )

876 i‡–
numPª∑ªWrôes
 < 
GATT_MAX_NUM_RELIABLE_WRITES
 )

879 
pPª∑ªWrôes
[
numPª∑ªWrôes
++] = 
msg
.
¥ï¨eWrôeReq
;

883 
°©
 = 
INVALIDPARAMETER
;

888 
°©
 = 
bÀMemAŒocEº‹
;

894 
ATT_PREPARE_WRITE_RSP
:

895 
°©
 = 
	`ATT_P¨£Pª∑ªWrôeR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

896 i‡–
°©
 =
SUCCESS
 )

898 
°©
 = 
	`ATT_Pª∑ªWrôeR•
–
c⁄nH™dÀ
, &
msg
.
¥ï¨eWrôeR•
 );

902 
ATT_EXECUTE_WRITE_REQ
:

903 
°©
 = 
	`ATT_P¨£ExecuãWrôeReq
–
ATT_SIG_NOT_INCLUDED
, 
TRUE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

904 i‡–
°©
 =
SUCCESS
 )

906 #i‡!
	`deföed
 ( 
GATT_DB_OFF_CHIP
 ) && deföed ( 
TESTMODES
 )

907 i‡–
	`GATTSîvAµ_GëP¨amVÆue
(Ë=
GATT_TESTMODE_PREPARE_WRITE
 )

910 
°©
 = 
	`GATT_ExecuãWrôeReq
–
c⁄nH™dÀ
, &
msg
.
execuãWrôeReq
, 
hciExtAµ_TaskID
 );

914 i‡–
pPª∑ªWrôes
 !
NULL
 )

917 
°©
 = 
	`GATT_RñübÀWrôes
–
c⁄nH™dÀ
, 
pPª∑ªWrôes
, 
numPª∑ªWrôes
,

918 
msg
.
execuãWrôeReq
.
Êags
, 
hciExtAµ_TaskID
 );

919 i‡–
°©
 !
SUCCESS
 )

921 
	`oßl_mem_‰ì
–
pPª∑ªWrôes
 );

926 
pPª∑ªWrôes
 = 
NULL
;

927 
numPª∑ªWrôes
 = 0;

931 
°©
 = 
INVALIDPARAMETER
;

936 
ATT_EXECUTE_WRITE_RSP
:

937 
°©
 = 
	`ATT_P¨£ExecuãWrôeR•
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

938 i‡–
°©
 =
SUCCESS
 )

940 
°©
 = 
	`ATT_ExecuãWrôeR•
–
c⁄nH™dÀ
 );

944 
ATT_HANDLE_VALUE_NOTI
:

945 
°©
 = 
	`ATT_P¨£H™dÀVÆueInd
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[3], 
pCmd
->
Àn
-3, &
msg
 );

946 i‡–
°©
 =
SUCCESS
 )

948 
°©
 = 
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, &
msg
.
h™dÀVÆueNŸi
, 
pBuf
[2] );

952 
ATT_HANDLE_VALUE_IND
:

953 
°©
 = 
	`ATT_P¨£H™dÀVÆueInd
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[3], 
pCmd
->
Àn
-3, &
msg
 );

954 i‡–
°©
 =
SUCCESS
 )

956 
°©
 = 
	`GATT_Indiˇti⁄
–
c⁄nH™dÀ
, &
msg
.
h™dÀVÆueInd
, 
pBuf
[2], 
hciExtAµ_TaskID
 );

960 
ATT_HANDLE_VALUE_CFM
:

961 
°©
 = 
	`ATT_P¨£H™dÀVÆueCfm
–&
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

962 i‡–
°©
 =
SUCCESS
 )

964 
°©
 = 
	`ATT_H™dÀVÆueCfm
–
c⁄nH™dÀ
 );

969 
°©
 = 
FAILURE
;

973  ( 
	`m≠ATT2BLESètus
–
°©
 ) );

974 
	}
}

988 
uöt8
 
	$¥o˚ssExMsgGATT
–
uöt8
 
cmdID
, 
hciExtCmd_t
 *
pCmd
, uöt8 *
pR•D©aLí
 )

990 #ifde‡
GATT_DB_OFF_CHIP


991 
uöt16
 
tŸÆAârs
 = 0;

992 
g©tSîvi˚_t
 
£rvi˚
 = { 0, 
NULL
 };

994 
uöt8
 *
pBuf
 = 
pCmd
->
pD©a
;

995 
uöt16
 
c⁄nH™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

996 
©tMsg_t
 
msg
;

997 
bSètus_t
 
°©
 = 
SUCCESS
;

999  
cmdID
 )

1001 
ATT_EXCHANGE_MTU_REQ
:

1002 
°©
 = 
	`ATT_P¨£Exch™geMTUReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1003 i‡–
°©
 =
SUCCESS
 )

1005 
°©
 = 
	`GATT_Exch™geMTU
–
c⁄nH™dÀ
, &
msg
.
exch™geMTUReq
, 
hciExtAµ_TaskID
 );

1009 
ATT_READ_BY_GRP_TYPE_REQ
:

1010 
°©
 = 
	`GATT_DiscAŒPrim¨ySîvi˚s
–
c⁄nH™dÀ
, 
hciExtAµ_TaskID
 );

1013 
ATT_FIND_BY_TYPE_VALUE_REQ
:

1014 
°©
 = 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
c⁄nH™dÀ
, &
pBuf
[2],

1015 
pCmd
->
Àn
-2, 
hciExtAµ_TaskID
 );

1018 
GATT_FIND_INCLUDED_SERVICES
:

1019 
GATT_DISC_ALL_CHARS
:

1020 i‡––
pCmd
->
Àn
-2 ) =
READ_BY_TYPE_REQ_FIXED_SIZE
 )

1023 
uöt16
 
°¨tH™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[2],ÖBuf[3] );

1026 
uöt16
 
ídH™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[4],ÖBuf[5] );

1028 i‡–
cmdID
 =
GATT_FIND_INCLUDED_SERVICES
 )

1030 
°©
 = 
	`GATT_FödIn˛udedSîvi˚s
–
c⁄nH™dÀ
, 
°¨tH™dÀ
,

1031 
ídH™dÀ
, 
hciExtAµ_TaskID
 );

1035 
°©
 = 
	`GATT_DiscAŒCh¨s
–
c⁄nH™dÀ
, 
°¨tH™dÀ
,

1036 
ídH™dÀ
, 
hciExtAµ_TaskID
 );

1041 
°©
 = 
ATT_ERR_INVALID_PDU
;

1045 
ATT_READ_BY_TYPE_REQ
:

1046 
°©
 = 
	`ATT_P¨£RódByTy≥Req
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1047 i‡–
°©
 =
SUCCESS
 )

1049 
°©
 = 
	`GATT_DiscCh¨sByUUID
–
c⁄nH™dÀ
, &
msg
.
ªadByTy≥Req
, 
hciExtAµ_TaskID
 );

1053 
ATT_FIND_INFO_REQ
:

1054 
°©
 = 
	`ATT_P¨£FödInfoReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1055 i‡–
°©
 =
SUCCESS
 )

1057 
°©
 = 
	`GATT_DiscAŒCh¨Descs
–
c⁄nH™dÀ
, 
msg
.
födInfoReq
.
°¨tH™dÀ
,

1058 
msg
.
födInfoReq
.
ídH™dÀ
, 
hciExtAµ_TaskID
 );

1062 
ATT_READ_REQ
:

1063 
°©
 = 
	`ATT_P¨£RódReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1064 i‡–
°©
 =
SUCCESS
 )

1066 
°©
 = 
	`GATT_RódCh¨VÆue
–
c⁄nH™dÀ
, &
msg
.
ªadReq
, 
hciExtAµ_TaskID
 );

1070 
GATT_READ_USING_CHAR_UUID
:

1071 
°©
 = 
	`ATT_P¨£RódByTy≥Req
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1072 i‡–
°©
 =
SUCCESS
 )

1074 
°©
 = 
	`GATT_RódUsögCh¨UUID
–
c⁄nH™dÀ
, &
msg
.
ªadByTy≥Req
, 
hciExtAµ_TaskID
 );

1078 
ATT_READ_BLOB_REQ
:

1079 
°©
 = 
	`ATT_P¨£RódBlobReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1080 i‡–
°©
 =
SUCCESS
 )

1082 
°©
 = 
	`GATT_RódL⁄gCh¨VÆue
–
c⁄nH™dÀ
, &
msg
.
ªadBlobReq
, 
hciExtAµ_TaskID
 );

1086 
ATT_READ_MULTI_REQ
:

1087 
°©
 = 
	`ATT_P¨£RódMu…iReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1088 i‡–
°©
 =
SUCCESS
 )

1090 
°©
 = 
	`GATT_RódMu…iCh¨VÆues
–
c⁄nH™dÀ
, &
msg
.
ªadMu…iReq
, 
hciExtAµ_TaskID
 );

1094 
GATT_WRITE_NO_RSP
:

1095 
°©
 = 
	`ATT_P¨£WrôeReq
–
FALSE
, 
TRUE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1096 i‡–
°©
 =
SUCCESS
 )

1098 
°©
 = 
	`GATT_WrôeNoR•
–
c⁄nH™dÀ
, &
msg
.
wrôeReq
 );

1102 
GATT_SIGNED_WRITE_NO_RSP
:

1103 
°©
 = 
	`ATT_P¨£WrôeReq
–
TRUE
, TRUE, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1104 i‡–
°©
 =
SUCCESS
 )

1106 
°©
 = 
	`GATT_Sig√dWrôeNoR•
–
c⁄nH™dÀ
, &
msg
.
wrôeReq
 );

1110 
ATT_WRITE_REQ
:

1111 
°©
 = 
	`ATT_P¨£WrôeReq
–
FALSE
, FALSE, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1112 i‡–
°©
 =
SUCCESS
 )

1114 
°©
 = 
	`GATT_WrôeCh¨VÆue
–
c⁄nH™dÀ
, &
msg
.
wrôeReq
, 
hciExtAµ_TaskID
 );

1118 
ATT_PREPARE_WRITE_REQ
:

1119 
GATT_WRITE_LONG_CHAR_DESC
:

1121 i‡–
pCmd
->
Àn
-2 > 
PREPARE_WRITE_REQ_FIXED_SIZE
 )

1123 
g©tPª∑ªWrôeReq_t
 
ªq
;

1126 
ªq
.
Àn
 = 
pCmd
->À¿- (2 + 
PREPARE_WRITE_REQ_FIXED_SIZE
);

1129 i‡–
ªq
.
pVÆue
 = 
	`oßl_mem_Æloc
–ªq.
Àn
 ) )

1132 
ªq
.
h™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[2],ÖBuf[3] );

1135 
ªq
.
off£t
 = 
	`BUILD_UINT16
–
pBuf
[4],ÖBuf[5] );

1138 
VOID
 
	`oßl_mem˝y
–
ªq
.
pVÆue
, &(
pBuf
[6]),Ñeq.
Àn
 );

1140 i‡–
cmdID
 =
ATT_PREPARE_WRITE_REQ
 )

1142 
°©
 = 
	`GATT_WrôeL⁄gCh¨VÆue
–
c⁄nH™dÀ
, &
ªq
, 
hciExtAµ_TaskID
 );

1146 
°©
 = 
	`GATT_WrôeL⁄gCh¨Desc
–
c⁄nH™dÀ
, &
ªq
, 
hciExtAµ_TaskID
 );

1149 i‡–
°©
 !
SUCCESS
 )

1151 
	`oßl_mem_‰ì
–
ªq
.
pVÆue
 );

1157 
°©
 = 
bÀMemAŒocEº‹
;

1162 
°©
 = 
ATT_ERR_INVALID_PDU
;

1166 
GATT_RELIABLE_WRITES
:

1167 i‡–
pCmd
->
Àn
-2 > 0 )

1169 
uöt8
 
numReqs
 = 
pBuf
[2];

1171 i‡––
numReqs
 > 0 ) && (ÇumReq†<
GATT_MAX_NUM_RELIABLE_WRITES
 ) )

1174 
©tPª∑ªWrôeReq_t
 *
pReqs
 = 
	`oßl_mem_Æloc
–
numReqs
 * (áttPrepareWriteReq_t ) );

1175 i‡–
pReqs
 !
NULL
 )

1177 
pBuf
 += 3;

1179  
uöt8
 
i
 = 0; i < 
numReqs
; i++ )

1182 
uöt8
 
ªqLí
 = 
PREPARE_WRITE_REQ_FIXED_SIZE
 + *
pBuf
++;

1184 
°©
 = 
	`ATT_P¨£Pª∑ªWrôeReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, 
pBuf
,

1185 
ªqLí
, (
©tMsg_t
 *)&(
pReqs
[
i
]) );

1186 i‡–
°©
 !
SUCCESS
 )

1192 
pBuf
 +
ªqLí
;

1195 i‡–
°©
 =
SUCCESS
 )

1198 
°©
 = 
	`GATT_RñübÀWrôes
–
c⁄nH™dÀ
, 
pReqs
, 
numReqs
,

1199 
ATT_WRITE_PREPARED_VALUES
, 
hciExtAµ_TaskID
 );

1200 i‡–
°©
 !
SUCCESS
 )

1202 
	`oßl_mem_‰ì
–
pReqs
 );

1209 
°©
 = 
bÀMemAŒocEº‹
;

1214 
°©
 = 
INVALIDPARAMETER
;

1219 
°©
 = 
ATT_ERR_INVALID_PDU
;

1223 
GATT_READ_CHAR_DESC
:

1224 
°©
 = 
	`ATT_P¨£RódReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1225 i‡–
°©
 =
SUCCESS
 )

1227 
°©
 = 
	`GATT_RódCh¨Desc
–
c⁄nH™dÀ
, &
msg
.
ªadReq
, 
hciExtAµ_TaskID
 );

1231 
GATT_READ_LONG_CHAR_DESC
:

1232 
°©
 = 
	`ATT_P¨£RódBlobReq
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1233 i‡–
°©
 =
SUCCESS
 )

1235 
°©
 = 
	`GATT_RódL⁄gCh¨Desc
–
c⁄nH™dÀ
, &
msg
.
ªadBlobReq
, 
hciExtAµ_TaskID
 );

1239 
GATT_WRITE_CHAR_DESC
:

1240 
°©
 = 
	`ATT_P¨£WrôeReq
–
FALSE
, FALSE, &
pBuf
[2], 
pCmd
->
Àn
-2, &
msg
 );

1241 i‡–
°©
 =
SUCCESS
 )

1243 
°©
 = 
	`GATT_WrôeCh¨Desc
–
c⁄nH™dÀ
, &
msg
.
wrôeReq
, 
hciExtAµ_TaskID
 );

1247 
ATT_HANDLE_VALUE_NOTI
:

1248 
°©
 = 
	`ATT_P¨£H™dÀVÆueInd
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[3], 
pCmd
->
Àn
-3, &
msg
 );

1249 i‡–
°©
 =
SUCCESS
 )

1251 
°©
 = 
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, &
msg
.
h™dÀVÆueNŸi
, 
pBuf
[2] );

1255 
ATT_HANDLE_VALUE_IND
:

1256 
°©
 = 
	`ATT_P¨£H™dÀVÆueInd
–
ATT_SIG_NOT_INCLUDED
, 
FALSE
, &
pBuf
[3], 
pCmd
->
Àn
-3, &
msg
 );

1257 i‡–
°©
 =
SUCCESS
 )

1259 
°©
 = 
	`GATT_Indiˇti⁄
–
c⁄nH™dÀ
, &
msg
.
h™dÀVÆueInd
, 
pBuf
[2], 
hciExtAµ_TaskID
 );

1263 #ifde‡
GATT_DB_OFF_CHIP


1264 
HCI_EXT_GATT_ADD_SERVICE
:

1265 i‡–
£rvi˚
.
©ås
 =
NULL
 )

1268 i‡–
pCmd
->
Àn
-2 =
ATT_BT_UUID_SIZE
 )

1270 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1271 
uöt16
 
numAârs
 = 
	`BUILD_UINT16
–
pBuf
[2],ÖBuf[3] );

1273 i‡–––
uuid
 =
GATT_PRIMARY_SERVICE_UUID
 ) ||

1274 –
uuid
 =
GATT_SECONDARY_SERVICE_UUID
 ) ) &&

1275 –
numAârs
 > 0 ) )

1278 
£rvi˚
.
©ås
 = 
	`oßl_mem_Æloc
–
numAârs
 * –
g©tAâribuã_t
 ) );

1279 i‡–
£rvi˚
.
©ås
 !
NULL
 )

1282 
VOID
 
	`oßl_mem£t
–
£rvi˚
.
©ås
, 0, 
numAârs
 * –
g©tAâribuã_t
 ) );

1284 
tŸÆAârs
 = 
numAârs
;

1287 
°©
 = 
	`addAârRec
–&
£rvi˚
, 
pBuf
, 
ATT_BT_UUID_SIZE
,

1288 
GATT_PERMIT_READ
, &
tŸÆAârs
, 
pR•D©aLí
 );

1292 
°©
 = 
bÀMemAŒocEº‹
;

1297 
°©
 = 
INVALIDPARAMETER
;

1302 
°©
 = 
ATT_ERR_INVALID_PDU
;

1307 
°©
 = 
bÀPídög
;

1311 
HCI_EXT_GATT_DEL_SERVICE
:

1313 
uöt16
 
h™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1315 i‡–
h™dÀ
 == 0x0000 )

1318 
	`‰ìAârRecs
–&
£rvi˚
 );

1320 
tŸÆAârs
 = 0;

1324 
g©tSîvi˚_t
 
£rv
;

1327 
°©
 = 
	`GATT_Dîegi°îSîvi˚
–
h™dÀ
, &
£rv
 );

1328 i‡–
°©
 =
SUCCESS
 )

1330 
	`‰ìAârRecs
–&
£rv
 );

1336 
HCI_EXT_GATT_ADD_ATTRIBUTE
:

1337 i‡–
£rvi˚
.
©ås
 !
NULL
 )

1339 i‡––
pCmd
->
Àn
-1 =
ATT_UUID_SIZE
 ) ||

1340 –
pCmd
->
Àn
-1 =
ATT_BT_UUID_SIZE
 ) )

1343 
°©
 = 
	`addAârRec
–&
£rvi˚
, 
pBuf
, 
pCmd
->
Àn
-1,

1344 
pBuf
[
pCmd
->
Àn
-1], &
tŸÆAârs
, 
pR•D©aLí
 );

1348 
°©
 = 
ATT_ERR_INVALID_PDU
;

1353 
°©
 = 
INVALIDPARAMETER
;

1359 
°©
 = 
FAILURE
;

1363  ( 
	`m≠ATT2BLESètus
–
°©
 ) );

1364 
	}
}

1378 
uöt8
 
	$¥o˚ssExMsgGAP
–
uöt8
 
cmdID
, 
hciExtCmd_t
 *
pCmd
, uöt8 *
pR•D©aLí
 )

1380 
uöt8
 *
pBuf
 = 
pCmd
->
pD©a
;

1381 
bSètus_t
 
°©
 = 
SUCCESS
;

1383  
cmdID
 )

1385 
HCI_EXT_GAP_DEVICE_INIT
:

1387 
uöt32
 
signCou¡î
;

1388 
uöt8
 
¥ofûeRﬁe
 = 
pBuf
[0];

1390 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

1391 
hciExtProfûeRﬁe
 = 
¥ofûeRﬁe
;

1396 i‡–
	`oßl_isbuf£t
–&
pBuf
[2], 0, 
KEYLEN
 ) =
FALSE
 )

1398 
VOID
 
	`oßl_mem˝y
–
IRK
, &
pBuf
[2], 
KEYLEN
 );

1401 i‡–
	`oßl_isbuf£t
–&
pBuf
[2+
KEYLEN
], 0, KEYLEN ) =
FALSE
 )

1403 
VOID
 
	`oßl_mem˝y
–
SRK
, &
pBuf
[2+
KEYLEN
], KEYLEN );

1406 
signCou¡î
 = 
	`BUILD_UINT32
–
pBuf
[2+
KEYLEN
+KEYLEN+0],ÖBuf[2+KEYLEN+KEYLEN+1],

1407 
pBuf
[2+
KEYLEN
+KEYLEN+2],ÖBuf[2+KEYLEN+KEYLEN+3] );

1408 i‡–
signCou¡î
 > 0 )

1410 
hciExtSignCou¡î
 = 
signCou¡î
;

1413 
°©
 = 
	`GAP_Devi˚Inô
–
hciExtAµ_TaskID
, 
¥ofûeRﬁe
, 
pBuf
[1], 
IRK
, 
SRK
, &
hciExtSignCou¡î
 );

1416 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_AUTH_TASK_ID
, 
hciExtAµ_TaskID
 );

1420 
HCI_EXT_GAP_CONFIG_DEVICE_ADDR
:

1422 
uöt8
 *
pSèticAddr
 = 
NULL
;

1423 
uöt8
 
nuŒAddr
[
B_ADDR_LEN
] = {0};

1425 i‡–
	`oßl_memcmp
–&
pBuf
[1], 
nuŒAddr
, 
B_ADDR_LEN
 ) !
TRUE
 )

1427 
pSèticAddr
 = &
pBuf
[1];

1430 
°©
 = 
	`GAP_C⁄figDevi˚Addr
–
pBuf
[0], 
pSèticAddr
 );

1434 #i‡–
HOST_CONFIG
 & ( 
CENTRAL_CFG
 | 
OBSERVER_CFG
 ) )

1435 
HCI_EXT_GAP_DEVICE_DISC_REQ
:

1437 
g≠DevDiscReq_t
 
discReq
;

1439 
discReq
.
èskID
 = 
hciExtAµ_TaskID
;

1440 
discReq
.
mode
 = *
pBuf
++;

1441 
discReq
.
a˘iveSˇn
 = *
pBuf
++;

1442 
discReq
.
whôeLi°
 = *
pBuf
;

1444 
°©
 = 
	`GAP_Devi˚DiscovîyReque°
–&
discReq
 );

1448 
HCI_EXT_GAP_DEVICE_DISC_CANCEL
:

1449 
°©
 = 
	`GAP_Devi˚DiscovîyC™˚l
–
hciExtAµ_TaskID
 );

1453 #i‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

1454 
HCI_EXT_GAP_EST_LINK_REQ
:

1456 
g≠E°LökReq_t
 
lökReq
;

1458 
lökReq
.
èskID
 = 
hciExtAµ_TaskID
;

1459 
lökReq
.
highDutyCy˛e
 = *
pBuf
++;

1460 
lökReq
.
whôeLi°
 = *
pBuf
++;

1461 
lökReq
.
addrTy≥Pìr
 = *
pBuf
++;

1462 
VOID
 
	`oßl_mem˝y
–
lökReq
.
≥îAddr
, 
pBuf
, 
B_ADDR_LEN
 );

1464 
°©
 = 
	`GAP_E°ablishLökReq
–&
lökReq
 );

1468 
HCI_EXT_GAP_UPDATE_LINK_PARAM_REQ
:

1470 
g≠Upd©eLökP¨amReq_t
 
upd©eLökReq
;

1472 
upd©eLökReq
.
c⁄√˘i⁄H™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1473 
pBuf
 += 2;

1474 
upd©eLökReq
.
öãrvÆMö
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1475 
pBuf
 += 2;

1476 
upd©eLökReq
.
öãrvÆMax
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1477 
pBuf
 += 2;

1478 
upd©eLökReq
.
c⁄nL©ícy
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1479 
pBuf
 += 2;

1480 
upd©eLökReq
.
c⁄nTimeout
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1482 
°©
 = 
	`GAP_Upd©eLökP¨amReq
–&
upd©eLökReq
 );

1487 
HCI_EXT_GAP_TERMINATE_LINK
:

1488 
°©
 = 
	`GAP_Tîmö©eLökReq
–
hciExtAµ_TaskID
, 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] ) );

1491 #i‡–
HOST_CONFIG
 & ( 
PERIPHERAL_CFG
 | 
BROADCASTER_CFG
 ) )

1492 
HCI_EXT_GAP_MAKE_DISCOVERABLE
:

1494 
g≠AdvîtisögP¨ams_t
 
adP¨ams
;

1496 
adP¨ams
.
evítTy≥
 = *
pBuf
++;

1497 
adP¨ams
.
öôüt‹AddrTy≥
 = *
pBuf
++;

1498 
VOID
 
	`oßl_mem˝y
–
adP¨ams
.
öôüt‹Addr
, 
pBuf
, 
B_ADDR_LEN
 );

1499 
pBuf
 +
B_ADDR_LEN
;

1500 
adP¨ams
.
ch™√lM≠
 = *
pBuf
++;

1501 
adP¨ams
.
fûãrPﬁicy
 = *
pBuf
;

1502 
°©
 = 
	`GAP_MakeDiscovîabÀ
–
hciExtAµ_TaskID
, &
adP¨ams
 );

1506 
HCI_EXT_GAP_UPDATE_ADV_DATA
:

1507 
°©
 = 
	`GAP_Upd©eAdvîtisögD©a
–
hciExtAµ_TaskID
, 
pBuf
[0],ÖBuf[1], &pBuf[2] );

1510 
HCI_EXT_GAP_END_DISC
:

1511 
°©
 = 
	`GAP_EndDiscovîabÀ
–
hciExtAµ_TaskID
 );

1515 
HCI_EXT_GAP_AUTHENTICATE
:

1517 
uöt8
 
tmp
;

1518 
g≠AuthP¨ams_t
 
∑øms
;

1519 
g≠PaúögReq_t
 
∑úReq
;

1520 
g≠PaúögReq_t
 *
pPaúReq
 = 
NULL
;

1522 #i‡–
OSALMEM_METRICS
 )

1523 
uöt16
 
memU£d
 = 
	`oßl_hóp_mem_u£d
();

1526 
VOID
 
	`oßl_mem£t
–&
∑øms
, 0,  ( 
g≠AuthP¨ams_t
 ) );

1528 
∑øms
.
c⁄√˘i⁄H™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1529 
pBuf
 += 2;

1531 
∑øms
.
£cReqs
.
ioC≠s
 = *
pBuf
++;

1532 
∑øms
.
£cReqs
.
oobAvaûabÀ
 = *
pBuf
++;

1533 
VOID
 
	`oßl_mem˝y
–
∑øms
.
£cReqs
.
oob
, 
pBuf
, 
KEYLEN
 );

1534 
pBuf
 +
KEYLEN
;

1535 
∑øms
.
£cReqs
.
authReq
 = *
pBuf
++;

1536 
∑øms
.
£cReqs
.
maxEncKeySize
 = *
pBuf
++;

1538 
tmp
 = *
pBuf
++;

1539 
∑øms
.
£cReqs
.
keyDi°
.
sEncKey
 = ( 
tmp
 & 
KEYDIST_SENC
 ) ? 
TRUE
 : 
FALSE
;

1540 
∑øms
.
£cReqs
.
keyDi°
.
sIdKey
 = ( 
tmp
 & 
KEYDIST_SID
 ) ? 
TRUE
 : 
FALSE
;

1541 
∑øms
.
£cReqs
.
keyDi°
.
sSign
 = ( 
tmp
 & 
KEYDIST_SSIGN
 ) ? 
TRUE
 : 
FALSE
;

1542 
∑øms
.
£cReqs
.
keyDi°
.
mEncKey
 = ( 
tmp
 & 
KEYDIST_MENC
 ) ? 
TRUE
 : 
FALSE
;

1543 
∑øms
.
£cReqs
.
keyDi°
.
mIdKey
 = ( 
tmp
 & 
KEYDIST_MID
 ) ? 
TRUE
 : 
FALSE
;

1544 
∑øms
.
£cReqs
.
keyDi°
.
mSign
 = ( 
tmp
 & 
KEYDIST_MSIGN
 ) ? 
TRUE
 : 
FALSE
;

1545 
∑øms
.
£cReqs
.
keyDi°
.
ª£rved
 = 0;

1547 
tmp
 = *
pBuf
++;

1548 i‡–
tmp
 )

1550 
∑úReq
.
ioC≠
 = *
pBuf
++;

1551 
∑úReq
.
oobD©aFœg
 = *
pBuf
++;

1552 
∑úReq
.
authReq
 = *
pBuf
++;

1553 
∑úReq
.
maxEncKeySize
 = *
pBuf
++;

1554 
tmp
 = *
pBuf
++;

1555 
∑úReq
.
keyDi°
.
sEncKey
 = ( 
tmp
 & 
KEYDIST_SENC
 ) ? 
TRUE
 : 
FALSE
;

1556 
∑úReq
.
keyDi°
.
sIdKey
 = ( 
tmp
 & 
KEYDIST_SID
 ) ? 
TRUE
 : 
FALSE
;

1557 
∑úReq
.
keyDi°
.
sSign
 = ( 
tmp
 & 
KEYDIST_SSIGN
 ) ? 
TRUE
 : 
FALSE
;

1558 
∑úReq
.
keyDi°
.
mEncKey
 = ( 
tmp
 & 
KEYDIST_MENC
 ) ? 
TRUE
 : 
FALSE
;

1559 
∑úReq
.
keyDi°
.
mIdKey
 = ( 
tmp
 & 
KEYDIST_MID
 ) ? 
TRUE
 : 
FALSE
;

1560 
∑úReq
.
keyDi°
.
mSign
 = ( 
tmp
 & 
KEYDIST_MSIGN
 ) ? 
TRUE
 : 
FALSE
;

1561 
∑úReq
.
keyDi°
.
ª£rved
 = 0;

1562 
pPaúReq
 = &
∑úReq
;

1565 
°©
 = 
	`GAP_Authítiˇã
–&
∑øms
, 
pPaúReq
 );

1567 #i‡–
OSALMEM_METRICS
 )

1568 *
pR•D©aLí
 = 2;

1569 
r•Buf
[
RSP_PAYLOAD_IDX
] = 
	`LO_UINT16
–
memU£d
 );

1570 
r•Buf
[
RSP_PAYLOAD_IDX
+1] = 
	`HI_UINT16
–
memU£d
 );

1575 
HCI_EXT_GAP_TERMINATE_AUTH
:

1576 
°©
 = 
	`GAP_Tîmö©eAuth
–
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] ),ÖBuf[2] );

1579 
HCI_EXT_GAP_BOND
:

1581 
uöt16
 
c⁄√˘i⁄H™dÀ
;

1582 
smSecurôyInfo_t
 
£curôyInfo
;

1583 
uöt8
 
authítiˇãd
;

1586 
c⁄√˘i⁄H™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1587 
pBuf
 += 2;

1588 
authítiˇãd
 = *
pBuf
++;

1589 
VOID
 
	`oßl_mem˝y
–
£curôyInfo
.
…k
, 
pBuf
, 
KEYLEN
 );

1590 
pBuf
 +
KEYLEN
;

1591 
£curôyInfo
.
div
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1592 
pBuf
 += 2;

1593 
VOID
 
	`oßl_mem˝y
–
£curôyInfo
.
ønd
, 
pBuf
, 
B_RANDOM_NUM_SIZE
 );

1594 
pBuf
 +
B_RANDOM_NUM_SIZE
;

1595 
£curôyInfo
.
keySize
 = *
pBuf
++;

1597 
°©
 = 
	`GAP_B⁄d
–
c⁄√˘i⁄H™dÀ
, 
authítiˇãd
, &
£curôyInfo
, 
TRUE
 );

1601 
HCI_EXT_GAP_SIGNABLE
:

1603 
uöt16
 
c⁄√˘i⁄H™dÀ
;

1604 
uöt8
 
authítiˇãd
;

1605 
smSignögInfo_t
 
signög
;

1607 
c⁄√˘i⁄H™dÀ
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1608 
pBuf
 += 2;

1610 
authítiˇãd
 = *
pBuf
++;

1612 
VOID
 
	`oßl_mem˝y
–
signög
.
§k
, 
pBuf
, 
KEYLEN
 );

1613 
pBuf
 +
KEYLEN
;

1615 
signög
.
signCou¡î
 = 
	`BUILD_UINT32
–
pBuf
[0],ÖBuf[1],ÖBuf[2],ÖBuf[3] );

1617 
°©
 = 
	`GAP_Sig«bÀ
–
c⁄√˘i⁄H™dÀ
, 
authítiˇãd
, &
signög
 );

1621 
HCI_EXT_GAP_PASSKEY_UPDATE
:

1622 
°©
 = 
	`GAP_PasskeyUpd©e
–&
pBuf
[2], 
	`BUILD_UINT16
(ÖBuf[0],ÖBuf[1] ) );

1625 
HCI_EXT_GAP_SET_PARAM
:

1627 
uöt16
 
id
 = (uöt16)
pBuf
[0];

1628 
uöt16
 
vÆue
 = 
	`BUILD_UINT16
–
pBuf
[1],ÖBuf[2] );

1630 i‡––
id
 !
TGAP_AUTH_TASK_ID
 ) && ( id < 
TGAP_PARAMID_MAX
 ) )

1632 
°©
 = 
	`GAP_SëP¨amVÆue
–
id
, 
vÆue
 );

1634 #i‡!
	`deföed
 ( 
GATT_DB_OFF_CHIP
 ) && deföed ( 
TESTMODES
 )

1635 i‡–
id
 =
TGAP_GATT_TESTCODE
 )

1637 
	`GATTSîvAµ_SëP¨amVÆue
–
vÆue
 );

1639 i‡–
id
 =
TGAP_ATT_TESTCODE
 )

1641 
	`ATT_SëP¨amVÆue
–
vÆue
 );

1643 i‡–
id
 =
TGAP_GGS_TESTCODE
 )

1645 
	`GGS_SëP¨amVÆue
–
vÆue
 );

1650 
°©
 = 
INVALIDPARAMETER
;

1655 
HCI_EXT_GAP_GET_PARAM
:

1657 
uöt16
 
∑ømVÆue
 = 0xFFFF;

1658 
uöt16
 
∑øm
 = (uöt16)
pBuf
[0];

1660 i‡–
∑øm
 < 0x00FF )

1662 i‡––
∑øm
 !
TGAP_AUTH_TASK_ID
 ) && (Ö¨am < 
TGAP_PARAMID_MAX
 ) )

1664 
∑ømVÆue
 = 
	`GAP_GëP¨amVÆue
–
∑øm
 );

1666 #i‡!
	`deföed
 ( 
GATT_DB_OFF_CHIP
 ) && deföed ( 
TESTMODES
 )

1667 i‡–
∑øm
 =
TGAP_GATT_TESTCODE
 )

1669 
∑ømVÆue
 = 
	`GATTSîvAµ_GëP¨amVÆue
();

1671 i‡–
∑øm
 =
TGAP_ATT_TESTCODE
 )

1673 
∑ømVÆue
 = 
	`ATT_GëP¨amVÆue
();

1675 i‡–
∑øm
 =
TGAP_GGS_TESTCODE
 )

1677 
∑ømVÆue
 = 
	`GGS_GëP¨amVÆue
();

1681 #i‡–
OSALMEM_METRICS
 )

1684 
∑ømVÆue
 = 
	`oßl_hóp_mem_u£d
();

1687 i‡–
∑ømVÆue
 != 0xFFFF )

1689 
°©
 = 
SUCCESS
;

1693 
°©
 = 
INVALIDPARAMETER
;

1695 *
pR•D©aLí
 = 2;

1696 
r•Buf
[
RSP_PAYLOAD_IDX
] = 
	`LO_UINT16
–
∑ømVÆue
 );

1697 
r•Buf
[
RSP_PAYLOAD_IDX
+1] = 
	`HI_UINT16
–
∑ømVÆue
 );

1701 
HCI_EXT_GAP_RESOLVE_PRIVATE_ADDR
:

1703 
°©
 = 
	`GAP_ResﬁvePriv©eAddr
–&
pBuf
[0], &pBuf[
KEYLEN
] );

1707 #i‡–
HOST_CONFIG
 & 
PERIPHERAL_CFG
 )

1708 
HCI_EXT_GAP_SLAVE_SECURITY_REQ_UPDATE
:

1709 
°©
 = 
	`GAP_SídSœveSecurôyReque°
–
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] ),ÖBuf[2] );

1713 #i‡–
HOST_CONFIG
 & ( 
PERIPHERAL_CFG
 | 
BROADCASTER_CFG
 ) )

1714 
HCI_EXT_GAP_SET_ADV_TOKEN
:

1716 
g≠AdvD©aTokí_t
 *
pTokí
;

1717 
uöt8
 
©åLí
 = 
pBuf
[1];

1719 
pTokí
 = (
g≠AdvD©aTokí_t
 *)
	`oßl_mem_Æloc
– ( g≠AdvD©aTokí_àË+ 
©åLí
 );

1720 i‡–
pTokí
 )

1722 
pTokí
->
adTy≥
 = 
pBuf
[0];

1723 
pTokí
->
©åLí
 =attrLen;

1724 
pTokí
->
pAârD©a
 = (
uöt8
 *)(pToken+1);

1726 
VOID
 
	`oßl_mem˝y
–
pTokí
->
pAârD©a
, &
pBuf
[2], 
©åLí
 );

1727 
°©
 = 
	`GAP_SëAdvTokí
–
pTokí
 );

1728 i‡–
°©
 !
SUCCESS
 )

1730 
	`oßl_mem_‰ì
–
pTokí
 );

1735 
°©
 = 
bÀMemAŒocEº‹
;

1740 
HCI_EXT_GAP_REMOVE_ADV_TOKEN
:

1742 
g≠AdvD©aTokí_t
 *
pTokí
 = 
	`GAP_RemoveAdvTokí
–
pBuf
[0] );

1743 i‡–
pTokí
 )

1745 
	`oßl_mem_‰ì
–
pTokí
 );

1746 
°©
 = 
SUCCESS
;

1750 
°©
 = 
INVALIDPARAMETER
;

1755 
HCI_EXT_GAP_UPDATE_ADV_TOKENS
:

1757 
°©
 = 
	`GAP_Upd©eAdvTokís
();

1762 
HCI_EXT_GAP_BOND_SET_PARAM
:

1764 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

1765 
uöt16
 
id
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1766 
uöt8
 *
pVÆue
;

1767 
uöt32
 
∑sscode
;

1769  
id
 )

1771 
GAPBOND_DEFAULT_PASSCODE
:

1773 
∑sscode
 = 
	`oßl_buûd_uöt32
–&
pBuf
[3],ÖBuf[2] );

1774 
pVÆue
 = (
uöt8
 *)&
∑sscode
;

1778 
pVÆue
 = &
pBuf
[3];

1782 i‡–
°©
 =
SUCCESS
 )

1784 
°©
 = 
	`GAPB⁄dMgr_SëP¨amëî
–
id
, 
pBuf
[2], 
pVÆue
 );

1787 
°©
 = 
INVALIDPARAMETER
;

1792 
HCI_EXT_GAP_BOND_GET_PARAM
:

1794 
uöt8
 
Àn
 = 0;

1795 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

1796 
uöt16
 
id
 = 
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] );

1798 
°©
 = 
	`GAPB⁄dMgr_GëP¨amëî
–
id
, &
r•Buf
[
RSP_PAYLOAD_IDX
] );

1800  
id
 )

1802 
GAPBOND_INITIATE_WAIT
:

1803 
Àn
 = 2;

1806 
GAPBOND_OOB_DATA
:

1807 
Àn
 = 
KEYLEN
;

1810 
GAPBOND_DEFAULT_PASSCODE
:

1811 
Àn
 = 4;

1815 
Àn
 = 1;

1819 
°©
 = 
INVALIDPARAMETER
;

1821 *
pR•D©aLí
 = 
Àn
;

1825 
HCI_EXT_GAP_BOND_SERVICE_CHANGE
:

1827 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

1828 
°©
 = 
	`GAPB⁄dMgr_Sîvi˚Ch™geInd
–
	`BUILD_UINT16
–
pBuf
[0],ÖBuf[1] ),ÖBuf[2] );

1830 
°©
 = 
INVALIDPARAMETER
;

1836 
°©
 = 
FAILURE
;

1840  ( 
°©
 );

1841 
	}
}

1852 
uöt8
 
	$¥o˚ssEvíts
–
oßl_evít_hdr_t
 *
pMsg
 )

1854 
uöt8
 
msgLí
 = 0;

1855 
uöt8
 *
pBuf
 = 
NULL
;

1856 
uöt8
 
Æloˇãd
 = 
FALSE
;

1857 
uöt8
 
dóŒoˇãIncomög
;

1859 
VOID
 
	`oßl_mem£t
–
out_msg
, 0,  ( out_msg ) );

1861  
pMsg
->
evít
 )

1863 
GAP_MSG_EVENT
:

1864 
pBuf
 = 
	`¥o˚ssEvítsGAP
–(
g≠EvítHdr_t
 *)
pMsg
, 
out_msg
, &
msgLí
, &
Æloˇãd
 );

1867 
L2CAP_SIGNAL_EVENT
:

1868 
pBuf
 = 
	`¥o˚ssEvítsL2CAP
–(
l2ˇpSig«lEvít_t
 *)
pMsg
, 
out_msg
, &
msgLí
 );

1871 
GATT_MSG_EVENT
:

1872 
pBuf
 = 
	`¥o˚ssEvítsGATT
–(
g©tMsgEvít_t
 *)
pMsg
, 
out_msg
, &
msgLí
, &
Æloˇãd
 );

1874 #i‚de‡
GATT_DB_OFF_CHIP


1875 
GATT_SERV_MSG_EVENT
:

1876 
pBuf
 = 
	`¥o˚ssEvítsGATTSîv
–(
g©tEvítHdr_t
 *)
pMsg
, 
out_msg
, &
msgLí
 );

1884 
VOID
 
	`oßl_msg_dóŒoˇã
–(
uöt8
 *)
pMsg
 );

1885 
dóŒoˇãIncomög
 = 
FALSE
;

1887 i‡–
msgLí
 )

1889 
	`HCI_SídC⁄åﬁÀrToHo°Evít
–
HCI_VE_EVENT_CODE
, 
msgLí
, 
pBuf
 );

1892 i‡–(
pBuf
 !
NULL
Ë&& (
Æloˇãd
 =
TRUE
) )

1894 
	`oßl_mem_‰ì
–
pBuf
 );

1897  ( 
dóŒoˇãIncomög
 );

1898 
	}
}

1912 
uöt8
 *
	$¥o˚ssEvítsGAP
–
g≠EvítHdr_t
 *
pMsg
, 
uöt8
 *
pOutMsg
, uöt8 *
pMsgLí
, uöt8 *
pAŒoˇãd
 )

1914 
uöt8
 
msgLí
 = 0;

1915 
uöt8
 *
pBuf
 = 
NULL
;

1917  
pMsg
->
›code
 )

1919 
GAP_DEVICE_INIT_DONE_EVENT
:

1921 
g≠Devi˚InôD⁄eEvít_t
 *
pPkt
 = (g≠Devi˚InôD⁄eEvít_à*)
pMsg
;

1923 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_DEVICE_INIT_DONE_EVENT
 );

1924 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_DEVICE_INIT_DONE_EVENT
 );

1925 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

1926 
VOID
 
	`oßl_mem˝y
–&
pOutMsg
[3], 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

1927 
pOutMsg
[9] = 
	`LO_UINT16
–
pPkt
->
d©aPktLí
 );

1928 
pOutMsg
[10] = 
	`HI_UINT16
–
pPkt
->
d©aPktLí
 );

1929 
pOutMsg
[11] = 
pPkt
->
numD©aPkts
;

1932 
VOID
 
	`oßl_mem˝y
–&
pOutMsg
[12], 
IRK
, 
KEYLEN
 );

1933 
VOID
 
	`oßl_mem˝y
–&
pOutMsg
[12+
KEYLEN
], 
SRK
, KEYLEN );

1935 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

1937 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_IRK
, 
KEYLEN
, 
IRK
 );

1938 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_CSRK
, 
KEYLEN
, 
SRK
 );

1939 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
hciExtSignCou¡î
 );

1942 
pBuf
 = 
pOutMsg
;

1943 
msgLí
 = 44;

1947 
GAP_DEVICE_DISCOVERY_EVENT
:

1949 
g≠DevDiscEvít_t
 *
pPkt
 = (g≠DevDiscEvít_à*)
pMsg
;

1951 i‡–(
pPkt
->
hdr
.
°©us
 =
SUCCESS
Ë&& (pPkt->
numDevs
 > 0) )

1953 
uöt8
 
x
;

1954 
g≠DevRec_t
 *
devLi°
 = 
pPkt
->
pDevLi°
;

1957 
msgLí
 = 4;

1958 
msgLí
 +(
pPkt
->
numDevs
 * 8);

1960 
pBuf
 = 
	`oßl_mem_Æloc
–
msgLí
 );

1961 i‡–
pBuf
 )

1963 
uöt8
 *
buf
 = 
pBuf
;

1966 *
buf
++ = 
	`LO_UINT16
–
HCI_EXT_GAP_DEVICE_DISCOVERY_EVENT
 );

1967 *
buf
++ = 
	`HI_UINT16
–
HCI_EXT_GAP_DEVICE_DISCOVERY_EVENT
 );

1968 *
buf
++ = 
pPkt
->
hdr
.
°©us
;

1969 *
buf
++ = 
pPkt
->
numDevs
;

1971 
devLi°
 = 
pPkt
->
pDevLi°
;

1972  
x
 = 0; x < 
pPkt
->
numDevs
; x++, 
devLi°
++ )

1974 *
buf
++ = 
devLi°
->
evítTy≥
;

1975 *
buf
++ = 
devLi°
->
addrTy≥
;

1976 
VOID
 
	`oßl_mem˝y
–
buf
, 
devLi°
->
addr
, 
B_ADDR_LEN
 );

1977 
buf
 +
B_ADDR_LEN
;

1980 *
pAŒoˇãd
 = 
TRUE
;

1984 
pPkt
->
hdr
.
°©us
 = 
bÀMemAŒocEº‹
;

1988 i‡–(
pPkt
->
hdr
.
°©us
 !
SUCCESS
Ë|| (pPkt->
numDevs
 == 0) )

1990 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_DEVICE_DISCOVERY_EVENT
 );

1991 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_DEVICE_DISCOVERY_EVENT
 );

1992 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

1993 
pOutMsg
[3] = 0;

1994 
pBuf
 = 
pOutMsg
;

1995 
msgLí
 = 4;

2000 
GAP_ADV_DATA_UPDATE_DONE_EVENT
:

2002 
g≠AdvD©aUpd©eEvít_t
 *
pPkt
 = (g≠AdvD©aUpd©eEvít_à*)
pMsg
;

2004 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_ADV_DATA_UPDATE_DONE_EVENT
 );

2005 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_ADV_DATA_UPDATE_DONE_EVENT
 );

2006 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2007 
pOutMsg
[3] = 
pPkt
->
adTy≥
;

2008 
pBuf
 = 
pOutMsg
;

2009 
msgLí
 = 4;

2013 
GAP_MAKE_DISCOVERABLE_DONE_EVENT
:

2015 
g≠MakeDiscovîabÀR•Evít_t
 *
pPkt
 = (g≠MakeDiscovîabÀR•Evít_à*)
pMsg
;

2017 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_MAKE_DISCOVERABLE_DONE_EVENT
 );

2018 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_MAKE_DISCOVERABLE_DONE_EVENT
 );

2019 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2020 
pOutMsg
[3] = 
	`LO_UINT16
–
pPkt
->
öãrvÆ
 );

2021 
pOutMsg
[4] = 
	`HI_UINT16
–
pPkt
->
öãrvÆ
 );

2022 
pBuf
 = 
pOutMsg
;

2023 
msgLí
 = 5;

2027 
GAP_END_DISCOVERABLE_DONE_EVENT
:

2028 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_END_DISCOVERABLE_DONE_EVENT
 );

2029 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_END_DISCOVERABLE_DONE_EVENT
 );

2030 
pOutMsg
[2] = 
pMsg
->
hdr
.
°©us
;

2031 
pBuf
 = 
pOutMsg
;

2032 
msgLí
 = 3;

2035 
GAP_LINK_ESTABLISHED_EVENT
:

2037 
g≠E°LökReqEvít_t
 *
pPkt
 = (g≠E°LökReqEvít_à*)
pMsg
;

2039 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2040 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

2043 
	`GAPB⁄dMgr_LökE°
–
pPkt
->
devAddrTy≥
,ÖPkt->
devAddr
,ÖPkt->
c⁄√˘i⁄H™dÀ
, 
hciExtProfûeRﬁe
 );

2047 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_LINK_ESTABLISHED_EVENT
 );

2048 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_LINK_ESTABLISHED_EVENT
 );

2049 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2050 
pOutMsg
[3] = 
pPkt
->
devAddrTy≥
;

2051 
VOID
 
	`oßl_mem˝y
–&(
pOutMsg
[4]), 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

2052 
pOutMsg
[10] = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2053 
pOutMsg
[11] = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2054 
pOutMsg
[12] = 
	`LO_UINT16
–
pPkt
->
c⁄nI¡îvÆ
 );

2055 
pOutMsg
[13] = 
	`HI_UINT16
–
pPkt
->
c⁄nI¡îvÆ
 );

2056 
pOutMsg
[14] = 
	`LO_UINT16
–
pPkt
->
c⁄nL©ícy
 );

2057 
pOutMsg
[15] = 
	`HI_UINT16
–
pPkt
->
c⁄nL©ícy
 );

2058 
pOutMsg
[16] = 
	`LO_UINT16
–
pPkt
->
c⁄nTimeout
 );

2059 
pOutMsg
[17] = 
	`HI_UINT16
–
pPkt
->
c⁄nTimeout
 );

2060 
pOutMsg
[18] = 
pPkt
->
˛ockAccuøcy
;

2061 
pBuf
 = 
pOutMsg
;

2062 
msgLí
 = 19;

2066 
GAP_LINK_TERMINATED_EVENT
:

2068 
g≠Tîmö©eLökEvít_t
 *
pPkt
 = (g≠Tîmö©eLökEvít_à*)
pMsg
;

2070 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2071 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

2074 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_LINK_TERMINATED_EVENT
 );

2075 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_LINK_TERMINATED_EVENT
 );

2076 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2077 
pOutMsg
[3] = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2078 
pOutMsg
[4] = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2079 
pOutMsg
[5] = 
pPkt
->
ªas⁄
;

2080 
pBuf
 = 
pOutMsg
;

2081 
msgLí
 = 6;

2085 
GAP_LINK_PARAM_UPDATE_EVENT
:

2087 
g≠LökUpd©eEvít_t
 *
pPkt
 = (g≠LökUpd©eEvít_à*)
pMsg
;

2089 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_LINK_PARAM_UPDATE_EVENT
 );

2090 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_LINK_PARAM_UPDATE_EVENT
 );

2091 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2092 
pOutMsg
[3] = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2093 
pOutMsg
[4] = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2094 
pOutMsg
[5] = 
	`LO_UINT16
–
pPkt
->
c⁄nI¡îvÆ
 );

2095 
pOutMsg
[6] = 
	`HI_UINT16
–
pPkt
->
c⁄nI¡îvÆ
 );

2096 
pOutMsg
[7] = 
	`LO_UINT16
–
pPkt
->
c⁄nL©ícy
 );

2097 
pOutMsg
[8] = 
	`HI_UINT16
–
pPkt
->
c⁄nL©ícy
 );

2098 
pOutMsg
[9] = 
	`LO_UINT16
–
pPkt
->
c⁄nTimeout
 );

2099 
pOutMsg
[10] = 
	`HI_UINT16
–
pPkt
->
c⁄nTimeout
 );

2100 
pBuf
 = 
pOutMsg
;

2101 
msgLí
 = 11;

2105 
GAP_RANDOM_ADDR_CHANGED_EVENT
:

2107 
g≠R™domAddrEvít_t
 *
pPkt
 = (g≠R™domAddrEvít_à*)
pMsg
;

2109 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_RANDOM_ADDR_CHANGED_EVENT
 );

2110 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_RANDOM_ADDR_CHANGED_EVENT
 );

2111 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2112 
pOutMsg
[3] = 
pPkt
->
addrTy≥
;

2113 
VOID
 
	`oßl_mem˝y
–&(
pOutMsg
[4]), 
pPkt
->
√wR™domAddr
, 
B_ADDR_LEN
 );

2114 
pBuf
 = 
pOutMsg
;

2115 
msgLí
 = 10;

2119 
GAP_SIGNATURE_UPDATED_EVENT
:

2121 
g≠SignUpd©eEvít_t
 *
pPkt
 = (g≠SignUpd©eEvít_à*)
pMsg
;

2123 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2124 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

2127 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_SIGNATURE_UPDATED_EVENT
 );

2128 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_SIGNATURE_UPDATED_EVENT
 );

2129 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2130 
pOutMsg
[3] = 
pPkt
->
addrTy≥
;

2131 
VOID
 
	`oßl_mem˝y
–&(
pOutMsg
[4]), 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

2132 
pOutMsg
[10] = 
	`BREAK_UINT32
–
pPkt
->
signCou¡î
, 0 );

2133 
pOutMsg
[11] = 
	`BREAK_UINT32
–
pPkt
->
signCou¡î
, 1 );

2134 
pOutMsg
[12] = 
	`BREAK_UINT32
–
pPkt
->
signCou¡î
, 2 );

2135 
pOutMsg
[13] = 
	`BREAK_UINT32
–
pPkt
->
signCou¡î
, 3 );

2136 
pBuf
 = 
pOutMsg
;

2137 
msgLí
 = 14;

2141 
GAP_PASSKEY_NEEDED_EVENT
:

2143 
g≠PasskeyNìdedEvít_t
 *
pPkt
 = (g≠PasskeyNìdedEvít_à*)
pMsg
;

2145 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2146 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

2148 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_PASSKEY_NEEDED_EVENT
 );

2149 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_PASSKEY_NEEDED_EVENT
 );

2150 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2151 
VOID
 
	`oßl_mem˝y
–&(
pOutMsg
[3]), 
pPkt
->
devi˚Addr
, 
B_ADDR_LEN
 );

2152 
pOutMsg
[9] = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2153 
pOutMsg
[10] = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2154 
pOutMsg
[11] = 
pPkt
->
uiI≈uts
;

2155 
pOutMsg
[12] = 
pPkt
->
uiOuçuts
;

2156 
pBuf
 = 
pOutMsg
;

2157 
msgLí
 = 13;

2161 
GAP_AUTHENTICATION_COMPLETE_EVENT
:

2163 
g≠AuthCom∂ëeEvít_t
 *
pPkt
 = (g≠AuthCom∂ëeEvít_à*)
pMsg
;

2165 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2166 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

2169 
msgLí
 = 106;

2171 
pBuf
 = 
	`oßl_mem_Æloc
–
msgLí
 );

2172 i‡–
pBuf
 )

2174 
uöt8
 *
buf
 = 
pBuf
;

2176 *
pAŒoˇãd
 = 
TRUE
;

2178 
VOID
 
	`oßl_mem£t
–
buf
, 0, 
msgLí
 );

2180 *
buf
++ = 
	`LO_UINT16
–
HCI_EXT_GAP_AUTH_COMPLETE_EVENT
 );

2181 *
buf
++ = 
	`HI_UINT16
–
HCI_EXT_GAP_AUTH_COMPLETE_EVENT
 );

2182 *
buf
++ = 
pPkt
->
hdr
.
°©us
;

2183 *
buf
++ = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2184 *
buf
++ = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2185 *
buf
++ = 
pPkt
->
authSèã
;

2187 i‡–
pPkt
->
pSecurôyInfo
 )

2189 *
buf
++ = 
TRUE
;

2190 *
buf
++ = 
pPkt
->
pSecurôyInfo
->
keySize
;

2191 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
pSecurôyInfo
->
…k
, 
KEYLEN
 );

2192 
buf
 +
KEYLEN
;

2193 *
buf
++ = 
	`LO_UINT16
–
pPkt
->
pSecurôyInfo
->
div
 );

2194 *
buf
++ = 
	`HI_UINT16
–
pPkt
->
pSecurôyInfo
->
div
 );

2195 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
pSecurôyInfo
->
ønd
, 
B_RANDOM_NUM_SIZE
 );

2196 
buf
 +
B_RANDOM_NUM_SIZE
;

2201 
buf
 +1 + 
KEYLEN
 + 
B_RANDOM_NUM_SIZE
 + 2 + 1;

2204 i‡–
pPkt
->
pDevSecInfo
 )

2206 *
buf
++ = 
TRUE
;

2207 *
buf
++ = 
pPkt
->
pDevSecInfo
->
keySize
;

2208 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
pDevSecInfo
->
…k
, 
KEYLEN
 );

2209 
buf
 +
KEYLEN
;

2210 *
buf
++ = 
	`LO_UINT16
–
pPkt
->
pDevSecInfo
->
div
 );

2211 *
buf
++ = 
	`HI_UINT16
–
pPkt
->
pDevSecInfo
->
div
 );

2212 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
pDevSecInfo
->
ønd
, 
B_RANDOM_NUM_SIZE
 );

2213 
buf
 +
B_RANDOM_NUM_SIZE
;

2218 
buf
 +1 + 
KEYLEN
 + 
B_RANDOM_NUM_SIZE
 + 2 + 1;

2221 i‡–
pPkt
->
pIdítôyInfo
 )

2223 *
buf
++ = 
TRUE
;

2224 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
pIdítôyInfo
->
úk
, 
KEYLEN
 );

2225 
buf
 +
KEYLEN
;

2226 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
pIdítôyInfo
->
bd_addr
, 
B_ADDR_LEN
 );

2227 
buf
 +
B_ADDR_LEN
;

2232 
buf
 +
KEYLEN
 + 
B_ADDR_LEN
 + 1;

2235 i‡–
pPkt
->
pSignögInfo
 )

2237 *
buf
++ = 
TRUE
;

2238 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
pSignögInfo
->
§k
, 
KEYLEN
 );

2239 
buf
 +
KEYLEN
;

2240 *
buf
++ = 
	`BREAK_UINT32
–
pPkt
->
pSignögInfo
->
signCou¡î
, 0 );

2241 *
buf
++ = 
	`BREAK_UINT32
–
pPkt
->
pSignögInfo
->
signCou¡î
, 1 );

2242 *
buf
++ = 
	`BREAK_UINT32
–
pPkt
->
pSignögInfo
->
signCou¡î
, 2 );

2243 *
buf
 = 
	`BREAK_UINT32
–
pPkt
->
pSignögInfo
->
signCou¡î
, 3 );

2248 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_AUTH_COMPLETE_EVENT
 );

2249 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_AUTH_COMPLETE_EVENT
 );

2250 
pOutMsg
[2] = 
bÀMemAŒocEº‹
;

2251 
pOutMsg
[3] = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2252 
pOutMsg
[4] = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2253 
pBuf
 = 
pOutMsg
;

2254 
msgLí
 = 5;

2259 
GAP_BOND_COMPLETE_EVENT
:

2261 
g≠B⁄dCom∂ëeEvít_t
 *
pPkt
 = (g≠B⁄dCom∂ëeEvít_à*)
pMsg
;

2263 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2264 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

2267 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_BOND_COMPLETE_EVENT
 );

2268 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_BOND_COMPLETE_EVENT
 );

2269 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2270 
pOutMsg
[3] = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2271 
pOutMsg
[4] = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2272 
pBuf
 = 
pOutMsg
;

2273 
msgLí
 = 5;

2277 
GAP_PAIRING_REQ_EVENT
:

2279 
g≠PaúögReqEvít_t
 *
pPkt
 = (g≠PaúögReqEvít_à*)
pMsg
;

2280 
uöt8
 
tmp
 = 0;

2282 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2283 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

2286 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_PAIRING_REQ_EVENT
 );

2287 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_PAIRING_REQ_EVENT
 );

2288 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2289 
pOutMsg
[3] = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2290 
pOutMsg
[4] = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2291 
pOutMsg
[5] = 
pPkt
->
∑úReq
.
ioC≠
;

2292 
pOutMsg
[6] = 
pPkt
->
∑úReq
.
oobD©aFœg
;

2293 
pOutMsg
[7] = 
pPkt
->
∑úReq
.
authReq
;

2294 
pOutMsg
[8] = 
pPkt
->
∑úReq
.
maxEncKeySize
;

2296 
tmp
 |–
pPkt
->
∑úReq
.
keyDi°
.
sEncKey
 ) ? 
KEYDIST_SENC
 : 0;

2297 
tmp
 |–
pPkt
->
∑úReq
.
keyDi°
.
sIdKey
 ) ? 
KEYDIST_SID
 : 0;

2298 
tmp
 |–
pPkt
->
∑úReq
.
keyDi°
.
sSign
 ) ? 
KEYDIST_SSIGN
 : 0;

2299 
tmp
 |–
pPkt
->
∑úReq
.
keyDi°
.
mEncKey
 ) ? 
KEYDIST_MENC
 : 0;

2300 
tmp
 |–
pPkt
->
∑úReq
.
keyDi°
.
mIdKey
 ) ? 
KEYDIST_MID
 : 0;

2301 
tmp
 |–
pPkt
->
∑úReq
.
keyDi°
.
mSign
 ) ? 
KEYDIST_MSIGN
 : 0;

2302 
pOutMsg
[9] = 
tmp
;

2304 
pBuf
 = 
pOutMsg
;

2305 
msgLí
 = 10;

2309 
GAP_SLAVE_REQUESTED_SECURITY_EVENT
:

2311 
g≠SœveSecurôyReqEvít_t
 *
pPkt
 = (g≠SœveSecurôyReqEvít_à*)
pMsg
;

2313 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2314 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

2317 
pOutMsg
[0] = 
	`LO_UINT16
–
HCI_EXT_GAP_SLAVE_REQUESTED_SECURITY_EVENT
 );

2318 
pOutMsg
[1] = 
	`HI_UINT16
–
HCI_EXT_GAP_SLAVE_REQUESTED_SECURITY_EVENT
 );

2319 
pOutMsg
[2] = 
pPkt
->
hdr
.
°©us
;

2320 
pOutMsg
[3] = 
	`LO_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2321 
pOutMsg
[4] = 
	`HI_UINT16
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

2322 
VOID
 
	`oßl_mem˝y
–&(
pOutMsg
[5]), 
pPkt
->
devi˚Addr
, 
B_ADDR_LEN
 );

2323 
pOutMsg
[11] = 
pPkt
->
authReq
;

2324 
pBuf
 = 
pOutMsg
;

2325 
msgLí
 = 12;

2329 
GAP_DEVICE_INFO_EVENT
:

2331 
g≠Devi˚InfoEvít_t
 *
pPkt
 = (g≠Devi˚InfoEvít_à*)
pMsg
;

2333 
msgLí
 = 13 + 
pPkt
->
d©aLí
;

2335 
pBuf
 = 
	`oßl_mem_Æloc
–
msgLí
 );

2336 i‡–
pBuf
 )

2338 
uöt8
 *
buf
 = 
pBuf
;

2341 *
buf
++ = 
	`LO_UINT16
–
HCI_EXT_GAP_DEVICE_INFO_EVENT
 );

2342 *
buf
++ = 
	`HI_UINT16
–
HCI_EXT_GAP_DEVICE_INFO_EVENT
 );

2343 *
buf
++ = 
pPkt
->
hdr
.
°©us
;

2344 *
buf
++ = 
pPkt
->
evítTy≥
;

2345 *
buf
++ = 
pPkt
->
addrTy≥
;

2347 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
addr
, 
B_ADDR_LEN
 );

2348 
buf
 +
B_ADDR_LEN
;

2350 *
buf
++ = (
uöt8
)
pPkt
->
rssi
;

2351 *
buf
++ = 
pPkt
->
d©aLí
;

2352 
VOID
 
	`oßl_mem˝y
–
buf
, 
pPkt
->
pEvtD©a
,ÖPkt->
d©aLí
 );

2354 *
pAŒoˇãd
 = 
TRUE
;

2358 
pPkt
->
hdr
.
°©us
 = 
bÀMemAŒocEº‹
;

2368 *
pMsgLí
 = 
msgLí
;

2370  ( 
pBuf
 );

2371 
	}
}

2384 
uöt8
 *
	$¥o˚ssEvítsL2CAP
–
l2ˇpSig«lEvít_t
 *
pPkt
, 
uöt8
 *
pOutMsg
, uöt8 *
pMsgLí
 )

2386 
uöt8
 
msgLí
;

2389 
msgLí
 = 
	`buûdHCIExtHódî
–
pOutMsg
, (
HCI_EXT_L2CAP_EVENT
 | 
pPkt
->
›code
),

2390 
pPkt
->
hdr
.
°©us
,ÖPkt->
c⁄nH™dÀ
 );

2392 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

2395  
pPkt
->
›code
 )

2397 
L2CAP_CMD_REJECT
:

2398 
msgLí
 +
	`L2CAP_BuûdCmdReje˘
–&
pOutMsg
[msgLí], (
uöt8
 *)&(
pPkt
->
cmd
.
cmdReje˘
) );

2401 
L2CAP_INFO_RSP
:

2402 
msgLí
 +
	`L2CAP_BuûdInfoR•
–&
pOutMsg
[msgLí], (
uöt8
 *)&(
pPkt
->
cmd
.
öfoR•
) );

2405 
L2CAP_PARAM_UPDATE_RSP
:

2406 
msgLí
 +
	`L2CAP_BuûdP¨amUpd©eR•
–&
pOutMsg
[msgLí], (
uöt8
 *)&(
pPkt
->
cmd
.
upd©eR•
) );

2415 *
pMsgLí
 = 
msgLí
;

2417  ( 
pOutMsg
 );

2418 
	}
}

2432 
uöt8
 *
	$¥o˚ssEvítsGATT
–
g©tMsgEvít_t
 *
pPkt
, 
uöt8
 *
pMsg
, uöt8 *
pMsgLí
, uöt8 *
pAŒoˇãd
 )

2434 
uöt8
 
hdrLí
 = 
HCI_EXT_HDR_LEN
 + 1;

2435 
uöt8
 
msgLí
 = 0;

2436 
uöt8
 *
pBuf
 = 
pMsg
;

2438 *
pAŒoˇãd
 = 
FALSE
;

2440 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

2443  
pPkt
->
mëhod
 )

2445 
ATT_ERROR_RSP
:

2446 
msgLí
 = 
	`ATT_BuûdEº‹R•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
îr‹R•
) );

2449 
ATT_EXCHANGE_MTU_REQ
:

2450 
msgLí
 = 
	`ATT_BuûdExch™geMTUReq
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
exch™geMTUReq
) );

2453 
ATT_EXCHANGE_MTU_RSP
:

2454 
msgLí
 = 
	`ATT_BuûdExch™geMTUR•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
exch™geMTUR•
) );

2457 
ATT_FIND_INFO_REQ
:

2458 
msgLí
 = 
	`ATT_BuûdFödInfoReq
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
födInfoReq
) );

2461 
ATT_FIND_INFO_RSP
:

2462 
msgLí
 = 
	`ATT_BuûdFödInfoR•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
födInfoR•
) );

2465 
ATT_FIND_BY_TYPE_VALUE_REQ
:

2466 
msgLí
 = 
	`ATT_BuûdFödByTy≥VÆueReq
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
födByTy≥VÆueReq
) );

2469 
ATT_FIND_BY_TYPE_VALUE_RSP
:

2470 
msgLí
 = 
	`ATT_BuûdFödByTy≥VÆueR•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
födByTy≥VÆueR•
) );

2473 
ATT_READ_BY_TYPE_REQ
:

2474 
msgLí
 = 
	`ATT_BuûdRódByTy≥Req
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadByTy≥Req
) );

2477 
ATT_READ_BY_TYPE_RSP
:

2478 
msgLí
 = 
	`ATT_BuûdRódByTy≥R•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadByTy≥R•
) );

2481 
ATT_READ_REQ
:

2482 
msgLí
 = 
	`ATT_BuûdRódReq
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadReq
) );

2485 
ATT_READ_RSP
:

2486 
msgLí
 = 
	`ATT_BuûdRódR•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadR•
) );

2489 
ATT_READ_BLOB_REQ
:

2490 
msgLí
 = 
	`ATT_BuûdRódBlobReq
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadBlobReq
) );

2493 
ATT_READ_BLOB_RSP
:

2494 
msgLí
 = 
	`ATT_BuûdRódBlobR•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadBlobR•
) );

2497 
ATT_READ_MULTI_REQ
:

2498 
msgLí
 = 
	`ATT_BuûdRódMu…iReq
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadMu…iReq
) );

2501 
ATT_READ_MULTI_RSP
:

2502 
msgLí
 = 
	`ATT_BuûdRódMu…iR•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadMu…iR•
) );

2505 
ATT_READ_BY_GRP_TYPE_REQ
:

2506 
msgLí
 = 
	`ATT_BuûdRódByTy≥Req
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadByGΩTy≥Req
) );

2509 
ATT_READ_BY_GRP_TYPE_RSP
:

2510 
msgLí
 = 
	`ATT_BuûdRódByGΩTy≥R•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
ªadByGΩTy≥R•
) );

2513 
ATT_WRITE_REQ
:

2514 
pMsg
[
hdrLí
] = 
pPkt
->
msg
.
wrôeReq
.
sig
;

2515 
pMsg
[
hdrLí
+1] = 
pPkt
->
msg
.
wrôeReq
.
cmd
;

2516 
msgLí
 = 2;

2517 
msgLí
 +
	`ATT_BuûdWrôeReq
–&
pMsg
[
hdrLí
+2], (
uöt8
 *)&(
pPkt
->
msg
.
wrôeReq
) );

2520 
ATT_WRITE_RSP
:

2521 
msgLí
 = 0;

2524 
ATT_PREPARE_WRITE_REQ
:

2525 
msgLí
 = 
	`ATT_BuûdPª∑ªWrôeReq
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
¥ï¨eWrôeReq
) );

2528 
ATT_PREPARE_WRITE_RSP
:

2529 
msgLí
 = 
	`ATT_BuûdPª∑ªWrôeR•
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
¥ï¨eWrôeR•
) );

2532 
ATT_EXECUTE_WRITE_REQ
:

2533 
msgLí
 = 
	`ATT_BuûdExecuãWrôeReq
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
execuãWrôeReq
) );

2536 
ATT_EXECUTE_WRITE_RSP
:

2537 
msgLí
 = 0;

2540 
ATT_HANDLE_VALUE_IND
:

2541 
ATT_HANDLE_VALUE_NOTI
:

2542 
msgLí
 = 
	`ATT_BuûdH™dÀVÆueInd
–&
pMsg
[
hdrLí
], (
uöt8
 *)&(
pPkt
->
msg
.
h™dÀVÆueInd
) );

2545 
ATT_HANDLE_VALUE_CFM
:

2546 
msgLí
 = 0;

2551 
msgLí
 = 0;

2557 
VOID
 
	`buûdHCIExtHódî
–
pBuf
, (
HCI_EXT_ATT_EVENT
 | 
pPkt
->
mëhod
),ÖPkt->
hdr
.
°©us
,ÖPkt->
c⁄nH™dÀ
 );

2560 
pBuf
[
HCI_EXT_HDR_LEN
] = 
msgLí
;

2562 *
pMsgLí
 = 
hdrLí
 + 
msgLí
;

2564  ( 
pBuf
 );

2565 
	}
}

2567 #i‚de‡
GATT_DB_OFF_CHIP


2579 
uöt8
 *
	$¥o˚ssEvítsGATTSîv
–
g©tEvítHdr_t
 *
pPkt
, 
uöt8
 *
pMsg
, uöt8 *
pMsgLí
 )

2581 
uöt8
 
hdrLí
 = 
HCI_EXT_HDR_LEN
 + 1;

2582 
uöt8
 
msgLí
 = 0;

2583 
uöt8
 *
pBuf
 = 
pMsg
;

2585 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

2588  
pPkt
->
mëhod
 )

2590 
GATT_CLIENT_CHAR_CFG_UPDATED_EVENT
:

2592 
g©tClõ¡Ch¨CfgUpd©edEvít_t
 *
pEvít
 = (g©tClõ¡Ch¨CfgUpd©edEvít_à*)
pPkt
;

2594 #i‡
	`deföed
 ( 
GAP_BOND_MGR
 )

2595 
VOID
 
	`GAPB⁄dMgr_Upd©eCh¨Cfg
–
pEvít
->
c⁄nH™dÀ
,ÖEvít->
©åH™dÀ
,ÖEvít->
vÆue
 );

2598 
pMsg
[
hdrLí
] = 
	`LO_UINT16
–
pEvít
->
©åH™dÀ
 );

2599 
pMsg
[
hdrLí
+1] = 
	`HI_UINT16
–
pEvít
->
©åH™dÀ
 );

2602 
pMsg
[
hdrLí
+2] = 
	`LO_UINT16
–
pEvít
->
vÆue
 );

2603 
pMsg
[
hdrLí
+3] = 
	`HI_UINT16
–
pEvít
->
vÆue
 );

2605 
msgLí
 = 4;

2616 
VOID
 
	`buûdHCIExtHódî
–
pBuf
, (
HCI_EXT_GATT_EVENT
 | 
pPkt
->
mëhod
),ÖPkt->
hdr
.
°©us
,ÖPkt->
c⁄nH™dÀ
 );

2619 
pBuf
[
HCI_EXT_HDR_LEN
] = 
msgLí
;

2621 *
pMsgLí
 = 
hdrLí
 + 
msgLí
;

2623  ( 
pBuf
 );

2624 
	}
}

2639 
uöt8
 
	$buûdHCIExtHódî
–
uöt8
 *
pBuf
, 
uöt16
 
evít
, uöt8 
°©us
, uöt16 
c⁄nH™dÀ
 )

2641 
pBuf
[0] = 
	`LO_UINT16
–
evít
 );

2642 
pBuf
[1] = 
	`HI_UINT16
–
evít
 );

2643 
pBuf
[2] = 
°©us
;

2644 
pBuf
[3] = 
	`LO_UINT16
–
c⁄nH™dÀ
 );

2645 
pBuf
[4] = 
	`HI_UINT16
–
c⁄nH™dÀ
 );

2647  ( 
HCI_EXT_HDR_LEN
 );

2648 
	}
}

2659 
uöt8
 
	$m≠ATT2BLESètus
–
uöt8
 
°©us
 )

2661 
uöt8
 
°©
;

2663  
°©us
 )

2665 
ATT_ERR_INVALID_PDU
:

2667 
°©
 = 
bÀInvÆidPDU
;

2670 
ATT_ERR_INSUFFICIENT_AUTHEN
:

2672 
°©
 = 
bÀInsufficõ¡Authí
;

2675 
ATT_ERR_INSUFFICIENT_ENCRYPT
:

2677 
°©
 = 
bÀInsufficõ¡En¸y±
;

2680 
ATT_ERR_INSUFFICIENT_KEY_SIZE
:

2682 
°©
 = 
bÀInsufficõ¡KeySize
;

2686 
°©
 = 
°©us
;

2689  ( 
°©
 );

2690 
	}
}

2692 #ifde‡
GATT_DB_OFF_CHIP


2707 
uöt8
 
	$addAârRec
–
g©tSîvi˚_t
 *
pSîv
, 
uöt8
 *
pUUID
, uöt8 
Àn
,

2708 
uöt8
 
≥rmissi⁄s
, 
uöt16
 *
pTŸÆAârs
, uöt8 *
pR•D©aLí
 )

2710 
g©tAâribuã_t
 *
pAâr
 = &(
pSîv
->
©ås
[pSîv->
numAârs
]);

2711 
uöt8
 
°©
 = 
SUCCESS
;

2714 
pAâr
->
ty≥
.
uuid
 = 
	`födUUIDRec
–
pUUID
, 
Àn
 );

2715 i‡–
pAâr
->
ty≥
.
uuid
 !
NULL
 )

2717 
pAâr
->
ty≥
.
Àn
 =Üen;

2718 
pAâr
->
≥rmissi⁄s
 =Öermissions;

2721 i‡–++
pSîv
->
numAârs
 =*
pTŸÆAârs
 )

2724 
°©
 = 
	`GATT_Regi°îSîvi˚
–
pSîv
 );

2725 i‡–
°©
 =
SUCCESS
 )

2727 *
pR•D©aLí
 = 4;

2730 
uöt16
 
h™dÀ
 = 
pSîv
->
©ås
[0].handle;

2731 
r•Buf
[
RSP_PAYLOAD_IDX
] = 
	`LO_UINT16
–
h™dÀ
 );

2732 
r•Buf
[
RSP_PAYLOAD_IDX
+1] = 
	`HI_UINT16
–
h™dÀ
 );

2735 
h™dÀ
 = 
pSîv
->
©ås
[pSîv->
numAârs
-1].handle;

2736 
r•Buf
[
RSP_PAYLOAD_IDX
+2] = 
	`LO_UINT16
–
h™dÀ
 );

2737 
r•Buf
[
RSP_PAYLOAD_IDX
+3] = 
	`HI_UINT16
–
h™dÀ
 );

2740 
pSîv
->
©ås
 = 
NULL
;

2741 
pSîv
->
numAârs
 = 0;

2745 
	`‰ìAârRecs
–
pSîv
 );

2749 *
pTŸÆAârs
 = 0;

2754 
°©
 = 
INVALIDPARAMETER
;

2757  ( 
°©
 );

2758 
	}
}

2770 
	$‰ìAârRecs
–
g©tSîvi˚_t
 *
pSîv
 )

2772 i‡–
pSîv
->
©ås
 !
NULL
 )

2774  
uöt8
 
i
 = 0; i < 
pSîv
->
numAârs
; i++ )

2776 
g©tAârTy≥_t
 *
pTy≥
 = &
pSîv
->
©ås
[
i
].
ty≥
;

2777 i‡–
pTy≥
->
uuid
 !
NULL
 )

2779 i‡–
	`GATT_FödUUIDRec
–(
uöt8
 *)
pTy≥
->
uuid
,ÖTy≥->
Àn
 ) =
NULL
 )

2782 
	`oßl_mem_‰ì
–(
uöt8
 *)
pTy≥
->
uuid
 );

2787 
	`oßl_mem_‰ì
–
pSîv
->
©ås
 );

2789 
pSîv
->
©ås
 = 
NULL
;

2790 
pSîv
->
numAârs
 = 0;

2792 
	}
}

2805 c⁄° 
uöt8
 *
	$födUUIDRec
–
uöt8
 *
pUUID
, uöt8 
Àn
 )

2807 c⁄° 
uöt8
 *
pUuid
 = 
	`GATT_FödUUIDRec
–
pUUID
, 
Àn
 );

2808 i‡–
pUuid
 =
NULL
 )

2811 
pUuid
 = 
	`oßl_mem_Æloc
–
Àn
 );

2812 i‡–
pUuid
 !
NULL
 )

2814 
VOID
 
	`oßl_mem˝y
–(
uöt8
 *)
pUuid
, 
pUUID
, 
Àn
 );

2818  ( 
pUuid
 );

2819 
	}
}

	@Projects/ble/HostTestApp/Source/hci_ext_app.h

39 #i‚de‡
HCI_EXT_APP_H


40 
	#HCI_EXT_APP_H


	)

42 #ifde‡
__˝lu•lus


71 
	#HCI_EXT_LL_SUBGRP
 0x00

	)

72 
	#HCI_EXT_L2CAP_SUBGRP
 0x01

	)

73 
	#HCI_EXT_ATT_SUBGRP
 0x02

	)

74 
	#HCI_EXT_GATT_SUBGRP
 0x03

	)

75 
	#HCI_EXT_GAP_SUBGRP
 0x04

	)

76 
	#HCI_EXT_UTIL_SUBGRP
 0x05

	)

77 
	#HCI_EXT_PROFILE_SUBGRP
 0x07

	)

79 
	#HCI_EXT_UTIL_RESET
 0x00

	)

80 
	#HCI_EXT_UTIL_NV_READ
 0x01

	)

81 
	#HCI_EXT_UTIL_NV_WRITE
 0x02

	)

82 
	#HCI_EXT_UTIL_FORCE_BOOT
 0x03

	)

85 
	#HCI_EXT_GAP_DEVICE_INIT
 0x00

	)

86 
	#HCI_EXT_GAP_CONFIG_DEVICE_ADDR
 0x03

	)

89 
	#HCI_EXT_GAP_DEVICE_DISC_REQ
 0x04

	)

90 
	#HCI_EXT_GAP_DEVICE_DISC_CANCEL
 0x05

	)

91 
	#HCI_EXT_GAP_MAKE_DISCOVERABLE
 0x06

	)

92 
	#HCI_EXT_GAP_UPDATE_ADV_DATA
 0x07

	)

93 
	#HCI_EXT_GAP_END_DISC
 0x08

	)

96 
	#HCI_EXT_GAP_EST_LINK_REQ
 0x09

	)

97 
	#HCI_EXT_GAP_TERMINATE_LINK
 0x0A

	)

98 
	#HCI_EXT_GAP_AUTHENTICATE
 0x0B

	)

99 
	#HCI_EXT_GAP_PASSKEY_UPDATE
 0x0C

	)

100 
	#HCI_EXT_GAP_SLAVE_SECURITY_REQ_UPDATE
 0x0D

	)

101 
	#HCI_EXT_GAP_SIGNABLE
 0x0E

	)

102 
	#HCI_EXT_GAP_BOND
 0x0F

	)

103 
	#HCI_EXT_GAP_TERMINATE_AUTH
 0x10

	)

104 
	#HCI_EXT_GAP_UPDATE_LINK_PARAM_REQ
 0x11

	)

107 
	#HCI_EXT_GAP_SET_PARAM
 0x30

	)

108 
	#HCI_EXT_GAP_GET_PARAM
 0x31

	)

109 
	#HCI_EXT_GAP_RESOLVE_PRIVATE_ADDR
 0x32

	)

110 
	#HCI_EXT_GAP_SET_ADV_TOKEN
 0x33

	)

111 
	#HCI_EXT_GAP_REMOVE_ADV_TOKEN
 0x34

	)

112 
	#HCI_EXT_GAP_UPDATE_ADV_TOKENS
 0x35

	)

113 
	#HCI_EXT_GAP_BOND_SET_PARAM
 0x36

	)

114 
	#HCI_EXT_GAP_BOND_GET_PARAM
 0x37

	)

115 
	#HCI_EXT_GAP_BOND_SERVICE_CHANGE
 0x38

	)

118 
	#GATT_FIND_INCLUDED_SERVICES
 0x30

	)

119 
	#GATT_DISC_ALL_CHARS
 0x32

	)

120 
	#GATT_READ_USING_CHAR_UUID
 0x34

	)

121 
	#GATT_WRITE_NO_RSP
 0x36

	)

122 
	#GATT_SIGNED_WRITE_NO_RSP
 0x38

	)

123 
	#GATT_RELIABLE_WRITES
 0x3a

	)

124 
	#GATT_READ_CHAR_DESC
 0x3c

	)

125 
	#GATT_READ_LONG_CHAR_DESC
 0x3e

	)

126 
	#GATT_WRITE_CHAR_DESC
 0x40

	)

127 
	#GATT_WRITE_LONG_CHAR_DESC
 0x42

	)

130 
	#HCI_EXT_GATT_ADD_SERVICE
 ( 
GATT_BASE_METHOD
 | 0x3C )

131 
	#HCI_EXT_GATT_DEL_SERVICE
 ( 
GATT_BASE_METHOD
 | 0x3D )

132 
	#HCI_EXT_GATT_ADD_ATTRIBUTE
 ( 
GATT_BASE_METHOD
 | 0x3E )

133 

	)

141 
	#HCI_EXT_BASE_EVENT
 ( 0x0001 << 10 )

142 

	)

143 
	#HCI_EXT_LL_EVENT
 ( 
HCI_EXT_BASE_EVENT
 | (
HCI_EXT_LL_SUBGRP
 << 7) )

144 
	#HCI_EXT_L2CAP_EVENT
 ( 
HCI_EXT_BASE_EVENT
 | (
HCI_EXT_L2CAP_SUBGRP
 << 7) )

145 
	#HCI_EXT_ATT_EVENT
 ( 
HCI_EXT_BASE_EVENT
 | (
HCI_EXT_ATT_SUBGRP
 << 7) )

146 
	#HCI_EXT_GATT_EVENT
 ( 
HCI_EXT_BASE_EVENT
 | (
HCI_EXT_GATT_SUBGRP
 << 7) )

147 
	#HCI_EXT_GAP_EVENT
 ( 
HCI_EXT_BASE_EVENT
 | (
HCI_EXT_GAP_SUBGRP
 << 7) )

148 

	)

150 
	#HCI_EXT_GAP_DEVICE_INIT_DONE_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x00 )

	)

151 
	#HCI_EXT_GAP_DEVICE_DISCOVERY_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x01 )

	)

152 
	#HCI_EXT_GAP_ADV_DATA_UPDATE_DONE_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x02 )

	)

153 
	#HCI_EXT_GAP_MAKE_DISCOVERABLE_DONE_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x03 )

	)

154 
	#HCI_EXT_GAP_END_DISCOVERABLE_DONE_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x04 )

	)

155 
	#HCI_EXT_GAP_LINK_ESTABLISHED_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x05 )

	)

156 
	#HCI_EXT_GAP_LINK_TERMINATED_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x06 )

	)

157 
	#HCI_EXT_GAP_LINK_PARAM_UPDATE_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x07 )

	)

158 
	#HCI_EXT_GAP_RANDOM_ADDR_CHANGED_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x08 )

	)

159 
	#HCI_EXT_GAP_SIGNATURE_UPDATED_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x09 )

	)

160 
	#HCI_EXT_GAP_AUTH_COMPLETE_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x0A )

	)

161 
	#HCI_EXT_GAP_PASSKEY_NEEDED_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x0B )

	)

162 
	#HCI_EXT_GAP_SLAVE_REQUESTED_SECURITY_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x0C )

	)

163 
	#HCI_EXT_GAP_DEVICE_INFO_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x0D )

	)

164 
	#HCI_EXT_GAP_BOND_COMPLETE_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x0E )

	)

165 
	#HCI_EXT_GAP_PAIRING_REQ_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x0F )

	)

167 
	#HCI_EXT_GAP_CMD_STATUS_EVENT
 ( 
HCI_EXT_GAP_EVENT
 | 0x7F )

	)

180 
HCI_EXT_Aµ_Inô
–
uöt8
 
èsk_id
 );

185 
uöt16
 
HCI_EXT_Aµ_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

190 #ifde‡
__˝lu•lus


	@Projects/ble/Include/gapgattserver.h

41 #i‚de‡
GAPGATTSERVER_H


42 
	#GAPGATTSERVER_H


	)

44 #ifde‡
__˝lu•lus


57 
	#GAP_DEVICE_NAME_LEN
 (20+1)

	)

60 
	#GAP_PRIVACY_DISABLED
 0x00

	)

61 
	#GAP_PRIVACY_ENABLED
 0x01

	)

64 
	#GGS_DEVICE_NAME_ATT
 0

65 
	#GGS_APPEARANCE_ATT
 1

66 
	#GGS_PERI_PRIVACY_FLAG_ATT
 2

67 
	#GGS_RECONNCT_ADDR_ATT
 3

68 
	#GGS_PERI_CONN_PARAM_ATT
 4

69 
	#GGS_PERI_PRIVACY_FLAG_PROPS
 5

70 
	#GGS_W_PERMIT_DEVICE_NAME_ATT
 6

71 
	#GGS_W_PERMIT_APPEARANCE_ATT
 7

72 
	#GGS_W_PERMIT_PRIVACY_FLAG_ATT
 8

73 

	)

75 
	#GAP_SERVICE
 0x00000001

	)

78 
	#GGS_DEVICE_NAME_ID
 0

	)

79 
	#GGS_APPEARANCE_ID
 1

	)

81 #i‡
deföed
 ( 
TESTMODES
 )

83 
	#GGS_TESTMODE_OFF
 0

84 
	#GGS_TESTMODE_W_PERMIT_DEVICE_NAME
 1

85 
	#GGS_TESTMODE_W_PERMIT_APPEARANCE
 2

86 
	#GGS_TESTMODE_W_PERMIT_PRIVACY_FLAG
 3

88 

	)

93 (*
ggsAârVÆueCh™ge_t
)–
	tuöt8
 
	t©åId
 );

98 
ggsAârVÆueCh™ge_t
 
p‚AârVÆueCh™ge
;

99 } 
	tggsAµCBs_t
;

125 
bSètus_t
 
GGS_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

138 
bSètus_t
 
GGS_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

151 
bSètus_t
 
GGS_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

162 
bSètus_t
 
GGS_DñSîvi˚
–
uöt32
 
£rvi˚s
 );

176 
GGS_Regi°îAµCBs
–
ggsAµCBs_t
 *
≠pCÆlbacks
 );

186 
GGS_SëP¨amVÆue
–
uöt16
 
vÆue
 );

195 
uöt16
 
GGS_GëP¨amVÆue
( );

204 #ifde‡
__˝lu•lus


	@Projects/ble/Include/gattservapp.h

81 #i‚de‡
GATTSERVAPP_H


82 
	#GATTSERVAPP_H


	)

84 #ifde‡
__˝lu•lus


92 
	~"bcomdef.h
"

93 
	~"OSAL.h
"

103 
	#GATT_CLIENT_CHAR_CFG_UPDATED_EVENT
 0x00

104 

	)

112 
	#GATT_PROP_BCAST
 0x01

113 
	#GATT_PROP_READ
 0x02

114 
	#GATT_PROP_WRITE_NO_RSP
 0x04

115 
	#GATT_PROP_WRITE
 0x08

116 
	#GATT_PROP_NOTIFY
 0x10

117 
	#GATT_PROP_INDICATE
 0x20

118 
	#GATT_PROP_AUTHEN
 0x40

119 
	#GATT_PROP_EXTENDED
 0x80

120 

	)

127 
	#GATT_EXT_PROP_RELIABLE_WRITE
 0x0001

128 
	#GATT_EXT_PROP_WRITABLE_AUX
 0x0002

129 

	)

136 
	#GATT_CLIENT_CFG_NOTIFY
 0x0001

137 
	#GATT_CLIENT_CFG_INDICATE
 0x0002

138 

	)

145 
	#GATT_SERV_CFG_BCAST
 0x0001

146 

	)

149 
	#GATT_CFG_NO_OPERATION
 0x0000

150 

	)

155 
	#GATT_FORMAT_BOOL
 0x01

156 
	#GATT_FORMAT_2BIT
 0x02

157 
	#GATT_FORMAT_NIBBLE
 0x03

158 
	#GATT_FORMAT_UINT8
 0x04

159 
	#GATT_FORMAT_UINT12
 0x05

160 
	#GATT_FORMAT_UINT16
 0x06

161 
	#GATT_FORMAT_UINT24
 0x07

162 
	#GATT_FORMAT_UINT32
 0x08

163 
	#GATT_FORMAT_UINT48
 0x09

164 
	#GATT_FORMAT_UINT64
 0x0a

165 
	#GATT_FORMAT_UINT128
 0x0b

166 
	#GATT_FORMAT_SINT8
 0x0c

167 
	#GATT_FORMAT_SINT12
 0x0d

168 
	#GATT_FORMAT_SINT16
 0x0e

169 
	#GATT_FORMAT_SINT24
 0x0f

170 
	#GATT_FORMAT_SINT32
 0x10

171 
	#GATT_FORMAT_SINT48
 0x11

172 
	#GATT_FORMAT_SINT64
 0x12

173 
	#GATT_FORMAT_SINT128
 0x13

174 
	#GATT_FORMAT_FLOAT32
 0x14

175 
	#GATT_FORMAT_FLOAT64
 0x15

176 
	#GATT_FORMAT_SFLOAT
 0x16

177 
	#GATT_FORMAT_FLOAT
 0x17

178 
	#GATT_FORMAT_DUINT16
 0x18

179 
	#GATT_FORMAT_UTF8S
 0x19

180 
	#GATT_FORMAT_UTF16S
 0x1a

181 
	#GATT_FORMAT_STRUCT
 0x1b

182 

	)

189 
	#GATT_NS_NONE
 0x00

190 
	#GATT_NS_BT_SIG
 0x01

191 

	)

198 
	#GATT_NS_BT_DESC_UNKNOWN
 0x0000

199 

	)

203 
	#GATT_ALL_SERVICES
 0xFFFFFFFF

	)

206 
	#GATT_SERVICE
 0x00000001

	)

208 #i‡
deföed
 ( 
TESTMODES
 )

210 
	#GATT_TESTMODE_OFF
 0

211 
	#GATT_TESTMODE_NO_RSP
 1

212 
	#GATT_TESTMODE_PREPARE_WRITE
 2

213 
	#GATT_TESTMODE_MAX_MTU_SIZE
 3

214 
	#GATT_TESTMODE_CORRUPT_PW_DATA
 4

216 

	)

218 
	#GATT_PARAM_NUM_PREPARE_WRITES
 0

219 

	)

229 
	#GATT_NUM_ATTRS
–
©ås
 ) ( –©å†Ë/ –
g©tAâribuã_t
 ) )

	)

232 
	#GATT_SERVICE_HANDLE
–
©ås
 ) ( (©ås)[0].
h™dÀ
 )

	)

235 
	#GATT_INCLUDED_HANDLE
–
©ås
, 
i
 ) ( *((
uöt16
 *)(◊ârs)[(i)].
pVÆue
)Ë)

	)

260 
bSètus_t
 (*
	tp‚GATTRódAârCB_t
)–
	tuöt16
 
	tc⁄nH™dÀ
, 
	tg©tAâribuã_t
 *
	tpAâr
,

261 
	tuöt8
 *
	tpVÆue
, uöt8 *
	tpLí
, 
	tuöt16
 
	toff£t
,

262 
	tuöt8
 
	tmaxLí
 );

275 
bSètus_t
 (*
	tp‚GATTWrôeAârCB_t
)–
	tuöt16
 
	tc⁄nH™dÀ
, 
	tg©tAâribuã_t
 *
	tpAâr
,

276 
	tuöt8
 *
	tpVÆue
, uöt8 
	tÀn
, 
	tuöt16
 
	toff£t
 );

288 
bSètus_t
 (*
	tp‚GATTAuth‹izeAârCB_t
)–
	tuöt16
 
	tc⁄nH™dÀ
, 
	tg©tAâribuã_t
 *
	tpAâr
,

289 
	tuöt8
 
	t›code
 );

299 
uöt8
 
f‹m©
;

300 
uöt8
 
exp⁄ít
;

301 
uöt16
 
unô
;

302 
uöt8
 
«meS∑˚
;

303 
uöt16
 
desc
;

304 } 
	tg©tCh¨F‹m©_t
;

311 
uöt16
 
c⁄nH™dÀ
;

312 
uöt8
 
vÆue
;

313 } 
	tg©tCh¨Cfg_t
;

321 
p‚GATTRódAârCB_t
 
p‚RódAârCB
;

322 
p‚GATTWrôeAârCB_t
 
p‚WrôeAârCB
;

323 
p‚GATTAuth‹izeAârCB_t
 
p‚Auth‹izeAârCB
;

324 } 
	tg©tSîvi˚CBs_t
;

331 
oßl_evít_hdr_t
 
hdr
;

332 
uöt16
 
c⁄nH™dÀ
;

333 
uöt8
 
mëhod
;

334 } 
	tg©tEvítHdr_t
;

342 
oßl_evít_hdr_t
 
hdr
;

343 
uöt16
 
c⁄nH™dÀ
;

344 
uöt8
 
mëhod
;

345 
uöt16
 
©åH™dÀ
;

346 
uöt16
 
vÆue
;

347 } 
	tg©tClõ¡Ch¨CfgUpd©edEvít_t
;

372 
GATTSîvAµ_Regi°îF‹Msg
–
uöt8
 
èskID
 );

387 
bSètus_t
 
GATTSîvAµ_Regi°îSîvi˚
–
g©tAâribuã_t
 *
pAârs
, 
uöt16
 
numAârs
,

388 
CONST
 
g©tSîvi˚CBs_t
 *
pSîvi˚CBs
 );

402 
bSètus_t
 
GATTSîvAµ_Dîegi°îSîvi˚
–
uöt16
 
h™dÀ
, 
g©tAâribuã_t
 **
p2pAârs
 );

414 
g©tAâribuã_t
 *
GATTSîvAµ_FödAâr
–g©tAâribuã_à*
pAârTbl
,

415 
uöt16
 
numAârs
, 
uöt8
 *
pVÆue
 );

427 
bSètus_t
 
GATTSîvAµ_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

438 
bSètus_t
 
GATTSîvAµ_DñSîvi˚
–
uöt32
 
£rvi˚s
 );

456 
bSètus_t
 
GATTSîvAµ_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
pVÆue
 );

470 
bSètus_t
 
GATTSîvAµ_GëP¨amëî
–
uöt8
 
∑øm
, *
pVÆue
 );

485 
bSètus_t
 
GATTSîvAµ_Upd©eCh¨Cfg
–
uöt16
 
c⁄nH™dÀ
, uöt16 
©åH™dÀ
, uöt16 
vÆue
 );

500 
GATTSîvAµ_InôCh¨Cfg
–
uöt16
 
c⁄nH™dÀ
, 
g©tCh¨Cfg_t
 *
ch¨CfgTbl
 );

516 
uöt16
 
GATTSîvAµ_RódCh¨Cfg
–uöt16 
c⁄nH™dÀ
, 
g©tCh¨Cfg_t
 *
ch¨CfgTbl
 );

533 
uöt8
 
GATTSîvAµ_WrôeCh¨Cfg
–
uöt16
 
c⁄nH™dÀ
, 
g©tCh¨Cfg_t
 *
ch¨CfgTbl
, uöt16 
vÆue
 );

548 
bSètus_t
 
GATTSîvAµ_Pro˚ssCCCWrôeReq
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

549 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
,

550 
uöt16
 
vÆidCfg
 );

564 
bSètus_t
 
GATTSîvAµ_Pro˚ssCh¨Cfg
–
g©tCh¨Cfg_t
 *
ch¨CfgTbl
, 
uöt8
 *
pVÆue
,

565 
uöt8
 
authítiˇãd
, 
g©tAâribuã_t
 *
©åTbl
,

566 
uöt16
 
numAârs
, 
uöt8
 
èskId
 );

578 
GATTSîvAµ_SídCCCUpd©edEvít
–
uöt16
 
c⁄nH™dÀ
, uöt16 
©åH™dÀ
, uöt16 
vÆue
 );

593 
bSètus_t
 
GATTSîvAµ_SídSîvi˚Ch™gedInd
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
èskId
 );

610 
uöt8
 
GATTSîvAµ_RódAâr
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

611 
uöt16
 
£rvi˚
, 
uöt8
 *
pVÆue
, uöt8 *
pLí
,

612 
uöt16
 
off£t
, 
uöt8
 
maxLí
 );

625 
uöt8
 
GATTSîvAµ_WrôeAâr
–
uöt16
 
c⁄nH™dÀ
, uöt16 
h™dÀ
,

626 
uöt8
 *
pVÆue
, 
uöt16
 
Àn
, uöt16 
off£t
 );

640 
GATTSîvAµ_SëP¨amVÆue
–
uöt16
 
vÆue
 );

649 
uöt16
 
GATTSîvAµ_GëP¨amVÆue
( );

665 
GATTSîvAµ_Inô
–
uöt8
 
èskId
 );

680 
uöt16
 
GATTSîvAµ_Pro˚ssEvít
–
uöt8
 
èskId
, uöt16 
evíts
 );

686 #ifde‡
__˝lu•lus


	@Projects/ble/KeyFob/Source/KeyFob_Main.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"hÆ_key.h
"

46 
	~"hÆ_timî.h
"

47 
	~"hÆ_drivîs.h
"

48 
	~"hÆ_Àd.h
"

51 
	~"OSAL.h
"

52 
	~"OSAL_Tasks.h
"

53 
	~"OSAL_PwrMgr.h
"

54 
	~"oßl_¢v.h
"

55 
	~"OnBﬂrd.h
"

62 
MSA_Maö_KeyCÆlback
(
uöt8
 
keys
, uöt8 
°©e
);

74 
	$maö
()

77 
	`HAL_BOARD_INIT
();

80 
	`InôBﬂrd
–
OB_COLD
 );

83 
	`HÆDrivîInô
();

86 
	`oßl_¢v_öô
();

91 
	`oßl_öô_sy°em
();

94 
	`HAL_ENABLE_INTERRUPTS
();

97 
	`InôBﬂrd
–
OB_READY
 );

99 #i‡
	`deföed
 ( 
POWER_SAVING
 )

100 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

104 
	`oßl_°¨t_sy°em
();

107 
	}
}

	@Projects/ble/KeyFob/Source/OSAL_KeyFobDemo.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

75 
	~"≥rùhîÆBrﬂdˇ°î.h
"

77 
	~"≥rùhîÆ.h
"

81 
	~"keyfobdemo.h
"

88 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

90 
LL_Pro˚ssEvít
,

91 
HÆ_Pro˚ssEvít
,

92 
HCI_Pro˚ssEvít
,

93 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

94 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

96 
L2CAP_Pro˚ssEvít
,

97 
GAP_Pro˚ssEvít
,

98 
GATT_Pro˚ssEvít
,

99 
SM_Pro˚ssEvít
,

100 
GAPRﬁe_Pro˚ssEvít
,

101 
GAPB⁄dMgr_Pro˚ssEvít
,

102 
GATTSîvAµ_Pro˚ssEvít
,

103 
KeyFobAµ_Pro˚ssEvít


106 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

107 
uöt16
 *
	gèsksEvíts
;

122 
	$oßlInôTasks
( )

124 
uöt8
 
èskID
 = 0;

126 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

127 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

130 
	`LL_Inô
–
èskID
++ );

133 
	`HÆ_Inô
–
èskID
++ );

136 
	`HCI_Inô
–
èskID
++ );

138 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

140 
	`oßl_CbTimîInô
–
èskID
 );

141 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

145 
	`L2CAP_Inô
–
èskID
++ );

148 
	`GAP_Inô
–
èskID
++ );

151 
	`GATT_Inô
–
èskID
++ );

154 
	`SM_Inô
–
èskID
++ );

157 
	`GAPRﬁe_Inô
–
èskID
++ );

158 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

160 
	`GATTSîvAµ_Inô
–
èskID
++ );

163 
	`KeyFobAµ_Inô
–
èskID
 );

164 
	}
}

	@Projects/ble/KeyFob/Source/bma250.c

13 
	~<ioCC2541.h
>

14 
	~"bma250.h
"

28 
	#CS
 
P1_2


	)

29 
	#SCK
 
P1_3


	)

30 
	#MISO
 
P1_4


	)

31 
	#MOSI
 
P1_5


	)

33 
	#CS_DISABLED
 1

	)

34 
	#CS_ENABLED
 0

	)

37 
	#ACC_INT_ENABLE
(
ªg
, 
bm
Ë{ 
uöt8
 
vÆ
; 
	`accRódReg
((reg),&val); \

38 
vÆ
 |(
bm
); 
	`accWrôeReg
((
ªg
),vÆ); }

	)

40 
	#ACC_INT_DISABLE
(
ªg
, 
bm
Ë{ 
uöt8
 
vÆ
; 
	`accRódReg
((reg),&val); \

41 
vÆ
 &~(
bm
); 
	`accWrôeReg
((
ªg
),vÆ); }

	)

47 
•iWrôeByã
(
uöt8
 
wrôe
);

48 
•iRódByã
(
uöt8
 *
ªad
, uöt8 
wrôe
);

53 
uöt8
 
	gacc_öôülized
 = 
FALSE
;

67 
	$accInô
()

70 
P2DIR
 |= 0x01;

71 
P2SEL
 &= ~0x01;

72 
P2
 |= 0x01;

76 
PERCFG
 |= 0x01;

78 
P1SEL
 |= 0x38;

80 
P1DIR
 |= 0x04;

81 
CS
 = 
CS_DISABLED
;

85 
U0CSR
 = 0x00;

89 
U0GCR
 = 0x20;

91 
U0GCR
 |= 0x10;

92 
U0BAUD
 = 0x80;

96 
	`WAIT_MS
(2);

99 
	`ACC_INT_DISABLE
(
ACC_INT_ENABLE0
, 0xFF);

100 
	`ACC_INT_DISABLE
(
ACC_INT_ENABLE1
, 0xFF);

103 
	`accWrôeReg
(
ACC_RANGE
, 
ACC_RANGE_2G
);

106 
	`accWrôeReg
(
ACC_BW
, 
ACC_BW_250HZ
);

109 #ifde‡
ENABLE_BMA250_INTERRUPT


112 
	`accWrôeReg
(
ACC_INT_PIN_BEHAVIOR
, 
ACC_INT1_LVL
);

115 
	`accWrôeReg
(
ACC_INT_MAPPING1
, 
ACC_INT1_MAP_DATA
);

118 
	`ACC_INT_ENABLE
(
ACC_INT_ENABLE1
, 
ACC_INT_DATA_EN
);

121 
acc_öôülized
 = 
TRUE
;

122 
	}
}

132 
	$accSt›
()

134 i‡(
acc_öôülized
) {

136 
P2_0
 = 0x00;

137 
acc_öôülized
 = 
FALSE
;

139 
	}
}

151 
	$accWrôeReg
(
uöt8
 
ªg
, uöt8 
vÆ
)

153 
CS
 = 
CS_ENABLED
;

154 
	`•iWrôeByã
(
ªg
);

155 
	`•iWrôeByã
(
vÆ
);

156 
CS
 = 
CS_DISABLED
;

157 
	}
}

170 
	$accRódReg
(
uöt8
 
ªg
, uöt8 *
pVÆ
)

172 
CS
 = 
CS_ENABLED
;

173 
	`•iWrôeByã
(0x80|
ªg
);

174 
	`•iRódByã
(
pVÆ
, 0xFF);

175 
CS
 = 
CS_DISABLED
;

176 
	}
}

190 
	$accRódAcc
(
öt8
 *
pXVÆ
, i¡8 *
pYVÆ
, i¡8 *
pZVÆ
)

192 
öt8
 
ªadout
[6] = {0,0,0,0,0,0};

195 
CS
 = 
CS_ENABLED
;

196 
	`•iWrôeByã
(0x80|
ACC_X_LSB
);

197 
uöt8
 
i
 = 0; i<6; i++)

199 
	`•iRódByã
((
uöt8
 *)&
ªadout
[
i
], 0xFF);

201 
CS
 = 
CS_DISABLED
;

204 *
pXVÆ
 = 
ªadout
[1];

205 *
pYVÆ
 = 
ªadout
[3];

206 *
pZVÆ
 = 
ªadout
[5];

208 
	}
}

222 
	$accRódAcc16
(
öt16
 *
pXVÆ
, i¡16 *
pYVÆ
, i¡16 *
pZVÆ
)

224 
öt8
 
ªadout
[6] = {0,0,0,0,0,0};

227 
CS
 = 
CS_ENABLED
;

228 
	`•iWrôeByã
(0x80|
ACC_X_LSB
);

229 
uöt8
 
i
 = 0; i<6; i++)

231 
	`•iRódByã
((
uöt8
 *)&
ªadout
[
i
], 0xFF);

233 
CS
 = 
CS_DISABLED
;

236 *
pXVÆ
 = ( (((
uöt8
)
ªadout
[0]Ë>> 6Ë| ((
öt16
)(readout[1]) << 2) );

237 *
pYVÆ
 = ( (((
uöt8
)
ªadout
[2]Ë>> 6Ë| ((
öt16
)(readout[3]) << 2) );

238 *
pZVÆ
 = ( (((
uöt8
)
ªadout
[4]Ë>> 6Ë| ((
öt16
)(readout[5]) << 2) );

240 
	}
}

250 
	$•iWrôeByã
(
uöt8
 
wrôe
)

252 
U0CSR
 &= ~0x02;

253 
U0DBUF
 = 
wrôe
;

254 !(
U0CSR
 & 0x02));

255 
	}
}

266 
	$•iRódByã
(
uöt8
 *
ªad
, uöt8 
wrôe
)

268 
U0CSR
 &= ~0x02;

269 
U0DBUF
 = 
wrôe
;

270 !(
U0CSR
 & 0x02));

271 *
ªad
 = 
U0DBUF
;

272 
	}
}

	@Projects/ble/KeyFob/Source/bma250.h

8 #i‚de‡
BMA250_H


9 
	#BMA250_H


	)

15 
	~"hÆ_ty≥s.h
"

23 
	#ACC_CHIPID
 0x00

24 
	#ACC_X_LSB
 0x02

25 
	#ACC_X_MSB
 0x03

26 
	#ACC_Y_LSB
 0x04

	)

27 
	#ACC_Y_MSB
 0x05

	)

28 
	#ACC_Z_LSB
 0x06

	)

29 
	#ACC_Z_MSB
 0x07

	)

30 
	#ACC_TEMP
 0x08

31 
	#ACC_INT_STATUS
 0x09

	)

32 
	#ACC_DATA_INT_STATUS
 0x0A

	)

33 
	#ACC_RANGE
 0x0F

34 
	#ACC_BW
 0x10

35 
	#ACC_PM
 0x11

36 
	#ACC_CONF_FILT_SHADOW
 0x13

	)

37 
	#ACC_SOFTRESET
 0x14

	)

38 
	#ACC_INT_ENABLE0
 0x16

	)

39 
	#ACC_INT_ENABLE1
 0x17

	)

40 
	#ACC_INT_MAPPING0
 0x19

	)

41 
	#ACC_INT_MAPPING1
 0x1A

	)

42 
	#ACC_INT_MAPPING2
 0x1B

	)

43 
	#ACC_INT_SOURCE
 0x1E

	)

44 
	#ACC_INT_PIN_BEHAVIOR
 0x20

	)

47 
	#ACC_RANGE_2G
 0x03

48 
	#ACC_RANGE_4G
 0x05

49 
	#ACC_RANGE_8G
 0x08

50 
	#ACC_RANGE_16G
 0x0C

51 

	)

53 
	#ACC_BW_7_81HZ
 0x08

54 
	#ACC_BW_15_63HZ
 0x09

55 
	#ACC_BW_31_25HZ
 0x0A

56 
	#ACC_BW_62_5HZ
 0x0B

57 
	#ACC_BW_125HZ
 0x0C

58 
	#ACC_BW_250HZ
 0x0D

59 
	#ACC_BW_500HZ
 0x0E

60 
	#ACC_BW_1000HZ
 0x0F

61 

	)

62 
	#ACC_PM_SUSP
 0x80

63 
	#ACC_PM_LP
 0x40

64 
	#ACC_PM_SLEEP_10MS
 0x14

	)

65 
	#ACC_PM_SLEEP_25MS
 0x16

	)

66 
	#ACC_PM_SLEEP_50MS
 0x18

	)

69 
	#ACC_INT_FLAT_EN
 0x80

70 
	#ACC_INT_ORIENT_EN
 0x40

71 
	#ACC_INT_S_TAP_EN
 0x20

72 
	#ACC_INT_D_TAP_EN
 0x10

73 
	#ACC_INT_SLOPE_Z_EN
 0x04

74 
	#ACC_INT_SLOPE_Y_EN
 0x02

75 
	#ACC_INT_SLOPE_X_EN
 0x01

76 
	#ACC_INT_DATA_EN
 0x10

77 
	#ACC_INT_LOW_EN
 0x08

78 
	#ACC_INT_HIGH_Z_EN
 0x04

79 
	#ACC_INT_HIGH_Y_EN
 0x02

80 
	#ACC_INT_HIGH_X_EN
 0x01

81 

	)

83 
	#ACC_INT_MAP_FLAT
 0x80

84 
	#ACC_INT_MAP_ORIENT
 0x40

85 
	#ACC_INT_MAP_S_TAP
 0x20

86 
	#ACC_INT_MAP_D_TAP
 0x10

87 
	#ACC_INT_MAP_SLOPE
 0x04

88 
	#ACC_INT_MAP_HIGH
 0x02

89 
	#ACC_INT_MAP_LOW
 0x01

90 
	#ACC_INT1_MAP_DATA
 0x01

91 
	#ACC_INT2_MAP_DATA
 0x80

92 

	)

94 
	#ACC_INT_SRC_DATA_FILT
 0x20

	)

95 
	#ACC_INT_SRC_TAP_FILT
 0x01

	)

96 
	#ACC_INT_SRC_SLOPE_FILT
 0x04

	)

97 
	#ACC_INT_SRC_HIGH_FILT
 0x02

	)

98 
	#ACC_INT_SRC_LOW_FILT
 0x01

	)

101 
	#ACC_INT2_OD
 0x08

	)

102 
	#ACC_INT2_LVL
 0x04

	)

103 
	#ACC_INT1_OD
 0x02

	)

104 
	#ACC_INT1_LVL
 0x01

	)

107 
	#ACC_SOFTRESET_EN
 0xB6

108 

	)

114 
	#WAIT_1MS
(Ë{
i
=0;i<32000;i++)
	`asm
("NOP"); }

	)

117 
	#WAIT_MS
(
t
) \

119 
uöt8
 
i
 = 0; i<
t
; i++) \

120 
	`WAIT_1MS
(); \

121 }0)

	)

127 
accInô
();

128 
accSt›
();

129 
accWrôeReg
(
uöt8
 
ªg
, uöt8 
vÆ
);

130 
accRódReg
(
uöt8
 
ªg
, uöt8 *
pVÆ
);

131 
accRódAcc
(
öt8
 *
pXVÆ
, i¡8 *
pYVÆ
, i¡8 *
pZVÆ
);

132 
accRódAcc16
(
öt16
 *
pXVÆ
, i¡16 *
pYVÆ
, i¡16 *
pZVÆ
);

	@Projects/ble/KeyFob/Source/buzzer.c

40 
	~"hÆ_mcu.h
"

41 
	~"buzzî.h
"

49 
	$buzzîInô
()

51 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

57 
PERCFG
 |= 0x20;

58 
P1DIR
 |= 0x40;

59 
P1SEL
 |= 0x40;

61 
T3CTL
 &= ~0x10;

62 
T3CTL
 |= 0x04;

63 
T3CTL
 &= ~0x08;

64 
T3CTL
 |= 0x03;

66 
T3CCTL0
 &= ~0x40;

67 
T3CCTL0
 |= 0x04;

68 
T3CCTL0
 |= 0x10;

70 
	}
}

80 
uöt8
 
	$buzzîSèπ
(
uöt16
 
‰equícy
)

82 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

83 
	`buzzîInô
();

85 
uöt8
 
¥esˇÀr
 = 0;

88 
uöt8
 
tickSpdDiv
 = (
CLKCONSTA
 & 0x38)>>3;

91 i‡(
‰equícy
 < (244 >> 
tickSpdDiv
)){

92 
	`buzzîSt›
();

97 
uöt32
 
ticks
 = (8000000/
‰equícy
Ë>> 
tickSpdDiv
;

100 (
ticks
 & 0xFFFFFF00) != 0)

102 
ticks
 >>= 1;

103 
¥esˇÀr
 += 32;

107 
T3CTL
 &= ~0xE0;

108 
T3CTL
 |
¥esˇÀr
;

109 
T3CC0
 = (
uöt8
)
ticks
;

112 
T3CTL
 |= 0x10;

116 
	}
}

123 
	$buzzîSt›
()

125 #i‡
	`deföed
 ( 
CC2540_MINIDK
 )

126 
T3CTL
 &= ~0x10;

127 
P1SEL
 &= ~0x40;

128 
P1_6
 = 0;

130 
	}
}

	@Projects/ble/KeyFob/Source/buzzer.h

40 #i‚de‡
BUZZER_H


41 
	#BUZZER_H


	)

43 
	~"hÆ_ty≥s.h
"

46 
buzzîInô
();

47 
uöt8
 
buzzîSèπ
(
uöt16
 
‰equícy
);

48 
buzzîSt›
();

	@Projects/ble/KeyFob/Source/cma3000d.c

40 
	~<ioCC2540.h
>

41 
	~"cma3000d.h
"

55 
	#SCK
 
P1_3


	)

56 
	#MISO
 
P1_4


	)

57 
	#MOSI
 
P1_5


	)

59 #ifde‡
REV_1_0


60 
	#CS
 
P1_2


	)

61 #ñi‡(
deföed
 
REV_0_6
)

62 
	#CS
 
P1_7


	)

65 
	#CS_DISABLED
 1

	)

66 
	#CS_ENABLED
 0

	)

71 
•iWrôeByã
(
uöt8
 
wrôe
);

72 
•iRódByã
(
uöt8
 *
ªad
, uöt8 
wrôe
);

77 
uöt8
 
	gacc_öôülized
 = 
FALSE
;

86 
	$accInô
()

91 
PERCFG
 |= 0x01;

93 
P1SEL
 |= 0x38;

95 #ifde‡
REV_1_0


96 
P1DIR
 |= 0x04;

97 #ñi‡(
deföed
 
REV_0_6
)

98 
P1DIR
 |= 0x80;

100 
CS
 = 
CS_DISABLED
;

104 
U0CSR
 = 0x00;

108 
U0GCR
 = 0x20;

110 
U0GCR
 |= 0x0D;

111 
U0BAUD
 = 0xEC;

113 
uöt8
 
ªadVÆue
;

114 
	`accWrôeReg
(
CTRL
, 
RANGE_2G
 | 
MODE_100HZ_MEAS
);

115 
	`WAIT_1_3US
(80);

117 
	`accRódReg
(
STATUS
, &
ªadVÆue
);

118 
	`WAIT_1_3US
(80);

119 }
ªadVÆue
 & 0x08);

120 
acc_öôülized
 = 
TRUE
;

121 
	}
}

126 
	$accSt›
()

128 i‡(
acc_öôülized
) {

129 
	`accWrôeReg
(
CTRL
, 
MODE_PD
);

130 
acc_öôülized
 = 
FALSE
;

132 
	}
}

143 
	$accWrôeReg
(
uöt8
 
ªg
, uöt8 
vÆ
)

145 
CS
 = 
CS_ENABLED
;

146 
	`•iWrôeByã
(
ªg
|0x02);

147 
	`•iWrôeByã
(
vÆ
);

148 
CS
 = 
CS_DISABLED
;

149 
	}
}

161 
	$accRódReg
(
uöt8
 
ªg
, uöt8 *
pVÆ
)

163 
CS
 = 
CS_ENABLED
;

164 
	`WAIT_1_3US
(2);

165 
	`•iWrôeByã
(
ªg
);

166 
	`•iRódByã
(
pVÆ
, 0xFF);

167 
CS
 = 
CS_DISABLED
;

168 
	}
}

184 
	$accRódAcc
(
öt8
 *
pXVÆ
, i¡8 *
pYVÆ
, i¡8 *
pZVÆ
)

187 
	`accRódReg
(
DOUTX
, (
uöt8
*)
pXVÆ
);

188 
	`WAIT_1_3US
(80);

191 
	`accRódReg
(
DOUTY
, (
uöt8
*)
pYVÆ
);

192 
	`WAIT_1_3US
(80);

195 
	`accRódReg
(
DOUTZ
, (
uöt8
*)
pZVÆ
);

200 
	}
}

210 
	$•iWrôeByã
(
uöt8
 
wrôe
)

212 
U0CSR
 &= ~0x02;

213 
U0DBUF
 = 
wrôe
;

214 !(
U0CSR
 & 0x02));

215 
	}
}

226 
	$•iRódByã
(
uöt8
 *
ªad
, uöt8 
wrôe
)

228 
U0CSR
 &= ~0x02;

229 
U0DBUF
 = 
wrôe
;

230 !(
U0CSR
 & 0x02));

231 *
ªad
 = 
U0DBUF
;

232 
	}
}

	@Projects/ble/KeyFob/Source/cma3000d.h

40 #i‚de‡
CMA3000_H


41 
	#CMA3000_H


	)

43 
	~"hÆ_ty≥s.h
"

50 
	#REV_1_0


	)

51 #i‚de‡
REV_1_0


52 
	#REV_0_6


	)

56 
	#WHO_AM_I
 (0x00<<2)

	)

57 
	#REVID
 (0x01<<2)

	)

58 
	#CTRL
 (0x02<<2)

	)

59 
	#STATUS
 (0x03<<2)

	)

60 
	#RSTR
 (0x04<<2)

	)

61 
	#INT_STATUS
 (0x05<<2)

	)

62 
	#DOUTX
 (0x06<<2)

	)

63 
	#DOUTY
 (0x07<<2)

	)

64 
	#DOUTZ
 (0x08<<2)

	)

65 
	#MDTHR
 (0x09<<2)

	)

66 
	#MDFFTMR
 (0x0A<<2)

	)

67 
	#FFTHR
 (0x0B<<2)

	)

70 
	#RANGE_2G
 0x80

	)

71 
	#RANGE_8G
 0x00

	)

73 
	#INT_ACTIVE_LOW
 0x40

	)

74 
	#INT_ACTIVE_HIGH
 0x00

	)

76 
	#MODE_PD
 0x00

	)

77 
	#MODE_100HZ_MEAS
 0x02

	)

78 
	#MODE_400HZ_MEAS
 0x04

	)

79 
	#MODE_40HZ_MEAS
 0x06

	)

80 
	#MODE_10HZ_MD
 0x08

	)

81 
	#MODE_100HZ_FALL
 0x0A

	)

82 
	#MODE_400HZ_FALL
 0x0C

	)

84 
	#INT_DIS
 0x01

	)

85 
	#INT_EN
 0x00

	)

91 #ifde‡
REV_1_0


92 
	#ACC_DATA_READY
 (
P1_7
 =1)

	)

93 #ñi‡(
deföed
 
REV_0_6
)

94 
	#ACC_DATA_READY
 (
P0_6
 =1)

	)

101 
	#WAIT_1_3US
(
t
) \

103 
uöt8
 
i
 = 0; i<
t
; i++) \

104 
	`asm
("NOP"); \

105 }0)

	)

111 
accInô
();

112 
accSt›
();

113 
accWrôeReg
(
uöt8
 
ªg
, uöt8 
vÆ
);

114 
accRódReg
(
uöt8
 
ªg
, uöt8 *
pVÆ
);

115 
accRódAcc
(
öt8
 *
pXVÆ
, i¡8 *
pYVÆ
, i¡8 *
pZVÆ
);

	@Projects/ble/KeyFob/Source/keyfobdemo.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_PwrMgr.h
"

47 
	~"OnBﬂrd.h
"

48 
	~"hÆ_adc.h
"

49 
	~"hÆ_Àd.h
"

50 
	~"hÆ_key.h
"

52 
	~"buzzî.h
"

54 #i‡
deföed
 ( 
ACC_BMA250
 )

55 
	~"bma250.h
"

56 #ñi‡
deföed
 ( 
ACC_CMA3000
 )

57 
	~"cma3000d.h
"

60 
	~"g©t.h
"

62 
	~"hci.h
"

64 
	~"g≠g©t£rvî.h
"

65 
	~"g©t£rv≠p.h
"

67 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

68 
	~"≥rùhîÆBrﬂdˇ°î.h
"

70 
	~"≥rùhîÆ.h
"

73 
	~"g≠b⁄dmgr.h
"

75 
	~"devöfo£rvi˚.h
"

76 
	~"¥oxªp‹ãr.h
"

77 
	~"b©t£rvi˚.h
"

78 
	~"ac˚Àromëî.h
"

79 
	~"sim∂ekeys.h
"

81 
	~"keyfobdemo.h
"

92 
	#STARTDELAY
 500

	)

95 
	#BUZZER_MAX_BEEPS
 10

	)

98 
	#BUZZER_ALERT_HIGH_FREQ
 4096

	)

101 
	#BUZZER_ALERT_LOW_FREQ
 250

	)

104 
	#BATTERY_CHECK_PERIOD
 10000

	)

107 
	#ACCEL_READ_PERIOD
 50

	)

110 
	#ACCEL_CHANGE_THRESHOLD
 5

	)

116 
	#DEFAULT_DISCOVERABLE_MODE
 
GAP_ADTYPE_FLAGS_LIMITED


	)

120 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 80

	)

123 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 800

	)

126 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 0

	)

129 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

132 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
TRUE


	)

135 
	#DEFAULT_CONN_PAUSE_PERIPHERAL
 5

	)

138 
	#KEYFOB_PROXSTATE_INITIALIZED
 0

139 
	#KEYFOB_PROXSTATE_CONNECTED_IN_RANGE
 1

141 
	#KEYFOB_PROXSTATE_PATH_LOSS
 2

143 
	#KEYFOB_PROXSTATE_LINK_LOSS
 3

144 

	)

146 
	#BUZZER_OFF
 0

	)

147 
	#BUZZER_ON
 1

	)

150 
	#ALERT_STATE_OFF
 0

	)

151 
	#ALERT_STATE_LOW
 1

	)

152 
	#ALERT_STATE_HIGH
 2

	)

155 
	#TI_COMPANY_ID
 0x000D

	)

157 
	#INVALID_CONNHANDLE
 0xFFFF

	)

159 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

160 
	#ADV_IN_CONN_WAIT
 500

162 

	)

182 
uöt8
 
	gkeyfob≠p_TaskID
;

184 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

187 
uöt8
 
	gkeyfobProxLLAÀπLevñ
 = 
PP_ALERT_LEVEL_NO
;

188 
uöt8
 
	gkeyfobProxIMAÀπLevñ
 = 
PP_ALERT_LEVEL_NO
;

189 
öt8
 
	gkeyfobProxTxPwrLevñ
 = 0;

192 
uöt8
 
	gkeyfobProximôySèã
;

194 
uöt8
 
	gkeyfobAÀπSèã
;

197 
uöt8
 
	gdevi˚Name
[] =

216 
uöt8
 
	gadvîtD©a
[] =

219 
GAP_ADTYPE_FLAGS
,

220 
DEFAULT_DISCOVERABLE_MODE
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

225 
GAP_ADTYPE_16BIT_MORE
,

226 
LO_UINT16
–
LINK_LOSS_SERVICE_UUID
 ),

227 
HI_UINT16
–
LINK_LOSS_SERVICE_UUID
 ),

228 
LO_UINT16
–
IMMEDIATE_ALERT_SERVICE_UUID
 ),

229 
HI_UINT16
–
IMMEDIATE_ALERT_SERVICE_UUID
 ),

230 
LO_UINT16
–
TX_PWR_LEVEL_SERVICE_UUID
 ),

231 
HI_UINT16
–
TX_PWR_LEVEL_SERVICE_UUID
 )

235 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "TI BLE Keyfob";

238 
uöt8
 
	gbuzzî_°©e
 = 
BUZZER_OFF
;

239 
uöt8
 
	gbuzzî_bìp_cou¡
 = 0;

242 
uöt8
 
	gac˚lE«bÀr
 = 
FALSE
;

247 
keyfob≠p_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

248 
keyfob≠p_Pîf‹mAÀπ
( );

249 
keyfob≠p_St›AÀπ
( );

250 
keyfob≠p_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

251 
≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

252 
¥oximôyAârCB
–
uöt8
 
©åP¨amID
 );

253 
ac˚lE«bÀrCh™geCB
( );

254 
ac˚lRód
( );

261 
g≠RﬁesCBs_t
 
	gkeyFob_PîùhîÆCBs
 =

263 
≥rùhîÆSèãNŸifiˇti⁄CB
,

264 
NULL


269 
g≠B⁄dCBs_t
 
	gkeyFob_B⁄dMgrCBs
 =

271 
NULL
,

272 
NULL


276 
¥oxRï‹ãrCBs_t
 
	gkeyFob_ProximôyCBs
 =

278 
¥oximôyAârCB
,

282 
ac˚lCBs_t
 
	gkeyFob_Ac˚lCBs
 =

284 
ac˚lE«bÀrCh™geCB
,

305 
	$KeyFobAµ_Inô
–
uöt8
 
èsk_id
 )

307 
keyfob≠p_TaskID
 = 
èsk_id
;

310 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_PAUSE_PERIPHERAL
, 
DEFAULT_CONN_PAUSE_PERIPHERAL
 );

315 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

320 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

322 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

323 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

324 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

325 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

326 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

329 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

330 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

332 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
devi˚Name
 ), deviceName );

333 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

335 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

336 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

337 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

338 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

339 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

343 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
©tDevi˚Name
 );

347 
uöt8
 
∑úMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

348 
uöt8
 
môm
 = 
TRUE
;

349 
uöt8
 
ioC≠
 = 
GAPBOND_IO_CAP_DISPLAY_ONLY
;

350 
uöt8
 
b⁄dög
 = 
TRUE
;

352 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

353 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

354 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

355 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

359 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

360 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

361 
	`DevInfo_AddSîvi˚
();

362 
	`ProxRï‹ãr_AddSîvi˚
–
GATT_ALL_SERVICES
 );

363 
	`B©t_AddSîvi˚
( );

364 
	`Ac˚l_AddSîvi˚
–
GATT_ALL_SERVICES
 );

365 
	`SK_AddSîvi˚
–
GATT_ALL_SERVICES
 );

367 
keyfobProximôySèã
 = 
KEYFOB_PROXSTATE_INITIALIZED
;

371 
öt8
 
öôülTxPowîLevñ
 = 0;

373 
	`ProxRï‹ãr_SëP¨amëî
–
PP_TX_POWER_LEVEL
,  ( 
öt8
 ), &
öôülTxPowîLevñ
 );

376 
keyfobAÀπSèã
 = 
ALERT_STATE_OFF
;

379 
	`buzzîSt›
();

382 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

388 
P0SEL
 = 0;

389 
P1SEL
 = 0x40;

390 
P2SEL
 = 0;

392 
P0DIR
 = 0xFC;

394 
P1DIR
 = 0xFF;

395 
P2DIR
 = 0x1F;

397 
P0
 = 0x03;

398 
P1
 = 0;

399 
P2
 = 0;

403 
	`HÆAdcInô
();

406 
	`Regi°îF‹Keys
–
keyfob≠p_TaskID
 );

408 #i‡
	`deföed
 ( 
DC_DC_P0_7
 )

411 
	`HCI_EXT_M≠PmIoP‹tCmd
–
HCI_EXT_PM_IO_PORT_P0
, 
HCI_EXT_PM_IO_PORT_PIN7
 );

416 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_START_DEVICE_EVT
, 
STARTDELAY
 );

417 
	}
}

432 
uöt16
 
	$KeyFobAµ_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

434 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

436 
uöt8
 *
pMsg
;

438 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
keyfob≠p_TaskID
 )Ë!
NULL
 )

440 
	`keyfob≠p_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

443 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

447  (
evíts
 ^ 
SYS_EVENT_MSG
);

450 i‡–
evíts
 & 
KFD_START_DEVICE_EVT
 )

453 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
keyFob_PîùhîÆCBs
 );

456 
VOID
 
	`GAPB⁄dMgr_Regi°î
–&
keyFob_B⁄dMgrCBs
 );

459 
VOID
 
	`ProxRï‹ãr_Regi°îAµCBs
–&
keyFob_ProximôyCBs
 );

462 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_BATTERY_CHECK_EVT
, 
BATTERY_CHECK_PERIOD
 );

465 
VOID
 
	`Ac˚l_Regi°îAµCBs
–&
keyFob_Ac˚lCBs
 );

468 
	`ProxRï‹ãr_SëP¨amëî
–
PP_LINK_LOSS_ALERT_LEVEL
,  ( 
uöt8
 ), &
keyfobProxLLAÀπLevñ
 );

469 
	`ProxRï‹ãr_SëP¨amëî
–
PP_IM_ALERT_LEVEL
,  ( 
uöt8
 ), &
keyfobProxIMAÀπLevñ
 );

470 
	`ProxRï‹ãr_SëP¨amëî
–
PP_TX_POWER_LEVEL
,  ( 
öt8
 ), &
keyfobProxTxPwrLevñ
 );

473 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_ON
 );

474 
	`oßl_pwrmgr_devi˚
–
PWRMGR_ALWAYS_ON
 );

475 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_POWERON_LED_TIMEOUT_EVT
, 1000 );

477  ( 
evíts
 ^ 
KFD_START_DEVICE_EVT
 );

480 i‡–
evíts
 & 
KFD_POWERON_LED_TIMEOUT_EVT
 )

482 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

483 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_OFF
 );

484  ( 
evíts
 ^ 
KFD_POWERON_LED_TIMEOUT_EVT
 );

487 i‡–
evíts
 & 
KFD_ACCEL_READ_EVT
 )

489 
bSètus_t
 
°©us
 = 
	`Ac˚l_GëP¨amëî
–
ACCEL_ENABLER
, &
ac˚lE«bÀr
 );

491 i‡(
°©us
 =
SUCCESS
)

493 i‡–
ac˚lE«bÀr
 )

496 i‡–
ACCEL_READ_PERIOD
 )

498 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_ACCEL_READ_EVT
, 
ACCEL_READ_PERIOD
 );

502 
	`ac˚lRód
();

507 
	`oßl_°›_timîEx
–
keyfob≠p_TaskID
, 
KFD_ACCEL_READ_EVT
);

514  (
evíts
 ^ 
KFD_ACCEL_READ_EVT
);

517 i‡–
evíts
 & 
KFD_BATTERY_CHECK_EVT
 )

520 i‡–
BATTERY_CHECK_PERIOD
 )

522 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_BATTERY_CHECK_EVT
, 
BATTERY_CHECK_PERIOD
 );

526 
	`B©t_MósLevñ
( );

528  (
evíts
 ^ 
KFD_BATTERY_CHECK_EVT
);

531 i‡–
evíts
 & 
KFD_TOGGLE_BUZZER_EVT
 )

536 i‡–
buzzî_°©e
 =
BUZZER_ON
 )

538 
	`buzzîSt›
();

539 
buzzî_°©e
 = 
BUZZER_OFF
;

540 
buzzî_bìp_cou¡
++;

541 #i‡
	`deföed
 ( 
POWER_SAVING
 )

542 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

547 i‡––
buzzî_bìp_cou¡
 < 
BUZZER_MAX_BEEPS
 ) &&

548 ––
keyfobProximôySèã
 =
KEYFOB_PROXSTATE_LINK_LOSS
 ) ||

549 –
keyfobProximôySèã
 =
KEYFOB_PROXSTATE_PATH_LOSS
 ) ) )

551 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_TOGGLE_BUZZER_EVT
, 800 );

554 i‡–
keyfobAÀπSèã
 !
ALERT_STATE_OFF
 )

557 
	`keyfob≠p_Pîf‹mAÀπ
();

560  (
evíts
 ^ 
KFD_TOGGLE_BUZZER_EVT
);

564 #i‡
	`deföed
 ( 
PLUS_BROADCASTER
 )

565 i‡–
evíts
 & 
KFD_ADV_IN_CONNECTION_EVT
 )

567 
uöt8
 
tu∫OnAdv
 = 
TRUE
;

569 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
tu∫OnAdv
 );

575 
	}
}

586 
	$keyfob≠p_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

588  
pMsg
->
evít
 )

590 
KEY_CHANGE
:

591 
	`keyfob≠p_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

594 
	}
}

608 
	$keyfob≠p_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

610 
uöt8
 
SK_Keys
 = 0;

612 ()
shi·
;

614 i‡–
keys
 & 
HAL_KEY_SW_1
 )

616 
SK_Keys
 |
SK_KEY_LEFT
;

620 if–
keyfobAÀπSèã
 !
ALERT_STATE_OFF
 )

622 
	`keyfob≠p_St›AÀπ
();

627 if–
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 )

629 
öt8
 
cuºítTxPowîLevñ
;

630 
öt8
 
√wTxPowîLevñ
;

632 
	`ProxRï‹ãr_GëP¨amëî
–
PP_TX_POWER_LEVEL
, &
cuºítTxPowîLevñ
 );

634  
cuºítTxPowîLevñ
 )

637 
√wTxPowîLevñ
 = -6;

639 
	`HCI_EXT_SëTxPowîCmd
–
HCI_EXT_TX_POWER_MINUS_6_DBM
 );

642 
	`ProxRï‹ãr_SëP¨amëî
–
PP_TX_POWER_LEVEL
,  ( 
öt8
 ), &
√wTxPowîLevñ
 );

646 
√wTxPowîLevñ
 = 0;

648 
	`HCI_EXT_SëTxPowîCmd
–
HCI_EXT_TX_POWER_0_DBM
 );

651 
	`ProxRï‹ãr_SëP¨amëî
–
PP_TX_POWER_LEVEL
,  ( 
öt8
 ), &
√wTxPowîLevñ
 );

662 i‡–
keys
 & 
HAL_KEY_SW_2
 )

665 
SK_Keys
 |
SK_KEY_RIGHT
;

669 if–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

671 
uöt8
 
cuºít_adv_íabÀd_°©us
;

672 
uöt8
 
√w_adv_íabÀd_°©us
;

675 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
cuºít_adv_íabÀd_°©us
 );

677 if–
cuºít_adv_íabÀd_°©us
 =
FALSE
 )

679 
√w_adv_íabÀd_°©us
 = 
TRUE
;

683 
√w_adv_íabÀd_°©us
 = 
FALSE
;

687 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
√w_adv_íabÀd_°©us
 );

692 
	`SK_SëP¨amëî
–
SK_KEY_ATTR
,  ( 
uöt8
 ), &
SK_Keys
 );

693 
	}
}

704 
	$keyfob≠p_Pîf‹mAÀπ
( )

707 i‡–
keyfobProximôySèã
 =
KEYFOB_PROXSTATE_LINK_LOSS
 )

709  
keyfobProxLLAÀπLevñ
 )

711 
PP_ALERT_LEVEL_LOW
:

713 #i‡
	`deföed
 ( 
POWER_SAVING
 )

714 
	`oßl_pwrmgr_devi˚
–
PWRMGR_ALWAYS_ON
 );

717 
keyfobAÀπSèã
 = 
ALERT_STATE_LOW
;

719 
	`buzzîSèπ
–
BUZZER_ALERT_LOW_FREQ
 );

720 
buzzî_°©e
 = 
BUZZER_ON
;

722 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_TOGGLE_BUZZER_EVT
, 200 );

724 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

727 
PP_ALERT_LEVEL_HIGH
:

729 #i‡
	`deföed
 ( 
POWER_SAVING
 )

730 
	`oßl_pwrmgr_devi˚
–
PWRMGR_ALWAYS_ON
 );

733 
keyfobAÀπSèã
 = 
ALERT_STATE_HIGH
;

735 
	`buzzîSèπ
–
BUZZER_ALERT_HIGH_FREQ
 );

736 
buzzî_°©e
 = 
BUZZER_ON
;

738 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_TOGGLE_BUZZER_EVT
, 200 );

740 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_ON
 );

741 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_FLASH
 );

744 
PP_ALERT_LEVEL_NO
:

747 
	`keyfob≠p_St›AÀπ
();

751 i‡–
keyfobProximôySèã
 =
KEYFOB_PROXSTATE_PATH_LOSS
 )

753  
keyfobProxIMAÀπLevñ
 )

755 
PP_ALERT_LEVEL_LOW
:

757 #i‡
	`deföed
 ( 
POWER_SAVING
 )

758 
	`oßl_pwrmgr_devi˚
–
PWRMGR_ALWAYS_ON
 );

761 
keyfobAÀπSèã
 = 
ALERT_STATE_LOW
;

763 
	`buzzîSèπ
–
BUZZER_ALERT_LOW_FREQ
 );

764 
buzzî_°©e
 = 
BUZZER_ON
;

766 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_TOGGLE_BUZZER_EVT
, 200 );

768 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

772 
PP_ALERT_LEVEL_HIGH
:

774 #i‡
	`deföed
 ( 
POWER_SAVING
 )

775 
	`oßl_pwrmgr_devi˚
–
PWRMGR_ALWAYS_ON
 );

778 
keyfobAÀπSèã
 = 
ALERT_STATE_HIGH
;

780 
	`buzzîSèπ
–
BUZZER_ALERT_HIGH_FREQ
 );

781 
buzzî_°©e
 = 
BUZZER_ON
;

783 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_TOGGLE_BUZZER_EVT
, 200 );

785 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_ON
 );

786 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_FLASH
 );

789 
PP_ALERT_LEVEL_NO
:

792 
	`keyfob≠p_St›AÀπ
();

797 
	}
}

808 
	$keyfob≠p_St›AÀπ
( )

811 
keyfobAÀπSèã
 = 
ALERT_STATE_OFF
;

813 
	`buzzîSt›
();

814 
buzzî_°©e
 = 
BUZZER_OFF
;

815 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

818 #i‡
	`deföed
 ( 
POWER_SAVING
 )

819 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

821 
	}
}

832 
	$≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

834 
uöt16
 
c⁄nH™dÀ
 = 
INVALID_CONNHANDLE
;

835 
uöt8
 
vÆFÆ£
 = 
FALSE
;

837 i‡–
g≠ProfûeSèã
 !
√wSèã
 )

839  
√wSèã
 )

841 
GAPROLE_STARTED
:

844 
uöt8
 
sy°emId
[
DEVINFO_SYSTEM_ID_LEN
];

845 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
sy°emId
);

848 
sy°emId
[7] = systemId[5];

849 
sy°emId
[6] = systemId[4];

850 
sy°emId
[5] = systemId[3];

853 
sy°emId
[4] = 0;

854 
sy°emId
[3] = 0;

856 
	`DevInfo_SëP¨amëî
(
DEVINFO_SYSTEM_ID
, 
DEVINFO_SYSTEM_ID_LEN
, 
sy°emId
);

861 
GAPROLE_ADVERTISING
:

864 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_ON
 );

869 
GAPROLE_CONNECTED
:

873 if–
keyfobProxIMAÀπLevñ
 !
PP_ALERT_LEVEL_NO
 )

875 
keyfobProximôySèã
 = 
KEYFOB_PROXSTATE_PATH_LOSS
;

877 
	`keyfob≠p_Pîf‹mAÀπ
();

878 
buzzî_bìp_cou¡
 = 0;

882 
keyfobProximôySèã
 = 
KEYFOB_PROXSTATE_CONNECTED_IN_RANGE
;

883 
	`keyfob≠p_St›AÀπ
();

886 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_CONNHANDLE
, &
c⁄nH™dÀ
 );

888 #i‡
	`deföed
 ( 
PLUS_BROADCASTER
 )

889 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_ADV_IN_CONNECTION_EVT
, 
ADV_IN_CONN_WAIT
 );

893 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_OFF
 );

897 
GAPROLE_WAITING
:

901 
keyfobProximôySèã
 = 
KEYFOB_PROXSTATE_INITIALIZED
;

904 
	`ProxRï‹ãr_SëP¨amëî
(
PP_IM_ALERT_LEVEL
, (
vÆFÆ£
), &valFalse);

905 
keyfobProxIMAÀπLevñ
 = 
PP_ALERT_LEVEL_NO
;

908 
	`Ac˚l_SëP¨amëî
(
ACCEL_ENABLER
, (
vÆFÆ£
), &valFalse);

910 
	`ac˚lE«bÀrCh™geCB
();

913 
	`HÆLedSë
–
HAL_LED_2
, 
HAL_LED_MODE_OFF
 );

916 if–
keyfobAÀπSèã
 !
ALERT_STATE_OFF
 )

918 
	`keyfob≠p_St›AÀπ
();

923 
GAPROLE_WAITING_AFTER_TIMEOUT
:

926 
keyfobProximôySèã
 = 
KEYFOB_PROXSTATE_LINK_LOSS
;

929 
	`ProxRï‹ãr_SëP¨amëî
(
PP_IM_ALERT_LEVEL
, (
vÆFÆ£
), &valFalse);

930 
keyfobProxIMAÀπLevñ
 = 
PP_ALERT_LEVEL_NO
;

933 
	`Ac˚l_SëP¨amëî
(
ACCEL_ENABLER
, (
vÆFÆ£
), &valFalse);

935 
	`ac˚lE«bÀrCh™geCB
();

938 if–
keyfobProxLLAÀπLevñ
 !
PP_ALERT_LEVEL_NO
 )

940 
	`keyfob≠p_Pîf‹mAÀπ
();

941 
buzzî_bìp_cou¡
 = 0;

952 
g≠ProfûeSèã
 = 
√wSèã
;

953 
	}
}

967 
	$¥oximôyAârCB
–
uöt8
 
©åP¨amID
 )

969  
©åP¨amID
 )

972 
PP_LINK_LOSS_ALERT_LEVEL
:

973 
	`ProxRï‹ãr_GëP¨amëî
–
PP_LINK_LOSS_ALERT_LEVEL
, &
keyfobProxLLAÀπLevñ
 );

976 
PP_IM_ALERT_LEVEL
:

978 
	`ProxRï‹ãr_GëP¨amëî
–
PP_IM_ALERT_LEVEL
, &
keyfobProxIMAÀπLevñ
 );

983 if–
keyfobProxIMAÀπLevñ
 !
PP_ALERT_LEVEL_NO
 )

985 
keyfobProximôySèã
 = 
KEYFOB_PROXSTATE_PATH_LOSS
;

986 
	`keyfob≠p_Pîf‹mAÀπ
();

987 
buzzî_bìp_cou¡
 = 0;

991 
keyfobProximôySèã
 = 
KEYFOB_PROXSTATE_CONNECTED_IN_RANGE
;

992 
	`keyfob≠p_St›AÀπ
();

1002 
	}
}

1014 
	$ac˚lE«bÀrCh™geCB
( )

1016 
bSètus_t
 
°©us
 = 
	`Ac˚l_GëP¨amëî
–
ACCEL_ENABLER
, &
ac˚lE«bÀr
 );

1018 i‡(
°©us
 =
SUCCESS
){

1019 i‡(
ac˚lE«bÀr
)

1022 
	`accInô
();

1024 
	`oßl_°¨t_timîEx
–
keyfob≠p_TaskID
, 
KFD_ACCEL_READ_EVT
, 
ACCEL_READ_PERIOD
 );

1028 
	`accSt›
();

1029 
	`oßl_°›_timîEx
–
keyfob≠p_TaskID
, 
KFD_ACCEL_READ_EVT
);

1035 
	}
}

1047 
	$ac˚lRód
( )

1050 
öt8
 
x
, 
y
, 
z
;

1051 
öt8
 
√w_x
, 
√w_y
, 
√w_z
;

1054 
	`accRódAcc
(&
√w_x
, &
√w_y
, &
√w_z
);

1058 if–(
x
 < (
√w_x
-
ACCEL_CHANGE_THRESHOLD
)) || (x > (new_x+ACCEL_CHANGE_THRESHOLD)) )

1060 
x
 = 
√w_x
;

1061 
	`Ac˚l_SëP¨amëî
(
ACCEL_X_ATTR
,  ( 
öt8
 ), &
x
);

1066 if–(
y
 < (
√w_y
-
ACCEL_CHANGE_THRESHOLD
)) || (y > (new_y+ACCEL_CHANGE_THRESHOLD)) )

1068 
y
 = 
√w_y
;

1069 
	`Ac˚l_SëP¨amëî
(
ACCEL_Y_ATTR
,  ( 
öt8
 ), &
y
);

1074 if–(
z
 < (
√w_z
-
ACCEL_CHANGE_THRESHOLD
)) || (z > (new_z+ACCEL_CHANGE_THRESHOLD)) )

1076 
z
 = 
√w_z
;

1077 
	`Ac˚l_SëP¨amëî
(
ACCEL_Z_ATTR
,  ( 
öt8
 ), &
z
);

1080 
	}
}

	@Projects/ble/KeyFob/Source/keyfobdemo.h

40 #i‚de‡
KEYFOBDEMO_H


41 
	#KEYFOBDEMO_H


	)

43 #ifde‡
__˝lu•lus


58 
	#KFD_START_DEVICE_EVT
 0x0001

	)

59 
	#KFD_BATTERY_CHECK_EVT
 0x0002

	)

60 
	#KFD_ACCEL_READ_EVT
 0x0004

	)

61 
	#KFD_TOGGLE_BUZZER_EVT
 0x0008

	)

62 
	#KFD_ADV_IN_CONNECTION_EVT
 0x0010

	)

63 
	#KFD_POWERON_LED_TIMEOUT_EVT
 0x0020

	)

76 
KeyFobAµ_Inô
–
uöt8
 
èsk_id
 );

81 
uöt16
 
KeyFobAµ_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

86 #ifde‡
__˝lu•lus


	@Projects/ble/OADManager/Source/_hal_uart_isr_sbl.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"hÆ_as£π.h
"

46 
	~"hÆ_bﬂrd.h
"

47 
	~"hÆ_defs.h
"

48 
	~"hÆ_mcu.h
"

49 
	~"hÆ_u¨t.h
"

50 
	~"oßl.h
"

57 
	#HAL_UART_ASSERT
(
ex¥
)

	)

59 
	#HAL_UART_ISR_RX_AVAIL
() \

60 (
i§Cfg
.
rxTaû
 >i§Cfg.
rxHód
) ? \

61 (
i§Cfg
.
rxTaû
 - i§Cfg.
rxHód
) : \

62 (
HAL_UART_ISR_RX_MAX
 - 
i§Cfg
.
rxHód
 + i§Cfg.
rxTaû
)

	)

64 
	#HAL_UART_ISR_TX_AVAIL
() \

65 (
i§Cfg
.
txHód
 > i§Cfg.
txTaû
) ? \

66 (
i§Cfg
.
txHód
 - i§Cfg.
txTaû
 - 1) : \

67 (
HAL_UART_ISR_TX_MAX
 - 
i§Cfg
.
txTaû
 + i§Cfg.
txHód
 - 1)

	)

74 
	#CSR_MODE
 0x80

	)

75 
	#CSR_RE
 0x40

	)

76 
	#CSR_SLAVE
 0x20

	)

77 
	#CSR_FE
 0x10

	)

78 
	#CSR_ERR
 0x08

	)

79 
	#CSR_RX_BYTE
 0x04

	)

80 
	#CSR_TX_BYTE
 0x02

	)

81 
	#CSR_ACTIVE
 0x01

	)

84 
	#UCR_FLUSH
 0x80

	)

85 
	#UCR_FLOW
 0x40

	)

86 
	#UCR_D9
 0x20

	)

87 
	#UCR_BIT9
 0x10

	)

88 
	#UCR_PARITY
 0x08

	)

89 
	#UCR_SPB
 0x04

	)

90 
	#UCR_STOP
 0x02

	)

91 
	#UCR_START
 0x01

	)

93 
	#UTX0IE
 0x04

	)

94 
	#UTX1IE
 0x08

	)

96 
	#P2DIR_PRIPO
 0xC0

	)

99 #unde‡
PxOUT


100 #unde‡
PxDIR


101 #unde‡
PxSEL


102 #unde‡
UxCSR


103 #unde‡
UxUCR


104 #unde‡
UxDBUF


105 #unde‡
UxBAUD


106 #unde‡
UxGCR


107 #unde‡
URXxIE


108 #unde‡
URXxIF


109 #unde‡
UTXxIE


110 #unde‡
UTXxIF


111 #unde‡
HAL_UART_PERCFG_BIT


112 #unde‡
HAL_UART_Px_RTS


113 #unde‡
HAL_UART_Px_CTS


114 #unde‡
HAL_UART_Px_RX_TX


115 #unde‡
HAL_UART_Px_RX


116 #unde‡
PxIFG


117 #unde‡
PxIF


118 #unde‡
PxIEN


119 #unde‡
PICTL_BIT


120 #unde‡
IENx


121 #unde‡
IEN_BIT


122 #i‡(
HAL_UART_ISR
 == 1)

123 
	#PxOUT
 
P0


	)

124 
	#PxIN
 
P0


	)

125 
	#PxDIR
 
P0DIR


	)

126 
	#PxSEL
 
P0SEL


	)

127 
	#UxCSR
 
U0CSR


	)

128 
	#UxUCR
 
U0UCR


	)

129 
	#UxDBUF
 
U0DBUF


	)

130 
	#UxBAUD
 
U0BAUD


	)

131 
	#UxGCR
 
U0GCR


	)

132 
	#URXxIE
 
URX0IE


	)

133 
	#URXxIF
 
URX0IF


	)

134 
	#UTXxIE
 
UTX0IE


	)

135 
	#UTXxIF
 
UTX0IF


	)

137 
	#PxIFG
 
P0IFG


	)

138 
	#PxIF
 
P0IF


	)

139 
	#PxIEN
 
P0IEN


	)

140 
	#PICTL_BIT
 0x01

	)

141 
	#IENx
 
IEN1


	)

142 
	#IEN_BIT
 0x20

	)

145 
	#PxOUT
 
P1


	)

146 
	#PxIN
 
P1


	)

147 
	#PxDIR
 
P1DIR


	)

148 
	#PxSEL
 
P1SEL


	)

149 
	#UxCSR
 
U1CSR


	)

150 
	#UxUCR
 
U1UCR


	)

151 
	#UxDBUF
 
U1DBUF


	)

152 
	#UxBAUD
 
U1BAUD


	)

153 
	#UxGCR
 
U1GCR


	)

154 
	#URXxIE
 
URX1IE


	)

155 
	#URXxIF
 
URX1IF


	)

156 
	#UTXxIE
 
UTX1IE


	)

157 
	#UTXxIF
 
UTX1IF


	)

159 
	#PxIFG
 
P1IFG


	)

160 
	#PxIF
 
P1IF


	)

161 
	#PxIEN
 
P1IEN


	)

162 
	#PICTL_BIT
 0x04

	)

163 
	#IENx
 
IEN2


	)

164 
	#IEN_BIT
 0x10

	)

167 #i‡(
HAL_UART_ISR
 == 1)

168 
	#HAL_UART_PERCFG_BIT
 0x01

169 
	#HAL_UART_Px_RX_TX
 0x0C

170 
	#HAL_UART_Px_RX
 0x04

171 
	#HAL_UART_Px_RTS
 0x20

172 
	#HAL_UART_Px_CTS
 0x10

173 #ñ£

	)

174 
	#HAL_UART_PERCFG_BIT
 0x02

175 
	#HAL_UART_Px_RTS
 0x20

176 
	#HAL_UART_Px_CTS
 0x10

177 
	#HAL_UART_Px_RX_TX
 0xC0

178 
	#HAL_UART_Px_RX
 0x80

180 

	)

182 
	#HAL_UART_MSECS_TO_TICKS
 33

	)

184 #i‡!
deföed
 
HAL_UART_ISR_RX_MAX


185 
	#HAL_UART_ISR_RX_MAX
 128

	)

187 #i‡!
deföed
 
HAL_UART_ISR_TX_MAX


188 
	#HAL_UART_ISR_TX_MAX
 
HAL_UART_ISR_RX_MAX


	)

190 #i‡!
deföed
 
HAL_UART_ISR_HIGH


191 
	#HAL_UART_ISR_HIGH
 (
HAL_UART_ISR_RX_MAX
 / 2 - 16)

	)

193 #i‡!
deföed
 
HAL_UART_ISR_IDLE


194 
	#HAL_UART_ISR_IDLE
 (1 * 
HAL_UART_MSECS_TO_TICKS
)

	)

201 #i‡
HAL_UART_ISR_RX_MAX
 <= 256

202 
uöt8
 
	trxIdx_t
;

204 
uöt16
 
	trxIdx_t
;

207 #i‡
HAL_UART_ISR_TX_MAX
 <= 256

208 
uöt8
 
	ttxIdx_t
;

210 
uöt16
 
	ttxIdx_t
;

215 
uöt8
 
	mrxBuf
[
HAL_UART_ISR_RX_MAX
];

216 
rxIdx_t
 
	mrxHód
;

217 vﬁ©ûê
rxIdx_t
 
	mrxTaû
;

218 
uöt8
 
	mrxTick
;

219 
uöt8
 
	mrxShdw
;

221 
uöt8
 
	mtxBuf
[
HAL_UART_ISR_TX_MAX
];

222 vﬁ©ûê
txIdx_t
 
	mtxHód
;

223 
txIdx_t
 
	mtxTaû
;

224 
uöt8
 
	mtxMT
;

226 
hÆUARTCBack_t
 
	mu¨tCB
;

227 } 
	tu¨tISRCfg_t
;

241 
u¨tISRCfg_t
 
	gi§Cfg
;

247 
HÆUARTInôISR
();

248 
HÆUARTO≥nISR
(
hÆUARTCfg_t
 *
c⁄fig
);

249 
uöt16
 
HÆUARTRódISR
(
uöt8
 *
buf
, uöt16 
Àn
);

250 
uöt16
 
HÆUARTWrôeISR
(
uöt8
 *
buf
, uöt16 
Àn
);

251 
HÆUARTPﬁlISR
();

252 
uöt16
 
HÆUARTRxAvaûISR
();

253 
uöt8
 
HÆUARTBusyISR
();

254 
HÆUARTSu•ídISR
();

255 
HÆUARTResumeISR
();

266 
	$HÆUARTInôISR
()

269 
P2DIR
 &~
P2DIR_PRIPO
;

270 
P2DIR
 |
HAL_UART_PRIPO
;

272 #i‡(
HAL_UART_ISR
 == 1)

273 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

275 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

277 
PxSEL
 |
HAL_UART_Px_RX_TX
;

278 
ADCCFG
 &~
HAL_UART_Px_RX_TX
;

279 
UxCSR
 = 
CSR_MODE
;

280 
UxUCR
 = 
UCR_FLUSH
;

281 
	}
}

292 
	$HÆUARTO≥nISR
(
hÆUARTCfg_t
 *
c⁄fig
)

294 
i§Cfg
.
u¨tCB
 = 
c⁄fig
->
ˇŒBackFunc
;

296 
	`HAL_UART_ASSERT
((
c⁄fig
->
baudR©e
 =
HAL_UART_BR_9600
) ||

297 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_19200
) ||

298 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_38400
) ||

299 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
) ||

300 (
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
));

302 i‡(
c⁄fig
->
baudR©e
 =
HAL_UART_BR_57600
 ||

303 
c⁄fig
->
baudR©e
 =
HAL_UART_BR_115200
)

305 
UxBAUD
 = 216;

309 
UxBAUD
 = 59;

312 
c⁄fig
->
baudR©e
)

314 
HAL_UART_BR_9600
:

315 
UxGCR
 = 8;

317 
HAL_UART_BR_19200
:

318 
UxGCR
 = 9;

320 
HAL_UART_BR_38400
:

321 
HAL_UART_BR_57600
:

322 
UxGCR
 = 10;

326 
UxGCR
 = 11;

331 i‡(
c⁄fig
->
ÊowC⁄åﬁ
)

333 
UxUCR
 = 
UCR_FLOW
 | 
UCR_STOP
;

334 
PxSEL
 |
HAL_UART_Px_RTS
 | 
HAL_UART_Px_CTS
;

335 
PxOUT
 &~
HAL_UART_Px_RTS
;

336 
PxDIR
 |
HAL_UART_Px_RTS
;

340 
UxUCR
 = 
UCR_STOP
;

343 
URXxIE
 = 1;

344 
UTXxIF
 = 1;

345 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

346 
	}
}

358 
uöt16
 
	$HÆUARTRódISR
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

360 
uöt16
 
˙t
 = 0;

362 (
i§Cfg
.
rxHód
 !i§Cfg.
rxTaû
Ë&& (
˙t
 < 
Àn
))

364 *
buf
++ = 
i§Cfg
.
rxBuf
[i§Cfg.
rxHód
++];

365 i‡(
i§Cfg
.
rxHód
 >
HAL_UART_ISR_RX_MAX
)

367 
i§Cfg
.
rxHód
 = 0;

369 
˙t
++;

372  
˙t
;

373 
	}
}

385 
uöt16
 
	$HÆUARTWrôeISR
(
uöt8
 *
buf
, 
uöt16
 
Àn
)

387 
uöt16
 
˙t
;

390 i‡(
	`HAL_UART_ISR_TX_AVAIL
(Ë< 
Àn
)

395 
˙t
 = 0; c¡ < 
Àn
; cnt++)

397 
i§Cfg
.
txBuf
[i§Cfg.
txTaû
] = *
buf
++;

398 
i§Cfg
.
txMT
 = 0;

400 i‡(
i§Cfg
.
txTaû
 >
HAL_UART_ISR_TX_MAX
-1)

402 
i§Cfg
.
txTaû
 = 0;

406 
i§Cfg
.
txTaû
++;

410 
IEN2
 |
UTXxIE
;

413  
˙t
;

414 
	}
}

425 
	$HÆUARTPﬁlISR
()

427 
uöt16
 
˙t
 = 
	`HAL_UART_ISR_RX_AVAIL
();

428 
uöt8
 
evt
 = 0;

430 i‡(
i§Cfg
.
rxTick
)

433 
uöt8
 
de¸
 = 
ST0
 - 
i§Cfg
.
rxShdw
;

435 i‡(
i§Cfg
.
rxTick
 > 
de¸
)

437 
i§Cfg
.
rxTick
 -
de¸
;

441 
i§Cfg
.
rxTick
 = 0;

444 
i§Cfg
.
rxShdw
 = 
ST0
;

446 i‡(
˙t
 >
HAL_UART_ISR_RX_MAX
-1)

448 
evt
 = 
HAL_UART_RX_FULL
;

450 i‡(
˙t
 >
HAL_UART_ISR_HIGH
)

452 
evt
 = 
HAL_UART_RX_ABOUT_FULL
;

454 i‡(
˙t
 && !
i§Cfg
.
rxTick
)

456 
evt
 = 
HAL_UART_RX_TIMEOUT
;

459 i‡(
i§Cfg
.
txMT
)

461 
i§Cfg
.
txMT
 = 0;

462 
evt
 |
HAL_UART_TX_EMPTY
;

465 i‡(
evt
 && (
i§Cfg
.
u¨tCB
 !
NULL
))

467 
i§Cfg
.
	`u¨tCB
(
HAL_UART_ISR
-1, 
evt
);

469 
	}
}

480 
uöt16
 
	$HÆUARTRxAvaûISR
()

482  
	`HAL_UART_ISR_RX_AVAIL
();

483 
	}
}

494 
uöt8
 
	$HÆUARTBusyISR
( )

496  ((!(
UxCSR
 & (
CSR_ACTIVE
 | 
CSR_RX_BYTE
))) &&

497 (
i§Cfg
.
rxHód
 =i§Cfg.
rxTaû
Ë&& (i§Cfg.
txHód
 =i§Cfg.
txTaû
));

498 
	}
}

509 
	$HÆUARTSu•ídISR
( )

511 #i‡
deföed
 
POWER_SAVING


512 
UxCSR
 = 
CSR_MODE
;

514 i‡(
UxUCR
 & 
UCR_FLOW
)

516 
PxOUT
 |
HAL_UART_Px_RTS
;

517 
PxIFG
 = (
HAL_UART_Px_CTS
 ^ 0xFF);

518 
PxIEN
 |
HAL_UART_Px_CTS
;

522 
PxIFG
 = (
HAL_UART_Px_RX
 ^ 0xFF);

523 
PxIEN
 |
HAL_UART_Px_RX
;

526 #i‡
deföed
 
HAL_UART_GPIO_ISR


527 
PxIF
 = 0;

528 
PICTL
 |
PICTL_BIT
;

529 
IENx
 |
IEN_BIT
;

532 
	}
}

543 
	$HÆUARTResumeISR
( )

545 #i‡
deföed
 
POWER_SAVING


546 #i‡
deföed
 
HAL_UART_GPIO_ISR


547 
IENx
 &(
IEN_BIT
 ^ 0xFF);

550 i‡(
UxUCR
 & 
UCR_FLOW
)

552 
PxIEN
 &(
HAL_UART_Px_CTS
 ^ 0xFF);

553 
PxOUT
 &(
HAL_UART_Px_RTS
 ^ 0xFF);

557 
PxIEN
 &(
HAL_UART_Px_RX
 ^ 0xFF);

560 
UxUCR
 |
UCR_FLUSH
;

561 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

563 
	}
}

574 #i‡
deföed
 
HAL_SBL_BOOT_CODE


575 
	$hÆU¨tRxI§
()

577 #i‡(
HAL_UART_ISR
 == 1)

578 
	$HAL_ISR_FUNCTION
–
hÆU¨t0RxI§
, 
URX0_VECTOR
 )

580 
	$HAL_ISR_FUNCTION
–
hÆU¨t1RxI§
, 
URX1_VECTOR
 )

584 
	`HAL_ENTER_ISR
();

586 
uöt8
 
tmp
 = 
UxDBUF
;

587 
i§Cfg
.
rxBuf
[i§Cfg.
rxTaû
] = 
tmp
;

590 i‡(
i§Cfg
.
rxHód
 =i§Cfg.
rxTaû
)

592 
i§Cfg
.
rxShdw
 = 
ST0
;

595 i‡(++
i§Cfg
.
rxTaû
 >
HAL_UART_ISR_RX_MAX
)

597 
i§Cfg
.
rxTaû
 = 0;

600 
i§Cfg
.
rxTick
 = 
HAL_UART_ISR_IDLE
;

602 
	`HAL_EXIT_ISR
();

603 
	}
}

614 #i‡
deföed
 
HAL_SBL_BOOT_CODE


615 
	$hÆU¨tTxI§
()

617 #i‡(
HAL_UART_ISR
 == 1)

618 
	$HAL_ISR_FUNCTION
–
hÆU¨t0TxI§
, 
UTX0_VECTOR
 )

620 
	$HAL_ISR_FUNCTION
–
hÆU¨t1TxI§
, 
UTX1_VECTOR
 )

624 
	`HAL_ENTER_ISR
();

626 i‡(
i§Cfg
.
txHód
 =i§Cfg.
txTaû
)

628 
IEN2
 &~
UTXxIE
;

629 
i§Cfg
.
txMT
 = 1;

633 
UTXxIF
 = 0;

634 
UxDBUF
 = 
i§Cfg
.
txBuf
[i§Cfg.
txHód
++];

636 i‡(
i§Cfg
.
txHód
 >
HAL_UART_ISR_TX_MAX
)

638 
i§Cfg
.
txHód
 = 0;

642 
	`HAL_EXIT_ISR
();

643 
	}
}

645 #i‡(
deföed
 
POWER_SAVING
 && deföed 
HAL_UART_GPIO_ISR
)

655 #i‡(
HAL_UART_ISR
 == 1)

656 
	$HAL_ISR_FUNCTION
(
p‹t0I§
, 
P0INT_VECTOR
)

658 
	$HAL_ISR_FUNCTION
(
p‹t1I§
, 
P1INT_VECTOR
)

661 
	`HAL_ENTER_ISR
();

663 
	`HÆUARTResume
();

664 i‡(
dmaCfg
.
u¨tCB
 !
NULL
)

666 
dmaCfg
.
	`u¨tCB
(
HAL_UART_DMA
-1, 
HAL_UART_RX_WAKEUP
);

668 
PxIFG
 = 0;

669 
PxIF
 = 0;

671 
	`HAL_EXIT_ISR
();

672 
	}
}

	@Projects/ble/OADManager/Source/oad_mgr_app.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_PwrMgr.h
"

47 
	~"OnBﬂrd.h
"

48 
	~"hÆ_bﬂrd.h
"

49 
	~"hÆ_Êash.h
"

50 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

51 
	~"hÆ_key.h
"

53 #i‡(
deföed
 
HAL_LED
Ë&& (HAL_LED =
TRUE
)

54 
	~"hÆ_Àd.h
"

56 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

57 
	~"hÆ_lcd.h
"

59 
	~"g©t.h
"

60 
	~"g©t_uuid.h
"

61 
	~"Œ.h
"

62 
	~"hci.h
"

63 
	~"g≠g©t£rvî.h
"

64 
	~"g©t£rv≠p.h
"

65 
	~"˚¡øl.h
"

66 
	~"ﬂd.h
"

67 
	~"ﬂd_mgr_≠p.h
"

74 
	#B_ADDR_STR_LEN
 15

	)

81 
	#DEFAULT_MAX_SCAN_RES
 8

	)

84 
	#DEFAULT_SCAN_DURATION
 4000

	)

87 
	#DEFAULT_DISCOVERY_MODE
 
DEVDISC_MODE_ALL


	)

90 
	#DEFAULT_DISCOVERY_ACTIVE_SCAN
 
TRUE


	)

93 
	#DEFAULT_DISCOVERY_WHITE_LIST
 
FALSE


	)

96 
	#DEFAULT_LINK_HIGH_DUTY_CYCLE
 
FALSE


	)

99 
	#DEFAULT_LINK_WHITE_LIST
 
FALSE


	)

102 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

105 
	#DEFAULT_OAD_MIN_CONN_INTERVAL
 8

	)

108 
	#DEFAULT_OAD_MAX_CONN_INTERVAL
 8

	)

111 
	#DEFAULT_OAD_SLAVE_LATENCY
 0

	)

114 
	#DEFAULT_OAD_CONN_TIMEOUT
 600

	)

117 
	#DEFAULT_PASSCODE
 19655

	)

120 
	#DEFAULT_MITM_MODE
 
FALSE


	)

123 
	#DEFAULT_SVC_DISCOVERY_DELAY
 1000

	)

126 
	#DEFAULT_DEV_DISC_BY_SVC_UUID
 
FALSE


	)

131 
	mBLE_STATE_IDLE
,

132 
	mBLE_STATE_CONNECTING
,

133 
	mBLE_STATE_CONNECTED
,

134 
	mBLE_STATE_DISCONNECTING


140 
	mBLE_DISC_STATE_IDLE
,

141 
	mBLE_DISC_STATE_SVC
,

142 
	mBLE_DISC_STATE_CHAR


166 
uöt8
 
	gﬂdM™agîTaskId
;

169 c⁄° 
uöt8
 
	gﬂdM™agîDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "OAD Manager";

172 
uöt8
 
	gﬂdM™agîSˇnRes
;

173 
uöt8
 
	gﬂdM™agîSˇnIdx
;

176 
g≠DevRec_t
 
	gﬂdM™agîDevLi°
[
DEFAULT_MAX_SCAN_RES
];

179 
uöt8
 
	gﬂdM™agîSˇ¬ög
 = 
FALSE
;

182 
uöt16
 
	gﬂdM™agîC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

185 
uöt8
 
	gﬂdM™agîSèã
 = 
BLE_STATE_IDLE
;

187 
uöt8
 
	gﬂdM™agîDiscIdx
;

189 
uöt16
 
	gﬂdM™agîH™dÀs
[
OAD_CHAR_CNT
];

191 
uöt16
 
	gﬂdBlkNum
, 
	gﬂdBlkTŸ
;

193 
uöt8
 
	gﬂdM™agîAddr
[
B_ADDR_LEN
] = { 0 };

196 
uöt16
 
	gﬂdSvcSèπHdl
;

197 
uöt16
 
	gﬂdSvcEndHdl
;

199 
uöt8
 
	gﬂdM™agîCCCIdx
;

202 
uöt16
 
	gﬂdM™agîCCCH™dÀs
[
OAD_CHAR_CNT
];

207 
ﬂdM™agîPro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pPkt
 );

208 
ﬂdM™agîEvítCB
–
g≠CíåÆRﬁeEvít_t
 *
pEvít
 );

209 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

210 
ﬂdM™agî_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

212 
ﬂdM™agî_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

213 
ﬂdM™agîSvcDiscovîyMsg
–
g©tMsgEvít_t
 *
pMsg
 );

214 
ﬂdM™agîCCCDiscovîyMsg
–
g©tMsgEvít_t
 *
pMsg
 );

215 
ﬂdM™agîCh¨DiscovîyMsg
–
g©tMsgEvít_t
 *
pMsg
 );

216 
ﬂdM™agîEº‹R•
–
©tEº‹R•_t
 *
pR•
 );

217 
ﬂdM™agîSvcDiscovîy
( );

218 
ﬂdM™agîCCCDiscovîy
( );

219 
ﬂdM™agîCh¨Discovîy
( );

220 
ﬂdM™agîDevDiscovîy
( );

221 
boﬁ
 
ﬂdM™agîFödSîvUUID
–
uöt8
 *
pD©a
, uöt8 
d©aLí
 );

222 
ﬂdM™agîAddDevi˚Info
–
uöt8
 *
pAddr
, uöt8 
addrTy≥
 );

223 
ﬂdM™agîE«bÀNŸi
–
uöt16
 
h™dÀ
 );

224 
ﬂdM™agîH™dÀNŸi
(
©tH™dÀVÆueNŸi_t
 *
pNŸi
);

225 
ﬂdM™agîSídImgNŸify
();

226 *
bdAddr2Så
 ( 
uöt8
 *
pAddr
 );

228 
	~"sbl_exec_u¨t.c
"

235 c⁄° 
g≠CíåÆRﬁeCB_t
 
	gﬂdM™agîRﬁeCB
 =

237 
NULL
,

238 
ﬂdM™agîEvítCB


259 
	$OADM™agî_Inô
–
uöt8
 
èsk_id
 )

261 
ﬂdM™agîTaskId
 = 
èsk_id
;

265 
uöt8
 
sˇnRes
 = 
DEFAULT_MAX_SCAN_RES
;

266 
	`GAPCíåÆRﬁe_SëP¨amëî
 ( 
GAPCENTRALROLE_MAX_SCAN_RES
, –
uöt8
 ), &
sˇnRes
 );

270 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

271 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

272 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, (
uöt8
 *Ë
ﬂdM™agîDevi˚Name
 );

275 
VOID
 
	`GATT_InôClõ¡
();

278 
	`GATT_Regi°îF‹Ind
–
èsk_id
 );

280 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

282 
	`Regi°îF‹Keys
–
èsk_id
 );

284 #i‡(
deföed
 
HAL_LED
Ë&& (HAL_LED =
TRUE
)

285 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

289 
	`oßl_£t_evít
–
èsk_id
, 
START_DEVICE_EVT
 );

290 
	}
}

305 
uöt16
 
	$OADM™agî_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

307 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

309 
uöt8
 *
pMsg
;

311 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
èsk_id
 )Ë!
NULL
 )

313 
	`ﬂdM™agî_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

314 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

317  (
evíts
 ^ 
SYS_EVENT_MSG
);

320 i‡–
evíts
 & 
DEV_DISCOVERY_EVT
 )

322 
	`ﬂdM™agîDevDiscovîy
();

324  ( 
evíts
 ^ 
DEV_DISCOVERY_EVT
 );

327 i‡–
evíts
 & 
SVC_DISCOVERY_EVT
 )

329 
	`ﬂdM™agîSvcDiscovîy
();

331  ( 
evíts
 ^ 
SVC_DISCOVERY_EVT
 );

334 i‡–
evíts
 & 
CCC_DISCOVERY_EVT
 )

336 
	`ﬂdM™agîCCCDiscovîy
();

338  ( 
evíts
 ^ 
CCC_DISCOVERY_EVT
 );

341 i‡–
evíts
 & 
CHAR_DISCOVERY_EVT
 )

343 
	`ﬂdM™agîCh¨Discovîy
();

345  ( 
evíts
 ^ 
CHAR_DISCOVERY_EVT
 );

348 i‡–
evíts
 & 
CONN_INTERVAL_EVT
 )

350 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
SVC_DISCOVERY_EVT
);

352 
	`GAPCíåÆRﬁe_Upd©eLök
–
ﬂdM™agîC⁄nH™dÀ
,

353 
DEFAULT_OAD_MIN_CONN_INTERVAL
,

354 
DEFAULT_OAD_MAX_CONN_INTERVAL
,

355 
DEFAULT_OAD_SLAVE_LATENCY
,

356 
DEFAULT_OAD_CONN_TIMEOUT
 );

358  ( 
evíts
 ^ 
CONN_INTERVAL_EVT
 );

361 i‡–
evíts
 & 
START_DEVICE_EVT
 )

363 
VOID
 
	`GAPCíåÆRﬁe_SèπDevi˚
–(
g≠CíåÆRﬁeCB_t
 *Ë&
ﬂdM™agîRﬁeCB
 );

364 
	`ﬂdM™agîDevDiscovîy
();

366  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

369 i‡–
evíts
 & 
OAD_DOWNLOAD_EVT
 )

371 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

372 i‡–(
ﬂdBlkNum
 + 1Ë>
ﬂdBlkTŸ
 )

374 
	`LCD_WRITE_STRING
("OAD Com∂ëed!", 
HAL_LCD_LINE_3
);

378 
	`LCD_WRITE_STRING
("OAD Faûed!", 
HAL_LCD_LINE_3
);

382  ( 
evíts
 ^ 
OAD_DOWNLOAD_EVT
 );

386 
	}
}

397 
	$ﬂdM™agî_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

399  
pMsg
->
evít
 )

401 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

402 
KEY_CHANGE
:

404 i‡–
	`oßl_gë_timeoutEx
–
ﬂdM™agîTaskId
, 
OAD_DOWNLOAD_EVT
 ) == 0 )

406 
	`ﬂdM™agî_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

411 
GATT_MSG_EVENT
:

412 
	`ﬂdM™agîPro˚ssGATTMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

415 
	}
}

417 #i‡(
deföed
 
HAL_KEY
Ë&& (HAL_KEY =
TRUE
)

430 
	$ﬂdM™agî_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

432 ()
shi·
;

434 i‡–
keys
 & 
HAL_KEY_UP
 )

436 i‡–
ﬂdM™agîSèã
 !
BLE_STATE_CONNECTED
 )

438 i‡–!
ﬂdM™agîSˇ¬ög
 )

440 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
DEV_DISCOVERY_EVT
);

444 
	`GAPCíåÆRﬁe_C™˚lDiscovîy
();

449 i‡–
keys
 & 
HAL_KEY_LEFT
 )

452 i‡–!
ﬂdM™agîSˇ¬ög
 && 
ﬂdM™agîSˇnRes
 > 0 )

455 
ﬂdM™agîSˇnIdx
++;

456 i‡–
ﬂdM™agîSˇnIdx
 >
ﬂdM™agîSˇnRes
 )

458 
ﬂdM™agîSˇnIdx
 = 0;

461 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

462 
	`LCD_WRITE_STRING_VALUE
–"Devi˚", 
ﬂdM™agîSˇnIdx
 + 1, 10, 
HAL_LCD_LINE_1
 );

463 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
ﬂdM™agîDevLi°
[
ﬂdM™agîSˇnIdx
].
addr
 ), 
HAL_LCD_LINE_2
 );

468 i‡–
keys
 & 
HAL_KEY_RIGHT
 )

472 i‡–
keys
 & 
HAL_KEY_CENTER
 )

474 
uöt8
 
addrTy≥
;

475 
uöt8
 *
≥îAddr
;

478 i‡–
ﬂdM™agîSèã
 =
BLE_STATE_IDLE
 )

481 i‡–
ﬂdM™agîSˇnRes
 > 0 )

483 i‡–
ﬂdM™agîSˇnIdx
 < 
ﬂdM™agîSˇnRes
 )

486 
≥îAddr
 = 
ﬂdM™agîDevLi°
[
ﬂdM™agîSˇnIdx
].
addr
;

487 
addrTy≥
 = 
ﬂdM™agîDevLi°
[
ﬂdM™agîSˇnIdx
].addrType;

489 
ﬂdM™agîSèã
 = 
BLE_STATE_CONNECTING
;

491 
	`GAPCíåÆRﬁe_E°ablishLök
–
DEFAULT_LINK_HIGH_DUTY_CYCLE
,

492 
DEFAULT_LINK_WHITE_LIST
,

493 
addrTy≥
, 
≥îAddr
 );

495 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

496 
	`LCD_WRITE_STRING
–"C⁄√˘ög", 
HAL_LCD_LINE_1
 );

497 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
≥îAddr
 ), 
HAL_LCD_LINE_2
 );

501 
	`LCD_WRITE_STRING
–"Sñe˘ devi˚", 
HAL_LCD_LINE_3
 );

506 i‡–
ﬂdM™agîSèã
 =
BLE_STATE_CONNECTING
 || oadM™agîSèã =
BLE_STATE_CONNECTED
 )

509 
ﬂdM™agîSèã
 = 
BLE_STATE_DISCONNECTING
;

511 
VOID
 
	`GAPCíåÆRﬁe_Tîmö©eLök
–
ﬂdM™agîC⁄nH™dÀ
 );

513 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

514 
	`LCD_WRITE_STRING
–"Disc⁄√˘ög", 
HAL_LCD_LINE_1
 );

515 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

516 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

521 i‡–
keys
 & 
HAL_KEY_DOWN
 )

523 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

524 
	`LCD_WRITE_STRING
("SBL Mode...", 
HAL_LCD_LINE_3
);

526 
EA
 = 0;

527 
	`sblRun
();

528 
EA
 = 1;

529 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

530 
	`LCD_WRITE_STRING
("SBL D⁄e.", 
HAL_LCD_LINE_3
);

533 
	}
}

543 
	$ﬂdM™agîPro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pPkt
 )

545 i‡(
ﬂdM™agîSèã
 !
BLE_STATE_CONNECTED
)

550 
pPkt
->
mëhod
)

552 
ATT_FIND_BY_TYPE_VALUE_RSP
:

553 
	`ﬂdM™agîSvcDiscovîyMsg
–
pPkt
 );

556 
ATT_FIND_INFO_RSP
:

557 
	`ﬂdM™agîCCCDiscovîyMsg
–
pPkt
 );

560 
ATT_READ_BY_TYPE_RSP
:

561 
	`ﬂdM™agîCh¨DiscovîyMsg
–
pPkt
 );

564 
ATT_HANDLE_VALUE_NOTI
:

565 
ATT_HANDLE_VALUE_IND
:

566 i‡(
pPkt
->
hdr
.
°©us
 =
SUCCESS
)

568 
	`ﬂdM™agîH™dÀNŸi
(&(
pPkt
->
msg
.
h™dÀVÆueNŸi
));

572 
ATT_ERROR_RSP
:

573 
	`ﬂdM™agîEº‹R•
–&(
pPkt
->
msg
.
îr‹R•
) );

579 
	}
}

590 
	$ﬂdM™agîEvítCB
–
g≠CíåÆRﬁeEvít_t
 *
pEvít
 )

592  
pEvít
->
g≠
.
›code
 )

594 
GAP_DEVICE_INIT_DONE_EVENT
:

596 
VOID
 
	`oßl_mem˝y
–
ﬂdM™agîAddr
, 
pEvít
->
öôD⁄e
.
devAddr
, 
B_ADDR_LEN
 );

598 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

599 
	`LCD_WRITE_STRING
–"OAD M™agî", 
HAL_LCD_LINE_1
 );

600 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
ﬂdM™agîAddr
 ), 
HAL_LCD_LINE_2
 );

605 
GAP_DEVICE_INFO_EVENT
:

608 i‡–
DEFAULT_DEV_DISC_BY_SVC_UUID
 =
TRUE
 )

610 i‡–
	`ﬂdM™agîFödSîvUUID
–
pEvít
->
devi˚Info
.
pEvtD©a
,ÖEvít->devi˚Info.
d©aLí
 ) )

612 
	`ﬂdM™agîAddDevi˚Info
–
pEvít
->
devi˚Info
.
addr
,ÖEvít->devi˚Info.
addrTy≥
 );

618 
GAP_DEVICE_DISCOVERY_EVENT
:

621 
ﬂdM™agîSˇ¬ög
 = 
FALSE
;

624 i‡–
DEFAULT_DEV_DISC_BY_SVC_UUID
 =
FALSE
 )

627 
ﬂdM™agîSˇnRes
 = 
pEvít
->
discCm∂
.
numDevs
;

628 
	`oßl_mem˝y
–
ﬂdM™agîDevLi°
, 
pEvít
->
discCm∂
.
pDevLi°
,

629 (–
g≠DevRec_t
 ) * 
pEvít
->
discCm∂
.
numDevs
) );

632 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

633 
	`LCD_WRITE_STRING_VALUE
–"Devi˚†Found", 
ﬂdM™agîSˇnRes
, 10, 
HAL_LCD_LINE_1
 );

634 i‡–
ﬂdM™agîSˇnRes
 > 0 )

636 
	`LCD_WRITE_STRING
–"<- TÿSñe˘", 
HAL_LCD_LINE_2
 );

640 
ﬂdM™agîSˇnIdx
 = 
ﬂdM™agîSˇnRes
;

644 
GAP_LINK_ESTABLISHED_EVENT
:

646 i‡–
pEvít
->
g≠
.
hdr
.
°©us
 =
SUCCESS
 )

648 
ﬂdM™agîSèã
 = 
BLE_STATE_CONNECTED
;

649 
ﬂdM™agîC⁄nH™dÀ
 = 
pEvít
->
lökCm∂
.
c⁄√˘i⁄H™dÀ
;

651 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
CONN_INTERVAL_EVT
);

653 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

654 
	`LCD_WRITE_STRING
–"C⁄√˘ed", 
HAL_LCD_LINE_1
 );

655 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

660 
ﬂdM™agîSèã
 = 
BLE_STATE_IDLE
;

661 
ﬂdM™agîC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

666 
GAP_LINK_TERMINATED_EVENT
:

668 
ﬂdM™agîSèã
 = 
BLE_STATE_IDLE
;

669 
ﬂdM™agîC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

671 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

672 
	`LCD_WRITE_STRING
–"OAD M™agî", 
HAL_LCD_LINE_1
 );

673 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
ﬂdM™agîAddr
 ), 
HAL_LCD_LINE_2
 );

674 
	`LCD_WRITE_STRING
–"Disc⁄√˘ed", 
HAL_LCD_LINE_3
 );

682 
	}
}

691 
	$ﬂdM™agîSvcDiscovîy
()

693 
uöt8
 
ﬂdSîvUUID
[
ATT_UUID_SIZE
] = { 
	`TI_BASE_UUID_128
–
OAD_SERVICE_UUID
 ) };

696 
ﬂdSvcSèπHdl
 = 
ﬂdSvcEndHdl
 = 0;

698 i‡(
	`GATT_DiscPrim¨ySîvi˚ByUUID
(
ﬂdM™agîC⁄nH™dÀ
, 
ﬂdSîvUUID
,

699 
ATT_UUID_SIZE
, 
ﬂdM™agîTaskId
Ë!
SUCCESS
)

701 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
SVC_DISCOVERY_EVT
);

703 
	}
}

712 
	$ﬂdM™agîCCCDiscovîy
()

715 
ﬂdM™agîCCCIdx
 = 0;

718 i‡(
	`GATT_DiscAŒCh¨Descs
(
ﬂdM™agîC⁄nH™dÀ
, 
ﬂdSvcSèπHdl
,

719 
ﬂdSvcEndHdl
, 
ﬂdM™agîTaskId
Ë!
SUCCESS
)

721 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
CCC_DISCOVERY_EVT
);

723 
	}
}

732 
	$ﬂdM™agîCh¨Discovîy
()

734 
©tRódByTy≥Req_t
 
ªq
;

736 
ªq
.
°¨tH™dÀ
 = 
ﬂdSvcSèπHdl
;

737 
ªq
.
ídH™dÀ
 = 
ﬂdSvcEndHdl
;

738 
ªq
.
ty≥
.
Àn
 = 
ATT_UUID_SIZE
;

740 i‡–
ﬂdM™agîDiscIdx
 == 0 )

742 
uöt8
 
ﬂdCh¨UUID
[
ATT_UUID_SIZE
] = { 
	`TI_BASE_UUID_128
–
OAD_IMG_IDENTIFY_UUID
 ) };

744 ()
	`oßl_mem˝y
(
ªq
.
ty≥
.
uuid
, 
ﬂdCh¨UUID
, 
ATT_UUID_SIZE
);

748 
uöt8
 
ﬂdCh¨UUID
[
ATT_UUID_SIZE
] = { 
	`TI_BASE_UUID_128
–
OAD_IMG_BLOCK_UUID
 ) };

750 ()
	`oßl_mem˝y
(
ªq
.
ty≥
.
uuid
, 
ﬂdCh¨UUID
, 
ATT_UUID_SIZE
);

753 i‡(
	`GATT_DiscCh¨sByUUID
(
ﬂdM™agîC⁄nH™dÀ
, &
ªq
, 
ﬂdM™agîTaskId
Ë!
SUCCESS
)

755 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
CHAR_DISCOVERY_EVT
);

757 
	}
}

766 
	$ﬂdM™agîDevDiscovîy
()

768 
ﬂdM™agîSˇ¬ög
 = 
TRUE
;

769 
ﬂdM™agîSˇnRes
 = 0;

771 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

772 
	`LCD_WRITE_STRING
–"Discovîög...", 
HAL_LCD_LINE_1
 );

773 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

774 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_3
 );

777 
	`GAPCíåÆRﬁe_SèπDiscovîy
–
DEFAULT_DISCOVERY_MODE
,

778 
DEFAULT_DISCOVERY_ACTIVE_SCAN
,

779 
DEFAULT_DISCOVERY_WHITE_LIST
 );

780 
	}
}

789 
	$ﬂdM™agîSvcDiscovîyMsg
(
g©tMsgEvít_t
 *
pMsg
)

791 i‡–
pMsg
->
hdr
.
°©us
 =
SUCCESS
 )

793 
©tFödByTy≥VÆueR•_t
 *
pR•
 = &(
pMsg
->
msg
.
födByTy≥VÆueR•
);

795 i‡–
pR•
->
numInfo
 > 0 )

797 
ﬂdSvcSèπHdl
 = 
pR•
->
h™dÀsInfo
[0].
h™dÀ
;

798 
ﬂdSvcEndHdl
 = 
pR•
->
h™dÀsInfo
[0].
gΩEndH™dÀ
;

800 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

801 
	`LCD_WRITE_STRING
("OAD Sv¯Found!", 
HAL_LCD_LINE_1
);

804 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
CCC_DISCOVERY_EVT
);

807 i‡–
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 )

809 i‡–
ﬂdSvcSèπHdl
 == 0 )

811 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

812 
	`LCD_WRITE_STRING
("OAD SvcNŸFound", 
HAL_LCD_LINE_3
);

816 
	}
}

825 
	$ﬂdM™agîCCCDiscovîyMsg
(
g©tMsgEvít_t
 *
pMsg
)

827 i‡(
ﬂdM™agîCCCIdx
 < 
OAD_CHAR_CNT
)

829 i‡–
pMsg
->
hdr
.
°©us
 =
SUCCESS
 )

831 
©tFödInfoR•_t
 *
pR•
 = &(
pMsg
->
msg
.
födInfoR•
);

833 i‡––
pR•
->
numInfo
 > 0 ) && (ÖR•->
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 ) )

836  
uöt8
 
i
 = 0; i < 
pR•
->
numInfo
; i++ )

839 i‡––
pR•
->
öfo
.
btPaú
[
i
].
uuid
[0] =
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
) ) &&

840 –
pR•
->
öfo
.
btPaú
[
i
].
uuid
[1] =
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
) ) )

843 
ﬂdM™agîCCCH™dÀs
[
ﬂdM™agîCCCIdx
] = 
pR•
->
öfo
.
btPaú
[
i
].
h™dÀ
;

845 i‡(++
ﬂdM™agîCCCIdx
 =
OAD_CHAR_CNT
)

847 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

848 
	`LCD_WRITE_STRING
("OAD CCCD†Found!", 
HAL_LCD_LINE_1
);

851 
	`ﬂdM™agîE«bÀNŸi
–
ﬂdM™agîCCCH™dÀs
[
OAD_CHAR_IMG_IDENTIFY
] );

852 
	`ﬂdM™agîE«bÀNŸi
–
ﬂdM™agîCCCH™dÀs
[
OAD_CHAR_IMG_BLOCK
] );

854 
ﬂdM™agîDiscIdx
 = 0;

855 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
CHAR_DISCOVERY_EVT
);

863 i‡–
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 )

865 i‡(
ﬂdM™agîCCCIdx
 < 
OAD_CHAR_CNT
)

867 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

868 
	`LCD_WRITE_STRING
("OAD CCCDNŸFound", 
HAL_LCD_LINE_3
);

873 
	}
}

882 
	$ﬂdM™agîCh¨DiscovîyMsg
(
g©tMsgEvít_t
 *
pMsg
)

884 i‡(
ﬂdM™agîDiscIdx
 < 
OAD_CHAR_CNT
)

886 i‡–
pMsg
->
hdr
.
°©us
 =
SUCCESS
 )

888 
©tRódByTy≥R•_t
 *
pR•
 = &(
pMsg
->
msg
.
ªadByTy≥R•
);

890 i‡(
pR•
->
numPaús
 > 0)

892 
ﬂdM™agîH™dÀs
[
ﬂdM™agîDiscIdx
] = 
	`BUILD_UINT16
(
pR•
->
d©aLi°
[3],ÖRsp->dataList[4]);

894 i‡(++
ﬂdM™agîDiscIdx
 =
OAD_CHAR_CNT
)

896 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

897 
	`LCD_WRITE_STRING
("OAD Ch¨†Found!", 
HAL_LCD_LINE_1
);

899 
	`ﬂdM™agîSídImgNŸify
();

905 ()
	`oßl_£t_evít
(
ﬂdM™agîTaskId
, 
CHAR_DISCOVERY_EVT
);

907 i‡–
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 )

909 i‡(
ﬂdM™agîDiscIdx
 < 
OAD_CHAR_CNT
)

911 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

912 
	`LCD_WRITE_STRING
("OAD Ch¨NŸFound", 
HAL_LCD_LINE_3
);

917 
	}
}

926 
	$ﬂdM™agîEº‹R•
–
©tEº‹R•_t
 *
pR•
 )

928 i‡–
pR•
->
îrCode
 =
ATT_ERR_ATTR_NOT_FOUND
 )

930  
pR•
->
ªqOpcode
 )

932 
ATT_FIND_BY_TYPE_VALUE_REQ
:

933 i‡–
ﬂdSvcSèπHdl
 == 0 )

935 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

936 
	`LCD_WRITE_STRING
("OAD SvcNŸFound", 
HAL_LCD_LINE_3
);

941 
ATT_FIND_INFO_RSP
:

942 i‡(
ﬂdM™agîCCCIdx
 < 
OAD_CHAR_CNT
)

944 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

945 
	`LCD_WRITE_STRING
("OAD CCCDNŸFound", 
HAL_LCD_LINE_3
);

950 
ATT_READ_BY_TYPE_RSP
:

951 i‡(
ﬂdM™agîDiscIdx
 < 
OAD_CHAR_CNT
)

953 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

954 
	`LCD_WRITE_STRING
("OAD Ch¨NŸFound", 
HAL_LCD_LINE_3
);

963 
	}
}

972 
boﬁ
 
	$ﬂdM™agîFödSîvUUID
–
uöt8
 *
pD©a
, uöt8 
d©aLí
 )

974 
uöt8
 
adLí
;

975 
uöt8
 
adTy≥
;

976 
uöt8
 *
pEnd
;

978 
pEnd
 = 
pD©a
 + 
d©aLí
 - 1;

981  
pD©a
 < 
pEnd
 )

984 
adLí
 = *
pD©a
++;

985 i‡–
adLí
 > 0 )

987 
adTy≥
 = *
pD©a
;

989 i‡–
adTy≥
 =
GAP_ADTYPE_128BIT_MORE
 ||ádTy≥ =
GAP_ADTYPE_128BIT_COMPLETE
 )

991 
pD©a
++;

992 
adLí
--;

994 (
adLí
 >
ATT_UUID_SIZE
Ë&& (
pD©a
 < 
pEnd
))

996 
uöt8
 
ﬂdSîvUUID
[
ATT_UUID_SIZE
] = { 
	`TI_BASE_UUID_128
–
OAD_SERVICE_UUID
 ) };

998 i‡(
	`oßl_memcmp
(
pD©a
, 
ﬂdSîvUUID
, 
ATT_UUID_SIZE
))

1000  
TRUE
;

1004 
pD©a
 +
ATT_UUID_SIZE
;

1005 
adLí
 -
ATT_UUID_SIZE
;

1009 i‡–
adLí
 == 1 )

1011 
pD©a
++;

1016 
pD©a
 +
adLí
;

1021  
FALSE
;

1022 
	}
}

1031 
	$ﬂdM™agîAddDevi˚Info
–
uöt8
 *
pAddr
, uöt8 
addrTy≥
 )

1033 
uöt8
 
i
;

1036 i‡–
ﬂdM™agîSˇnRes
 < 
DEFAULT_MAX_SCAN_RES
 )

1039  
i
 = 0; i < 
ﬂdM™agîSˇnRes
; i++ )

1041 i‡–
	`oßl_memcmp
–
pAddr
, 
ﬂdM™agîDevLi°
[
i
].
addr
 , 
B_ADDR_LEN
 ) )

1048 
	`oßl_mem˝y
–
ﬂdM™agîDevLi°
[
ﬂdM™agîSˇnRes
].
addr
, 
pAddr
, 
B_ADDR_LEN
 );

1049 
ﬂdM™agîDevLi°
[
ﬂdM™agîSˇnRes
].
addrTy≥
 =áddrType;

1052 
ﬂdM™agîSˇnRes
++;

1054 
	}
}

1063 
	$ﬂdM™agîE«bÀNŸi
–
uöt16
 
h™dÀ
 )

1065 
©tWrôeReq_t
 
ªq
;

1067 
ªq
.
h™dÀ
 = handle;

1068 
ªq
.
Àn
 = 2;

1069 
ªq
.
sig
 = 
FALSE
;

1070 
ªq
.
cmd
 = 
TRUE
;

1072 
ªq
.
vÆue
[0] = 
	`LO_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

1073 
ªq
.
vÆue
[1] = 
	`HI_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

1075 
VOID
 
	`GATT_WrôeNoR•
(
ﬂdM™agîC⁄nH™dÀ
, &
ªq
);

1076 
	}
}

1085 
	$ﬂdM™agîH™dÀNŸi
(
©tH™dÀVÆueNŸi_t
 *
pNŸi
)

1087 i‡(
pNŸi
->
h™dÀ
 =
ﬂdM™agîH™dÀs
[
OAD_CHAR_IMG_IDENTIFY
])

1089 #i‡(
deföed
 
HAL_LCD
 && (HAL_LCD =
TRUE
))

1090 
uöt16
 
vî
 = 
	`BUILD_UINT16
(
pNŸi
->
vÆue
[0],ÖNoti->value[1]);

1091 
uöt8
 
u£rId
[12] = "UserId ";

1093 
	`oßl_mem˝y
(&(
u£rId
[7]), &(
pNŸi
->
vÆue
[4]), 4);

1094 
u£rId
[11] = '\0';

1096 i‡–
	`OAD_IMG_ID
–
vî
 ) == 0 )

1098 
	`HÆLcdWrôeSåögVÆueVÆue
("ImgA Id", 
	`OAD_VER_NUM
–
vî
 ), 16,

1099 
	`BUILD_UINT16
(
pNŸi
->
vÆue
[2],ÖNoti->value[3]), 16,

1100 
HAL_LCD_LINE_2
);

1104 
	`HÆLcdWrôeSåögVÆueVÆue
("ImgB Id", 
	`OAD_VER_NUM
–
vî
 ), 16,

1105 
	`BUILD_UINT16
(
pNŸi
->
vÆue
[2],ÖNoti->value[3]), 16,

1106 
HAL_LCD_LINE_2
);

1109 
	`HÆLcdWrôeSåög
((*)
u£rId
, 
HAL_LCD_LINE_3
);

1112 i‡(
pNŸi
->
h™dÀ
 =
ﬂdM™agîH™dÀs
[
OAD_CHAR_IMG_BLOCK
])

1114 
ﬂdBlkNum
 = 
	`BUILD_UINT16
(
pNŸi
->
vÆue
[0],ÖNoti->value[1]);

1115 
©tWrôeReq_t
 
ªq
;

1117 
ªq
.
h™dÀ
 = 
ﬂdM™agîH™dÀs
[
OAD_CHAR_IMG_BLOCK
];

1118 
ªq
.
Àn
 = 2 + 
OAD_BLOCK_SIZE
;

1119 
ªq
.
sig
 = 
FALSE
;

1120 
ªq
.
cmd
 = 
TRUE
;

1122 
ªq
.
vÆue
[0] = 
	`LO_UINT16
(
ﬂdBlkNum
);

1123 
ªq
.
vÆue
[1] = 
	`HI_UINT16
(
ﬂdBlkNum
);

1125 
uöt8
 
∑ge
 = 
ﬂdBlkNum
 / 
OAD_BLOCKS_PER_PAGE
;

1126 
uöt16
 
o£t
 = (
ﬂdBlkNum
 - (
OAD_BLOCKS_PER_PAGE
 * 
∑ge
)Ë* 
OAD_BLOCK_SIZE
;

1127 
	`HÆFœshRód
(
∑ge
+
OAD_IMG_B_PAGE
, 
o£t
, 
ªq
.
vÆue
+2, 
OAD_BLOCK_SIZE
);

1129 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

1130 i‡(
ﬂdBlkNum
 == 0)

1132 
	`HÆLcdWrôeSåög
("", 
HAL_LCD_LINE_3
);

1134 
	`HÆLcdDi•œyPî˚¡B¨
–"OAD Progªss...", (
ﬂdBlkNum
 / (
ﬂdBlkTŸ
 / 100)) );

1137 
VOID
 
	`GATT_WrôeNoR•
(
ﬂdM™agîC⁄nH™dÀ
, &
ªq
);

1139 
VOID
 
	`oßl_°¨t_timîEx
–
ﬂdM™agîTaskId
, 
OAD_DOWNLOAD_EVT
, 
OAD_DOWNLOAD_TIMEOUT
 );

1141 
	}
}

1150 
	$ﬂdM™agîSídImgNŸify
()

1152 
©tWrôeReq_t
 
ªq
;

1153 
img_hdr_t
 
ImgHdr
;

1155 
	`HÆFœshRód
(
OAD_IMG_B_PAGE
, 
OAD_IMG_HDR_OSET
, (
uöt8
 *)&
ImgHdr
, (
img_hdr_t
));

1157 
ªq
.
h™dÀ
 = 
ﬂdM™agîH™dÀs
[
OAD_CHAR_IMG_IDENTIFY
];

1158 
ªq
.
Àn
 = 
OAD_IMG_HDR_SIZE
;

1159 
ªq
.
vÆue
[0] = 
	`LO_UINT16
(
ImgHdr
.
vî
);

1160 
ªq
.
vÆue
[1] = 
	`HI_UINT16
(
ImgHdr
.
vî
);

1162 
ªq
.
vÆue
[2] = 
	`LO_UINT16
(
ImgHdr
.
Àn
);

1163 
ªq
.
vÆue
[3] = 
	`HI_UINT16
(
ImgHdr
.
Àn
);

1165 ()
	`oßl_mem˝y
(
ªq
.
vÆue
+4, 
ImgHdr
.
uid
, (ImgHdr.uid));

1167 
ªq
.
sig
 = 
FALSE
;

1168 
ªq
.
cmd
 = 
TRUE
;

1170 
VOID
 
	`GATT_WrôeNoR•
(
ﬂdM™agîC⁄nH™dÀ
, &
ªq
);

1173 
ﬂdBlkTŸ
 = 
ImgHdr
.
Àn
 / (
OAD_BLOCK_SIZE
 / 
HAL_FLASH_WORD_SIZE
);

1174 
	}
}

1183 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

1185 
uöt8
 
i
;

1186 
hex
[] = "0123456789ABCDEF";

1187 
°r
[
B_ADDR_STR_LEN
];

1188 *
pSå
 = 
°r
;

1190 *
pSå
++ = '0';

1191 *
pSå
++ = 'x';

1194 
pAddr
 +
B_ADDR_LEN
;

1196  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

1198 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

1199 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

1202 *
pSå
 = 0;

1204  
°r
;

1205 
	}
}

	@Projects/ble/OADManager/Source/oad_mgr_app.h

39 #i‚de‡
OAD_MANAGER_H


40 
	#OAD_MANAGER_H


	)

42 #ifde‡
__˝lu•lus


56 
	#OAD_DOWNLOAD_EVT
 0x0040

	)

57 
	#DEV_DISCOVERY_EVT
 0x0020

	)

58 
	#CHAR_DISCOVERY_EVT
 0x0010

	)

59 
	#CCC_DISCOVERY_EVT
 0x0008

	)

60 
	#SVC_DISCOVERY_EVT
 0x0004

	)

61 
	#CONN_INTERVAL_EVT
 0x0002

	)

62 
	#START_DEVICE_EVT
 0x0001

	)

64 
	#OAD_DOWNLOAD_TIMEOUT
 2000

65 

	)

71 #i‡
HAL_LCD
 =
TRUE


72 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
Ë
	`HÆLcdWrôeSåög
–(°r), (›ti⁄))

	)

73 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
Ë
	`HÆLcdWrôeS¸ìn
–÷öe1), (löe2Ë)

	)

74 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
Ë
	`HÆLcdWrôeSåögVÆue
–—ôÀ), (vÆue), (f‹m©), (löeË)

	)

76 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
)

	)

77 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
)

	)

78 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
)

	)

88 
OADM™agî_Inô
–
uöt8
 
èsk_id
 );

93 
uöt16
 
OADM™agî_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

95 #ifde‡
__˝lu•lus


	@Projects/ble/OADManager/Source/oad_mgr_main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

72 
	$maö
()

75 
	`HAL_BOARD_INIT
();

78 
	`InôBﬂrd
–
OB_COLD
 );

81 
	`HÆDrivîInô
();

84 
	`oßl_¢v_öô
();

89 
	`oßl_öô_sy°em
();

92 
	`HAL_ENABLE_INTERRUPTS
();

95 
	`InôBﬂrd
–
OB_READY
 );

97 #i‡
	`deföed
 ( 
POWER_SAVING
 )

98 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

102 
	`oßl_°¨t_sy°em
();

105 
	}
}

	@Projects/ble/OADManager/Source/osal_oad_mgr.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

68 
	~"g©t.h
"

70 
	~"g©t£rv≠p.h
"

73 
	~"˚¡øl.h
"

74 
	~"ﬂd.h
"

77 
	~"ﬂd_mgr_≠p.h
"

84 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

86 
LL_Pro˚ssEvít
,

87 
HÆ_Pro˚ssEvít
,

88 
HCI_Pro˚ssEvít
,

89 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

90 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

92 
L2CAP_Pro˚ssEvít
,

93 
GAP_Pro˚ssEvít
,

94 
GATT_Pro˚ssEvít
,

95 
SM_Pro˚ssEvít
,

96 
GAPCíåÆRﬁe_Pro˚ssEvít
,

97 
OADM™agî_Pro˚ssEvít


100 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

101 
uöt16
 *
	gèsksEvíts
;

116 
	$oßlInôTasks
( )

118 
uöt8
 
èskID
 = 0;

120 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

121 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

124 
	`LL_Inô
–
èskID
++ );

127 
	`HÆ_Inô
–
èskID
++ );

130 
	`HCI_Inô
–
èskID
++ );

132 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

134 
	`oßl_CbTimîInô
–
èskID
 );

135 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

139 
	`L2CAP_Inô
–
èskID
++ );

142 
	`GAP_Inô
–
èskID
++ );

145 
	`GATT_Inô
–
èskID
++ );

148 
	`SM_Inô
–
èskID
++ );

151 
	`GAPCíåÆRﬁe_Inô
–
èskID
++ );

154 
	`OADM™agî_Inô
–
èskID
 );

155 
	}
}

	@Projects/ble/OADManager/Source/sbl_exec.h

41 #i‚de‡
SBL_EXEC_H


42 
	#SBL_EXEC_H


	)

49 
	~"comdef.h
"

50 
	~"hÆ_Ωc.h
"

59 
	#SBL_PAGE_SIZE
 (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
)

	)

61 
	#SBL_FORCE_BOOT
 0xF8

	)

62 
	#SBL_FORCE_RUN
 (
SBL_FORCE_BOOT
 ^ 0xFF)

	)

64 
	#SBL_RW_BUF_LEN
 64

	)

67 
	#SBL_WRITE_CMD
 0x01

	)

68 
	#SBL_READ_CMD
 0x02

	)

69 
	#SBL_ENABLE_CMD
 0x03

	)

70 
	#SBL_HANDSHAKE_CMD
 0x04

	)

74 
	#SBL_SKIP_ADDR_BEG_CMD
 0x08

	)

80 
	#SBL_CODE_ADDR_END_CMD
 0x09

	)

83 
	#SBL_TGT_BOOTLOAD
 0x10

84 

	)

87 
	#SBL_RSP_MASK
 0x80

	)

90 
	#SBL_SUCCESS
 0

	)

91 
	#SBL_FAILURE
 1

	)

92 
	#SBL_INVALID_FCS
 2

	)

93 
	#SBL_INVALID_FILE
 3

	)

94 
	#SBL_FILESYSTEM_ERROR
 4

	)

95 
	#SBL_ALREADY_STARTED
 5

	)

96 
	#SBL_NO_RESPOSNE
 6

	)

97 
	#SBL_VALIDATE_FAILED
 7

	)

98 
	#SBL_CANCELED
 8

	)

99 
	#SBL_IGNORED
 9

	)

102 
	#SBL_REQ_ADDR_LSB
 
RPC_POS_DAT0


	)

103 
	#SBL_REQ_ADDR_MSB
 (
SBL_REQ_ADDR_LSB
+1)

	)

104 
	#SBL_REQ_DAT0
 (
SBL_REQ_ADDR_MSB
+1)

	)

105 
	#SBL_RSP_STATUS
 
RPC_POS_DAT0


	)

106 
	#SBL_RSP_ADDR_LSB
 (
SBL_RSP_STATUS
+1)

	)

107 
	#SBL_RSP_ADDR_MSB
 (
SBL_RSP_ADDR_LSB
+1)

	)

108 
	#SBL_RSP_DAT0
 (
SBL_RSP_ADDR_MSB
+1)

	)

109 
	#SBL_READ_HDR_LEN
 (
SBL_RSP_DAT0
 - 
SBL_RSP_STATUS
)

	)

131 
uöt8
 
sblInô
();

148 
sblExec
(
uöt8
 *
pBuf
);

	@Projects/ble/OADManager/Source/sbl_exec_uart.c

48 
	~"hÆ_bﬂrd.h
"

49 
	~"hÆ_mcu.h
"

50 
	~"hÆ_Ωc.h
"

51 
	~"hÆ_u¨t.h
"

52 
	~"ﬂd.h
"

53 
	~"sbl_exec.h
"

61 
	#SBL_SOF_STATE
 0

	)

62 
	#SBL_LEN_STATE
 1

	)

63 
	#SBL_CMD1_STATE
 2

	)

64 
	#SBL_CMD2_STATE
 3

	)

65 
	#SBL_DATA_STATE
 4

	)

66 
	#SBL_FCS_STATE
 5

	)

69 
	#SBL_BUF_SIZE
 256

	)

70 
	#SBL_MAX_SIZE
 (
SBL_BUF_SIZE
 - 
SBL_FCS_STATE
)

	)

72 
	#OAD_DONGLE_PAGE_MULT
 ((
uöt16
)(
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
))

	)

73 
	#OAD_DONGLE_SBL_IMG_MAX
 64

	)

74 
	#OAD_DONGLE_SBL_IMG_BEG
 (
OAD_IMG_B_PAGE
 * 
OAD_DONGLE_PAGE_MULT
)

	)

75 
	#OAD_DONGLE_SBL_IMG_END
 (
OAD_DONGLE_SBL_IMG_BEG
 + \

76 
OAD_DONGLE_SBL_IMG_MAX
 * 
OAD_DONGLE_PAGE_MULT
)

	)

83 
uöt8
 
	gsbBuf
[
SBL_BUF_SIZE
], 
	gsbFcs
, 
	gsbIdx
, 
	gsbLí
, 
	gsbSã
;

84 
uöt8
 
	gtxIdx
, 
	gtxLí
;

91 
uöt8
 
sblP¨£
(uöt8 
ch
);

92 
uöt8
 
sblRe•
();

93 
sblExec
(
uöt8
 *
pBuf
);

95 
	~"_hÆ_u¨t_i§_sbl.c
"

112 
	$sblHÆInô
()

114 
hÆUARTCfg_t
 
u¨tC⁄fig
;

115 
	`HÆUARTInôISR
();

116 
u¨tC⁄fig
.
c⁄figuªd
 = 
TRUE
;

117 
u¨tC⁄fig
.
baudR©e
 = 
HAL_UART_BR_115200
;

118 
u¨tC⁄fig
.
ÊowC⁄åﬁ
 = 
FALSE
;

119 
u¨tC⁄fig
.
ÊowC⁄åﬁThªshﬁd
 = 0;

120 
u¨tC⁄fig
.
rx
.
maxBufSize
 = 0;

121 
u¨tC⁄fig
.
tx
.
maxBufSize
 = 0;

122 
u¨tC⁄fig
.
idÀTimeout
 = 0;

123 
u¨tC⁄fig
.
ötE«bÀ
 = 
TRUE
;

124 
u¨tC⁄fig
.
ˇŒBackFunc
 = 
NULL
;

125 
	`HÆUARTO≥nISR
(&
u¨tC⁄fig
);

126 
	}
}

143 
	$sblRun
()

145 
uöt8
 
ª£tF
 = 0;

146 
	`sblHÆInô
();

150 i‡(
txLí
 == 0)

152 i‡((
ª£tF
 !0Ë&& ((
UxCSR
 & 
CSR_ACTIVE
) == 0))

157 i‡(
UTXxIF
 != 0)

159 i‡(--
txLí
 != 0)

161 
UTXxIF
 = 0;

164 
UxDBUF
 = 
sbBuf
[
txIdx
++];

167 i‡(
URXxIF
)

169 
uöt8
 
ch
 = 
UxDBUF
;

170 
URXxIF
 = 0;

171 
ª£tF
 |
	`sblP¨£
(
ch
);

174 
	}
}

191 
uöt8
 
	$sblP¨£
(
uöt8
 
ch
)

193 
sbBuf
[
sbSã
 + 
sbIdx
] = 
ch
;

195 
sbSã
)

197 
SBL_SOF_STATE
:

198 i‡(
RPC_UART_SOF
 =
ch
)

200 
sbSã
 = 
SBL_LEN_STATE
;

204 
SBL_LEN_STATE
:

205 
sbFcs
 = 
sbIdx
 = 0;

206 
sbSã
 = 
SBL_CMD1_STATE
;

207 
sbSã
 = ((
sbLí
 = 
ch
Ë>
SBL_MAX_SIZE
Ë? 
SBL_SOF_STATE
 : 
SBL_CMD1_STATE
;

210 
SBL_CMD1_STATE
:

211 
sbSã
 = 
SBL_CMD2_STATE
;

214 
SBL_CMD2_STATE
:

215 
sbSã
 = (
sbLí
 =0Ë? 
SBL_FCS_STATE
 : 
SBL_DATA_STATE
;

218 
SBL_DATA_STATE
:

219 i‡(++
sbIdx
 =
sbLí
)

221 
sbSã
 = 
SBL_FCS_STATE
;

225 
SBL_FCS_STATE
:

226 
sbSã
 = 
SBL_SOF_STATE
;

228 i‡((
sbFcs
 =
ch
Ë&& ((
sbBuf
[
SBL_CMD1_STATE
] & 
RPC_SUBSYSTEM_MASK
Ë=
RPC_SYS_BOOT
))

230 
	`sblExec
(
sbBuf
 + 
SBL_LEN_STATE
);

231  
	`sblRe•
();

239 
sbFcs
 ^
ch
;

240  
FALSE
;

241 
	}
}

258 
uöt8
 
	$sblRe•
()

260 
uöt8
 
idx
, 
fcs
 = 0, 
Àn
 = 
sbBuf
[
SBL_LEN_STATE
] + 
SBL_FCS_STATE
 - 1;

262 
idx
 = 
SBL_LEN_STATE
; idx < 
Àn
; idx++)

264 
fcs
 ^
sbBuf
[
idx
];

266 
sbBuf
[
idx
++] = 
fcs
;

268 
txLí
 = 
idx
;

269 
txIdx
 = 0;

271 i‡((
sbBuf
[
SBL_CMD2_STATE
] =(
SBL_ENABLE_CMD
 | 
SBL_RSP_MASK
)) &&

272 (
sbBuf
[
SBL_DATA_STATE
] =
SBL_SUCCESS
))

274 
txLí
++;

275  
TRUE
;

279  
FALSE
;

281 
	}
}

299 
	$sblExec
(
uöt8
 *
pBuf
)

301 
uöt16
 
t16
 = 
	`BUILD_UINT16
(
pBuf
[
SBL_REQ_ADDR_LSB
],pBuf[
SBL_REQ_ADDR_MSB
]Ë+ 
OAD_DONGLE_SBL_IMG_BEG
;

302 
uöt8
 
Àn
 = 1;

303 
uöt8
 
r•
 = 
SBL_SUCCESS
;

305 
pBuf
[
RPC_POS_CMD1
])

307 
SBL_WRITE_CMD
:

308 i‡((
t16
 >
OAD_DONGLE_SBL_IMG_END
Ë|| (t16 < 
OAD_DONGLE_SBL_IMG_BEG
))

310 
r•
 = 
SBL_FAILURE
;

313 i‡((
t16
 % 
SBL_PAGE_SIZE
) == 0)

315 
	`HÆFœshEø£
(
t16
 / 
SBL_PAGE_SIZE
);

317 
	`HÆFœshWrôe
(
t16
, (
pBuf
 + 
SBL_REQ_DAT0
), (
SBL_RW_BUF_LEN
 / 
HAL_FLASH_WORD_SIZE
));

320 
SBL_READ_CMD
:

321 
Àn
 = 
SBL_RW_BUF_LEN
 + 
SBL_READ_HDR_LEN
;

322 
pBuf
[
SBL_RSP_ADDR_MSB
] =ÖBuf[
SBL_REQ_ADDR_MSB
];

323 
pBuf
[
SBL_RSP_ADDR_LSB
] =ÖBuf[
SBL_REQ_ADDR_LSB
];

325 
	`HÆFœshRód
(
t16
 / 
SBL_PAGE_SIZE
,

326 (
t16
 % 
SBL_PAGE_SIZE
Ë<< 2, (
pBuf
 + 
SBL_RSP_DAT0
), 
SBL_RW_BUF_LEN
);

329 
SBL_ENABLE_CMD
:

333 
SBL_HANDSHAKE_CMD
:

337 
r•
 = 
SBL_FAILURE
;

341 
pBuf
[
RPC_POS_LEN
] = 
Àn
;

342 
pBuf
[
RPC_POS_CMD1
] |
SBL_RSP_MASK
;

343 
pBuf
[
RPC_POS_DAT0
] = 
r•
;

344 
	}
}

	@Projects/ble/Profiles/Accelerometer/accelerometer.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

51 
	~"ac˚Àromëî.h
"

61 
	#SERVAPP_NUM_ATTR_SUPPORTED
 19

	)

72 
CONST
 
uöt8
 
	gaccSîvUUID
[
ATT_BT_UUID_SIZE
] =

74 
LO_UINT16
(
ACCEL_SERVICE_UUID
), 
HI_UINT16
(ACCEL_SERVICE_UUID)

78 
CONST
 
uöt8
 
	gaccE«bÀrUUID
[
ATT_BT_UUID_SIZE
] =

80 
LO_UINT16
(
ACCEL_ENABLER_UUID
), 
HI_UINT16
(ACCEL_ENABLER_UUID)

84 
CONST
 
uöt8
 
	gøngeUUID
[
ATT_BT_UUID_SIZE
] =

86 
LO_UINT16
(
ACCEL_RANGE_UUID
), 
HI_UINT16
(ACCEL_RANGE_UUID)

90 
CONST
 
uöt8
 
	gxUUID
[
ATT_BT_UUID_SIZE
] =

92 
LO_UINT16
(
ACCEL_X_UUID
), 
HI_UINT16
(ACCEL_X_UUID)

96 
CONST
 
uöt8
 
	gyUUID
[
ATT_BT_UUID_SIZE
] =

98 
LO_UINT16
(
ACCEL_Y_UUID
), 
HI_UINT16
(ACCEL_Y_UUID)

102 
CONST
 
uöt8
 
	gzUUID
[
ATT_BT_UUID_SIZE
] =

104 
LO_UINT16
(
ACCEL_Z_UUID
), 
HI_UINT16
(ACCEL_Z_UUID)

118 
ac˚lCBs_t
 *
	gac˚l_AµCBs
 = 
NULL
;

126 
CONST
 
g©tAârTy≥_t
 
	gac˚lSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
accSîvUUID
 };

130 
uöt8
 
	gac˚lE«bÀdCh¨Pr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

133 
uöt8
 
	gac˚lE«bÀd
 = 
FALSE
;

136 
uöt8
 
	gac˚lE«bÀdU£rDesc
[14] = "Accel Enable\0";

140 
uöt8
 
	gac˚lR™geCh¨Pr›s
 = 
GATT_PROP_READ
;

143 
uöt16
 
	gac˚lR™ge
 = 
ACCEL_RANGE_2G
;

146 
uöt8
 
	gac˚lR™geU£rDesc
[13] = "Accel Range\0";

150 
uöt8
 
	gac˚lXCh¨Pr›s
 = 
GATT_PROP_NOTIFY
;

151 
uöt8
 
	gac˚lYCh¨Pr›s
 = 
GATT_PROP_NOTIFY
;

152 
uöt8
 
	gac˚lZCh¨Pr›s
 = 
GATT_PROP_NOTIFY
;

155 
öt8
 
	gac˚lXCo‹dö©es
 = 0;

156 
öt8
 
	gac˚lYCo‹dö©es
 = 0;

157 
öt8
 
	gac˚lZCo‹dö©es
 = 0;

165 
g©tCh¨Cfg_t
 
	gac˚lXC⁄figCo‹dö©es
[
GATT_MAX_NUM_CONN
];

166 
g©tCh¨Cfg_t
 
	gac˚lYC⁄figCo‹dö©es
[
GATT_MAX_NUM_CONN
];

167 
g©tCh¨Cfg_t
 
	gac˚lZC⁄figCo‹dö©es
[
GATT_MAX_NUM_CONN
];

170 
uöt8
 
	gac˚lXCh¨U£rDesc
[20] = "Accel X-Coordinate\0";

171 
uöt8
 
	gac˚lYCh¨U£rDesc
[20] = "Accel Y-Coordinate\0";

172 
uöt8
 
	gac˚lZCh¨U£rDesc
[20] = "Accel Z-Coordinate\0";

178 
g©tAâribuã_t
 
	gac˚lAârTbl
[
SERVAPP_NUM_ATTR_SUPPORTED
] =

182 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

183 
GATT_PERMIT_READ
,

185 (
uöt8
 *)&
ac˚lSîvi˚


190 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

191 
GATT_PERMIT_READ
,

193 &
ac˚lE«bÀdCh¨Pr›s


198 { 
ATT_BT_UUID_SIZE
, 
accE«bÀrUUID
 },

199 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

201 &
ac˚lE«bÀd


206 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

207 
GATT_PERMIT_READ
,

209 (
uöt8
*)&
ac˚lE«bÀdU£rDesc


214 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

215 
GATT_PERMIT_READ
,

217 &
ac˚lR™geCh¨Pr›s


222 { 
ATT_BT_UUID_SIZE
, 
øngeUUID
 },

223 
GATT_PERMIT_READ
,

225 (
uöt8
*)&
ac˚lR™ge


230 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

231 
GATT_PERMIT_READ
,

233 
ac˚lR™geU£rDesc


238 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

239 
GATT_PERMIT_READ
,

241 &
ac˚lXCh¨Pr›s


246 { 
ATT_BT_UUID_SIZE
, 
xUUID
 },

249 (
uöt8
 *)&
ac˚lXCo‹dö©es


254 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

255 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

257 (
uöt8
 *)
ac˚lXC⁄figCo‹dö©es


262 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

263 
GATT_PERMIT_READ
,

265 
ac˚lXCh¨U£rDesc


270 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

271 
GATT_PERMIT_READ
,

273 &
ac˚lYCh¨Pr›s


278 { 
ATT_BT_UUID_SIZE
, 
yUUID
 },

281 (
uöt8
 *)&
ac˚lYCo‹dö©es


286 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

287 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

289 (
uöt8
 *)
ac˚lYC⁄figCo‹dö©es


294 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

295 
GATT_PERMIT_READ
,

297 
ac˚lYCh¨U£rDesc


302 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

303 
GATT_PERMIT_READ
,

305 &
ac˚lZCh¨Pr›s


310 { 
ATT_BT_UUID_SIZE
, 
zUUID
 },

313 (
uöt8
 *)&
ac˚lZCo‹dö©es


318 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

319 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

321 (
uöt8
 *)
ac˚lZC⁄figCo‹dö©es


326 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

327 
GATT_PERMIT_READ
,

329 
ac˚lZCh¨U£rDesc


338 
uöt8
 
ac˚l_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

339 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

340 
bSètus_t
 
ac˚l_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

341 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

343 
ac˚l_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

349 
CONST
 
g©tSîvi˚CBs_t
 
	gac˚lCBs
 =

351 
ac˚l_RódAârCB
,

352 
ac˚l_WrôeAârCB
,

353 
NULL


372 
bSètus_t
 
	$Ac˚l_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

374 
uöt8
 
°©us
 = 
SUCCESS
;

377 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ac˚lXC⁄figCo‹dö©es
 );

378 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ac˚lYC⁄figCo‹dö©es
 );

379 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ac˚lZC⁄figCo‹dö©es
 );

382 
VOID
 
	`lökDB_Regi°î
–
ac˚l_H™dÀC⁄nSètusCB
 );

384 i‡–
£rvi˚s
 & 
ACCEL_SERVICE
 )

387 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
ac˚lAârTbl
,

388 
	`GATT_NUM_ATTRS
–
ac˚lAârTbl
 ),

389 &
ac˚lCBs
 );

392  ( 
°©us
 );

393 
	}
}

405 
bSètus_t
 
	$Ac˚l_Regi°îAµCBs
–
ac˚lCBs_t
 *
≠pCÆlbacks
 )

407 i‡–
≠pCÆlbacks
 )

409 
ac˚l_AµCBs
 = 
≠pCÆlbacks
;

411  ( 
SUCCESS
 );

415  ( 
bÀAÃódyInReque°edMode
 );

417 
	}
}

434 
bSètus_t
 
	$Ac˚l_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

436 
bSètus_t
 
ªt
 = 
SUCCESS
;

438  
∑øm
 )

440 
ACCEL_ENABLER
:

441 i‡–
Àn
 = ( 
uöt8
 ) )

443 
ac˚lE«bÀd
 = *((
uöt8
*)
vÆue
);

447 
ªt
 = 
bÀInvÆidR™ge
;

451 
ACCEL_RANGE
:

452 i‡–(
Àn
 = ( 
uöt16
 )Ë&& ((*((
uöt8
*)
vÆue
)Ë<
ACCEL_RANGE_8G
) )

454 
ac˚lR™ge
 = *((
uöt16
*)
vÆue
);

458 
ªt
 = 
bÀInvÆidR™ge
;

462 
ACCEL_X_ATTR
:

463 i‡–
Àn
 = ( 
öt8
 ) )

465 
ac˚lXCo‹dö©es
 = *((
öt8
*)
vÆue
);

468 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
ac˚lXC⁄figCo‹dö©es
, (
uöt8
 *)&
ac˚lXCo‹dö©es
,

469 
FALSE
, 
ac˚lAârTbl
, 
	`GATT_NUM_ATTRS
(áccelAttrTbl ),

470 
INVALID_TASK_ID
 );

474 
ªt
 = 
bÀInvÆidR™ge
;

478 
ACCEL_Y_ATTR
:

479 i‡–
Àn
 = ( 
öt8
 ) )

481 
ac˚lYCo‹dö©es
 = *((
öt8
*)
vÆue
);

484 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
ac˚lYC⁄figCo‹dö©es
, (
uöt8
 *)&
ac˚lYCo‹dö©es
,

485 
FALSE
, 
ac˚lAârTbl
, 
	`GATT_NUM_ATTRS
(áccelAttrTbl ),

486 
INVALID_TASK_ID
 );

490 
ªt
 = 
bÀInvÆidR™ge
;

494 
ACCEL_Z_ATTR
:

495 i‡–
Àn
 = ( 
öt8
 ) )

497 
ac˚lZCo‹dö©es
 = *((
öt8
*)
vÆue
);

500 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
ac˚lZC⁄figCo‹dö©es
, (
uöt8
 *)&
ac˚lZCo‹dö©es
,

501 
FALSE
, 
ac˚lAârTbl
, 
	`GATT_NUM_ATTRS
(áccelAttrTbl ),

502 
INVALID_TASK_ID
 );

506 
ªt
 = 
bÀInvÆidR™ge
;

511 
ªt
 = 
INVALIDPARAMETER
;

515  ( 
ªt
 );

516 
	}
}

531 
bSètus_t
 
	$Ac˚l_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

533 
bSètus_t
 
ªt
 = 
SUCCESS
;

534  
∑øm
 )

536 
ACCEL_ENABLER
:

537 *((
uöt8
*)
vÆue
Ë
ac˚lE«bÀd
;

540 
ACCEL_RANGE
:

541 *((
uöt16
*)
vÆue
Ë
ac˚lR™ge
;

544 
ACCEL_X_ATTR
:

545 *((
öt8
*)
vÆue
Ë
ac˚lXCo‹dö©es
;

548 
ACCEL_Y_ATTR
:

549 *((
öt8
*)
vÆue
Ë
ac˚lYCo‹dö©es
;

552 
ACCEL_Z_ATTR
:

553 *((
öt8
*)
vÆue
Ë
ac˚lZCo‹dö©es
;

557 
ªt
 = 
INVALIDPARAMETER
;

561  ( 
ªt
 );

562 
	}
}

576 
uöt8
 
	$ac˚l_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

577 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

579 
uöt16
 
uuid
;

580 
bSètus_t
 
°©us
 = 
SUCCESS
;

583 i‡–
off£t
 > 0 )

585  ( 
ATT_ERR_ATTR_NOT_LONG
 );

588 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

591 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

592  
uuid
 )

596 
ACCEL_RANGE_UUID
:

597 *
pLí
 = 2;

598 
pVÆue
[0] = 
	`LO_UINT16
–*((
uöt16
 *)
pAâr
->pValue) );

599 
pVÆue
[1] = 
	`HI_UINT16
–*((
uöt16
 *)
pAâr
->pValue) );

602 
ACCEL_ENABLER_UUID
:

603 
ACCEL_X_UUID
:

604 
ACCEL_Y_UUID
:

605 
ACCEL_Z_UUID
:

606 *
pLí
 = 1;

607 
pVÆue
[0] = *
pAâr
->pValue;

612 *
pLí
 = 0;

613 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

620 *
pLí
 = 0;

621 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

625  ( 
°©us
 );

626 
	}
}

638 
bSètus_t
 
	$ac˚l_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

639 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

641 
bSètus_t
 
°©us
 = 
SUCCESS
;

642 
uöt8
 
nŸify
 = 0xFF;

644 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

647 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

648  
uuid
 )

650 
ACCEL_ENABLER_UUID
:

653 i‡–
off£t
 == 0 )

655 i‡–
Àn
 > 1 )

656 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

657 i‡–
pVÆue
[0] !
FALSE
 &&ÖVÆue[0] !
TRUE
 )

658 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

662 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

666 i‡–
°©us
 =
SUCCESS
 )

668 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

670 *
pCurVÆue
 = 
pVÆue
[0];

671 
nŸify
 = 
ACCEL_ENABLER
;

676 
GATT_CLIENT_CHAR_CFG_UUID
:

677 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

678 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

683 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

689 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

693 i‡–(
nŸify
 !0xFFË&& 
ac˚l_AµCBs
 &&ác˚l_AµCBs->
p‚Ac˚lE«bÀr
 )

694 
ac˚l_AµCBs
->
	`p‚Ac˚lE«bÀr
();

696  ( 
°©us
 );

697 
	}
}

709 
	$ac˚l_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

712 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

715 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

716 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

717 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

719 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ac˚lXC⁄figCo‹dö©es
 );

720 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ac˚lYC⁄figCo‹dö©es
 );

721 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ac˚lZC⁄figCo‹dö©es
 );

724 
	}
}

	@Projects/ble/Profiles/Accelerometer/accelerometer.h

40 #i‚de‡
ACCELEROMETER_H


41 
	#ACCELEROMETER_H


	)

43 #ifde‡
__˝lu•lus


57 
	#ACCEL_ENABLER
 0

58 
	#ACCEL_X_ATTR
 1

59 
	#ACCEL_Y_ATTR
 2

60 
	#ACCEL_Z_ATTR
 3

61 
	#ACCEL_RANGE
 4

62 

	)

64 
	#ACCEL_ENABLER_UUID
 0xFFA1

	)

65 
	#ACCEL_RANGE_UUID
 0xFFA2

	)

66 
	#ACCEL_X_UUID
 0xFFA3

	)

67 
	#ACCEL_Y_UUID
 0xFFA4

	)

68 
	#ACCEL_Z_UUID
 0xFFA5

	)

71 
	#ACCEL_SERVICE_UUID
 0xFFA0

	)

74 
	#ACCEL_RANGE_2G
 20

	)

75 
	#ACCEL_RANGE_8G
 80

	)

78 
	#ACCEL_SERVICE
 0x00000001

	)

93 
NULL_OK
 (*
	tac˚lE«bÀr_t
)( );

97 
ac˚lE«bÀr_t
 
p‚Ac˚lE«bÀr
;

98 } 
	tac˚lCBs_t
;

111 
bSètus_t
 
Ac˚l_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

119 
bSètus_t
 
Ac˚l_Regi°îAµCBs
–
ac˚lCBs_t
 *
≠pCÆlbacks
 );

132 
bSètus_t
 
Ac˚l_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

143 
bSètus_t
 
Ac˚l_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

149 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Batt/battservice.c

42 
	~"bcomdef.h
"

43 
	~"OSAL.h
"

44 
	~"hÆ_adc.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"hid_uuid.h
"

51 
	~"hiddev.h
"

53 
	~"b©t£rvi˚.h
"

64 
	#BATT_ADC_LEVEL_3V
 409

	)

65 
	#BATT_ADC_LEVEL_2V
 273

	)

67 
	#BATT_LEVEL_VALUE_IDX
 2

68 
	#BATT_LEVEL_VALUE_CCCD_IDX
 3

69 

	)

78 
CONST
 
uöt8
 
	gb©tSîvUUID
[
ATT_BT_UUID_SIZE
] =

80 
LO_UINT16
(
BATT_SERVICE_UUID
), 
HI_UINT16
(BATT_SERVICE_UUID)

84 
CONST
 
uöt8
 
	gb©tLevñUUID
[
ATT_BT_UUID_SIZE
] =

86 
LO_UINT16
(
BATT_LEVEL_UUID
), 
HI_UINT16
(BATT_LEVEL_UUID)

102 
b©tSîvi˚CB_t
 
	gb©tSîvi˚CB
;

105 
b©tSîvi˚SëupCB_t
 
	gb©tSîvi˚SëupCB
 = 
NULL
;

108 
b©tSîvi˚TórdownCB_t
 
	gb©tSîvi˚TórdownCB
 = 
NULL
;

111 
b©tSîvi˚CÆcCB_t
 
	gb©tSîvi˚CÆcCB
 = 
NULL
;

113 
uöt16
 
	gb©tMöLevñ
 = 
BATT_ADC_LEVEL_2V
;

114 
uöt16
 
	gb©tMaxLevñ
 = 
BATT_ADC_LEVEL_3V
;

117 
uöt8
 
	gb©tCrôiˇlLevñ
;

120 
uöt8
 
	gb©tSîvi˚AdcCh
 = 
HAL_ADC_CHANNEL_VDD
;

127 
CONST
 
g©tAârTy≥_t
 
	gb©tSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
b©tSîvUUID
 };

130 
uöt8
 
	gb©tLevñPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

131 
uöt8
 
	gb©tLevñ
 = 100;

132 
g©tCh¨Cfg_t
 
	gb©tLevñClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

135 
uöt8
 
	ghidRï‹tRefB©tLevñ
[
HID_REPORT_REF_LEN
] =

136 { 
HID_RPT_ID_BATT_LEVEL_IN
, 
HID_REPORT_TYPE_INPUT
 };

142 
g©tAâribuã_t
 
	gb©tAârTbl
[] =

146 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

147 
GATT_PERMIT_READ
,

149 (
uöt8
 *)&
b©tSîvi˚


154 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

155 
GATT_PERMIT_READ
,

157 &
b©tLevñPr›s


162 { 
ATT_BT_UUID_SIZE
, 
b©tLevñUUID
 },

163 
GATT_PERMIT_READ
,

165 &
b©tLevñ


170 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

171 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

173 (
uöt8
 *Ë&
b©tLevñClõ¡Ch¨Cfg


178 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

179 
GATT_PERMIT_READ
,

181 
hidRï‹tRefB©tLevñ


189 
uöt8
 
b©tRódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

190 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

191 
bSètus_t
 
b©tWrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

192 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

193 
b©tNŸifyCB
–
lökDBIãm_t
 *
pLökIãm
 );

194 
uöt8
 
b©tMósuª
( );

195 
b©tNŸifyLevñ
( );

201 
CONST
 
g©tSîvi˚CBs_t
 
	gb©tCBs
 =

203 
b©tRódAârCB
,

204 
b©tWrôeAârCB
,

205 
NULL


220 
bSètus_t
 
	$B©t_AddSîvi˚
( )

222 
uöt8
 
°©us
 = 
SUCCESS
;

225 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
b©tLevñClõ¡Ch¨Cfg
 );

228 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
b©tAârTbl
,

229 
	`GATT_NUM_ATTRS
–
b©tAârTbl
 ),

230 &
b©tCBs
 );

232  ( 
°©us
 );

233 
	}
}

244 
	$B©t_Regi°î
–
b©tSîvi˚CB_t
 
p‚Sîvi˚CB
 )

246 
b©tSîvi˚CB
 = 
p‚Sîvi˚CB
;

247 
	}
}

263 
bSètus_t
 
	$B©t_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

265 
bSètus_t
 
ªt
 = 
SUCCESS
;

267  
∑øm
 )

269 
BATT_PARAM_CRITICAL_LEVEL
:

270 
b©tCrôiˇlLevñ
 = *((
uöt8
*)
vÆue
);

273 i‡–
b©tLevñ
 < 
b©tCrôiˇlLevñ
 )

275 
	`b©tNŸifyLevñ
();

280 
ªt
 = 
INVALIDPARAMETER
;

284  ( 
ªt
 );

285 
	}
}

300 
bSètus_t
 
	$B©t_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

302 
bSètus_t
 
ªt
 = 
SUCCESS
;

303  
∑øm
 )

305 
BATT_PARAM_LEVEL
:

306 *((
uöt8
*)
vÆue
Ë
b©tLevñ
;

309 
BATT_PARAM_CRITICAL_LEVEL
:

310 *((
uöt8
*)
vÆue
Ë
b©tCrôiˇlLevñ
;

313 
BATT_PARAM_SERVICE_HANDLE
:

314 *((
uöt16
*)
vÆue
Ë
	`GATT_SERVICE_HANDLE
–
b©tAârTbl
 );

317 
BATT_PARAM_BATT_LEVEL_IN_REPORT
:

319 
hidR±M≠_t
 *
pR±
 = (hidR±M≠_à*)
vÆue
;

321 
pR±
->
id
 = 
hidRï‹tRefB©tLevñ
[0];

322 
pR±
->
ty≥
 = 
hidRï‹tRefB©tLevñ
[1];

323 
pR±
->
h™dÀ
 = 
b©tAârTbl
[
BATT_LEVEL_VALUE_IDX
].handle;

324 
pR±
->
cccdH™dÀ
 = 
b©tAârTbl
[
BATT_LEVEL_VALUE_CCCD_IDX
].
h™dÀ
;

325 
pR±
->
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

330 
ªt
 = 
INVALIDPARAMETER
;

334  ( 
ªt
 );

335 
	}
}

349 
bSètus_t
 
	$B©t_MósLevñ
( )

351 
uöt8
 
Àvñ
;

353 
Àvñ
 = 
	`b©tMósuª
();

356 i‡(
Àvñ
 < 
b©tLevñ
)

359 
b©tLevñ
 = 
Àvñ
;

362 
	`b©tNŸifyLevñ
();

365  
SUCCESS
;

366 
	}
}

382 
	$B©t_Sëup
–
uöt8
 
adc_ch
, 
uöt16
 
möVÆ
, uöt16 
maxVÆ
,

383 
b©tSîvi˚SëupCB_t
 
sCB
, 
b©tSîvi˚TórdownCB_t
 
tCB
,

384 
b©tSîvi˚CÆcCB_t
 
cCB
 )

386 
b©tSîvi˚AdcCh
 = 
adc_ch
;

387 
b©tMöLevñ
 = 
möVÆ
;

388 
b©tMaxLevñ
 = 
maxVÆ
;

390 
b©tSîvi˚SëupCB
 = 
sCB
;

391 
b©tSîvi˚TórdownCB
 = 
tCB
;

392 
b©tSîvi˚CÆcCB
 = 
cCB
;

393 
	}
}

409 
uöt8
 
	$b©tRódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

410 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

412 
bSètus_t
 
°©us
 = 
SUCCESS
;

415 i‡–
off£t
 > 0 )

417  ( 
ATT_ERR_ATTR_NOT_LONG
 );

420 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1] );

423 i‡–
uuid
 =
BATT_LEVEL_UUID
 )

425 
uöt8
 
Àvñ
;

427 
Àvñ
 = 
	`b©tMósuª
();

430 i‡(
Àvñ
 < 
b©tLevñ
)

433 
b©tLevñ
 = 
Àvñ
;

436 *
pLí
 = 1;

437 
pVÆue
[0] = 
b©tLevñ
;

439 i‡–
uuid
 =
GATT_REPORT_REF_UUID
 )

441 *
pLí
 = 
HID_REPORT_REF_LEN
;

442 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
HID_REPORT_REF_LEN
 );

446 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

449  ( 
°©us
 );

450 
	}
}

465 
bSètus_t
 
	$b©tWrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

466 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

468 
bSètus_t
 
°©us
 = 
SUCCESS
;

470 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

471  
uuid
 )

473 
GATT_CLIENT_CHAR_CFG_UUID
:

474 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

475 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

476 i‡–
°©us
 =
SUCCESS
 )

478 
uöt16
 
ch¨Cfg
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

480 i‡–
b©tSîvi˚CB
 )

482 (*
b©tSîvi˚CB
)–(
ch¨Cfg
 =
GATT_CFG_NO_OPERATION
) ?

483 
BATT_LEVEL_NOTI_DISABLED
 :

484 
BATT_LEVEL_NOTI_ENABLED
);

490 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

494  ( 
°©us
 );

495 
	}
}

506 
	$b©tNŸifyCB
–
lökDBIãm_t
 *
pLökIãm
 )

508 i‡–
pLökIãm
->
°©eFœgs
 & 
LINK_CONNECTED
 )

510 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
pLökIãm
->
c⁄√˘i⁄H™dÀ
,

511 
b©tLevñClõ¡Ch¨Cfg
 );

512 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

514 
©tH™dÀVÆueNŸi_t
 
nŸi
;

516 
nŸi
.
h™dÀ
 = 
b©tAârTbl
[
BATT_LEVEL_VALUE_IDX
].handle;

517 
nŸi
.
Àn
 = 1;

518 
nŸi
.
vÆue
[0] = 
b©tLevñ
;

520 
	`GATT_NŸifiˇti⁄
–
pLökIãm
->
c⁄√˘i⁄H™dÀ
, &
nŸi
, 
FALSE
 );

523 
	}
}

533 
uöt8
 
	$b©tMósuª
( )

535 
uöt16
 
adc
;

536 
uöt8
 
≥r˚¡
;

571 i‡(
b©tSîvi˚SëupCB
 !
NULL
)

573 
	`b©tSîvi˚SëupCB
();

577 
	`HÆAdcSëRe„ªn˚
–
HAL_ADC_REF_125V
 );

578 
adc
 = 
	`HÆAdcRód
–
b©tSîvi˚AdcCh
, 
HAL_ADC_RESOLUTION_10
 );

581 i‡(
b©tSîvi˚TórdownCB
 !
NULL
)

583 
	`b©tSîvi˚TórdownCB
();

586 i‡(
adc
 >
b©tMaxLevñ
)

588 
≥r˚¡
 = 100;

590 i‡(
adc
 <
b©tMöLevñ
)

592 
≥r˚¡
 = 0;

596 i‡(
b©tSîvi˚CÆcCB
 !
NULL
)

598 
≥r˚¡
 = 
	`b©tSîvi˚CÆcCB
(
adc
);

602 
uöt16
 
ønge
 = 
b©tMaxLevñ
 - 
b©tMöLevñ
 + 1;

606 
ønge
 >>= 2;

608 
≥r˚¡
 = (
uöt8
Ë((((
adc
 - 
b©tMöLevñ
Ë* 25Ë+ (
ønge
 - 1)) /Ñange);

612  
≥r˚¡
;

613 
	}
}

623 
	$b©tNŸifyLevñ
( )

626 
	`lökDB_Pîf‹mFunc
–
b©tNŸifyCB
 );

627 
	}
}

639 
	$B©t_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

642 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

645 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

646 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

647 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

649 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
b©tLevñClõ¡Ch¨Cfg
 );

652 
	}
}

	@Projects/ble/Profiles/Batt/battservice.h

40 #i‚de‡
BATTSERVICE_H


41 
	#BATTSERVICE_H


	)

43 #ifde‡
__˝lu•lus


58 
	#BATT_SERVICE_UUID
 0x180F

59 
	#BATT_LEVEL_UUID
 0x2A19

60 

	)

62 
	#BATT_PARAM_LEVEL
 0

	)

63 
	#BATT_PARAM_CRITICAL_LEVEL
 1

	)

64 
	#BATT_PARAM_SERVICE_HANDLE
 2

	)

65 
	#BATT_PARAM_BATT_LEVEL_IN_REPORT
 3

	)

68 
	#BATT_LEVEL_NOTI_ENABLED
 1

	)

69 
	#BATT_LEVEL_NOTI_DISABLED
 2

	)

72 
	#HID_RPT_ID_BATT_LEVEL_IN
 4

73 

	)

79 (*
b©tSîvi˚CB_t
)(
	tuöt8
 
	tevít
);

82 (*
b©tSîvi˚SëupCB_t
)();

85 
uöt8
 (*
	tb©tSîvi˚CÆcCB_t
)(
	tuöt16
 
	tadcVÆ
);

88 (*
b©tSîvi˚TórdownCB_t
)();

111 
bSètus_t
 
B©t_AddSîvi˚
( );

122 
B©t_Regi°î
–
b©tSîvi˚CB_t
 
p‚Sîvi˚CB
 );

138 
bSètus_t
 
B©t_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

153 
bSètus_t
 
B©t_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

167 
bSètus_t
 
B©t_MósLevñ
( );

183 
B©t_Sëup
–
uöt8
 
adc_ch
, 
uöt16
 
möVÆ
, uöt16 
maxVÆ
,

184 
b©tSîvi˚SëupCB_t
 
sCB
, 
b©tSîvi˚TórdownCB_t
 
tCB
,

185 
b©tSîvi˚CÆcCB_t
 
cCB
 );

197 
B©t_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

202 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/BloodPressure/bpservice.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"g≠b⁄dmgr.h
"

51 
	~"bp£rvi˚.h
"

62 
	#BLOODPRESSURE_MEAS_VALUE_POS
 2

	)

63 
	#BLOODPRESSURE_MEAS_CONFIG_POS
 3

	)

64 
	#BLOODPRESSURE_IMEAS_VALUE_POS
 6

	)

65 
	#BLOODPRESSURE_IMEAS_CONFIG_POS
 7

	)

75 
CONST
 
uöt8
 
	gbloodPªssuªSîvUUID
[
ATT_BT_UUID_SIZE
] =

77 
LO_UINT16
(
BLOODPRESSURE_SERV_UUID
), 
HI_UINT16
(BLOODPRESSURE_SERV_UUID)

81 
CONST
 
uöt8
 
	gbloodPªssuªTempUUID
[
ATT_BT_UUID_SIZE
] =

83 
LO_UINT16
(
BLOODPRESSURE_MEAS_UUID
), 
HI_UINT16
(BLOODPRESSURE_MEAS_UUID)

87 
CONST
 
uöt8
 
	gbloodPªssuªImósUUID
[
ATT_BT_UUID_SIZE
] =

89 
LO_UINT16
(
BLOODPRESSURE_IMEAS_UUID
), 
HI_UINT16
(BLOODPRESSURE_IMEAS_UUID)

93 
CONST
 
uöt8
 
	gbpFótuªUUID
[
ATT_BT_UUID_SIZE
] =

95 
LO_UINT16
(
BLOODPRESSURE_FEATURE_UUID
), 
HI_UINT16
(BLOODPRESSURE_FEATURE_UUID)

111 
bloodPªssuªSîvi˚CB_t
 
	gbloodPªssuªSîvi˚CB
;

118 
CONST
 
g©tAârTy≥_t
 
	gbloodPªssuªSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
bloodPªssuªSîvUUID
 };

121 
uöt8
 
	gbloodPªssuªTempPr›s
 = 
GATT_PROP_INDICATE
;

122 
g©tCh¨Cfg_t
 
	gbloodPªssuªMósC⁄fig
[
GATT_MAX_NUM_CONN
];

123 
uöt8
 
	gbloodPªssuªTemp
 = 0;

124 
uöt8
 
	gbloodPªssuªTempF‹m©
 = 12;

127 
uöt8
 
	gbloodPªssuªImósPr›s
 = 
GATT_PROP_NOTIFY
;

128 
uöt8
 
	gbloodPªssuªImós
=0;

129 
g©tCh¨Cfg_t
 
	gbloodPªssuªIMósC⁄fig
[
GATT_MAX_NUM_CONN
];

141 
uöt8
 
	gbpFótuªPr›s
 = 
GATT_PROP_READ
;

142 
uöt16
 
	gbpFótuª
 = 0;

148 
g©tAâribuã_t
 
	gbloodPªssuªAârTbl
[] =

152 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

153 
GATT_PERMIT_READ
,

155 (
uöt8
 *)&
bloodPªssuªSîvi˚


160 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

161 
GATT_PERMIT_READ
,

163 &
bloodPªssuªTempPr›s


168 { 
ATT_BT_UUID_SIZE
, 
bloodPªssuªTempUUID
 },

171 &
bloodPªssuªTemp


176 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

177 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

179 (
uöt8
 *)&
bloodPªssuªMósC⁄fig


183 { 
ATT_BT_UUID_SIZE
, 
ch¨F‹m©UUID
 },

184 
GATT_PERMIT_READ
,

186 (
uöt8
 *)&
bloodPªssuªTempF‹m©


196 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

197 
GATT_PERMIT_READ
,

199 &
bloodPªssuªImósPr›s


204 { 
ATT_BT_UUID_SIZE
, 
bloodPªssuªImósUUID
 },

207 &
bloodPªssuªImós


212 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

213 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

215 (
uöt8
 *)&
bloodPªssuªIMósC⁄fig


225 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

226 
GATT_PERMIT_READ
,

228 &
bpFótuªPr›s


233 { 
ATT_BT_UUID_SIZE
, 
bpFótuªUUID
 },

234 
GATT_PERMIT_READ
,

236 (
uöt8
 *)&
bpFótuª


247 
uöt8
 
bloodPªssuª_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

248 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

249 
bSètus_t
 
bloodPªssuª_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

250 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

252 
bloodPªssuª_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

257 
CONST
 
g©tSîvi˚CBs_t
 
	gbloodPªssuªCBs
 =

259 
bloodPªssuª_RódAârCB
,

260 
bloodPªssuª_WrôeAârCB
,

261 
NULL


279 
bSètus_t
 
	$BloodPªssuª_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

281 
uöt8
 
°©us
 = 
SUCCESS
;

284 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
bloodPªssuªMósC⁄fig
 );

285 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
bloodPªssuªIMósC⁄fig
 );

288 
VOID
 
	`lökDB_Regi°î
–
bloodPªssuª_H™dÀC⁄nSètusCB
 );

290 i‡–
£rvi˚s
 & 
BLOODPRESSURE_SERVICE
 )

293 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
bloodPªssuªAârTbl
,

294 
	`GATT_NUM_ATTRS
–
bloodPªssuªAârTbl
 ),

295 &
bloodPªssuªCBs
 );

298  ( 
°©us
 );

299 
	}
}

310 
	$BloodPªssuª_Regi°î
–
bloodPªssuªSîvi˚CB_t
 
p‚Sîvi˚CB
 )

312 
bloodPªssuªSîvi˚CB
 = 
p‚Sîvi˚CB
;

313 
	}
}

329 
bSètus_t
 
	$BloodPªssuª_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

331 
bSètus_t
 
ªt
 = 
SUCCESS
;

332  
∑øm
 )

336 
ªt
 = 
INVALIDPARAMETER
;

340  ( 
ªt
 );

341 
	}
}

356 
bSètus_t
 
	$BloodPªssuª_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

358 
bSètus_t
 
ªt
 = 
SUCCESS
;

359  
∑øm
 )

362 
ªt
 = 
INVALIDPARAMETER
;

366  ( 
ªt
 );

367 
	}
}

380 
bSètus_t
 
	$BloodPªssuª_MósIndiˇã
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pNŸi
,
uöt8
 
èskId
 )

382 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
bloodPªssuªMósC⁄fig
 );

385 i‡–
vÆue
 & 
GATT_CLIENT_CFG_INDICATE
 )

388 
pNŸi
->
h™dÀ
 = 
bloodPªssuªAârTbl
[
BLOODPRESSURE_MEAS_VALUE_POS
].handle;

391  
	`GATT_Indiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
, 
èskId
 );

394  
bÀInc‹ª˘Mode
;

395 
	}
}

409 
bSètus_t
 
	$BloodPªssuª_IMósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
, 
uöt8
 
èskId
 )

411 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
bloodPªssuªIMósC⁄fig
 );

414 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

417 
pNŸi
->
h™dÀ
 = 
bloodPªssuªAârTbl
[
BLOODPRESSURE_IMEAS_VALUE_POS
].handle;

420  
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
);

423  
bÀInc‹ª˘Mode
;

425 
	}
}

441 
uöt8
 
	$bloodPªssuª_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

442 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

444 
bSètus_t
 
°©us
 = 
SUCCESS
;

447 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

450  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

454 i‡–
off£t
 > 0 )

456  ( 
ATT_ERR_ATTR_NOT_LONG
 );

459 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

462 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

463  
uuid
 )

466 
BLOODPRESSURE_FEATURE_UUID
:

468 *
pLí
 = 2;

469 
pVÆue
[0] = 0;

470 
pVÆue
[1] = 0;

475 *
pLí
 = 0;

476 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

480  ( 
°©us
 );

481 
	}
}

496 
bSètus_t
 
	$bloodPªssuª_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

497 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

499 
bSètus_t
 
°©us
 = 
SUCCESS
;

501 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

502  
uuid
 )

504 
GATT_CLIENT_CHAR_CFG_UUID
:

505 i‡–
pAâr
->
h™dÀ
 =
bloodPªssuªAârTbl
[
BLOODPRESSURE_MEAS_CONFIG_POS
].handle )

508 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

509 
off£t
, 
GATT_CLIENT_CFG_INDICATE
 );

510 i‡–
°©us
 =
SUCCESS
 )

512 
uöt16
 
vÆue
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

514 (*
bloodPªssuªSîvi˚CB
)–(
vÆue
 =
GATT_CFG_NO_OPERATION
) ?

515 
BLOODPRESSURE_MEAS_NOTI_DISABLED
 :

516 
BLOODPRESSURE_MEAS_NOTI_ENABLED
);

519 i‡–
pAâr
->
h™dÀ
 =
bloodPªssuªAârTbl
[
BLOODPRESSURE_IMEAS_CONFIG_POS
].handle )

522 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

523 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

524 i‡–
°©us
 =
SUCCESS
 )

526 
uöt16
 
vÆue
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

528 (*
bloodPªssuªSîvi˚CB
)–(
vÆue
 =
GATT_CFG_NO_OPERATION
) ?

529 
BLOODPRESSURE_IMEAS_NOTI_DISABLED
 :

530 
BLOODPRESSURE_IMEAS_NOTI_ENABLED
 );

535 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

540 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

544  ( 
°©us
 );

546 
	}
}

559 
	$bloodPªssuª_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

562 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

565 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

566 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

567 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

569 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
bloodPªssuªMósC⁄fig
 );

570 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
bloodPªssuªIMósC⁄fig
 );

573 
	}
}

	@Projects/ble/Profiles/BloodPressure/bpservice.h

40 #i‚de‡
BLOODPRESSURESERVICE_H


41 
	#BLOODPRESSURESERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#BLOODPRESSURE_MEAS
 0

	)

58 
	#BLOODPRESSURE_MEAS_CHAR_CFG
 1

	)

59 
	#BLOODPRESSURE_IMEAS_CHAR_CFG
 2

	)

60 
	#BLOODPRESSURE_TIMESTAMP
 3

	)

61 
	#BLOODPRESSURE_PULSE
 4

	)

62 
	#BLOODPRESSURE_INTERVAL
 5

	)

65 
	#BLOODPRESSURE_TIMESTAMP_LEN
 7

66 
	#BLOODPRESSURE_TIME_LEN
 7

67 
	#BLOODPRESSURE_INTERVAL_LEN
 1

	)

70 
	#BLOODPRESSURE_SERV_UUID
 0x1810

	)

71 
	#BLOODPRESSURE_MEAS_UUID
 0x2A35

72 
	#BLOODPRESSURE_IMEAS_UUID
 0x2A36

73 
	#BLOODPRESSURE_FEATURE_UUID
 0x2A49

74 

	)

76 
	#BLOODPRESSURE_MEAS_MAX
 (
ATT_MTU_SIZE
 -5)

	)

79 
	#BLOODPRESSURE_FLAGS_MMHG
 0x00

	)

80 
	#BLOODPRESSURE_FLAGS_KPA
 0x01

	)

81 
	#BLOODPRESSURE_FLAGS_TIMESTAMP
 0x02

	)

82 
	#BLOODPRESSURE_FLAGS_PULSE
 0x04

	)

83 
	#BLOODPRESSURE_FLAGS_USER
 0x08

	)

84 
	#BLOODPRESSURE_FLAGS_STATUS
 0x10

	)

88 
	#BLOODPRESSURE_SITE_ARMPIT
 0x01

	)

89 
	#BLOODPRESSURE_SITE_BODY
 0x02

	)

90 
	#BLOODPRESSURE_SITE_EAR
 0x03

	)

91 
	#BLOODPRESSURE_SITE_FINGER
 0x04

	)

92 
	#BLOODPRESSURE_SITE_GASTRO
 0x05

	)

93 
	#BLOODPRESSURE_SITE_MOUTH
 0x06

	)

94 
	#BLOODPRESSURE_SITE_RECTUM
 0x07

	)

95 
	#BLOODPRESSURE_SITE_TOE
 0x08

	)

96 
	#BLOODPRESSURE_SITE_TYMPNUM
 0x09

	)

99 
	#BLOODPRESSURE_SERVICE
 0x00000001

	)

102 
	#BLOODPRESSURE_MEAS_NOTI_ENABLED
 1

	)

103 
	#BLOODPRESSURE_MEAS_NOTI_DISABLED
 2

	)

104 
	#BLOODPRESSURE_IMEAS_NOTI_ENABLED
 3

	)

105 
	#BLOODPRESSURE_IMEAS_NOTI_DISABLED
 4

	)

106 
	#BLOODPRESSURE_TIME_SET
 5

	)

113 (*
bloodPªssuªSîvi˚CB_t
)(
	tuöt8
 
	tevít
);

135 
bSètus_t
 
BloodPªssuª_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

144 
BloodPªssuª_Regi°î
–
bloodPªssuªSîvi˚CB_t
 
p‚Sîvi˚CB
 );

156 
bSètus_t
 
BloodPªssuª_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

167 
bSètus_t
 
BloodPªssuª_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

180 
bSètus_t
 
BloodPªssuª_MósIndiˇã
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pNŸi
, 
uöt8
 
èskId
 );

196 
bSètus_t
 
BloodPªssuª_IMósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
, 
uöt8
 
èskId
 );

201 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/CSC/cyclingservice.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"lökdb.h
"

47 
	~"©t.h
"

48 
	~"g©t.h
"

49 
	~"g©t_uuid.h
"

50 
	~"g©t£rv≠p.h
"

51 
	~"cy˛ög£rvi˚.h
"

65 
	#CSC_CMD_IND_SEND_EVT
 0x0001

	)

67 
	#CSC_MEAS_VALUE_POS
 2

	)

68 
	#CSC_MEAS_CFG_POS
 3

	)

69 
	#CSC_COMMAND_VALUE_POS
 9

	)

70 
	#CSC_COMMAND_CFG_POS
 10

	)

71 
	#COMMAND_IND_LENGTH
 2

	)

78 
CONST
 
uöt8
 
	gcy˛ögSîvUUID
[
ATT_BT_UUID_SIZE
] =

80 
LO_UINT16
(
CSC_SERV_UUID
), 
HI_UINT16
(CSC_SERV_UUID)

84 
CONST
 
uöt8
 
	gcy˛ögMósUUID
[
ATT_BT_UUID_SIZE
] =

86 
LO_UINT16
(
CSC_MEAS_UUID
), 
HI_UINT16
(CSC_MEAS_UUID)

90 
CONST
 
uöt8
 
	gcy˛ögFótuªUUID
[
ATT_BT_UUID_SIZE
] =

92 
LO_UINT16
(
CSC_FEATURE_UUID
), 
HI_UINT16
(CSC_FEATURE_UUID)

96 
CONST
 
uöt8
 
	gcy˛ögSísLocUUID
[
ATT_BT_UUID_SIZE
] =

98 
LO_UINT16
(
CSC_SENS_LOC_UUID
), 
HI_UINT16
(CSC_SENS_LOC_UUID)

102 
CONST
 
uöt8
 
	gcy˛ögComm™dUUID
[
ATT_BT_UUID_SIZE
] =

104 
LO_UINT16
(
CSC_COMMAND_UUID
), 
HI_UINT16
(CSC_COMMAND_UUID)

119 
cy˛ögSîvi˚CB_t
 
	gcy˛ögSîvi˚CB
 = 
NULL
;

121 
uöt8
 
	gsuµ‹ãdSís‹s
 = 0;

122 
boﬁ
 
	gscOpInProgªss
 = 
FALSE
;

125 
uöt16
 
	gc⁄√˘i⁄H™dÀ
;

126 
©tH™dÀVÆueInd_t
 
	gcscCmdInd
;

133 
uöt8
 
	gcy˛ögSîvi˚_TaskID
 = 0;

136 
CONST
 
g©tAârTy≥_t
 
	gcy˛ögSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
cy˛ögSîvUUID
 };

139 
uöt8
 
	gsuµ‹ãdSís‹Loˇti⁄s
[
CSC_MAX_SENSOR_LOCS
];

143 
uöt8
 
	gcy˛ögMósPr›s
 = 
GATT_PROP_NOTIFY
;

144 
uöt8
 
	gcy˛ögMós
 = 0;

145 
g©tCh¨Cfg_t
 
	gcy˛ögMósClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

148 
uöt8
 
	gcy˛ögFótuªPr›s
 = 
GATT_PROP_READ
;

149 
uöt16
 
	gcy˛ögFótuªs
 = 
CSC_NO_SUPPORT
;

153 
uöt8
 
	gcy˛ögSísLocPr›s
 = 
GATT_PROP_READ
;

154 
uöt8
 
	gcy˛ögSísLoc
 = 
CSC_SENSOR_LOC_TOP_OF_SHOE
;

157 
uöt8
 
	gcy˛ögComm™dPr›s
 = 
GATT_PROP_WRITE
 | 
GATT_PROP_INDICATE
;

158 
uöt8
 
	gcy˛ögComm™d
 = 0;

159 
g©tCh¨Cfg_t
 
	gcy˛ögComm™dClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

165 
g©tAâribuã_t
 
	gcy˛ögAârTbl
[] =

169 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

170 
GATT_PERMIT_READ
,

172 (
uöt8
 *)&
cy˛ögSîvi˚


177 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

178 
GATT_PERMIT_READ
,

180 &
cy˛ögMósPr›s


185 { 
ATT_BT_UUID_SIZE
, 
cy˛ögMósUUID
 },

188 &
cy˛ögMós


193 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

194 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

196 (
uöt8
 *Ë&
cy˛ögMósClõ¡Ch¨Cfg


201 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

202 
GATT_PERMIT_READ
,

204 &
cy˛ögFótuªPr›s


209 { 
ATT_BT_UUID_SIZE
, 
cy˛ögFótuªUUID
 },

210 
GATT_PERMIT_READ
,

212 (
uöt8
 *Ë&
cy˛ögFótuªs


217 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

218 
GATT_PERMIT_READ
,

220 &
cy˛ögSísLocPr›s


225 { 
ATT_BT_UUID_SIZE
, 
cy˛ögSísLocUUID
 },

226 
GATT_PERMIT_READ
,

228 &
cy˛ögSísLoc


233 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

234 
GATT_PERMIT_READ
,

236 &
cy˛ögComm™dPr›s


241 { 
ATT_BT_UUID_SIZE
, 
cy˛ögComm™dUUID
 },

242 
GATT_PERMIT_WRITE
,

244 &
cy˛ögComm™d


249 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

250 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

252 (
uöt8
 *Ë&
cy˛ögComm™dClõ¡Ch¨Cfg


260 
uöt8
 
cy˛ög_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

261 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

262 
bSètus_t
 
cy˛ög_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

263 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

264 
cy˛ög_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

265 
cy˛ög_Pro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 );

266 
boﬁ
 
cy˛ög_Sís‹LocSuµ‹ãd
–
uöt8
 
£ns‹Loc
 );

267 
cy˛ög_Pro˚ssCSCCmd
–
uöt16
 
©åH™dÀ
, 
uöt8
 *
pVÆue
, uöt8 
Àn
 );

274 
CONST
 
g©tSîvi˚CBs_t
 
	gcy˛ögCBs
 =

276 
cy˛ög_RódAârCB
,

277 
cy˛ög_WrôeAârCB
,

278 
NULL


294 
	$Cy˛ögSîvi˚_Inô
–
uöt8
 
èsk_id
 )

297 
cy˛ögSîvi˚_TaskID
 = 
èsk_id
;

298 
	}
}

311 
uöt16
 
	$Cy˛ögSîvi˚_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

313 
VOID
 
èsk_id
;

315 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

317 
uöt8
 *
pMsg
;

319 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
cy˛ögSîvi˚_TaskID
 )Ë!
NULL
 )

321 
	`cy˛ög_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

324 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

328  (
evíts
 ^ 
SYS_EVENT_MSG
);

331 i‡–
evíts
 & 
CSC_CMD_IND_SEND_EVT
 )

333 
	`GATT_Indiˇti⁄
–
c⁄√˘i⁄H™dÀ
, &
cscCmdInd
, 
FALSE
, 
cy˛ögSîvi˚_TaskID
 );

336 
scOpInProgªss
 = 
FALSE
;

338  ( 
evíts
 ^ 
CSC_CMD_IND_SEND_EVT
 );

342 
	}
}

353 
	$cy˛ög_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

355  
pMsg
->
evít
 )

357 
GATT_MSG_EVENT
:

358 
	`cy˛ög_Pro˚ssGATTMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

364 
	}
}

375 
	$cy˛ög_Pro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 )

377 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_CFM
 )

382 
	}
}

393 
boﬁ
 
	$cy˛ög_Sís‹LocSuµ‹ãd
–
uöt8
 
£ns‹Loc
 )

395 
uöt8
 
i
;

396 
i
 = 0; i <
suµ‹ãdSís‹s
; i++)

398 i‡(
suµ‹ãdSís‹Loˇti⁄s
[
i
] =
£ns‹Loc
)

400  
TRUE
;

403  
FALSE
;

404 
	}
}

417 
bSètus_t
 
	$Cy˛ög_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

419 
uöt8
 
°©us
 = 
SUCCESS
;

422 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
cy˛ögMósClõ¡Ch¨Cfg
 );

423 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
cy˛ögComm™dClõ¡Ch¨Cfg
);

425 i‡–
£rvi˚s
 & 
CYCLING_SERVICE
 )

428 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
cy˛ögAârTbl
,

429 
	`GATT_NUM_ATTRS
–
cy˛ögAârTbl
 ),

430 &
cy˛ögCBs
 );

433  ( 
°©us
 );

434 
	}
}

445 
	$Cy˛ög_Regi°î
–
cy˛ögSîvi˚CB_t
 
p‚Sîvi˚CB
 )

447 
cy˛ögSîvi˚CB
 = 
p‚Sîvi˚CB
;

448 
	}
}

465 
bSètus_t
 
	$Cy˛ög_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
pVÆue
 )

467 
bSètus_t
 
ªt
 = 
SUCCESS
;

469  
∑øm
 )

471 
CSC_SENS_LOC
:

472 
cy˛ögSísLoc
 = *((
uöt8
*)
pVÆue
);

475 
CSC_FEATURE
:

476 
cy˛ögFótuªs
 = *((
uöt8
*)
pVÆue
);

479 
CSC_AVAIL_SENS_LOCS
:

480 i‡(
suµ‹ãdSís‹s
 < 
CSC_MAX_SENSOR_LOCS
)

482 
suµ‹ãdSís‹Loˇti⁄s
[
suµ‹ãdSís‹s
++] = *((
uöt8
*)
pVÆue
);

487 
ªt
 = 
INVALIDPARAMETER
;

491  ( 
ªt
 );

492 
	}
}

507 
bSètus_t
 
	$Cy˛ög_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

509 
bSètus_t
 
ªt
 = 
SUCCESS
;

511  
∑øm
 )

513 
CSC_FEATURE
:

514 *((
uöt8
*)
vÆue
Ë
cy˛ögFótuªs
;

516 
CSC_SENS_LOC
:

517 *((
uöt8
*)
vÆue
Ë
cy˛ögSísLoc
;

520 
CSC_COMMAND
:

521 *((
uöt8
*)
vÆue
Ë
cy˛ögComm™d
;

525 
ªt
 = 
INVALIDPARAMETER
;

529  ( 
ªt
 );

530 
	}
}

543 
bSètus_t
 
	$Cy˛ög_MósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
 )

545 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
cy˛ögMósClõ¡Ch¨Cfg
 );

548 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

551 
pNŸi
->
h™dÀ
 = 
cy˛ögAârTbl
[
CSC_MEAS_VALUE_POS
].handle;

554  
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
 );

557  
bÀInc‹ª˘Mode
;

558 
	}
}

571 
	$cy˛ög_Pro˚ssCSCCmd
–
uöt16
 
©åH™dÀ
, 
uöt8
 *
pVÆue
, uöt8 
Àn
 )

573 
uöt8
 
cscSètus
 = 
CSC_SUCCESS
;

576 
scOpInProgªss
 = 
TRUE
;

579 
cscCmdInd
.
h™dÀ
 = 
©åH™dÀ
;

581 
cscCmdInd
.
Àn
 = 3;

582 
cscCmdInd
.
vÆue
[0] = 
CSC_COMMAND_RSP
;

583 
cscCmdInd
.
vÆue
[1] = 
pVÆue
[0];

585  
pVÆue
[0] )

587 
CSC_SET_CUMM_VAL
:

589 i‡––
Àn
 <5 ) && ( 
cy˛ögFótuªs
 & 
CSC_WHEEL_REV_SUPP
 ) )

591 
uöt32
 
cummWhìlRevﬁuti⁄s
;

594 i‡(–
Àn
 - 1 ) == 4)

596 
cummWhìlRevﬁuti⁄s
 = 
	`BUILD_UINT32
–
pVÆue
[1],ÖValue[2],ÖValue[3],ÖValue[4]);

600 
cummWhìlRevﬁuti⁄s
 = 0;

603  
i
 = 0; i < (
Àn
 - 1); ++i )

605 
cummWhìlRevﬁuti⁄s
 +
pVÆue
[
i
 + 1] << (i*8);

610 i‡–
cy˛ögSîvi˚CB
 !
NULL
 )

612 (*
cy˛ögSîvi˚CB
)–
CSC_CMD_SET_CUMM_VAL
, &
cummWhìlRevﬁuti⁄s
 );

617 
cscSètus
 = 
CSC_INVALID_PARAMETER
;

621 
CSC_UPDATE_SENS_LOC
:

623 i‡––
Àn
 == 2 ) &&

624 –
cy˛ögFótuªs
 & 
CSC_MULTI_SENS_SUPP
 ) &&

625 –
	`cy˛ög_Sís‹LocSuµ‹ãd
–
pVÆue
[1] ) =
TRUE
 ) )

628 
cy˛ögSísLoc
 = 
pVÆue
[1];

631 i‡–
cy˛ögSîvi˚CB
 !
NULL
 )

633 (*
cy˛ögSîvi˚CB
)–
CSC_CMD_UPDATE_SENS_LOC
, 
NULL
 );

638 
cscSètus
 = 
CSC_INVALID_PARAMETER
;

642 
CSC_REQ_SUPP_SENS_LOC
:

644 i‡––
Àn
 =1 ) && ( 
cy˛ögFótuªs
 & 
CSC_MULTI_SENS_SUPP
 ) )

646 
cscCmdInd
.
Àn
 +
suµ‹ãdSís‹s
;

647 
	`oßl_mem˝y
–&(
cscCmdInd
.
vÆue
[3]), 
suµ‹ãdSís‹Loˇti⁄s
, 
suµ‹ãdSís‹s
 );

652 
cscSètus
 = 
CSC_INVALID_PARAMETER
;

658 
cscSètus
 = 
CSC_OPCODE_NOT_SUPPORTED
;

663 
cscCmdInd
.
vÆue
[2] = 
cscSètus
;

666 
	`oßl_£t_evít
–
cy˛ögSîvi˚_TaskID
, 
CSC_CMD_IND_SEND_EVT
 );

667 
	}
}

679 
	$Cy˛ög_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

682 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

685 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

686 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

687 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

689 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
cy˛ögMósClõ¡Ch¨Cfg
 );

690 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
cy˛ögComm™dClõ¡Ch¨Cfg
 );

693 
	}
}

709 
uöt8
 
	$cy˛ög_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

710 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

713 i‡–
off£t
 > 0 )

715  ( 
ATT_ERR_ATTR_NOT_LONG
 );

718 
bSètus_t
 
°©us
 = 
SUCCESS
;

719 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

721  
uuid
 )

723 
CSC_SENS_LOC_UUID
:

726 *
pLí
 = 1;

727 
pVÆue
[0] = 
pAâr
->pValue[0];

731 
CSC_FEATURE_UUID
:

734 *
pLí
 = 2;

735 
pVÆue
[0] = 
	`LO_UINT16
(
pAâr
->pValue[0]);

736 
pVÆue
[1] = 
	`HI_UINT16
(
pAâr
->pValue[0]);

740 
GATT_CLIENT_CHAR_CFG_UUID
:

743 i‡–
pAâr
->
pVÆue
 =(
uöt8
*)
cy˛ögMósClõ¡Ch¨Cfg
 )

745 *
pLí
 = 1;

746 
pVÆue
[0] = 
	`GATTSîvAµ_RódCh¨Cfg
(
c⁄nH™dÀ
, 
cy˛ögMósClõ¡Ch¨Cfg
 );

748 i‡–
pAâr
->
pVÆue
 =(
uöt8
*)
cy˛ögComm™dClõ¡Ch¨Cfg
 )

750 *
pLí
 = 1;

751 
pVÆue
[0] = 
	`GATTSîvAµ_RódCh¨Cfg
(
c⁄nH™dÀ
, 
cy˛ögComm™dClõ¡Ch¨Cfg
 );

755 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

761 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

766 i‡–
cy˛ögSîvi˚CB
 !
NULL
 )

768 (*
cy˛ögSîvi˚CB
)–
CSC_READ_ATTR
, 
NULL
 );

771  ( 
°©us
 );

772 
	}
}

788 
bSètus_t
 
	$cy˛ög_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

789 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

791 
bSètus_t
 
°©us
 = 
SUCCESS
;

792 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

794 i‡–
off£t
 > 0 )

796  (
ATT_ERR_ATTR_NOT_LONG
);

799  
uuid
 )

801 
CSC_COMMAND_UUID
:

803 i‡–
scOpInProgªss
 =
TRUE
 )

805 
°©us
 = 
CSC_ERR_PROC_IN_PROGRESS
;

808 i‡–(
cy˛ögComm™dClõ¡Ch¨Cfg
[
c⁄nH™dÀ
].
vÆue
 & 
GATT_CLIENT_CFG_INDICATE
Ë=
FALSE
 )

810 
°©us
 = 
CSC_ERR_CCC_IMPROPER_CFG
;

815 
	`cy˛ög_Pro˚ssCSCCmd
–
pAâr
->
h™dÀ
, 
pVÆue
, 
Àn
 );

816 
c⁄√˘i⁄H™dÀ
 = 
c⁄nH™dÀ
;

821 
GATT_CLIENT_CHAR_CFG_UUID
:

822 i‡–
pAâr
->
h™dÀ
 =
cy˛ögAârTbl
[
CSC_COMMAND_CFG_POS
].handle )

824 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

825 
off£t
, 
GATT_CLIENT_CFG_INDICATE
 );

827 i‡–
cy˛ögSîvi˚CB
 !
NULL
 )

829 (*
cy˛ögSîvi˚CB
)–
CSC_WRITE_ATTR
, 
NULL
 );

832 i‡–
pAâr
->
h™dÀ
 =
cy˛ögAârTbl
[
CSC_MEAS_CFG_POS
].handle )

834 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

835 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

836 i‡–
°©us
 =
SUCCESS
 )

839 i‡–
cy˛ögSîvi˚CB
 !
NULL
 )

841 
uöt16
 
ch¨Cfg
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

843 (*
cy˛ögSîvi˚CB
)–((
ch¨Cfg
 =
GATT_CFG_NO_OPERATION
) ?

844 
CSC_MEAS_NOTI_DISABLED
 :

845 
CSC_MEAS_NOTI_ENABLED
 ), 
NULL
 );

852 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

856  ( 
°©us
 );

857 
	}
}

	@Projects/ble/Profiles/CSC/cyclingservice.h

41 #i‚de‡
CYCLINGSERVICE_H


42 
	#CYCLINGSERVICE_H


	)

44 #ifde‡
__˝lu•lus


57 
	#CYCLING_SERVICE
 0x00000001

	)

60 
	#CSC_ERR_PROC_IN_PROGRESS
 0x80

	)

61 
	#CSC_ERR_CCC_IMPROPER_CFG
 0x81

	)

63 
	#CSC_SUCCESS
 1

	)

64 
	#CSC_OPCODE_NOT_SUPPORTED
 2

	)

65 
	#CSC_INVALID_PARAMETER
 3

	)

68 
	#CSC_MEAS
 1

	)

69 
	#CSC_MEAS_CHAR_CFG
 2

	)

70 
	#CSC_FEATURE
 3

	)

71 
	#CSC_SENS_LOC
 4

	)

72 
	#CSC_COMMAND
 5

	)

73 
	#CSC_COMMAND_CHAR_CFG
 6

	)

74 
	#CSC_AVAIL_SENS_LOCS
 7

	)

77 
	#CSC_SERV_UUID
 0x1816

	)

78 
	#CSC_MEAS_UUID
 0x2A5B

	)

79 
	#CSC_FEATURE_UUID
 0x2A5C

	)

80 
	#CSC_SENS_LOC_UUID
 0x2A5D

	)

81 
	#CSC_COMMAND_UUID
 0x2A55

	)

84 
	#CSC_WHEEL_REV_PRESENT
 0x01

	)

85 
	#CSC_CRANK_REV_PRESENT
 0x02

	)

88 
	#CSC_NO_SUPPORT
 0x00

	)

89 
	#CSC_WHEEL_REV_SUPP
 0x01

	)

90 
	#CSC_CRANK_REV_SUPP
 0x02

	)

91 
	#CSC_MULTI_SENS_SUPP
 0x04

	)

92 
	#CSC_FULL_SUPPORT
 0x07

	)

95 
	#CSC_SENSOR_LOC_OTHER
 0

	)

96 
	#CSC_SENSOR_LOC_TOP_OF_SHOE
 1

	)

97 
	#CSC_SENSOR_LOC_IN_SHOE
 2

	)

98 
	#CSC_SENSOR_LOC_HIP
 3

	)

99 
	#CSC_SENSOR_LOC_FRONT_WHEEL
 4

	)

100 
	#CSC_SENSOR_LOC_LEFT_CRANK
 5

	)

101 
	#CSC_SENSOR_LOC_RIGHT_CRANK
 6

	)

102 
	#CSC_SENSOR_LOC_LEFT_PEDAL
 7

	)

103 
	#CSC_SENSOR_LOC_RIGHT_PEDAL
 8

	)

104 
	#CSC_SENSOR_LOC_FRONT_HUB
 9

	)

105 
	#CSC_SENSOR_LOC_REAR_DROPOUT
 10

	)

106 
	#CSC_SENSOR_LOC_CHAINSTAY
 11

	)

107 
	#CSC_SENSOR_LOC_REAR_WHEEL
 12

	)

108 
	#CSC_SENSOR_LOC_REAR_HUB
 13

	)

111 
	#CSC_MAX_SENSOR_LOCS
 14

	)

114 
	#CSC_SET_CUMM_VAL
 1

	)

115 
	#CSC_START_SENS_CALIB
 2

	)

116 
	#CSC_UPDATE_SENS_LOC
 3

	)

117 
	#CSC_REQ_SUPP_SENS_LOC
 4

	)

118 
	#CSC_COMMAND_RSP
 16

	)

121 
	#CSC_FLAGS_AT_REST
 0x00

	)

122 
	#CSC_FLAGS_SPEED
 0x01

	)

123 
	#CSC_FLAGS_CADENCE
 0x02

	)

124 
	#CSC_FLAGS_SPEED_CADENCE
 0x03

	)

127 
	#DEFAULT_NOTI_INTERVAL
 1000

128 

	)

129 
	#VALUE_ROLL_OVER
 64000

130 

	)

132 
	#CSC_CMD_SET_CUMM_VAL
 1

	)

133 
	#CSC_CMD_START_SENS_CALIB
 2

	)

134 
	#CSC_CMD_UPDATE_SENS_LOC
 3

	)

135 
	#CSC_MEAS_NOTI_ENABLED
 4

	)

136 
	#CSC_MEAS_NOTI_DISABLED
 5

	)

137 
	#CSC_READ_ATTR
 6

	)

138 
	#CSC_WRITE_ATTR
 7

	)

145 (*
cy˛ögSîvi˚CB_t
)–
	tuöt8
 
	tevít
, 
	tuöt32
 *
	tpNewCummVÆ
 );

169 
Cy˛ögSîvi˚_Inô
–
uöt8
 
èsk_id
 );

182 
uöt16
 
Cy˛ögSîvi˚_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

193 
bSètus_t
 
Cy˛ög_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

206 
Cy˛ög_Regi°î
–
cy˛ögSîvi˚CB_t
 
p‚Sîvi˚CB
 );

220 
bSètus_t
 
Cy˛ög_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

235 
bSètus_t
 
Cy˛ög_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

248 
bSètus_t
 
Cy˛ög_MósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
 );

260 
Cy˛ög_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

265 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/DevInfo/devinfoservice.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

51 
	~"devöfo£rvi˚.h
"

69 
CONST
 
uöt8
 
	gdevInfoSîvUUID
[
ATT_BT_UUID_SIZE
] =

71 
LO_UINT16
(
DEVINFO_SERV_UUID
), 
HI_UINT16
(DEVINFO_SERV_UUID)

75 
CONST
 
uöt8
 
	gdevInfoSy°emIdUUID
[
ATT_BT_UUID_SIZE
] =

77 
LO_UINT16
(
DEVINFO_SYSTEM_ID_UUID
), 
HI_UINT16
(DEVINFO_SYSTEM_ID_UUID)

81 
CONST
 
uöt8
 
	gdevInfoModñNumbîUUID
[
ATT_BT_UUID_SIZE
] =

83 
LO_UINT16
(
DEVINFO_MODEL_NUMBER_UUID
), 
HI_UINT16
(DEVINFO_MODEL_NUMBER_UUID)

87 
CONST
 
uöt8
 
	gdevInfoSîülNumbîUUID
[
ATT_BT_UUID_SIZE
] =

89 
LO_UINT16
(
DEVINFO_SERIAL_NUMBER_UUID
), 
HI_UINT16
(DEVINFO_SERIAL_NUMBER_UUID)

93 
CONST
 
uöt8
 
	gdevInfoFúmw¨eRevUUID
[
ATT_BT_UUID_SIZE
] =

95 
LO_UINT16
(
DEVINFO_FIRMWARE_REV_UUID
), 
HI_UINT16
(DEVINFO_FIRMWARE_REV_UUID)

99 
CONST
 
uöt8
 
	gdevInfoH¨dw¨eRevUUID
[
ATT_BT_UUID_SIZE
] =

101 
LO_UINT16
(
DEVINFO_HARDWARE_REV_UUID
), 
HI_UINT16
(DEVINFO_HARDWARE_REV_UUID)

105 
CONST
 
uöt8
 
	gdevInfoSo·w¨eRevUUID
[
ATT_BT_UUID_SIZE
] =

107 
LO_UINT16
(
DEVINFO_SOFTWARE_REV_UUID
), 
HI_UINT16
(DEVINFO_SOFTWARE_REV_UUID)

111 
CONST
 
uöt8
 
	gdevInfoM‰NameUUID
[
ATT_BT_UUID_SIZE
] =

113 
LO_UINT16
(
DEVINFO_MANUFACTURER_NAME_UUID
), 
HI_UINT16
(DEVINFO_MANUFACTURER_NAME_UUID)

117 
CONST
 
uöt8
 
	gdevInfo11073CîtUUID
[
ATT_BT_UUID_SIZE
] =

119 
LO_UINT16
(
DEVINFO_11073_CERT_DATA_UUID
), 
HI_UINT16
(DEVINFO_11073_CERT_DATA_UUID)

123 
CONST
 
uöt8
 
	gdevInfoP≈IdUUID
[
ATT_BT_UUID_SIZE
] =

125 
LO_UINT16
(
DEVINFO_PNP_ID_UUID
), 
HI_UINT16
(DEVINFO_PNP_ID_UUID)

146 
CONST
 
g©tAârTy≥_t
 
	gdevInfoSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
devInfoSîvUUID
 };

149 
uöt8
 
	gdevInfoSy°emIdPr›s
 = 
GATT_PROP_READ
;

150 
uöt8
 
	gdevInfoSy°emId
[
DEVINFO_SYSTEM_ID_LEN
] = {0, 0, 0, 0, 0, 0, 0, 0};

153 
uöt8
 
	gdevInfoModñNumbîPr›s
 = 
GATT_PROP_READ
;

154 c⁄° 
uöt8
 
	gdevInfoModñNumbî
[] = "Model Number";

157 
uöt8
 
	gdevInfoSîülNumbîPr›s
 = 
GATT_PROP_READ
;

158 c⁄° 
uöt8
 
	gdevInfoSîülNumbî
[] = "Serial Number";

161 
uöt8
 
	gdevInfoFúmw¨eRevPr›s
 = 
GATT_PROP_READ
;

162 c⁄° 
uöt8
 
	gdevInfoFúmw¨eRev
[] = "Firmware Revision";

165 
uöt8
 
	gdevInfoH¨dw¨eRevPr›s
 = 
GATT_PROP_READ
;

166 c⁄° 
uöt8
 
	gdevInfoH¨dw¨eRev
[] = "Hardware Revision";

169 
uöt8
 
	gdevInfoSo·w¨eRevPr›s
 = 
GATT_PROP_READ
;

170 c⁄° 
uöt8
 
	gdevInfoSo·w¨eRev
[] = "Software Revision";

173 
uöt8
 
	gdevInfoM‰NamePr›s
 = 
GATT_PROP_READ
;

174 c⁄° 
uöt8
 
	gdevInfoM‰Name
[] = "Manufacturer Name";

177 
uöt8
 
	gdevInfo11073CîtPr›s
 = 
GATT_PROP_READ
;

178 c⁄° 
uöt8
 
	gdevInfo11073Cît
[] =

180 
DEVINFO_11073_BODY_EXP
,

187 
uöt8
 
	gdevInfoP≈IdPr›s
 = 
GATT_PROP_READ
;

188 
uöt8
 
	gdevInfoP≈Id
[
DEVINFO_PNP_ID_LEN
] =

191 
LO_UINT16
(0x000D), 
HI_UINT16
(0x000D),

192 
LO_UINT16
(0x0000), 
HI_UINT16
(0x0000),

193 
LO_UINT16
(0x0110), 
HI_UINT16
(0x0110)

200 
g©tAâribuã_t
 
	gdevInfoAârTbl
[] =

204 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

205 
GATT_PERMIT_READ
,

207 (
uöt8
 *)&
devInfoSîvi˚


212 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

213 
GATT_PERMIT_READ
,

215 &
devInfoSy°emIdPr›s


220 { 
ATT_BT_UUID_SIZE
, 
devInfoSy°emIdUUID
 },

221 
GATT_PERMIT_READ
,

223 (
uöt8
 *Ë
devInfoSy°emId


228 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

229 
GATT_PERMIT_READ
,

231 &
devInfoModñNumbîPr›s


236 { 
ATT_BT_UUID_SIZE
, 
devInfoModñNumbîUUID
 },

237 
GATT_PERMIT_READ
,

239 (
uöt8
 *Ë
devInfoModñNumbî


244 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

245 
GATT_PERMIT_READ
,

247 &
devInfoSîülNumbîPr›s


252 { 
ATT_BT_UUID_SIZE
, 
devInfoSîülNumbîUUID
 },

253 
GATT_PERMIT_READ
,

255 (
uöt8
 *Ë
devInfoSîülNumbî


260 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

261 
GATT_PERMIT_READ
,

263 &
devInfoFúmw¨eRevPr›s


268 { 
ATT_BT_UUID_SIZE
, 
devInfoFúmw¨eRevUUID
 },

269 
GATT_PERMIT_READ
,

271 (
uöt8
 *Ë
devInfoFúmw¨eRev


276 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

277 
GATT_PERMIT_READ
,

279 &
devInfoH¨dw¨eRevPr›s


284 { 
ATT_BT_UUID_SIZE
, 
devInfoH¨dw¨eRevUUID
 },

285 
GATT_PERMIT_READ
,

287 (
uöt8
 *Ë
devInfoH¨dw¨eRev


292 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

293 
GATT_PERMIT_READ
,

295 &
devInfoSo·w¨eRevPr›s


300 { 
ATT_BT_UUID_SIZE
, 
devInfoSo·w¨eRevUUID
 },

301 
GATT_PERMIT_READ
,

303 (
uöt8
 *Ë
devInfoSo·w¨eRev


308 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

309 
GATT_PERMIT_READ
,

311 &
devInfoM‰NamePr›s


316 { 
ATT_BT_UUID_SIZE
, 
devInfoM‰NameUUID
 },

317 
GATT_PERMIT_READ
,

319 (
uöt8
 *Ë
devInfoM‰Name


324 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

325 
GATT_PERMIT_READ
,

327 &
devInfo11073CîtPr›s


332 { 
ATT_BT_UUID_SIZE
, 
devInfo11073CîtUUID
 },

333 
GATT_PERMIT_READ
,

335 (
uöt8
 *Ë
devInfo11073Cît


340 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

341 
GATT_PERMIT_READ
,

343 &
devInfoP≈IdPr›s


348 { 
ATT_BT_UUID_SIZE
, 
devInfoP≈IdUUID
 },

349 
GATT_PERMIT_READ
,

351 (
uöt8
 *Ë
devInfoP≈Id


359 
uöt8
 
devInfo_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

360 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

366 
CONST
 
g©tSîvi˚CBs_t
 
	gdevInfoCBs
 =

368 
devInfo_RódAârCB
,

369 
NULL
,

370 
NULL


389 
bSètus_t
 
	$DevInfo_AddSîvi˚
( )

392  
	`GATTSîvAµ_Regi°îSîvi˚
–
devInfoAârTbl
,

393 
	`GATT_NUM_ATTRS
–
devInfoAârTbl
 ),

394 &
devInfoCBs
 );

395 
	}
}

411 
bSètus_t
 
	$DevInfo_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

413 
bSètus_t
 
ªt
 = 
SUCCESS
;

415  
∑øm
 )

417 
DEVINFO_SYSTEM_ID
:

418 
	`oßl_mem˝y
(
devInfoSy°emId
, 
vÆue
, 
Àn
);

422 
ªt
 = 
INVALIDPARAMETER
;

426  ( 
ªt
 );

427 
	}
}

442 
bSètus_t
 
	$DevInfo_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

444 
bSètus_t
 
ªt
 = 
SUCCESS
;

446  
∑øm
 )

448 
DEVINFO_SYSTEM_ID
:

449 
	`oßl_mem˝y
(
vÆue
, 
devInfoSy°emId
, (devInfoSystemId));

452 
DEVINFO_MODEL_NUMBER
:

453 
	`oßl_mem˝y
(
vÆue
, 
devInfoModñNumbî
, (devInfoModelNumber));

455 
DEVINFO_SERIAL_NUMBER
:

456 
	`oßl_mem˝y
(
vÆue
, 
devInfoSîülNumbî
, (devInfoSerialNumber));

459 
DEVINFO_FIRMWARE_REV
:

460 
	`oßl_mem˝y
(
vÆue
, 
devInfoFúmw¨eRev
, (devInfoFirmwareRev));

463 
DEVINFO_HARDWARE_REV
:

464 
	`oßl_mem˝y
(
vÆue
, 
devInfoH¨dw¨eRev
, (devInfoHardwareRev));

467 
DEVINFO_SOFTWARE_REV
:

468 
	`oßl_mem˝y
(
vÆue
, 
devInfoSo·w¨eRev
, (devInfoSoftwareRev));

471 
DEVINFO_MANUFACTURER_NAME
:

472 
	`oßl_mem˝y
(
vÆue
, 
devInfoM‰Name
, (devInfoMfrName));

475 
DEVINFO_11073_CERT_DATA
:

476 
	`oßl_mem˝y
(
vÆue
, 
devInfo11073Cît
, (devInfo11073Cert));

479 
DEVINFO_PNP_ID
:

480 
	`oßl_mem˝y
(
vÆue
, 
devInfoP≈Id
, (devInfoPnpId));

484 
ªt
 = 
INVALIDPARAMETER
;

488  ( 
ªt
 );

489 
	}
}

505 
uöt8
 
	$devInfo_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

506 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

508 
bSètus_t
 
°©us
 = 
SUCCESS
;

509 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

511 
uuid
)

513 
DEVINFO_SYSTEM_ID_UUID
:

515 i‡(
off£t
 >(
devInfoSy°emId
))

517 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

522 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoSy°emId
Ë- 
off£t
));

525 
	`oßl_mem˝y
(
pVÆue
, &
devInfoSy°emId
[
off£t
], *
pLí
);

529 
DEVINFO_MODEL_NUMBER_UUID
:

531 i‡(
off£t
 >(
devInfoModñNumbî
))

533 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

538 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoModñNumbî
Ë- 
off£t
));

541 
	`oßl_mem˝y
(
pVÆue
, &
devInfoModñNumbî
[
off£t
], *
pLí
);

545 
DEVINFO_SERIAL_NUMBER_UUID
:

547 i‡(
off£t
 >(
devInfoSîülNumbî
))

549 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

554 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoSîülNumbî
Ë- 
off£t
));

557 
	`oßl_mem˝y
(
pVÆue
, &
devInfoSîülNumbî
[
off£t
], *
pLí
);

561 
DEVINFO_FIRMWARE_REV_UUID
:

563 i‡(
off£t
 >(
devInfoFúmw¨eRev
))

565 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

570 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoFúmw¨eRev
Ë- 
off£t
));

573 
	`oßl_mem˝y
(
pVÆue
, &
devInfoFúmw¨eRev
[
off£t
], *
pLí
);

577 
DEVINFO_HARDWARE_REV_UUID
:

579 i‡(
off£t
 >(
devInfoH¨dw¨eRev
))

581 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

586 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoH¨dw¨eRev
Ë- 
off£t
));

589 
	`oßl_mem˝y
(
pVÆue
, &
devInfoH¨dw¨eRev
[
off£t
], *
pLí
);

593 
DEVINFO_SOFTWARE_REV_UUID
:

595 i‡(
off£t
 >(
devInfoSo·w¨eRev
))

597 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

602 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoSo·w¨eRev
Ë- 
off£t
));

605 
	`oßl_mem˝y
(
pVÆue
, &
devInfoSo·w¨eRev
[
off£t
], *
pLí
);

609 
DEVINFO_MANUFACTURER_NAME_UUID
:

611 i‡(
off£t
 >(
devInfoM‰Name
))

613 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

618 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoM‰Name
Ë- 
off£t
));

621 
	`oßl_mem˝y
(
pVÆue
, &
devInfoM‰Name
[
off£t
], *
pLí
);

625 
DEVINFO_11073_CERT_DATA_UUID
:

627 i‡(
off£t
 >(
devInfo11073Cît
))

629 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

634 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfo11073Cît
Ë- 
off£t
));

637 
	`oßl_mem˝y
(
pVÆue
, &
devInfo11073Cît
[
off£t
], *
pLí
);

641 
DEVINFO_PNP_ID_UUID
:

643 i‡(
off£t
 >(
devInfoP≈Id
))

645 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

650 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoP≈Id
Ë- 
off£t
));

653 
	`oßl_mem˝y
(
pVÆue
, &
devInfoP≈Id
[
off£t
], *
pLí
);

658 *
pLí
 = 0;

659 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

663  ( 
°©us
 );

664 
	}
}

	@Projects/ble/Profiles/DevInfo/devinfoservice.h

41 #i‚de‡
DEVINFOSERVICE_H


42 
	#DEVINFOSERVICE_H


	)

44 #ifde‡
__˝lu•lus


58 
	#DEVINFO_SYSTEM_ID
 0

	)

59 
	#DEVINFO_MODEL_NUMBER
 1

	)

60 
	#DEVINFO_SERIAL_NUMBER
 2

	)

61 
	#DEVINFO_FIRMWARE_REV
 3

	)

62 
	#DEVINFO_HARDWARE_REV
 4

	)

63 
	#DEVINFO_SOFTWARE_REV
 5

	)

64 
	#DEVINFO_MANUFACTURER_NAME
 6

	)

65 
	#DEVINFO_11073_CERT_DATA
 7

	)

66 
	#DEVINFO_PNP_ID
 8

	)

69 
	#DEVINFO_SERV_UUID
 0x180A

70 
	#DEVINFO_SYSTEM_ID_UUID
 0x2A23

71 
	#DEVINFO_MODEL_NUMBER_UUID
 0x2A24

72 
	#DEVINFO_SERIAL_NUMBER_UUID
 0x2A25

73 
	#DEVINFO_FIRMWARE_REV_UUID
 0x2A26

74 
	#DEVINFO_HARDWARE_REV_UUID
 0x2A27

75 
	#DEVINFO_SOFTWARE_REV_UUID
 0x2A28

76 
	#DEVINFO_MANUFACTURER_NAME_UUID
 0x2A29

77 
	#DEVINFO_11073_CERT_DATA_UUID
 0x2A2A

78 
	#DEVINFO_PNP_ID_UUID
 0x2A50

79 

	)

81 
	#DEVINFO_11073_BODY_EMPTY
 0

	)

82 
	#DEVINFO_11073_BODY_IEEE
 1

	)

83 
	#DEVINFO_11073_BODY_CONTINUA
 2

	)

84 
	#DEVINFO_11073_BODY_EXP
 254

	)

87 
	#DEVINFO_SYSTEM_ID_LEN
 8

	)

90 
	#DEVINFO_PNP_ID_LEN
 7

	)

115 
bSètus_t
 
DevInfo_AddSîvi˚
( );

131 
bSètus_t
 
DevInfo_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

142 
bSètus_t
 
DevInfo_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

147 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Glucose/glucservice.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"g≠b⁄dmgr.h
"

51 
	~"gluc£rvi˚.h
"

62 
	#GLUCOSE_MEAS_VALUE_POS
 2

	)

63 
	#GLUCOSE_MEAS_CONFIG_POS
 3

	)

64 
	#GLUCOSE_CONTEXT_VALUE_POS
 5

	)

65 
	#GLUCOSE_CONTEXT_CONFIG_POS
 6

	)

66 
	#GLUCOSE_CTL_PNT_VALUE_POS
 10

	)

67 
	#GLUCOSE_CTL_PNT_CONFIG_POS
 11

	)

78 
CONST
 
uöt8
 
	ggluco£SîvUUID
[
ATT_BT_UUID_SIZE
] =

80 
LO_UINT16
(
GLUCOSE_SERV_UUID
), 
HI_UINT16
(GLUCOSE_SERV_UUID)

84 
CONST
 
uöt8
 
	ggluco£MósUUID
[
ATT_BT_UUID_SIZE
] =

86 
LO_UINT16
(
GLUCOSE_MEAS_UUID
), 
HI_UINT16
(GLUCOSE_MEAS_UUID)

90 
CONST
 
uöt8
 
	ggluco£C⁄ãxtUUID
[
ATT_BT_UUID_SIZE
] =

92 
LO_UINT16
(
GLUCOSE_CONTEXT_UUID
), 
HI_UINT16
(GLUCOSE_CONTEXT_UUID)

96 
CONST
 
uöt8
 
	ggluco£FótuªUUID
[
ATT_BT_UUID_SIZE
] =

98 
LO_UINT16
(
GLUCOSE_FEATURE_UUID
), 
HI_UINT16
(GLUCOSE_FEATURE_UUID)

102 
CONST
 
uöt8
 
	gªc‹dC⁄åﬁPoötUUID
[
ATT_BT_UUID_SIZE
] =

104 
LO_UINT16
(
RECORD_CONTROL_POINT_UUID
), 
HI_UINT16
(RECORD_CONTROL_POINT_UUID)

112 
boﬁ
 
gluco£SídAŒRec‹ds
;

122 
gluco£Sîvi˚CB_t
 
	ggluco£Sîvi˚CB
;

129 
CONST
 
g©tAârTy≥_t
 
	ggluco£Sîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
gluco£SîvUUID
 };

132 
uöt8
 
	ggluco£Pr›s
 = 
GATT_PROP_NOTIFY
;

133 
g©tCh¨Cfg_t
 
	ggluco£MósC⁄fig
[
GATT_MAX_NUM_CONN
];

134 
uöt8
 
	ggluco£Mós
 = 0;

137 
uöt8
 
	ggluco£C⁄ãxtPr›s
 = 
GATT_PROP_NOTIFY
;

138 
uöt8
 
	ggluco£C⁄ãxt
=0;

139 
g©tCh¨Cfg_t
 
	ggluco£C⁄ãxtC⁄fig
[
GATT_MAX_NUM_CONN
];

142 
uöt8
 
	ggluco£FótuªPr›s
 = 
GATT_PROP_READ
;

143 
uöt16
 
	ggluco£Fótuª
 = 
GLUCOSE_FEAT_ALL
;

146 
uöt8
 
	ggluco£C⁄åﬁPr›s
 = 
GATT_PROP_INDICATE
 | 
GATT_PROP_WRITE
;

147 
uöt8
 
	ggluco£C⁄åﬁ
=0;

148 
g©tCh¨Cfg_t
 
	ggluco£C⁄åﬁC⁄fig
[
GATT_MAX_NUM_CONN
];

154 
g©tAâribuã_t
 
	ggluco£AârTbl
[] =

158 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

159 
GATT_PERMIT_READ
,

161 (
uöt8
 *)&
gluco£Sîvi˚


166 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

167 
GATT_PERMIT_READ
,

169 &
gluco£Pr›s


174 { 
ATT_BT_UUID_SIZE
, 
gluco£MósUUID
 },

177 &
gluco£Mós


182 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

183 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

185 (
uöt8
 *)&
gluco£MósC⁄fig


194 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

195 
GATT_PERMIT_READ
,

197 &
gluco£C⁄ãxtPr›s


202 { 
ATT_BT_UUID_SIZE
, 
gluco£C⁄ãxtUUID
 },

205 &
gluco£C⁄ãxt


210 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

211 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

213 (
uöt8
 *)&
gluco£C⁄ãxtC⁄fig


222 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

223 
GATT_PERMIT_READ
,

225 &
gluco£FótuªPr›s


230 { 
ATT_BT_UUID_SIZE
, 
gluco£FótuªUUID
 },

231 
GATT_PERMIT_READ
,

233 (
uöt8
 *Ë&
gluco£Fótuª


242 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

243 
GATT_PERMIT_READ
,

245 &
gluco£C⁄åﬁPr›s


250 { 
ATT_BT_UUID_SIZE
, 
ªc‹dC⁄åﬁPoötUUID
 },

251 
GATT_PERMIT_WRITE
 | 
GATT_PERMIT_AUTHEN_WRITE
,

253 &
gluco£C⁄åﬁ


258 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

259 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

261 (
uöt8
 *)&
gluco£C⁄åﬁC⁄fig


268 
uöt8
 
gluco£_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

269 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

270 
bSètus_t
 
gluco£_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

271 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

273 
gluco£_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

279 
CONST
 
g©tSîvi˚CBs_t
 
	ggluco£CBs
 =

281 
gluco£_RódAârCB
,

282 
gluco£_WrôeAârCB
,

283 
NULL


302 
bSètus_t
 
	$Gluco£_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

304 
uöt8
 
°©us
 = 
SUCCESS
;

307 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
gluco£MósC⁄fig
 );

308 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
gluco£C⁄ãxtC⁄fig
 );

309 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
gluco£C⁄åﬁC⁄fig
 );

312 
VOID
 
	`lökDB_Regi°î
–
gluco£_H™dÀC⁄nSètusCB
 );

314 i‡–
£rvi˚s
 & 
GLUCOSE_SERVICE
 )

317 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
gluco£AârTbl
, 
	`GATT_NUM_ATTRS
( glucoseAttrTbl ),

318 &
gluco£CBs
 );

320  ( 
°©us
 );

321 
	}
}

333 
	$Gluco£_Regi°î
–
gluco£Sîvi˚CB_t
 
p‚Sîvi˚CB
)

335 
gluco£Sîvi˚CB
 = 
p‚Sîvi˚CB
;

336 
	}
}

352 
bSètus_t
 
	$Gluco£_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

354 
bSètus_t
 
ªt
 = 
SUCCESS
;

355  
∑øm
 )

357 
GLUCOSE_FEATURE_PARAM
:

358 
gluco£Fótuª
 = *((
uöt16
*)
vÆue
);

362 
ªt
 = 
INVALIDPARAMETER
;

366  ( 
ªt
 );

367 
	}
}

382 
bSètus_t
 
	$Gluco£_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

384 
bSètus_t
 
ªt
 = 
SUCCESS
;

385  
∑øm
 )

387 
GLUCOSE_FEATURE_PARAM
:

388 *((
uöt16
*)
vÆue
Ë
gluco£Fótuª
;

392 
ªt
 = 
INVALIDPARAMETER
;

396  ( 
ªt
 );

397 
	}
}

409 
bSètus_t
 
	$Gluco£_MósSíd
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
, 
uöt8
 
èskId
 )

411 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
gluco£MósC⁄fig
 );

414 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

417 
pNŸi
->
h™dÀ
 = 
gluco£AârTbl
[
GLUCOSE_MEAS_VALUE_POS
].handle;

420  
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
 );

423  
bÀNŸRódy
;

424 
	}
}

437 
bSètus_t
 
	$Gluco£_C⁄ãxtSíd
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
, 
uöt8
 
èskId
 )

439 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
gluco£C⁄ãxtC⁄fig
 );

442 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

445 
pNŸi
->
h™dÀ
 = 
gluco£AârTbl
[
GLUCOSE_CONTEXT_VALUE_POS
].handle;

448  
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
 );

451  
bÀNŸRódy
;

452 
	}
}

465 
bSètus_t
 
	$Gluco£_CéP¡Indiˇã
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pInd
, 
uöt8
 
èskId
 )

467 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
gluco£C⁄åﬁC⁄fig
 );

470 i‡–
vÆue
 & 
GATT_CLIENT_CFG_INDICATE
 )

473 
pInd
->
h™dÀ
 = 
gluco£AârTbl
[
GLUCOSE_CTL_PNT_VALUE_POS
].handle;

476  
	`GATT_Indiˇti⁄
–
c⁄nH™dÀ
, 
pInd
, 
FALSE
, 
èskId
 );

479  
bÀNŸRódy
;

480 
	}
}

496 
uöt8
 
	$gluco£_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

497 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

499 
bSètus_t
 
°©us
 = 
SUCCESS
;

502 i‡–
	`lökDB_En¸y±ed
–
c⁄nH™dÀ
 ) =
FALSE
 )

504  
ATT_ERR_INSUFFICIENT_ENCRYPT
;

508 i‡–
off£t
 > 0 )

510  ( 
ATT_ERR_ATTR_NOT_LONG
 );

513 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

516 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

517  
uuid
 )

522 
GLUCOSE_FEATURE_UUID
:

523 *
pLí
 = 2;

524 
pVÆue
[0] = 
	`LO_UINT16
–
gluco£Fótuª
 );

525 
pVÆue
[1] = 
	`HI_UINT16
–
gluco£Fótuª
 );

530 *
pLí
 = 0;

531 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

536  ( 
°©us
 );

537 
	}
}

552 
bSètus_t
 
	$gluco£_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

553 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

555 
bSètus_t
 
°©us
 = 
SUCCESS
;

558 i‡–
	`lökDB_En¸y±ed
–
c⁄nH™dÀ
 ) =
FALSE
 )

560  
ATT_ERR_INSUFFICIENT_ENCRYPT
;

564 i‡–
off£t
 > 0 )

566  ( 
ATT_ERR_ATTR_NOT_LONG
 );

569 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

571  
uuid
 )

574 
GATT_CLIENT_CHAR_CFG_UUID
:

576 i‡((
pAâr
->
h™dÀ
 =
gluco£AârTbl
[
GLUCOSE_MEAS_CONFIG_POS
].handle ||

577 
pAâr
->
h™dÀ
 =
gluco£AârTbl
[
GLUCOSE_CONTEXT_CONFIG_POS
].handle))

579 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

580 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

581 i‡–
°©us
 =
SUCCESS
 )

583 
uöt16
 
ch¨Cfg
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

585 if(
pAâr
->
h™dÀ
 =
gluco£AârTbl
[
GLUCOSE_MEAS_CONFIG_POS
].handle)

587 (*
gluco£Sîvi˚CB
)((
ch¨Cfg
 =0Ë? 
GLUCOSE_MEAS_NTF_DISABLED
 :

588 
GLUCOSE_MEAS_NTF_ENABLED
, 
NULL
, NULL);

592 (*
gluco£Sîvi˚CB
)((
ch¨Cfg
 =0Ë? 
GLUCOSE_CONTEXT_NTF_DISABLED
 :

593 
GLUCOSE_CONTEXT_NTF_ENABLED
, 
NULL
, NULL);

598 i‡–
pAâr
->
h™dÀ
 =
gluco£AârTbl
[
GLUCOSE_CTL_PNT_CONFIG_POS
].handle )

600 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

601 
off£t
, 
GATT_CLIENT_CFG_INDICATE
 );

602 i‡–
°©us
 =
SUCCESS
 )

604 
uöt16
 
ch¨Cfg
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

606 (*
gluco£Sîvi˚CB
)((
ch¨Cfg
 =0Ë? 
GLUCOSE_CTL_PNT_IND_DISABLED
 :

607 
GLUCOSE_CTL_PNT_IND_ENABLED
, 
NULL
, NULL);

612 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

616 
RECORD_CONTROL_POINT_UUID
:

617 if(
Àn
 >
GLUCOSE_CTL_PNT_MIN_SIZE
 &&Üí <
GLUCOSE_CTL_PNT_MAX_SIZE
)

619 
uöt8
 
›code
 = 
pVÆue
[0];

622 i‡(
›code
 !
CTL_PNT_OP_ABORT
 && 
gluco£SídAŒRec‹ds
)

624 
°©us
 = 
GLUCOSE_ERR_IN_PROGRESS
;

627 i‡–
›code
 =
CTL_PNT_OP_REQ
 &&

628 !–
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
gluco£MósC⁄fig
 ) & 
GATT_CLIENT_CFG_NOTIFY
 ) )

630 
°©us
 = 
GLUCOSE_ERR_CCC_CONFIG
;

634 (*
gluco£Sîvi˚CB
)(
GLUCOSE_CTL_PNT_CMD
, 
pVÆue
, 
Àn
);

639 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

644 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

648  ( 
°©us
 );

649 
	}
}

661 
	$gluco£_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

664 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

667 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

668 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

669 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

671 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
gluco£MósC⁄fig
 );

672 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
gluco£C⁄ãxtC⁄fig
 );

673 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
gluco£C⁄åﬁC⁄fig
 );

676 
	}
}

	@Projects/ble/Profiles/Glucose/glucservice.h

40 #i‚de‡
GLUCOSESERVICE_H


41 
	#GLUCOSESERVICE_H


	)

43 #ifde‡
__˝lu•lus


51 
	~"OSAL_˛ock.h
"

58 
	#GLUCOSE_FEATURE_PARAM
 3

	)

61 
	#GLUCOSE_CTL_PNT_MIN_SIZE
 2

	)

62 
	#GLUCOSE_CTL_PNT_MAX_SIZE
 20

	)

65 
	#GLUCOSE_SERV_UUID
 0x1808

	)

66 
	#GLUCOSE_MEAS_UUID
 0x2A18

	)

67 
	#GLUCOSE_CONTEXT_UUID
 0x2A34

	)

68 
	#GLUCOSE_FEATURE_UUID
 0x2A51

	)

69 
	#RECORD_CONTROL_POINT_UUID
 0x2A52

	)

73 
	#GLUCOSE_MEAS_FLAG_TIME_OFFSET
 0x01

	)

74 
	#GLUCOSE_MEAS_FLAG_CONCENTRATION
 0x02

	)

75 
	#GLUCOSE_MEAS_FLAG_UNITS
 0x04

	)

76 
	#GLUCOSE_MEAS_FLAG_STATUS_ANNUNCIATION
 0x08

	)

77 
	#GLUCOSE_MEAS_FLAG_CONTEXT_INFO
 0x10

	)

79 
	#GLUCOSE_MEAS_FLAG_ALL
 (
GLUCOSE_MEAS_FLAG_TIME_OFFSET
 | 
GLUCOSE_MEAS_FLAG_CONCENTRATION
 | 
GLUCOSE_MEAS_FLAG_UNITS
 | 
GLUCOSE_MEAS_FLAG_STATUS_ANNUNCIATION
 | 
GLUCOSE_MEAS_FLAG_CONTEXT_INFO
)

	)

82 
	#GLUCOSE_TYPE_CAPILLARY_WHOLE
 0x1

	)

83 
	#GLUCOSE_TYPE_CAPILLARY_PLASMA
 0x2

	)

84 
	#GLUCOSE_TYPE_VENOUS_WHOLE
 0x3

	)

85 
	#GLUCOSE_TYPE_VENOUS_PLASMA
 0x4

	)

86 
	#GLUCOSE_TYPE_ARTERIAL_WHOLE
 0x5

	)

87 
	#GLUCOSE_TYPE_ARTERIAL_PLASMA
 0x6

	)

88 
	#GLUCOSE_TYPE_UNDETER_WHOLE
 0x7

	)

89 
	#GLUCOSE_TYPE_UNDETER_PLASMA
 0x8

	)

90 
	#GLUCOSE_TYPE_ISF
 0x9

	)

91 
	#GLUCOSE_TYPE_CONTROL
 0xA

	)

94 
	#GLUCOSE_LOCATION_FINGER
 0x10

	)

95 
	#GLUCOSE_LOCATION_AST
 0x20

	)

96 
	#GLUCOSE_LOCATION_EARLOBE
 0x30

	)

97 
	#GLUCOSE_LOCATION_CONTROL
 0x40

	)

98 
	#GLUCOSE_LOCATION_NOT_AVAIL
 0xF0

	)

101 
	#GLUCOSE_ANNUNCIATION_BATT_LOW
 0x0001

	)

102 
	#GLUCOSE_ANNUNCIATION_SENS_BAD
 0x0002

	)

103 
	#GLUCOSE_ANNUNCIATION_SAMP_SIZE
 0x0004

	)

104 
	#GLUCOSE_ANNUNCIATION_INSERT
 0x0008

	)

105 
	#GLUCOSE_ANNUNCIATION_STRIP
 0x0010

	)

106 
	#GLUCOSE_ANNUNCIATION_TOO_HIGH
 0x0020

	)

107 
	#GLUCOSE_ANNUNCIATION_TOO_LOW
 0x0040

	)

108 
	#GLUCOSE_ANNUNCIATION_TEMP_HIGH
 0x0080

	)

109 
	#GLUCOSE_ANNUNCIATION_TEMP_LOW
 0x0100

	)

110 
	#GLUCOSE_ANNUNCIATION_INTERRUPTED
 0x0200

	)

111 
	#GLUCOSE_ANNUNCIATION_GENERAL
 0x0400

	)

112 
	#GLUCOSE_ANNUNCIATION_TIME
 0x0800

	)

115 
	#GLUCOSE_CONTEXT_FLAG_CARBO
 0x01

	)

116 
	#GLUCOSE_CONTEXT_FLAG_MEAL
 0x02

	)

117 
	#GLUCOSE_CONTEXT_FLAG_TESTER_HEALTH
 0x04

	)

118 
	#GLUCOSE_CONTEXT_FLAG_EXERCISE
 0x08

	)

119 
	#GLUCOSE_CONTEXT_FLAG_MEDICATION
 0x10

	)

120 
	#GLUCOSE_CONTEXT_FLAG_MEDICATION_UNITS
 0x20

	)

121 
	#GLUCOSE_CONTEXT_FLAG_HbA1c
 0x40

	)

122 
	#GLUCOSE_CONTEXT_FLAG_EXTENDED
 0x80

	)

125 
	#GLUCOSE_CONTEXT_FLAG_ALL
 (
GLUCOSE_CONTEXT_FLAG_CARBO
 | 
GLUCOSE_CONTEXT_FLAG_MEAL
 | 
GLUCOSE_CONTEXT_FLAG_TESTER_HEALTH
 | 
GLUCOSE_CONTEXT_FLAG_EXERCISE
 | 
GLUCOSE_CONTEXT_FLAG_MEDICATION
 | 
GLUCOSE_CONTEXT_FLAG_MEDICATION_UNITS
 | 
GLUCOSE_CONTEXT_FLAG_HbA1c
)

	)

128 
	#GLUCOSE_CARBO_BREAKFAST
 0x01

	)

129 
	#GLUCOSE_CARBO_LUNCH
 0x02

	)

130 
	#GLUCOSE_CARBO_DINNER
 0x03

	)

131 
	#GLUCOSE_CARBO_SNACK
 0x04

	)

132 
	#GLUCOSE_CARBO_DRINK
 0x05

	)

133 
	#GLUCOSE_CARBO_SUPPER
 0x06

	)

134 
	#GLUCOSE_CARBO_BRUNCH
 0x07

	)

137 
	#GLUCOSE_MEAL_PREPRANDIAL
 0x1

	)

138 
	#GLUCOSE_MEAL_POSTPRANDIAL
 0x2

	)

139 
	#GLUCOSE_MEAL_FASTING
 0x3

	)

140 
	#GLUCOSE_MEAL_CASUAL
 0x4

	)

143 
	#GLUCOSE_TESTER_SELF
 0x1

	)

144 
	#GLUCOSE_TESTER_PROFESSIONAL
 0x2

	)

145 
	#GLUCOSE_TESTER_LAB_TEST
 0x3

	)

146 
	#GLUCOSE_TESTER_UNAVAILABLE
 0xF

	)

149 
	#GLUCOSE_HEALTH_MINOR
 0x10

	)

150 
	#GLUCOSE_HEALTH_MAJOR
 0x20

	)

151 
	#GLUCOSE_HEALTH_MENSES
 0x30

	)

152 
	#GLUCOSE_HEALTH_STRESS
 0x40

	)

153 
	#GLUCOSE_HEALTH_NONE
 0x50

	)

154 
	#GLUCOSE_HEALTH_UNAVAILABLE
 0xF0

	)

157 
	#GLUCOSE_MEDICATION_RAPID
 0x1

	)

158 
	#GLUCOSE_MEDICATION_SHORT
 0x2

	)

159 
	#GLUCOSE_MEDICATION_INTERMEDIATE
 0x3

	)

160 
	#GLUCOSE_MEDICATION_LONG
 0x4

	)

161 
	#GLUCOSE_MEDICATION_PRE_MIXED
 0x5

	)

164 
	#GLUCOSE_FEAT_LOW_BAT_SUP
 0x0001

	)

165 
	#GLUCOSE_FEAT_MALFUNC_SUP
 0x0002

	)

166 
	#GLUCOSE_FEAT_SAMPLE_SIZE_SUP
 0x0004

	)

167 
	#GLUCOSE_FEAT_INSERT_ERR_SUP
 0x0008

	)

168 
	#GLUCOSE_FEAT_TYPE_ERR_SUP
 0x0010

	)

169 
	#GLUCOSE_FEAT_RESULT_DET_SUP
 0x0020

	)

170 
	#GLUCOSE_FEAT_TEMP_DET_SUP
 0x0040

	)

171 
	#GLUCOSE_FEAT_READ_INT_SUP
 0x0080

	)

172 
	#GLUCOSE_FEAT_GENERAL_FAULT_SUP
 0x0100

	)

173 
	#GLUCOSE_FEAT_TIME_FAULT_SUP
 0x0200

	)

174 
	#GLUCOSE_FEAT_MULTIPLE_BOND_SUP
 0x0400

	)

176 
	#GLUCOSE_FEAT_ALL
 (
GLUCOSE_FEAT_LOW_BAT_SUP
 | 
GLUCOSE_FEAT_MALFUNC_SUP
 | 
GLUCOSE_FEAT_SAMPLE_SIZE_SUP
 | \

177 
GLUCOSE_FEAT_INSERT_ERR_SUP
 | 
GLUCOSE_FEAT_TYPE_ERR_SUP
 | 
GLUCOSE_FEAT_RESULT_DET_SUP
 | \

178 
GLUCOSE_FEAT_TEMP_DET_SUP
 | 
GLUCOSE_FEAT_READ_INT_SUP
 | 
GLUCOSE_FEAT_GENERAL_FAULT_SUP
 | \

179 
GLUCOSE_FEAT_TIME_FAULT_SUP
 | 
GLUCOSE_FEAT_MULTIPLE_BOND_SUP
)

	)

182 
	#GLUCOSE_SERVICE
 0x00000001

	)

185 
	#CTL_PNT_OP_REQ
 0x01

	)

186 
	#CTL_PNT_OP_CLR
 0x02

	)

187 
	#CTL_PNT_OP_ABORT
 0x03

	)

188 
	#CTL_PNT_OP_GET_NUM
 0x04

	)

189 
	#CTL_PNT_OP_NUM_RSP
 0x05

	)

190 
	#CTL_PNT_OP_REQ_RSP
 0x06

	)

193 
	#CTL_PNT_OPER_NULL
 0x00

	)

194 
	#CTL_PNT_OPER_ALL
 0x01

	)

195 
	#CTL_PNT_OPER_LESS_EQUAL
 0x02

	)

196 
	#CTL_PNT_OPER_GREATER_EQUAL
 0x03

	)

197 
	#CTL_PNT_OPER_RANGE
 0x04

	)

198 
	#CTL_PNT_OPER_FIRST
 0x05

	)

199 
	#CTL_PNT_OPER_LAST
 0x06

	)

202 
	#CTL_PNT_RSP_SUCCESS
 0x01

	)

203 
	#CTL_PNT_RSP_OPCODE_NOT_SUPPORTED
 0x02

	)

204 
	#CTL_PNT_RSP_OPER_INVALID
 0x03

	)

205 
	#CTL_PNT_RSP_OPER_NOT_SUPPORTED
 0x04

	)

206 
	#CTL_PNT_RSP_OPERAND_INVALID
 0x05

	)

207 
	#CTL_PNT_RSP_NO_RECORDS
 0x06

	)

208 
	#CTL_PNT_RSP_ABORT_FAILED
 0x07

	)

209 
	#CTL_PNT_RSP_PROC_NOT_CMPL
 0x08

	)

210 
	#CTL_PNT_RSP_FILTER_NOT_SUPPORTED
 0x09

	)

213 
	#CTL_PNT_FILTER_SEQNUM
 0x01

	)

214 
	#CTL_PNT_FILTER_TIME
 0x02

	)

217 
	#GLUCOSE_MEAS_NTF_ENABLED
 1

	)

218 
	#GLUCOSE_MEAS_NTF_DISABLED
 2

	)

219 
	#GLUCOSE_CONTEXT_NTF_ENABLED
 3

	)

220 
	#GLUCOSE_CONTEXT_NTF_DISABLED
 4

	)

221 
	#GLUCOSE_CTL_PNT_IND_ENABLED
 5

	)

222 
	#GLUCOSE_CTL_PNT_IND_DISABLED
 6

	)

223 
	#GLUCOSE_CTL_PNT_CMD
 7

	)

226 
	#GLUCOSE_PROCEDURE_TIMEOUT
 30000

	)

229 
	#GLUCOSE_ERR_IN_PROGRESS
 0x80

	)

230 
	#GLUCOSE_ERR_CCC_CONFIG
 0x81

	)

237 (*
gluco£Sîvi˚CB_t
)(
	tuöt8
 
	tevít
, uöt8* 
	td©a
, uöt8 
	td©aLí
);

259 
bSètus_t
 
Gluco£_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

268 
Gluco£_Regi°î
–
gluco£Sîvi˚CB_t
 
p‚Sîvi˚CB
);

280 
bSètus_t
 
Gluco£_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

291 
bSètus_t
 
Gluco£_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

303 
bSètus_t
 
Gluco£_MósSíd
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
, 
uöt8
 
èskId
 );

315 
bSètus_t
 
Gluco£_C⁄ãxtSíd
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
, 
uöt8
 
èskId
 );

328 
bSètus_t
 
Gluco£_CéP¡Indiˇã
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pInd
, 
uöt8
 
èskId
 );

334 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/HIDDev/hid_uuid.h

39 #i‚de‡
HID_UUID_H


40 
	#HID_UUID_H


	)

42 #ifde‡
__˝lu•lus


52 
	#HID_SERVICE_UUID
 0x1812

	)

55 
	#HID_BOOT_KEY_INPUT_UUID
 0x2A22

56 
	#HID_BOOT_KEY_OUTPUT_UUID
 0x2A32

57 
	#HID_BOOT_MOUSE_INPUT_UUID
 0x2A33

58 
	#HID_INFORMATION_UUID
 0x2A4A

59 
	#HID_REPORT_MAP_UUID
 0x2A4B

60 
	#HID_CONTROL_POINT_UUID
 0x2A4C

61 
	#HID_REPORT_UUID
 0x2A4D

62 
	#HID_PROTOCOL_MODE_UUID
 0x2A4E

63 

	)

65 
	#HID_FLAGS_REMOTE_WAKE
 0x01

66 
	#HID_FLAGS_NORMALLY_CONNECTABLE
 0x02

67 

	)

69 
	#HID_CMD_SUSPEND
 0x00

70 
	#HID_CMD_EXIT_SUSPEND
 0x01

71 

	)

73 
	#HID_PROTOCOL_MODE_BOOT
 0x00

74 
	#HID_PROTOCOL_MODE_REPORT
 0x01

75 

	)

77 
	#HID_PROTOCOL_MODE_LEN
 1

78 
	#HID_INFORMATION_LEN
 4

79 
	#HID_REPORT_REF_LEN
 2

80 
	#HID_EXT_REPORT_REF_LEN
 2

81 

	)

85 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/HIDDev/hiddev.c

46 
	~"bcomdef.h
"

47 
	~"OSAL.h
"

48 
	~"OnBﬂrd.h
"

49 
	~"g©t.h
"

50 
	~"hci.h
"

51 
	~"g≠g©t£rvî.h
"

52 
	~"g©t£rv≠p.h
"

53 
	~"g©t_uuid.h
"

54 
	~"lökdb.h
"

55 
	~"≥rùhîÆ.h
"

56 
	~"g≠b⁄dmgr.h
"

57 
	~"devöfo£rvi˚.h
"

58 
	~"b©t£rvi˚.h
"

59 
	~"sˇ≈¨am£rvi˚.h
"

60 
	~"hiddev.h
"

67 
	#DEFAULT_BATT_PERIOD
 15000

	)

70 
	#DEFAULT_SCAN_PARAM_NOTIFY_TEST
 
TRUE


	)

73 
	#HID_INITIAL_ADV_INT_MIN
 48

	)

74 
	#HID_INITIAL_ADV_INT_MAX
 80

	)

75 
	#HID_HIGH_ADV_INT_MIN
 32

	)

76 
	#HID_HIGH_ADV_INT_MAX
 48

	)

77 
	#HID_LOW_ADV_INT_MIN
 1600

	)

78 
	#HID_LOW_ADV_INT_MAX
 1600

	)

81 
	#HID_INITIAL_ADV_TIMEOUT
 60

	)

82 
	#HID_HIGH_ADV_TIMEOUT
 5

	)

83 
	#HID_LOW_ADV_TIMEOUT
 0

	)

86 
	#START_DEVICE_EVT
 0x0001

	)

87 
	#BATT_PERIODIC_EVT
 0x0002

	)

88 
	#HID_IDLE_EVT
 0x0004

	)

89 
	#HID_SEND_REPORT_EVT
 0x0008

	)

91 
	#ªp‹tQEm±y
(Ë–
fú°QIdx
 =
œ°QIdx
 )

	)

97 
	#HID_DEV_DATA_LEN
 8

	)

99 #ifde‡
HID_DEV_RPT_QUEUE_LEN


100 
	#HID_DEV_REPORT_Q_SIZE
 (
HID_DEV_RPT_QUEUE_LEN
+1)

	)

102 
	#HID_DEV_REPORT_Q_SIZE
 (10+1)

	)

111 
uöt8
 
	mid
;

112 
uöt8
 
	mty≥
;

113 
uöt8
 
	mÀn
;

114 
uöt8
 
	md©a
[
HID_DEV_DATA_LEN
];

115 } 
	thidDevRï‹t_t
;

122 
uöt8
 
	ghidDevTaskId
;

137 
g≠rﬁe_Sèãs_t
 
	ghidDevG≠Sèã
 = 
GAPROLE_INIT
;

140 
uöt8
 
	ghidDevC⁄nSecuª
 = 
FALSE
;

143 
uöt16
 
	gg≠C⁄nH™dÀ
;

146 
uöt8
 
	ghidDevPaúögSèπed
 = 
FALSE
;

149 
uöt8
 
	g∑úögSètus
 = 
SUCCESS
;

151 
hidR±M≠_t
 *
	gpHidDevR±Tbl
;

153 
uöt8
 
	ghidDevR±TblLí
;

155 
hidDevCB_t
 *
	gpHidDevCB
;

157 
hidDevCfg_t
 *
	gpHidDevCfg
;

160 
uöt8
 
	gupd©eC⁄nP¨ams
 = 
TRUE
;

163 
uöt8
 
	gfú°QIdx
 = 0;

164 
uöt8
 
	gœ°QIdx
 = 0;

165 
hidDevRï‹t_t
 
	ghidDevRï‹tQ
[
HID_DEV_REPORT_Q_SIZE
];

168 
©tH™dÀVÆueNŸi_t
 
	gœ°NŸi
 = { 0 };

174 
hidDev_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

175 
hidDevPro˚ssG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

176 
hidDevDisc⁄√˘ed
( );

177 
hidDevG≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

178 
hidDevPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 );

179 
hidDevPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

180 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 );

181 
hidDevB©tCB
–
uöt8
 
evít
 );

182 
hidDevSˇnP¨amCB
–
uöt8
 
evít
 );

183 
hidDevB©tPîiodicTask
( );

184 
hidR±M≠_t
 *
hidDevR±ByH™dÀ
–
uöt16
 
h™dÀ
 );

185 
hidR±M≠_t
 *
hidDevR±ById
–
uöt8
 
id
, uöt8 
ty≥
 );

186 
hidR±M≠_t
 *
hidDevR±ByCccdH™dÀ
–
uöt16
 
h™dÀ
 );

187 
hidDevEnqueueRï‹t
–
uöt8
 
id
, uöt8 
ty≥
, uöt8 
Àn
, uöt8 *
pD©a
 );

188 
hidDevRï‹t_t
 *
hidDevDequeueRï‹t
( );

189 
hidDevSídRï‹t
–
uöt8
 
id
, uöt8 
ty≥
, uöt8 
Àn
, uöt8 *
pD©a
 );

190 
hidDevHighAdvîtisög
( );

191 
hidDevLowAdvîtisög
( );

192 
hidDevInôülAdvîtisög
( );

193 
uöt8
 
hidDevB⁄dCou¡
( );

194 
hidDevSèπIdÀTimî
( );

195 
hidDevSt›IdÀTimî
( );

202 
g≠RﬁesCBs_t
 
	ghidDev_PîùhîÆCBs
 =

204 
hidDevG≠SèãCB
,

205 
NULL


209 c⁄° 
g≠B⁄dCBs_t
 
	ghidDevB⁄dCB
 =

211 
hidDevPasscodeCB
,

212 
hidDevPaúSèãCB


233 
	$HidDev_Inô
–
uöt8
 
èsk_id
 )

235 
hidDevTaskId
 = 
èsk_id
;

239 
uöt8
 
syncWL
 = 
TRUE
;

245 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_AUTO_SYNC_WL
, –
uöt8
 ), &
syncWL
 );

249 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

250 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

251 
	`DevInfo_AddSîvi˚
( );

252 
	`B©t_AddSîvi˚
( );

253 
	`SˇnP¨am_AddSîvi˚
( );

256 
	`B©t_Regi°î
–
hidDevB©tCB
 );

259 
	`SˇnP¨am_Regi°î
–
hidDevSˇnP¨amCB
 );

262 
	`oßl_£t_evít
–
hidDevTaskId
, 
START_DEVICE_EVT
 );

263 
	}
}

278 
uöt16
 
	$HidDev_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

281 
VOID
 
èsk_id
;

283 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

285 
uöt8
 *
pMsg
;

287 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
hidDevTaskId
 )Ë!
NULL
 )

289 
	`hidDev_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

292 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

296  (
evíts
 ^ 
SYS_EVENT_MSG
);

299 i‡–
evíts
 & 
START_DEVICE_EVT
 )

302 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
hidDev_PîùhîÆCBs
 );

305 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
hidDevB⁄dCB
 );

307  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

310 i‡–
evíts
 & 
HID_IDLE_EVT
 )

312 i‡–
hidDevG≠Sèã
 =
GAPROLE_CONNECTED
 )

315 i‡–
hidDevPaúögSèπed
 )

317 
	`hidDevSèπIdÀTimî
();

322 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

326  ( 
evíts
 ^ 
HID_IDLE_EVT
 );

329 i‡–
evíts
 & 
BATT_PERIODIC_EVT
 )

332 
	`hidDevB©tPîiodicTask
();

334  ( 
evíts
 ^ 
BATT_PERIODIC_EVT
 );

337 i‡–
evíts
 & 
HID_SEND_REPORT_EVT
 )

340 i‡–
hidDevC⁄nSecuª
 )

342 
hidDevRï‹t_t
 *
pRï‹t
 = 
	`hidDevDequeueRï‹t
();

344 i‡–
pRï‹t
 !
NULL
 )

347 
	`hidDevSídRï‹t
–
pRï‹t
->
id
,ÖRï‹t->
ty≥
,ÖRï‹t->
Àn
,ÖRï‹t->
d©a
 );

350  ( 
	`ªp‹tQEm±y
(Ë? 
evíts
 ^ 
HID_SEND_REPORT_EVT
 :Évents );

353  ( 
evíts
 ^ 
HID_SEND_REPORT_EVT
 );

357 
	}
}

369 
	$HidDev_Regi°î
–
hidDevCfg_t
 *
pCfg
, 
hidDevCB_t
 *
pCBs
 )

371 
pHidDevCB
 = 
pCBs
;

372 
pHidDevCfg
 = 
pCfg
;

373 
	}
}

385 
	$HidDev_Regi°îRï‹ts
–
uöt8
 
numRï‹ts
, 
hidR±M≠_t
 *
pR±
 )

387 
pHidDevR±Tbl
 = 
pR±
;

388 
hidDevR±TblLí
 = 
numRï‹ts
;

389 
	}
}

403 
	$HidDev_Rï‹t
–
uöt8
 
id
, uöt8 
ty≥
, uöt8 
Àn
, uöt8*
pD©a
 )

406 i‡–
hidDevG≠Sèã
 =
GAPROLE_CONNECTED
 )

409 i‡–
hidDevC⁄nSecuª
 )

412 i‡–
	`ªp‹tQEm±y
() )

415 
	`hidDevSídRï‹t
–
id
, 
ty≥
, 
Àn
, 
pD©a
 );

422 i‡–
hidDevG≠Sèã
 !
GAPROLE_ADVERTISING
 )

425 i‡–
	`hidDevB⁄dCou¡
() > 0 )

428 
	`hidDevHighAdvîtisög
();

434 
	`hidDevInôülAdvîtisög
();

439 
	`hidDevEnqueueRï‹t
–
id
, 
ty≥
, 
Àn
, 
pD©a
 );

440 
	}
}

449 
	$HidDev_Clo£
( )

451 
uöt8
 
∑øm
;

454 i‡–
hidDevG≠Sèã
 =
GAPROLE_CONNECTED
 )

456 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

461 
∑øm
 = 
FALSE
;

462 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
∑øm
 );

464 
	}
}

480 
bSètus_t
 
	$HidDev_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
pVÆue
 )

482 
bSètus_t
 
ªt
 = 
SUCCESS
;

484  
∑øm
 )

486 
HIDDEV_ERASE_ALLBONDS
:

487 i‡–
Àn
 == 0 )

490 i‡–
	`oßl_isbuf£t
–
œ°NŸi
.
vÆue
, 0x00,Üa°NŸi.
Àn
 ) =
FALSE
 )

494 
	`oßl_mem£t
–
œ°NŸi
.
vÆue
, 0x00,Üa°NŸi.
Àn
 );

496 
	`GATT_NŸifiˇti⁄
–
g≠C⁄nH™dÀ
, &
œ°NŸi
, 
FALSE
 );

500 i‡–
hidDevG≠Sèã
 =
GAPROLE_CONNECTED
 )

502 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

506 
fú°QIdx
 = 
œ°QIdx
 = 0;

509 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_ERASE_ALLBONDS
, 0, 
NULL
 );

513 
ªt
 = 
bÀInvÆidR™ge
;

518 
ªt
 = 
INVALIDPARAMETER
;

522  ( 
ªt
 );

523 
	}
}

538 
bSètus_t
 
	$HidDev_GëP¨amëî
–
uöt8
 
∑øm
, *
pVÆue
 )

540 
bSètus_t
 
ªt
 = 
SUCCESS
;

542  
∑øm
 )

546 
ªt
 = 
INVALIDPARAMETER
;

550  ( 
ªt
 );

551 
	}
}

564 
	$HidDev_PasscodeR•
–
uöt8
 
°©us
, 
uöt32
 
∑sscode
 )

567 
	`GAPB⁄dMgr_PasscodeR•
–
g≠C⁄nH™dÀ
, 
°©us
, 
∑sscode
 );

568 
	}
}

584 
uöt8
 
	$HidDev_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

585 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

587 
bSètus_t
 
°©us
 = 
SUCCESS
;

588 
hidR±M≠_t
 *
pR±
;

590 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

593 i‡–
off£t
 > 0 && 
uuid
 !
HID_REPORT_MAP_UUID
 )

595  ( 
ATT_ERR_ATTR_NOT_LONG
 );

598 i‡–
uuid
 =
HID_REPORT_UUID
 ||

599 
uuid
 =
HID_BOOT_KEY_INPUT_UUID
 ||

600 
uuid
 =
HID_BOOT_KEY_OUTPUT_UUID
 ||

601 
uuid
 =
HID_BOOT_MOUSE_INPUT_UUID
 )

604 i‡–
hidDevC⁄nSecuª
 =
FALSE
 )

606  ( 
ATT_ERR_INSUFFICIENT_ENCRYPT
 );

610 i‡–(
pR±
 = 
	`hidDevR±ByH™dÀ
(
pAâr
->
h™dÀ
)Ë!
NULL
 )

613 
°©us
 = (*
pHidDevCB
->
ªp‹tCB
)–
pR±
->
id
,ÖR±->
ty≥
, 
uuid
,

614 
HID_DEV_OPER_READ
, 
pLí
, 
pVÆue
 );

618 *
pLí
 = 0;

621 i‡–
uuid
 =
HID_REPORT_MAP_UUID
 )

624 i‡–
off£t
 >
hidRï‹tM≠Lí
 )

626 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

631 *
pLí
 = 
	`MIN
–
maxLí
, (
hidRï‹tM≠Lí
 - 
off£t
) );

634 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆuê+ 
off£t
, *
pLí
 );

637 i‡–
uuid
 =
HID_INFORMATION_UUID
 )

640 i‡–
hidDevC⁄nSecuª
 =
FALSE
 )

642  ( 
ATT_ERR_INSUFFICIENT_ENCRYPT
 );

645 *
pLí
 = 
HID_INFORMATION_LEN
;

646 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
HID_INFORMATION_LEN
 );

648 i‡–
uuid
 =
GATT_REPORT_REF_UUID
 )

650 *
pLí
 = 
HID_REPORT_REF_LEN
;

651 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
HID_REPORT_REF_LEN
 );

653 i‡–
uuid
 =
HID_PROTOCOL_MODE_UUID
 )

656 i‡–
hidDevC⁄nSecuª
 =
FALSE
 )

658  ( 
ATT_ERR_INSUFFICIENT_ENCRYPT
 );

661 *
pLí
 = 
HID_PROTOCOL_MODE_LEN
;

662 
pVÆue
[0] = 
pAâr
->pValue[0];

664 i‡–
uuid
 =
GATT_EXT_REPORT_REF_UUID
 )

666 *
pLí
 = 
HID_EXT_REPORT_REF_LEN
;

667 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
HID_EXT_REPORT_REF_LEN
 );

671 i‡–
°©us
 =
SUCCESS
 )

673 
	`hidDevSèπIdÀTimî
();

676  ( 
°©us
 );

677 
	}
}

692 
bSètus_t
 
	$HidDev_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

693 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

695 
bSètus_t
 
°©us
 = 
SUCCESS
;

696 
hidR±M≠_t
 *
pR±
;

699 i‡–
off£t
 > 0 )

701  ( 
ATT_ERR_ATTR_NOT_LONG
 );

704 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

706 i‡–
uuid
 =
HID_REPORT_UUID
 ||

707 
uuid
 =
HID_BOOT_KEY_OUTPUT_UUID
 )

710 i‡–
hidDevC⁄nSecuª
 =
FALSE
 )

712  ( 
ATT_ERR_INSUFFICIENT_ENCRYPT
 );

716 i‡((
pR±
 = 
	`hidDevR±ByH™dÀ
(
pAâr
->
h™dÀ
)Ë!
NULL
)

719 
°©us
 = (*
pHidDevCB
->
ªp‹tCB
)–
pR±
->
id
,ÖR±->
ty≥
, 
uuid
,

720 
HID_DEV_OPER_WRITE
, &
Àn
, 
pVÆue
 );

723 i‡–
uuid
 =
HID_CONTROL_POINT_UUID
 )

726 i‡–
hidDevC⁄nSecuª
 =
FALSE
 )

728  ( 
ATT_ERR_INSUFFICIENT_ENCRYPT
 );

732 i‡–
Àn
 == 1 )

734 i‡–
pVÆue
[0] =
HID_CMD_SUSPEND
 ||ÖVÆue[0] =
HID_CMD_EXIT_SUSPEND
 )

737 (*
pHidDevCB
->
evtCB
)–(
pVÆue
[0] =
HID_CMD_SUSPEND
) ?

738 
HID_DEV_SUSPEND_EVT
 : 
HID_DEV_EXIT_SUSPEND_EVT
 );

742 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

747 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

750 i‡–
uuid
 =
GATT_CLIENT_CHAR_CFG_UUID
 )

752 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

753 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

754 i‡–
°©us
 =
SUCCESS
 )

756 
uöt16
 
ch¨Cfg
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

759 i‡–(
pR±
 = 
	`hidDevR±ByCccdH™dÀ
(
pAâr
->
h™dÀ
)Ë!
NULL
 )

762 (*
pHidDevCB
->
ªp‹tCB
)–
pR±
->
id
,ÖR±->
ty≥
, 
uuid
,

763 (
ch¨Cfg
 =
GATT_CLIENT_CFG_NOTIFY
) ?

764 
HID_DEV_OPER_ENABLE
 : 
HID_DEV_OPER_DISABLE
,

765 &
Àn
, 
pVÆue
 );

769 i‡–
uuid
 =
HID_PROTOCOL_MODE_UUID
 )

772 i‡–
hidDevC⁄nSecuª
 =
FALSE
 )

774  ( 
ATT_ERR_INSUFFICIENT_ENCRYPT
 );

777 i‡–
Àn
 =
HID_PROTOCOL_MODE_LEN
 )

779 i‡–
pVÆue
[0] =
HID_PROTOCOL_MODE_BOOT
 ||

780 
pVÆue
[0] =
HID_PROTOCOL_MODE_REPORT
 )

782 
pAâr
->
pVÆue
[0] =ÖValue[0];

785 (*
pHidDevCB
->
evtCB
)–(
pVÆue
[0] =
HID_PROTOCOL_MODE_BOOT
) ?

786 
HID_DEV_SET_BOOT_EVT
 : 
HID_DEV_SET_REPORT_EVT
 );

790 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

795 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

800 i‡(
°©us
 =
SUCCESS
)

802 
	`hidDevSèπIdÀTimî
();

805  ( 
°©us
 );

806 
	}
}

817 
	$hidDev_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

819  
pMsg
->
evít
 )

821 
GATT_MSG_EVENT
:

822 
	`hidDevPro˚ssG©tMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

828 
	}
}

837 
	$hidDevPro˚ssG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

840 
	}
}

852 
	$hidDevH™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

854 
uöt8
 
i
;

855 
hidR±M≠_t
 *
p
 = 
pHidDevR±Tbl
;

856 
uöt16
 
ªtH™dÀ
;

857 
g©tAâribuã_t
 *
pAâr
;

860 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

862 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

863 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

864 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

866  
i
 = 
hidDevR±TblLí
; i > 0; i--, 
p
++ )

868 i‡–
p
->
cccdH™dÀ
 != 0 )

870 i‡–(
pAâr
 = 
	`GATT_FödH™dÀ
(
p
->
cccdH™dÀ
, &
ªtH™dÀ
)Ë!
NULL
 )

872 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, (
g©tCh¨Cfg_t
 *Ë
pAâr
->
pVÆue
 );

878 
	}
}

887 
	$hidDevDisc⁄√˘ed
( )

890 
	`hidDevSt›IdÀTimî
();

893 
	`B©t_H™dÀC⁄nSètusCB
–
g≠C⁄nH™dÀ
, 
LINKDB_STATUS_UPDATE_REMOVED
 );

894 
	`SˇnP¨am_H™dÀC⁄nSètusCB
–
g≠C⁄nH™dÀ
, 
LINKDB_STATUS_UPDATE_REMOVED
 );

895 
	`hidDevH™dÀC⁄nSètusCB
–
g≠C⁄nH™dÀ
, 
LINKDB_STATUS_UPDATE_REMOVED
 );

898 
hidDevC⁄nSecuª
 = 
FALSE
;

899 
hidPrŸocﬁMode
 = 
HID_PROTOCOL_MODE_REPORT
;

900 
hidDevPaúögSèπed
 = 
FALSE
;

903 
	`oßl_mem£t
–&
œ°NŸi
, 0, –
©tH™dÀVÆueNŸi_t
 ) );

906 i‡––
	`hidDevB⁄dCou¡
() > 0 ) &&

907 –
pHidDevCfg
->
hidFœgs
 & 
HID_FLAGS_NORMALLY_CONNECTABLE
 ) )

909 
	`hidDevLowAdvîtisög
();

911 
	}
}

922 
	$hidDevG≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

925 i‡–
√wSèã
 =
GAPROLE_CONNECTED
 )

928 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_CONNHANDLE
, &
g≠C⁄nH™dÀ
 );

931 
hidDevC⁄nSecuª
 = 
FALSE
;

934 
uöt8
 
∑øm
 = 
FALSE
;

935 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
∑øm
 );

938 
	`hidDevSèπIdÀTimî
();

941 i‡–
hidDevG≠Sèã
 =
GAPROLE_CONNECTED
 &&

942 
√wSèã
 !
GAPROLE_CONNECTED
 )

944 
	`hidDevDisc⁄√˘ed
();

945 
upd©eC⁄nP¨ams
 = 
TRUE
;

947 i‡–
∑úögSètus
 =
SMP_PAIRING_FAILED_CONFIRM_VALUE
 )

950 
	`hidDevInôülAdvîtisög
();

952 
∑úögSètus
 = 
SUCCESS
;

956 i‡–
√wSèã
 =
GAPROLE_STARTED
 )

961 
hidDevG≠Sèã
 = 
√wSèã
;

962 
	}
}

971 
	$hidDevPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 )

973 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_STARTED
 )

975 
hidDevPaúögSèπed
 = 
TRUE
;

977 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_COMPLETE
 )

979 
hidDevPaúögSèπed
 = 
FALSE
;

981 i‡–
°©us
 =
SUCCESS
 )

983 
hidDevC⁄nSecuª
 = 
TRUE
;

986 
∑úögSètus
 = 
°©us
;

988 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_BONDED
 )

990 i‡–
°©us
 =
SUCCESS
 )

992 
hidDevC⁄nSecuª
 = 
TRUE
;

994 #i‡
DEFAULT_SCAN_PARAM_NOTIFY_TEST
 =
TRUE


995 
	`SˇnP¨am_Re‰eshNŸify
–
g≠C⁄nH™dÀ
 );

1000 i‡–!
	`ªp‹tQEm±y
(Ë&& 
hidDevC⁄nSecuª
 )

1003 
	`oßl_£t_evít
–
hidDevTaskId
, 
HID_SEND_REPORT_EVT
 );

1005 
	}
}

1019 
	$hidDevPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

1020 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 )

1022 i‡–
pHidDevCB
 &&ÖHidDevCB->
∑sscodeCB
 )

1025 (*
pHidDevCB
->
∑sscodeCB
)–
devi˚Addr
, 
c⁄√˘i⁄H™dÀ
, 
uiI≈uts
, 
uiOuçuts
 );

1030 
	`GAPB⁄dMgr_PasscodeR•
–
c⁄√˘i⁄H™dÀ
, 
SUCCESS
, 0 );

1032 
	}
}

1043 
	$hidDevB©tCB
–
uöt8
 
evít
 )

1045 i‡–
evít
 =
BATT_LEVEL_NOTI_ENABLED
 )

1048 i‡–
hidDevG≠Sèã
 =
GAPROLE_CONNECTED
 )

1050 
	`oßl_°¨t_timîEx
–
hidDevTaskId
, 
BATT_PERIODIC_EVT
, 
DEFAULT_BATT_PERIOD
 );

1053 i‡–
evít
 =
BATT_LEVEL_NOTI_DISABLED
 )

1056 
	`oßl_°›_timîEx
–
hidDevTaskId
, 
BATT_PERIODIC_EVT
 );

1058 
	}
}

1069 
	$hidDevSˇnP¨amCB
–
uöt8
 
evít
 )

1072 
	}
}

1083 
	$hidDevB©tPîiodicTask
( )

1085 i‡–
hidDevG≠Sèã
 =
GAPROLE_CONNECTED
 )

1088 
	`B©t_MósLevñ
( );

1091 
	`oßl_°¨t_timîEx
–
hidDevTaskId
, 
BATT_PERIODIC_EVT
, 
DEFAULT_BATT_PERIOD
 );

1093 
	}
}

1104 
hidR±M≠_t
 *
	$hidDevR±ByH™dÀ
–
uöt16
 
h™dÀ
 )

1106 
uöt8
 
i
;

1107 
hidR±M≠_t
 *
p
 = 
pHidDevR±Tbl
;

1109  
i
 = 
hidDevR±TblLí
; i > 0; i--, 
p
++ )

1111 i‡–
p
->
h™dÀ
 =h™dÀ &&Ö->
mode
 =
hidPrŸocﬁMode
)

1113  
p
;

1117  
NULL
;

1118 
	}
}

1129 
hidR±M≠_t
 *
	$hidDevR±ByCccdH™dÀ
–
uöt16
 
h™dÀ
 )

1131 
uöt8
 
i
;

1132 
hidR±M≠_t
 *
p
 = 
pHidDevR±Tbl
;

1134  
i
 = 
hidDevR±TblLí
; i > 0; i--, 
p
++ )

1136 i‡–
p
->
cccdH™dÀ
 =
h™dÀ
)

1138  
p
;

1142  
NULL
;

1143 
	}
}

1155 
hidR±M≠_t
 *
	$hidDevR±ById
–
uöt8
 
id
, uöt8 
ty≥
 )

1157 
uöt8
 
i
;

1158 
hidR±M≠_t
 *
p
 = 
pHidDevR±Tbl
;

1160  
i
 = 
hidDevR±TblLí
; i > 0; i--, 
p
++ )

1162 i‡–
p
->
id
 =id &&Ö->
ty≥
 =ty≥ &&Ö->
mode
 =
hidPrŸocﬁMode
 )

1164  
p
;

1168  
NULL
;

1169 
	}
}

1183 
	$hidDevSídRï‹t
–
uöt8
 
id
, uöt8 
ty≥
, uöt8 
Àn
, uöt8 *
pD©a
 )

1185 
hidR±M≠_t
 *
pR±
;

1186 
g©tAâribuã_t
 *
pAâr
;

1187 
uöt16
 
ªtH™dÀ
;

1190 i‡–(
pR±
 = 
	`hidDevR±ById
(
id
, 
ty≥
)Ë!
NULL
 )

1193 i‡–(
pAâr
 = 
	`GATT_FödH™dÀ
(
pR±
->
cccdH™dÀ
, &
ªtH™dÀ
)Ë!
NULL
 )

1195 
uöt16
 
vÆue
;

1197 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
g≠C⁄nH™dÀ
, (
g©tCh¨Cfg_t
 *Ë
pAâr
->
pVÆue
 );

1198 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

1202 i‡–
upd©eC⁄nP¨ams
 )

1204 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_REQ
, –
uöt8
 ), &
upd©eC⁄nP¨ams
 );

1205 
upd©eC⁄nP¨ams
 = 
FALSE
;

1209 
œ°NŸi
.
h™dÀ
 = 
pR±
->handle;

1210 
œ°NŸi
.
Àn
 =Üen;

1211 
	`oßl_mem˝y
(
œ°NŸi
.
vÆue
, 
pD©a
, 
Àn
);

1213 
	`GATT_NŸifiˇti⁄
–
g≠C⁄nH™dÀ
, &
œ°NŸi
, 
FALSE
 );

1216 
	`hidDevSèπIdÀTimî
();

1220 
	}
}

1234 
	$hidDevEnqueueRï‹t
–
uöt8
 
id
, uöt8 
ty≥
, uöt8 
Àn
, uöt8 *
pD©a
 )

1237 i‡–
	`hidDevB⁄dCou¡
() > 0 )

1240 
œ°QIdx
 = (Üa°QIdx + 1 ) % 
HID_DEV_REPORT_Q_SIZE
;

1242 i‡–
œ°QIdx
 =
fú°QIdx
 )

1245 
fú°QIdx
 = ( fú°QIdx + 1 ) % 
HID_DEV_REPORT_Q_SIZE
;

1249 
hidDevRï‹tQ
[
œ°QIdx
].
id
 = id;

1250 
hidDevRï‹tQ
[
œ°QIdx
].
ty≥
 =Åype;

1251 
hidDevRï‹tQ
[
œ°QIdx
].
Àn
 =Üen;

1252 
	`oßl_mem˝y
–
hidDevRï‹tQ
[
œ°QIdx
].
d©a
, 
pD©a
, 
Àn
 );

1254 i‡–
hidDevC⁄nSecuª
 )

1257 
	`oßl_£t_evít
–
hidDevTaskId
, 
HID_SEND_REPORT_EVT
 );

1260 
	}
}

1274 
hidDevRï‹t_t
 *
	$hidDevDequeueRï‹t
( )

1276 i‡–
	`ªp‹tQEm±y
() )

1278  
NULL
;

1282 
fú°QIdx
 = ( fú°QIdx + 1 ) % 
HID_DEV_REPORT_Q_SIZE
;

1284  ( &(
hidDevRï‹tQ
[
fú°QIdx
]) );

1285 
	}
}

1296 
	$hidDevHighAdvîtisög
( )

1298 
uöt8
 
∑øm
;

1300 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
HID_HIGH_ADV_INT_MIN
 );

1301 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
HID_HIGH_ADV_INT_MAX
 );

1302 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_ADV_TIMEOUT
, 
HID_HIGH_ADV_TIMEOUT
 );

1305 
∑øm
 = 
GAP_FILTER_POLICY_WHITE
;

1306 
VOID
 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
∑øm
 );

1308 
∑øm
 = 
TRUE
;

1309 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
∑øm
 );

1310 
	}
}

1321 
	$hidDevLowAdvîtisög
( )

1323 
uöt8
 
∑øm
;

1325 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
HID_LOW_ADV_INT_MIN
 );

1326 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
HID_LOW_ADV_INT_MAX
 );

1327 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_ADV_TIMEOUT
, 
HID_LOW_ADV_TIMEOUT
 );

1330 
∑øm
 = 
GAP_FILTER_POLICY_WHITE
;

1331 
VOID
 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
∑øm
 );

1333 
∑øm
 = 
TRUE
;

1334 
VOID
 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
∑øm
 );

1335 
	}
}

1344 
	$hidDevInôülAdvîtisög
( )

1346 
uöt8
 
∑øm
;

1348 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
HID_INITIAL_ADV_INT_MIN
 );

1349 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
HID_INITIAL_ADV_INT_MAX
 );

1350 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_ADV_TIMEOUT
, 
HID_INITIAL_ADV_TIMEOUT
 );

1353 
∑øm
 = 
GAP_FILTER_POLICY_ALL
;

1354 
VOID
 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
∑øm
 );

1356 
∑øm
 = 
TRUE
;

1357 
VOID
 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
∑øm
 );

1358 
	}
}

1369 
uöt8
 
	$hidDevB⁄dCou¡
( )

1371 
uöt8
 
b⁄dC¡
 = 0;

1373 
VOID
 
	`GAPB⁄dMgr_GëP¨amëî
–
GAPBOND_BOND_COUNT
, &
b⁄dC¡
 );

1375  ( 
b⁄dC¡
 );

1376 
	}
}

1385 
	$hidDevSèπIdÀTimî
( )

1387 i‡–
pHidDevCfg
->
idÀTimeout
 > 0 )

1389 
	`oßl_°¨t_timîEx
–
hidDevTaskId
, 
HID_IDLE_EVT
, 
pHidDevCfg
->
idÀTimeout
 );

1391 
	}
}

1400 
	$hidDevSt›IdÀTimî
( )

1402 
	`oßl_°›_timîEx
–
hidDevTaskId
, 
HID_IDLE_EVT
 );

1403 
	}
}

	@Projects/ble/Profiles/HIDDev/hiddev.h

39 #i‚de‡
HIDDEV_H


40 
	#HIDDEV_H


	)

42 
	~"hid_uuid.h
"

44 #ifde‡
__˝lu•lus


62 
	#HIDDEV_ERASE_ALLBONDS
 0

63 

	)

65 
	#HID_DEV_OPER_WRITE
 0

66 
	#HID_DEV_OPER_READ
 1

67 
	#HID_DEV_OPER_ENABLE
 2

68 
	#HID_DEV_OPER_DISABLE
 3

69 

	)

71 
	#HID_DEV_SUSPEND_EVT
 0

72 
	#HID_DEV_EXIT_SUSPEND_EVT
 1

73 
	#HID_DEV_SET_BOOT_EVT
 2

74 
	#HID_DEV_SET_REPORT_EVT
 3

75 

	)

77 
	#HID_REPORT_TYPE_INPUT
 1

	)

78 
	#HID_REPORT_TYPE_OUTPUT
 2

	)

79 
	#HID_REPORT_TYPE_FEATURE
 3

	)

82 
	#HID_KEYBOARD_RESERVED
 0

83 
	#HID_KEYBOARD_A
 4

84 
	#HID_KEYBOARD_B
 5

85 
	#HID_KEYBOARD_C
 6

86 
	#HID_KEYBOARD_D
 7

87 
	#HID_KEYBOARD_E
 8

88 
	#HID_KEYBOARD_F
 9

89 
	#HID_KEYBOARD_G
 10

90 
	#HID_KEYBOARD_H
 11

91 
	#HID_KEYBOARD_I
 12

92 
	#HID_KEYBOARD_J
 13

93 
	#HID_KEYBOARD_K
 14

94 
	#HID_KEYBOARD_L
 15

95 
	#HID_KEYBOARD_M
 16

96 
	#HID_KEYBOARD_N
 17

97 
	#HID_KEYBOARD_O
 18

98 
	#HID_KEYBOARD_P
 19

99 
	#HID_KEYBOARD_Q
 20

100 
	#HID_KEYBOARD_R
 21

101 
	#HID_KEYBOARD_S
 22

102 
	#HID_KEYBOARD_T
 23

103 
	#HID_KEYBOARD_U
 24

104 
	#HID_KEYBOARD_V
 25

105 
	#HID_KEYBOARD_W
 26

106 
	#HID_KEYBOARD_X
 27

107 
	#HID_KEYBOARD_Y
 28

108 
	#HID_KEYBOARD_Z
 29

109 
	#HID_KEYBOARD_1
 30

110 
	#HID_KEYBOARD_2
 31

111 
	#HID_KEYBOARD_3
 32

112 
	#HID_KEYBOARD_4
 33

113 
	#HID_KEYBOARD_5
 34

114 
	#HID_KEYBOARD_6
 35

115 
	#HID_KEYBOARD_7
 36

116 
	#HID_KEYBOARD_8
 37

117 
	#HID_KEYBOARD_9
 38

118 
	#HID_KEYBOARD_0
 39

119 
	#HID_KEYBOARD_RETURN
 40

120 
	#HID_KEYBOARD_ESCAPE
 41

121 
	#HID_KEYBOARD_DELETE
 42

122 
	#HID_KEYBOARD_TAB
 43

123 
	#HID_KEYBOARD_SPACEBAR
 44

124 
	#HID_KEYBOARD_MINUS
 45

125 
	#HID_KEYBOARD_EQUAL
 46

126 
	#HID_KEYBOARD_LEFT_BRKT
 47

127 
	#HID_KEYBOARD_RIGHT_BRKT
 48

128 
	#HID_KEYBOARD_BACK_SLASH
 49

129 
	#HID_KEYBOARD_SEMI_COLON
 51

130 
	#HID_KEYBOARD_SGL_QUOTE
 52

131 
	#HID_KEYBOARD_GRV_ACCENT
 53

132 
	#HID_KEYBOARD_COMMA
 54

133 
	#HID_KEYBOARD_DOT
 55

134 
	#HID_KEYBOARD_FWD_SLASH
 56

135 
	#HID_KEYBOARD_CAPS_LOCK
 57

136 
	#HID_KEYBOARD_F1
 58

137 
	#HID_KEYBOARD_F2
 59

138 
	#HID_KEYBOARD_F3
 60

139 
	#HID_KEYBOARD_F4
 61

140 
	#HID_KEYBOARD_F5
 62

141 
	#HID_KEYBOARD_F6
 63

142 
	#HID_KEYBOARD_F7
 64

143 
	#HID_KEYBOARD_F8
 65

144 
	#HID_KEYBOARD_F9
 66

145 
	#HID_KEYBOARD_F10
 67

146 
	#HID_KEYBOARD_F11
 68

147 
	#HID_KEYBOARD_F12
 69

148 
	#HID_KEYBOARD_PRNT_SCREEN
 70

149 
	#HID_KEYBOARD_SCROLL_LOCK
 71

150 
	#HID_KEYBOARD_PAUSE
 72

151 
	#HID_KEYBOARD_INSERT
 73

152 
	#HID_KEYBOARD_HOME
 74

153 
	#HID_KEYBOARD_PAGE_UP
 75

154 
	#HID_KEYBOARD_DELETE_FWD
 76

155 
	#HID_KEYBOARD_END
 77

156 
	#HID_KEYBOARD_PAGE_DOWN
 78

157 
	#HID_KEYBOARD_RIGHT_ARROW
 79

158 
	#HID_KEYBOARD_LEFT_ARROW
 80

159 
	#HID_KEYBOARD_DOWN_ARROW
 81

160 
	#HID_KEYBOARD_UP_ARROW
 82

161 
	#HID_KEYBPAD_NUM_LOCK
 83

162 
	#HID_KEYBPAD_DIVIDE
 84

163 
	#HID_KEYBOARD_MULTIPLY
 85

164 
	#HID_KEYBOARD_SUBTRACT
 86

165 
	#HID_KEYBPAD_ADD
 87

166 
	#HID_KEYBPAD_ENTER
 88

167 
	#HID_KEYBPAD_1
 89

168 
	#HID_KEYBPAD_2
 90

169 
	#HID_KEYBPAD_3
 91

170 
	#HID_KEYBPAD_4
 92

171 
	#HID_KEYBPAD_5
 93

172 
	#HID_KEYBPAD_6
 94

173 
	#HID_KEYBPAD_7
 95

174 
	#HID_KEYBPAD_8
 96

175 
	#HID_KEYBPAD_9
 97

176 
	#HID_KEYBPAD_0
 98

177 
	#HID_KEYBPAD_DOT
 99

178 
	#HID_KEYBOARD_MUTE
 127

179 
	#HID_KEYBOARD_VOLUME_UP
 128

180 
	#HID_KEYBOARD_VOLUME_DOWN
 129

181 
	#HID_KEYBOARD_LEFT_CTRL
 224

182 
	#HID_KEYBOARD_LEFT_SHIFT
 225

183 
	#HID_KEYBOARD_LEFT_ALT
 226

184 
	#HID_KEYBOARD_LEFT_GUI
 227

185 
	#HID_KEYBOARD_RIGHT_CTRL
 228

186 
	#HID_KEYBOARD_RIGHT_SHIFT
 229

187 
	#HID_KEYBOARD_RIGHT_ALT
 230

188 
	#HID_KEYBOARD_RIGHT_GUI
 231

189 

	)

190 
	#HID_MOUSE_BUTTON_LEFT
 253

	)

191 
	#HID_MOUSE_BUTTON_MIDDLE
 254

	)

192 
	#HID_MOUSE_BUTTON_RIGHT
 255

	)

195 
	#HID_CONSUMER_POWER
 48

196 
	#HID_CONSUMER_RESET
 49

197 
	#HID_CONSUMER_SLEEP
 50

198 

	)

199 
	#HID_CONSUMER_MENU
 64

200 
	#HID_CONSUMER_SELECTION
 128

201 
	#HID_CONSUMER_ASSIGN_SEL
 129

202 
	#HID_CONSUMER_MODE_STEP
 130

203 
	#HID_CONSUMER_RECALL_LAST
 131

204 
	#HID_CONSUMER_QUIT
 148

205 
	#HID_CONSUMER_HELP
 149

206 
	#HID_CONSUMER_CHANNEL_UP
 156

207 
	#HID_CONSUMER_CHANNEL_DOWN
 157

208 

	)

209 
	#HID_CONSUMER_PLAY
 176

210 
	#HID_CONSUMER_PAUSE
 177

211 
	#HID_CONSUMER_RECORD
 178

212 
	#HID_CONSUMER_FAST_FORWARD
 179

213 
	#HID_CONSUMER_REWIND
 180

214 
	#HID_CONSUMER_SCAN_NEXT_TRK
 181

215 
	#HID_CONSUMER_SCAN_PREV_TRK
 182

216 
	#HID_CONSUMER_STOP
 183

217 
	#HID_CONSUMER_EJECT
 184

218 
	#HID_CONSUMER_RANDOM_PLAY
 185

219 
	#HID_CONSUMER_SELECT_DISC
 186

220 
	#HID_CONSUMER_ENTER_DISC
 187

221 
	#HID_CONSUMER_REPEAT
 188

222 
	#HID_CONSUMER_STOP_EJECT
 204

223 
	#HID_CONSUMER_PLAY_PAUSE
 205

224 
	#HID_CONSUMER_PLAY_SKIP
 206

225 

	)

226 
	#HID_CONSUMER_VOLUME
 224

227 
	#HID_CONSUMER_BALANCE
 225

228 
	#HID_CONSUMER_MUTE
 226

229 
	#HID_CONSUMER_BASS
 227

230 
	#HID_CONSUMER_VOLUME_UP
 233

231 
	#HID_CONSUMER_VOLUME_DOWN
 234

232 

	)

240 
uöt16
 
h™dÀ
;

241 
uöt16
 
cccdH™dÀ
;

242 
uöt8
 
id
;

243 
uöt8
 
ty≥
;

244 
uöt8
 
mode
;

245 } 
	thidR±M≠_t
;

250 
uöt32
 
idÀTimeout
;

251 
uöt8
 
hidFœgs
;

253 } 
	thidDevCfg_t
;

262 
uöt8
 
hidRï‹tM≠Lí
;

265 
uöt8
 
hidPrŸocﬁMode
;

272 
uöt8
 (*
	thidDevRï‹tCB_t
)–
	tuöt8
 
	tid
, uöt8 
	tty≥
, 
	tuöt16
 
	tuuid
,

273 
	tuöt8
 
	t›î
, uöt8 *
	tpLí
, uöt8 *
	tpD©a
 );

276 (*
	ghidDevEvtCB_t
)–
	tuöt8
 
	tevt
 );

279 (*
	ghidDevPasscodeCB_t
)–
	tuöt8
 *
	tdevi˚Addr
, 
	tuöt16
 
	tc⁄√˘i⁄H™dÀ
,

280 
	tuöt8
 
	tuiI≈uts
, uöt8 
	tuiOuçuts
 );

284 
hidDevRï‹tCB_t
 
	gªp‹tCB
;

285 
hidDevEvtCB_t
 
	gevtCB
;

286 
hidDevPasscodeCB_t
 
	g∑sscodeCB
;

287 } 
	thidDevCB_t
;

303 
HidDev_Inô
–
uöt8
 
èsk_id
 );

318 
uöt16
 
HidDev_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

330 
HidDev_Regi°î
–
hidDevCfg_t
 *
pCfg
, 
hidDevCB_t
 *
pCBs
 );

342 
HidDev_Regi°îRï‹ts
–
uöt8
 
numRï‹ts
, 
hidR±M≠_t
 *
pR±
 );

356 
HidDev_Rï‹t
–
uöt8
 
id
, uöt8 
ty≥
, uöt8 
Àn
, uöt8 *
pD©a
 );

365 
HidDev_Clo£
( );

381 
bSètus_t
 
HidDev_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
pVÆue
 );

396 
bSètus_t
 
HidDev_GëP¨amëî
–
uöt8
 
∑øm
, *
pVÆue
 );

409 
HidDev_PasscodeR•
–
uöt8
 
°©us
, 
uöt32
 
∑sscode
 );

425 
uöt8
 
HidDev_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

426 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

441 
bSètus_t
 
HidDev_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

442 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

447 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/HIDDevKbM/hidkbmservice.c

42 
	~"bcomdef.h
"

43 
	~"OSAL.h
"

44 
	~"©t.h
"

45 
	~"g©t.h
"

46 
	~"g©t_uuid.h
"

47 
	~"lökdb.h
"

48 
	~"g©t£rv≠p.h
"

49 
	~"hidkbm£rvi˚.h
"

50 
	~"hid_uuid.h
"

51 
	~"hiddev.h
"

52 
	~"b©t£rvi˚.h
"

70 
CONST
 
uöt8
 
	ghidSîvUUID
[
ATT_BT_UUID_SIZE
] =

72 
LO_UINT16
(
HID_SERVICE_UUID
), 
HI_UINT16
(HID_SERVICE_UUID)

76 
CONST
 
uöt8
 
	ghidBoŸKeyI≈utUUID
[
ATT_BT_UUID_SIZE
] =

78 
LO_UINT16
(
HID_BOOT_KEY_INPUT_UUID
), 
HI_UINT16
(HID_BOOT_KEY_INPUT_UUID)

82 
CONST
 
uöt8
 
	ghidBoŸMou£I≈utUUID
[
ATT_BT_UUID_SIZE
] =

84 
LO_UINT16
(
HID_BOOT_MOUSE_INPUT_UUID
), 
HI_UINT16
(HID_BOOT_MOUSE_INPUT_UUID)

88 
CONST
 
uöt8
 
	ghidBoŸKeyOuçutUUID
[
ATT_BT_UUID_SIZE
] =

90 
LO_UINT16
(
HID_BOOT_KEY_OUTPUT_UUID
), 
HI_UINT16
(HID_BOOT_KEY_OUTPUT_UUID)

94 
CONST
 
uöt8
 
	ghidInfoUUID
[
ATT_BT_UUID_SIZE
] =

96 
LO_UINT16
(
HID_INFORMATION_UUID
), 
HI_UINT16
(HID_INFORMATION_UUID)

100 
CONST
 
uöt8
 
	ghidRï‹tM≠UUID
[
ATT_BT_UUID_SIZE
] =

102 
LO_UINT16
(
HID_REPORT_MAP_UUID
), 
HI_UINT16
(HID_REPORT_MAP_UUID)

106 
CONST
 
uöt8
 
	ghidC⁄åﬁPoötUUID
[
ATT_BT_UUID_SIZE
] =

108 
LO_UINT16
(
HID_CONTROL_POINT_UUID
), 
HI_UINT16
(HID_CONTROL_POINT_UUID)

112 
CONST
 
uöt8
 
	ghidRï‹tUUID
[
ATT_BT_UUID_SIZE
] =

114 
LO_UINT16
(
HID_REPORT_UUID
), 
HI_UINT16
(HID_REPORT_UUID)

118 
CONST
 
uöt8
 
	ghidPrŸocﬁModeUUID
[
ATT_BT_UUID_SIZE
] =

120 
LO_UINT16
(
HID_PROTOCOL_MODE_UUID
), 
HI_UINT16
(HID_PROTOCOL_MODE_UUID)

136 
CONST
 
uöt8
 
	ghidInfo
[
HID_INFORMATION_LEN
] =

138 
LO_UINT16
(0x0111), 
HI_UINT16
(0x0111),

140 
HID_KBD_FLAGS


145 
CONST
 
uöt8
 
	ghidRï‹tM≠
[] =

282 
uöt8
 
	ghidRï‹tM≠Lí
 = (
hidRï‹tM≠
);

285 
hidR±M≠_t
 
	ghidR±M≠
[
HID_NUM_REPORTS
];

292 
CONST
 
g©tAârTy≥_t
 
	ghidSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
hidSîvUUID
 };

295 
uöt16
 
	gö˛ude
 = 
GATT_INVALID_HANDLE
;

298 
uöt8
 
	ghidInfoPr›s
 = 
GATT_PROP_READ
;

301 
uöt8
 
	ghidRï‹tM≠Pr›s
 = 
GATT_PROP_READ
;

304 
uöt8
 
	ghidExtRï‹tRefDesc
[
ATT_BT_UUID_SIZE
] =

305 { 
LO_UINT16
(
BATT_LEVEL_UUID
), 
HI_UINT16
(BATT_LEVEL_UUID) };

308 
uöt8
 
	ghidC⁄åﬁPoötPr›s
 = 
GATT_PROP_WRITE_NO_RSP
;

309 
uöt8
 
	ghidC⁄åﬁPoöt
;

312 
uöt8
 
	ghidPrŸocﬁModePr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE_NO_RSP
;

313 
uöt8
 
	ghidPrŸocﬁMode
 = 
HID_PROTOCOL_MODE_REPORT
;

316 
uöt8
 
	ghidRï‹tMou£InPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

317 
uöt8
 
	ghidRï‹tMou£In
;

318 
g©tCh¨Cfg_t
 
	ghidRï‹tMou£InClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

321 
uöt8
 
	ghidRï‹tRefMou£In
[
HID_REPORT_REF_LEN
] =

322 { 
HID_RPT_ID_MOUSE_IN
, 
HID_REPORT_TYPE_INPUT
 };

325 
uöt8
 
	ghidRï‹tKeyInPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

326 
uöt8
 
	ghidRï‹tKeyIn
;

327 
g©tCh¨Cfg_t
 
	ghidRï‹tKeyInClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

330 
uöt8
 
	ghidRï‹tRefKeyIn
[
HID_REPORT_REF_LEN
] =

331 { 
HID_RPT_ID_KEY_IN
, 
HID_REPORT_TYPE_INPUT
 };

334 
uöt8
 
	ghidRï‹tCCInPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

335 
uöt8
 
	ghidRï‹tCCIn
;

336 
g©tCh¨Cfg_t
 
	ghidRï‹tCCInClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

339 
uöt8
 
	ghidRï‹tRefCCIn
[
HID_REPORT_REF_LEN
] =

340 { 
HID_RPT_ID_CC_IN
, 
HID_REPORT_TYPE_INPUT
 };

343 
uöt8
 
	ghidRï‹tLedOutPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
 | 
GATT_PROP_WRITE_NO_RSP
;

344 
uöt8
 
	ghidRï‹tLedOut
;

347 
uöt8
 
	ghidRï‹tRefLedOut
[
HID_REPORT_REF_LEN
] =

348 { 
HID_RPT_ID_LED_OUT
, 
HID_REPORT_TYPE_OUTPUT
 };

351 
uöt8
 
	ghidRï‹tBoŸKeyInPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

352 
uöt8
 
	ghidRï‹tBoŸKeyIn
;

353 
g©tCh¨Cfg_t
 
	ghidRï‹tBoŸKeyInClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

356 
uöt8
 
	ghidRï‹tBoŸKeyOutPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
 | 
GATT_PROP_WRITE_NO_RSP
;

357 
uöt8
 
	ghidRï‹tBoŸKeyOut
;

360 
uöt8
 
	ghidRï‹tBoŸMou£InPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

361 
uöt8
 
	ghidRï‹tBoŸMou£In
;

362 
g©tCh¨Cfg_t
 
	ghidRï‹tBoŸMou£InClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

365 
uöt8
 
	ghidRï‹tFótuªPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

366 
uöt8
 
	ghidRï‹tFótuª
;

369 
uöt8
 
	ghidRï‹tRefFótuª
[
HID_REPORT_REF_LEN
] =

370 { 
HID_RPT_ID_FEATURE
, 
HID_REPORT_TYPE_FEATURE
 };

376 
g©tAâribuã_t
 
	ghidAârTbl
[] =

380 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

381 
GATT_PERMIT_READ
,

383 (
uöt8
 *Ë&
hidSîvi˚


388 { 
ATT_BT_UUID_SIZE
, 
ö˛udeUUID
 },

389 
GATT_PERMIT_READ
,

391 (
uöt8
 *)&
ö˛ude


396 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

397 
GATT_PERMIT_READ
,

399 &
hidInfoPr›s


404 { 
ATT_BT_UUID_SIZE
, 
hidInfoUUID
 },

405 
GATT_PERMIT_READ
,

407 (
uöt8
 *Ë
hidInfo


412 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

413 
GATT_PERMIT_READ
,

415 &
hidC⁄åﬁPoötPr›s


420 { 
ATT_BT_UUID_SIZE
, 
hidC⁄åﬁPoötUUID
 },

421 
GATT_PERMIT_WRITE
,

423 &
hidC⁄åﬁPoöt


428 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

429 
GATT_PERMIT_READ
,

431 &
hidPrŸocﬁModePr›s


436 { 
ATT_BT_UUID_SIZE
, 
hidPrŸocﬁModeUUID
 },

437 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

439 &
hidPrŸocﬁMode


445 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

446 
GATT_PERMIT_READ
,

448 &
hidRï‹tM≠Pr›s


453 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tM≠UUID
 },

454 
GATT_PERMIT_READ
,

456 (
uöt8
 *Ë
hidRï‹tM≠


461 { 
ATT_BT_UUID_SIZE
, 
extRï‹tRefUUID
 },

462 
GATT_PERMIT_READ
,

464 
hidExtRï‹tRefDesc


469 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

470 
GATT_PERMIT_READ
,

472 &
hidRï‹tMou£InPr›s


477 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tUUID
 },

478 
GATT_PERMIT_READ
,

480 &
hidRï‹tMou£In


485 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

486 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

488 (
uöt8
 *Ë&
hidRï‹tMou£InClõ¡Ch¨Cfg


493 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

494 
GATT_PERMIT_READ
,

496 
hidRï‹tRefMou£In


501 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

502 
GATT_PERMIT_READ
,

504 &
hidRï‹tKeyInPr›s


509 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tUUID
 },

510 
GATT_PERMIT_READ
,

512 &
hidRï‹tKeyIn


517 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

518 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

520 (
uöt8
 *Ë&
hidRï‹tKeyInClõ¡Ch¨Cfg


525 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

526 
GATT_PERMIT_READ
,

528 
hidRï‹tRefKeyIn


533 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

534 
GATT_PERMIT_READ
,

536 &
hidRï‹tCCInPr›s


541 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tUUID
 },

542 
GATT_PERMIT_READ
,

544 &
hidRï‹tCCIn


549 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

550 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

552 (
uöt8
 *Ë&
hidRï‹tCCInClõ¡Ch¨Cfg


557 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

558 
GATT_PERMIT_READ
,

560 
hidRï‹tRefCCIn


565 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

566 
GATT_PERMIT_READ
,

568 &
hidRï‹tLedOutPr›s


573 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tUUID
 },

574 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

576 &
hidRï‹tLedOut


581 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

582 
GATT_PERMIT_READ
,

584 
hidRï‹tRefLedOut


589 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

590 
GATT_PERMIT_READ
,

592 &
hidRï‹tBoŸKeyInPr›s


597 { 
ATT_BT_UUID_SIZE
, 
hidBoŸKeyI≈utUUID
 },

598 
GATT_PERMIT_READ
,

600 &
hidRï‹tBoŸKeyIn


605 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

606 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

608 (
uöt8
 *Ë&
hidRï‹tBoŸKeyInClõ¡Ch¨Cfg


613 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

614 
GATT_PERMIT_READ
,

616 &
hidRï‹tBoŸKeyOutPr›s


621 { 
ATT_BT_UUID_SIZE
, 
hidBoŸKeyOuçutUUID
 },

622 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

624 &
hidRï‹tBoŸKeyOut


629 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

630 
GATT_PERMIT_READ
,

632 &
hidRï‹tBoŸMou£InPr›s


637 { 
ATT_BT_UUID_SIZE
, 
hidBoŸMou£I≈utUUID
 },

638 
GATT_PERMIT_READ
,

640 &
hidRï‹tBoŸMou£In


645 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

646 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

648 (
uöt8
 *Ë&
hidRï‹tBoŸMou£InClõ¡Ch¨Cfg


653 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

654 
GATT_PERMIT_READ
,

656 &
hidRï‹tFótuªPr›s


661 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tUUID
},

662 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

664 &
hidRï‹tFótuª


669 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

670 
GATT_PERMIT_READ
,

672 
hidRï‹tRefFótuª


679 
	mHID_SERVICE_IDX
,

680 
	mHID_INCLUDED_SERVICE_IDX
,

681 
	mHID_INFO_DECL_IDX
,

682 
	mHID_INFO_IDX
,

683 
	mHID_CONTROL_POINT_DECL_IDX
,

684 
	mHID_CONTROL_POINT_IDX
,

685 
	mHID_PROTOCOL_MODE_DECL_IDX
,

686 
	mHID_PROTOCOL_MODE_IDX
,

687 
	mHID_REPORT_MAP_DECL_IDX
,

688 
	mHID_REPORT_MAP_IDX
,

689 
	mHID_EXT_REPORT_REF_DESC_IDX
,

690 
	mHID_REPORT_MOUSE_IN_DECL_IDX
,

691 
	mHID_REPORT_MOUSE_IN_IDX
,

692 
	mHID_REPORT_MOUSE_IN_CCCD_IDX
,

693 
	mHID_REPORT_REF_MOUSE_IN_IDX
,

694 
	mHID_REPORT_KEY_IN_DECL_IDX
,

695 
	mHID_REPORT_KEY_IN_IDX
,

696 
	mHID_REPORT_KEY_IN_CCCD_IDX
,

697 
	mHID_REPORT_REF_KEY_IN_IDX
,

698 
	mHID_REPORT_CC_IN_DECL_IDX
,

699 
	mHID_REPORT_CC_IN_IDX
,

700 
	mHID_REPORT_CC_IN_CCCD_IDX
,

701 
	mHID_REPORT_REF_CC_IN_IDX
,

702 
	mHID_REPORT_LED_OUT_DECL_IDX
,

703 
	mHID_REPORT_LED_OUT_IDX
,

704 
	mHID_REPORT_REF_LED_OUT_IDX
,

705 
	mHID_BOOT_KEY_IN_DECL_IDX
,

706 
	mHID_BOOT_KEY_IN_IDX
,

707 
	mHID_BOOT_KEY_IN_CCCD_IDX
,

708 
	mHID_BOOT_KEY_OUT_DECL_IDX
,

709 
	mHID_BOOT_KEY_OUT_IDX
,

710 
	mHID_BOOT_MOUSE_IN_DECL_IDX
,

711 
	mHID_BOOT_MOUSE_IN_IDX
,

712 
	mHID_BOOT_MOUSE_IN_CCCD_IDX
,

713 
	mHID_FEATURE_DECL_IDX
,

714 
	mHID_FEATURE_IDX
,

715 
	mHID_REPORT_REF_FEATURE_IDX


727 
CONST
 
g©tSîvi˚CBs_t
 
	ghidKbdMsCBs
 =

729 
HidDev_RódAârCB
,

730 
HidDev_WrôeAârCB
,

731 
NULL


746 
bSètus_t
 
	$HidKbM_AddSîvi˚
( )

748 
uöt8
 
°©us
 = 
SUCCESS
;

751 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hidRï‹tMou£InClõ¡Ch¨Cfg
 );

752 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hidRï‹tKeyInClõ¡Ch¨Cfg
 );

753 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hidRï‹tCCInClõ¡Ch¨Cfg
 );

754 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hidRï‹tBoŸKeyInClõ¡Ch¨Cfg
 );

755 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hidRï‹tBoŸMou£InClõ¡Ch¨Cfg
 );

758 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
hidAârTbl
, 
	`GATT_NUM_ATTRS
–hidAârTb»), &
hidKbdMsCBs
 );

761 
	`B©t_GëP¨amëî
–
BATT_PARAM_SERVICE_HANDLE
,

762 &
	`GATT_INCLUDED_HANDLE
–
hidAârTbl
, 
HID_INCLUDED_SERVICE_IDX
 ) );

768 
hidR±M≠
[0].
id
 = 
hidRï‹tRefMou£In
[0];

769 
hidR±M≠
[0].
ty≥
 = 
hidRï‹tRefMou£In
[1];

770 
hidR±M≠
[0].
h™dÀ
 = 
hidAârTbl
[
HID_REPORT_MOUSE_IN_IDX
].handle;

771 
hidR±M≠
[0].
cccdH™dÀ
 = 
hidAârTbl
[
HID_REPORT_MOUSE_IN_CCCD_IDX
].
h™dÀ
;

772 
hidR±M≠
[0].
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

775 
hidR±M≠
[1].
id
 = 
hidRï‹tRefKeyIn
[0];

776 
hidR±M≠
[1].
ty≥
 = 
hidRï‹tRefKeyIn
[1];

777 
hidR±M≠
[1].
h™dÀ
 = 
hidAârTbl
[
HID_REPORT_KEY_IN_IDX
].handle;

778 
hidR±M≠
[1].
cccdH™dÀ
 = 
hidAârTbl
[
HID_REPORT_KEY_IN_CCCD_IDX
].
h™dÀ
;

779 
hidR±M≠
[1].
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

782 
hidR±M≠
[2].
id
 = 
hidRï‹tRefCCIn
[0];

783 
hidR±M≠
[2].
ty≥
 = 
hidRï‹tRefCCIn
[1];

784 
hidR±M≠
[2].
h™dÀ
 = 
hidAârTbl
[
HID_REPORT_CC_IN_IDX
].handle;

785 
hidR±M≠
[2].
cccdH™dÀ
 = 
hidAârTbl
[
HID_REPORT_CC_IN_CCCD_IDX
].
h™dÀ
;

786 
hidR±M≠
[2].
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

789 
hidR±M≠
[3].
id
 = 
hidRï‹tRefLedOut
[0];

790 
hidR±M≠
[3].
ty≥
 = 
hidRï‹tRefLedOut
[1];

791 
hidR±M≠
[3].
h™dÀ
 = 
hidAârTbl
[
HID_REPORT_LED_OUT_IDX
].handle;

792 
hidR±M≠
[3].
cccdH™dÀ
 = 0;

793 
hidR±M≠
[3].
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

797 
hidR±M≠
[4].
id
 = 
hidRï‹tRefKeyIn
[0];

798 
hidR±M≠
[4].
ty≥
 = 
hidRï‹tRefKeyIn
[1];

799 
hidR±M≠
[4].
h™dÀ
 = 
hidAârTbl
[
HID_BOOT_KEY_IN_IDX
].handle;

800 
hidR±M≠
[4].
cccdH™dÀ
 = 
hidAârTbl
[
HID_BOOT_KEY_IN_CCCD_IDX
].
h™dÀ
;

801 
hidR±M≠
[4].
mode
 = 
HID_PROTOCOL_MODE_BOOT
;

805 
hidR±M≠
[5].
id
 = 
hidRï‹tRefLedOut
[0];

806 
hidR±M≠
[5].
ty≥
 = 
hidRï‹tRefLedOut
[1];

807 
hidR±M≠
[5].
h™dÀ
 = 
hidAârTbl
[
HID_BOOT_KEY_OUT_IDX
].handle;

808 
hidR±M≠
[5].
cccdH™dÀ
 = 0;

809 
hidR±M≠
[5].
mode
 = 
HID_PROTOCOL_MODE_BOOT
;

813 
hidR±M≠
[6].
id
 = 
hidRï‹tRefMou£In
[0];

814 
hidR±M≠
[6].
ty≥
 = 
hidRï‹tRefMou£In
[1];

815 
hidR±M≠
[6].
h™dÀ
 = 
hidAârTbl
[
HID_BOOT_MOUSE_IN_IDX
].handle;

816 
hidR±M≠
[6].
cccdH™dÀ
 = 
hidAârTbl
[
HID_BOOT_MOUSE_IN_CCCD_IDX
].
h™dÀ
;

817 
hidR±M≠
[6].
mode
 = 
HID_PROTOCOL_MODE_BOOT
;

820 
hidR±M≠
[7].
id
 = 
hidRï‹tRefFótuª
[0];

821 
hidR±M≠
[7].
ty≥
 = 
hidRï‹tRefFótuª
[1];

822 
hidR±M≠
[7].
h™dÀ
 = 
hidAârTbl
[
HID_FEATURE_IDX
].handle;

823 
hidR±M≠
[7].
cccdH™dÀ
 = 0;

824 
hidR±M≠
[7].
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

827 
VOID
 
	`B©t_GëP¨amëî
–
BATT_PARAM_BATT_LEVEL_IN_REPORT
, &(
hidR±M≠
[8]) );

830 
	`HidDev_Regi°îRï‹ts
–
HID_NUM_REPORTS
, 
hidR±M≠
 );

832  ( 
°©us
 );

833 
	}
}

851 
uöt8
 
	$HidKbM_SëP¨amëî
–
uöt8
 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
, uöt8 
Àn
, *
pVÆue
 )

853 
bSètus_t
 
ªt
 = 
SUCCESS
;

855  
uuid
 )

857 
HID_REPORT_UUID
:

858 i‡–
ty≥
 =
HID_REPORT_TYPE_OUTPUT
 )

860 i‡–
Àn
 == 1 )

862 
hidRï‹tLedOut
 = *((
uöt8
 *)
pVÆue
);

866 
ªt
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

869 i‡–
ty≥
 =
HID_REPORT_TYPE_FEATURE
 )

871 i‡–
Àn
 == 1 )

873 
hidRï‹tFótuª
 = *((
uöt8
 *)
pVÆue
);

877 
ªt
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

882 
ªt
 = 
ATT_ERR_ATTR_NOT_FOUND
;

886 
HID_BOOT_KEY_OUTPUT_UUID
:

887 i‡–
Àn
 == 1 )

889 
hidRï‹tBoŸKeyOut
 = *((
uöt8
 *)
pVÆue
);

893 
ªt
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

902  ( 
ªt
 );

903 
	}
}

921 
uöt8
 
	$HidKbM_GëP¨amëî
–
uöt8
 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
, uöt8 *
pLí
, *
pVÆue
 )

923  
uuid
 )

925 
HID_REPORT_UUID
:

926 i‡–
ty≥
 =
HID_REPORT_TYPE_OUTPUT
 )

928 *((
uöt8
 *)
pVÆue
Ë
hidRï‹tLedOut
;

929 *
pLí
 = 1;

931 i‡–
ty≥
 =
HID_REPORT_TYPE_FEATURE
 )

933 *((
uöt8
 *)
pVÆue
Ë
hidRï‹tFótuª
;

934 *
pLí
 = 1;

938 *
pLí
 = 0;

942 
HID_BOOT_KEY_OUTPUT_UUID
:

943 *((
uöt8
 *)
pVÆue
Ë
hidRï‹tBoŸKeyOut
;

944 *
pLí
 = 1;

948 *
pLí
 = 0;

952  ( 
SUCCESS
 );

953 
	}
}

	@Projects/ble/Profiles/HIDDevKbM/hidkbmservice.h

39 #i‚de‡
HIDKBMSERVICE_H


40 
	#HIDKBMSERVICE_H


	)

42 #ifde‡
__˝lu•lus


56 
	#HID_NUM_REPORTS
 9

	)

59 
	#HID_RPT_ID_MOUSE_IN
 1

60 
	#HID_RPT_ID_KEY_IN
 2

61 
	#HID_RPT_ID_CC_IN
 3

62 
	#HID_RPT_ID_LED_OUT
 0

63 
	#HID_RPT_ID_FEATURE
 0

64 

	)

66 
	#HID_KBD_FLAGS
 
HID_FLAGS_REMOTE_WAKE


	)

93 
bSètus_t
 
HidKbM_AddSîvi˚
( );

111 
uöt8
 
HidKbM_SëP¨amëî
–uöt8 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
, uöt8 
Àn
, *
pVÆue
 );

129 
uöt8
 
HidKbM_GëP¨amëî
–uöt8 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
, uöt8 *
pLí
, *
pVÆue
 );

134 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/HIDDevKbd/hidkbdservice.c

42 
	~"bcomdef.h
"

43 
	~"OSAL.h
"

44 
	~"©t.h
"

45 
	~"g©t.h
"

46 
	~"g©t_uuid.h
"

47 
	~"lökdb.h
"

48 
	~"g©t£rv≠p.h
"

49 
	~"hidkbd£rvi˚.h
"

50 
	~"hid_uuid.h
"

51 
	~"hiddev.h
"

52 
	~"b©t£rvi˚.h
"

70 
CONST
 
uöt8
 
	ghidSîvUUID
[
ATT_BT_UUID_SIZE
] =

72 
LO_UINT16
(
HID_SERVICE_UUID
), 
HI_UINT16
(HID_SERVICE_UUID)

76 
CONST
 
uöt8
 
	ghidBoŸKeyI≈utUUID
[
ATT_BT_UUID_SIZE
] =

78 
LO_UINT16
(
HID_BOOT_KEY_INPUT_UUID
), 
HI_UINT16
(HID_BOOT_KEY_INPUT_UUID)

82 
CONST
 
uöt8
 
	ghidBoŸMou£I≈utUUID
[
ATT_BT_UUID_SIZE
] =

84 
LO_UINT16
(
HID_BOOT_MOUSE_INPUT_UUID
), 
HI_UINT16
(HID_BOOT_MOUSE_INPUT_UUID)

88 
CONST
 
uöt8
 
	ghidBoŸKeyOuçutUUID
[
ATT_BT_UUID_SIZE
] =

90 
LO_UINT16
(
HID_BOOT_KEY_OUTPUT_UUID
), 
HI_UINT16
(HID_BOOT_KEY_OUTPUT_UUID)

94 
CONST
 
uöt8
 
	ghidInfoUUID
[
ATT_BT_UUID_SIZE
] =

96 
LO_UINT16
(
HID_INFORMATION_UUID
), 
HI_UINT16
(HID_INFORMATION_UUID)

100 
CONST
 
uöt8
 
	ghidRï‹tM≠UUID
[
ATT_BT_UUID_SIZE
] =

102 
LO_UINT16
(
HID_REPORT_MAP_UUID
), 
HI_UINT16
(HID_REPORT_MAP_UUID)

106 
CONST
 
uöt8
 
	ghidC⁄åﬁPoötUUID
[
ATT_BT_UUID_SIZE
] =

108 
LO_UINT16
(
HID_CONTROL_POINT_UUID
), 
HI_UINT16
(HID_CONTROL_POINT_UUID)

112 
CONST
 
uöt8
 
	ghidRï‹tUUID
[
ATT_BT_UUID_SIZE
] =

114 
LO_UINT16
(
HID_REPORT_UUID
), 
HI_UINT16
(HID_REPORT_UUID)

118 
CONST
 
uöt8
 
	ghidPrŸocﬁModeUUID
[
ATT_BT_UUID_SIZE
] =

120 
LO_UINT16
(
HID_PROTOCOL_MODE_UUID
), 
HI_UINT16
(HID_PROTOCOL_MODE_UUID)

136 
CONST
 
uöt8
 
	ghidInfo
[
HID_INFORMATION_LEN
] =

138 
LO_UINT16
(0x0111), 
HI_UINT16
(0x0111),

140 
HID_KBD_FLAGS


145 
CONST
 
uöt8
 
	ghidRï‹tM≠
[] =

194 
uöt8
 
	ghidRï‹tM≠Lí
 = (
hidRï‹tM≠
);

197 
hidR±M≠_t
 
	ghidR±M≠
[
HID_NUM_REPORTS
];

204 
CONST
 
g©tAârTy≥_t
 
	ghidSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
hidSîvUUID
 };

207 
uöt16
 
	gö˛ude
 = 
GATT_INVALID_HANDLE
;

210 
uöt8
 
	ghidInfoPr›s
 = 
GATT_PROP_READ
;

213 
uöt8
 
	ghidRï‹tM≠Pr›s
 = 
GATT_PROP_READ
;

216 
uöt8
 
	ghidExtRï‹tRefDesc
[
ATT_BT_UUID_SIZE
] =

217 { 
LO_UINT16
(
BATT_LEVEL_UUID
), 
HI_UINT16
(BATT_LEVEL_UUID) };

220 
uöt8
 
	ghidC⁄åﬁPoötPr›s
 = 
GATT_PROP_WRITE_NO_RSP
;

221 
uöt8
 
	ghidC⁄åﬁPoöt
;

224 
uöt8
 
	ghidPrŸocﬁModePr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE_NO_RSP
;

225 
uöt8
 
	ghidPrŸocﬁMode
 = 
HID_PROTOCOL_MODE_REPORT
;

228 
uöt8
 
	ghidRï‹tKeyInPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

229 
uöt8
 
	ghidRï‹tKeyIn
;

230 
g©tCh¨Cfg_t
 
	ghidRï‹tKeyInClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

233 
uöt8
 
	ghidRï‹tRefKeyIn
[
HID_REPORT_REF_LEN
] =

234 { 
HID_RPT_ID_KEY_IN
, 
HID_REPORT_TYPE_INPUT
 };

237 
uöt8
 
	ghidRï‹tLedOutPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
 | 
GATT_PROP_WRITE_NO_RSP
;

238 
uöt8
 
	ghidRï‹tLedOut
;

241 
uöt8
 
	ghidRï‹tRefLedOut
[
HID_REPORT_REF_LEN
] =

242 { 
HID_RPT_ID_LED_OUT
, 
HID_REPORT_TYPE_OUTPUT
 };

245 
uöt8
 
	ghidRï‹tBoŸKeyInPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

246 
uöt8
 
	ghidRï‹tBoŸKeyIn
;

247 
g©tCh¨Cfg_t
 
	ghidRï‹tBoŸKeyInClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

250 
uöt8
 
	ghidRï‹tBoŸKeyOutPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
 | 
GATT_PROP_WRITE_NO_RSP
;

251 
uöt8
 
	ghidRï‹tBoŸKeyOut
;

254 
uöt8
 
	ghidRï‹tBoŸMou£InPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

255 
uöt8
 
	ghidRï‹tBoŸMou£In
;

256 
g©tCh¨Cfg_t
 
	ghidRï‹tBoŸMou£InClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

259 
uöt8
 
	ghidRï‹tFótuªPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

260 
uöt8
 
	ghidRï‹tFótuª
;

263 
uöt8
 
	ghidRï‹tRefFótuª
[
HID_REPORT_REF_LEN
] =

264 { 
HID_RPT_ID_FEATURE
, 
HID_REPORT_TYPE_FEATURE
 };

270 
g©tAâribuã_t
 
	ghidAârTbl
[] =

274 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

275 
GATT_PERMIT_READ
,

277 (
uöt8
 *Ë&
hidSîvi˚


282 { 
ATT_BT_UUID_SIZE
, 
ö˛udeUUID
 },

283 
GATT_PERMIT_READ
,

285 (
uöt8
 *)&
ö˛ude


290 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

291 
GATT_PERMIT_READ
,

293 &
hidInfoPr›s


298 { 
ATT_BT_UUID_SIZE
, 
hidInfoUUID
 },

299 
GATT_PERMIT_READ
,

301 (
uöt8
 *Ë
hidInfo


306 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

307 
GATT_PERMIT_READ
,

309 &
hidC⁄åﬁPoötPr›s


314 { 
ATT_BT_UUID_SIZE
, 
hidC⁄åﬁPoötUUID
 },

315 
GATT_PERMIT_WRITE
,

317 &
hidC⁄åﬁPoöt


322 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

323 
GATT_PERMIT_READ
,

325 &
hidPrŸocﬁModePr›s


330 { 
ATT_BT_UUID_SIZE
, 
hidPrŸocﬁModeUUID
 },

331 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

333 &
hidPrŸocﬁMode


339 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

340 
GATT_PERMIT_READ
,

342 &
hidRï‹tM≠Pr›s


347 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tM≠UUID
 },

348 
GATT_PERMIT_READ
,

350 (
uöt8
 *Ë
hidRï‹tM≠


355 { 
ATT_BT_UUID_SIZE
, 
extRï‹tRefUUID
 },

356 
GATT_PERMIT_READ
,

358 
hidExtRï‹tRefDesc


363 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

364 
GATT_PERMIT_READ
,

366 &
hidRï‹tKeyInPr›s


371 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tUUID
 },

372 
GATT_PERMIT_READ
,

374 &
hidRï‹tKeyIn


379 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

380 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

382 (
uöt8
 *Ë&
hidRï‹tKeyInClõ¡Ch¨Cfg


387 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

388 
GATT_PERMIT_READ
,

390 
hidRï‹tRefKeyIn


395 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

396 
GATT_PERMIT_READ
,

398 &
hidRï‹tLedOutPr›s


403 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tUUID
 },

404 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

406 &
hidRï‹tLedOut


411 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

412 
GATT_PERMIT_READ
,

414 
hidRï‹tRefLedOut


419 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

420 
GATT_PERMIT_READ
,

422 &
hidRï‹tBoŸKeyInPr›s


427 { 
ATT_BT_UUID_SIZE
, 
hidBoŸKeyI≈utUUID
 },

428 
GATT_PERMIT_READ
,

430 &
hidRï‹tBoŸKeyIn


435 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

436 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

438 (
uöt8
 *Ë&
hidRï‹tBoŸKeyInClõ¡Ch¨Cfg


443 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

444 
GATT_PERMIT_READ
,

446 &
hidRï‹tBoŸKeyOutPr›s


451 { 
ATT_BT_UUID_SIZE
, 
hidBoŸKeyOuçutUUID
 },

452 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

454 &
hidRï‹tBoŸKeyOut


459 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

460 
GATT_PERMIT_READ
,

462 &
hidRï‹tBoŸMou£InPr›s


467 { 
ATT_BT_UUID_SIZE
, 
hidBoŸMou£I≈utUUID
 },

468 
GATT_PERMIT_READ
,

470 &
hidRï‹tBoŸMou£In


475 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

476 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

478 (
uöt8
 *Ë&
hidRï‹tBoŸMou£InClõ¡Ch¨Cfg


483 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

484 
GATT_PERMIT_READ
,

486 &
hidRï‹tFótuªPr›s


491 { 
ATT_BT_UUID_SIZE
, 
hidRï‹tUUID
},

492 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

494 &
hidRï‹tFótuª


499 { 
ATT_BT_UUID_SIZE
, 
ªp‹tRefUUID
 },

500 
GATT_PERMIT_READ
,

502 
hidRï‹tRefFótuª


509 
	mHID_SERVICE_IDX
,

510 
	mHID_INCLUDED_SERVICE_IDX
,

511 
	mHID_INFO_DECL_IDX
,

512 
	mHID_INFO_IDX
,

513 
	mHID_CONTROL_POINT_DECL_IDX
,

514 
	mHID_CONTROL_POINT_IDX
,

515 
	mHID_PROTOCOL_MODE_DECL_IDX
,

516 
	mHID_PROTOCOL_MODE_IDX
,

517 
	mHID_REPORT_MAP_DECL_IDX
,

518 
	mHID_REPORT_MAP_IDX
,

519 
	mHID_EXT_REPORT_REF_DESC_IDX
,

520 
	mHID_REPORT_KEY_IN_DECL_IDX
,

521 
	mHID_REPORT_KEY_IN_IDX
,

522 
	mHID_REPORT_KEY_IN_CCCD_IDX
,

523 
	mHID_REPORT_REF_KEY_IN_IDX
,

524 
	mHID_REPORT_LED_OUT_DECL_IDX
,

525 
	mHID_REPORT_LED_OUT_IDX
,

526 
	mHID_REPORT_REF_LED_OUT_IDX
,

527 
	mHID_BOOT_KEY_IN_DECL_IDX
,

528 
	mHID_BOOT_KEY_IN_IDX
,

529 
	mHID_BOOT_KEY_IN_CCCD_IDX
,

530 
	mHID_BOOT_KEY_OUT_DECL_IDX
,

531 
	mHID_BOOT_KEY_OUT_IDX
,

532 
	mHID_BOOT_MOUSE_IN_DECL_IDX
,

533 
	mHID_BOOT_MOUSE_IN_IDX
,

534 
	mHID_BOOT_MOUSE_IN_CCCD_IDX
,

535 
	mHID_FEATURE_DECL_IDX
,

536 
	mHID_FEATURE_IDX
,

537 
	mHID_REPORT_REF_FEATURE_IDX


549 
CONST
 
g©tSîvi˚CBs_t
 
	ghidKbdCBs
 =

551 
HidDev_RódAârCB
,

552 
HidDev_WrôeAârCB
,

553 
NULL


568 
bSètus_t
 
	$HidKbd_AddSîvi˚
( )

570 
uöt8
 
°©us
 = 
SUCCESS
;

573 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hidRï‹tKeyInClõ¡Ch¨Cfg
 );

574 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hidRï‹tBoŸKeyInClõ¡Ch¨Cfg
 );

575 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hidRï‹tBoŸMou£InClõ¡Ch¨Cfg
 );

578 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
hidAârTbl
, 
	`GATT_NUM_ATTRS
–hidAârTb»), &
hidKbdCBs
 );

581 
	`B©t_GëP¨amëî
–
BATT_PARAM_SERVICE_HANDLE
,

582 &
	`GATT_INCLUDED_HANDLE
–
hidAârTbl
, 
HID_INCLUDED_SERVICE_IDX
 ) );

588 
hidR±M≠
[0].
id
 = 
hidRï‹tRefKeyIn
[0];

589 
hidR±M≠
[0].
ty≥
 = 
hidRï‹tRefKeyIn
[1];

590 
hidR±M≠
[0].
h™dÀ
 = 
hidAârTbl
[
HID_REPORT_KEY_IN_IDX
].handle;

591 
hidR±M≠
[0].
cccdH™dÀ
 = 
hidAârTbl
[
HID_REPORT_KEY_IN_CCCD_IDX
].
h™dÀ
;

592 
hidR±M≠
[0].
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

595 
hidR±M≠
[1].
id
 = 
hidRï‹tRefLedOut
[0];

596 
hidR±M≠
[1].
ty≥
 = 
hidRï‹tRefLedOut
[1];

597 
hidR±M≠
[1].
h™dÀ
 = 
hidAârTbl
[
HID_REPORT_LED_OUT_IDX
].handle;

598 
hidR±M≠
[1].
cccdH™dÀ
 = 0;

599 
hidR±M≠
[1].
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

603 
hidR±M≠
[2].
id
 = 
hidRï‹tRefKeyIn
[0];

604 
hidR±M≠
[2].
ty≥
 = 
hidRï‹tRefKeyIn
[1];

605 
hidR±M≠
[2].
h™dÀ
 = 
hidAârTbl
[
HID_BOOT_KEY_IN_IDX
].handle;

606 
hidR±M≠
[2].
cccdH™dÀ
 = 
hidAârTbl
[
HID_BOOT_KEY_IN_CCCD_IDX
].
h™dÀ
;

607 
hidR±M≠
[2].
mode
 = 
HID_PROTOCOL_MODE_BOOT
;

611 
hidR±M≠
[3].
id
 = 
hidRï‹tRefLedOut
[0];

612 
hidR±M≠
[3].
ty≥
 = 
hidRï‹tRefLedOut
[1];

613 
hidR±M≠
[3].
h™dÀ
 = 
hidAârTbl
[
HID_BOOT_KEY_OUT_IDX
].handle;

614 
hidR±M≠
[3].
cccdH™dÀ
 = 0;

615 
hidR±M≠
[3].
mode
 = 
HID_PROTOCOL_MODE_BOOT
;

618 
hidR±M≠
[4].
id
 = 
HID_RPT_ID_MOUSE_IN
;

619 
hidR±M≠
[4].
ty≥
 = 
HID_REPORT_TYPE_INPUT
;

620 
hidR±M≠
[4].
h™dÀ
 = 
hidAârTbl
[
HID_BOOT_MOUSE_IN_IDX
].handle;

621 
hidR±M≠
[4].
cccdH™dÀ
 = 
hidAârTbl
[
HID_BOOT_MOUSE_IN_CCCD_IDX
].
h™dÀ
;

622 
hidR±M≠
[4].
mode
 = 
HID_PROTOCOL_MODE_BOOT
;

625 
hidR±M≠
[5].
id
 = 
hidRï‹tRefFótuª
[0];

626 
hidR±M≠
[5].
ty≥
 = 
hidRï‹tRefFótuª
[1];

627 
hidR±M≠
[5].
h™dÀ
 = 
hidAârTbl
[
HID_FEATURE_IDX
].handle;

628 
hidR±M≠
[5].
cccdH™dÀ
 = 0;

629 
hidR±M≠
[5].
mode
 = 
HID_PROTOCOL_MODE_REPORT
;

632 
VOID
 
	`B©t_GëP¨amëî
–
BATT_PARAM_BATT_LEVEL_IN_REPORT
, &(
hidR±M≠
[6]) );

635 
	`HidDev_Regi°îRï‹ts
–
HID_NUM_REPORTS
, 
hidR±M≠
 );

637  ( 
°©us
 );

638 
	}
}

656 
uöt8
 
	$HidKbd_SëP¨amëî
–
uöt8
 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
, uöt8 
Àn
, *
pVÆue
 )

658 
bSètus_t
 
ªt
 = 
SUCCESS
;

660  
uuid
 )

662 
HID_REPORT_UUID
:

663 i‡–
ty≥
 =
HID_REPORT_TYPE_OUTPUT
 )

665 i‡–
Àn
 == 1 )

667 
hidRï‹tLedOut
 = *((
uöt8
 *)
pVÆue
);

671 
ªt
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

674 i‡–
ty≥
 =
HID_REPORT_TYPE_FEATURE
 )

676 i‡–
Àn
 == 1 )

678 
hidRï‹tFótuª
 = *((
uöt8
 *)
pVÆue
);

682 
ªt
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

687 
ªt
 = 
ATT_ERR_ATTR_NOT_FOUND
;

691 
HID_BOOT_KEY_OUTPUT_UUID
:

692 i‡–
Àn
 == 1 )

694 
hidRï‹tBoŸKeyOut
 = *((
uöt8
 *)
pVÆue
);

698 
ªt
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

707  ( 
ªt
 );

708 
	}
}

726 
uöt8
 
	$HidKbd_GëP¨amëî
–
uöt8
 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
, uöt8 *
pLí
, *
pVÆue
 )

728  
uuid
 )

730 
HID_REPORT_UUID
:

731 i‡–
ty≥
 =
HID_REPORT_TYPE_OUTPUT
 )

733 *((
uöt8
 *)
pVÆue
Ë
hidRï‹tLedOut
;

734 *
pLí
 = 1;

736 i‡–
ty≥
 =
HID_REPORT_TYPE_FEATURE
 )

738 *((
uöt8
 *)
pVÆue
Ë
hidRï‹tFótuª
;

739 *
pLí
 = 1;

743 *
pLí
 = 0;

747 
HID_BOOT_KEY_OUTPUT_UUID
:

748 *((
uöt8
 *)
pVÆue
Ë
hidRï‹tBoŸKeyOut
;

749 *
pLí
 = 1;

753 *
pLí
 = 0;

757  ( 
SUCCESS
 );

758 
	}
}

	@Projects/ble/Profiles/HIDDevKbd/hidkbdservice.h

39 #i‚de‡
HIDKBDSERVICE_H


40 
	#HIDKBDSERVICE_H


	)

42 #ifde‡
__˝lu•lus


56 
	#HID_NUM_REPORTS
 7

	)

59 
	#HID_RPT_ID_KEY_IN
 0

60 
	#HID_RPT_ID_MOUSE_IN
 1

61 
	#HID_RPT_ID_LED_OUT
 0

62 
	#HID_RPT_ID_FEATURE
 0

63 

	)

65 
	#HID_KBD_FLAGS
 
HID_FLAGS_REMOTE_WAKE


	)

92 
bSètus_t
 
HidKbd_AddSîvi˚
( );

110 
uöt8
 
HidKbd_SëP¨amëî
–uöt8 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
, uöt8 
Àn
, *
pVÆue
 );

128 
uöt8
 
HidKbd_GëP¨amëî
–uöt8 
id
, uöt8 
ty≥
, 
uöt16
 
uuid
, uöt8 *
pLí
, *
pVÆue
 );

133 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/HeartRate/heartrateservice.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

51 
	~"hóπøã£rvi˚.h
"

62 
	#HEARTRATE_MEAS_VALUE_POS
 2

	)

72 
CONST
 
uöt8
 
	ghóπR©eSîvUUID
[
ATT_BT_UUID_SIZE
] =

74 
LO_UINT16
(
HEARTRATE_SERV_UUID
), 
HI_UINT16
(HEARTRATE_SERV_UUID)

78 
CONST
 
uöt8
 
	ghóπR©eMósUUID
[
ATT_BT_UUID_SIZE
] =

80 
LO_UINT16
(
HEARTRATE_MEAS_UUID
), 
HI_UINT16
(HEARTRATE_MEAS_UUID)

84 
CONST
 
uöt8
 
	ghóπR©eSísLocUUID
[
ATT_BT_UUID_SIZE
] =

86 
LO_UINT16
(
HEARTRATE_SENS_LOC_UUID
), 
HI_UINT16
(HEARTRATE_SENS_LOC_UUID)

90 
CONST
 
uöt8
 
	ghóπR©eComm™dUUID
[
ATT_BT_UUID_SIZE
] =

92 
LO_UINT16
(
HEARTRATE_COMMAND_UUID
), 
HI_UINT16
(HEARTRATE_COMMAND_UUID)

107 
hóπR©eSîvi˚CB_t
 
	ghóπR©eSîvi˚CB
;

114 
CONST
 
g©tAârTy≥_t
 
	ghóπR©eSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
hóπR©eSîvUUID
 };

118 
uöt8
 
	ghóπR©eMósPr›s
 = 
GATT_PROP_NOTIFY
;

119 
uöt8
 
	ghóπR©eMós
 = 0;

120 
g©tCh¨Cfg_t
 
	ghóπR©eMósClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

123 
uöt8
 
	ghóπR©eSísLocPr›s
 = 
GATT_PROP_READ
;

124 
uöt8
 
	ghóπR©eSísLoc
 = 0;

127 
uöt8
 
	ghóπR©eComm™dPr›s
 = 
GATT_PROP_WRITE
;

128 
uöt8
 
	ghóπR©eComm™d
 = 0;

134 
g©tAâribuã_t
 
	ghóπR©eAârTbl
[] =

138 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

139 
GATT_PERMIT_READ
,

141 (
uöt8
 *)&
hóπR©eSîvi˚


146 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

147 
GATT_PERMIT_READ
,

149 &
hóπR©eMósPr›s


154 { 
ATT_BT_UUID_SIZE
, 
hóπR©eMósUUID
 },

157 &
hóπR©eMós


162 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

163 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

165 (
uöt8
 *Ë&
hóπR©eMósClõ¡Ch¨Cfg


170 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

171 
GATT_PERMIT_READ
,

173 &
hóπR©eSísLocPr›s


178 { 
ATT_BT_UUID_SIZE
, 
hóπR©eSísLocUUID
 },

179 
GATT_PERMIT_READ
,

181 &
hóπR©eSísLoc


186 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

187 
GATT_PERMIT_READ
,

189 &
hóπR©eComm™dPr›s


194 { 
ATT_BT_UUID_SIZE
, 
hóπR©eComm™dUUID
 },

195 
GATT_PERMIT_WRITE
,

197 &
hóπR©eComm™d


205 
uöt8
 
hóπR©e_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

206 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

207 
bSètus_t
 
hóπR©e_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

208 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

214 
CONST
 
g©tSîvi˚CBs_t
 
	ghóπR©eCBs
 =

216 
hóπR©e_RódAârCB
,

217 
hóπR©e_WrôeAârCB
,

218 
NULL


236 
bSètus_t
 
	$HóπR©e_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

238 
uöt8
 
°©us
 = 
SUCCESS
;

241 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
hóπR©eMósClõ¡Ch¨Cfg
 );

243 i‡–
£rvi˚s
 & 
HEARTRATE_SERVICE
 )

246 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
hóπR©eAârTbl
,

247 
	`GATT_NUM_ATTRS
–
hóπR©eAârTbl
 ),

248 &
hóπR©eCBs
 );

251  ( 
°©us
 );

252 
	}
}

263 
	$HóπR©e_Regi°î
–
hóπR©eSîvi˚CB_t
 
p‚Sîvi˚CB
 )

265 
hóπR©eSîvi˚CB
 = 
p‚Sîvi˚CB
;

266 
	}
}

282 
bSètus_t
 
	$HóπR©e_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

284 
bSètus_t
 
ªt
 = 
SUCCESS
;

285  
∑øm
 )

287 
HEARTRATE_MEAS_CHAR_CFG
:

292 
HEARTRATE_SENS_LOC
:

293 
hóπR©eSísLoc
 = *((
uöt8
*)
vÆue
);

297 
ªt
 = 
INVALIDPARAMETER
;

301  ( 
ªt
 );

302 
	}
}

317 
bSètus_t
 
	$HóπR©e_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

319 
bSètus_t
 
ªt
 = 
SUCCESS
;

320  
∑øm
 )

322 
HEARTRATE_MEAS_CHAR_CFG
:

327 
HEARTRATE_SENS_LOC
:

328 *((
uöt8
*)
vÆue
Ë
hóπR©eSísLoc
;

331 
HEARTRATE_COMMAND
:

332 *((
uöt8
*)
vÆue
Ë
hóπR©eComm™d
;

336 
ªt
 = 
INVALIDPARAMETER
;

340  ( 
ªt
 );

341 
	}
}

354 
bSètus_t
 
	$HóπR©e_MósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
 )

356 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
hóπR©eMósClõ¡Ch¨Cfg
 );

359 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

362 
pNŸi
->
h™dÀ
 = 
hóπR©eAârTbl
[
HEARTRATE_MEAS_VALUE_POS
].handle;

365  
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
 );

368  
bÀInc‹ª˘Mode
;

369 
	}
}

385 
uöt8
 
	$hóπR©e_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

386 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

388 
bSètus_t
 
°©us
 = 
SUCCESS
;

391 i‡–
off£t
 > 0 )

393  ( 
ATT_ERR_ATTR_NOT_LONG
 );

396 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

398 i‡(
uuid
 =
HEARTRATE_SENS_LOC_UUID
)

400 *
pLí
 = 1;

401 
pVÆue
[0] = *
pAâr
->pValue;

405 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

408  ( 
°©us
 );

409 
	}
}

424 
bSètus_t
 
	$hóπR©e_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

425 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

427 
bSètus_t
 
°©us
 = 
SUCCESS
;

429 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

430  
uuid
 )

432 
HEARTRATE_COMMAND_UUID
:

433 i‡–
off£t
 > 0 )

435 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

437 i‡(
Àn
 != 1)

439 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

441 i‡(*
pVÆue
 !
HEARTRATE_COMMAND_ENERGY_EXP
)

443 
°©us
 = 
HEARTRATE_ERR_NOT_SUP
;

447 *(
pAâr
->
pVÆue
) =ÖValue[0];

449 (*
hóπR©eSîvi˚CB
)(
HEARTRATE_COMMAND_SET
);

454 
GATT_CLIENT_CHAR_CFG_UUID
:

455 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

456 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

457 i‡–
°©us
 =
SUCCESS
 )

459 
uöt16
 
ch¨Cfg
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

461 (*
hóπR©eSîvi˚CB
)–(
ch¨Cfg
 =
GATT_CFG_NO_OPERATION
) ?

462 
HEARTRATE_MEAS_NOTI_DISABLED
 :

463 
HEARTRATE_MEAS_NOTI_ENABLED
 );

468 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

472  ( 
°©us
 );

473 
	}
}

485 
	$HóπR©e_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

488 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

491 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

492 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

493 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

495 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
hóπR©eMósClõ¡Ch¨Cfg
 );

498 
	}
}

	@Projects/ble/Profiles/HeartRate/heartrateservice.h

11 #i‚de‡
HEARTRATESERVICE_H


12 
	#HEARTRATESERVICE_H


	)

14 #ifde‡
__˝lu•lus


29 
	#HEARTRATE_MEAS
 0

	)

30 
	#HEARTRATE_MEAS_CHAR_CFG
 1

	)

31 
	#HEARTRATE_SENS_LOC
 2

	)

32 
	#HEARTRATE_COMMAND
 3

	)

35 
	#HEARTRATE_SERV_UUID
 0x180D

	)

36 
	#HEARTRATE_MEAS_UUID
 0x2A37

	)

37 
	#HEARTRATE_SENS_LOC_UUID
 0x2A38

	)

38 
	#HEARTRATE_COMMAND_UUID
 0x2A39

	)

41 
	#HEARTRATE_MEAS_MAX
 (
ATT_MTU_SIZE
 -5)

	)

44 
	#HEARTRATE_FLAGS_FORMAT_UINT16
 0x01

	)

45 
	#HEARTRATE_FLAGS_CONTACT_NOT_SUP
 0x00

	)

46 
	#HEARTRATE_FLAGS_CONTACT_NOT_DET
 0x04

	)

47 
	#HEARTRATE_FLAGS_CONTACT_DET
 0x06

	)

48 
	#HEARTRATE_FLAGS_ENERGY_EXP
 0x08

	)

49 
	#HEARTRATE_FLAGS_RR
 0x10

	)

52 
	#HEARTRATE_SENS_LOC_OTHER
 0x00

	)

53 
	#HEARTRATE_SENS_LOC_CHEST
 0x01

	)

54 
	#HEARTRATE_SENS_LOC_WRIST
 0x02

	)

55 
	#HEARTRATE_SENS_LOC_FINGER
 0x03

	)

56 
	#HEARTRATE_SENS_LOC_HAND
 0x04

	)

57 
	#HEARTRATE_SENS_LOC_EARLOBE
 0x05

	)

58 
	#HEARTRATE_SENS_LOC_FOOT
 0x06

	)

61 
	#HEARTRATE_COMMAND_ENERGY_EXP
 0x01

	)

65 
	#HEARTRATE_ERR_NOT_SUP
 0x80

	)

68 
	#HEARTRATE_SERVICE
 0x00000001

	)

71 
	#HEARTRATE_MEAS_NOTI_ENABLED
 1

	)

72 
	#HEARTRATE_MEAS_NOTI_DISABLED
 2

	)

73 
	#HEARTRATE_COMMAND_SET
 3

	)

80 (*
hóπR©eSîvi˚CB_t
)(
	tuöt8
 
	tevít
);

103 
bSètus_t
 
HóπR©e_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

112 
HóπR©e_Regi°î
–
hóπR©eSîvi˚CB_t
 
p‚Sîvi˚CB
 );

124 
bSètus_t
 
HóπR©e_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

135 
bSètus_t
 
HóπR©e_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

148 
bSètus_t
 
HóπR©e_MósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
 );

160 
HóπR©e_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

165 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Keys/simplekeys.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"g≠b⁄dmgr.h
"

52 
	~"sim∂ekeys.h
"

62 
	#SERVAPP_NUM_ATTR_SUPPORTED
 5

	)

72 
CONST
 
uöt8
 
	gskSîvUUID
[
ATT_BT_UUID_SIZE
] =

74 
LO_UINT16
(
SK_SERV_UUID
), 
HI_UINT16
(SK_SERV_UUID)

78 
CONST
 
uöt8
 
	gkeyPªs£dUUID
[
ATT_BT_UUID_SIZE
] =

80 
LO_UINT16
(
SK_KEYPRESSED_UUID
), 
HI_UINT16
(SK_KEYPRESSED_UUID)

100 
CONST
 
g©tAârTy≥_t
 
	gskSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
skSîvUUID
 };

103 
uöt8
 
	gskCh¨Pr›s
 = 
GATT_PROP_NOTIFY
;

106 
uöt8
 
	gskKeyPªs£d
 = 0;

109 
g©tCh¨Cfg_t
 
	gskC⁄fig
[
GATT_MAX_NUM_CONN
];

112 
uöt8
 
	gskCh¨U£rDe•
[16] = "Key Press State\0";

119 
g©tAâribuã_t
 
	gsim∂ekeysAârTbl
[
SERVAPP_NUM_ATTR_SUPPORTED
] =

123 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

124 
GATT_PERMIT_READ
,

126 (
uöt8
 *)&
skSîvi˚


131 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

132 
GATT_PERMIT_READ
,

134 &
skCh¨Pr›s


139 { 
ATT_BT_UUID_SIZE
, 
keyPªs£dUUID
 },

142 &
skKeyPªs£d


147 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

148 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

150 (
uöt8
 *)
skC⁄fig


155 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

156 
GATT_PERMIT_READ
,

158 
skCh¨U£rDe•


166 
uöt8
 
sk_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

167 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

168 
bSètus_t
 
sk_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

169 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

171 
sk_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

177 
CONST
 
g©tSîvi˚CBs_t
 
	gskCBs
 =

179 
sk_RódAârCB
,

180 
sk_WrôeAârCB
,

181 
NULL


199 
bSètus_t
 
	$SK_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

201 
uöt8
 
°©us
 = 
SUCCESS
;

204 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
skC⁄fig
 );

207 
VOID
 
	`lökDB_Regi°î
–
sk_H™dÀC⁄nSètusCB
 );

210 i‡–
£rvi˚s
 & 
SK_SERVICE
 )

213 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
sim∂ekeysAârTbl
,

214 
	`GATT_NUM_ATTRS
–
sim∂ekeysAârTbl
 ),

215 &
skCBs
 );

218  ( 
°©us
 );

219 
	}
}

235 
bSètus_t
 
	$SK_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
pVÆue
 )

237 
bSètus_t
 
ªt
 = 
SUCCESS
;

238  
∑øm
 )

240 
SK_KEY_ATTR
:

241 i‡–
Àn
 = ( 
uöt8
 ) )

243 
skKeyPªs£d
 = *((
uöt8
*)
pVÆue
);

246 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
skC⁄fig
, &
skKeyPªs£d
, 
FALSE
,

247 
sim∂ekeysAârTbl
, 
	`GATT_NUM_ATTRS
( simplekeysAttrTbl ),

248 
INVALID_TASK_ID
 );

252 
ªt
 = 
bÀInvÆidR™ge
;

257 
ªt
 = 
INVALIDPARAMETER
;

261  ( 
ªt
 );

262 
	}
}

277 
bSètus_t
 
	$SK_GëP¨amëî
–
uöt8
 
∑øm
, *
pVÆue
 )

279 
bSètus_t
 
ªt
 = 
SUCCESS
;

280  
∑øm
 )

282 
SK_KEY_ATTR
:

283 *((
uöt8
*)
pVÆue
Ë
skKeyPªs£d
;

287 
ªt
 = 
INVALIDPARAMETER
;

291  ( 
ªt
 );

292 
	}
}

308 
uöt8
 
	$sk_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

309 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

311 
bSètus_t
 
°©us
 = 
SUCCESS
;

314 i‡–
off£t
 > 0 )

316  ( 
ATT_ERR_ATTR_NOT_LONG
 );

319 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

322 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

323  
uuid
 )

330 
SK_KEYPRESSED_UUID
:

331 *
pLí
 = 1;

332 
pVÆue
[0] = *
pAâr
->pValue;

337 *
pLí
 = 0;

338 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

345 *
pLí
 = 0;

346 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

349  ( 
°©us
 );

350 
	}
}

365 
bSètus_t
 
	$sk_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

366 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

368 
bSètus_t
 
°©us
 = 
SUCCESS
;

370 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

373 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

374  
uuid
 )

376 
GATT_CLIENT_CHAR_CFG_UUID
:

377 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

378 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

383 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

390 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

393  ( 
°©us
 );

394 
	}
}

406 
	$sk_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

409 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

412 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

413 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

414 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

416 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
skC⁄fig
 );

419 
	}
}

	@Projects/ble/Profiles/Keys/simplekeys.h

40 #i‚de‡
SIMPLEKEYS_H


41 
	#SIMPLEKEYS_H


	)

43 #ifde‡
__˝lu•lus


57 
	#SK_KEY_ATTR
 0

58 

	)

60 
	#SK_SERV_UUID
 0xFFE0

	)

63 
	#SK_KEYPRESSED_UUID
 0xFFE1

	)

66 
	#SK_KEY_LEFT
 0x01

	)

67 
	#SK_KEY_RIGHT
 0x02

	)

70 
	#SK_SERVICE
 0x00000001

	)

99 
bSètus_t
 
SK_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

111 
bSètus_t
 
SK_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
pVÆue
 );

122 
bSètus_t
 
SK_GëP¨amëî
–
uöt8
 
∑øm
, *
pVÆue
 );

128 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/OAD/oad.h

39 #i‚de‡
OAD_H


40 
	#OAD_H


	)

42 #ifde‡
__˝lu•lus


51 
	~"hÆ_´s.h
"

52 
	~"hÆ_ty≥s.h
"

58 
	#OAD_SERVICE_UUID
 0xFFC0

	)

59 
	#OAD_IMG_IDENTIFY_UUID
 0xFFC1

	)

60 
	#OAD_IMG_BLOCK_UUID
 0xFFC2

	)

62 
	#OAD_IMG_CRC_OSET
 0x0000

	)

63 #i‡
deföed
 
FEATURE_OAD_SECURE


64 
	#OAD_IMG_HDR_OSET
 0x0000

	)

66 
	#OAD_IMG_HDR_OSET
 0x0002

	)

69 
	#OAD_CHAR_CNT
 2

	)

72 
	#OAD_CHAR_IMG_IDENTIFY
 0

	)

73 
	#OAD_CHAR_IMG_BLOCK
 1

	)

76 
	#OAD_IMG_ID_SIZE
 4

	)

79 
	#OAD_IMG_HDR_SIZE
 ( 2 + 2 + 
OAD_IMG_ID_SIZE
 )

	)

82 
	#OAD_BLOCK_SIZE
 16

	)

83 
	#OAD_BLOCKS_PER_PAGE
 (
HAL_FLASH_PAGE_SIZE
 / 
OAD_BLOCK_SIZE
)

	)

84 
	#OAD_BLOCK_MAX
 (
OAD_BLOCKS_PER_PAGE
 * 
OAD_IMG_D_AREA
)

	)

91 
	#OAD_IMG_ID
–
vî
 ) ( (vîË& 0x01 )

	)

92 
	#OAD_VER_NUM
–
vî
 ) ( (vîË>> 0x01 )

	)

95 #i‡
deföed
 (
HAL_IMAGE_A
)

96 
	#OAD_IMG_VER
–
vî
 ) ( (
uöt16
)( (ver) << 0x01 ) )

97 #ñ£

	)

98 
	#OAD_IMG_VER
–
vî
 ) ( (
uöt16
)( ( (ver) << 0x01 ) | 0x01 ) )

100 

	)

111 #i‡
deföed
 
FEATURE_OAD_SECURE


114 
uöt16
 
¸c0
;

116 
uöt16
 
¸c1
;

118 
uöt16
 
vî
;

119 
uöt16
 
Àn
;

120 
uöt8
 
uid
[4];

121 
uöt8
 
ªs
[4];

122 } 
	timg_hdr_t
;

124 #i‡
deföed
 
FEATURE_OAD_SECURE


125 
°©ic_as£π
(((
img_hdr_t
) == 16), "Bad SBL_ADDR_AES_HDR definition.");

126 
°©ic_as£π
((((
img_hdr_t
Ë% 
KEY_BLENGTH
) == 0),

132 
uöt8
 
sig«tuª
[
KEY_BLENGTH
];

133 
uöt8
 
n⁄˚12
[12];

134 
uöt8
 
•¨e
[4];

135 } 
	t´s_hdr_t
;

140 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/OAD/oad_target.c

44 
	~"bcomdef.h
"

45 
	~"©t.h
"

46 
	~"g©t.h
"

47 
	~"g©t_uuid.h
"

48 
	~"g©t£rv≠p.h
"

49 
	~"hÆ_´s.h
"

50 
	~"hÆ_¸c.h
"

51 
	~"hÆ_Êash.h
"

52 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

53 
	~"hÆ_lcd.h
"

55 
	~"hÆ_ty≥s.h
"

56 
	~"lökdb.h
"

57 
	~"ﬂd.h
"

58 
	~"ﬂd_èrgë.h
"

59 
	~"OSAL.h
"

65 
	#OAD_FLASH_PAGE_MULT
 ((
uöt16
)(
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
))

	)

67 #i‡
deföed
 (
FEATURE_OAD_SECURE
Ë&& deföed (
HAL_IMAGE_A
)

70 
	#BOOTP_E_IMAGE_A


	)

73 #i‡!
deföed
 (
OAD_IMAGE_VERSION
)

74 
	#OAD_IMAGE_VERSION
 0x0000

	)

77 #i‡!
deföed
 (
OAD_IMAGE_A_USER_ID
)

78 
	#OAD_IMAGE_A_USER_ID
 {'A', 'A', 'A', 'A'}

	)

81 #i‡!
deföed
 (
OAD_IMAGE_B_USER_ID
)

82 
	#OAD_IMAGE_B_USER_ID
 {'B', 'B', 'B', 'B'}

	)

94 
CONST
 
uöt8
 
	gﬂdSîvUUID
[
ATT_UUID_SIZE
] =

96 
TI_BASE_UUID_128
–
OAD_SERVICE_UUID
 )

99 
CONST
 
uöt8
 
	gﬂdCh¨UUID
[
OAD_CHAR_CNT
][
ATT_UUID_SIZE
] =

102 
TI_BASE_UUID_128
–
OAD_IMG_IDENTIFY_UUID
 ),

105 
TI_BASE_UUID_128
–
OAD_IMG_BLOCK_UUID
 )

113 
CONST
 
g©tAârTy≥_t
 
	gﬂdSîvi˚
 = { 
ATT_UUID_SIZE
, 
ﬂdSîvUUID
 };

116 
uöt8
 
	gﬂdCh¨VÆs
[
OAD_CHAR_CNT
];

119 
uöt8
 
	gﬂdCh¨Pr›s
 = 
GATT_PROP_WRITE_NO_RSP
 | 
GATT_PROP_WRITE
 | 
GATT_PROP_NOTIFY
;

122 
g©tCh¨Cfg_t
 
	gﬂdImgIdítifyC⁄fig
[
GATT_MAX_NUM_CONN
];

123 
g©tCh¨Cfg_t
 
	gﬂdImgBlockC⁄fig
[
GATT_MAX_NUM_CONN
];

126 
CONST
 
uöt8
 
	gﬂdImgIdítifyDesc
[] = "Img Identify";

127 
CONST
 
uöt8
 
	gﬂdImgBlockDesc
[] = "Img Block";

133 
g©tAâribuã_t
 
	gﬂdAârTbl
[] =

137 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

138 
GATT_PERMIT_READ
,

140 (
uöt8
 *)&
ﬂdSîvi˚


145 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

146 
GATT_PERMIT_READ
,

148 &
ﬂdCh¨Pr›s


153 { 
ATT_UUID_SIZE
, 
ﬂdCh¨UUID
[0] },

154 
GATT_PERMIT_WRITE
,

156 
ﬂdCh¨VÆs
+0

161 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

162 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

164 (
uöt8
 *)
ﬂdImgIdítifyC⁄fig


169 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

170 
GATT_PERMIT_READ
,

172 (
uöt8
 *)
ﬂdImgIdítifyDesc


177 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

178 
GATT_PERMIT_READ
,

180 &
ﬂdCh¨Pr›s


185 { 
ATT_UUID_SIZE
, 
ﬂdCh¨UUID
[1] },

186 
GATT_PERMIT_WRITE
,

188 
ﬂdCh¨VÆs
+1

193 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

194 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

196 (
uöt8
 *)
ﬂdImgBlockC⁄fig


201 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

202 
GATT_PERMIT_READ
,

204 (
uöt8
 *)
ﬂdImgBlockDesc


208 #¥agm®
loˇti⁄
="IMAGE_HEADER"

209 c⁄° 
__code
 
img_hdr_t
 
	g_imgHdr
 = {

210 #i‡
deföed
 
FEATURE_OAD_SECURE


213 #i‡
deföed
 (
BOOTP_E_IMAGE_A
)

219 
OAD_IMG_VER
–
OAD_IMAGE_VERSION
 ),

220 
OAD_IMG_R_AREA
 * 
OAD_FLASH_PAGE_MULT
,

221 #i‡
deföed
 
HAL_IMAGE_A


222 
OAD_IMAGE_A_USER_ID
,

224 
OAD_IMAGE_B_USER_ID
,

228 #¥agm®
ªquúed
=
_imgHdr


230 #¥agm®
loˇti⁄
="AES_HEADER"

231 c⁄° 
__code
 
´s_hdr_t
 
	g_´sHdr
 = {

236 #¥agm®
ªquúed
=
_´sHdr


242 
uöt16
 
	gﬂdBlkNum
 = 0, 
	gﬂdBlkTŸ
 = 0xFFFF;

248 
uöt8
 
ﬂdRódAârCB
(
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

249 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
);

251 
bSètus_t
 
ﬂdWrôeAârCB
(
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

252 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
);

254 
CONST
 
g©tSîvi˚CBs_t
 
	gﬂdCBs
 =

256 
ﬂdRódAârCB
,

257 
ﬂdWrôeAârCB
,

258 
NULL


261 
ﬂdImgBlockReq
(
uöt16
 
c⁄nH™dÀ
, uöt16 
blkNum
);

263 
ﬂdImgIdítifyReq
(
uöt16
 
c⁄nH™dÀ
, 
img_hdr_t
 *
pImgHdr
);

265 
bSètus_t
 
ﬂdImgIdítifyWrôe
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 *
pVÆue
 );

267 
bSètus_t
 
ﬂdImgBlockWrôe
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 *
pVÆue
 );

269 
ﬂdH™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

271 #i‡!
deföed
 
FEATURE_OAD_SECURE


272 
uöt8
 
checkDL
();

283 
bSètus_t
 
	$OADT¨gë_AddSîvi˚
()

286 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ﬂdImgIdítifyC⁄fig
 );

287 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ﬂdImgBlockC⁄fig
 );

290 
VOID
 
	`lökDB_Regi°î
–
ﬂdH™dÀC⁄nSètusCB
 );

292  
	`GATTSîvAµ_Regi°îSîvi˚
(
ﬂdAârTbl
, 
	`GATT_NUM_ATTRS
(ﬂdAârTbl), &
ﬂdCBs
);

293 
	}
}

309 
uöt8
 
	$ﬂdRódAârCB
(
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

310 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
)

312 
bSètus_t
 
°©us
 = 
SUCCESS
;

315 *
pLí
 = 0;

316 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

318  
°©us
;

319 
	}
}

334 
bSètus_t
 
	$ﬂdWrôeAârCB
(
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

335 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
)

337 
bSètus_t
 
°©us
 = 
SUCCESS
;

339 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

342 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

343 i‡–
uuid
 =
GATT_CLIENT_CHAR_CFG_UUID
)

345 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

346 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

350 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

356 i‡(
	`oßl_memcmp
(
pAâr
->
ty≥
.
uuid
, 
ﬂdCh¨UUID
[
OAD_CHAR_IMG_IDENTIFY
], 
ATT_UUID_SIZE
))

358 
°©us
 = 
	`ﬂdImgIdítifyWrôe
–
c⁄nH™dÀ
, 
pVÆue
 );

360 i‡(
	`oßl_memcmp
(
pAâr
->
ty≥
.
uuid
, 
ﬂdCh¨UUID
[
OAD_CHAR_IMG_BLOCK
], 
ATT_UUID_SIZE
))

362 
°©us
 = 
	`ﬂdImgBlockWrôe
–
c⁄nH™dÀ
, 
pVÆue
 );

366 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

370  
°©us
;

371 
	}
}

383 
bSètus_t
 
	$ﬂdImgIdítifyWrôe
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 *
pVÆue
 )

385 
img_hdr_t
 
rxHdr
;

386 
img_hdr_t
 
ImgHdr
;

388 
rxHdr
.
vî
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

389 
rxHdr
.
Àn
 = 
	`BUILD_UINT16
–
pVÆue
[2],ÖValue[3] );

391 ()
	`oßl_mem˝y
(
rxHdr
.
uid
, 
pVÆue
+4, (rxHdr.uid));

393 
	`HÆFœshRód
(
OAD_IMG_R_PAGE
, 
OAD_IMG_HDR_OSET
, (
uöt8
 *)&
ImgHdr
, (
img_hdr_t
));

395 
ﬂdBlkTŸ
 = 
rxHdr
.
Àn
 / (
OAD_BLOCK_SIZE
 / 
HAL_FLASH_WORD_SIZE
);

397 i‡–(
	`OAD_IMG_ID
–
ImgHdr
.
vî
 ) !OAD_IMG_ID–
rxHdr
.ver )) &&

398 (
ﬂdBlkTŸ
 <
OAD_BLOCK_MAX
) &&

399 (
ﬂdBlkTŸ
 != 0) )

401 
ﬂdBlkNum
 = 0;

402 
	`ﬂdImgBlockReq
(
c⁄nH™dÀ
, 0);

406 
	`ﬂdImgIdítifyReq
(
c⁄nH™dÀ
, &
ImgHdr
);

409  ( 
SUCCESS
 );

410 
	}
}

422 
bSètus_t
 
	$ﬂdImgBlockWrôe
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 *
pVÆue
 )

424 
uöt16
 
blkNum
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

427 i‡–
blkNum
 == 0 )

429 
img_hdr_t
 
ImgHdr
;

430 
uöt16
 
vî
 = 
	`BUILD_UINT16
–
pVÆue
[6],ÖValue[7] );

431 
uöt16
 
blkTŸ
 = 
	`BUILD_UINT16
–
pVÆue
[8],ÖVÆue[9] ) / (
OAD_BLOCK_SIZE
 / 
HAL_FLASH_WORD_SIZE
);

433 
	`HÆFœshRód
(
OAD_IMG_R_PAGE
, 
OAD_IMG_HDR_OSET
, (
uöt8
 *)&
ImgHdr
, (
img_hdr_t
));

435 i‡––
ﬂdBlkNum
 !
blkNum
 ) ||

436 –
ﬂdBlkTŸ
 !
blkTŸ
 ) ||

437 –
	`OAD_IMG_ID
–
ImgHdr
.
vî
 ) == OAD_IMG_ID( ver ) ) )

439  ( 
ATT_ERR_WRITE_NOT_PERMITTED
 );

443 i‡(
ﬂdBlkNum
 =
blkNum
)

445 
uöt16
 
addr
 = 
ﬂdBlkNum
 * (
OAD_BLOCK_SIZE
 / 
HAL_FLASH_WORD_SIZE
) +

446 (
OAD_IMG_D_PAGE
 * 
OAD_FLASH_PAGE_MULT
);

447 
ﬂdBlkNum
++;

449 #i‡
deföed
 
FEATURE_OAD_SECURE


450 i‡(
blkNum
 == 0)

453 
pVÆue
[4] = 0xFF;

454 
pVÆue
[5] = 0xFF;

458 #i‡
deföed
 
HAL_IMAGE_B


460 i‡(
addr
 >(
OAD_IMG_B_PAGE
 * 
OAD_FLASH_PAGE_MULT
))

462 
addr
 +
OAD_IMG_B_AREA
 * 
OAD_FLASH_PAGE_MULT
;

465 i‡((
addr
 % 
OAD_FLASH_PAGE_MULT
) == 0)

467 
	`HÆFœshEø£
(
addr
 / 
OAD_FLASH_PAGE_MULT
);

470 
	`HÆFœshWrôe
(
addr
, 
pVÆue
+2, (
OAD_BLOCK_SIZE
 / 
HAL_FLASH_WORD_SIZE
));

473 i‡(
ﬂdBlkNum
 =
ﬂdBlkTŸ
)

475 #i‡
deföed
 
FEATURE_OAD_SECURE


476 
	`HAL_SYSTEM_RESET
();

478 i‡(
	`checkDL
())

480 #i‡!
deföed
 
HAL_IMAGE_A


483 
uöt16
 
¸c
[2] = { 0x0000, 0xFFFF };

484 
uöt16
 
addr
 = 
OAD_IMG_R_PAGE
 * 
OAD_FLASH_PAGE_MULT
 + 
OAD_IMG_CRC_OSET
 / 
HAL_FLASH_WORD_SIZE
;

485 
	`HÆFœshWrôe
(
addr
, (
uöt8
 *)
¸c
, 1);

487 
	`HAL_SYSTEM_RESET
();

493 
	`ﬂdImgBlockReq
(
c⁄nH™dÀ
, 
ﬂdBlkNum
);

496  ( 
SUCCESS
 );

497 
	}
}

509 
	$ﬂdImgBlockReq
(
uöt16
 
c⁄nH™dÀ
, uöt16 
blkNum
)

511 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
ﬂdImgBlockC⁄fig
 );

514 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

516 
©tH™dÀVÆueNŸi_t
 
nŸi
;

517 
g©tAâribuã_t
 *
pAâr
 = 
	`GATTSîvAµ_FödAâr
(
ﬂdAârTbl
, 
	`GATT_NUM_ATTRS
(oadAttrTbl),

518 
ﬂdCh¨VÆs
+
OAD_CHAR_IMG_BLOCK
);

519 
nŸi
.
h™dÀ
 = 
pAâr
->handle;

520 
nŸi
.
Àn
 = 2;

521 
nŸi
.
vÆue
[0] = 
	`LO_UINT16
(
blkNum
);

522 
nŸi
.
vÆue
[1] = 
	`HI_UINT16
(
blkNum
);

524 
VOID
 
	`GATT_NŸifiˇti⁄
(
c⁄nH™dÀ
, &
nŸi
, 
FALSE
);

526 
	}
}

538 
	$ﬂdImgIdítifyReq
(
uöt16
 
c⁄nH™dÀ
, 
img_hdr_t
 *
pImgHdr
)

540 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
ﬂdImgIdítifyC⁄fig
 );

543 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

545 
©tH™dÀVÆueNŸi_t
 
nŸi
;

546 
g©tAâribuã_t
 *
pAâr
 = 
	`GATTSîvAµ_FödAâr
(
ﬂdAârTbl
, 
	`GATT_NUM_ATTRS
(oadAttrTbl),

547 
ﬂdCh¨VÆs
+
OAD_CHAR_IMG_IDENTIFY
);

548 
nŸi
.
h™dÀ
 = 
pAâr
->handle;

549 
nŸi
.
Àn
 = 
OAD_IMG_HDR_SIZE
;

550 
nŸi
.
vÆue
[0] = 
	`LO_UINT16
(
pImgHdr
->
vî
);

551 
nŸi
.
vÆue
[1] = 
	`HI_UINT16
(
pImgHdr
->
vî
);

553 
nŸi
.
vÆue
[2] = 
	`LO_UINT16
(
pImgHdr
->
Àn
);

554 
nŸi
.
vÆue
[3] = 
	`HI_UINT16
(
pImgHdr
->
Àn
);

556 ()
	`oßl_mem˝y
(
nŸi
.
vÆue
+4, 
pImgHdr
->
uid
, (pImgHdr->uid));

558 
VOID
 
	`GATT_NŸifiˇti⁄
(
c⁄nH™dÀ
, &
nŸi
, 
FALSE
);

560 
	}
}

562 #i‡!
deföed
 
FEATURE_OAD_SECURE


579 
uöt16
 
	$¸cCÆcDL
()

581 
uöt8
 
∑geEnd
 = 
ﬂdBlkTŸ
 / 
OAD_BLOCKS_PER_PAGE
;

582 
uöt16
 
o£tEnd
 = (
ﬂdBlkTŸ
 - (
∑geEnd
 * 
OAD_BLOCKS_PER_PAGE
)Ë* 
OAD_BLOCK_SIZE
;

584 #i‡
deföed
 
HAL_IMAGE_B


585 
∑geEnd
 +
OAD_IMG_D_PAGE
 + 
OAD_IMG_B_AREA
;

587 
∑geEnd
 +
OAD_IMG_D_PAGE
;

590 
	`HÆCRCInô
(0x0000);

592 
uöt8
 
∑ge
 = 
OAD_IMG_D_PAGE
; ;Öage++)

594 #i‡
deföed
 
HAL_IMAGE_B


596 i‡(
∑ge
 =
OAD_IMG_B_PAGE
)

598 
∑ge
 +
OAD_IMG_B_AREA
;

602 
uöt16
 
o£t
 = 0; o£à< 
HAL_FLASH_PAGE_SIZE
; o£à+
HAL_FLASH_WORD_SIZE
)

604 i‡((
∑ge
 =
OAD_IMG_D_PAGE
Ë&& (
o£t
 =
OAD_IMG_CRC_OSET
))

608 i‡((
∑ge
 =
∑geEnd
Ë&& (
o£t
 =
o£tEnd
))

610  
	`HÆCRCCÆc
();

614 
uöt8
 
buf
[
HAL_FLASH_WORD_SIZE
];

615 
	`HÆFœshRód
(
∑ge
, 
o£t
, 
buf
, 
HAL_FLASH_WORD_SIZE
);

617 
uöt8
 
idx
 = 0; idx < 
HAL_FLASH_WORD_SIZE
; idx++)

619 
	`HÆCRCExec
(
buf
[
idx
]);

624 
	}
}

642 
uöt8
 
	$checkDL
()

644 
uöt16
 
¸c
[2];

646 
	`HÆFœshRód
(
OAD_IMG_D_PAGE
, 
OAD_IMG_CRC_OSET
, (
uöt8
 *)
¸c
, (crc));

648 i‡((
¸c
[0] == 0xFFFF) || (crc[0] == 0x0000))

650  
FALSE
;

653 i‡(
¸c
[1] == 0xFFFF)

655 
¸c
[1] = 
	`¸cCÆcDL
();

657 #i‡
deföed
 
FEATURE_OAD_BIM


658 
uöt16
 
addr
 = 
OAD_IMG_D_PAGE
 * 
OAD_FLASH_PAGE_MULT
 + 
OAD_IMG_CRC_OSET
 / 
HAL_FLASH_WORD_SIZE
;

659 
¸c
[0] = 0xFFFF;

660 
	`HÆFœshWrôe
(
addr
, (
uöt8
 *)
¸c
, 1);

661 
	`HÆFœshRód
(
OAD_IMG_D_PAGE
, 
OAD_IMG_CRC_OSET
, (
uöt8
 *)
¸c
, (crc));

665  (
¸c
[0] == crc[1]);

666 
	}
}

679 
	$ﬂdH™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

682 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

685 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

686 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

687 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

689 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ﬂdImgIdítifyC⁄fig
 );

690 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ﬂdImgBlockC⁄fig
 );

693 
	}
}

	@Projects/ble/Profiles/OAD/oad_target.h

39 #i‚de‡
OAD_TARGET_H


40 
	#OAD_TARGET_H


	)

42 #ifde‡
__˝lu•lus


51 
	~"hÆ_´s.h
"

52 
	~"hÆ_ty≥s.h
"

58 #i‡!
deföed
 
OAD_IMG_A_PAGE


59 
	#OAD_IMG_A_PAGE
 1

	)

60 
	#OAD_IMG_A_AREA
 62

	)

63 #i‡!
deföed
 
OAD_IMG_B_PAGE


65 #i‡
deföed
 
FEATURE_OAD_BIM


66 
	#OAD_IMG_B_PAGE
 8

	)

68 
	#OAD_IMG_B_PAGE
 63

	)

70 
	#OAD_IMG_B_AREA
 (124 - 
OAD_IMG_A_AREA
)

	)

73 #i‡
deföed
 
HAL_IMAGE_B


74 
	#OAD_IMG_D_PAGE
 
OAD_IMG_A_PAGE


	)

75 
	#OAD_IMG_D_AREA
 
OAD_IMG_A_AREA


	)

76 
	#OAD_IMG_R_PAGE
 
OAD_IMG_B_PAGE


	)

77 
	#OAD_IMG_R_AREA
 
OAD_IMG_B_AREA


	)

79 
	#OAD_IMG_D_PAGE
 
OAD_IMG_B_PAGE


	)

80 
	#OAD_IMG_D_AREA
 
OAD_IMG_B_AREA


	)

81 
	#OAD_IMG_R_PAGE
 
OAD_IMG_A_PAGE


	)

82 
	#OAD_IMG_R_AREA
 
OAD_IMG_A_AREA


	)

94 c⁄° 
__code
 
img_hdr_t
 
_imgHdr
;

108 
bSètus_t
 
OADT¨gë_AddSîvi˚
( );

113 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Proximity/proxreporter.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"g≠b⁄dmgr.h
"

52 
	~"¥oxªp‹ãr.h
"

61 
	#PP_DEFAULT_TX_POWER
 0

	)

62 
	#PP_DEFAULT_PATH_LOSS
 0x7F

	)

64 
	#SERVAPP_NUM_ATTR_SUPPORTED
 5

	)

75 
CONST
 
uöt8
 
	glökLossSîvUUID
[
ATT_BT_UUID_SIZE
] =

77 
LO_UINT16
–
LINK_LOSS_SERVICE_UUID
 ), 
HI_UINT16
( LINK_LOSS_SERVICE_UUID )

81 
CONST
 
uöt8
 
	gimAÀπSîvUUID
[
ATT_BT_UUID_SIZE
] =

83 
LO_UINT16
–
IMMEDIATE_ALERT_SERVICE_UUID
 ), 
HI_UINT16
( IMMEDIATE_ALERT_SERVICE_UUID )

87 
CONST
 
uöt8
 
	gtxPwrLevñSîvUUID
[
ATT_BT_UUID_SIZE
] =

89 
LO_UINT16
–
TX_PWR_LEVEL_SERVICE_UUID
 ), 
HI_UINT16
( TX_PWR_LEVEL_SERVICE_UUID )

93 
CONST
 
uöt8
 
	gÆîtLevñUUID
[
ATT_BT_UUID_SIZE
] =

95 
LO_UINT16
–
PROXIMITY_ALERT_LEVEL_UUID
 ), 
HI_UINT16
( PROXIMITY_ALERT_LEVEL_UUID )

99 
CONST
 
uöt8
 
	gtxPwrLevñUUID
[
ATT_BT_UUID_SIZE
] =

101 
LO_UINT16
–
PROXIMITY_TX_PWR_LEVEL_UUID
 ), 
HI_UINT16
( PROXIMITY_TX_PWR_LEVEL_UUID )

115 
¥oxRï‹ãrCBs_t
 *
	gµ_AµCBs
 = 
NULL
;

122 
CONST
 
g©tAârTy≥_t
 
	glökLossSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
lökLossSîvUUID
 };

125 
uöt8
 
	gŒAÀπLevñCh¨Pr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

129 
uöt8
 
	gŒAÀπLevñ
 = 
PP_ALERT_LEVEL_NO
;

132 
CONST
 
g©tAârTy≥_t
 
	gimAÀπSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
imAÀπSîvUUID
 };

135 
uöt8
 
	gimAÀπLevñCh¨Pr›s
 = 
GATT_PROP_WRITE_NO_RSP
;

139 
uöt8
 
	gimAÀπLevñ
 = 
PP_ALERT_LEVEL_NO
;

142 
CONST
 
g©tAârTy≥_t
 
	gtxPwrLevñSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
txPwrLevñSîvUUID
 };

145 
uöt8
 
	gtxPwrLevñCh¨Pr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

150 
öt8
 
	gtxPwrLevñ
 = 
PP_DEFAULT_TX_POWER
;

153 
g©tCh¨Cfg_t
 
	gtxPwrLevñC⁄fig
[
GATT_MAX_NUM_CONN
];

160 
g©tAâribuã_t
 
	glökLossAârTbl
[] =

164 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

165 
GATT_PERMIT_READ
,

167 (
uöt8
 *)&
lökLossSîvi˚


172 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

173 
GATT_PERMIT_READ
,

175 &
ŒAÀπLevñCh¨Pr›s


180 { 
ATT_BT_UUID_SIZE
, 
ÆîtLevñUUID
 },

181 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

183 &
ŒAÀπLevñ


188 
g©tAâribuã_t
 
	gimAÀπAârTbl
[] =

192 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

193 
GATT_PERMIT_READ
,

195 (
uöt8
 *)&
imAÀπSîvi˚


200 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

201 
GATT_PERMIT_READ
,

203 &
imAÀπLevñCh¨Pr›s


208 { 
ATT_BT_UUID_SIZE
, 
ÆîtLevñUUID
 },

209 
GATT_PERMIT_WRITE
,

211 &
imAÀπLevñ


216 
g©tAâribuã_t
 
	gtxPwrLevñAârTbl
[] =

220 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

221 
GATT_PERMIT_READ
,

223 (
uöt8
 *)&
txPwrLevñSîvi˚


228 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

229 
GATT_PERMIT_READ
,

231 &
txPwrLevñCh¨Pr›s


236 { 
ATT_BT_UUID_SIZE
, 
txPwrLevñUUID
 },

237 
GATT_PERMIT_READ
,

239 (
uöt8
 *)&
txPwrLevñ


244 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

245 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

247 (
uöt8
 *)
txPwrLevñC⁄fig


255 
uöt8
 
¥oxRï‹ãr_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

256 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

257 
bSètus_t
 
¥oxRï‹ãr_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

258 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

260 
¥oxRï‹ãr_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

266 
CONST
 
g©tSîvi˚CBs_t
 
	g¥oxRï‹ãrCBs
 =

268 
¥oxRï‹ãr_RódAârCB
,

269 
¥oxRï‹ãr_WrôeAârCB
,

270 
NULL


289 
bSètus_t
 
	$ProxRï‹ãr_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

291 
uöt8
 
°©us
 = 
SUCCESS
;

293 i‡–
£rvi˚s
 & 
PP_LINK_LOSS_SERVICE
 )

296 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
lökLossAârTbl
,

297 
	`GATT_NUM_ATTRS
–
lökLossAârTbl
 ),

298 &
¥oxRï‹ãrCBs
 );

301 i‡––
°©us
 =
SUCCESS
 ) && ( 
£rvi˚s
 & 
PP_IM_ALETR_SERVICE
 ) )

304 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
imAÀπAârTbl
,

305 
	`GATT_NUM_ATTRS
–
imAÀπAârTbl
 ),

306 &
¥oxRï‹ãrCBs
 );

309 i‡––
°©us
 =
SUCCESS
 ) && ( 
£rvi˚s
 & 
PP_TX_PWR_LEVEL_SERVICE
 ) )

313 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
txPwrLevñC⁄fig
 );

316 
VOID
 
	`lökDB_Regi°î
–
¥oxRï‹ãr_H™dÀC⁄nSètusCB
 );

320 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
txPwrLevñAârTbl
,

321 
	`GATT_NUM_ATTRS
–
txPwrLevñAârTbl
 ),

322 &
¥oxRï‹ãrCBs
 );

325  ( 
°©us
 );

326 
	}
}

339 
bSètus_t
 
	$ProxRï‹ãr_Regi°îAµCBs
–
¥oxRï‹ãrCBs_t
 *
≠pCÆlbacks
 )

341 i‡–
≠pCÆlbacks
 )

343 
µ_AµCBs
 = 
≠pCÆlbacks
;

345  ( 
SUCCESS
 );

349  ( 
bÀAÃódyInReque°edMode
 );

351 
	}
}

368 
bSètus_t
 
	$ProxRï‹ãr_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

370 
bSètus_t
 
ªt
 = 
SUCCESS
;

371  
∑øm
 )

374 
PP_LINK_LOSS_ALERT_LEVEL
:

375 i‡–(
Àn
 = ( 
uöt8
 )Ë&& ((*((uöt8*)
vÆue
Ë<
PP_ALERT_LEVEL_HIGH
)) )

377 
ŒAÀπLevñ
 = *((
uöt8
*)
vÆue
);

381 
ªt
 = 
bÀInvÆidR™ge
;

385 
PP_IM_ALERT_LEVEL
:

386 i‡–
Àn
 = ( 
uöt8
 ) )

388 
imAÀπLevñ
 = *((
uöt8
*)
vÆue
);

392 
ªt
 = 
bÀInvÆidR™ge
;

396 
PP_TX_POWER_LEVEL
:

397 i‡–
Àn
 = ( 
öt8
 ) )

399 
txPwrLevñ
 = *((
öt8
*)
vÆue
);

402 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
txPwrLevñC⁄fig
, (
uöt8
 *)&
txPwrLevñ
, 
FALSE
,

403 
txPwrLevñAârTbl
, 
	`GATT_NUM_ATTRS
(ÅxPwrLevelAttrTbl ),

404 
INVALID_TASK_ID
 );

408 
ªt
 = 
bÀInvÆidR™ge
;

413 
ªt
 = 
INVALIDPARAMETER
;

417  ( 
ªt
 );

418 
	}
}

433 
bSètus_t
 
	$ProxRï‹ãr_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

435 
bSètus_t
 
ªt
 = 
SUCCESS
;

436  
∑øm
 )

438 
PP_LINK_LOSS_ALERT_LEVEL
:

439 *((
uöt8
*)
vÆue
Ë
ŒAÀπLevñ
;

442 
PP_IM_ALERT_LEVEL
:

443 *((
uöt8
*)
vÆue
Ë
imAÀπLevñ
;

446 
PP_TX_POWER_LEVEL
:

447 *((
öt8
*)
vÆue
Ë
txPwrLevñ
;

451 
ªt
 = 
INVALIDPARAMETER
;

455  ( 
ªt
 );

456 
	}
}

467 
uöt8
 
	$¥oxRï‹ãr_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

468 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

470 
uöt16
 
uuid
;

471 
bSètus_t
 
°©us
 = 
SUCCESS
;

474 i‡–
off£t
 > 0 )

476  ( 
ATT_ERR_ATTR_NOT_LONG
 );

479 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

482 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

484  
uuid
 )

488 
PROXIMITY_ALERT_LEVEL_UUID
:

489 
PROXIMITY_TX_PWR_LEVEL_UUID
:

490 *
pLí
 = 1;

491 
pVÆue
[0] = *
pAâr
->pValue;

496 *
pLí
 = 0;

497 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

504 *
pLí
 = 0;

505 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

508  ( 
°©us
 );

509 
	}
}

521 
bSètus_t
 
	$¥oxRï‹ãr_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

522 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

524 
bSètus_t
 
°©us
 = 
SUCCESS
;

525 
uöt8
 
nŸify
 = 0xFF;

527 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

530 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

531  
uuid
 )

533 
PROXIMITY_ALERT_LEVEL_UUID
:

536 i‡–
off£t
 == 0 )

538 i‡–
Àn
 > 1 )

539 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

542 i‡–
pVÆue
[0] > 
PP_ALERT_LEVEL_HIGH
 )

543 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

548 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

552 i‡–
°©us
 =
SUCCESS
 )

554 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

556 *
pCurVÆue
 = 
pVÆue
[0];

557 if–
pAâr
->
pVÆue
 =&
ŒAÀπLevñ
 )

558 
nŸify
 = 
PP_LINK_LOSS_ALERT_LEVEL
;

560 
nŸify
 = 
PP_IM_ALERT_LEVEL
;

565 
GATT_CLIENT_CHAR_CFG_UUID
:

566 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

567 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

572 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

579 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

583 i‡–(
nŸify
 !0xFFË&& 
µ_AµCBs
 &&Öp_AµCBs->
p‚AârCh™ge
 )

584 
µ_AµCBs
->
	`p‚AârCh™ge
–
nŸify
 );

586  ( 
°©us
 );

587 
	}
}

599 
	$¥oxRï‹ãr_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

602 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

605 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

606 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

607 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

609 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
txPwrLevñC⁄fig
 );

612 
	}
}

	@Projects/ble/Profiles/Proximity/proxreporter.h

40 #i‚de‡
PROXIMITYREPORTER_H


41 
	#PROXIMITYREPORTER_H


	)

43 #ifde‡
__˝lu•lus


57 
	#PP_LINK_LOSS_ALERT_LEVEL
 0

58 
	#PP_IM_ALERT_LEVEL
 1

59 
	#PP_TX_POWER_LEVEL
 2

60 

	)

62 
	#LINK_LOSS_SERVICE_UUID
 0x1803

	)

63 
	#IMMEDIATE_ALERT_SERVICE_UUID
 0x1802

	)

64 
	#TX_PWR_LEVEL_SERVICE_UUID
 0x1804

	)

67 
	#PROXIMITY_ALERT_LEVEL_UUID
 0x2A06

	)

68 
	#PROXIMITY_TX_PWR_LEVEL_UUID
 0x2A07

	)

71 
	#PP_ALERT_LEVEL_NO
 0x00

	)

72 
	#PP_ALERT_LEVEL_LOW
 0x01

	)

73 
	#PP_ALERT_LEVEL_HIGH
 0x02

	)

76 
	#PP_LINK_LOSS_SERVICE
 0x00000001

77 
	#PP_IM_ALETR_SERVICE
 0x00000002

78 
	#PP_TX_PWR_LEVEL_SERVICE
 0x00000004

79 

	)

94 
NULL_OK
 (*
	tµAârCh™ge_t
)–
	tuöt8
 
	t©åP¨amID
 );

98 
µAârCh™ge_t
 
p‚AârCh™ge
;

99 } 
	t¥oxRï‹ãrCBs_t
;

113 
bSètus_t
 
ProxRï‹ãr_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

121 
bSètus_t
 
ProxRï‹ãr_Regi°îAµCBs
–
¥oxRï‹ãrCBs_t
 *
≠pCÆlbacks
 );

134 
bSètus_t
 
ProxRï‹ãr_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

145 
bSètus_t
 
ProxRï‹ãr_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

150 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/RSC/runningservice.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"lökdb.h
"

47 
	~"©t.h
"

48 
	~"g©t.h
"

49 
	~"g©t_uuid.h
"

50 
	~"g©t£rv≠p.h
"

51 
	~"ru¬ög£rvi˚.h
"

62 
	#RSC_CMD_IND_SEND_EVT
 0x0001

	)

64 
	#RSC_MEAS_VALUE_POS
 2

	)

65 
	#RSC_MEAS_CFG_POS
 3

	)

66 
	#RSC_COMMAND_VALUE_POS
 9

	)

67 
	#RSC_COMMAND_CFG_POS
 10

	)

68 
	#COMMAND_IND_LENGTH
 2

	)

79 
CONST
 
uöt8
 
	gru¬ögSîvUUID
[
ATT_BT_UUID_SIZE
] =

81 
LO_UINT16
(
RSC_SERV_UUID
), 
HI_UINT16
(RSC_SERV_UUID)

85 
CONST
 
uöt8
 
	gru¬ögMósUUID
[
ATT_BT_UUID_SIZE
] =

87 
LO_UINT16
(
RSC_MEAS_UUID
), 
HI_UINT16
(RSC_MEAS_UUID)

91 
CONST
 
uöt8
 
	gru¬ögFótuªUUID
[
ATT_BT_UUID_SIZE
] =

93 
LO_UINT16
(
RSC_FEATURE_UUID
), 
HI_UINT16
(RSC_FEATURE_UUID)

97 
CONST
 
uöt8
 
	gru¬ögSísLocUUID
[
ATT_BT_UUID_SIZE
] =

99 
LO_UINT16
(
RSC_SENS_LOC_UUID
), 
HI_UINT16
(RSC_SENS_LOC_UUID)

103 
CONST
 
uöt8
 
	gru¬ögComm™dUUID
[
ATT_BT_UUID_SIZE
] =

105 
LO_UINT16
(
RSC_COMMAND_UUID
), 
HI_UINT16
(RSC_COMMAND_UUID)

120 
ru¬ögSîvi˚CB_t
 
	gru¬ögSîvi˚CB
 = 
NULL
;

122 
uöt8
 
	gsuµ‹ãdSís‹s
 = 0;

123 
boﬁ
 
	gscOpInProgªss
 = 
FALSE
;

126 
uöt16
 
	gc⁄√˘i⁄H™dÀ
;

127 
©tH™dÀVÆueInd_t
 
	grscCmdInd
;

134 
uöt8
 
	gru¬ögSîvi˚_TaskID
 = 0;

137 
CONST
 
g©tAârTy≥_t
 
	gru¬ögSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
ru¬ögSîvUUID
 };

140 
uöt8
 
	gsuµ‹ãdSís‹Loˇti⁄s
[
RSC_MAX_SENSOR_LOCS
] = { 
RSC_NO_SENSOR_LOC
 };

144 
uöt8
 
	gru¬ögMósPr›s
 = 
GATT_PROP_NOTIFY
;

145 
uöt8
 
	gru¬ögMós
 = 0;

146 
g©tCh¨Cfg_t
 
	gru¬ögMósClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

149 
uöt8
 
	gru¬ögFótuªPr›s
 = 
GATT_PROP_READ
;

150 
uöt16
 
	gru¬ögFótuªs
 = 
RSC_NO_SUPPORT
;

153 
uöt8
 
	gru¬ögSísLocPr›s
 = 
GATT_PROP_READ
;

154 
uöt8
 
	gru¬ögSísLoc
 = 
RSC_NO_SENSOR_LOC
;

157 
uöt8
 
	gru¬ögComm™dPr›s
 = 
GATT_PROP_WRITE
 | 
GATT_PROP_INDICATE
;

158 
uöt8
 
	gru¬ögComm™d
 = 0;

159 
g©tCh¨Cfg_t
 
	gru¬ögComm™dClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

165 
g©tAâribuã_t
 
	gru¬ögAârTbl
[] =

169 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

170 
GATT_PERMIT_READ
,

172 (
uöt8
 *)&
ru¬ögSîvi˚


177 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

178 
GATT_PERMIT_READ
,

180 &
ru¬ögMósPr›s


185 { 
ATT_BT_UUID_SIZE
, 
ru¬ögMósUUID
 },

188 &
ru¬ögMós


193 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

194 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

196 (
uöt8
 *Ë&
ru¬ögMósClõ¡Ch¨Cfg


201 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

202 
GATT_PERMIT_READ
,

204 &
ru¬ögFótuªPr›s


209 { 
ATT_BT_UUID_SIZE
, 
ru¬ögFótuªUUID
 },

210 
GATT_PERMIT_READ
,

212 (
uöt8
 *)&
ru¬ögFótuªs


217 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

218 
GATT_PERMIT_READ
,

220 &
ru¬ögSísLocPr›s


225 { 
ATT_BT_UUID_SIZE
, 
ru¬ögSísLocUUID
 },

226 
GATT_PERMIT_READ
,

228 &
ru¬ögSísLoc


233 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

234 
GATT_PERMIT_READ
,

236 &
ru¬ögComm™dPr›s


241 { 
ATT_BT_UUID_SIZE
, 
ru¬ögComm™dUUID
 },

242 
GATT_PERMIT_WRITE
,

244 &
ru¬ögComm™d


249 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

250 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

252 (
uöt8
 *Ë&
ru¬ögComm™dClõ¡Ch¨Cfg


260 
uöt8
 
ru¬ög_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

261 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

262 
bSètus_t
 
ru¬ög_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

263 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

265 
ru¬ög_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

266 
ru¬ög_Pro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 );

267 
boﬁ
 
ru¬ög_Sís‹LocSuµ‹ãd
–
uöt8
 
£ns‹Loc
 );

268 
ru¬ög_Pro˚ssRSCCmd
–
uöt16
 
©åH™dÀ
, 
uöt8
 *
pVÆue
, uöt8 
Àn
 );

275 
CONST
 
g©tSîvi˚CBs_t
 
	gru¬ögCBs
 =

277 
ru¬ög_RódAârCB
,

278 
ru¬ög_WrôeAârCB
,

279 
NULL


295 
	$Ru¬ögSîvi˚_Inô
–
uöt8
 
èsk_id
 )

298 
ru¬ögSîvi˚_TaskID
 = 
èsk_id
;

299 
	}
}

312 
uöt16
 
	$Ru¬ögSîvi˚_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

314 
VOID
 
èsk_id
;

316 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

318 
uöt8
 *
pMsg
;

320 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
ru¬ögSîvi˚_TaskID
 )Ë!
NULL
 )

322 
	`ru¬ög_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

325 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

329  (
evíts
 ^ 
SYS_EVENT_MSG
);

332 i‡–
evíts
 & 
RSC_CMD_IND_SEND_EVT
 )

334 
	`GATT_Indiˇti⁄
–
c⁄√˘i⁄H™dÀ
, &
rscCmdInd
, 
FALSE
, 
ru¬ögSîvi˚_TaskID
 );

337 
scOpInProgªss
 = 
FALSE
;

339  ( 
evíts
 ^ 
RSC_CMD_IND_SEND_EVT
 );

343 
	}
}

354 
	$ru¬ög_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

356  
pMsg
->
evít
 )

358 
GATT_MSG_EVENT
:

359 
	`ru¬ög_Pro˚ssGATTMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

365 
	}
}

376 
	$ru¬ög_Pro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 )

378 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_CFM
 )

383 
	}
}

394 
boﬁ
 
	$ru¬ög_Sís‹LocSuµ‹ãd
–
uöt8
 
£ns‹Loc
 )

396 
uöt8
 
i
;

398 
i
 = 0; i < 
suµ‹ãdSís‹s
; i++)

400 i‡(
suµ‹ãdSís‹Loˇti⁄s
[
i
] =
£ns‹Loc
)

402  
TRUE
;

406  
FALSE
;

407 
	}
}

420 
bSètus_t
 
	$Ru¬ög_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

422 
uöt8
 
°©us
 = 
SUCCESS
;

425 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ru¬ögMósClõ¡Ch¨Cfg
 );

426 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ru¬ögComm™dClõ¡Ch¨Cfg
);

428 i‡–
£rvi˚s
 & 
RUNNING_SERVICE
 )

431 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
ru¬ögAârTbl
,

432 
	`GATT_NUM_ATTRS
–
ru¬ögAârTbl
 ),

433 &
ru¬ögCBs
 );

436  ( 
°©us
 );

437 
	}
}

448 
	$Ru¬ög_Regi°î
–
ru¬ögSîvi˚CB_t
 
p‚Sîvi˚CB
 )

450 
ru¬ögSîvi˚CB
 = 
p‚Sîvi˚CB
;

451 
	}
}

467 
bSètus_t
 
	$Ru¬ög_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
pVÆue
 )

469 
bSètus_t
 
ªt
 = 
SUCCESS
;

471  
∑øm
 )

473 
RSC_SENS_LOC
:

475 
ru¬ögSísLoc
 = *((
uöt8
*)
pVÆue
);

479 
RSC_FEATURE
:

481 
ru¬ögFótuªs
 = *((
uöt16
*)
pVÆue
);

485 
RSC_AVAIL_SENS_LOCS
:

486 i‡–
suµ‹ãdSís‹s
 < 
RSC_MAX_SENSOR_LOCS
 )

488 
suµ‹ãdSís‹Loˇti⁄s
[
suµ‹ãdSís‹s
++] = *((
uöt8
*)
pVÆue
);

493 
ªt
 = 
INVALIDPARAMETER
;

497  ( 
ªt
 );

498 
	}
}

513 
bSètus_t
 
	$Ru¬ög_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

515 
bSètus_t
 
ªt
 = 
SUCCESS
;

517  
∑øm
 )

519 
RSC_FEATURE
:

520 *((
uöt16
*)
vÆue
Ë
ru¬ögFótuªs
;

523 
RSC_SENS_LOC
:

524 *((
uöt8
*)
vÆue
Ë
ru¬ögSísLoc
;

527 
RSC_COMMAND
:

528 *((
uöt8
*)
vÆue
Ë
ru¬ögComm™d
;

532 
ªt
 = 
INVALIDPARAMETER
;

536  ( 
ªt
 );

537 
	}
}

550 
bSètus_t
 
	$Ru¬ög_MósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
 )

552 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
ru¬ögMósClõ¡Ch¨Cfg
 );

555 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

558 
pNŸi
->
h™dÀ
 = 
ru¬ögAârTbl
[
RSC_MEAS_VALUE_POS
].handle;

561  
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
 );

564  
bÀInc‹ª˘Mode
;

565 
	}
}

578 
	$ru¬ög_Pro˚ssRSCCmd
–
uöt16
 
©åH™dÀ
, 
uöt8
 *
pVÆue
, uöt8 
Àn
 )

580 
uöt8
 
rscSètus
 = 
RSC_SUCCESS
;

583 
scOpInProgªss
 = 
TRUE
;

586 
rscCmdInd
.
h™dÀ
 = 
©åH™dÀ
;

588 
rscCmdInd
.
Àn
 = 3;

589 
rscCmdInd
.
vÆue
[0] = 
RSC_COMMAND_RSP
;

590 
rscCmdInd
.
vÆue
[1] = 
pVÆue
[0];

592  
pVÆue
[0] )

594 
RSC_SET_CUMM_VAL
:

596 i‡––
Àn
 <5 ) && ( 
ru¬ögFótuªs
 & 
RSC_TOTAL_DIST_SUPP
 ) )

598 
uöt32
 
tŸÆDi°™˚
;

601 i‡––
Àn
 - 1 ) == 4 )

603 
tŸÆDi°™˚
 = 
	`BUILD_UINT32
–
pVÆue
[1],ÖValue[2],ÖValue[3],ÖValue[4]);

607 
tŸÆDi°™˚
 = 0;

610  
i
 = 0; i < (
Àn
 - 1); ++i )

612 
tŸÆDi°™˚
 +
pVÆue
[
i
 + 1] << (i*8);

617 i‡–
ru¬ögSîvi˚CB
 !
NULL
 )

619 
	`VOID
 (*
ru¬ögSîvi˚CB
)–
RSC_CMD_SET_CUMM_VAL
, &
tŸÆDi°™˚
 );

624 
rscSètus
 = 
RSC_INVALID_PARAMETER
;

628 
RSC_START_SENS_CALIB
:

630 i‡––
Àn
 =1 ) && ( 
ru¬ögFótuªs
 & 
RSC_SENSOR_CALIB_SUPP
 ) )

633 i‡–
ru¬ögSîvi˚CB
 !
NULL
 )

635 i‡–(*
ru¬ögSîvi˚CB
)–
RSC_CMD_START_SENS_CALIB
, 
NULL
 ) !
SUCCESS
 )

638 
rscSètus
 = 
RSC_OPERATION_FAILED
;

645 
rscSètus
 = 
RSC_INVALID_PARAMETER
;

649 
RSC_UPDATE_SENS_LOC
:

651 i‡––
Àn
 == 2 ) &&

652 –
ru¬ögFótuªs
 & 
RSC_MULTI_SENS_SUPP
 ) &&

653 –
	`ru¬ög_Sís‹LocSuµ‹ãd
–
pVÆue
[1] ) =
TRUE
 ) )

656 
ru¬ögSísLoc
 = 
pVÆue
[1];

659 i‡–
ru¬ögSîvi˚CB
 !
NULL
 )

661 
	`VOID
 (*
ru¬ögSîvi˚CB
)–
RSC_CMD_UPDATE_SENS_LOC
, 
NULL
 );

666 
rscSètus
 = 
RSC_INVALID_PARAMETER
;

670 
RSC_REQ_SUPP_SENS_LOC
:

672 i‡––
Àn
 =1 ) && ( 
ru¬ögFótuªs
 & 
RSC_MULTI_SENS_SUPP
 ) )

674 
rscCmdInd
.
Àn
 +
suµ‹ãdSís‹s
;

675 
	`oßl_mem˝y
–&(
rscCmdInd
.
vÆue
[3]), 
suµ‹ãdSís‹Loˇti⁄s
, 
suµ‹ãdSís‹s
 );

680 
rscSètus
 = 
RSC_INVALID_PARAMETER
;

686 
rscSètus
 = 
RSC_OPCODE_NOT_SUPPORTED
;

691 
rscCmdInd
.
vÆue
[2] = 
rscSètus
;

694 
	`oßl_£t_evít
–
ru¬ögSîvi˚_TaskID
, 
RSC_CMD_IND_SEND_EVT
 );

695 
	}
}

707 
	$Ru¬ög_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

710 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

713 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

714 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

715 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

717 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ru¬ögMósClõ¡Ch¨Cfg
 );

718 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ru¬ögComm™dClõ¡Ch¨Cfg
 );

721 
	}
}

737 
uöt8
 
	$ru¬ög_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

738 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

740 
bSètus_t
 
°©us
 = 
SUCCESS
;

743 i‡–
off£t
 > 0 )

745  ( 
ATT_ERR_ATTR_NOT_LONG
 );

748 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

750  
uuid
 )

753 
RSC_SENS_LOC_UUID
:

755 *
pLí
 = 1;

756 
pVÆue
[0] = *
pAâr
->pValue;

761 
RSC_FEATURE_UUID
:

763 *
pLí
 = 2;

764 
pVÆue
[0] = 
	`LO_UINT16
–
ru¬ögFótuªs
 );

765 
pVÆue
[1] = 
	`HI_UINT16
–
ru¬ögFótuªs
 );

770 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

775 i‡–
ru¬ögSîvi˚CB
 !
NULL
 )

777 
	`VOID
 (*
ru¬ögSîvi˚CB
)–
RSC_READ_ATTR
, 
NULL
 );

780  ( 
°©us
 );

781 
	}
}

796 
bSètus_t
 
	$ru¬ög_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

797 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

799 
bSètus_t
 
°©us
 = 
SUCCESS
;

800 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

802 i‡–
off£t
 > 0 )

804  (
ATT_ERR_ATTR_NOT_LONG
);

807  
uuid
 )

809 
RSC_COMMAND_UUID
:

811 i‡–
scOpInProgªss
 =
TRUE
 )

813 
°©us
 = 
RSC_ERR_PROC_IN_PROGRESS
;

816 i‡–(
ru¬ögComm™dClõ¡Ch¨Cfg
[
c⁄nH™dÀ
].
vÆue
 & 
GATT_CLIENT_CFG_INDICATE
Ë=
FALSE
 )

818 
°©us
 = 
RSC_ERR_CCC_IMPROPER_CFG
;

823 
	`ru¬ög_Pro˚ssRSCCmd
–
pAâr
->
h™dÀ
, 
pVÆue
, 
Àn
 );

824 
c⁄√˘i⁄H™dÀ
 = 
c⁄nH™dÀ
;

829 
GATT_CLIENT_CHAR_CFG_UUID
:

830 i‡–
pAâr
->
h™dÀ
 =
ru¬ögAârTbl
[
RSC_COMMAND_CFG_POS
].handle )

832 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

833 
off£t
, 
GATT_CLIENT_CFG_INDICATE
 );

835 i‡–
ru¬ögSîvi˚CB
 !
NULL
 )

837 
	`VOID
 (*
ru¬ögSîvi˚CB
)–
RSC_WRITE_ATTR
, 
NULL
 );

840 i‡–
pAâr
->
h™dÀ
 =
ru¬ögAârTbl
[
RSC_MEAS_CFG_POS
].handle )

842 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

843 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

844 i‡–
°©us
 =
SUCCESS
 )

847 i‡–
ru¬ögSîvi˚CB
 !
NULL
 )

849 
uöt16
 
ch¨Cfg
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

851 
	`VOID
 (*
ru¬ögSîvi˚CB
)–((
ch¨Cfg
 =
GATT_CFG_NO_OPERATION
) ?

852 
RSC_MEAS_NOTI_DISABLED
 :

853 
RSC_MEAS_NOTI_ENABLED
 ), 
NULL
 );

860 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

864  ( 
°©us
 );

865 
	}
}

	@Projects/ble/Profiles/RSC/runningservice.h

40 #i‚de‡
RUNNINGSERVICE_H


41 
	#RUNNINGSERVICE_H


	)

43 #ifde‡
__˝lu•lus


56 
	#RUNNING_SERVICE
 0x00000001

	)

59 
	#RSC_ERR_PROC_IN_PROGRESS
 0x80

	)

60 
	#RSC_ERR_CCC_IMPROPER_CFG
 0x81

	)

62 
	#RSC_SUCCESS
 1

	)

63 
	#RSC_OPCODE_NOT_SUPPORTED
 2

	)

64 
	#RSC_INVALID_PARAMETER
 3

	)

65 
	#RSC_OPERATION_FAILED
 4

	)

68 
	#RSC_MEAS
 1

	)

69 
	#RSC_MEAS_CHAR_CFG
 2

	)

70 
	#RSC_FEATURE
 3

	)

71 
	#RSC_SENS_LOC
 4

	)

72 
	#RSC_COMMAND
 5

	)

73 
	#RSC_COMMAND_CHAR_CFG
 6

	)

74 
	#RSC_AVAIL_SENS_LOCS
 7

	)

77 
	#RSC_SERV_UUID
 0x1814

	)

78 
	#RSC_MEAS_UUID
 0x2A53

	)

79 
	#RSC_FEATURE_UUID
 0x2A54

	)

80 
	#RSC_SENS_LOC_UUID
 0x2A5D

	)

81 
	#RSC_COMMAND_UUID
 0x2A55

	)

84 
	#RSC_INST_STRIDE_PRESENT
 0x01

	)

85 
	#RSC_TOTAL_DIST_PRESENT
 0x02

	)

86 
	#RSC_WALKING_OR_RUNNING
 0x04

	)

89 
	#RSC_NO_SUPPORT
 0x00

	)

90 
	#RSC_STRIDE_SUPP
 0x01

	)

91 
	#RSC_TOTAL_DIST_SUPP
 0x02

	)

92 
	#RSC_WALKING_RUNNING_SUPP
 0x04

	)

93 
	#RSC_SENSOR_CALIB_SUPP
 0x08

	)

94 
	#RSC_MULTI_SENS_SUPP
 0x10

	)

95 
	#RSC_FULL_SUPPORT
 0x1F

	)

98 
	#RSC_NO_SENSOR_LOC
 0x00

	)

99 
	#RSC_SENSOR_LOC_0
 0x01

	)

100 
	#RSC_SENSOR_LOC_1
 0x02

	)

101 
	#RSC_SENSOR_LOC_2
 0x04

	)

102 
	#RSC_SENSOR_LOC_3
 0x08

	)

103 
	#RSC_ALL_SENSORS
 0xFF

	)

106 
	#RSC_MAX_SENSOR_LOCS
 8

	)

109 
	#RSC_SET_CUMM_VAL
 1

	)

110 
	#RSC_START_SENS_CALIB
 2

	)

111 
	#RSC_UPDATE_SENS_LOC
 3

	)

112 
	#RSC_REQ_SUPP_SENS_LOC
 4

	)

113 
	#RSC_COMMAND_RSP
 16

	)

116 
	#RSC_FLAGS_AT_REST
 0x00

	)

117 
	#RSC_FLAGS_STRIDE
 0x01

	)

118 
	#RSC_FLAGS_DIST
 0x02

	)

119 
	#RSC_FLAGS_ALL
 0x03

	)

122 
	#DEFAULT_NOTI_INTERVAL
 1000

123 

	)

124 
	#VALUE_ROLL_OVER
 64000

125 

	)

127 
	#RSC_CMD_SET_CUMM_VAL
 1

	)

128 
	#RSC_CMD_START_SENS_CALIB
 2

	)

129 
	#RSC_CMD_UPDATE_SENS_LOC
 3

	)

130 
	#RSC_MEAS_NOTI_ENABLED
 4

	)

131 
	#RSC_MEAS_NOTI_DISABLED
 5

	)

132 
	#RSC_READ_ATTR
 6

	)

133 
	#RSC_WRITE_ATTR
 7

	)

140 
bSètus_t
 (*
	tru¬ögSîvi˚CB_t
)(
	tuöt8
 
	tevít
, 
	tuöt32
 *
	tpNewCummVÆ
);

163 
Ru¬ögSîvi˚_Inô
–
uöt8
 
èsk_id
 );

176 
uöt16
 
Ru¬ögSîvi˚_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

188 
bSètus_t
 
Ru¬ög_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

200 
Ru¬ög_Regi°î
–
ru¬ögSîvi˚CB_t
 
p‚Sîvi˚CB
 );

216 
bSètus_t
 
Ru¬ög_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

231 
bSètus_t
 
Ru¬ög_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

244 
bSètus_t
 
Ru¬ög_MósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
 );

256 
Ru¬ög_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

261 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Roles/broadcaster.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"hci_é.h
"

47 
	~"g≠.h
"

49 
	~"brﬂdˇ°î.h
"

59 
	#START_ADVERTISING_EVT
 0x0001

	)

61 
	#DEFAULT_ADVERT_OFF_TIME
 30000

62 

	)

82 
uöt8
 
	gg≠Rﬁe_TaskID
;

84 
g≠rﬁe_Sèãs_t
 
	gg≠Rﬁe_°©e
;

91 
uöt8
 
	gg≠Rﬁe_¥ofûeRﬁe
;

92 
uöt8
 
	gg≠Rﬁe_bdAddr
[
B_ADDR_LEN
];

93 
uöt8
 
	gg≠Rﬁe_AdvE«bÀd
 = 
TRUE
;

94 
uöt16
 
	gg≠Rﬁe_AdvîtOffTime
 = 
DEFAULT_ADVERT_OFF_TIME
;

95 
uöt8
 
	gg≠Rﬁe_AdvîtD©aLí
 = 3;

96 
uöt8
 
	gg≠Rﬁe_AdvîtD©a
[
B_MAX_ADV_LEN
] =

99 
GAP_ADTYPE_FLAGS
,

101 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

104 
uöt8
 
	gg≠Rﬁe_SˇnR•D©aLí
 = 0;

105 
uöt8
 
	gg≠Rﬁe_SˇnR•D©a
[
B_MAX_ADV_LEN
] = {0};

106 
uöt8
 
	gg≠Rﬁe_AdvEvítTy≥
;

107 
uöt8
 
	gg≠Rﬁe_AdvDúe˘Ty≥
;

108 
uöt8
 
	gg≠Rﬁe_AdvDúe˘Addr
[
B_ADDR_LEN
] = {0};

109 
uöt8
 
	gg≠Rﬁe_AdvCh™M≠
;

110 
uöt8
 
	gg≠Rﬁe_AdvFûãrPﬁicy
;

113 
g≠RﬁesCBs_t
 *
	gpG≠Rﬁes_AµCGs
 = 
NULL
;

126 
g≠Rﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

127 
g≠Rﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 );

128 
g≠Rﬁe_SëupGAP
( );

143 
bSètus_t
 
	$GAPRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 )

145 
bSètus_t
 
ªt
 = 
SUCCESS
;

146  
∑øm
 )

148 
GAPROLE_ADVERT_ENABLED
:

149 i‡–
Àn
 =–
uöt8
 ) )

151 
uöt8
 
ﬁdAdvE«bÀd
 = 
g≠Rﬁe_AdvE«bÀd
;

152 
g≠Rﬁe_AdvE«bÀd
 = *((
uöt8
*)
pVÆue
);

154 i‡–(
ﬁdAdvE«bÀd
Ë&& (
g≠Rﬁe_AdvE«bÀd
 =
FALSE
) )

157 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_ADVERTISING
 )

159 
VOID
 
	`GAP_EndDiscovîabÀ
–
g≠Rﬁe_TaskID
 );

162 i‡–(
ﬁdAdvE«bÀd
 =
FALSE
Ë&& (
g≠Rﬁe_AdvE«bÀd
) )

165 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_STARTED
)

166 || (
g≠Rﬁe_°©e
 =
GAPROLE_WAITING
) )

168 
VOID
 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

174 
ªt
 = 
bÀInvÆidR™ge
;

178 
GAPROLE_ADVERT_OFF_TIME
:

179 i‡–
Àn
 = ( 
uöt16
 ) )

181 
g≠Rﬁe_AdvîtOffTime
 = *((
uöt16
*)
pVÆue
);

185 
ªt
 = 
bÀInvÆidR™ge
;

189 
GAPROLE_ADVERT_DATA
:

190 i‡–
Àn
 <
B_MAX_ADV_LEN
 )

192 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_AdvîtD©a
, 0, 
B_MAX_ADV_LEN
 );

193 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_AdvîtD©a
, 
pVÆue
, 
Àn
 );

194 
g≠Rﬁe_AdvîtD©aLí
 = 
Àn
;

198 
ªt
 = 
bÀInvÆidR™ge
;

202 
GAPROLE_SCAN_RSP_DATA
:

203 i‡–
Àn
 <
B_MAX_ADV_LEN
 )

205 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_SˇnR•D©a
, 0, 
B_MAX_ADV_LEN
 );

206 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_SˇnR•D©a
, 
pVÆue
, 
Àn
 );

207 
g≠Rﬁe_SˇnR•D©aLí
 = 
Àn
;

211 
ªt
 = 
bÀInvÆidR™ge
;

215 
GAPROLE_ADV_EVENT_TYPE
:

216 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAP_ADTYPE_ADV_NONCONN_IND
) )

218 
g≠Rﬁe_AdvEvítTy≥
 = *((
uöt8
*)
pVÆue
);

222 
ªt
 = 
bÀInvÆidR™ge
;

226 
GAPROLE_ADV_DIRECT_TYPE
:

227 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
ADDRTYPE_PRIVATE_RESOLVE
) )

229 
g≠Rﬁe_AdvDúe˘Ty≥
 = *((
uöt8
*)
pVÆue
);

233 
ªt
 = 
bÀInvÆidR™ge
;

237 
GAPROLE_ADV_DIRECT_ADDR
:

238 i‡–
Àn
 =
B_ADDR_LEN
 )

240 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_AdvDúe˘Addr
, 
pVÆue
, 
B_ADDR_LEN
 ) ;

244 
ªt
 = 
bÀInvÆidR™ge
;

248 
GAPROLE_ADV_CHANNEL_MAP
:

249 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
) <= 0x07) )

251 
g≠Rﬁe_AdvCh™M≠
 = *((
uöt8
*)
pVÆue
);

255 
ªt
 = 
bÀInvÆidR™ge
;

259 
GAPROLE_ADV_FILTER_POLICY
:

260 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAP_FILTER_POLICY_WHITE
) )

262 
g≠Rﬁe_AdvFûãrPﬁicy
 = *((
uöt8
*)
pVÆue
);

266 
ªt
 = 
bÀInvÆidR™ge
;

272 i‡–(
∑øm
 < 
TGAP_PARAMID_MAX
Ë&& (
Àn
 = ( 
uöt16
 )) )

274 
ªt
 = 
	`GAP_SëP¨amVÆue
–
∑øm
, *((
uöt16
*)
pVÆue
) );

278 
ªt
 = 
INVALIDPARAMETER
;

283  ( 
ªt
 );

284 
	}
}

291 
bSètus_t
 
	$GAPRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 )

293 
bSètus_t
 
ªt
 = 
SUCCESS
;

294  
∑øm
 )

296 
GAPROLE_PROFILEROLE
:

297 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_¥ofûeRﬁe
;

300 
GAPROLE_BD_ADDR
:

301 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_bdAddr
, 
B_ADDR_LEN
 ) ;

304 
GAPROLE_ADVERT_ENABLED
:

305 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvE«bÀd
;

308 
GAPROLE_ADVERT_OFF_TIME
:

309 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_AdvîtOffTime
;

312 
GAPROLE_ADVERT_DATA
:

313 
VOID
 
	`oßl_mem˝y
–
pVÆue
 , 
g≠Rﬁe_AdvîtD©a
, 
g≠Rﬁe_AdvîtD©aLí
 );

316 
GAPROLE_SCAN_RSP_DATA
:

317 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_SˇnR•D©a
, 
g≠Rﬁe_SˇnR•D©aLí
 ) ;

320 
GAPROLE_ADV_EVENT_TYPE
:

321 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvEvítTy≥
;

324 
GAPROLE_ADV_DIRECT_TYPE
:

325 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvDúe˘Ty≥
;

328 
GAPROLE_ADV_DIRECT_ADDR
:

329 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_AdvDúe˘Addr
, 
B_ADDR_LEN
 ) ;

332 
GAPROLE_ADV_CHANNEL_MAP
:

333 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvCh™M≠
;

336 
GAPROLE_ADV_FILTER_POLICY
:

337 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvFûãrPﬁicy
;

342 i‡–
∑øm
 < 
TGAP_PARAMID_MAX
 )

344 *((
uöt16
*)
pVÆue
Ë
	`GAP_GëP¨amVÆue
–
∑øm
 );

348 
ªt
 = 
INVALIDPARAMETER
;

353  ( 
ªt
 );

354 
	}
}

361 
bSètus_t
 
	$GAPRﬁe_SèπDevi˚
–
g≠RﬁesCBs_t
 *
pAµCÆlbacks
 )

363 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_INIT
 )

366 i‡–
pAµCÆlbacks
 )

368 
pG≠Rﬁes_AµCGs
 = 
pAµCÆlbacks
;

372 
	`g≠Rﬁe_SëupGAP
();

374  ( 
SUCCESS
 );

378  ( 
bÀAÃódyInReque°edMode
 );

380 
	}
}

391 
	$GAPRﬁe_Inô
–
uöt8
 
èsk_id
 )

393 
g≠Rﬁe_TaskID
 = 
èsk_id
;

395 
g≠Rﬁe_°©e
 = 
GAPROLE_INIT
;

397 
	`GAP_Regi°îF‹HCIMsgs
–
g≠Rﬁe_TaskID
 );

400 
g≠Rﬁe_¥ofûeRﬁe
 = 
GAP_PROFILE_BROADCASTER
;

402 
g≠Rﬁe_AdvEvítTy≥
 = 
GAP_ADTYPE_ADV_NONCONN_IND
;

403 
g≠Rﬁe_AdvDúe˘Ty≥
 = 
ADDRTYPE_PUBLIC
;

404 
g≠Rﬁe_AdvCh™M≠
 = 
GAP_ADVCHAN_ALL
;

405 
g≠Rﬁe_AdvFûãrPﬁicy
 = 
GAP_FILTER_POLICY_ALL
;

406 
	}
}

413 
uöt16
 
	$GAPRﬁe_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

415 
VOID
 
èsk_id
;

417 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

419 
uöt8
 *
pMsg
;

421 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
g≠Rﬁe_TaskID
 )Ë!
NULL
 )

423 
	`g≠Rﬁe_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

426 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

430  (
evíts
 ^ 
SYS_EVENT_MSG
);

433 i‡–
evíts
 & 
START_ADVERTISING_EVT
 )

435 i‡–
g≠Rﬁe_AdvE«bÀd
 )

437 
g≠AdvîtisögP¨ams_t
 
∑øms
;

440 
∑øms
.
evítTy≥
 = 
g≠Rﬁe_AdvEvítTy≥
;

441 
∑øms
.
öôüt‹AddrTy≥
 = 
g≠Rﬁe_AdvDúe˘Ty≥
;

442 
VOID
 
	`oßl_mem˝y
–
∑øms
.
öôüt‹Addr
, 
g≠Rﬁe_AdvDúe˘Addr
, 
B_ADDR_LEN
 );

443 
∑øms
.
ch™√lM≠
 = 
g≠Rﬁe_AdvCh™M≠
;

444 
∑øms
.
fûãrPﬁicy
 = 
g≠Rﬁe_AdvFûãrPﬁicy
;

446 i‡–
	`GAP_MakeDiscovîabÀ
–
g≠Rﬁe_TaskID
, &
∑øms
 ) !
SUCCESS
 )

448 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

449 i‡–
pG≠Rﬁes_AµCGs
 &&ÖG≠Rﬁes_AµCGs->
p‚SèãCh™ge
 )

451 
pG≠Rﬁes_AµCGs
->
	`p‚SèãCh™ge
–
g≠Rﬁe_°©e
 );

456  ( 
evíts
 ^ 
START_ADVERTISING_EVT
 );

461 
	}
}

472 
	$g≠Rﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

474  
pMsg
->
evít
 )

476 
HCI_GAP_EVENT_EVENT
:

477 i‡–
pMsg
->
°©us
 =
HCI_COMMAND_COMPLETE_EVENT_CODE
 )

483 
GAP_MSG_EVENT
:

484 
	`g≠Rﬁe_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

490 
	}
}

501 
	$g≠Rﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 )

503 
uöt8
 
nŸify
 = 
FALSE
;

505  
pMsg
->
›code
 )

507 
GAP_DEVICE_INIT_DONE_EVENT
:

509 
g≠Devi˚InôD⁄eEvít_t
 *
pPkt
 = (g≠Devi˚InôD⁄eEvít_à*)
pMsg
;

510 
bSètus_t
 
°©
 = 
pPkt
->
hdr
.
°©us
;

512 i‡–
°©
 =
SUCCESS
 )

515 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_bdAddr
, 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

517 
g≠Rﬁe_°©e
 = 
GAPROLE_STARTED
;

520 
°©
 = 
	`GAP_Upd©eAdvîtisögD©a
–
g≠Rﬁe_TaskID
, 
TRUE
,

521 
g≠Rﬁe_AdvîtD©aLí
,

522 
g≠Rﬁe_AdvîtD©a
 );

525 i‡–
°©
 !
SUCCESS
 )

527 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

530 
nŸify
 = 
TRUE
;

534 
GAP_ADV_DATA_UPDATE_DONE_EVENT
:

536 
g≠AdvD©aUpd©eEvít_t
 *
pPkt
 = (g≠AdvD©aUpd©eEvít_à*)
pMsg
;

538 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

540 i‡–
pPkt
->
adTy≥
 )

543 
pPkt
->
hdr
.
°©us
 = 
	`GAP_Upd©eAdvîtisögD©a
–
g≠Rﬁe_TaskID
,

544 
FALSE
, 
g≠Rﬁe_SˇnR•D©aLí
, 
g≠Rﬁe_SˇnR•D©a
 );

549 
VOID
 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

553 i‡–
pPkt
->
hdr
.
°©us
 !
SUCCESS
 )

556 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

557 
nŸify
 = 
TRUE
;

562 
GAP_MAKE_DISCOVERABLE_DONE_EVENT
:

563 
GAP_END_DISCOVERABLE_DONE_EVENT
:

565 
g≠MakeDiscovîabÀR•Evít_t
 *
pPkt
 = (g≠MakeDiscovîabÀR•Evít_à*)
pMsg
;

567 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

569 i‡–
pMsg
->
›code
 =
GAP_MAKE_DISCOVERABLE_DONE_EVENT
 )

571 
g≠Rﬁe_°©e
 = 
GAPROLE_ADVERTISING
;

576 i‡–
g≠Rﬁe_AdvîtOffTime
 != 0 )

578 i‡––
g≠Rﬁe_AdvE«bÀd
 ) )

580 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
, 
g≠Rﬁe_AdvîtOffTime
 );

589 
g≠Rﬁe_AdvE«bÀd
 = 
FALSE
;

593 
g≠Rﬁe_°©e
 = 
GAPROLE_WAITING
;

599 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

601 
nŸify
 = 
TRUE
;

609 i‡–
nŸify
 =
TRUE
 )

612 i‡–
pG≠Rﬁes_AµCGs
 &&ÖG≠Rﬁes_AµCGs->
p‚SèãCh™ge
 )

614 
pG≠Rﬁes_AµCGs
->
	`p‚SèãCh™ge
–
g≠Rﬁe_°©e
 );

617 
	}
}

629 
	$g≠Rﬁe_SëupGAP
( )

631 
VOID
 
	`GAP_Devi˚Inô
–
g≠Rﬁe_TaskID
,

632 
g≠Rﬁe_¥ofûeRﬁe
, 0,

633 
NULL
, NULL, NULL );

634 
	}
}

	@Projects/ble/Profiles/Roles/broadcaster.h

41 #i‚de‡
BROADCASTER_H


42 
	#BROADCASTER_H


	)

44 #ifde‡
__˝lu•lus


60 
	#GAPROLE_PROFILEROLE
 0x300

61 
	#GAPROLE_BD_ADDR
 0x301

62 
	#GAPROLE_ADVERT_ENABLED
 0x302

63 
	#GAPROLE_ADVERT_OFF_TIME
 0x303

64 
	#GAPROLE_ADVERT_DATA
 0x304

65 
	#GAPROLE_SCAN_RSP_DATA
 0x305

66 
	#GAPROLE_ADV_EVENT_TYPE
 0x306

67 
	#GAPROLE_ADV_DIRECT_TYPE
 0x307

68 
	#GAPROLE_ADV_DIRECT_ADDR
 0x308

69 
	#GAPROLE_ADV_CHANNEL_MAP
 0x309

70 
	#GAPROLE_ADV_FILTER_POLICY
 0x30A

71 

	)

82 
GAPROLE_INIT
 = 0,

83 
GAPROLE_STARTED
,

84 
GAPROLE_ADVERTISING
,

85 
GAPROLE_WAITING
,

86 
GAPROLE_ERROR


87 } 
	tg≠rﬁe_Sèãs_t
;

101 (*
g≠RﬁesSèãNŸify_t
)–
	tg≠rﬁe_Sèãs_t
 
	t√wSèã
 );

106 (*
g≠RﬁesRssiRód_t
)–
	töt8
 
	t√wRSSI
 );

113 
g≠RﬁesSèãNŸify_t
 
p‚SèãCh™ge
;

114 
g≠RﬁesRssiRód_t
 
p‚RssiRód
;

115 } 
	tg≠RﬁesCBs_t
;

144 
bSètus_t
 
GAPRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 );

161 
bSètus_t
 
GAPRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 );

170 
bSètus_t
 
GAPRﬁe_SèπDevi˚
–
g≠RﬁesCBs_t
 *
pAµCÆlbacks
 );

195 
GAPRﬁe_Inô
–
uöt8
 
èsk_id
 );

211 
uöt16
 
GAPRﬁe_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

216 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Roles/central.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"oßl_cbTimî.h
"

46 
	~"oßl_¢v.h
"

47 
	~"hci_é.h
"

48 
	~"l2ˇp.h
"

49 
	~"lökdb.h
"

50 
	~"g≠.h
"

51 
	~"g≠b⁄dmgr.h
"

52 
	~"˚¡øl.h
"

63 
	#START_ADVERTISING_EVT
 0x0001

	)

64 
	#RSSI_READ_EVT
 0x0002

	)

65 
	#UPDATE_PARAMS_TIMEOUT_EVT
 0x0004

	)

68 
	#GAPCENTRALROLE_RSSI_MSG_EVT
 0xE0

	)

77 
uöt16
 
	m≥riod
;

78 
uöt16
 
	mc⁄nH™dÀ
;

79 
uöt8
 
	mtimîId
;

80 } 
	tg≠CíåÆRﬁeRssi_t
;

85 
oßl_evít_hdr_t
 
	mhdr
;

86 
g≠CíåÆRﬁeRssi_t
 *
	mpRssi
;

87 } 
	tg≠CíåÆRﬁeRssiEvít_t
;

106 
uöt8
 
	gg≠CíåÆRﬁeTaskId
;

109 
g≠CíåÆRﬁeCB_t
 *
	gpG≠CíåÆRﬁeCB
;

112 
g≠CíåÆRﬁeRssi_t
 
	gg≠CíåÆRﬁeRssi
[
GAPCENTRALROLE_NUM_RSSI_LINKS
];

119 
uöt8
 
	gg≠CíåÆRﬁeIRK
[
KEYLEN
];

120 
uöt8
 
	gg≠CíåÆRﬁeSRK
[
KEYLEN
];

121 
uöt32
 
	gg≠CíåÆRﬁeSignCou¡î
;

122 
uöt8
 
	gg≠CíåÆRﬁeBdAddr
[
B_ADDR_LEN
];

123 
uöt8
 
	gg≠CíåÆRﬁeMaxSˇnRes
 = 0;

128 
g≠CíåÆRﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

129 
g≠CíåÆRﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 );

130 
g≠CíåÆRﬁeRssi_t
 *
g≠CíåÆRﬁe_RssiAŒoc
–
uöt16
 
c⁄nH™dÀ
 );

131 
g≠CíåÆRﬁeRssi_t
 *
g≠CíåÆRﬁe_RssiFöd
–
uöt16
 
c⁄nH™dÀ
 );

132 
g≠CíåÆRﬁe_RssiFªe
–
uöt16
 
c⁄nH™dÀ
 );

133 
g≠CíåÆRﬁe_timîCB
–
uöt8
 *
pD©a
 );

145 
bSètus_t
 
	$GAPCíåÆRﬁe_SèπDevi˚
–
g≠CíåÆRﬁeCB_t
 *
pAµCÆlbacks
 )

147 i‡–
pAµCÆlbacks
 )

149 
pG≠CíåÆRﬁeCB
 = 
pAµCÆlbacks
;

152  
	`GAP_Devi˚Inô
–
g≠CíåÆRﬁeTaskId
, 
GAP_PROFILE_CENTRAL
,

153 
g≠CíåÆRﬁeMaxSˇnRes
, 
g≠CíåÆRﬁeIRK
,

154 
g≠CíåÆRﬁeSRK
, &
g≠CíåÆRﬁeSignCou¡î
 );

155 
	}
}

162 
bSètus_t
 
	$GAPCíåÆRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 )

164 
bSètus_t
 
ªt
 = 
SUCCESS
;

166  
∑øm
 )

168 
GAPCENTRALROLE_IRK
:

169 i‡–
Àn
 =
KEYLEN
 )

171 
VOID
 
	`oßl_mem˝y
–
g≠CíåÆRﬁeIRK
, 
pVÆue
, 
KEYLEN
 ) ;

175 
ªt
 = 
bÀInvÆidR™ge
;

179 
GAPCENTRALROLE_SRK
:

180 i‡–
Àn
 =
KEYLEN
 )

182 
VOID
 
	`oßl_mem˝y
–
g≠CíåÆRﬁeSRK
, 
pVÆue
, 
KEYLEN
 ) ;

186 
ªt
 = 
bÀInvÆidR™ge
;

190 
GAPCENTRALROLE_SIGNCOUNTER
:

191 i‡–
Àn
 = ( 
uöt32
 ) )

193 
g≠CíåÆRﬁeSignCou¡î
 = *((
uöt32
*)
pVÆue
);

197 
ªt
 = 
bÀInvÆidR™ge
;

201 
GAPCENTRALROLE_MAX_SCAN_RES
:

202 i‡–
Àn
 = ( 
uöt8
 ) )

204 
g≠CíåÆRﬁeMaxSˇnRes
 = *((
uöt8
*)
pVÆue
);

208 
ªt
 = 
bÀInvÆidR™ge
;

213 
ªt
 = 
INVALIDPARAMETER
;

217  
ªt
;

218 
	}
}

225 
bSètus_t
 
	$GAPCíåÆRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 )

227 
bSètus_t
 
ªt
 = 
SUCCESS
;

229  
∑øm
 )

231 
GAPCENTRALROLE_IRK
:

232 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠CíåÆRﬁeIRK
, 
KEYLEN
 ) ;

235 
GAPCENTRALROLE_SRK
:

236 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠CíåÆRﬁeSRK
, 
KEYLEN
 ) ;

239 
GAPCENTRALROLE_SIGNCOUNTER
:

240 *((
uöt32
*)
pVÆue
Ë
g≠CíåÆRﬁeSignCou¡î
;

243 
GAPCENTRALROLE_BD_ADDR
:

244 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠CíåÆRﬁeBdAddr
, 
B_ADDR_LEN
 ) ;

247 
GAPCENTRALROLE_MAX_SCAN_RES
:

248 *((
uöt8
*)
pVÆue
Ë
g≠CíåÆRﬁeMaxSˇnRes
;

252 
ªt
 = 
INVALIDPARAMETER
;

256  
ªt
;

257 
	}
}

264 
bSètus_t
 
	$GAPCíåÆRﬁe_Tîmö©eLök
–
uöt16
 
c⁄nH™dÀ
 )

266  
	`GAP_Tîmö©eLökReq
–
g≠CíåÆRﬁeTaskId
, 
c⁄nH™dÀ
 ) ;

267 
	}
}

274 
bSètus_t
 
	$GAPCíåÆRﬁe_E°ablishLök
–
uöt8
 
highDutyCy˛e
, uöt8 
whôeLi°
,

275 
uöt8
 
addrTy≥Pìr
, uöt8 *
≥îAddr
 )

277 
g≠E°LökReq_t
 
∑øms
;

279 
∑øms
.
èskID
 = 
g≠CíåÆRﬁeTaskId
;

280 
∑øms
.
highDutyCy˛e
 = highDutyCycle;

281 
∑øms
.
whôeLi°
 = whiteList;

282 
∑øms
.
addrTy≥Pìr
 =áddrTypePeer;

283 
VOID
 
	`oßl_mem˝y
–
∑øms
.
≥îAddr
,ÖìrAddr, 
B_ADDR_LEN
 );

285  
	`GAP_E°ablishLökReq
–&
∑øms
 );

286 
	}
}

293 
bSètus_t
 
	$GAPCíåÆRﬁe_Upd©eLök
–
uöt16
 
c⁄nH™dÀ
, uöt16 
c⁄nI¡îvÆMö
,

294 
uöt16
 
c⁄nI¡îvÆMax
, uöt16 
c⁄nL©ícy
,

295 
uöt16
 
c⁄nTimeout
 )

297  (
bSètus_t
Ë
	`HCI_LE_C⁄nUpd©eCmd
–
c⁄nH™dÀ
, 
c⁄nI¡îvÆMö
,

298 
c⁄nI¡îvÆMax
, 
c⁄nL©ícy
,

299 
c⁄nTimeout
, 0, 0 );

300 
	}
}

307 
bSètus_t
 
	$GAPCíåÆRﬁe_SèπDiscovîy
–
uöt8
 
mode
, uöt8 
a˘iveSˇn
, uöt8 
whôeLi°
 )

309 
g≠DevDiscReq_t
 
∑øms
;

311 
∑øms
.
èskID
 = 
g≠CíåÆRﬁeTaskId
;

312 
∑øms
.
mode
 = mode;

313 
∑øms
.
a˘iveSˇn
 =áctiveScan;

314 
∑øms
.
whôeLi°
 = whiteList;

316  
	`GAP_Devi˚DiscovîyReque°
–&
∑øms
 );

317 
	}
}

324 
bSètus_t
 
	$GAPCíåÆRﬁe_C™˚lDiscovîy
( )

326  
	`GAP_Devi˚DiscovîyC™˚l
–
g≠CíåÆRﬁeTaskId
 );

327 
	}
}

334 
bSètus_t
 
	$GAPCíåÆRﬁe_SèπRssi
–
uöt16
 
c⁄nH™dÀ
, uöt16 
≥riod
 )

336 
g≠CíåÆRﬁeRssi_t
 *
pRssi
;

339 i‡(!
	`lökDB_Up
(
c⁄nH™dÀ
))

341  
bÀInc‹ª˘Mode
;

345 i‡((
pRssi
 = 
	`g≠CíåÆRﬁe_RssiFöd
–
c⁄nH™dÀ
 )Ë!
NULL
)

348 
	`oßl_CbTimîSt›
–
pRssi
->
timîId
 );

351 i‡((
pRssi
 = 
	`g≠CíåÆRﬁe_RssiAŒoc
–
c⁄nH™dÀ
 )Ë!
NULL
)

353 
pRssi
->
≥riod
 =Öeriod;

358  
bÀNoResour˚s
;

362 
	`oßl_CbTimîSèπ
–
g≠CíåÆRﬁe_timîCB
, (
uöt8
 *Ë
pRssi
,

363 
≥riod
, &
pRssi
->
timîId
 );

365  
SUCCESS
;

366 
	}
}

373 
bSètus_t
 
	$GAPCíåÆRﬁe_C™˚lRssi
(
uöt16
 
c⁄nH™dÀ
 )

375 
g≠CíåÆRﬁeRssi_t
 *
pRssi
;

377 i‡((
pRssi
 = 
	`g≠CíåÆRﬁe_RssiFöd
–
c⁄nH™dÀ
 )Ë!
NULL
)

380 
	`oßl_CbTimîSt›
–
pRssi
->
timîId
 );

383 
	`g≠CíåÆRﬁe_RssiFªe
–
c⁄nH™dÀ
 );

385  
SUCCESS
;

389  
bÀInc‹ª˘Mode
;

390 
	}
}

399 
	$GAPCíåÆRﬁe_Inô
–
uöt8
 
èskId
 )

401 
uöt8
 
i
;

403 
g≠CíåÆRﬁeTaskId
 = 
èskId
;

406  
i
 = 0; i < 
GAPCENTRALROLE_NUM_RSSI_LINKS
; i++ )

408 
g≠CíåÆRﬁeRssi
[
i
].
c⁄nH™dÀ
 = 
GAP_CONNHANDLE_ALL
;

409 
g≠CíåÆRﬁeRssi
[
i
].
timîId
 = 
INVALID_TIMER_ID
;

415 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_IRK
, 
KEYLEN
, 
g≠CíåÆRﬁeIRK
 );

416 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_CSRK
, 
KEYLEN
, 
g≠CíåÆRﬁeSRK
 );

417 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
g≠CíåÆRﬁeSignCou¡î
 );

420 
	`GAP_Regi°îF‹HCIMsgs
–
èskId
 );

421 
	}
}

431 
uöt16
 
	$GAPCíåÆRﬁe_Pro˚ssEvít
–
uöt8
 
èskId
, 
uöt16
 
evíts
 )

433 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

435 
uöt8
 *
pMsg
;

437 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
g≠CíåÆRﬁeTaskId
 )Ë!
NULL
 )

439 
	`g≠CíåÆRﬁe_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *Ë
pMsg
 );

442 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

446  (
evíts
 ^ 
SYS_EVENT_MSG
);

449 i‡–
evíts
 & 
GAP_EVENT_SIGN_COUNTER_CHANGED
 )

452 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
g≠CíåÆRﬁeSignCou¡î
 );

454  ( 
evíts
 ^ 
GAP_EVENT_SIGN_COUNTER_CHANGED
 );

459 
	}
}

470 
	$g≠CíåÆRﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

472  
pMsg
->
evít
 )

474 
HCI_GAP_EVENT_EVENT
:

475 i‡–
pMsg
->
°©us
 =
HCI_COMMAND_COMPLETE_EVENT_CODE
 )

477 
hciEvt_CmdCom∂ëe_t
 *
pPkt
 = (hciEvt_CmdCom∂ëe_à*Ë
pMsg
;

479 i‡–
pPkt
->
cmdOpcode
 =
HCI_READ_RSSI
 )

481 
uöt16
 
c⁄nH™dÀ
 = 
	`BUILD_UINT16
–
pPkt
->
pRëu∫P¨am
[1],ÖPkt->pReturnParam[2] );

482 
öt8
 
rssi
 = (öt8Ë
pPkt
->
pRëu∫P¨am
[3];

485 i‡–
pG≠CíåÆRﬁeCB
 &&ÖG≠CíåÆRﬁeCB->
rssiCB
 )

487 
pG≠CíåÆRﬁeCB
->
	`rssiCB
–
c⁄nH™dÀ
, 
rssi
 );

493 
GAP_MSG_EVENT
:

494 
	`g≠CíåÆRﬁe_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *Ë
pMsg
 );

497 
GAPCENTRALROLE_RSSI_MSG_EVT
:

499 
g≠CíåÆRﬁeRssi_t
 *
pRssi
 = ((
g≠CíåÆRﬁeRssiEvít_t
 *Ë
pMsg
)->pRssi;

502 i‡(
pRssi
->
c⁄nH™dÀ
 !
GAP_CONNHANDLE_ALL
 &&

503 
	`lökDB_Up
(
pRssi
->
c⁄nH™dÀ
))

506 
	`oßl_CbTimîSèπ
–
g≠CíåÆRﬁe_timîCB
, (
uöt8
 *Ë
pRssi
,

507 
pRssi
->
≥riod
, &pRssi->
timîId
 );

510 
VOID
 
	`HCI_RódRssiCmd
–
pRssi
->
c⁄nH™dÀ
 );

518 
	}
}

529 
	$g≠CíåÆRﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 )

531  
pMsg
->
›code
 )

533 
GAP_DEVICE_INIT_DONE_EVENT
:

535 
g≠Devi˚InôD⁄eEvít_t
 *
pPkt
 = (g≠Devi˚InôD⁄eEvít_à*Ë
pMsg
;

537 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

540 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_IRK
, 
KEYLEN
, 
g≠CíåÆRﬁeIRK
 );

541 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_CSRK
, 
KEYLEN
, 
g≠CíåÆRﬁeSRK
 );

544 
VOID
 
	`oßl_mem˝y
–
g≠CíåÆRﬁeBdAddr
, 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

549 
GAP_LINK_ESTABLISHED_EVENT
:

551 
g≠E°LökReqEvít_t
 *
pPkt
 = (g≠E°LökReqEvít_à*Ë
pMsg
;

553 i‡(
pPkt
->
hdr
.
°©us
 =
SUCCESS
)

556 
VOID
 
	`GAPB⁄dMgr_LökE°
–
pPkt
->
devAddrTy≥
,ÖPkt->
devAddr
,

557 
pPkt
->
c⁄√˘i⁄H™dÀ
, 
GAP_PROFILE_CENTRAL
 );

562 
GAP_LINK_TERMINATED_EVENT
:

564 
uöt16
 
c⁄nH™dÀ
 = ((
g≠Tîmö©eLökEvít_t
 *Ë
pMsg
)->
c⁄√˘i⁄H™dÀ
;

566 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

569 
	`GAPCíåÆRﬁe_C™˚lRssi
–
c⁄nH™dÀ
 );

574 
GAP_SLAVE_REQUESTED_SECURITY_EVENT
:

575 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–
pMsg
 );

583 i‡–
pG≠CíåÆRﬁeCB
 &&ÖG≠CíåÆRﬁeCB->
evítCB
 )

585 
pG≠CíåÆRﬁeCB
->
	`evítCB
–(
g≠CíåÆRﬁeEvít_t
 *Ë
pMsg
 );

587 
	}
}

598 
g≠CíåÆRﬁeRssi_t
 *
	$g≠CíåÆRﬁe_RssiAŒoc
–
uöt16
 
c⁄nH™dÀ
 )

600 
uöt8
 
i
;

603  
i
 = 0; i < 
GAPCENTRALROLE_NUM_RSSI_LINKS
; i++ )

605 i‡–
g≠CíåÆRﬁeRssi
[
i
].
c⁄nH™dÀ
 =
GAP_CONNHANDLE_ALL
 )

607 
g≠CíåÆRﬁeRssi
[
i
].
c⁄nH™dÀ
 = connHandle;

608  &
g≠CíåÆRﬁeRssi
[
i
];

613  
NULL
;

614 
	}
}

625 
g≠CíåÆRﬁeRssi_t
 *
	$g≠CíåÆRﬁe_RssiFöd
–
uöt16
 
c⁄nH™dÀ
 )

627 
uöt8
 
i
;

630  
i
 = 0; i < 
GAPCENTRALROLE_NUM_RSSI_LINKS
; i++ )

632 i‡–
g≠CíåÆRﬁeRssi
[
i
].
c⁄nH™dÀ
 == connHandle )

634  &
g≠CíåÆRﬁeRssi
[
i
];

639  
NULL
;

640 
	}
}

651 
	$g≠CíåÆRﬁe_RssiFªe
–
uöt16
 
c⁄nH™dÀ
 )

653 
uöt8
 
i
;

656  
i
 = 0; i < 
GAPCENTRALROLE_NUM_RSSI_LINKS
; i++ )

658 i‡–
g≠CíåÆRﬁeRssi
[
i
].
c⁄nH™dÀ
 == connHandle )

660 
g≠CíåÆRﬁeRssi
[
i
].
c⁄nH™dÀ
 = 
GAP_CONNHANDLE_ALL
;

664 
	}
}

675 
	$g≠CíåÆRﬁe_timîCB
–
uöt8
 *
pD©a
 )

677 
g≠CíåÆRﬁeRssiEvít_t
 *
pMsg
;

680 ((
g≠CíåÆRﬁeRssi_t
 *Ë
pD©a
)->
timîId
 = 
INVALID_TIMER_ID
;

683 
pMsg
 = (
g≠CíåÆRﬁeRssiEvít_t
 *Ë
	`oßl_msg_Æloˇã
( (gapCentralRoleRssiEvent_t) );

684 i‡–
pMsg
 )

686 
pMsg
->
hdr
.
evít
 = 
GAPCENTRALROLE_RSSI_MSG_EVT
;

687 
pMsg
->
pRssi
 = (
g≠CíåÆRﬁeRssi_t
 *Ë
pD©a
;

689 
	`oßl_msg_£nd
 ( 
g≠CíåÆRﬁeTaskId
, (
uöt8
 *Ë
pMsg
 );

691 
	}
}

	@Projects/ble/Profiles/Roles/central.h

41 #i‚de‡
CENTRAL_H


42 
	#CENTRAL_H


	)

44 #ifde‡
__˝lu•lus


52 
	~"bcomdef.h
"

53 
	~"OSAL.h
"

54 
	~"g≠.h
"

63 
	#GAPCENTRALROLE_IRK
 0x400

64 
	#GAPCENTRALROLE_SRK
 0x401

65 
	#GAPCENTRALROLE_SIGNCOUNTER
 0x402

66 
	#GAPCENTRALROLE_BD_ADDR
 0x403

67 
	#GAPCENTRALROLE_MAX_SCAN_RES
 0x404

68 

	)

73 #i‚de‡
GAPCENTRALROLE_NUM_RSSI_LINKS


74 
	#GAPCENTRALROLE_NUM_RSSI_LINKS
 4

	)

94 
g≠EvítHdr_t
 
g≠
;

95 
g≠Devi˚InôD⁄eEvít_t
 
öôD⁄e
;

96 
g≠Devi˚InfoEvít_t
 
devi˚Info
;

97 
g≠DevDiscEvít_t
 
discCm∂
;

98 
g≠E°LökReqEvít_t
 
lökCm∂
;

99 
g≠LökUpd©eEvít_t
 
lökUpd©e
;

100 
g≠Tîmö©eLökEvít_t
 
lökTîmö©e
;

101 } 
	tg≠CíåÆRﬁeEvít_t
;

106 (*
p‚G≠CíåÆRﬁeRssiCB_t
)

108 
	tuöt16
 
	tc⁄nH™dÀ
,

109 
	töt8
 
	trssi


115 (*
p‚G≠CíåÆRﬁeEvítCB_t
)

117 
	tg≠CíåÆRﬁeEvít_t
 *
	tpEvít


125 
p‚G≠CíåÆRﬁeRssiCB_t
 
rssiCB
;

126 
p‚G≠CíåÆRﬁeEvítCB_t
 
evítCB
;

127 } 
	tg≠CíåÆRﬁeCB_t
;

156 
bSètus_t
 
GAPCíåÆRﬁe_SèπDevi˚
–
g≠CíåÆRﬁeCB_t
 *
pAµCÆlbacks
 );

170 
bSètus_t
 
GAPCíåÆRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 );

181 
bSètus_t
 
GAPCíåÆRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 );

192 
bSètus_t
 
GAPCíåÆRﬁe_Tîmö©eLök
–
uöt16
 
c⁄nH™dÀ
 );

208 
bSètus_t
 
GAPCíåÆRﬁe_E°ablishLök
–
uöt8
 
highDutyCy˛e
, uöt8 
whôeLi°
,

209 
uöt8
 
addrTy≥Pìr
, uöt8 *
≥îAddr
 );

223 
bSètus_t
 
GAPCíåÆRﬁe_Upd©eLök
–
uöt16
 
c⁄nH™dÀ
, uöt16 
c⁄nI¡îvÆMö
,

224 
uöt16
 
c⁄nI¡îvÆMax
, uöt16 
c⁄nL©ícy
,

225 
uöt16
 
c⁄nTimeout
 );

237 
bSètus_t
 
GAPCíåÆRﬁe_SèπDiscovîy
–
uöt8
 
mode
, uöt8 
a˘iveSˇn
, uöt8 
whôeLi°
 );

246 
bSètus_t
 
GAPCíåÆRﬁe_C™˚lDiscovîy
( );

258 
bSètus_t
 
GAPCíåÆRﬁe_SèπRssi
–
uöt16
 
c⁄nH™dÀ
, uöt16 
≥riod
 );

268 
bSètus_t
 
GAPCíåÆRﬁe_C™˚lRssi
(
uöt16
 
c⁄nH™dÀ
 );

287 
GAPCíåÆRﬁe_Inô
–
uöt8
 
èskId
 );

299 
uöt16
 
GAPCíåÆRﬁe_Pro˚ssEvít
–
uöt8
 
èskId
, uöt16 
evíts
 );

304 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Roles/gap.c

40 
	~"bcomdef.h
"

41 
	~"g≠.h
"

42 
	~"sm.h
"

81 
bSètus_t
 
	$GAP_Devi˚Inô
–
uöt8
 
èskID
,

82 
uöt8
 
¥ofûeRﬁe
,

83 
uöt8
 
maxSˇnRe•⁄£s
,

84 
uöt8
 *
pIRK
,

85 
uöt8
 *
pSRK
,

86 
uöt32
 *
pSignCou¡î
 )

88 
bSètus_t
 
°©
 = 
INVALIDPARAMETER
;

91  
¥ofûeRﬁe
 )

93 
GAP_PROFILE_BROADCASTER
:

94 #i‡–
HOST_CONFIG
 & ( 
BROADCASTER_CFG
 | 
PERIPHERAL_CFG
 ) )

96 
°©
 = 
SUCCESS
;

101 
GAP_PROFILE_OBSERVER
:

102 #i‡–
HOST_CONFIG
 & ( 
OBSERVER_CFG
 | 
CENTRAL_CFG
 ) )

104 
°©
 = 
SUCCESS
;

109 
GAP_PROFILE_PERIPHERAL
:

110 #i‡–
HOST_CONFIG
 & 
PERIPHERAL_CFG
 )

112 
°©
 = 
SUCCESS
;

117 
GAP_PROFILE_CENTRAL
:

118 #i‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

120 
°©
 = 
SUCCESS
;

125 (
GAP_PROFILE_BROADCASTER
 | 
GAP_PROFILE_OBSERVER
):

126 #i‡––
HOST_CONFIG
 & ( 
BROADCASTER_CFG
 | 
PERIPHERAL_CFG
 ) ) && \

127 –
HOST_CONFIG
 & ( 
OBSERVER_CFG
 | 
CENTRAL_CFG
 ) ) )

129 
°©
 = 
SUCCESS
;

134 (
GAP_PROFILE_PERIPHERAL
 | 
GAP_PROFILE_OBSERVER
):

135 #i‡––
HOST_CONFIG
 & 
PERIPHERAL_CFG
 ) && \

136 –
HOST_CONFIG
 & ( 
OBSERVER_CFG
 | 
CENTRAL_CFG
 ) ) )

138 
°©
 = 
SUCCESS
;

143 (
GAP_PROFILE_CENTRAL
 | 
GAP_PROFILE_BROADCASTER
):

144 #i‡––
HOST_CONFIG
 & 
CENTRAL_CFG
 ) && \

145 –
HOST_CONFIG
 & ( 
BROADCASTER_CFG
 | 
PERIPHERAL_CFG
 ) ) )

147 
°©
 = 
SUCCESS
;

154 
°©
 = 
INVALIDPARAMETER
;

158 i‡–
°©
 =
SUCCESS
 )

161 
°©
 = 
	`GAP_P¨amsInô
–
èskID
, 
¥ofûeRﬁe
 );

162 i‡–
°©
 =
SUCCESS
 )

164 #i‡–
HOST_CONFIG
 & ( 
CENTRAL_CFG
 | 
PERIPHERAL_CFG
 ) )

166 
	`GAP_SecP¨amsInô
–
pIRK
, 
pSRK
, 
pSignCou¡î
 );

170 #i‡–
HOST_CONFIG
 & ( 
CENTRAL_CFG
 | 
OBSERVER_CFG
 ) )

172 i‡–(
¥ofûeRﬁe
 =
GAP_PROFILE_BROADCASTER
) ||

173 (
¥ofûeRﬁe
 =
GAP_PROFILE_PERIPHERAL
) )

175 
maxSˇnRe•⁄£s
 = 0;

179 
VOID
 
	`GAP_CítDevMgrInô
–
maxSˇnRe•⁄£s
 );

181 #i‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

184 
	`GAP_CítC⁄nRegi°î
();

187 
VOID
 
	`SM_Inôüt‹Inô
();

193 #i‡–
HOST_CONFIG
 & ( 
PERIPHERAL_CFG
 | 
BROADCASTER_CFG
 ) )

196 
VOID
 
	`GAP_PîiDevMgrInô
();

198 #i‡–
HOST_CONFIG
 & 
PERIPHERAL_CFG
 )

201 
VOID
 
	`SM_Re•⁄dîInô
();

209  ( 
°©
 );

210 
	}
}

	@Projects/ble/Profiles/Roles/gapbondmgr.c

40 #i‡–
HOST_CONFIG
 & ( 
CENTRAL_CFG
 | 
PERIPHERAL_CFG
 ) )

45 
	~"bcomdef.h
"

46 
	~"OSAL.h
"

47 
	~"oßl_¢v.h
"

48 
	~"g≠.h
"

49 
	~"lökdb.h
"

50 
	~"g©t.h
"

51 
	~"g©t_uuid.h
"

52 
	~"hci.h
"

53 
	~"g©t£rv≠p.h
"

54 
	~"g≠g©t£rvî.h
"

55 
	~"g≠b⁄dmgr.h
"

65 
	#GAP_BOND_SYNC_CC_EVT
 0x0001

66 

	)

68 
	#NV_COMPACT_THRESHOLD
 80

	)

71 
	#GAP_BONDED_STATE_AUTHENTICATED
 0x0001

	)

72 
	#GAP_BONDED_STATE_SERVICE_CHANGED
 0x0002

	)

98 
	#GAP_BOND_REC_ID_OFFSET
 0

99 
	#GAP_BOND_LOCAL_LTK_OFFSET
 1

100 
	#GAP_BOND_DEV_LTK_OFFSET
 2

101 
	#GAP_BOND_DEV_IRK_OFFSET
 3

102 
	#GAP_BOND_DEV_CSRK_OFFSET
 4

103 
	#GAP_BOND_DEV_SIGN_COUNTER_OFFSET
 5

104 

	)

105 
	#GAP_BOND_REC_IDS
 6

	)

108 
	#ˇlcNvID
(
Idx
, 
off£t
Ë(((((IdxË* 
GAP_BOND_REC_IDS
Ë+ (off£t))Ë+ 
BLE_NVID_GAP_BOND_START
)

	)

109 
	#maöRec‹dNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_REC_ID_OFFSET
))

	)

110 
	#loˇlLTKNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_LOCAL_LTK_OFFSET
))

	)

111 
	#devLTKNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_DEV_LTK_OFFSET
))

	)

112 
	#devIRKNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_DEV_IRK_OFFSET
))

	)

113 
	#devCSRKNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_DEV_CSRK_OFFSET
))

	)

114 
	#devSignCou¡îNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_DEV_SIGN_COUNTER_OFFSET
))

	)

117 
	#g©tCfgNvID
(
Idx
Ë((IdxË+ 
BLE_NVID_GATT_CFG_START
)

	)

120 
	#MIN_ENC_KEYSIZE
 7

121 
	#MAX_ENC_KEYSIZE
 16

122 

	)

130 
uöt8
 
	mLTK
[
KEYLEN
];

131 
uöt16
 
	mdiv
;

132 
uöt8
 
	mønd
[
B_RANDOM_NUM_SIZE
];

133 
uöt8
 
	mkeySize
;

134 } 
	tg≠B⁄dLTK_t
;

139 
uöt8
 
	mpublicAddr
[
B_ADDR_LEN
];

140 
uöt8
 
	mªc⁄√˘Addr
[
B_ADDR_LEN
];

141 
uöt16
 
	m°©eFœgs
;

142 } 
	tg≠B⁄dRec_t
;

147 
uöt16
 
	m©åH™dÀ
;

148 
uöt8
 
	mvÆue
;

149 } 
	tg≠B⁄dCh¨Cfg_t
;

166 
uöt8
 
	gg≠B⁄dMgr_TaskID
;

169 
uöt8
 
	gg≠B⁄d_PaúögMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

170 
uöt16
 
	gg≠B⁄d_InôüãWaô
 = 1000;

171 
uöt8
 
	gg≠B⁄d_MITM
 = 
FALSE
;

172 
uöt8
 
	gg≠B⁄d_IOC≠
 = 
GAPBOND_IO_CAP_DISPLAY_ONLY
;

173 
uöt8
 
	gg≠B⁄d_OOBD©aFœg
 = 
FALSE
;

174 
uöt8
 
	gg≠B⁄d_OOBD©a
[
KEYLEN
] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

175 
uöt8
 
	gg≠B⁄d_B⁄dög
 = 
FALSE
;

176 
uöt8
 
	gg≠B⁄d_AutoFaû
 = 
FALSE
;

177 
uöt8
 
	gg≠B⁄d_AutoFaûRós⁄
 = 
SMP_PAIRING_FAILED_NOT_SUPPORTED
;

178 
uöt8
 
	gg≠B⁄d_KeyDi°Li°
 =

180 
GAPBOND_KEYDIST_SENCKEY


181 | 
GAPBOND_KEYDIST_SIDKEY


182 | 
GAPBOND_KEYDIST_SSIGN


183 | 
GAPBOND_KEYDIST_MENCKEY


184 | 
GAPBOND_KEYDIST_MIDKEY


185 | 
GAPBOND_KEYDIST_MSIGN


187 
uöt32
 
	gg≠B⁄d_Passcode
 = 0;

188 
uöt8
 
	gg≠B⁄d_KeySize
 = 
MAX_ENC_KEYSIZE
;

190 #i‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

191 
uöt8
 
	gg≠B⁄d_B⁄dFaûO±i⁄
 = 
GAPBOND_FAIL_TERMINATE_LINK
;

194 c⁄° 
g≠B⁄dCBs_t
 *
	gpG≠B⁄dCB
 = 
NULL
;

197 
g≠B⁄dRec_t
 
	gb⁄ds
[
GAP_BONDINGS_MAX
] = {0};

199 
uöt8
 
	gautoSyncWhôeLi°
 = 
FALSE
;

201 
uöt8
 
	gîa£AŒB⁄ds
 = 
FALSE
;

204 
uöt16
 
	gc⁄√˘i⁄H™dÀ
;

209 
uöt8
 
g≠B⁄dMgrCh™geSèã
–uöt8 
idx
, 
uöt16
 
°©e
, uöt8 
£t
 );

210 
uöt8
 
g≠B⁄dMgrUpd©eCh¨Cfg
–uöt8 
idx
, 
uöt16
 
©åH™dÀ
, uöt16 
vÆue
 );

211 
g≠B⁄dCh¨Cfg_t
 *
g≠B⁄dMgrFödCh¨CfgIãm
–
uöt16
 
©åH™dÀ
,

212 
g≠B⁄dCh¨Cfg_t
 *
ch¨CfgTbl
 );

213 
g≠B⁄dMgrInvîtCh¨CfgIãm
–
g≠B⁄dCh¨Cfg_t
 *
ch¨CfgTbl
 );

214 
uöt8
 
g≠B⁄dMgrAddB⁄d
–
g≠B⁄dRec_t
 *
pB⁄dRec
,

215 
g≠B⁄dLTK_t
 *
pLoˇlLTK
, g≠B⁄dLTK_à*
pDevLTK
,

216 
uöt8
 *
pIRK
, uöt8 *
pSRK
, 
uöt32
 
signCou¡î
 );

217 
uöt8
 
g≠B⁄dMgrGëSèãFœgs
–uöt8 
idx
 );

218 
bSètus_t
 
g≠B⁄dMgrGëPublicAddr
–
uöt8
 
idx
, uöt8 *
pAddr
 );

219 
uöt8
 
g≠B⁄dMgrFödRec⁄√˘Addr
–uöt8 *
pRec⁄√˘Addr
 );

220 
uöt8
 
g≠B⁄dMgrFödAddr
–uöt8 *
pDevAddr
 );

221 
uöt8
 
g≠B⁄dMgrResﬁvePriv©eAddr
–uöt8 *
pAddr
 );

222 
g≠B⁄dMgrRódB⁄ds
( );

223 
uöt8
 
g≠B⁄dMgrFödEm±y
( );

224 
uöt8
 
g≠B⁄dMgrB⁄dTŸÆ
( );

225 
bSètus_t
 
g≠B⁄dMgrEø£AŒB⁄dögs
( );

226 
bSètus_t
 
g≠B⁄dMgrEø£B⁄dög
–
uöt8
 
idx
 );

227 
g≠B⁄dMgr_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

228 
g≠B⁄dMgrSídSîvi˚Ch™ge
–
lökDBIãm_t
 *
pLökIãm
 );

229 
g≠B⁄dMgr_Pro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 );

230 
g≠B⁄dMgr_Pro˚ssGATTSîvMsg
–
g©tEvítHdr_t
 *
pMsg
 );

231 
g≠B⁄dSëupPrivFœg
( );

232 
g≠B⁄dMgrB⁄dReq
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
idx
, uöt8 
°©eFœgs
,

233 
uöt8
 
rﬁe
, uöt8 
°¨tEn¸y±i⁄
 );

234 
g≠B⁄dMgrAuthítiˇã
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
addrTy≥
,

235 
g≠PaúögReq_t
 *
pPaúReq
 );

236 
g≠B⁄dMgr_SyncWhôeLi°
( );

237 
g≠B⁄dMgr_SyncCh¨Cfg
–
uöt16
 
c⁄nH™dÀ
 );

239 #i‡–
HOST_CONFIG
 & 
PERIPHERAL_CFG
 )

240 
g≠B⁄dMgrSœveSecurôyReq
–
uöt16
 
c⁄nH™dÀ
 );

256 
bSètus_t
 
	$GAPB⁄dMgr_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 )

258 
bSètus_t
 
ªt
 = 
SUCCESS
;

260  
∑øm
 )

262 
GAPBOND_PAIRING_MODE
:

263 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAPBOND_PAIRING_MODE_INITIATE
) )

265 
g≠B⁄d_PaúögMode
 = *((
uöt8
*)
pVÆue
);

269 
ªt
 = 
bÀInvÆidR™ge
;

273 
GAPBOND_INITIATE_WAIT
:

274 i‡–
Àn
 = ( 
uöt16
 ) )

276 
g≠B⁄d_InôüãWaô
 = *((
uöt16
*)
pVÆue
);

280 
ªt
 = 
bÀInvÆidR™ge
;

284 
GAPBOND_MITM_PROTECTION
:

285 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

287 
g≠B⁄d_MITM
 = *((
uöt8
*)
pVÆue
);

291 
ªt
 = 
bÀInvÆidR™ge
;

295 
GAPBOND_IO_CAPABILITIES
:

296 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAPBOND_IO_CAP_KEYBOARD_DISPLAY
) )

298 
g≠B⁄d_IOC≠
 = *((
uöt8
*)
pVÆue
);

302 
ªt
 = 
bÀInvÆidR™ge
;

306 
GAPBOND_OOB_ENABLED
:

307 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

309 
g≠B⁄d_OOBD©aFœg
 = *((
uöt8
*)
pVÆue
);

313 
ªt
 = 
bÀInvÆidR™ge
;

317 
GAPBOND_OOB_DATA
:

318 i‡–
Àn
 =
KEYLEN
 )

320 
VOID
 
	`oßl_mem˝y
–
g≠B⁄d_OOBD©a
, 
pVÆue
, 
KEYLEN
 ) ;

324 
ªt
 = 
bÀInvÆidR™ge
;

328 
GAPBOND_BONDING_ENABLED
:

329 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

331 
g≠B⁄d_B⁄dög
 = *((
uöt8
*)
pVÆue
);

335 
ªt
 = 
bÀInvÆidR™ge
;

339 
GAPBOND_KEY_DIST_LIST
:

340 i‡–
Àn
 = ( 
uöt8
 ) )

342 
g≠B⁄d_KeyDi°Li°
 = *((
uöt8
*)
pVÆue
);

346 
ªt
 = 
bÀInvÆidR™ge
;

350 
GAPBOND_DEFAULT_PASSCODE
:

351 i‡–(
Àn
 = ( 
uöt32
 ))

352 && (*((
uöt32
*)
pVÆue
Ë<
GAP_PASSCODE_MAX
) )

354 
g≠B⁄d_Passcode
 = *((
uöt32
*)
pVÆue
);

358 
ªt
 = 
bÀInvÆidR™ge
;

362 
GAPBOND_ERASE_ALLBONDS
:

363 i‡–
Àn
 == 0 )

366 i‡–
	`GAP_NumA˘iveC⁄√˘i⁄s
() == 0 )

369 
VOID
 
	`g≠B⁄dMgrEø£AŒB⁄dögs
();

372 
VOID
 
	`oßl_¢v_com∑˘
–
NV_COMPACT_THRESHOLD
 );

375 
	`g≠B⁄dMgrRódB⁄ds
();

379 
îa£AŒB⁄ds
 = 
TRUE
;

384 
ªt
 = 
bÀInvÆidR™ge
;

388 
GAPBOND_AUTO_FAIL_PAIRING
:

389 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

391 
g≠B⁄d_AutoFaû
 = *((
uöt8
*)
pVÆue
);

395 
ªt
 = 
bÀInvÆidR™ge
;

399 
GAPBOND_AUTO_FAIL_REASON
:

400 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
SMP_PAIRING_FAILED_REPEATED_ATTEMPTS
) )

402 
g≠B⁄d_AutoFaûRós⁄
 = *((
uöt8
*)
pVÆue
);

406 
ªt
 = 
bÀInvÆidR™ge
;

410 
GAPBOND_KEYSIZE
:

411 i‡–(
Àn
 = ( 
uöt8
 ))

412 && ((*((
uöt8
*)
pVÆue
Ë>
MIN_ENC_KEYSIZE
Ë&& (*((uöt8*ÌVÆueË<
MAX_ENC_KEYSIZE
)) )

414 
g≠B⁄d_KeySize
 = *((
uöt8
*)
pVÆue
);

418 
ªt
 = 
bÀInvÆidR™ge
;

422 
GAPBOND_AUTO_SYNC_WL
:

423 i‡–
Àn
 =–
uöt8
 ) )

425 
uöt8
 
ﬁdVÆ
 = 
autoSyncWhôeLi°
;

427 
autoSyncWhôeLi°
 = *((
uöt8
 *)
pVÆue
);

430 i‡––
ﬁdVÆ
 =
FALSE
 ) && ( 
autoSyncWhôeLi°
 =
TRUE
 ) )

433 
	`g≠B⁄dMgrRódB⁄ds
();

438 
ªt
 = 
bÀInvÆidR™ge
;

442 #i‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

443 
GAPBOND_BOND_FAIL_ACTION
:

444 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAPBOND_FAIL_TERMINATE_ERASE_BONDS
) )

446 
g≠B⁄d_B⁄dFaûO±i⁄
 = *((
uöt8
*)
pVÆue
);

450 
ªt
 = 
bÀInvÆidR™ge
;

457 i‡–(
∑øm
 < 
TGAP_PARAMID_MAX
Ë&& (
Àn
 = ( 
uöt16
 )) )

459 
ªt
 = 
	`GAP_SëP¨amVÆue
–
∑øm
, *((
uöt16
*)
pVÆue
) );

463 
ªt
 = 
INVALIDPARAMETER
;

468  ( 
ªt
 );

469 
	}
}

476 
bSètus_t
 
	$GAPB⁄dMgr_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 )

478 
bSètus_t
 
ªt
 = 
SUCCESS
;

480  
∑øm
 )

482 
GAPBOND_PAIRING_MODE
:

483 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_PaúögMode
;

486 
GAPBOND_INITIATE_WAIT
:

487 *((
uöt16
*)
pVÆue
Ë
g≠B⁄d_InôüãWaô
;

490 
GAPBOND_MITM_PROTECTION
:

491 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_MITM
;

494 
GAPBOND_IO_CAPABILITIES
:

495 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_IOC≠
;

498 
GAPBOND_OOB_ENABLED
:

499 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_OOBD©aFœg
;

502 
GAPBOND_OOB_DATA
:

503 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠B⁄d_OOBD©a
, 
KEYLEN
 ) ;

506 
GAPBOND_BONDING_ENABLED
:

507 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_B⁄dög
;

510 
GAPBOND_KEY_DIST_LIST
:

511 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_KeyDi°Li°
;

514 
GAPBOND_DEFAULT_PASSCODE
:

515 *((
uöt32
*)
pVÆue
Ë
g≠B⁄d_Passcode
;

518 
GAPBOND_AUTO_FAIL_PAIRING
:

519 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_AutoFaû
;

522 
GAPBOND_AUTO_FAIL_REASON
:

523 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_AutoFaûRós⁄
;

526 
GAPBOND_KEYSIZE
:

527 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_KeySize
;

530 
GAPBOND_AUTO_SYNC_WL
:

531 *((
uöt8
*)
pVÆue
Ë
autoSyncWhôeLi°
;

534 
GAPBOND_BOND_COUNT
:

535 *((
uöt8
*)
pVÆue
Ë
	`g≠B⁄dMgrB⁄dTŸÆ
();

540 i‡–
∑øm
 < 
TGAP_PARAMID_MAX
 )

542 *((
uöt16
*)
pVÆue
Ë
	`GAP_GëP¨amVÆue
–
∑øm
 );

546 
ªt
 = 
INVALIDPARAMETER
;

551  ( 
ªt
 );

552 
	}
}

559 
bSètus_t
 
	$GAPB⁄dMgr_LökE°
–
uöt8
 
addrTy≥
, uöt8 *
pDevAddr
, 
uöt16
 
c⁄nH™dÀ
, uöt8 
rﬁe
 )

561 
uöt8
 
idx
;

562 
uöt8
 
publicAddr
[
B_ADDR_LEN
]

565 
idx
 = 
	`GAPB⁄dMgr_ResﬁveAddr
–
addrTy≥
, 
pDevAddr
, 
publicAddr
 );

566 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

568 
uöt8
 
°©eFœgs
 = 
	`g≠B⁄dMgrGëSèãFœgs
–
idx
 );

569 
smSignögInfo_t
 
signögInfo
;

570 
g≠B⁄dCh¨Cfg_t
 
ch¨Cfg
[
GAP_CHAR_CFG_MAX
];

574 
	`g≠B⁄dMgrB⁄dReq
–
c⁄nH™dÀ
, 
idx
, 
°©eFœgs
, 
rﬁe
,

575 ((
g≠B⁄d_PaúögMode
 =
GAPBOND_PAIRING_MODE_INITIATE
 ) ? 
TRUE
 : 
FALSE
) );

578 
VOID
 
	`oßl_mem£t
–&
signögInfo
, 0,  ( 
smSignögInfo_t
 ) );

579 i‡–
	`oßl_¢v_ªad
–
	`devCSRKNvID
(
idx
), 
KEYLEN
, 
signögInfo
.
§k
 ) =
SUCCESS
 )

581 i‡–
	`oßl_isbuf£t
–
signögInfo
.
§k
, 0xFF, 
KEYLEN
 ) =
FALSE
 )

584 
VOID
 
	`oßl_¢v_ªad
–
	`devSignCou¡îNvID
(
idx
),  ( 
uöt32
 ), &(
signögInfo
.
signCou¡î
) );

585 
VOID
 
	`GAP_Sig«bÀ
–
c⁄nH™dÀ
,

586 ((
°©eFœgs
 & 
GAP_BONDED_STATE_AUTHENTICATED
Ë? 
TRUE
 : 
FALSE
),

587 &
signögInfo
 );

592 i‡–
	`oßl_¢v_ªad
–
	`g©tCfgNvID
(
idx
),  ( 
ch¨Cfg
 ), ch¨Cfg ) =
SUCCESS
 )

594 
	`g≠B⁄dMgrInvîtCh¨CfgIãm
–
ch¨Cfg
 );

596  
uöt8
 
i
 = 0; i < 
GAP_CHAR_CFG_MAX
; i++ )

598 
g≠B⁄dCh¨Cfg_t
 *
pIãm
 = &(
ch¨Cfg
[
i
]);

601 i‡–
pIãm
->
©åH™dÀ
 !
GATT_INVALID_HANDLE
 )

603 
VOID
 
	`GATTSîvAµ_Upd©eCh¨Cfg
–
c⁄nH™dÀ
, 
pIãm
->
©åH™dÀ
,

604 (
uöt16
)(
pIãm
->
vÆue
) );

610 i‡–
°©eFœgs
 & 
GAP_BONDED_STATE_SERVICE_CHANGED
 )

612 
VOID
 
	`GATTSîvAµ_SídSîvi˚Ch™gedInd
–
c⁄nH™dÀ
, 
g≠B⁄dMgr_TaskID
 );

615 #i‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

616 i‡–
rﬁe
 =
GAP_PROFILE_CENTRAL
 &&

617 
g≠B⁄d_PaúögMode
 =
GAPBOND_PAIRING_MODE_INITIATE
 )

620 
	`g≠B⁄dMgrAuthítiˇã
–
c⁄nH™dÀ
, 
addrTy≥
, 
NULL
 );

623 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑úSèãCB
 )

625 
pG≠B⁄dCB
->
	`∑úSèãCB
–
c⁄nH™dÀ
, 
GAPBOND_PAIRING_STATE_STARTED
, 
SUCCESS
 );

630 #i‡–
HOST_CONFIG
 & 
PERIPHERAL_CFG
 )

633 i‡–
rﬁe
 =
GAP_PROFILE_PERIPHERAL
 &&

634 
g≠B⁄d_PaúögMode
 =
GAPBOND_PAIRING_MODE_INITIATE
 )

636 
	`g≠B⁄dMgrSœveSecurôyReq
–
c⁄nH™dÀ
 );

640  ( 
SUCCESS
 );

641 
	}
}

648 
uöt8
 
	$GAPB⁄dMgr_ResﬁveAddr
–
uöt8
 
addrTy≥
, uöt8 *
pDevAddr
, uöt8 *
pResﬁvedAddr
 )

650 
uöt8
 
idx
 = 
GAP_BONDINGS_MAX
;

652  
addrTy≥
 )

654 
ADDRTYPE_PUBLIC
:

655 
ADDRTYPE_STATIC
:

656 
idx
 = 
	`g≠B⁄dMgrFödAddr
–
pDevAddr
 );

657 i‡–(
idx
 < 
GAP_BONDINGS_MAX
Ë&& (
pResﬁvedAddr
) )

659 
VOID
 
	`oßl_mem˝y
–
pResﬁvedAddr
, 
pDevAddr
, 
B_ADDR_LEN
 );

663 
ADDRTYPE_PRIVATE_NONRESOLVE
:

665 
idx
 = 
	`g≠B⁄dMgrFödRec⁄√˘Addr
–
pDevAddr
 );

666 i‡–(
idx
 < 
GAP_BONDINGS_MAX
Ë&& (
pResﬁvedAddr
) )

668 
VOID
 
	`g≠B⁄dMgrGëPublicAddr
–
idx
, 
pResﬁvedAddr
 );

672 
ADDRTYPE_PRIVATE_RESOLVE
:

674 
idx
 = 
	`g≠B⁄dMgrResﬁvePriv©eAddr
–
pDevAddr
 );

675 i‡–(
idx
 < 
GAP_BONDINGS_MAX
Ë&& (
pResﬁvedAddr
) )

677 
VOID
 
	`g≠B⁄dMgrGëPublicAddr
–
idx
, 
pResﬁvedAddr
 );

685  ( 
idx
 );

686 
	}
}

693 
bSètus_t
 
	$GAPB⁄dMgr_Sîvi˚Ch™geInd
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
£tP¨am
 )

695 
bSètus_t
 
ªt
 = 
bÀNoResour˚s
;

697 i‡–
c⁄√˘i⁄H™dÀ
 == 0xFFFF )

699 
uöt8
 
idx
;

702  
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

704 i‡–
	`g≠B⁄dMgrCh™geSèã
–
idx
, 
GAP_BONDED_STATE_SERVICE_CHANGED
, 
£tP¨am
 ) )

706 
ªt
 = 
SUCCESS
;

711 i‡–
£tP¨am
 )

714 
	`lökDB_Pîf‹mFunc
–
g≠B⁄dMgrSídSîvi˚Ch™ge
 );

720 
lökDBIãm_t
 *
pLökIãm
 = 
	`lökDB_Föd
–
c⁄√˘i⁄H™dÀ
 );

721 i‡–
pLökIãm
 )

723 
uöt8
 
idx
;

724 
idx
 = 
	`GAPB⁄dMgr_ResﬁveAddr
–
pLökIãm
->
addrTy≥
,ÖLökIãm->
addr
, 
NULL
 );

725 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

728 
VOID
 
	`g≠B⁄dMgrCh™geSèã
–
idx
, 
GAP_BONDED_STATE_SERVICE_CHANGED
, 
£tP¨am
 );

729 
ªt
 = 
SUCCESS
;

733 i‡–
£tP¨am
 )

735 
	`g≠B⁄dMgrSídSîvi˚Ch™ge
–
pLökIãm
 );

740 
ªt
 = 
bÀNŸC⁄√˘ed
;

744  ( 
ªt
 );

745 
	}
}

752 
bSètus_t
 
	$GAPB⁄dMgr_Upd©eCh¨Cfg
–
uöt16
 
c⁄√˘i⁄H™dÀ
, uöt16 
©åH™dÀ
, uöt16 
vÆue
 )

754 
bSètus_t
 
ªt
 = 
bÀNoResour˚s
;

756 i‡–
c⁄√˘i⁄H™dÀ
 =
INVALID_CONNHANDLE
 )

758 
uöt8
 
idx
;

761  
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

763 i‡–
	`g≠B⁄dMgrUpd©eCh¨Cfg
–
idx
, 
©åH™dÀ
, 
vÆue
 ) )

765 
ªt
 = 
SUCCESS
;

772 
lökDBIãm_t
 *
pLökIãm
 = 
	`lökDB_Föd
–
c⁄√˘i⁄H™dÀ
 );

773 i‡–
pLökIãm
 )

775 
uöt8
 
idx
 = 
	`GAPB⁄dMgr_ResﬁveAddr
–
pLökIãm
->
addrTy≥
,ÖLökIãm->
addr
, 
NULL
 );

776 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

779 
VOID
 
	`g≠B⁄dMgrUpd©eCh¨Cfg
–
idx
, 
©åH™dÀ
, 
vÆue
 );

780 
ªt
 = 
SUCCESS
;

785 
ªt
 = 
bÀNŸC⁄√˘ed
;

789  ( 
ªt
 );

790 
	}
}

797 
	$GAPB⁄dMgr_Regi°î
–
g≠B⁄dCBs_t
 *
pCB
 )

799 
pG≠B⁄dCB
 = 
pCB
;

802 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_AUTH_TASK_ID
, 
g≠B⁄dMgr_TaskID
 );

805 
	`GATTSîvAµ_Regi°îF‹Msg
–
g≠B⁄dMgr_TaskID
 );

806 
	}
}

813 
bSètus_t
 
	$GAPB⁄dMgr_PasscodeR•
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
°©us
, 
uöt32
 
∑sscode
 )

815 
bSètus_t
 
ªt
 = 
SUCCESS
;

817 i‡–
°©us
 =
SUCCESS
 )

820 
∑sscode
 =Öasscodê% (
GAP_PASSCODE_MAX
 + 1);

822 
ªt
 = 
	`GAP_PasscodeUpd©e
–
∑sscode
, 
c⁄√˘i⁄H™dÀ
 );

823 i‡–
ªt
 !
SUCCESS
 )

825 
VOID
 
	`GAP_Tîmö©eAuth
–
c⁄√˘i⁄H™dÀ
, 
SMP_PAIRING_FAILED_PASSKEY_ENTRY_FAILED
 );

830 
VOID
 
	`GAP_Tîmö©eAuth
–
c⁄√˘i⁄H™dÀ
, 
°©us
 );

833  
ªt
;

834 
	}
}

842 
	$GAPB⁄dMgr_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 )

844  
pMsg
->
›code
 )

846 
GAP_PASSKEY_NEEDED_EVENT
:

848 
g≠PasskeyNìdedEvít_t
 *
pPkt
 = (g≠PasskeyNìdedEvít_à*)
pMsg
;

850 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑sscodeCB
 )

853 
pG≠B⁄dCB
->
	`∑sscodeCB
–
pPkt
->
devi˚Addr
,ÖPkt->
c⁄√˘i⁄H™dÀ
,ÖPkt->
uiI≈uts
,ÖPkt->
uiOuçuts
 );

858 i‡–
	`GAP_PasscodeUpd©e
–
g≠B⁄d_Passcode
, 
pPkt
->
c⁄√˘i⁄H™dÀ
 ) !
SUCCESS
 )

860 
VOID
 
	`GAP_Tîmö©eAuth
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
SMP_PAIRING_FAILED_PASSKEY_ENTRY_FAILED
 );

866 
GAP_AUTHENTICATION_COMPLETE_EVENT
:

868 
g≠AuthCom∂ëeEvít_t
 *
pPkt
 = (g≠AuthCom∂ëeEvít_à*)
pMsg
;

871 i‡–(
pPkt
->
hdr
.
°©us
 =
SUCCESS
Ë&& (pPkt->
authSèã
 & 
SM_AUTH_STATE_BONDING
) )

873 
g≠B⁄dRec_t
 
b⁄dRec
;

875 
VOID
 
	`oßl_mem£t
–&
b⁄dRec
, 0,  ( 
g≠B⁄dRec_t
 ) ) ;

878 i‡–
pPkt
->
pIdítôyInfo
 )

880 
VOID
 
	`oßl_mem˝y
–
b⁄dRec
.
publicAddr
, 
pPkt
->
pIdítôyInfo
->
bd_addr
, 
B_ADDR_LEN
 );

884 
lökDBIãm_t
 *
pLökIãm
 = 
	`lökDB_Föd
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

885 i‡–
pLökIãm
 )

887 
VOID
 
	`oßl_mem˝y
–
b⁄dRec
.
publicAddr
, 
pLökIãm
->
addr
, 
B_ADDR_LEN
 );

897 
b⁄dRec
.
°©eFœgs
 |(
pPkt
->
authSèã
 & 
SM_AUTH_STATE_AUTHENTICATED
Ë? 
GAP_BONDED_STATE_AUTHENTICATED
 : 0;

899 
VOID
 
	`g≠B⁄dMgrAddB⁄d
–&
b⁄dRec
,

900 (
g≠B⁄dLTK_t
 *)
pPkt
->
pSecurôyInfo
,

901 (
g≠B⁄dLTK_t
 *)
pPkt
->
pDevSecInfo
,

902 ((
uöt8
 *)((
pPkt
->
pIdítôyInfo
Ë?ÖPkt->pIdítôyInfo->
úk
 : 
NULL
 )),

903 ((
uöt8
 *)((
pPkt
->
pSignögInfo
Ë?ÖPkt->pSignögInfo->
§k
 : 
NULL
 )),

904 ((
uöt32
)((
pPkt
->
pSignögInfo
Ë?ÖPkt->pSignögInfo->
signCou¡î
 : 
GAP_INIT_SIGN_COUNTER
 )) );

907 
c⁄√˘i⁄H™dÀ
 = 
pPkt
->connectionHandle;

908 
	`oßl_£t_evít
–
g≠B⁄dMgr_TaskID
, 
GAP_BOND_SYNC_CC_EVT
 );

912 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑úSèãCB
 )

914 
pG≠B⁄dCB
->
	`∑úSèãCB
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
GAPBOND_PAIRING_STATE_COMPLETE
,ÖPkt->
hdr
.
°©us
 );

919 
GAP_BOND_COMPLETE_EVENT
:

924 
g≠B⁄dCom∂ëeEvít_t
 *
pPkt
 = (g≠B⁄dCom∂ëeEvít_à*)
pMsg
;

926 #i‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

927 i‡–
pPkt
->
hdr
.
°©us
 =
LL_ENC_KEY_REQ_REJECTED
 )

931 
lökDBIãm_t
 *
pLökIãm
 = 
	`lökDB_Föd
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

932 i‡–
pLökIãm
 )

934  
g≠B⁄d_B⁄dFaûO±i⁄
 )

936 
GAPBOND_FAIL_INITIATE_PAIRING
:

938 
	`g≠B⁄dMgrAuthítiˇã
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
pLökIãm
->
addrTy≥
, 
NULL
 );

941 
GAPBOND_FAIL_TERMINATE_LINK
:

943 
	`GAP_Tîmö©eLökReq
–
pLökIãm
->
èskID
, 
pPkt
->
c⁄√˘i⁄H™dÀ
 );

946 
GAPBOND_FAIL_TERMINATE_ERASE_BONDS
:

948 
VOID
 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_ERASE_ALLBONDS
, 0, 
NULL
 );

951 
	`GAP_Tîmö©eLökReq
–
pLökIãm
->
èskID
, 
pPkt
->
c⁄√˘i⁄H™dÀ
 );

954 
GAPBOND_FAIL_NO_ACTION
:

963 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑úSèãCB
 )

965 
pG≠B⁄dCB
->
	`∑úSèãCB
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
GAPBOND_PAIRING_STATE_BONDED
, 
pMsg
->
hdr
.
°©us
 );

970 
GAP_SIGNATURE_UPDATED_EVENT
:

972 
uöt8
 
idx
;

973 
g≠SignUpd©eEvít_t
 *
pPkt
 = (g≠SignUpd©eEvít_à*)
pMsg
;

975 
idx
 = 
	`GAPB⁄dMgr_ResﬁveAddr
–
pPkt
->
addrTy≥
,ÖPkt->
devAddr
, 
NULL
 );

976 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

979 
VOID
 
	`oßl_¢v_wrôe
–
	`devSignCou¡îNvID
(
idx
),  ( 
uöt32
 ), &(
pPkt
->
signCou¡î
) );

984 #i‡–
HOST_CONFIG
 & 
PERIPHERAL_CFG
 )

985 
GAP_PAIRING_REQ_EVENT
:

987 
g≠PaúögReqEvít_t
 *
pPkt
 = (g≠PaúögReqEvít_à*)
pMsg
;

989 i‡–
g≠B⁄d_AutoFaû
 !
FALSE
 )

992 
VOID
 
	`GAP_Tîmö©eAuth
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
g≠B⁄d_AutoFaûRós⁄
 );

994 i‡–
g≠B⁄d_PaúögMode
 =
GAPBOND_PAIRING_MODE_NO_PAIRING
 )

997 
VOID
 
	`GAP_Tîmö©eAuth
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
SMP_PAIRING_FAILED_NOT_SUPPORTED
 );

1001 
lökDBIãm_t
 *
pLökIãm
 = 
	`lökDB_Föd
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

1004 i‡–
pPkt
->
∑úReq
.
authReq
 & 
SM_AUTH_STATE_BONDING
 )

1006 i‡–
pLökIãm
 )

1008 i‡–(
pLökIãm
->
addrTy≥
 !
ADDRTYPE_PUBLIC
Ë&& (
pPkt
->
∑úReq
.
keyDi°
.
mIdKey
 =
FALSE
) )

1010 
uöt8
 
publicAddr
[
B_ADDR_LEN
];

1013 i‡–
	`GAPB⁄dMgr_ResﬁveAddr
(
pLökIãm
->
addrTy≥
,ÖLökIãm->
addr
, 
publicAddr
 ) =
FALSE
 )

1016 
VOID
 
	`GAP_Tîmö©eAuth
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
SMP_PAIRING_FAILED_AUTH_REQ
 );

1029 
	`g≠B⁄dMgrAuthítiˇã
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
pLökIãm
->
addrTy≥
, &’Pkt->
∑úReq
) );

1032 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑úSèãCB
 )

1034 
pG≠B⁄dCB
->
	`∑úSèãCB
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
GAPBOND_PAIRING_STATE_STARTED
, 
SUCCESS
 );

1041 #i‡–
HOST_CONFIG
 & 
CENTRAL_CFG
 )

1042 
GAP_SLAVE_REQUESTED_SECURITY_EVENT
:

1044 
uöt16
 
c⁄nH™dÀ
 = ((
g≠SœveSecurôyReqEvít_t
 *)
pMsg
)->
c⁄√˘i⁄H™dÀ
;

1045 
uöt8
 
idx
;

1046 
uöt8
 
publicAddr
[
B_ADDR_LEN
] = {0, 0, 0, 0, 0, 0};

1047 
lökDBIãm_t
 *
pLök
 = 
	`lökDB_Föd
–
c⁄nH™dÀ
 );

1050 i‡(
pLök
 !
NULL
 && 
g≠B⁄d_PaúögMode
 !
GAPBOND_PAIRING_MODE_INITIATE
)

1053 
idx
 = 
	`GAPB⁄dMgr_ResﬁveAddr
–
pLök
->
addrTy≥
,ÖLök->
addr
, 
publicAddr
 );

1054 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

1056 
	`g≠B⁄dMgrB⁄dReq
–
c⁄nH™dÀ
, 
idx
, 
	`g≠B⁄dMgrGëSèãFœgs
( idx ),

1057 
GAP_PROFILE_CENTRAL
, 
TRUE
 );

1060 i‡–
g≠B⁄d_PaúögMode
 =
GAPBOND_PAIRING_MODE_NO_PAIRING
 )

1063 
VOID
 
	`GAP_Tîmö©eAuth
–
c⁄nH™dÀ
, 
SMP_PAIRING_FAILED_NOT_SUPPORTED
 );

1066 i‡(
g≠B⁄d_PaúögMode
 =
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
)

1069 
	`g≠B⁄dMgrAuthítiˇã
–
c⁄nH™dÀ
, 
pLök
->
addrTy≥
, 
NULL
 );

1076 
GAP_LINK_TERMINATED_EVENT
:

1077 i‡–
	`GAP_NumA˘iveC⁄√˘i⁄s
() == 0 )

1080 i‡–
îa£AŒB⁄ds
 =
TRUE
 )

1082 
VOID
 
	`g≠B⁄dMgrEø£AŒB⁄dögs
();

1083 
îa£AŒB⁄ds
 = 
FALSE
;

1087 
VOID
 
	`oßl_¢v_com∑˘
–
NV_COMPACT_THRESHOLD
 );

1090 
	`g≠B⁄dMgrRódB⁄ds
();

1097 
	}
}

1114 
uöt8
 
	$g≠B⁄dMgrCh™geSèã
–
uöt8
 
idx
, 
uöt16
 
°©e
, uöt8 
£t
 )

1116 
g≠B⁄dRec_t
 
b⁄dRec
;

1119 i‡–(
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
)

1120 && (
	`oßl_isbuf£t
–
b⁄dRec
.
publicAddr
, 0xFF, 
B_ADDR_LEN
 ) =
FALSE
) )

1123 
uöt8
 
°©eFœgs
 = 
b⁄dRec
.stateFlags;

1124 i‡–
£t
 )

1126 
°©eFœgs
 |
°©e
;

1130 
°©eFœgs
 &~(
°©e
);

1133 i‡–
°©eFœgs
 !
b⁄dRec
.stateFlags )

1135 
b⁄dRec
.
°©eFœgs
 = stateFlags;

1136 
VOID
 
	`oßl_¢v_wrôe
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 );

1138  ( 
TRUE
 );

1140  ( 
FALSE
 );

1141 
	}
}

1154 
uöt8
 
	$g≠B⁄dMgrUpd©eCh¨Cfg
–
uöt8
 
idx
, 
uöt16
 
©åH™dÀ
, uöt16 
vÆue
 )

1156 
g≠B⁄dRec_t
 
b⁄dRec
;

1159 i‡––
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
 )

1160 && ( 
	`oßl_isbuf£t
–
b⁄dRec
.
publicAddr
, 0xFF, 
B_ADDR_LEN
 ) =
FALSE
 ) )

1162 
g≠B⁄dCh¨Cfg_t
 
ch¨Cfg
[
GAP_CHAR_CFG_MAX
];

1164 i‡–
	`oßl_¢v_ªad
–
	`g©tCfgNvID
(
idx
),  ( 
ch¨Cfg
 ), ch¨Cfg ) =
SUCCESS
 )

1166 
uöt8
 
upd©e
 = 
FALSE
;

1168 
	`g≠B⁄dMgrInvîtCh¨CfgIãm
–
ch¨Cfg
 );

1170 i‡–
©åH™dÀ
 =
GATT_INVALID_HANDLE
 )

1172 i‡–
	`oßl_isbuf£t
–(
uöt8
 *)
ch¨Cfg
, 0x00,  ( ch¨Cfg ) ) =
FALSE
 )

1175 
VOID
 
	`oßl_mem£t
–(*)
ch¨Cfg
, 0x00,  ( charCfg ) );

1176 
upd©e
 = 
TRUE
;

1181 
g≠B⁄dCh¨Cfg_t
 *
pIãm
 = 
	`g≠B⁄dMgrFödCh¨CfgIãm
–
©åH™dÀ
, 
ch¨Cfg
 );

1182 i‡–
pIãm
 =
NULL
 )

1185 i‡––
vÆue
 =
GATT_CFG_NO_OPERATION
 ) ||

1186 ––
pIãm
 = 
	`g≠B⁄dMgrFödCh¨CfgIãm
–
GATT_INVALID_HANDLE
, 
ch¨Cfg
 ) ) =
NULL
 ) )

1188  ( 
FALSE
 );

1191 
pIãm
->
©åH™dÀ
 =áttrHandle;

1194 i‡–
pIãm
->
vÆue
 != value )

1197 
pIãm
->
vÆue
 = (
uöt8
)value;

1198 i‡–
vÆue
 =
GATT_CFG_NO_OPERATION
 )

1201 
pIãm
->
©åH™dÀ
 = 
GATT_INVALID_HANDLE
;

1204 
upd©e
 = 
TRUE
;

1209 i‡–
upd©e
 )

1211 
	`g≠B⁄dMgrInvîtCh¨CfgIãm
–
ch¨Cfg
 );

1212 
VOID
 
	`oßl_¢v_wrôe
–
	`g©tCfgNvID
(
idx
), –
ch¨Cfg
 ), charCfg );

1216  ( 
TRUE
 );

1219  ( 
FALSE
 );

1220 
	}
}

1234 
g≠B⁄dCh¨Cfg_t
 *
	$g≠B⁄dMgrFödCh¨CfgIãm
–
uöt16
 
©åH™dÀ
,

1235 
g≠B⁄dCh¨Cfg_t
 *
ch¨CfgTbl
 )

1237  
uöt8
 
i
 = 0; i < 
GAP_CHAR_CFG_MAX
; i++ )

1239 i‡–
ch¨CfgTbl
[
i
].
©åH™dÀ
 ==áttrHandle )

1241  ( &(
ch¨CfgTbl
[
i
]) );

1245  ( (
g≠B⁄dCh¨Cfg_t
 *)
NULL
 );

1246 
	}
}

1257 
	$g≠B⁄dMgrInvîtCh¨CfgIãm
–
g≠B⁄dCh¨Cfg_t
 *
ch¨CfgTbl
 )

1259  
uöt8
 
i
 = 0; i < 
GAP_CHAR_CFG_MAX
; i++ )

1261 
ch¨CfgTbl
[
i
].
©åH™dÀ
 = ~(charCfgTbl[i].attrHandle);

1262 
ch¨CfgTbl
[
i
].
vÆue
 = ~(charCfgTbl[i].value);

1264 
	}
}

1280 
uöt8
 
	$g≠B⁄dMgrAddB⁄d
–
g≠B⁄dRec_t
 *
pB⁄dRec
,

1281 
g≠B⁄dLTK_t
 *
pLoˇlLTK
, g≠B⁄dLTK_à*
pDevLTK
,

1282 
uöt8
 *
pIRK
, uöt8 *
pSRK
, 
uöt32
 
signCou¡î
 )

1284 
uöt8
 
idx
;

1286 i‡–
pB⁄dRec
 =
NULL
 )

1288  ( 
GAP_BONDINGS_MAX
 );

1292 
idx
 = 
	`g≠B⁄dMgrFödAddr
–
pB⁄dRec
->
publicAddr
 );

1293 i‡–
idx
 >
GAP_BONDINGS_MAX
 )

1295 
idx
 = 
	`g≠B⁄dMgrFödEm±y
();

1298 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

1300 
g≠B⁄dCh¨Cfg_t
 
ch¨Cfg
[
GAP_CHAR_CFG_MAX
];

1303 
VOID
 
	`oßl_¢v_wrôe
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), 
pB⁄dRec
 );

1306 i‡–
pLoˇlLTK
 )

1308 
VOID
 
	`oßl_¢v_wrôe
–
	`loˇlLTKNvID
(
idx
),  ( 
g≠B⁄dLTK_t
 ), 
pLoˇlLTK
 );

1312 i‡–
pDevLTK
 )

1314 
VOID
 
	`oßl_¢v_wrôe
–
	`devLTKNvID
(
idx
),  ( 
g≠B⁄dLTK_t
 ), 
pDevLTK
 );

1318 i‡–
pIRK
 )

1320 
VOID
 
	`oßl_¢v_wrôe
–
	`devIRKNvID
(
idx
), 
KEYLEN
, 
pIRK
 );

1324 i‡–
pSRK
 )

1326 
VOID
 
	`oßl_¢v_wrôe
–
	`devCSRKNvID
(
idx
), 
KEYLEN
, 
pSRK
 );

1327 
VOID
 
	`oßl_¢v_wrôe
–
	`devSignCou¡îNvID
(
idx
),  ( 
uöt32
 ), &
signCou¡î
 );

1332 
VOID
 
	`oßl_mem£t
–
ch¨Cfg
, 0xFF,  ( charCfg ) );

1334 
VOID
 
	`oßl_¢v_wrôe
–
	`g©tCfgNvID
(
idx
),  ( 
ch¨Cfg
 ), charCfg );

1337 
VOID
 
	`oßl_mem˝y
–&(
b⁄ds
[
idx
]), 
pB⁄dRec
,  ( 
g≠B⁄dRec_t
 ) );

1339 i‡–
autoSyncWhôeLi°
 )

1341 
	`g≠B⁄dMgr_SyncWhôeLi°
();

1345 
	`g≠B⁄dSëupPrivFœg
();

1348  ( 
idx
 );

1349 
	}
}

1360 
uöt8
 
	$g≠B⁄dMgrGëSèãFœgs
–
uöt8
 
idx
 )

1362 
g≠B⁄dRec_t
 
b⁄dRec
;

1364 i‡–
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
 )

1366  ( 
b⁄dRec
.
°©eFœgs
 );

1370 
	}
}

1383 
bSètus_t
 
	$g≠B⁄dMgrGëPublicAddr
–
uöt8
 
idx
, uöt8 *
pAddr
 )

1385 
bSètus_t
 
°©
;

1386 
g≠B⁄dRec_t
 
b⁄dRec
;

1389 i‡–(
idx
 >
GAP_BONDINGS_MAX
Ë|| (
pAddr
 =
NULL
) )

1391  ( 
INVALIDPARAMETER
 );

1394 
°©
 = 
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 );

1396 i‡–
°©
 =
SUCCESS
 )

1398 
VOID
 
	`oßl_mem˝y
–
pAddr
, 
b⁄dRec
.
publicAddr
, 
B_ADDR_LEN
 );

1401  ( 
°©
 );

1402 
	}
}

1415 
uöt8
 
	$g≠B⁄dMgrFödRec⁄√˘Addr
–
uöt8
 *
pRec⁄√˘Addr
 )

1418  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

1421 i‡–
	`oßl_memcmp
–
b⁄ds
[
idx
].
ªc⁄√˘Addr
, 
pRec⁄√˘Addr
, 
B_ADDR_LEN
 ) )

1423  ( 
idx
 );

1427  ( 
GAP_BONDINGS_MAX
 );

1428 
	}
}

1440 
uöt8
 
	$g≠B⁄dMgrFödAddr
–
uöt8
 *
pDevAddr
 )

1443  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

1446 i‡–
	`oßl_memcmp
–
b⁄ds
[
idx
].
publicAddr
, 
pDevAddr
, 
B_ADDR_LEN
 ) )

1448  ( 
idx
 );

1452  ( 
GAP_BONDINGS_MAX
 );

1453 
	}
}

1466 
uöt8
 
	$g≠B⁄dMgrResﬁvePriv©eAddr
–
uöt8
 *
pDevAddr
 )

1468  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

1470 
uöt8
 
IRK
[
KEYLEN
];

1473 i‡–
	`oßl_¢v_ªad
–
	`devIRKNvID
(
idx
), 
KEYLEN
, 
IRK
 ) =
SUCCESS
 )

1475 i‡––
	`oßl_isbuf£t
–
IRK
, 0xFF, 
KEYLEN
 ) =
FALSE
 ) &&

1476 –
	`GAP_ResﬁvePriv©eAddr
–
IRK
, 
pDevAddr
 ) =
SUCCESS
 ) )

1478  ( 
idx
 );

1483  ( 
GAP_BONDINGS_MAX
 );

1484 
	}
}

1495 
	$g≠B⁄dMgrRódB⁄ds
( )

1497  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

1500 i‡–
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
), –
g≠B⁄dRec_t
 ), &(
b⁄ds
[idx]ËË!
SUCCESS
 )

1503 
VOID
 
	`oßl_mem£t
–
b⁄ds
[
idx
].
publicAddr
, 0xFF, 
B_ADDR_LEN
 );

1504 
VOID
 
	`oßl_mem£t
–
b⁄ds
[
idx
].
ªc⁄√˘Addr
, 0xFF, 
B_ADDR_LEN
 );

1505 
b⁄ds
[
idx
].
°©eFœgs
 = 0;

1509 i‡–
autoSyncWhôeLi°
 )

1511 
	`g≠B⁄dMgr_SyncWhôeLi°
();

1515 
	`g≠B⁄dSëupPrivFœg
();

1516 
	}
}

1528 
uöt8
 
	$g≠B⁄dMgrFödEm±y
( )

1531  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

1534 i‡–
	`oßl_isbuf£t
–
b⁄ds
[
idx
].
publicAddr
, 0xFF, 
B_ADDR_LEN
 ) )

1536  ( 
idx
 );

1540  ( 
GAP_BONDINGS_MAX
 );

1541 
	}
}

1553 
uöt8
 
	$g≠B⁄dMgrB⁄dTŸÆ
( )

1555 
uöt8
 
numB⁄ds
 = 0;

1558  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

1561 i‡–
	`oßl_isbuf£t
–
b⁄ds
[
idx
].
publicAddr
, 0xFF, 
B_ADDR_LEN
 ) =
FALSE
 )

1563 
numB⁄ds
++;

1567  ( 
numB⁄ds
 );

1568 
	}
}

1580 
bSètus_t
 
	$g≠B⁄dMgrEø£AŒB⁄dögs
( )

1582 
bSètus_t
 
°©
 = 
SUCCESS
;

1585  
uöt8
 
idx
 = 0; (idx < 
GAP_BONDINGS_MAX
Ë&& (
°©
 =
SUCCESS
); idx++ )

1588 
°©
 = 
	`g≠B⁄dMgrEø£B⁄dög
–
idx
 );

1591  ( 
°©
 );

1592 
	}
}

1604 
bSètus_t
 
	$g≠B⁄dMgrEø£B⁄dög
–
uöt8
 
idx
 )

1606 
bSètus_t
 
ªt
;

1607 
g≠B⁄dRec_t
 
b⁄dRec
;

1610 i‡––
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
 )

1611 && (
	`oßl_isbuf£t
–
b⁄dRec
.
publicAddr
, 0xFF, 
B_ADDR_LEN
 ) =
FALSE
) )

1613 
g≠B⁄dLTK_t
 
…k
;

1614 
g≠B⁄dCh¨Cfg_t
 
ch¨Cfg
[
GAP_CHAR_CFG_MAX
];

1616 
VOID
 
	`oßl_mem£t
–&
b⁄dRec
, 0xFF,  ( 
g≠B⁄dRec_t
 ) );

1617 
VOID
 
	`oßl_mem£t
–&
…k
, 0xFF,  ( 
g≠B⁄dLTK_t
 ) );

1619 
VOID
 
	`oßl_mem£t
–
ch¨Cfg
, 0xFF,  ( charCfg ) );

1622 
ªt
 = 
	`oßl_¢v_wrôe
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 );

1623 
ªt
 |
	`oßl_¢v_wrôe
–
	`loˇlLTKNvID
(
idx
),  ( 
g≠B⁄dLTK_t
 ), &
…k
 );

1624 
ªt
 |
	`oßl_¢v_wrôe
–
	`devLTKNvID
(
idx
),  ( 
g≠B⁄dLTK_t
 ), &
…k
 );

1625 
ªt
 |
	`oßl_¢v_wrôe
–
	`devIRKNvID
(
idx
), 
KEYLEN
, 
…k
.
LTK
 );

1626 
ªt
 |
	`oßl_¢v_wrôe
–
	`devCSRKNvID
(
idx
), 
KEYLEN
, 
…k
.
LTK
 );

1627 
ªt
 |
	`oßl_¢v_wrôe
–
	`devSignCou¡îNvID
(
idx
),  ( 
uöt32
 ), 
…k
.
LTK
 );

1630 
ªt
 |
	`oßl_¢v_wrôe
–
	`g©tCfgNvID
(
idx
),  ( 
ch¨Cfg
 ), charCfg );

1634 
ªt
 = 
SUCCESS
;

1637  ( 
ªt
 );

1638 
	}
}

1645 
	$GAPB⁄dMgr_Inô
–
uöt8
 
èsk_id
 )

1647 
g≠B⁄dMgr_TaskID
 = 
èsk_id
;

1650 
	`g≠B⁄dMgrRódB⁄ds
();

1651 
	}
}

1658 
uöt16
 
	$GAPB⁄dMgr_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

1660 
VOID
 
èsk_id
;

1662 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

1664 
uöt8
 *
pMsg
;

1666 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
g≠B⁄dMgr_TaskID
 )Ë!
NULL
 )

1668 
	`g≠B⁄dMgr_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

1671 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

1675  (
evíts
 ^ 
SYS_EVENT_MSG
);

1678 i‡–
evíts
 & 
GAP_BOND_SYNC_CC_EVT
 )

1681 
	`g≠B⁄dMgr_SyncCh¨Cfg
–
c⁄√˘i⁄H™dÀ
 );

1683  (
evíts
 ^ 
GAP_BOND_SYNC_CC_EVT
);

1688 
	}
}

1699 
	$g≠B⁄dMgr_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

1701  
pMsg
->
evít
 )

1703 
GAP_MSG_EVENT
:

1704 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

1707 
GATT_MSG_EVENT
:

1708 
	`g≠B⁄dMgr_Pro˚ssGATTMsg
–(
g©tMsgEvít_t
 *)
pMsg
 );

1711 
GATT_SERV_MSG_EVENT
:

1712 
	`g≠B⁄dMgr_Pro˚ssGATTSîvMsg
–(
g©tEvítHdr_t
 *)
pMsg
 );

1718 
	}
}

1730 
uöt8
 
	$GAPB⁄dMgr_CheckNVLí
–
uöt8
 
id
, uöt8 
Àn
 )

1732 
uöt8
 
°©
 = 
FAILURE
;

1735  (
id
 - 
BLE_NVID_GAP_BOND_START
Ë% 
GAP_BOND_REC_IDS
 )

1737 
GAP_BOND_REC_ID_OFFSET
:

1738 i‡–
Àn
 = ( 
g≠B⁄dRec_t
 ) )

1740 
°©
 = 
SUCCESS
;

1744 
GAP_BOND_LOCAL_LTK_OFFSET
:

1745 
GAP_BOND_DEV_LTK_OFFSET
:

1746 i‡–
Àn
 = ( 
g≠B⁄dLTK_t
 ) )

1748 
°©
 = 
SUCCESS
;

1752 
GAP_BOND_DEV_IRK_OFFSET
:

1753 
GAP_BOND_DEV_CSRK_OFFSET
:

1754 i‡–
Àn
 =
KEYLEN
 )

1756 
°©
 = 
SUCCESS
;

1760 
GAP_BOND_DEV_SIGN_COUNTER_OFFSET
:

1761 i‡–
Àn
 = ( 
uöt32
 ) )

1763 
°©
 = 
SUCCESS
;

1771  ( 
°©
 );

1772 
	}
}

1783 
	$g≠B⁄dMgr_Pro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 )

1786  
pMsg
->
mëhod
 )

1788 
ATT_HANDLE_VALUE_CFM
:

1790 
VOID
 
	`GAPB⁄dMgr_Sîvi˚Ch™geInd
–
pMsg
->
c⁄nH™dÀ
, 0x00 );

1797 
	}
}

1808 
	$g≠B⁄dMgr_Pro˚ssGATTSîvMsg
–
g©tEvítHdr_t
 *
pMsg
 )

1811  
pMsg
->
mëhod
 )

1813 
GATT_CLIENT_CHAR_CFG_UPDATED_EVENT
:

1815 
g©tClõ¡Ch¨CfgUpd©edEvít_t
 *
pEvít
 = (g©tClõ¡Ch¨CfgUpd©edEvít_à*)
pMsg
;

1817 
VOID
 
	`GAPB⁄dMgr_Upd©eCh¨Cfg
–
pEvít
->
c⁄nH™dÀ
,ÖEvít->
©åH™dÀ
,ÖEvít->
vÆue
 );

1825 
	}
}

1836 
	$g≠B⁄dMgrSídSîvi˚Ch™ge
–
lökDBIãm_t
 *
pLökIãm
 )

1838 
VOID
 
	`GATTSîvAµ_SídSîvi˚Ch™gedInd
–
pLökIãm
->
c⁄√˘i⁄H™dÀ
,

1839 
g≠B⁄dMgr_TaskID
 );

1840 
	}
}

1851 
	$g≠B⁄dSëupPrivFœg
( )

1853 
uöt8
 
¥ivFœgPr›
;

1855 i‡–
	`g≠B⁄dMgrB⁄dTŸÆ
() > 1 )

1857 
¥ivFœgPr›
 = 
GATT_PROP_READ
;

1861 
¥ivFœgPr›
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

1865 
VOID
 
	`GGS_SëP¨amëî
–
GGS_PERI_PRIVACY_FLAG_PROPS
,  ( 
uöt8
 ), &
¥ivFœgPr›
 );

1866 
	}
}

1880 
	$g≠B⁄dMgrAuthítiˇã
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
addrTy≥
,

1881 
g≠PaúögReq_t
 *
pPaúReq
 )

1883 
g≠AuthP¨ams_t
 
∑øms
;

1885 
VOID
 
	`oßl_mem£t
–&
∑øms
, 0,  ( 
g≠AuthP¨ams_t
 ) );

1888 
∑øms
.
c⁄√˘i⁄H™dÀ
 = 
c⁄nH™dÀ
;

1889 
∑øms
.
£cReqs
.
ioC≠s
 = 
g≠B⁄d_IOC≠
;

1890 
∑øms
.
£cReqs
.
oobAvaûabÀ
 = 
g≠B⁄d_OOBD©aFœg
;

1891 
∑øms
.
£cReqs
.
maxEncKeySize
 = 
g≠B⁄d_KeySize
;

1893 
∑øms
.
£cReqs
.
keyDi°
.
sEncKey
 = (
g≠B⁄d_KeyDi°Li°
 & 
GAPBOND_KEYDIST_SENCKEY
Ë? 
TRUE
 : 
FALSE
;

1894 
∑øms
.
£cReqs
.
keyDi°
.
sIdKey
 = (
g≠B⁄d_KeyDi°Li°
 & 
GAPBOND_KEYDIST_SIDKEY
Ë? 
TRUE
 : 
FALSE
;

1895 
∑øms
.
£cReqs
.
keyDi°
.
mEncKey
 = (
g≠B⁄d_KeyDi°Li°
 & 
GAPBOND_KEYDIST_MENCKEY
Ë? 
TRUE
 : 
FALSE
;

1896 
∑øms
.
£cReqs
.
keyDi°
.
mIdKey
 = (
g≠B⁄d_KeyDi°Li°
 & 
GAPBOND_KEYDIST_MIDKEY
Ë? 
TRUE
 : 
FALSE
;

1897 
∑øms
.
£cReqs
.
keyDi°
.
mSign
 = (
g≠B⁄d_KeyDi°Li°
 & 
GAPBOND_KEYDIST_MSIGN
Ë? 
TRUE
 : 
FALSE
;

1898 
∑øms
.
£cReqs
.
keyDi°
.
sSign
 = (
g≠B⁄d_KeyDi°Li°
 & 
GAPBOND_KEYDIST_SSIGN
Ë? 
TRUE
 : 
FALSE
;

1901 i‡–
g≠B⁄d_OOBD©aFœg
 )

1903 
VOID
 
	`oßl_mem˝y
–
∑øms
.
£cReqs
.
oob
, 
g≠B⁄d_OOBD©a
, 
KEYLEN
 );

1906 i‡–
g≠B⁄d_B⁄dög
 && 
addrTy≥
 !
ADDRTYPE_PUBLIC
 )

1909 
∑øms
.
£cReqs
.
keyDi°
.
sIdKey
 = 
TRUE
;

1912 
∑øms
.
£cReqs
.
authReq
 |(
g≠B⁄d_B⁄dög
Ë? 
SM_AUTH_STATE_BONDING
 : 0;

1913 
∑øms
.
£cReqs
.
authReq
 |(
g≠B⁄d_MITM
Ë? 
SM_AUTH_STATE_AUTHENTICATED
 : 0;

1915 
VOID
 
	`GAP_Authítiˇã
–&
∑øms
, 
pPaúReq
 );

1916 
	}
}

1918 #i‡–
HOST_CONFIG
 & 
PERIPHERAL_CFG
 )

1928 
	$g≠B⁄dMgrSœveSecurôyReq
–
uöt16
 
c⁄nH™dÀ
 )

1930 
uöt8
 
authReq
 = 0;

1932 
authReq
 |(
g≠B⁄d_B⁄dög
Ë? 
SM_AUTH_STATE_BONDING
 : 0;

1933 
authReq
 |(
g≠B⁄d_MITM
Ë? 
SM_AUTH_STATE_AUTHENTICATED
 : 0;

1935 
VOID
 
	`GAP_SídSœveSecurôyReque°
–
c⁄nH™dÀ
, 
authReq
 );

1936 
	}
}

1952 
	$g≠B⁄dMgrB⁄dReq
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
idx
, uöt8 
°©eFœgs
,

1953 
uöt8
 
rﬁe
, uöt8 
°¨tEn¸y±i⁄
 )

1955 
smSecurôyInfo_t
 
…k
;

1956 
oßlSnvId_t
 
nvId
;

1958 i‡–
rﬁe
 =
GAP_PROFILE_CENTRAL
 )

1960 
nvId
 = 
	`devLTKNvID
–
idx
 );

1964 
nvId
 = 
	`loˇlLTKNvID
–
idx
 );

1968 
VOID
 
	`oßl_mem£t
–&
…k
, 0,  ( 
smSecurôyInfo_t
 ) );

1970 i‡–
	`oßl_¢v_ªad
–
nvId
,  ( 
smSecurôyInfo_t
 ), &
…k
 ) =
SUCCESS
 )

1972 i‡–(
…k
.
keySize
 >
MIN_ENC_KEYSIZE
Ë&& (…k.keySizê<
MAX_ENC_KEYSIZE
) )

1974 
VOID
 
	`GAP_B⁄d
–
c⁄nH™dÀ
,

1975 ((
°©eFœgs
 & 
GAP_BONDED_STATE_AUTHENTICATED
Ë? 
TRUE
 : 
FALSE
),

1976 &
…k
, 
°¨tEn¸y±i⁄
 );

1979 
	}
}

1990 
	$g≠B⁄dMgr_SyncWhôeLi°
( )

1993 
VOID
 
	`HCI_LE_CÀ¨WhôeLi°Cmd
();

1996  
uöt8
 
i
 = 0; i < 
GAP_BONDINGS_MAX
; i++)

1999 i‡–
	`oßl_isbuf£t
–
b⁄ds
[
i
].
publicAddr
, 0xFF, 
B_ADDR_LEN
 ) =
FALSE
 )

2001 
VOID
 
	`HCI_LE_AddWhôeLi°Cmd
–
HCI_PUBLIC_DEVICE_ADDRESS
, 
b⁄ds
[
i
].
publicAddr
 );

2004 
	}
}

2016 
	$g≠B⁄dMgr_SyncCh¨Cfg
–
uöt16
 
c⁄nH™dÀ
 )

2018 
g©tAâribuã_t
 *
pAâr
;

2019 
uöt16
 
£rvi˚
;

2028 
pAâr
 = 
	`GATT_FödH™dÀUUID
–
GATT_MIN_HANDLE
, 
GATT_MAX_HANDLE
,

2029 
˛õ¡Ch¨CfgUUID
, 
ATT_BT_UUID_SIZE
, &
£rvi˚
 );

2030  ( 
pAâr
 !
NULL
 ) )

2032 
uöt8
 
Àn
;

2033 
uöt8
 
©åVÆ
[
ATT_BT_UUID_SIZE
];

2037 i‡–
	`GATTSîvAµ_RódAâr
–
c⁄nH™dÀ
, 
pAâr
, 
£rvi˚
, 
©åVÆ
,

2038 &
Àn
, 0, 
ATT_BT_UUID_SIZE
 ) =
SUCCESS
 )

2040 
uöt16
 
vÆue
 = 
	`BUILD_UINT16
(
©åVÆ
[0],áttrVal[1]);

2042 i‡–
vÆue
 !
GATT_CFG_NO_OPERATION
 )

2045 
VOID
 
	`GAPB⁄dMgr_Upd©eCh¨Cfg
–
c⁄nH™dÀ
, 
pAâr
->
h™dÀ
, 
vÆue
 );

2050 
pAâr
 = 
	`GATT_FödNextAâr
–pAâr, 
GATT_MAX_HANDLE
, 
£rvi˚
, 
NULL
 );

2052 
	}
}

	@Projects/ble/Profiles/Roles/gapbondmgr.h

59 #i‚de‡
GAPBONDMGR_H


60 
	#GAPBONDMGR_H


	)

62 #ifde‡
__˝lu•lus


70 
	~"g≠.h
"

76 #i‡!
deföed
 ( 
GAP_BONDINGS_MAX
 )

77 
	#GAP_BONDINGS_MAX
 10

79 

	)

80 #i‡!
deföed
 ( 
GAP_CHAR_CFG_MAX
 )

81 
	#GAP_CHAR_CFG_MAX
 4

83 

	)

92 
	#GAPBOND_PAIRING_MODE
 0x400

93 
	#GAPBOND_INITIATE_WAIT
 0x401

94 
	#GAPBOND_MITM_PROTECTION
 0x402

95 
	#GAPBOND_IO_CAPABILITIES
 0x403

96 
	#GAPBOND_OOB_ENABLED
 0x404

97 
	#GAPBOND_OOB_DATA
 0x405

98 
	#GAPBOND_BONDING_ENABLED
 0x406

99 
	#GAPBOND_KEY_DIST_LIST
 0x407

100 
	#GAPBOND_DEFAULT_PASSCODE
 0x408

101 
	#GAPBOND_ERASE_ALLBONDS
 0x409

102 
	#GAPBOND_AUTO_FAIL_PAIRING
 0x40A

103 
	#GAPBOND_AUTO_FAIL_REASON
 0x40B

104 
	#GAPBOND_KEYSIZE
 0x40C

105 
	#GAPBOND_AUTO_SYNC_WL
 0x40D

106 
	#GAPBOND_BOND_COUNT
 0x40E

107 
	#GAPBOND_BOND_FAIL_ACTION
 0x40F

108 

	)

113 
	#GAPBOND_PAIRING_MODE_NO_PAIRING
 0x00

114 
	#GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
 0x01

115 
	#GAPBOND_PAIRING_MODE_INITIATE
 0x02

116 

	)

121 
	#GAPBOND_IO_CAP_DISPLAY_ONLY
 0x00

122 
	#GAPBOND_IO_CAP_DISPLAY_YES_NO
 0x01

123 
	#GAPBOND_IO_CAP_KEYBOARD_ONLY
 0x02

124 
	#GAPBOND_IO_CAP_NO_INPUT_NO_OUTPUT
 0x03

125 
	#GAPBOND_IO_CAP_KEYBOARD_DISPLAY
 0x04

126 

	)

131 
	#GAPBOND_KEYDIST_SENCKEY
 0x01

132 
	#GAPBOND_KEYDIST_SIDKEY
 0x02

133 
	#GAPBOND_KEYDIST_SSIGN
 0x04

134 
	#GAPBOND_KEYDIST_MENCKEY
 0x08

135 
	#GAPBOND_KEYDIST_MIDKEY
 0x10

136 
	#GAPBOND_KEYDIST_MSIGN
 0x20

137 

	)

143 
	#GAPBOND_PAIRING_STATE_STARTED
 0x00

144 
	#GAPBOND_PAIRING_STATE_COMPLETE
 0x01

145 
	#GAPBOND_PAIRING_STATE_BONDED
 0x02

146 

	)

151 
	#SMP_PAIRING_FAILED_PASSKEY_ENTRY_FAILED
 0x01

152 
	#SMP_PAIRING_FAILED_OOB_NOT_AVAIL
 0x02

153 
	#SMP_PAIRING_FAILED_AUTH_REQ
 0x03

154 
	#SMP_PAIRING_FAILED_CONFIRM_VALUE
 0x04

155 
	#SMP_PAIRING_FAILED_NOT_SUPPORTED
 0x05

156 
	#SMP_PAIRING_FAILED_ENC_KEY_SIZE
 0x06

157 
	#SMP_PAIRING_FAILED_CMD_NOT_SUPPORTED
 0x07

158 
	#SMP_PAIRING_FAILED_UNSPECIFIED
 0x08

159 
	#SMP_PAIRING_FAILED_REPEATED_ATTEMPTS
 0x09

160 

	)

165 
	#GAPBOND_FAIL_NO_ACTION
 0x00

166 
	#GAPBOND_FAIL_INITIATE_PAIRING
 0x01

167 
	#GAPBOND_FAIL_TERMINATE_LINK
 0x02

168 
	#GAPBOND_FAIL_TERMINATE_ERASE_BONDS
 0x03

169 

	)

179 (*
p‚PasscodeCB_t
)

181 
	tuöt8
 *
	tdevi˚Addr
,

182 
	tuöt16
 
	tc⁄√˘i⁄H™dÀ
,

183 
	tuöt8
 
	tuiI≈uts
,

184 
	tuöt8
 
	tuiOuçuts


190 (*
p‚PaúSèãCB_t
)

192 
	tuöt16
 
	tc⁄√˘i⁄H™dÀ
,

193 
	tuöt8
 
	t°©e
,

194 
	tuöt8
 
	t°©us


202 
p‚PasscodeCB_t
 
∑sscodeCB
;

203 
p‚PaúSèãCB_t
 
∑úSèãCB
;

204 } 
	tg≠B⁄dCBs_t
;

237 
bSètus_t
 
GAPB⁄dMgr_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 );

254 
bSètus_t
 
GAPB⁄dMgr_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 );

269 
bSètus_t
 
GAPB⁄dMgr_LökE°
–
uöt8
 
addrTy≥
, uöt8 *
pDevAddr
, 
uöt16
 
c⁄nH™dÀ
, uöt8 
rﬁe
 );

281 
uöt8
 
GAPB⁄dMgr_ResﬁveAddr
–uöt8 
addrTy≥
, uöt8 *
pDevAddr
, uöt8 *
pResﬁvedAddr
 );

294 
bSètus_t
 
GAPB⁄dMgr_Sîvi˚Ch™geInd
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
£tP¨am
 );

308 
bSètus_t
 
GAPB⁄dMgr_Upd©eCh¨Cfg
–
uöt16
 
c⁄√˘i⁄H™dÀ
, uöt16 
©åH™dÀ
, uöt16 
vÆue
 );

320 
GAPB⁄dMgr_Regi°î
–
g≠B⁄dCBs_t
 *
pCB
 );

333 
bSètus_t
 
GAPB⁄dMgr_PasscodeR•
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
°©us
, 
uöt32
 
∑sscode
 );

346 
GAPB⁄dMgr_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 );

356 
uöt8
 
GAPB⁄dMgr_CheckNVLí
–uöt8 
id
, uöt8 
Àn
 );

382 
GAPB⁄dMgr_Inô
–
uöt8
 
èsk_id
 );

398 
uöt16
 
GAPB⁄dMgr_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

403 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Roles/gapperiphbondmgr.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"oßl_¢v.h
"

46 
	~"g≠.h
"

47 
	~"lökdb.h
"

48 
	~"g©t.h
"

50 
	~"g©t£rv≠p.h
"

51 
	~"g≠g©t£rvî.h
"

52 
	~"g≠≥rùhb⁄dmgr.h
"

64 
	#GAP_BONDED_STATE_AUTHENTICATED
 0x0001

	)

65 
	#GAP_BONDED_STATE_SERVICE_CHANGED
 0x0002

	)

91 
	#GAP_BOND_REC_ID_OFFSET
 0

92 
	#GAP_BOND_LOCAL_LTK_OFFSET
 1

93 
	#GAP_BOND_DEV_LTK_OFFSET
 2

94 
	#GAP_BOND_DEV_IRK_OFFSET
 3

95 
	#GAP_BOND_DEV_CSRK_OFFSET
 4

96 
	#GAP_BOND_DEV_SIGN_COUNTER_OFFSET
 5

97 

	)

98 
	#GAP_BOND_REC_IDS
 6

	)

101 
	#ˇlcNvID
(
Idx
, 
off£t
Ë(((((IdxË* 
GAP_BOND_REC_IDS
Ë+ (off£t))Ë+ 
BLE_NVID_GAP_BOND_START
)

	)

102 
	#maöRec‹dNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_REC_ID_OFFSET
))

	)

103 
	#loˇlLTKNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_LOCAL_LTK_OFFSET
))

	)

104 
	#devLTKNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_DEV_LTK_OFFSET
))

	)

105 
	#devIRKNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_DEV_IRK_OFFSET
))

	)

106 
	#devCSRKNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_DEV_CSRK_OFFSET
))

	)

107 
	#devSignCou¡îNvID
(
b⁄dIdx
Ë(
	`ˇlcNvID
((b⁄dIdx), 
GAP_BOND_DEV_SIGN_COUNTER_OFFSET
))

	)

110 
	#MIN_ENC_KEYSIZE
 7

111 
	#MAX_ENC_KEYSIZE
 16

112 

	)

121 
uöt8
 
	mLTK
[
KEYLEN
];

122 
uöt16
 
	mdiv
;

123 
uöt8
 
	mønd
[
B_RANDOM_NUM_SIZE
];

124 
uöt8
 
	mkeySize
;

125 } 
	tg≠B⁄dLTK_t
;

130 
uöt8
 
	mpublicAddr
[
B_ADDR_LEN
];

131 
uöt8
 
	mªc⁄√˘Addr
[
B_ADDR_LEN
];

132 
uöt16
 
	m°©eFœgs
;

133 } 
	tg≠B⁄dRec_t
;

150 
uöt8
 
	gg≠B⁄dMgr_TaskID
;

153 
uöt8
 
	gg≠B⁄d_PaúögMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

154 
uöt16
 
	gg≠B⁄d_InôüãWaô
 = 1000;

155 
uöt8
 
	gg≠B⁄d_MITM
 = 
FALSE
;

156 
uöt8
 
	gg≠B⁄d_IOC≠
 = 
GAPBOND_IO_CAP_DISPLAY_ONLY
;

157 
uöt8
 
	gg≠B⁄d_OOBD©aFœg
 = 
FALSE
;

158 
uöt8
 
	gg≠B⁄d_OOBD©a
[
KEYLEN
] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

159 
uöt8
 
	gg≠B⁄d_B⁄dög
 = 
FALSE
;

160 
uöt8
 
	gg≠B⁄d_AutoFaû
 = 
FALSE
;

161 
uöt8
 
	gg≠B⁄d_AutoFaûRós⁄
 = 
SMP_PAIRING_FAILED_NOT_SUPPORTED
;

162 
uöt8
 
	gg≠B⁄d_KeyDi°Li°
 =

164 
GAPBOND_KEYDIST_SENCKEY


165 | 
GAPBOND_KEYDIST_SIDKEY


168 | 
GAPBOND_KEYDIST_MIDKEY


169 | 
GAPBOND_KEYDIST_MSIGN


171 
uöt32
 
	gg≠B⁄d_Passcode
 = 0;

172 
uöt8
 
	gg≠B⁄d_KeySize
 = 
MAX_ENC_KEYSIZE
;

174 
g≠B⁄dCBs_t
 *
	gpG≠B⁄dCB
 = 
NULL
;

179 
uöt8
 
g≠B⁄dMgrCh™geSèã
–uöt8 
idx
, 
uöt16
 
°©e
, uöt8 
£t
 );

180 
uöt8
 
g≠B⁄dMgrAddB⁄d
–
g≠B⁄dRec_t
 *
pB⁄dRec
,

181 
g≠B⁄dLTK_t
 *
pLoˇlLTK
, g≠B⁄dLTK_à*
pDevLTK
,

182 
uöt8
 *
pIRK
, uöt8 *
pSRK
, 
uöt32
 
signCou¡î
 );

183 
uöt8
 
g≠B⁄dMgrGëSèãFœgs
–uöt8 
idx
 );

184 
bSètus_t
 
g≠B⁄dMgrGëPublicAddr
–
uöt8
 
idx
, uöt8 *
pAddr
 );

185 
uöt8
 
g≠B⁄dMgrFödRec⁄√˘Addr
–uöt8 *
pRec⁄√˘Addr
 );

186 
uöt8
 
g≠B⁄dMgrFödAddr
–uöt8 *
pDevAddr
 );

187 
uöt8
 
g≠B⁄dMgrFödEm±y
( );

188 
uöt8
 
g≠B⁄dMgrB⁄dTŸÆ
( );

189 
bSètus_t
 
g≠B⁄dMgrEø£AŒB⁄dögs
( );

190 
bSètus_t
 
g≠B⁄dMgrEø£B⁄dög
–
uöt8
 
idx
 );

191 
g≠B⁄dMgr_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

192 
g≠B⁄dMgrSídSîvi˚Ch™ge
–
lökDBIãm_t
 *
pLökIãm
 );

193 
g≠B⁄dMgr_Pro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 );

194 
g≠B⁄dSëupPrivFœg
( );

209 
bSètus_t
 
	$GAPB⁄dMgr_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 )

211 
bSètus_t
 
ªt
 = 
SUCCESS
;

213  
∑øm
 )

215 
GAPBOND_PAIRING_MODE
:

216 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAPBOND_PAIRING_MODE_INITIATE
) )

218 
g≠B⁄d_PaúögMode
 = *((
uöt8
*)
pVÆue
);

222 
ªt
 = 
bÀInvÆidR™ge
;

226 
GAPBOND_INITIATE_WAIT
:

227 i‡–
Àn
 = ( 
uöt16
 ) )

229 
g≠B⁄d_InôüãWaô
 = *((
uöt8
*)
pVÆue
);

233 
ªt
 = 
bÀInvÆidR™ge
;

237 
GAPBOND_MITM_PROTECTION
:

238 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

240 
g≠B⁄d_MITM
 = *((
uöt8
*)
pVÆue
);

244 
ªt
 = 
bÀInvÆidR™ge
;

248 
GAPBOND_IO_CAPABILITIES
:

249 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAPBOND_IO_CAP_KEYBOARD_DISPLAY
) )

251 
g≠B⁄d_IOC≠
 = *((
uöt8
*)
pVÆue
);

255 
ªt
 = 
bÀInvÆidR™ge
;

259 
GAPBOND_OOB_ENABLED
:

260 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

262 
g≠B⁄d_OOBD©aFœg
 = *((
uöt8
*)
pVÆue
);

266 
ªt
 = 
bÀInvÆidR™ge
;

270 
GAPBOND_OOB_DATA
:

271 i‡–
Àn
 =
KEYLEN
 )

273 
VOID
 
	`oßl_mem˝y
–
g≠B⁄d_OOBD©a
, 
pVÆue
, 
KEYLEN
 ) ;

277 
ªt
 = 
bÀInvÆidR™ge
;

281 
GAPBOND_BONDING_ENABLED
:

282 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

284 
g≠B⁄d_B⁄dög
 = *((
uöt8
*)
pVÆue
);

288 
ªt
 = 
bÀInvÆidR™ge
;

292 
GAPBOND_KEY_DIST_LIST
:

293 i‡–
Àn
 = ( 
uöt8
 ) )

295 
g≠B⁄d_KeyDi°Li°
 = *((
uöt8
*)
pVÆue
);

299 
ªt
 = 
bÀInvÆidR™ge
;

303 
GAPBOND_DEFAULT_PASSCODE
:

304 i‡–(
Àn
 = ( 
uöt32
 ))

305 && (*((
uöt32
*)
pVÆue
Ë<
GAP_PASSCODE_MAX
) )

307 
g≠B⁄d_Passcode
 = *((
uöt32
*)
pVÆue
);

311 
ªt
 = 
bÀInvÆidR™ge
;

315 
GAPBOND_ERASE_ALLBONDS
:

316 i‡–
Àn
 == 0 )

318 
VOID
 
	`g≠B⁄dMgrEø£AŒB⁄dögs
();

322 
ªt
 = 
bÀInvÆidR™ge
;

326 
GAPBOND_AUTO_FAIL_PAIRING
:

327 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

329 
g≠B⁄d_AutoFaû
 = *((
uöt8
*)
pVÆue
);

333 
ªt
 = 
bÀInvÆidR™ge
;

337 
GAPBOND_AUTO_FAIL_REASON
:

338 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
SMP_PAIRING_FAILED_REPEATED_ATTEMPTS
) )

340 
g≠B⁄d_AutoFaûRós⁄
 = *((
uöt8
*)
pVÆue
);

344 
ªt
 = 
bÀInvÆidR™ge
;

348 
GAPBOND_KEYSIZE
:

349 i‡–(
Àn
 = ( 
uöt8
 ))

350 && ((*((
uöt8
*)
pVÆue
Ë>
MIN_ENC_KEYSIZE
Ë&& (*((uöt8*ÌVÆueË<
MAX_ENC_KEYSIZE
)) )

352 
g≠B⁄d_KeySize
 = *((
uöt8
*)
pVÆue
);

356 
ªt
 = 
bÀInvÆidR™ge
;

362 i‡–(
∑øm
 < 
TGAP_PARAMID_MAX
Ë&& (
Àn
 = ( 
uöt16
 )) )

364 
ªt
 = 
	`GAP_SëP¨amVÆue
–
∑øm
, *((
uöt16
*)
pVÆue
) );

368 
ªt
 = 
INVALIDPARAMETER
;

373  ( 
ªt
 );

374 
	}
}

381 
bSètus_t
 
	$GAPB⁄dMgr_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 )

383 
bSètus_t
 
ªt
 = 
SUCCESS
;

385  
∑øm
 )

387 
GAPBOND_PAIRING_MODE
:

388 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_PaúögMode
;

391 
GAPBOND_INITIATE_WAIT
:

392 *((
uöt16
*)
pVÆue
Ë
g≠B⁄d_InôüãWaô
;

395 
GAPBOND_MITM_PROTECTION
:

396 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_MITM
;

399 
GAPBOND_IO_CAPABILITIES
:

400 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_IOC≠
;

403 
GAPBOND_OOB_ENABLED
:

404 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_OOBD©aFœg
;

407 
GAPBOND_OOB_DATA
:

408 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠B⁄d_OOBD©a
, 
KEYLEN
 ) ;

411 
GAPBOND_BONDING_ENABLED
:

412 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_B⁄dög
;

415 
GAPBOND_KEY_DIST_LIST
:

416 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_KeyDi°Li°
;

419 
GAPBOND_DEFAULT_PASSCODE
:

420 *((
uöt32
*)
pVÆue
Ë
g≠B⁄d_Passcode
;

423 
GAPBOND_AUTO_FAIL_PAIRING
:

424 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_AutoFaû
;

427 
GAPBOND_AUTO_FAIL_REASON
:

428 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_AutoFaûRós⁄
;

431 
GAPBOND_KEYSIZE
:

432 *((
uöt8
*)
pVÆue
Ë
g≠B⁄d_KeySize
;

437 i‡–
∑øm
 < 
TGAP_PARAMID_MAX
 )

439 *((
uöt16
*)
pVÆue
Ë
	`GAP_GëP¨amVÆue
–
∑øm
 );

443 
ªt
 = 
INVALIDPARAMETER
;

448  ( 
ªt
 );

449 
	}
}

456 
bSètus_t
 
	$GAPB⁄dMgr_LökE°
–
uöt8
 
addrTy≥
, uöt8 *
pDevAddr
, 
uöt16
 
c⁄nH™dÀ
 )

458 
uöt8
 
idx
;

459 
uöt8
 
publicAddr
[
B_ADDR_LEN
]

462 
idx
 = 
	`GAPB⁄dMgr_ResﬁveAddr
–
addrTy≥
, 
pDevAddr
, 
publicAddr
 );

463 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

466 
uöt8
 
°©eFœgs
;

467 
smSecurôyInfo_t
 
loˇlLTK
;

468 
smSignögInfo_t
 
signögInfo
;

471 
	`oßl_mem£t
–&
loˇlLTK
, 0,  ( 
smSecurôyInfo_t
 ) );

472 
	`oßl_mem£t
–&
signögInfo
, 0,  ( 
smSignögInfo_t
 ) );

475 
°©eFœgs
 = 
	`g≠B⁄dMgrGëSèãFœgs
–
idx
 );

476 i‡–
	`oßl_¢v_ªad
–
	`loˇlLTKNvID
(
idx
),  ( 
smSecurôyInfo_t
 ), &
loˇlLTK
 ) =
SUCCESS
 )

478 i‡–(
loˇlLTK
.
keySize
 >
MIN_ENC_KEYSIZE
Ë&& (loˇlLTK.keySizê<
MAX_ENC_KEYSIZE
) )

481 
VOID
 
	`GAP_B⁄d
–
c⁄nH™dÀ
,

482 ((
°©eFœgs
 & 
GAP_BONDED_STATE_AUTHENTICATED
Ë? 
TRUE
 : 
FALSE
),

483 &
loˇlLTK
 );

488 i‡–
	`oßl_¢v_ªad
–
	`devCSRKNvID
(
idx
), 
KEYLEN
, 
signögInfo
.
§k
 ) =
SUCCESS
 )

490 i‡–
	`oßl_isbuf£t
–
signögInfo
.
§k
, 0xFF, 
KEYLEN
 ) =
FALSE
 )

493 
VOID
 
	`oßl_¢v_ªad
–
	`devSignCou¡îNvID
(
idx
),  ( 
uöt32
 ), &(
signögInfo
.
signCou¡î
) );

494 
VOID
 
	`GAP_Sig«bÀ
–
c⁄nH™dÀ
,

495 ((
°©eFœgs
 & 
GAP_BONDED_STATE_AUTHENTICATED
Ë? 
TRUE
 : 
FALSE
),

496 &
signögInfo
 );

501 i‡–
°©eFœgs
 & 
GAP_BONDED_STATE_SERVICE_CHANGED
 )

503 
VOID
 
	`GATT_Sîvi˚Ch™gedInd
–
c⁄nH™dÀ
, 
g≠B⁄dMgr_TaskID
 );

509 i‡–
g≠B⁄d_PaúögMode
 =
GAPBOND_PAIRING_MODE_INITIATE
 )

516  ( 
SUCCESS
 );

517 
	}
}

524 
uöt8
 
	$GAPB⁄dMgr_ResﬁveAddr
–
uöt8
 
addrTy≥
, uöt8 *
pDevAddr
, uöt8 *
pResﬁvedAddr
 )

526 
uöt8
 
idx
 = 
GAP_BONDINGS_MAX
;

528  
addrTy≥
 )

530 
ADDRTYPE_PUBLIC
:

531 
ADDRTYPE_STATIC
:

532 
idx
 = 
	`g≠B⁄dMgrFödAddr
–
pDevAddr
 );

533 i‡–(
idx
 < 
GAP_BONDINGS_MAX
Ë&& (
pResﬁvedAddr
) )

535 
VOID
 
	`oßl_mem˝y
–
pResﬁvedAddr
, 
pDevAddr
, 
B_ADDR_LEN
 );

539 
ADDRTYPE_PRIVATE_NONRESOLVE
:

541 
idx
 = 
	`g≠B⁄dMgrFödRec⁄√˘Addr
–
pDevAddr
 );

542 i‡–(
idx
 < 
GAP_BONDINGS_MAX
Ë&& (
pResﬁvedAddr
) )

544 
VOID
 
	`g≠B⁄dMgrGëPublicAddr
–
idx
, 
pResﬁvedAddr
 );

548 
ADDRTYPE_PRIVATE_RESOLVE
:

556  ( 
idx
 );

557 
	}
}

564 
bSètus_t
 
	$GAPB⁄dMgr_Sîvi˚Ch™geInd
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
£tP¨am
 )

566 
bSètus_t
 
ªt
 = 
bÀNoResour˚s
;

568 i‡–
c⁄√˘i⁄H™dÀ
 == 0xFFFF )

570 
uöt8
 
idx
;

573  
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

575 i‡–
	`g≠B⁄dMgrCh™geSèã
–
idx
, 
GAP_BONDED_STATE_SERVICE_CHANGED
, 
£tP¨am
 ) )

577 
ªt
 = 
SUCCESS
;

582 i‡–
£tP¨am
 )

585 
	`lökDB_Pîf‹mFunc
–
g≠B⁄dMgrSídSîvi˚Ch™ge
 );

591 
lökDBIãm_t
 *
pLökIãm
 = 
	`lökDB_Föd
–
c⁄√˘i⁄H™dÀ
 );

592 i‡–
pLökIãm
 )

594 
uöt8
 
idx
;

595 
idx
 = 
	`GAPB⁄dMgr_ResﬁveAddr
–
pLökIãm
->
addrTy≥
,ÖLökIãm->
addr
, 
NULL
 );

596 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

599 
VOID
 
	`g≠B⁄dMgrCh™geSèã
–
idx
, 
GAP_BONDED_STATE_SERVICE_CHANGED
, 
£tP¨am
 );

600 
ªt
 = 
SUCCESS
;

604 i‡–
£tP¨am
 )

606 
	`g≠B⁄dMgrSídSîvi˚Ch™ge
–
pLökIãm
 );

611 
ªt
 = 
bÀNŸC⁄√˘ed
;

615  ( 
ªt
 );

616 
	}
}

628 
	$GAPB⁄dMgr_Regi°î
–
g≠B⁄dCBs_t
 *
pCB
 )

630 
pG≠B⁄dCB
 = 
pCB
;

631 
	}
}

644 
bSètus_t
 
	$GAPB⁄dMgr_PasscodeR•
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
°©us
, 
uöt32
 
∑sscode
 )

646 
bSètus_t
 
ªt
 = 
SUCCESS
;

648 i‡–
°©us
 =
SUCCESS
 )

651 
∑sscode
 =Öasscodê% (
GAP_PASSCODE_MAX
 + 1);

653 
ªt
 = 
	`GAP_PasscodeUpd©e
–
∑sscode
, 
c⁄√˘i⁄H™dÀ
 );

654 i‡–
ªt
 !
SUCCESS
 )

656 
VOID
 
	`GAP_Tîmö©eAuth
–
c⁄√˘i⁄H™dÀ
, 
SMP_PAIRING_FAILED_PASSKEY_ENTRY_FAILED
 );

661 
VOID
 
	`GAP_Tîmö©eAuth
–
c⁄√˘i⁄H™dÀ
, 
°©us
 );

664  
ªt
;

665 
	}
}

682 
uöt8
 
	$g≠B⁄dMgrCh™geSèã
–
uöt8
 
idx
, 
uöt16
 
°©e
, uöt8 
£t
 )

684 
g≠B⁄dRec_t
 
b⁄dRec
;

687 i‡–(
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
)

688 && (
	`oßl_isbuf£t
–
b⁄dRec
.
publicAddr
, 0xFF, 
B_ADDR_LEN
 ) =
FALSE
) )

691 
uöt8
 
°©eFœgs
 = 
b⁄dRec
.stateFlags;

692 i‡–
£t
 )

694 
°©eFœgs
 |
°©e
;

698 
°©eFœgs
 &~(
°©e
);

701 i‡–
°©eFœgs
 !
b⁄dRec
.stateFlags )

703 
b⁄dRec
.
°©eFœgs
 = stateFlags;

704 
VOID
 
	`oßl_¢v_wrôe
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 );

706  ( 
TRUE
 );

708  ( 
FALSE
 );

709 
	}
}

725 
uöt8
 
	$g≠B⁄dMgrAddB⁄d
–
g≠B⁄dRec_t
 *
pB⁄dRec
,

726 
g≠B⁄dLTK_t
 *
pLoˇlLTK
, g≠B⁄dLTK_à*
pDevLTK
,

727 
uöt8
 *
pIRK
, uöt8 *
pSRK
, 
uöt32
 
signCou¡î
 )

729 
uöt8
 
idx
;

731 i‡–
pB⁄dRec
 =
NULL
 )

733  ( 
GAP_BONDINGS_MAX
 );

737 
idx
 = 
	`g≠B⁄dMgrFödAddr
–
pB⁄dRec
->
publicAddr
 );

738 i‡–
idx
 >
GAP_BONDINGS_MAX
 )

740 
idx
 = 
	`g≠B⁄dMgrFödEm±y
();

743 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

746 
VOID
 
	`oßl_¢v_wrôe
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), 
pB⁄dRec
 );

749 i‡–
pLoˇlLTK
 )

751 
VOID
 
	`oßl_¢v_wrôe
–
	`loˇlLTKNvID
(
idx
),  ( 
g≠B⁄dLTK_t
 ), 
pLoˇlLTK
 );

756 i‡–
pDevLTK
 )

758 
VOID
 
	`oßl_¢v_wrôe
–
	`devLTKNvID
(
idx
),  ( 
g≠B⁄dLTK_t
 ), 
pDevLTK
 );

762 i‡–
pIRK
 )

764 
VOID
 
	`oßl_¢v_wrôe
–
	`devIRKNvID
(
idx
), 
KEYLEN
, 
pIRK
 );

768 i‡–
pSRK
 )

770 
VOID
 
	`oßl_¢v_wrôe
–
	`devCSRKNvID
(
idx
), 
KEYLEN
, 
pSRK
 );

771 
VOID
 
	`oßl_¢v_wrôe
–
	`devSignCou¡îNvID
(
idx
),  ( 
uöt32
 ), &
signCou¡î
 );

776 
	`g≠B⁄dSëupPrivFœg
();

778  ( 
idx
 );

779 
	}
}

790 
uöt8
 
	$g≠B⁄dMgrGëSèãFœgs
–
uöt8
 
idx
 )

792 
g≠B⁄dRec_t
 
b⁄dRec
;

794 
VOID
 
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 );

796  ( 
b⁄dRec
.
°©eFœgs
 );

798 
	}
}

811 
bSètus_t
 
	$g≠B⁄dMgrGëPublicAddr
–
uöt8
 
idx
, uöt8 *
pAddr
 )

813 
bSètus_t
 
°©
;

814 
g≠B⁄dRec_t
 
b⁄dRec
;

817 i‡–(
idx
 >
GAP_BONDINGS_MAX
Ë|| (
pAddr
 =
NULL
) )

819  ( 
INVALIDPARAMETER
 );

822 
°©
 = 
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 );

824 i‡–
°©
 =
SUCCESS
 )

826 
VOID
 
	`oßl_mem˝y
–
pAddr
, 
b⁄dRec
.
publicAddr
, 
KEYLEN
 );

829  ( 
°©
 );

830 
	}
}

843 
uöt8
 
	$g≠B⁄dMgrFödRec⁄√˘Addr
–
uöt8
 *
pRec⁄√˘Addr
 )

846  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

848 
g≠B⁄dRec_t
 
b⁄dRec
;

851 i‡–(
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
)

852 && (
	`oßl_memcmp
–
b⁄dRec
.
ªc⁄√˘Addr
, 
pRec⁄√˘Addr
, 
KEYLEN
 )) )

854  ( 
idx
 );

858  ( 
GAP_BONDINGS_MAX
 );

859 
	}
}

871 
uöt8
 
	$g≠B⁄dMgrFödAddr
–
uöt8
 *
pDevAddr
 )

874  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

876 
g≠B⁄dRec_t
 
b⁄dRec
;

879 i‡–(
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
)

880 && (
	`oßl_memcmp
–
b⁄dRec
.
publicAddr
, 
pDevAddr
, 
B_ADDR_LEN
 )) )

882  ( 
idx
 );

886  ( 
GAP_BONDINGS_MAX
 );

887 
	}
}

899 
uöt8
 
	$g≠B⁄dMgrFödEm±y
( )

902  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

904 
g≠B⁄dRec_t
 
b⁄dRec
;

907 i‡–(
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
)

908 && (
	`oßl_isbuf£t
–
b⁄dRec
.
publicAddr
, 0xFF, 
B_ADDR_LEN
 )) )

910  ( 
idx
 );

914  ( 
GAP_BONDINGS_MAX
 );

915 
	}
}

927 
uöt8
 
	$g≠B⁄dMgrB⁄dTŸÆ
( )

929 
uöt8
 
b⁄ds
 = 0;

932  
uöt8
 
idx
 = 0; idx < 
GAP_BONDINGS_MAX
; idx++ )

934 
g≠B⁄dRec_t
 
b⁄dRec
;

937 i‡–(
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) =
SUCCESS
)

938 && (
	`oßl_isbuf£t
–
b⁄dRec
.
publicAddr
, 0xFF, 
B_ADDR_LEN
 ) =
FALSE
) )

940 
b⁄ds
++;

944  ( 
b⁄ds
 );

945 
	}
}

957 
bSètus_t
 
	$g≠B⁄dMgrEø£AŒB⁄dögs
( )

959 
bSètus_t
 
°©
 = 
SUCCESS
;

962  
uöt8
 
idx
 = 0; (idx < 
GAP_BONDINGS_MAX
Ë&& (
°©
 =
SUCCESS
); idx++ )

965 
°©
 = 
	`g≠B⁄dMgrEø£B⁄dög
–
idx
 );

969 
	`g≠B⁄dSëupPrivFœg
();

971  ( 
°©
 );

972 
	}
}

984 
bSètus_t
 
	$g≠B⁄dMgrEø£B⁄dög
–
uöt8
 
idx
 )

986 
bSètus_t
 
ªt
;

987 
g≠B⁄dRec_t
 
b⁄dRec
;

988 
g≠B⁄dLTK_t
 
…k
;

990 
VOID
 
	`oßl_mem£t
–&
b⁄dRec
, 0xFF,  ( 
g≠B⁄dRec_t
 ) );

991 
VOID
 
	`oßl_mem£t
–&
…k
, 0xFF,  ( 
g≠B⁄dLTK_t
 ) );

994 
ªt
 = 
	`oßl_¢v_wrôe
–
	`maöRec‹dNvID
(
idx
),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 );

995 
ªt
 |
	`oßl_¢v_wrôe
–
	`loˇlLTKNvID
(
idx
),  ( 
g≠B⁄dLTK_t
 ), &
…k
 );

996 
ªt
 |
	`oßl_¢v_wrôe
–
	`devLTKNvID
(
idx
),  ( 
g≠B⁄dLTK_t
 ), &
…k
 );

997 
ªt
 |
	`oßl_¢v_wrôe
–
	`devIRKNvID
(
idx
), 
KEYLEN
, 
…k
.
LTK
 );

998 
ªt
 |
	`oßl_¢v_wrôe
–
	`devCSRKNvID
(
idx
), 
KEYLEN
, 
…k
.
LTK
 );

999 
ªt
 |
	`oßl_¢v_wrôe
–
	`devSignCou¡îNvID
(
idx
),  ( 
uöt32
 ), 
…k
.
LTK
 );

1002 
	`g≠B⁄dSëupPrivFœg
();

1004  ( 
ªt
 );

1005 
	}
}

1012 
	$GAPB⁄dMgr_Inô
–
uöt8
 
èsk_id
 )

1014 
g≠B⁄dRec_t
 
b⁄dRec
;

1015 
g≠B⁄dMgr_TaskID
 = 
èsk_id
;

1018 i‡–
	`oßl_¢v_ªad
–
	`maöRec‹dNvID
(0),  ( 
g≠B⁄dRec_t
 ), &
b⁄dRec
 ) !
SUCCESS
 )

1022 
VOID
 
	`g≠B⁄dMgrEø£AŒB⁄dögs
();

1026 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_AUTH_TASK_ID
, 
g≠B⁄dMgr_TaskID
 );

1029 
	`g≠B⁄dSëupPrivFœg
();

1030 
	}
}

1037 
uöt16
 
	$GAPB⁄dMgr_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

1039 
VOID
 
èsk_id
;

1041 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

1043 
uöt8
 *
pMsg
;

1045 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
g≠B⁄dMgr_TaskID
 )Ë!
NULL
 )

1047 
	`g≠B⁄dMgr_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

1050 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

1054  (
evíts
 ^ 
SYS_EVENT_MSG
);

1059 
	}
}

1070 
	$g≠B⁄dMgr_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

1072  
pMsg
->
evít
 )

1074 
GAP_MSG_EVENT
:

1075 
	`g≠B⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

1078 
GATT_MSG_EVENT
:

1079 
	`g≠B⁄dMgr_Pro˚ssGATTMsg
–(
g©tMsgEvít_t
 *)
pMsg
 );

1085 
	}
}

1096 
	$g≠B⁄dMgr_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 )

1098  
pMsg
->
›code
 )

1100 
GAP_PASSKEY_NEEDED_EVENT
:

1102 
g≠PasskeyNìdedEvít_t
 *
pPkt
 = (g≠PasskeyNìdedEvít_à*)
pMsg
;

1104 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑sscodeCB
 )

1107 
pG≠B⁄dCB
->
	`∑sscodeCB
–
pPkt
->
devi˚Addr
,ÖPkt->
c⁄√˘i⁄H™dÀ
,ÖPkt->
uiI≈uts
,ÖPkt->
uiOuçuts
 );

1112 i‡–
	`GAP_PasscodeUpd©e
–
g≠B⁄d_Passcode
, 
pPkt
->
c⁄√˘i⁄H™dÀ
 ) !
SUCCESS
 )

1114 
VOID
 
	`GAP_Tîmö©eAuth
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
SMP_PAIRING_FAILED_PASSKEY_ENTRY_FAILED
 );

1120 
GAP_AUTHENTICATION_COMPLETE_EVENT
:

1122 
g≠AuthCom∂ëeEvít_t
 *
pPkt
 = (g≠AuthCom∂ëeEvít_à*)
pMsg
;

1125 i‡–(
pPkt
->
hdr
.
°©us
 =
SUCCESS
Ë&& (pPkt->
authSèã
 & 
SM_AUTH_STATE_BONDING
) )

1127 
g≠B⁄dRec_t
 
b⁄dRec
;

1129 
VOID
 
	`oßl_mem£t
–&
b⁄dRec
, 0,  ( 
g≠B⁄dRec_t
 ) ) ;

1132 i‡–
pPkt
->
pIdítôyInfo
 )

1134 
VOID
 
	`oßl_mem˝y
–
b⁄dRec
.
publicAddr
, 
pPkt
->
pIdítôyInfo
->
bd_addr
, 
B_ADDR_LEN
 );

1138 
lökDBIãm_t
 *
pLökIãm
 = 
	`lökDB_Föd
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

1139 i‡–
pLökIãm
 )

1141 
VOID
 
	`oßl_mem˝y
–
b⁄dRec
.
publicAddr
, 
pLökIãm
->
addr
, 
B_ADDR_LEN
 );

1151 
b⁄dRec
.
°©eFœgs
 |(
pPkt
->
authSèã
 & 
SM_AUTH_STATE_AUTHENTICATED
Ë? 
GAP_BONDED_STATE_AUTHENTICATED
 : 0;

1153 
VOID
 
	`g≠B⁄dMgrAddB⁄d
–&
b⁄dRec
,

1154 (
g≠B⁄dLTK_t
 *)
pPkt
->
pSecurôyInfo
,

1155 (
g≠B⁄dLTK_t
 *)
pPkt
->
pDevSecInfo
,

1156 ((
uöt8
 *)((
pPkt
->
pIdítôyInfo
Ë?ÖPkt->pIdítôyInfo->
úk
 : 
NULL
 )),

1157 ((
uöt8
 *)((
pPkt
->
pSignögInfo
Ë?ÖPkt->pSignögInfo->
§k
 : 
NULL
 )),

1158 ((
uöt32
)((
pPkt
->
pSignögInfo
Ë?ÖPkt->pSignögInfo->
signCou¡î
 : 
GAP_INIT_SIGN_COUNTER
 )) );

1163 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑úSèãCB
 )

1165 
pG≠B⁄dCB
->
	`∑úSèãCB
–
GAPBOND_PAIRING_STATE_COMPLETE
, 
pPkt
->
hdr
.
°©us
 );

1170 
GAP_BOND_COMPLETE_EVENT
:

1174 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑úSèãCB
 && 
pMsg
->
hdr
.
°©us
 =
SUCCESS
 )

1176 
pG≠B⁄dCB
->
	`∑úSèãCB
–
GAPBOND_PAIRING_STATE_BONDED
, 
pMsg
->
hdr
.
°©us
 );

1180 
GAP_SIGNATURE_UPDATED_EVENT
:

1182 
uöt8
 
idx
;

1183 
g≠SignUpd©eEvít_t
 *
pPkt
 = (g≠SignUpd©eEvít_à*)
pMsg
;

1185 
idx
 = 
	`GAPB⁄dMgr_ResﬁveAddr
–
pPkt
->
addrTy≥
,ÖPkt->
devAddr
, 
NULL
 );

1186 i‡–
idx
 < 
GAP_BONDINGS_MAX
 )

1189 
VOID
 
	`oßl_¢v_wrôe
–
	`devSignCou¡îNvID
(
idx
),  ( 
uöt32
 ), &(
pPkt
->
signCou¡î
) );

1194 
GAP_PAIRING_REQ_EVENT
:

1196 
g≠PaúögReqEvít_t
 *
pPkt
 = (g≠PaúögReqEvít_à*)
pMsg
;

1198 i‡–
g≠B⁄d_AutoFaû
 !
FALSE
 )

1201 
VOID
 
	`GAP_Tîmö©eAuth
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
g≠B⁄d_AutoFaûRós⁄
 );

1203 i‡–
g≠B⁄d_PaúögMode
 =
GAPBOND_PAIRING_MODE_NO_PAIRING
 )

1206 
VOID
 
	`GAP_Tîmö©eAuth
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
SMP_PAIRING_FAILED_NOT_SUPPORTED
 );

1210 
g≠AuthP¨ams_t
 
∑øms
;

1211 
lökDBIãm_t
 *
pLökIãm
 = 
	`lökDB_Föd
–
pPkt
->
c⁄√˘i⁄H™dÀ
 );

1214 i‡–
pPkt
->
∑úReq
.
authReq
 & 
SM_AUTH_STATE_BONDING
 )

1216 i‡–
pLökIãm
 )

1218 i‡–(
pLökIãm
->
addrTy≥
 !
ADDRTYPE_PUBLIC
Ë&& (
pPkt
->
∑úReq
.
keyDi°
.
mIdKey
 =
FALSE
) )

1220 
uöt8
 
publicAddr
[
B_ADDR_LEN
];

1223 i‡–
	`GAPB⁄dMgr_ResﬁveAddr
(
pLökIãm
->
addrTy≥
,ÖLökIãm->
addr
, 
publicAddr
 ) =
FALSE
 )

1226 
VOID
 
	`GAP_Tîmö©eAuth
–
pPkt
->
c⁄√˘i⁄H™dÀ
, 
SMP_PAIRING_FAILED_AUTH_REQ
 );

1238 
VOID
 
	`oßl_mem£t
–&
∑øms
, 0,  ( 
g≠AuthP¨ams_t
 ) );

1241 
∑øms
.
c⁄√˘i⁄H™dÀ
 = 
pPkt
->connectionHandle;

1242 
∑øms
.
£cReqs
.
ioC≠s
 = 
g≠B⁄d_IOC≠
;

1243 
∑øms
.
£cReqs
.
oobAvaûabÀ
 = 
g≠B⁄d_OOBD©aFœg
;

1244 
∑øms
.
£cReqs
.
maxEncKeySize
 = 
g≠B⁄d_KeySize
;

1247 
∑øms
.
£cReqs
.
keyDi°
.
sEncKey
 = (
g≠B⁄d_KeyDi°Li°
 | 
GAPBOND_KEYDIST_SENCKEY
Ë? 
TRUE
 : 
FALSE
;

1248 
∑øms
.
£cReqs
.
keyDi°
.
sIdKey
 = (
g≠B⁄d_KeyDi°Li°
 | 
GAPBOND_KEYDIST_SIDKEY
Ë? 
TRUE
 : 
FALSE
;

1249 
∑øms
.
£cReqs
.
keyDi°
.
mEncKey
 = (
g≠B⁄d_KeyDi°Li°
 | 
GAPBOND_KEYDIST_MENCKEY
Ë? 
TRUE
 : 
FALSE
;

1250 
∑øms
.
£cReqs
.
keyDi°
.
mIdKey
 = (
g≠B⁄d_KeyDi°Li°
 | 
GAPBOND_KEYDIST_MIDKEY
Ë? 
TRUE
 : 
FALSE
;

1251 
∑øms
.
£cReqs
.
keyDi°
.
mSign
 = (
g≠B⁄d_KeyDi°Li°
 | 
GAPBOND_KEYDIST_MSIGN
Ë? 
TRUE
 : 
FALSE
;

1252 
∑øms
.
£cReqs
.
keyDi°
.
sSign
 = (
g≠B⁄d_KeyDi°Li°
 | 
GAPBOND_KEYDIST_SSIGN
Ë? 
TRUE
 : 
FALSE
;

1255 i‡–
g≠B⁄d_OOBD©aFœg
 )

1257 
VOID
 
	`oßl_mem˝y
–
∑øms
.
£cReqs
.
oob
, 
g≠B⁄d_OOBD©a
, 
KEYLEN
 );

1260 i‡–(
pPkt
->
∑úReq
.
authReq
 & 
SM_AUTH_STATE_BONDING
Ë&& (
g≠B⁄d_B⁄dög
) )

1262 
∑øms
.
£cReqs
.
authReq
 |
SM_AUTH_STATE_BONDING
;

1263 i‡–
pLökIãm
->
addrTy≥
 !
ADDRTYPE_PUBLIC
 )

1266 
∑øms
.
£cReqs
.
keyDi°
.
mIdKey
 = 
TRUE
;

1271 i‡–
g≠B⁄d_MITM
 )

1273 
∑øms
.
£cReqs
.
authReq
 |
SM_AUTH_STATE_AUTHENTICATED
;

1276 
VOID
 
	`GAP_Authítiˇã
–&
∑øms
, &(
pPkt
->
∑úReq
) );

1280 i‡–
pG≠B⁄dCB
 &&ÖG≠B⁄dCB->
∑úSèãCB
 )

1282 
pG≠B⁄dCB
->
	`∑úSèãCB
–
GAPBOND_PAIRING_STATE_STARTED
, 
pPkt
->
hdr
.
°©us
 );

1290 
	}
}

1302 
uöt8
 
	$GAPB⁄dMgr_CheckNVLí
–
uöt8
 
id
, uöt8 
Àn
 )

1304 
uöt8
 
°©
 = 
FAILURE
;

1307  (
id
 - 
BLE_NVID_GAP_BOND_START
Ë% 
GAP_BOND_REC_IDS
 )

1309 
GAP_BOND_REC_ID_OFFSET
:

1310 i‡–
Àn
 = ( 
g≠B⁄dRec_t
 ) )

1312 
°©
 = 
SUCCESS
;

1316 
GAP_BOND_LOCAL_LTK_OFFSET
:

1317 
GAP_BOND_DEV_LTK_OFFSET
:

1318 i‡–
Àn
 = ( 
g≠B⁄dLTK_t
 ) )

1320 
°©
 = 
SUCCESS
;

1324 
GAP_BOND_DEV_IRK_OFFSET
:

1325 
GAP_BOND_DEV_CSRK_OFFSET
:

1326 i‡–
Àn
 =
KEYLEN
 )

1328 
°©
 = 
SUCCESS
;

1332 
GAP_BOND_DEV_SIGN_COUNTER_OFFSET
:

1333 i‡–
Àn
 = ( 
uöt32
 ) )

1335 
°©
 = 
SUCCESS
;

1340  ( 
°©
 );

1341 
	}
}

1352 
	$g≠B⁄dMgr_Pro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 )

1355  
pMsg
->
mëhod
 )

1357 
ATT_HANDLE_VALUE_CFM
:

1359 
VOID
 
	`GAPB⁄dMgr_Sîvi˚Ch™geInd
–
pMsg
->
c⁄nH™dÀ
, 0x00 );

1366 
	}
}

1377 
	$g≠B⁄dMgrSídSîvi˚Ch™ge
–
lökDBIãm_t
 *
pLökIãm
 )

1379 
VOID
 
	`GATT_Sîvi˚Ch™gedInd
–
pLökIãm
->
c⁄√˘i⁄H™dÀ
, 
g≠B⁄dMgr_TaskID
 );

1380 
	}
}

1391 
	$g≠B⁄dSëupPrivFœg
( )

1393 
uöt8
 
¥ivFœgPr›
;

1395 i‡–
	`g≠B⁄dMgrB⁄dTŸÆ
() > 1 )

1397 
¥ivFœgPr›
 = 
GATT_PROP_READ
;

1401 
¥ivFœgPr›
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

1405 
	`GGS_SëP¨amëî
–
GGS_PERI_PRIVACY_FLAG_PROPS
,  ( 
uöt8
 ), &
¥ivFœgPr›
 );

1406 
	}
}

	@Projects/ble/Profiles/Roles/gapperiphbondmgr.h

56 #i‚de‡
GAPPERIPHBONDMGR_H


57 
	#GAPPERIPHBONDMGR_H


	)

59 #ifde‡
__˝lu•lus


67 
	~"g≠.h
"

73 #i‡!
deföed
 ( 
GAP_BONDINGS_MAX
 )

74 
	#GAP_BONDINGS_MAX
 10

76 

	)

86 
	#GAPBOND_PAIRING_MODE
 0x400

87 
	#GAPBOND_INITIATE_WAIT
 0x401

88 
	#GAPBOND_MITM_PROTECTION
 0x402

89 
	#GAPBOND_IO_CAPABILITIES
 0x403

90 
	#GAPBOND_OOB_ENABLED
 0x404

91 
	#GAPBOND_OOB_DATA
 0x405

92 
	#GAPBOND_BONDING_ENABLED
 0x406

93 
	#GAPBOND_KEY_DIST_LIST
 0x407

94 
	#GAPBOND_DEFAULT_PASSCODE
 0x408

95 
	#GAPBOND_ERASE_ALLBONDS
 0x409

96 
	#GAPBOND_AUTO_FAIL_PAIRING
 0x40A

97 
	#GAPBOND_AUTO_FAIL_REASON
 0x40B

98 
	#GAPBOND_KEYSIZE
 0x40C

99 

	)

104 
	#GAPBOND_PAIRING_MODE_NO_PAIRING
 0x00

105 
	#GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
 0x01

106 
	#GAPBOND_PAIRING_MODE_INITIATE
 0x02

107 

	)

112 
	#GAPBOND_IO_CAP_DISPLAY_ONLY
 0x00

113 
	#GAPBOND_IO_CAP_DISPLAY_YES_NO
 0x01

114 
	#GAPBOND_IO_CAP_KEYBOARD_ONLY
 0x02

115 
	#GAPBOND_IO_CAP_NO_INPUT_NO_OUTPUT
 0x03

116 
	#GAPBOND_IO_CAP_KEYBOARD_DISPLAY
 0x04

117 

	)

122 
	#GAPBOND_KEYDIST_SENCKEY
 0x01

123 
	#GAPBOND_KEYDIST_SIDKEY
 0x02

124 
	#GAPBOND_KEYDIST_SSIGN
 0x04

125 
	#GAPBOND_KEYDIST_MENCKEY
 0x08

126 
	#GAPBOND_KEYDIST_MIDKEY
 0x10

127 
	#GAPBOND_KEYDIST_MSIGN
 0x20

128 

	)

134 
	#GAPBOND_PAIRING_STATE_STARTED
 0x00

135 
	#GAPBOND_PAIRING_STATE_COMPLETE
 0x01

136 
	#GAPBOND_PAIRING_STATE_BONDED
 0x02

137 

	)

142 
	#SMP_PAIRING_FAILED_PASSKEY_ENTRY_FAILED
 0x01

143 
	#SMP_PAIRING_FAILED_OOB_NOT_AVAIL
 0x02

144 
	#SMP_PAIRING_FAILED_AUTH_REQ
 0x03

145 
	#SMP_PAIRING_FAILED_CONFIRM_VALUE
 0x04

146 
	#SMP_PAIRING_FAILED_NOT_SUPPORTED
 0x05

147 
	#SMP_PAIRING_FAILED_ENC_KEY_SIZE
 0x06

148 
	#SMP_PAIRING_FAILED_CMD_NOT_SUPPORTED
 0x07

149 
	#SMP_PAIRING_FAILED_UNSPECIFIED
 0x08

150 
	#SMP_PAIRING_FAILED_REPEATED_ATTEMPTS
 0x09

151 

	)

156 (*
p‚PasscodeCB_t
)

158 
	tuöt8
 *
	tdevi˚Addr
,

159 
	tuöt16
 
	tc⁄√˘i⁄H™dÀ
,

160 
	tuöt8
 
	tuiI≈uts
,

161 
	tuöt8
 
	tuiOuçuts


164 (*
p‚PaúSèãCB_t
)

166 
	tuöt8
 
	t°©e
,

167 
	tuöt8
 
	t°©us


175 
p‚PasscodeCB_t
 
∑sscodeCB
;

176 
p‚PaúSèãCB_t
 
∑úSèãCB
;

177 } 
	tg≠B⁄dCBs_t
;

210 
bSètus_t
 
GAPB⁄dMgr_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 );

227 
bSètus_t
 
GAPB⁄dMgr_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 );

241 
bSètus_t
 
GAPB⁄dMgr_LökE°
–
uöt8
 
addrTy≥
, uöt8 *
pDevAddr
, 
uöt16
 
c⁄nH™dÀ
 );

253 
uöt8
 
GAPB⁄dMgr_ResﬁveAddr
–uöt8 
addrTy≥
, uöt8 *
pDevAddr
, uöt8 *
pResﬁvedAddr
 );

266 
bSètus_t
 
GAPB⁄dMgr_Sîvi˚Ch™geInd
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
£tP¨am
 );

278 
GAPB⁄dMgr_Regi°î
–
g≠B⁄dCBs_t
 *
pCB
 );

291 
bSètus_t
 
GAPB⁄dMgr_PasscodeR•
–
uöt16
 
c⁄√˘i⁄H™dÀ
, 
uöt8
 
°©us
, 
uöt32
 
∑sscode
 );

304 
g≠B⁄dMgr_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 );

314 
uöt8
 
GAPB⁄dMgr_CheckNVLí
–uöt8 
id
, uöt8 
Àn
 );

340 
GAPB⁄dMgr_Inô
–
uöt8
 
èsk_id
 );

356 
uöt16
 
GAPB⁄dMgr_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

361 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Roles/observer.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"oßl_cbTimî.h
"

46 
	~"oßl_¢v.h
"

47 
	~"hci_é.h
"

48 
	~"g≠.h
"

50 
	~"ob£rvî.h
"

81 
uöt8
 
	gg≠Ob£rvîRﬁeTaskId
;

84 
g≠Ob£rvîRﬁeCB_t
 *
	gpG≠Ob£rvîRﬁeCB
;

91 
uöt8
 
	gg≠Ob£rvîRﬁeBdAddr
[
B_ADDR_LEN
];

92 
uöt8
 
	gg≠Ob£rvîRﬁeMaxSˇnRes
 = 0;

97 
g≠Ob£rvîRﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

98 
g≠Ob£rvîRﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 );

110 
bSètus_t
 
	$GAPOb£rvîRﬁe_SèπDevi˚
–
g≠Ob£rvîRﬁeCB_t
 *
pAµCÆlbacks
 )

112 i‡–
pAµCÆlbacks
 )

114 
pG≠Ob£rvîRﬁeCB
 = 
pAµCÆlbacks
;

117  
	`GAP_Devi˚Inô
–
g≠Ob£rvîRﬁeTaskId
, 
GAP_PROFILE_OBSERVER
,

118 
g≠Ob£rvîRﬁeMaxSˇnRes
, 
NULL
, NULL, NULL );

119 
	}
}

126 
bSètus_t
 
	$GAPOb£rvîRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 )

128 
bSètus_t
 
ªt
 = 
SUCCESS
;

130  
∑øm
 )

132 
GAPOBSERVERROLE_MAX_SCAN_RES
:

133 i‡–
Àn
 = ( 
uöt8
 ) )

135 
g≠Ob£rvîRﬁeMaxSˇnRes
 = *((
uöt8
*)
pVÆue
);

139 
ªt
 = 
bÀInvÆidR™ge
;

144 
ªt
 = 
INVALIDPARAMETER
;

148  
ªt
;

149 
	}
}

156 
bSètus_t
 
	$GAPOb£rvîRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 )

158 
bSètus_t
 
ªt
 = 
SUCCESS
;

160  
∑øm
 )

162 
GAPOBSERVERROLE_BD_ADDR
:

163 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Ob£rvîRﬁeBdAddr
, 
B_ADDR_LEN
 ) ;

166 
GAPOBSERVERROLE_MAX_SCAN_RES
:

167 *((
uöt8
*)
pVÆue
Ë
g≠Ob£rvîRﬁeMaxSˇnRes
;

171 
ªt
 = 
INVALIDPARAMETER
;

175  
ªt
;

176 
	}
}

183 
bSètus_t
 
	$GAPOb£rvîRﬁe_SèπDiscovîy
–
uöt8
 
mode
, uöt8 
a˘iveSˇn
, uöt8 
whôeLi°
 )

185 
g≠DevDiscReq_t
 
∑øms
;

187 
∑øms
.
èskID
 = 
g≠Ob£rvîRﬁeTaskId
;

188 
∑øms
.
mode
 = mode;

189 
∑øms
.
a˘iveSˇn
 =áctiveScan;

190 
∑øms
.
whôeLi°
 = whiteList;

192  
	`GAP_Devi˚DiscovîyReque°
–&
∑øms
 );

193 
	}
}

200 
bSètus_t
 
	$GAPOb£rvîRﬁe_C™˚lDiscovîy
( )

202  
	`GAP_Devi˚DiscovîyC™˚l
–
g≠Ob£rvîRﬁeTaskId
 );

203 
	}
}

212 
	$GAPOb£rvîRﬁe_Inô
–
uöt8
 
èskId
 )

214 
g≠Ob£rvîRﬁeTaskId
 = 
èskId
;

217 
	`GAP_Regi°îF‹HCIMsgs
–
èskId
 );

218 
	}
}

228 
uöt16
 
	$GAPOb£rvîRﬁe_Pro˚ssEvít
–
uöt8
 
èskId
, 
uöt16
 
evíts
 )

230 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

232 
uöt8
 *
pMsg
;

234 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
g≠Ob£rvîRﬁeTaskId
 )Ë!
NULL
 )

236 
	`g≠Ob£rvîRﬁe_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *Ë
pMsg
 );

239 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

243  (
evíts
 ^ 
SYS_EVENT_MSG
);

248 
	}
}

259 
	$g≠Ob£rvîRﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

261  
pMsg
->
evít
 )

263 
HCI_GAP_EVENT_EVENT
:

264 i‡–
pMsg
->
°©us
 =
HCI_COMMAND_COMPLETE_EVENT_CODE
 )

270 
GAP_MSG_EVENT
:

271 
	`g≠Ob£rvîRﬁe_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *Ë
pMsg
 );

277 
	}
}

288 
	$g≠Ob£rvîRﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 )

290  
pMsg
->
›code
 )

292 
GAP_DEVICE_INIT_DONE_EVENT
:

294 
g≠Devi˚InôD⁄eEvít_t
 *
pPkt
 = (g≠Devi˚InôD⁄eEvít_à*Ë
pMsg
;

296 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

299 
VOID
 
	`oßl_mem˝y
–
g≠Ob£rvîRﬁeBdAddr
, 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

309 i‡–
pG≠Ob£rvîRﬁeCB
 &&ÖG≠Ob£rvîRﬁeCB->
evítCB
 )

311 
pG≠Ob£rvîRﬁeCB
->
	`evítCB
–(
g≠Ob£rvîRﬁeEvít_t
 *Ë
pMsg
 );

313 
	}
}

	@Projects/ble/Profiles/Roles/observer.h

41 #i‚de‡
OBSERVER_H


42 
	#OBSERVER_H


	)

44 #ifde‡
__˝lu•lus


52 
	~"bcomdef.h
"

53 
	~"OSAL.h
"

54 
	~"g≠.h
"

63 
	#GAPOBSERVERROLE_BD_ADDR
 0x400

64 
	#GAPOBSERVERROLE_MAX_SCAN_RES
 0x401

65 

	)

84 
g≠EvítHdr_t
 
g≠
;

85 
g≠Devi˚InôD⁄eEvít_t
 
öôD⁄e
;

86 
g≠Devi˚InfoEvít_t
 
devi˚Info
;

87 
g≠DevDiscEvít_t
 
discCm∂
;

88 } 
	tg≠Ob£rvîRﬁeEvít_t
;

93 (*
p‚G≠Ob£rvîRﬁeRssiCB_t
)

95 
	tuöt16
 
	tc⁄nH™dÀ
,

96 
	töt8
 
	trssi


102 (*
p‚G≠Ob£rvîRﬁeEvítCB_t
)

104 
	tg≠Ob£rvîRﬁeEvít_t
 *
	tpEvít


112 
p‚G≠Ob£rvîRﬁeRssiCB_t
 
rssiCB
;

113 
p‚G≠Ob£rvîRﬁeEvítCB_t
 
evítCB
;

114 } 
	tg≠Ob£rvîRﬁeCB_t
;

143 
bSètus_t
 
GAPOb£rvîRﬁe_SèπDevi˚
–
g≠Ob£rvîRﬁeCB_t
 *
pAµCÆlbacks
 );

157 
bSètus_t
 
GAPOb£rvîRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 );

168 
bSètus_t
 
GAPOb£rvîRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 );

181 
bSètus_t
 
GAPOb£rvîRﬁe_SèπDiscovîy
–
uöt8
 
mode
, uöt8 
a˘iveSˇn
, uöt8 
whôeLi°
 );

190 
bSètus_t
 
GAPOb£rvîRﬁe_C™˚lDiscovîy
( );

209 
GAPOb£rvîRﬁe_Inô
–
uöt8
 
èskId
 );

221 
uöt16
 
GAPOb£rvîRﬁe_Pro˚ssEvít
–
uöt8
 
èskId
, uöt16 
evíts
 );

226 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Roles/peripheral.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"hci_é.h
"

46 
	~"l2ˇp.h
"

47 
	~"g≠.h
"

48 
	~"lökdb.h
"

49 
	~"©t.h
"

50 
	~"g©t.h
"

51 
	~"oßl_¢v.h
"

53 
	~"≥rùhîÆ.h
"

54 
	~"g≠b⁄dmgr.h
"

64 
	#START_ADVERTISING_EVT
 0x0001

65 
	#RSSI_READ_EVT
 0x0002

66 
	#START_CONN_UPDATE_EVT
 0x0004

67 
	#CONN_PARAM_TIMEOUT_EVT
 0x0008

68 

	)

69 
	#DEFAULT_ADVERT_OFF_TIME
 30000

70 

	)

71 
	#RSSI_NOT_AVAILABLE
 127

	)

73 
	#DEFAULT_MIN_CONN_INTERVAL
 0x0006

74 
	#DEFAULT_MAX_CONN_INTERVAL
 0x0C80

75 

	)

76 
	#MIN_CONN_INTERVAL
 0x0006

	)

77 
	#MAX_CONN_INTERVAL
 0x0C80

	)

79 
	#DEFAULT_TIMEOUT_MULTIPLIER
 1000

	)

81 
	#CONN_INTERVAL_MULTIPLIER
 6

	)

83 
	#MIN_SLAVE_LATENCY
 0

	)

84 
	#MAX_SLAVE_LATENCY
 500

	)

86 
	#MIN_TIMEOUT_MULTIPLIER
 0x000a

	)

87 
	#MAX_TIMEOUT_MULTIPLIER
 0x0c80

	)

89 
	#MAX_TIMEOUT_VALUE
 0xFFFF

	)

110 
uöt8
 
	gg≠Rﬁe_TaskID
;

112 
g≠rﬁe_Sèãs_t
 
	gg≠Rﬁe_°©e
;

119 
uöt8
 
	gg≠Rﬁe_¥ofûeRﬁe
;

120 
uöt8
 
	gg≠Rﬁe_IRK
[
KEYLEN
];

121 
uöt8
 
	gg≠Rﬁe_SRK
[
KEYLEN
];

122 
uöt32
 
	gg≠Rﬁe_signCou¡î
;

123 
uöt8
 
	gg≠Rﬁe_bdAddr
[
B_ADDR_LEN
];

124 
uöt8
 
	gg≠Rﬁe_AdvE«bÀd
 = 
TRUE
;

125 
uöt16
 
	gg≠Rﬁe_AdvîtOffTime
 = 
DEFAULT_ADVERT_OFF_TIME
;

126 
uöt8
 
	gg≠Rﬁe_AdvîtD©aLí
 = 3;

127 
uöt8
 
	gg≠Rﬁe_AdvîtD©a
[
B_MAX_ADV_LEN
] =

130 
GAP_ADTYPE_FLAGS
,

132 (
GAP_ADTYPE_FLAGS_GENERAL
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
),

135 
uöt8
 
	gg≠Rﬁe_SˇnR•D©aLí
 = 0;

136 
uöt8
 
	gg≠Rﬁe_SˇnR•D©a
[
B_MAX_ADV_LEN
] = {0};

137 
uöt8
 
	gg≠Rﬁe_AdvEvítTy≥
;

138 
uöt8
 
	gg≠Rﬁe_AdvDúe˘Ty≥
;

139 
uöt8
 
	gg≠Rﬁe_AdvDúe˘Addr
[
B_ADDR_LEN
] = {0};

140 
uöt8
 
	gg≠Rﬁe_AdvCh™M≠
;

141 
uöt8
 
	gg≠Rﬁe_AdvFûãrPﬁicy
;

143 
uöt16
 
	gg≠Rﬁe_C⁄√˘i⁄H™dÀ
 = 
INVALID_CONNHANDLE
;

144 
uöt16
 
	gg≠Rﬁe_RSSIRódR©e
 = 0;

146 
uöt8
 
	gg≠Rﬁe_C⁄√˘edDevAddr
[
B_ADDR_LEN
] = {0};

148 
uöt8
 
	gg≠Rﬁe_P¨amUpd©eE«bÀ
 = 
FALSE
;

149 
uöt16
 
	gg≠Rﬁe_MöC⁄nI¡îvÆ
 = 
DEFAULT_MIN_CONN_INTERVAL
;

150 
uöt16
 
	gg≠Rﬁe_MaxC⁄nI¡îvÆ
 = 
DEFAULT_MAX_CONN_INTERVAL
;

151 
uöt16
 
	gg≠Rﬁe_SœveL©ícy
 = 
MIN_SLAVE_LATENCY
;

152 
uöt16
 
	gg≠Rﬁe_TimeoutMu…ùlõr
 = 
DEFAULT_TIMEOUT_MULTIPLIER
;

154 
uöt16
 
	gg≠Rﬁe_C⁄nI¡îvÆ
 = 0;

155 
uöt16
 
	gg≠Rﬁe_C⁄nSœveL©ícy
 = 0;

156 
uöt16
 
	gg≠Rﬁe_C⁄nTimeout
 = 0;

158 
uöt8
 
	g∑ømUpd©eNoSuc˚ssO±i⁄
 = 
GAPROLE_NO_ACTION
;

161 
g≠RﬁesCBs_t
 *
	gpG≠Rﬁes_AµCGs
 = 
NULL
;

162 
g≠RﬁesP¨amUpd©eCB_t
 *
	gpG≠Rﬁes_P¨amUpd©eCB
 = 
NULL
;

175 
g≠Rﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

176 
g≠Rﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 );

177 
g≠Rﬁe_SëupGAP
( );

178 
g≠Rﬁe_H™dÀP¨amUpd©eNoSuc˚ss
( );

179 
g≠Rﬁe_°¨tC⁄nUpd©e
–
uöt8
 
h™dÀFaûuª
 );

194 
bSètus_t
 
	$GAPRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 )

196 
bSètus_t
 
ªt
 = 
SUCCESS
;

197  
∑øm
 )

199 
GAPROLE_IRK
:

200 i‡–
Àn
 =
KEYLEN
 )

202 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_IRK
, 
pVÆue
, 
KEYLEN
 ) ;

206 
ªt
 = 
bÀInvÆidR™ge
;

210 
GAPROLE_SRK
:

211 i‡–
Àn
 =
KEYLEN
 )

213 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_SRK
, 
pVÆue
, 
KEYLEN
 ) ;

217 
ªt
 = 
bÀInvÆidR™ge
;

221 
GAPROLE_SIGNCOUNTER
:

222 i‡–
Àn
 = ( 
uöt32
 ) )

224 
g≠Rﬁe_signCou¡î
 = *((
uöt32
*)
pVÆue
);

228 
ªt
 = 
bÀInvÆidR™ge
;

232 
GAPROLE_ADVERT_ENABLED
:

233 i‡–
Àn
 =–
uöt8
 ) )

235 
uöt8
 
ﬁdAdvE«bÀd
 = 
g≠Rﬁe_AdvE«bÀd
;

236 
g≠Rﬁe_AdvE«bÀd
 = *((
uöt8
*)
pVÆue
);

238 i‡–(
ﬁdAdvE«bÀd
Ë&& (
g≠Rﬁe_AdvE«bÀd
 =
FALSE
) )

241 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_ADVERTISING
 )

243 
VOID
 
	`GAP_EndDiscovîabÀ
–
g≠Rﬁe_TaskID
 );

246 i‡–(
ﬁdAdvE«bÀd
 =
FALSE
Ë&& (
g≠Rﬁe_AdvE«bÀd
) )

249 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_STARTED
)

250 || (
g≠Rﬁe_°©e
 =
GAPROLE_WAITING
)

251 || (
g≠Rﬁe_°©e
 =
GAPROLE_WAITING_AFTER_TIMEOUT
) )

253 
VOID
 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

259 
ªt
 = 
bÀInvÆidR™ge
;

263 
GAPROLE_ADVERT_OFF_TIME
:

264 i‡–
Àn
 = ( 
uöt16
 ) )

266 
g≠Rﬁe_AdvîtOffTime
 = *((
uöt16
*)
pVÆue
);

270 
ªt
 = 
bÀInvÆidR™ge
;

274 
GAPROLE_ADVERT_DATA
:

275 i‡–
Àn
 <
B_MAX_ADV_LEN
 )

277 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_AdvîtD©a
, 0, 
B_MAX_ADV_LEN
 );

278 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_AdvîtD©a
, 
pVÆue
, 
Àn
 );

279 
g≠Rﬁe_AdvîtD©aLí
 = 
Àn
;

283 
ªt
 = 
bÀInvÆidR™ge
;

287 
GAPROLE_SCAN_RSP_DATA
:

288 i‡–
Àn
 <
B_MAX_ADV_LEN
 )

290 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_SˇnR•D©a
, 0, 
B_MAX_ADV_LEN
 );

291 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_SˇnR•D©a
, 
pVÆue
, 
Àn
 );

292 
g≠Rﬁe_SˇnR•D©aLí
 = 
Àn
;

296 
ªt
 = 
bÀInvÆidR™ge
;

300 
GAPROLE_ADV_EVENT_TYPE
:

301 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAP_ADTYPE_ADV_NONCONN_IND
) )

303 
g≠Rﬁe_AdvEvítTy≥
 = *((
uöt8
*)
pVÆue
);

307 
ªt
 = 
bÀInvÆidR™ge
;

311 
GAPROLE_ADV_DIRECT_TYPE
:

312 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
ADDRTYPE_PRIVATE_RESOLVE
) )

314 
g≠Rﬁe_AdvDúe˘Ty≥
 = *((
uöt8
*)
pVÆue
);

318 
ªt
 = 
bÀInvÆidR™ge
;

322 
GAPROLE_ADV_DIRECT_ADDR
:

323 i‡–
Àn
 =
B_ADDR_LEN
 )

325 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_AdvDúe˘Addr
, 
pVÆue
, 
B_ADDR_LEN
 ) ;

329 
ªt
 = 
bÀInvÆidR™ge
;

333 
GAPROLE_ADV_CHANNEL_MAP
:

334 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
) <= 0x07) )

336 
g≠Rﬁe_AdvCh™M≠
 = *((
uöt8
*)
pVÆue
);

340 
ªt
 = 
bÀInvÆidR™ge
;

344 
GAPROLE_ADV_FILTER_POLICY
:

345 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAP_FILTER_POLICY_WHITE
) )

347 
g≠Rﬁe_AdvFûãrPﬁicy
 = *((
uöt8
*)
pVÆue
);

351 
ªt
 = 
bÀInvÆidR™ge
;

355 
GAPROLE_RSSI_READ_RATE
:

356 i‡–
Àn
 = ( 
uöt16
 ) )

358 
g≠Rﬁe_RSSIRódR©e
 = *((
uöt16
*)
pVÆue
);

360 i‡–(
g≠Rﬁe_RSSIRódR©e
Ë&& (
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
) )

363 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
RSSI_READ_EVT
, 
g≠Rﬁe_RSSIRódR©e
 );

368 
ªt
 = 
bÀInvÆidR™ge
;

372 
GAPROLE_PARAM_UPDATE_ENABLE
:

373 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

375 
g≠Rﬁe_P¨amUpd©eE«bÀ
 = *((
uöt8
*)
pVÆue
);

379 
ªt
 = 
bÀInvÆidR™ge
;

383 
GAPROLE_MIN_CONN_INTERVAL
:

385 
uöt16
 
√wI¡îvÆ
 = *((uöt16*)
pVÆue
);

386 i‡–
Àn
 = ( 
uöt16
 ) &&

387 –
√wI¡îvÆ
 >
MIN_CONN_INTERVAL
 ) &&

388 –
√wI¡îvÆ
 <
MAX_CONN_INTERVAL
 ) )

390 
g≠Rﬁe_MöC⁄nI¡îvÆ
 = 
√wI¡îvÆ
;

394 
ªt
 = 
bÀInvÆidR™ge
;

399 
GAPROLE_MAX_CONN_INTERVAL
:

401 
uöt16
 
√wI¡îvÆ
 = *((uöt16*)
pVÆue
);

402 i‡–
Àn
 = ( 
uöt16
 ) &&

403 –
√wI¡îvÆ
 >
MIN_CONN_INTERVAL
) &&

404 –
√wI¡îvÆ
 <
MAX_CONN_INTERVAL
) )

406 
g≠Rﬁe_MaxC⁄nI¡îvÆ
 = 
√wI¡îvÆ
;

410 
ªt
 = 
bÀInvÆidR™ge
;

415 
GAPROLE_SLAVE_LATENCY
:

417 
uöt16
 
œãncy
 = *((uöt16*)
pVÆue
);

418 i‡–
Àn
 = ( 
uöt16
 ) && (
œãncy
 < 
MAX_SLAVE_LATENCY
) )

420 
g≠Rﬁe_SœveL©ícy
 = 
œãncy
;

424 
ªt
 = 
bÀInvÆidR™ge
;

429 
GAPROLE_TIMEOUT_MULTIPLIER
:

431 
uöt16
 
√wTimeout
 = *((uöt16*)
pVÆue
);

432 i‡–
Àn
 = ( 
uöt16
 )

433 && (
√wTimeout
 >
MIN_TIMEOUT_MULTIPLIER
Ë&& (√wTimeouà<
MAX_TIMEOUT_MULTIPLIER
) )

435 
g≠Rﬁe_TimeoutMu…ùlõr
 = 
√wTimeout
;

439 
ªt
 = 
bÀInvÆidR™ge
;

444 
GAPROLE_PARAM_UPDATE_REQ
:

446 
uöt8
 
ªq
 = *((uöt8*)
pVÆue
);

447 i‡–
Àn
 = ( 
uöt8
 ) && (
ªq
 =
TRUE
) )

452 i‡–
	`oßl_gë_timeoutEx
–
g≠Rﬁe_TaskID
, 
CONN_PARAM_TIMEOUT_EVT
 ) == 0 )

455 
	`g≠Rﬁe_°¨tC⁄nUpd©e
–
GAPROLE_NO_ACTION
 );

458 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
START_CONN_UPDATE_EVT
 );

462 
ªt
 = 
bÀPídög
;

467 
ªt
 = 
bÀInvÆidR™ge
;

474 i‡–(
∑øm
 < 
TGAP_PARAMID_MAX
Ë&& (
Àn
 = ( 
uöt16
 )) )

476 
ªt
 = 
	`GAP_SëP¨amVÆue
–
∑øm
, *((
uöt16
*)
pVÆue
) );

480 
ªt
 = 
INVALIDPARAMETER
;

485  ( 
ªt
 );

486 
	}
}

493 
bSètus_t
 
	$GAPRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 )

495 
bSètus_t
 
ªt
 = 
SUCCESS
;

496  
∑øm
 )

498 
GAPROLE_PROFILEROLE
:

499 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_¥ofûeRﬁe
;

502 
GAPROLE_IRK
:

503 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_IRK
, 
KEYLEN
 ) ;

506 
GAPROLE_SRK
:

507 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_SRK
, 
KEYLEN
 ) ;

510 
GAPROLE_SIGNCOUNTER
:

511 *((
uöt32
*)
pVÆue
Ë
g≠Rﬁe_signCou¡î
;

514 
GAPROLE_BD_ADDR
:

515 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_bdAddr
, 
B_ADDR_LEN
 ) ;

518 
GAPROLE_ADVERT_ENABLED
:

519 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvE«bÀd
;

522 
GAPROLE_ADVERT_OFF_TIME
:

523 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_AdvîtOffTime
;

526 
GAPROLE_ADVERT_DATA
:

527 
VOID
 
	`oßl_mem˝y
–
pVÆue
 , 
g≠Rﬁe_AdvîtD©a
, 
g≠Rﬁe_AdvîtD©aLí
 );

530 
GAPROLE_SCAN_RSP_DATA
:

531 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_SˇnR•D©a
, 
g≠Rﬁe_SˇnR•D©aLí
 ) ;

534 
GAPROLE_ADV_EVENT_TYPE
:

535 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvEvítTy≥
;

538 
GAPROLE_ADV_DIRECT_TYPE
:

539 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvDúe˘Ty≥
;

542 
GAPROLE_ADV_DIRECT_ADDR
:

543 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_AdvDúe˘Addr
, 
B_ADDR_LEN
 ) ;

546 
GAPROLE_ADV_CHANNEL_MAP
:

547 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvCh™M≠
;

550 
GAPROLE_ADV_FILTER_POLICY
:

551 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvFûãrPﬁicy
;

554 
GAPROLE_CONNHANDLE
:

555 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_C⁄√˘i⁄H™dÀ
;

558 
GAPROLE_RSSI_READ_RATE
:

559 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_RSSIRódR©e
;

562 
GAPROLE_PARAM_UPDATE_ENABLE
:

563 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_P¨amUpd©eE«bÀ
;

566 
GAPROLE_MIN_CONN_INTERVAL
:

567 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_MöC⁄nI¡îvÆ
;

570 
GAPROLE_MAX_CONN_INTERVAL
:

571 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_MaxC⁄nI¡îvÆ
;

574 
GAPROLE_SLAVE_LATENCY
:

575 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_SœveL©ícy
;

578 
GAPROLE_TIMEOUT_MULTIPLIER
:

579 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_TimeoutMu…ùlõr
;

582 
GAPROLE_CONN_BD_ADDR
:

583 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_C⁄√˘edDevAddr
, 
B_ADDR_LEN
 ) ;

586 
GAPROLE_CONN_INTERVAL
:

587 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_C⁄nI¡îvÆ
;

590 
GAPROLE_CONN_LATENCY
:

591 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_C⁄nSœveL©ícy
;

594 
GAPROLE_CONN_TIMEOUT
:

595 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_C⁄nTimeout
;

600 i‡–
∑øm
 < 
TGAP_PARAMID_MAX
 )

602 *((
uöt16
*)
pVÆue
Ë
	`GAP_GëP¨amVÆue
–
∑øm
 );

606 
ªt
 = 
INVALIDPARAMETER
;

611  ( 
ªt
 );

612 
	}
}

619 
bSètus_t
 
	$GAPRﬁe_SèπDevi˚
–
g≠RﬁesCBs_t
 *
pAµCÆlbacks
 )

621 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_INIT
 )

624 i‡–
pAµCÆlbacks
 )

626 
pG≠Rﬁes_AµCGs
 = 
pAµCÆlbacks
;

630 
	`g≠Rﬁe_SëupGAP
();

632  ( 
SUCCESS
 );

636  ( 
bÀAÃódyInReque°edMode
 );

638 
	}
}

645 
	$GAPRﬁe_Regi°îAµCBs
–
g≠RﬁesP¨amUpd©eCB_t
 *
pP¨amUpd©eCB
 )

647 i‡–
pP¨amUpd©eCB
 !
NULL
 )

649 
pG≠Rﬁes_P¨amUpd©eCB
 = 
pP¨amUpd©eCB
;

651 
	}
}

658 
bSètus_t
 
	$GAPRﬁe_Tîmö©eC⁄√˘i⁄
( )

660 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
 )

662  ( 
	`GAP_Tîmö©eLökReq
–
g≠Rﬁe_TaskID
, 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 ) );

666  ( 
bÀInc‹ª˘Mode
 );

668 
	}
}

679 
	$GAPRﬁe_Inô
–
uöt8
 
èsk_id
 )

681 
g≠Rﬁe_TaskID
 = 
èsk_id
;

683 
g≠Rﬁe_°©e
 = 
GAPROLE_INIT
;

684 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 = 
INVALID_CONNHANDLE
;

686 
	`GAP_Regi°îF‹HCIMsgs
–
g≠Rﬁe_TaskID
 );

689 
g≠Rﬁe_¥ofûeRﬁe
 = 
GAP_PROFILE_PERIPHERAL
;

690 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_IRK
, 0, 
KEYLEN
 );

691 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_SRK
, 0, 
KEYLEN
 );

692 
g≠Rﬁe_signCou¡î
 = 0;

693 
g≠Rﬁe_AdvEvítTy≥
 = 
GAP_ADTYPE_ADV_IND
;

694 
g≠Rﬁe_AdvDúe˘Ty≥
 = 
ADDRTYPE_PUBLIC
;

695 
g≠Rﬁe_AdvCh™M≠
 = 
GAP_ADVCHAN_ALL
;

696 
g≠Rﬁe_AdvFûãrPﬁicy
 = 
GAP_FILTER_POLICY_ALL
;

699 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_IRK
, 
KEYLEN
, 
g≠Rﬁe_IRK
 );

700 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_CSRK
, 
KEYLEN
, 
g≠Rﬁe_SRK
 );

701 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
g≠Rﬁe_signCou¡î
 );

702 
	}
}

709 
uöt16
 
	$GAPRﬁe_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

711 
VOID
 
èsk_id
;

713 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

715 
uöt8
 *
pMsg
;

717 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
g≠Rﬁe_TaskID
 )Ë!
NULL
 )

719 
	`g≠Rﬁe_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

722 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

726  (
evíts
 ^ 
SYS_EVENT_MSG
);

729 i‡–
evíts
 & 
GAP_EVENT_SIGN_COUNTER_CHANGED
 )

732 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
g≠Rﬁe_signCou¡î
 );

734  ( 
evíts
 ^ 
GAP_EVENT_SIGN_COUNTER_CHANGED
 );

737 i‡–
evíts
 & 
START_ADVERTISING_EVT
 )

739 i‡–
g≠Rﬁe_AdvE«bÀd
 )

741 
g≠AdvîtisögP¨ams_t
 
∑øms
;

744 
∑øms
.
evítTy≥
 = 
g≠Rﬁe_AdvEvítTy≥
;

745 
∑øms
.
öôüt‹AddrTy≥
 = 
g≠Rﬁe_AdvDúe˘Ty≥
;

746 
VOID
 
	`oßl_mem˝y
–
∑øms
.
öôüt‹Addr
, 
g≠Rﬁe_AdvDúe˘Addr
, 
B_ADDR_LEN
 );

747 
∑øms
.
ch™√lM≠
 = 
g≠Rﬁe_AdvCh™M≠
;

748 
∑øms
.
fûãrPﬁicy
 = 
g≠Rﬁe_AdvFûãrPﬁicy
;

750 i‡–
	`GAP_MakeDiscovîabÀ
–
g≠Rﬁe_TaskID
, &
∑øms
 ) !
SUCCESS
 )

752 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

755 i‡–
pG≠Rﬁes_AµCGs
 &&ÖG≠Rﬁes_AµCGs->
p‚SèãCh™ge
 )

757 
pG≠Rﬁes_AµCGs
->
	`p‚SèãCh™ge
–
g≠Rﬁe_°©e
 );

761  ( 
evíts
 ^ 
START_ADVERTISING_EVT
 );

764 i‡–
evíts
 & 
RSSI_READ_EVT
 )

767 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
 )

770 
VOID
 
	`HCI_RódRssiCmd
–
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 );

773 i‡–
g≠Rﬁe_RSSIRódR©e
 )

775 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
RSSI_READ_EVT
, 
g≠Rﬁe_RSSIRódR©e
 );

778  ( 
evíts
 ^ 
RSSI_READ_EVT
 );

781 i‡–
evíts
 & 
START_CONN_UPDATE_EVT
 )

784 
	`g≠Rﬁe_°¨tC⁄nUpd©e
–
GAPROLE_NO_ACTION
 );

786  ( 
evíts
 ^ 
START_CONN_UPDATE_EVT
 );

789 i‡–
evíts
 & 
CONN_PARAM_TIMEOUT_EVT
 )

792 
	`g≠Rﬁe_H™dÀP¨amUpd©eNoSuc˚ss
();

794  ( 
evíts
 ^ 
CONN_PARAM_TIMEOUT_EVT
 );

799 
	}
}

810 
	$g≠Rﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

812  
pMsg
->
evít
 )

814 
HCI_GAP_EVENT_EVENT
:

815 i‡–
pMsg
->
°©us
 =
HCI_COMMAND_COMPLETE_EVENT_CODE
 )

817 
hciEvt_CmdCom∂ëe_t
 *
pPkt
 = (hciEvt_CmdCom∂ëe_à*)
pMsg
;

819 i‡–
pPkt
->
cmdOpcode
 =
HCI_READ_RSSI
 )

821 
öt8
 
rssi
 = (öt8)
pPkt
->
pRëu∫P¨am
[3];

823 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
Ë&& (
rssi
 !
RSSI_NOT_AVAILABLE
) )

826 i‡–
pG≠Rﬁes_AµCGs
 &&ÖG≠Rﬁes_AµCGs->
p‚RssiRód
 )

828 
pG≠Rﬁes_AµCGs
->
	`p‚RssiRód
–
rssi
 );

835 
GAP_MSG_EVENT
:

836 
	`g≠Rﬁe_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

839 
L2CAP_SIGNAL_EVENT
:

841 
l2ˇpSig«lEvít_t
 *
pPkt
 = (l2ˇpSig«lEvít_à*)
pMsg
;

844 i‡–
pPkt
->
›code
 =
L2CAP_PARAM_UPDATE_RSP
 )

846 
l2ˇpP¨amUpd©eR•_t
 *
pR•
 = (l2ˇpP¨amUpd©eR•_à*)&(
pPkt
->
cmd
.
upd©eR•
);

848 i‡––
pR•
->
ªsu…
 =
L2CAP_CONN_PARAMS_REJECTED
 ) &&

849 –
∑ømUpd©eNoSuc˚ssO±i⁄
 =
GAPROLE_TERMINATE_LINK
 ) )

852 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
CONN_PARAM_TIMEOUT_EVT
 );

855 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

859 
uöt16
 
timeout
 = 
	`GAP_GëP¨amVÆue
–
TGAP_CONN_PARAM_TIMEOUT
 );

863 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
CONN_PARAM_TIMEOUT_EVT
, 
timeout
 );

872 
	}
}

883 
	$g≠Rﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 )

885 
uöt8
 
nŸify
 = 
FALSE
;

887  
pMsg
->
›code
 )

889 
GAP_DEVICE_INIT_DONE_EVENT
:

891 
g≠Devi˚InôD⁄eEvít_t
 *
pPkt
 = (g≠Devi˚InôD⁄eEvít_à*)
pMsg
;

892 
bSètus_t
 
°©
 = 
pPkt
->
hdr
.
°©us
;

894 i‡–
°©
 =
SUCCESS
 )

897 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_IRK
, 
KEYLEN
, 
g≠Rﬁe_IRK
 );

898 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_CSRK
, 
KEYLEN
, 
g≠Rﬁe_SRK
 );

901 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_bdAddr
, 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

903 
g≠Rﬁe_°©e
 = 
GAPROLE_STARTED
;

906 
°©
 = 
	`GAP_Upd©eAdvîtisögD©a
–
g≠Rﬁe_TaskID
,

907 
TRUE
, 
g≠Rﬁe_AdvîtD©aLí
, 
g≠Rﬁe_AdvîtD©a
 );

910 i‡–
°©
 !
SUCCESS
 )

912 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

915 
nŸify
 = 
TRUE
;

919 
GAP_ADV_DATA_UPDATE_DONE_EVENT
:

921 
g≠AdvD©aUpd©eEvít_t
 *
pPkt
 = (g≠AdvD©aUpd©eEvít_à*)
pMsg
;

923 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

925 i‡–
pPkt
->
adTy≥
 )

928 
pPkt
->
hdr
.
°©us
 = 
	`GAP_Upd©eAdvîtisögD©a
–
g≠Rﬁe_TaskID
,

929 
FALSE
, 
g≠Rﬁe_SˇnR•D©aLí
, 
g≠Rﬁe_SˇnR•D©a
 );

934 
VOID
 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

938 i‡–
pPkt
->
hdr
.
°©us
 !
SUCCESS
 )

941 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

942 
nŸify
 = 
TRUE
;

947 
GAP_MAKE_DISCOVERABLE_DONE_EVENT
:

948 
GAP_END_DISCOVERABLE_DONE_EVENT
:

950 
g≠MakeDiscovîabÀR•Evít_t
 *
pPkt
 = (g≠MakeDiscovîabÀR•Evít_à*)
pMsg
;

952 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

954 i‡–
pMsg
->
›code
 =
GAP_MAKE_DISCOVERABLE_DONE_EVENT
 )

956 
g≠Rﬁe_°©e
 = 
GAPROLE_ADVERTISING
;

961 i‡–
g≠Rﬁe_AdvîtOffTime
 != 0 )

963 i‡––
g≠Rﬁe_AdvE«bÀd
 ) )

965 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
, 
g≠Rﬁe_AdvîtOffTime
 );

974 
g≠Rﬁe_AdvE«bÀd
 = 
FALSE
;

978 
g≠Rﬁe_°©e
 = 
GAPROLE_WAITING
;

984 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

986 
nŸify
 = 
TRUE
;

990 
GAP_LINK_ESTABLISHED_EVENT
:

992 
g≠E°LökReqEvít_t
 *
pPkt
 = (g≠E°LökReqEvít_à*)
pMsg
;

994 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

996 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_C⁄√˘edDevAddr
, 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

997 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 = 
pPkt
->
c⁄√˘i⁄H™dÀ
;

998 
g≠Rﬁe_°©e
 = 
GAPROLE_CONNECTED
;

1000 i‡–
g≠Rﬁe_RSSIRódR©e
 )

1003 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
RSSI_READ_EVT
, 
g≠Rﬁe_RSSIRódR©e
 );

1007 
g≠Rﬁe_C⁄nI¡îvÆ
 = 
pPkt
->
c⁄nI¡îvÆ
;

1008 
g≠Rﬁe_C⁄nSœveL©ícy
 = 
pPkt
->
c⁄nL©ícy
;

1009 
g≠Rﬁe_C⁄nTimeout
 = 
pPkt
->
c⁄nTimeout
;

1012 i‡–
g≠Rﬁe_P¨amUpd©eE«bÀ
 =
TRUE
 )

1016 
uöt16
 
timeout
 = 
	`GAP_GëP¨amVÆue
–
TGAP_CONN_PAUSE_PERIPHERAL
 );

1018 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
START_CONN_UPDATE_EVT
, 
timeout
*1000 );

1022 
VOID
 
	`GAPB⁄dMgr_LökE°
–
pPkt
->
devAddrTy≥
,ÖPkt->
devAddr
,ÖPkt->
c⁄√˘i⁄H™dÀ
, 
GAP_PROFILE_PERIPHERAL
 );

1024 i‡–
pPkt
->
hdr
.
°©us
 =
bÀGAPC⁄nNŸAc˚±abÀ
 )

1028 
g≠Rﬁe_AdvE«bÀd
 = 
FALSE
;

1031 
g≠Rﬁe_°©e
 = 
GAPROLE_WAITING
;

1035 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

1037 
nŸify
 = 
TRUE
;

1041 
GAP_LINK_TERMINATED_EVENT
:

1043 
g≠Tîmö©eLökEvít_t
 *
pPkt
 = (g≠Tîmö©eLökEvít_à*)
pMsg
;

1045 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

1046 
	`oßl_mem£t
–
g≠Rﬁe_C⁄√˘edDevAddr
, 0, 
B_ADDR_LEN
 );

1049 
g≠Rﬁe_C⁄nI¡îvÆ
 = 0;

1050 
g≠Rﬁe_C⁄nSœveL©ícy
 = 0;

1051 
g≠Rﬁe_C⁄nTimeout
 = 0;

1054 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
START_CONN_UPDATE_EVT
 );

1055 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
CONN_PARAM_TIMEOUT_EVT
 );

1058 if–
pPkt
->
ªas⁄
 =
LL_SUPERVISION_TIMEOUT_TERM
 )

1060 
g≠Rﬁe_°©e
 = 
GAPROLE_WAITING_AFTER_TIMEOUT
;

1064 
g≠Rﬁe_°©e
 = 
GAPROLE_WAITING
;

1067 
nŸify
 = 
TRUE
;

1069 
VOID
 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

1071 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 = 
INVALID_CONNHANDLE
;

1075 
GAP_LINK_PARAM_UPDATE_EVENT
:

1077 
g≠LökUpd©eEvít_t
 *
pPkt
 = (g≠LökUpd©eEvít_à*)
pMsg
;

1080 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
CONN_PARAM_TIMEOUT_EVT
 );

1082 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

1085 
g≠Rﬁe_C⁄nI¡îvÆ
 = 
pPkt
->
c⁄nI¡îvÆ
;

1086 
g≠Rﬁe_C⁄nSœveL©ícy
 = 
pPkt
->
c⁄nL©ícy
;

1087 
g≠Rﬁe_C⁄nTimeout
 = 
pPkt
->
c⁄nTimeout
;

1090 i‡–
	`oßl_gë_timeoutEx
–
g≠Rﬁe_TaskID
, 
START_CONN_UPDATE_EVT
 ) == 0 )

1093 i‡–
pG≠Rﬁes_P¨amUpd©eCB
 !
NULL
 )

1095 (*
pG≠Rﬁes_P¨amUpd©eCB
)–
g≠Rﬁe_C⁄nI¡îvÆ
,

1096 
g≠Rﬁe_C⁄nSœveL©ícy
,

1097 
g≠Rﬁe_C⁄nTimeout
 );

1108 i‡–
nŸify
 =
TRUE
 )

1111 i‡–
pG≠Rﬁes_AµCGs
 &&ÖG≠Rﬁes_AµCGs->
p‚SèãCh™ge
 )

1113 
pG≠Rﬁes_AµCGs
->
	`p‚SèãCh™ge
–
g≠Rﬁe_°©e
 );

1116 
	}
}

1128 
	$g≠Rﬁe_SëupGAP
( )

1130 
VOID
 
	`GAP_Devi˚Inô
–
g≠Rﬁe_TaskID
,

1131 
g≠Rﬁe_¥ofûeRﬁe
, 0,

1132 
g≠Rﬁe_IRK
, 
g≠Rﬁe_SRK
,

1133 &
g≠Rﬁe_signCou¡î
 );

1134 
	}
}

1145 
	$g≠Rﬁe_H™dÀP¨amUpd©eNoSuc˚ss
( )

1148  
∑ømUpd©eNoSuc˚ssO±i⁄
 )

1150 
GAPROLE_RESEND_PARAM_UPDATE
:

1151 
	`GAPRﬁe_SídUpd©eP¨am
–
g≠Rﬁe_MöC⁄nI¡îvÆ
, 
g≠Rﬁe_MaxC⁄nI¡îvÆ
,

1152 
g≠Rﬁe_SœveL©ícy
, 
g≠Rﬁe_TimeoutMu…ùlõr
,

1153 
GAPROLE_RESEND_PARAM_UPDATE
 );

1156 
GAPROLE_TERMINATE_LINK
:

1157 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

1160 
GAPROLE_NO_ACTION
:

1166 
	}
}

1178 
	$g≠Rﬁe_°¨tC⁄nUpd©e
–
uöt8
 
h™dÀFaûuª
 )

1181 i‡–(
g≠Rﬁe_C⁄nI¡îvÆ
 < 
g≠Rﬁe_MöC⁄nI¡îvÆ
) ||

1182 (
g≠Rﬁe_C⁄nI¡îvÆ
 > 
g≠Rﬁe_MaxC⁄nI¡îvÆ
) ||

1183 (
g≠Rﬁe_C⁄nSœveL©ícy
 !
g≠Rﬁe_SœveL©ícy
) ||

1184 (
g≠Rﬁe_C⁄nTimeout
 !
g≠Rﬁe_TimeoutMu…ùlõr
) )

1186 
l2ˇpP¨amUpd©eReq_t
 
upd©eReq
;

1187 
uöt16
 
timeout
 = 
	`GAP_GëP¨amVÆue
–
TGAP_CONN_PARAM_TIMEOUT
 );

1189 
upd©eReq
.
öãrvÆMö
 = 
g≠Rﬁe_MöC⁄nI¡îvÆ
;

1190 
upd©eReq
.
öãrvÆMax
 = 
g≠Rﬁe_MaxC⁄nI¡îvÆ
;

1191 
upd©eReq
.
¶aveL©ícy
 = 
g≠Rﬁe_SœveL©ícy
;

1192 
upd©eReq
.
timeoutMu…ùlõr
 = 
g≠Rﬁe_TimeoutMu…ùlõr
;

1194 
VOID
 
	`L2CAP_C⁄nP¨amUpd©eReq
–
g≠Rﬁe_C⁄√˘i⁄H™dÀ
, &
upd©eReq
, 
g≠Rﬁe_TaskID
 );

1196 
∑ømUpd©eNoSuc˚ssO±i⁄
 = 
h™dÀFaûuª
;

1199 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
CONN_PARAM_TIMEOUT_EVT
, 
timeout
 );

1201 
	}
}

1217 
bSètus_t
 
	$GAPRﬁe_SídUpd©eP¨am
–
uöt16
 
möC⁄nI¡îvÆ
, uöt16 
maxC⁄nI¡îvÆ
,

1218 
uöt16
 
œãncy
, uöt16 
c⁄nTimeout
, 
uöt8
 
h™dÀFaûuª
 )

1221 i‡–
g≠Rﬁe_°©e
 !
GAPROLE_CONNECTED
 )

1223  ( 
bÀNŸC⁄√˘ed
 );

1227 i‡––
möC⁄nI¡îvÆ
 >
DEFAULT_MIN_CONN_INTERVAL
 ) &&

1228 –
möC⁄nI¡îvÆ
 < 
DEFAULT_MAX_CONN_INTERVAL
 ) &&

1229 –
maxC⁄nI¡îvÆ
 >
DEFAULT_MIN_CONN_INTERVAL
 ) &&

1230 –
maxC⁄nI¡îvÆ
 < 
DEFAULT_MAX_CONN_INTERVAL
 ) &&

1231 –
œãncy
 < 
MAX_SLAVE_LATENCY
 ) &&

1232 –
c⁄nTimeout
 >
MIN_TIMEOUT_MULTIPLIER
 ) &&

1233 –
c⁄nTimeout
 < 
MAX_TIMEOUT_MULTIPLIER
 ) )

1235 
g≠Rﬁe_MöC⁄nI¡îvÆ
 = 
möC⁄nI¡îvÆ
;

1236 
g≠Rﬁe_MaxC⁄nI¡îvÆ
 = 
maxC⁄nI¡îvÆ
;

1237 
g≠Rﬁe_SœveL©ícy
 = 
œãncy
;

1238 
g≠Rﬁe_TimeoutMu…ùlõr
 = 
c⁄nTimeout
;

1241 
	`g≠Rﬁe_°¨tC⁄nUpd©e
–
h™dÀFaûuª
 );

1244 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
START_CONN_UPDATE_EVT
 );

1246  ( 
SUCCESS
 );

1249  ( 
bÀInvÆidR™ge
 );

1250 
	}
}

	@Projects/ble/Profiles/Roles/peripheral.h

41 #i‚de‡
PERIPHERAL_H


42 
	#PERIPHERAL_H


	)

44 #ifde‡
__˝lu•lus


60 
	#GAPROLE_PROFILEROLE
 0x300

61 
	#GAPROLE_IRK
 0x301

62 
	#GAPROLE_SRK
 0x302

63 
	#GAPROLE_SIGNCOUNTER
 0x303

64 
	#GAPROLE_BD_ADDR
 0x304

65 
	#GAPROLE_ADVERT_ENABLED
 0x305

66 
	#GAPROLE_ADVERT_OFF_TIME
 0x306

67 
	#GAPROLE_ADVERT_DATA
 0x307

68 
	#GAPROLE_SCAN_RSP_DATA
 0x308

69 
	#GAPROLE_ADV_EVENT_TYPE
 0x309

70 
	#GAPROLE_ADV_DIRECT_TYPE
 0x30A

71 
	#GAPROLE_ADV_DIRECT_ADDR
 0x30B

72 
	#GAPROLE_ADV_CHANNEL_MAP
 0x30C

73 
	#GAPROLE_ADV_FILTER_POLICY
 0x30D

74 
	#GAPROLE_CONNHANDLE
 0x30E

75 
	#GAPROLE_RSSI_READ_RATE
 0x30F

76 
	#GAPROLE_PARAM_UPDATE_ENABLE
 0x310

77 
	#GAPROLE_MIN_CONN_INTERVAL
 0x311

78 
	#GAPROLE_MAX_CONN_INTERVAL
 0x312

79 
	#GAPROLE_SLAVE_LATENCY
 0x313

80 
	#GAPROLE_TIMEOUT_MULTIPLIER
 0x314

81 
	#GAPROLE_CONN_BD_ADDR
 0x315

82 
	#GAPROLE_CONN_INTERVAL
 0x316

83 
	#GAPROLE_CONN_LATENCY
 0x317

84 
	#GAPROLE_CONN_TIMEOUT
 0x318

85 
	#GAPROLE_PARAM_UPDATE_REQ
 0x319

86 

	)

97 
GAPROLE_INIT
 = 0,

98 
GAPROLE_STARTED
,

99 
GAPROLE_ADVERTISING
,

100 
GAPROLE_WAITING
,

101 
GAPROLE_WAITING_AFTER_TIMEOUT
,

102 
GAPROLE_CONNECTED
,

103 
GAPROLE_ERROR


104 } 
	tg≠rﬁe_Sèãs_t
;

113 
	#GAPROLE_NO_ACTION
 0

114 
	#GAPROLE_RESEND_PARAM_UPDATE
 1

115 
	#GAPROLE_TERMINATE_LINK
 2

116 

	)

128 (*
g≠RﬁesP¨amUpd©eCB_t
)–
	tuöt16
 
	tc⁄nI¡îvÆ
,

129 
	tuöt16
 
	tc⁄nSœveL©ícy
,

130 
	tuöt16
 
	tc⁄nTimeout
 );

136 (*
g≠RﬁesSèãNŸify_t
)–
	tg≠rﬁe_Sèãs_t
 
	t√wSèã
 );

141 (*
g≠RﬁesRssiRód_t
)–
	töt8
 
	t√wRSSI
 );

148 
g≠RﬁesSèãNŸify_t
 
p‚SèãCh™ge
;

149 
g≠RﬁesRssiRód_t
 
p‚RssiRód
;

150 } 
	tg≠RﬁesCBs_t
;

179 
bSètus_t
 
GAPRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 );

196 
bSètus_t
 
GAPRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 );

205 
bSètus_t
 
GAPRﬁe_SèπDevi˚
–
g≠RﬁesCBs_t
 *
pAµCÆlbacks
 );

212 
bSètus_t
 
GAPRﬁe_Tîmö©eC⁄√˘i⁄
( );

225 
bSètus_t
 
GAPRﬁe_SídUpd©eP¨am
–
uöt16
 
möC⁄nI¡îvÆ
, uöt16 
maxC⁄nI¡îvÆ
,

226 
uöt16
 
œãncy
, uöt16 
c⁄nTimeout
, 
uöt8
 
h™dÀFaûuª
 );

235 
GAPRﬁe_Regi°îAµCBs
–
g≠RﬁesP¨amUpd©eCB_t
 *
pP¨amUpd©eCB
 );

260 
GAPRﬁe_Inô
–
uöt8
 
èsk_id
 );

276 
uöt16
 
GAPRﬁe_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

281 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Roles/peripheralBroadcaster.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"hci.h
"

46 
	~"l2ˇp.h
"

47 
	~"g≠.h
"

48 
	~"lökdb.h
"

49 
	~"©t.h
"

50 
	~"g©t.h
"

51 
	~"oßl_¢v.h
"

53 
	~"≥rùhîÆBrﬂdˇ°î.h
"

54 
	~"g≠b⁄dmgr.h
"

64 
	#START_ADVERTISING_EVT
 0x0001

	)

65 
	#RSSI_READ_EVT
 0x0002

	)

66 
	#UPDATE_PARAMS_TIMEOUT_EVT
 0x0004

	)

68 
	#DEFAULT_ADVERT_OFF_TIME
 30000

69 

	)

70 
	#RSSI_NOT_AVAILABLE
 127

	)

72 
	#DEFAULT_MIN_CONN_INTERVAL
 0x0006

73 
	#DEFAULT_MAX_CONN_INTERVAL
 0x0C80

74 

	)

75 
	#MIN_CONN_INTERVAL
 0x0006

	)

76 
	#MAX_CONN_INTERVAL
 0x0C80

	)

78 
	#DEFAULT_SLAVE_LATENCY
 0

	)

79 
	#DEFAULT_TIMEOUT_MULTIPLIER
 1000

	)

81 
	#CONN_INTERVAL_MULTIPLIER
 6

	)

83 
	#MAX_SLAVE_LATENCY
 500

	)

84 
	#MIN_TIMEOUT_MULTIPLIER
 0x000a

	)

85 
	#MAX_TIMEOUT_MULTIPLIER
 0x0c80

	)

87 
	#MAX_TIMEOUT_VALUE
 0xFFFF

	)

108 
uöt8
 
	gg≠Rﬁe_TaskID
;

110 
g≠rﬁe_Sèãs_t
 
	gg≠Rﬁe_°©e
;

117 
uöt8
 
	gg≠Rﬁe_¥ofûeRﬁe
;

118 
uöt8
 
	gg≠Rﬁe_IRK
[
KEYLEN
];

119 
uöt8
 
	gg≠Rﬁe_SRK
[
KEYLEN
];

120 
uöt32
 
	gg≠Rﬁe_signCou¡î
;

121 
uöt8
 
	gg≠Rﬁe_bdAddr
[
B_ADDR_LEN
];

122 
uöt8
 
	gg≠Rﬁe_AdvE«bÀd
 = 
TRUE
;

123 
uöt16
 
	gg≠Rﬁe_AdvîtOffTime
 = 
DEFAULT_ADVERT_OFF_TIME
;

124 
uöt8
 
	gg≠Rﬁe_AdvîtD©aLí
 = 3;

125 
uöt8
 
	gg≠Rﬁe_AdvîtD©a
[
B_MAX_ADV_LEN
] =

128 
GAP_ADTYPE_FLAGS
,

130 (
GAP_ADTYPE_FLAGS_GENERAL
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
),

133 
uöt8
 
	gg≠Rﬁe_SˇnR•D©aLí
 = 0;

134 
uöt8
 
	gg≠Rﬁe_SˇnR•D©a
[
B_MAX_ADV_LEN
] = {0};

135 
uöt8
 
	gg≠Rﬁe_AdvEvítTy≥
;

136 
uöt8
 
	gg≠Rﬁe_AdvDúe˘Ty≥
;

137 
uöt8
 
	gg≠Rﬁe_AdvDúe˘Addr
[
B_ADDR_LEN
] = {0};

138 
uöt8
 
	gg≠Rﬁe_AdvCh™M≠
;

139 
uöt8
 
	gg≠Rﬁe_AdvFûãrPﬁicy
;

141 
uöt16
 
	gg≠Rﬁe_C⁄√˘i⁄H™dÀ
 = 
INVALID_CONNHANDLE
;

142 
uöt16
 
	gg≠Rﬁe_RSSIRódR©e
 = 0;

144 
g≠RﬁesCBs_t
 *
	gpG≠Rﬁes_AµCGs
 = 
NULL
;

145 
uöt8
 
	gg≠Rﬁe_C⁄√˘edDevAddr
[
B_ADDR_LEN
] = {0};

147 
uöt8
 
	gg≠Rﬁe_P¨amUpd©eE«bÀ
 = 
FALSE
;

148 
uöt16
 
	gg≠Rﬁe_MöC⁄nI¡îvÆ
 = 
DEFAULT_MIN_CONN_INTERVAL
;

149 
uöt16
 
	gg≠Rﬁe_MaxC⁄nI¡îvÆ
 = 
DEFAULT_MAX_CONN_INTERVAL
;

150 
uöt16
 
	gg≠Rﬁe_SœveL©ícy
 = 
DEFAULT_SLAVE_LATENCY
;

151 
uöt16
 
	gg≠Rﬁe_TimeoutMu…ùlõr
 = 
DEFAULT_TIMEOUT_MULTIPLIER
;

165 
g≠Rﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

166 
g≠Rﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 );

167 
g≠Rﬁe_SëupGAP
( );

168 
g≠Rﬁe_SídUpd©eP¨am
–
uöt16
 
c⁄nI¡îvÆ
, uöt16 
c⁄nL©ícy
 );

183 
bSètus_t
 
	$GAPRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 )

185 
bSètus_t
 
ªt
 = 
SUCCESS
;

186  
∑øm
 )

188 
GAPROLE_IRK
:

189 i‡–
Àn
 =
KEYLEN
 )

191 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_IRK
, 
pVÆue
, 
KEYLEN
 ) ;

195 
ªt
 = 
bÀInvÆidR™ge
;

199 
GAPROLE_SRK
:

200 i‡–
Àn
 =
KEYLEN
 )

202 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_SRK
, 
pVÆue
, 
KEYLEN
 ) ;

206 
ªt
 = 
bÀInvÆidR™ge
;

210 
GAPROLE_SIGNCOUNTER
:

211 i‡–
Àn
 = ( 
uöt32
 ) )

213 
g≠Rﬁe_signCou¡î
 = *((
uöt32
*)
pVÆue
);

217 
ªt
 = 
bÀInvÆidR™ge
;

221 
GAPROLE_ADVERT_ENABLED
:

222 i‡–
Àn
 =–
uöt8
 ) )

224 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
Ë|| (g≠Rﬁe_°©ê=
GAPROLE_CONNECTED_ADV
) )

226 
uöt8
 
advE«bÀd
 = *((uöt8*)
pVÆue
);

228 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
Ë&& (
advE«bÀd
 =
TRUE
) )

231 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

233 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED_ADV
Ë&& (
advE«bÀd
 =
FALSE
) )

236 
	`GAP_EndDiscovîabÀ
–
g≠Rﬁe_TaskID
 );

241 
uöt8
 
ﬁdAdvE«bÀd
 = 
g≠Rﬁe_AdvE«bÀd
;

242 
g≠Rﬁe_AdvE«bÀd
 = *((
uöt8
*)
pVÆue
);

244 i‡–(
ﬁdAdvE«bÀd
Ë&& (
g≠Rﬁe_AdvE«bÀd
 =
FALSE
) )

247 
VOID
 
	`GAP_EndDiscovîabÀ
–
g≠Rﬁe_TaskID
 );

249 i‡–(
ﬁdAdvE«bÀd
 =
FALSE
Ë&& (
g≠Rﬁe_AdvE«bÀd
) )

252 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_STARTED
)

253 || (
g≠Rﬁe_°©e
 =
GAPROLE_WAITING
 )

254 || (
g≠Rﬁe_°©e
 =
GAPROLE_WAITING_AFTER_TIMEOUT
) )

256 
VOID
 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

263 
ªt
 = 
bÀInvÆidR™ge
;

267 
GAPROLE_ADVERT_OFF_TIME
:

268 i‡–
Àn
 = ( 
uöt16
 ) )

270 
g≠Rﬁe_AdvîtOffTime
 = *((
uöt16
*)
pVÆue
);

274 
ªt
 = 
bÀInvÆidR™ge
;

278 
GAPROLE_ADVERT_DATA
:

279 i‡–
Àn
 <
B_MAX_ADV_LEN
 )

281 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_AdvîtD©a
, 0, 
B_MAX_ADV_LEN
 );

282 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_AdvîtD©a
, 
pVÆue
, 
Àn
 );

283 
g≠Rﬁe_AdvîtD©aLí
 = 
Àn
;

287 
ªt
 = 
bÀInvÆidR™ge
;

291 
GAPROLE_SCAN_RSP_DATA
:

292 i‡–
Àn
 <
B_MAX_ADV_LEN
 )

294 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_SˇnR•D©a
, 0, 
B_MAX_ADV_LEN
 );

295 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_SˇnR•D©a
, 
pVÆue
, 
Àn
 );

296 
g≠Rﬁe_SˇnR•D©aLí
 = 
Àn
;

300 
ªt
 = 
bÀInvÆidR™ge
;

304 
GAPROLE_ADV_EVENT_TYPE
:

305 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAP_ADTYPE_ADV_NONCONN_IND
) )

307 
g≠Rﬁe_AdvEvítTy≥
 = *((
uöt8
*)
pVÆue
);

311 
ªt
 = 
bÀInvÆidR™ge
;

315 
GAPROLE_ADV_DIRECT_TYPE
:

316 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
ADDRTYPE_PRIVATE_RESOLVE
) )

318 
g≠Rﬁe_AdvDúe˘Ty≥
 = *((
uöt8
*)
pVÆue
);

322 
ªt
 = 
bÀInvÆidR™ge
;

326 
GAPROLE_ADV_DIRECT_ADDR
:

327 i‡–
Àn
 =
B_ADDR_LEN
 )

329 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_AdvDúe˘Addr
, 
pVÆue
, 
B_ADDR_LEN
 ) ;

333 
ªt
 = 
bÀInvÆidR™ge
;

337 
GAPROLE_ADV_CHANNEL_MAP
:

338 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
) <= 0x07) )

340 
g≠Rﬁe_AdvCh™M≠
 = *((
uöt8
*)
pVÆue
);

344 
ªt
 = 
bÀInvÆidR™ge
;

348 
GAPROLE_ADV_FILTER_POLICY
:

349 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
GAP_FILTER_POLICY_WHITE
) )

351 
g≠Rﬁe_AdvFûãrPﬁicy
 = *((
uöt8
*)
pVÆue
);

355 
ªt
 = 
bÀInvÆidR™ge
;

359 
GAPROLE_RSSI_READ_RATE
:

360 i‡–
Àn
 = ( 
uöt16
 ) )

362 
g≠Rﬁe_RSSIRódR©e
 = *((
uöt16
*)
pVÆue
);

364 i‡–(
g≠Rﬁe_RSSIRódR©e
Ë&& (
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
) )

367 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
RSSI_READ_EVT
, 
g≠Rﬁe_RSSIRódR©e
 );

372 
ªt
 = 
bÀInvÆidR™ge
;

376 
GAPROLE_PARAM_UPDATE_ENABLE
:

377 i‡–(
Àn
 = ( 
uöt8
 )Ë&& (*((uöt8*)
pVÆue
Ë<
TRUE
) )

379 
g≠Rﬁe_P¨amUpd©eE«bÀ
 = *((
uöt8
*)
pVÆue
);

383 
ªt
 = 
bÀInvÆidR™ge
;

387 
GAPROLE_MIN_CONN_INTERVAL
:

389 
uöt16
 
√wI¡îvÆ
 = *((uöt16*)
pVÆue
);

390 i‡–
Àn
 = ( 
uöt16
 ) &&

391 –
√wI¡îvÆ
 >
MIN_CONN_INTERVAL
 ) &&

392 –
√wI¡îvÆ
 <
MAX_CONN_INTERVAL
 ) )

394 
g≠Rﬁe_MöC⁄nI¡îvÆ
 = 
√wI¡îvÆ
;

398 
ªt
 = 
bÀInvÆidR™ge
;

403 
GAPROLE_MAX_CONN_INTERVAL
:

405 
uöt16
 
√wI¡îvÆ
 = *((uöt16*)
pVÆue
);

406 i‡–
Àn
 = ( 
uöt16
 ) &&

407 –
√wI¡îvÆ
 >
MIN_CONN_INTERVAL
) &&

408 –
√wI¡îvÆ
 <
MAX_CONN_INTERVAL
) )

410 
g≠Rﬁe_MaxC⁄nI¡îvÆ
 = 
√wI¡îvÆ
;

414 
ªt
 = 
bÀInvÆidR™ge
;

419 
GAPROLE_SLAVE_LATENCY
:

421 
uöt16
 
œãncy
 = *((uöt16*)
pVÆue
);

422 i‡–
Àn
 = ( 
uöt16
 ) && (
œãncy
 < 
MAX_SLAVE_LATENCY
) )

424 
g≠Rﬁe_SœveL©ícy
 = 
œãncy
;

428 
ªt
 = 
bÀInvÆidR™ge
;

433 
GAPROLE_TIMEOUT_MULTIPLIER
:

435 
uöt16
 
√wTimeout
 = *((uöt16*)
pVÆue
);

436 i‡–
Àn
 = ( 
uöt16
 )

437 && (
√wTimeout
 >
MIN_TIMEOUT_MULTIPLIER
Ë&& (√wTimeouà<
MAX_TIMEOUT_MULTIPLIER
) )

439 
g≠Rﬁe_TimeoutMu…ùlõr
 = 
√wTimeout
;

443 
ªt
 = 
bÀInvÆidR™ge
;

450 i‡–(
∑øm
 < 
TGAP_PARAMID_MAX
Ë&& (
Àn
 = ( 
uöt16
 )) )

452 
ªt
 = 
	`GAP_SëP¨amVÆue
–
∑øm
, *((
uöt16
*)
pVÆue
) );

456 
ªt
 = 
INVALIDPARAMETER
;

461  ( 
ªt
 );

462 
	}
}

469 
bSètus_t
 
	$GAPRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 )

471 
bSètus_t
 
ªt
 = 
SUCCESS
;

472  
∑øm
 )

474 
GAPROLE_PROFILEROLE
:

475 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_¥ofûeRﬁe
;

478 
GAPROLE_IRK
:

479 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_IRK
, 
KEYLEN
 ) ;

482 
GAPROLE_SRK
:

483 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_SRK
, 
KEYLEN
 ) ;

486 
GAPROLE_SIGNCOUNTER
:

487 *((
uöt32
*)
pVÆue
Ë
g≠Rﬁe_signCou¡î
;

490 
GAPROLE_BD_ADDR
:

491 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_bdAddr
, 
B_ADDR_LEN
 ) ;

494 
GAPROLE_ADVERT_ENABLED
:

495 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvE«bÀd
;

498 
GAPROLE_ADVERT_OFF_TIME
:

499 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_AdvîtOffTime
;

502 
GAPROLE_ADVERT_DATA
:

503 
VOID
 
	`oßl_mem˝y
–
pVÆue
 , 
g≠Rﬁe_AdvîtD©a
, 
g≠Rﬁe_AdvîtD©aLí
 );

506 
GAPROLE_SCAN_RSP_DATA
:

507 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_SˇnR•D©a
, 
g≠Rﬁe_SˇnR•D©aLí
 ) ;

510 
GAPROLE_ADV_EVENT_TYPE
:

511 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvEvítTy≥
;

514 
GAPROLE_ADV_DIRECT_TYPE
:

515 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvDúe˘Ty≥
;

518 
GAPROLE_ADV_DIRECT_ADDR
:

519 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_AdvDúe˘Addr
, 
B_ADDR_LEN
 ) ;

522 
GAPROLE_ADV_CHANNEL_MAP
:

523 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvCh™M≠
;

526 
GAPROLE_ADV_FILTER_POLICY
:

527 *((
uöt8
*)
pVÆue
Ë
g≠Rﬁe_AdvFûãrPﬁicy
;

530 
GAPROLE_CONNHANDLE
:

531 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_C⁄√˘i⁄H™dÀ
;

534 
GAPROLE_RSSI_READ_RATE
:

535 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_RSSIRódR©e
;

538 
GAPROLE_PARAM_UPDATE_ENABLE
:

539 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_P¨amUpd©eE«bÀ
;

542 
GAPROLE_MIN_CONN_INTERVAL
:

543 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_MöC⁄nI¡îvÆ
;

546 
GAPROLE_MAX_CONN_INTERVAL
:

547 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_MaxC⁄nI¡îvÆ
;

550 
GAPROLE_SLAVE_LATENCY
:

551 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_SœveL©ícy
;

554 
GAPROLE_TIMEOUT_MULTIPLIER
:

555 *((
uöt16
*)
pVÆue
Ë
g≠Rﬁe_TimeoutMu…ùlõr
;

558 
GAPROLE_CONN_BD_ADDR
:

559 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
g≠Rﬁe_C⁄√˘edDevAddr
, 
B_ADDR_LEN
 ) ;

564 i‡–
∑øm
 < 
TGAP_PARAMID_MAX
 )

566 *((
uöt16
*)
pVÆue
Ë
	`GAP_GëP¨amVÆue
–
∑øm
 );

570 
ªt
 = 
INVALIDPARAMETER
;

575  ( 
ªt
 );

576 
	}
}

583 
bSètus_t
 
	$GAPRﬁe_SèπDevi˚
–
g≠RﬁesCBs_t
 *
pAµCÆlbacks
 )

585 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_INIT
 )

588 i‡–
pAµCÆlbacks
 )

590 
pG≠Rﬁes_AµCGs
 = 
pAµCÆlbacks
;

594 
	`g≠Rﬁe_SëupGAP
();

596  ( 
SUCCESS
 );

600  ( 
bÀAÃódyInReque°edMode
 );

602 
	}
}

609 
bSètus_t
 
	$GAPRﬁe_Tîmö©eC⁄√˘i⁄
( )

611 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
)

612 || (
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED_ADV
) )

614  ( 
	`GAP_Tîmö©eLökReq
–
g≠Rﬁe_TaskID
, 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 ) );

618  ( 
bÀInc‹ª˘Mode
 );

620 
	}
}

631 
	$GAPRﬁe_Inô
–
uöt8
 
èsk_id
 )

633 
g≠Rﬁe_TaskID
 = 
èsk_id
;

635 
g≠Rﬁe_°©e
 = 
GAPROLE_INIT
;

636 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 = 
INVALID_CONNHANDLE
;

638 
	`GAP_Regi°îF‹HCIMsgs
–
g≠Rﬁe_TaskID
 );

641 
g≠Rﬁe_¥ofûeRﬁe
 = (
GAP_PROFILE_PERIPHERAL
 | 
GAP_PROFILE_BROADCASTER
);

642 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_IRK
, 0, 
KEYLEN
 );

643 
VOID
 
	`oßl_mem£t
–
g≠Rﬁe_SRK
, 0, 
KEYLEN
 );

644 
g≠Rﬁe_signCou¡î
 = 0;

645 
g≠Rﬁe_AdvEvítTy≥
 = 
GAP_ADTYPE_ADV_IND
;

646 
g≠Rﬁe_AdvDúe˘Ty≥
 = 
ADDRTYPE_PUBLIC
;

647 
g≠Rﬁe_AdvCh™M≠
 = 
GAP_ADVCHAN_ALL
;

648 
g≠Rﬁe_AdvFûãrPﬁicy
 = 
GAP_FILTER_POLICY_ALL
;

651 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_IRK
, 
KEYLEN
, 
g≠Rﬁe_IRK
 );

652 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_CSRK
, 
KEYLEN
, 
g≠Rﬁe_SRK
 );

653 
VOID
 
	`oßl_¢v_ªad
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
g≠Rﬁe_signCou¡î
 );

654 
	}
}

661 
uöt16
 
	$GAPRﬁe_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

663 
VOID
 
èsk_id
;

665 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

667 
uöt8
 *
pMsg
;

669 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
g≠Rﬁe_TaskID
 )Ë!
NULL
 )

671 
	`g≠Rﬁe_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

674 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

678  (
evíts
 ^ 
SYS_EVENT_MSG
);

681 i‡–
evíts
 & 
GAP_EVENT_SIGN_COUNTER_CHANGED
 )

684 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_SIGNCOUNTER
, –
uöt32
 ), &
g≠Rﬁe_signCou¡î
 );

686  ( 
evíts
 ^ 
GAP_EVENT_SIGN_COUNTER_CHANGED
 );

689 i‡–
evíts
 & 
START_ADVERTISING_EVT
 )

691 i‡–
g≠Rﬁe_AdvE«bÀd
 )

693 
g≠AdvîtisögP¨ams_t
 
∑øms
;

696 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
 )

699 
∑øms
.
evítTy≥
 = 
GAP_ADTYPE_ADV_NONCONN_IND
;

703 
∑øms
.
evítTy≥
 = 
g≠Rﬁe_AdvEvítTy≥
;

704 
∑øms
.
öôüt‹AddrTy≥
 = 
g≠Rﬁe_AdvDúe˘Ty≥
;

705 
VOID
 
	`oßl_mem˝y
–
∑øms
.
öôüt‹Addr
, 
g≠Rﬁe_AdvDúe˘Addr
, 
B_ADDR_LEN
 );

707 
∑øms
.
ch™√lM≠
 = 
g≠Rﬁe_AdvCh™M≠
;

708 
∑øms
.
fûãrPﬁicy
 = 
g≠Rﬁe_AdvFûãrPﬁicy
;

710 i‡–
	`GAP_MakeDiscovîabÀ
–
g≠Rﬁe_TaskID
, &
∑øms
 ) !
SUCCESS
 )

712 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

713 i‡–
pG≠Rﬁes_AµCGs
 &&ÖG≠Rﬁes_AµCGs->
p‚SèãCh™ge
 )

715 
pG≠Rﬁes_AµCGs
->
	`p‚SèãCh™ge
–
g≠Rﬁe_°©e
 );

719  ( 
evíts
 ^ 
START_ADVERTISING_EVT
 );

722 i‡–
evíts
 & 
RSSI_READ_EVT
 )

725 i‡–(
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
)

726 || (
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED_ADV
) )

729 
VOID
 
	`HCI_RódRssiCmd
–
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 );

732 i‡–
g≠Rﬁe_RSSIRódR©e
 )

734 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
RSSI_READ_EVT
, 
g≠Rﬁe_RSSIRódR©e
 );

737  ( 
evíts
 ^ 
RSSI_READ_EVT
 );

740 i‡–
evíts
 & 
UPDATE_PARAMS_TIMEOUT_EVT
 )

743 i‡–
	`oßl_gë_timeoutEx
–
g≠Rﬁe_TaskID
, 
UPDATE_PARAMS_TIMEOUT_EVT
 ) )

745 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
UPDATE_PARAMS_TIMEOUT_EVT
 );

749 
VOID
 
	`GAP_Tîmö©eLökReq
–
g≠Rﬁe_TaskID
, 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 );

751  ( 
evíts
 ^ 
UPDATE_PARAMS_TIMEOUT_EVT
 );

756 
	}
}

767 
	$g≠Rﬁe_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

769  
pMsg
->
evít
 )

771 
HCI_GAP_EVENT_EVENT
:

772 i‡–
pMsg
->
°©us
 =
HCI_COMMAND_COMPLETE_EVENT_CODE
 )

774 
hciEvt_CmdCom∂ëe_t
 *
pPkt
 = (hciEvt_CmdCom∂ëe_à*)
pMsg
;

776 i‡–
pPkt
->
cmdOpcode
 =
HCI_READ_RSSI
 )

778 
öt8
 
rssi
 = (öt8)
pPkt
->
pRëu∫P¨am
[3];

780 i‡–((
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
)

781 || (
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED_ADV
))

782 && (
rssi
 !
RSSI_NOT_AVAILABLE
) )

785 i‡–
pG≠Rﬁes_AµCGs
 &&ÖG≠Rﬁes_AµCGs->
p‚RssiRód
 )

787 
pG≠Rﬁes_AµCGs
->
	`p‚RssiRód
–
rssi
 );

794 
GAP_MSG_EVENT
:

795 
	`g≠Rﬁe_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

798 
L2CAP_SIGNAL_EVENT
:

800 
l2ˇpSig«lEvít_t
 *
pPkt
 = (l2ˇpSig«lEvít_à*)
pMsg
;

803 i‡–
pPkt
->
›code
 =
L2CAP_PARAM_UPDATE_RSP
 )

805 
l2ˇpP¨amUpd©eR•_t
 *
pR•
 = (l2ˇpP¨amUpd©eR•_à*)&(
pPkt
->
cmd
.
upd©eR•
);

806 i‡–
pR•
->
ªsu…
 =
SUCCESS
 )

809 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
UPDATE_PARAMS_TIMEOUT_EVT
 );

818 
	}
}

829 
	$g≠Rﬁe_Pro˚ssGAPMsg
–
g≠EvítHdr_t
 *
pMsg
 )

831 
uöt8
 
nŸify
 = 
FALSE
;

833  
pMsg
->
›code
 )

835 
GAP_DEVICE_INIT_DONE_EVENT
:

837 
g≠Devi˚InôD⁄eEvít_t
 *
pPkt
 = (g≠Devi˚InôD⁄eEvít_à*)
pMsg
;

838 
bSètus_t
 
°©
 = 
pPkt
->
hdr
.
°©us
;

840 i‡–
°©
 =
SUCCESS
 )

843 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_IRK
, 
KEYLEN
, 
g≠Rﬁe_IRK
 );

844 
VOID
 
	`oßl_¢v_wrôe
–
BLE_NVID_CSRK
, 
KEYLEN
, 
g≠Rﬁe_SRK
 );

847 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_bdAddr
, 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

849 
g≠Rﬁe_°©e
 = 
GAPROLE_STARTED
;

852 
°©
 = 
	`GAP_Upd©eAdvîtisögD©a
–
g≠Rﬁe_TaskID
,

853 
TRUE
, 
g≠Rﬁe_AdvîtD©aLí
, 
g≠Rﬁe_AdvîtD©a
 );

856 i‡–
°©
 !
SUCCESS
 )

858 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

861 
nŸify
 = 
TRUE
;

865 
GAP_ADV_DATA_UPDATE_DONE_EVENT
:

867 
g≠AdvD©aUpd©eEvít_t
 *
pPkt
 = (g≠AdvD©aUpd©eEvít_à*)
pMsg
;

869 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

871 i‡–
pPkt
->
adTy≥
 )

874 
pPkt
->
hdr
.
°©us
 = 
	`GAP_Upd©eAdvîtisögD©a
–
g≠Rﬁe_TaskID
,

875 
FALSE
, 
g≠Rﬁe_SˇnR•D©aLí
, 
g≠Rﬁe_SˇnR•D©a
 );

880 
VOID
 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

884 i‡–
pPkt
->
hdr
.
°©us
 !
SUCCESS
 )

887 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

888 
nŸify
 = 
TRUE
;

893 
GAP_MAKE_DISCOVERABLE_DONE_EVENT
:

894 
GAP_END_DISCOVERABLE_DONE_EVENT
:

896 
g≠MakeDiscovîabÀR•Evít_t
 *
pPkt
 = (g≠MakeDiscovîabÀR•Evít_à*)
pMsg
;

898 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

900 i‡–
pMsg
->
›code
 =
GAP_MAKE_DISCOVERABLE_DONE_EVENT
 )

902 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED
 )

904 
g≠Rﬁe_°©e
 = 
GAPROLE_CONNECTED_ADV
;

908 
g≠Rﬁe_°©e
 = 
GAPROLE_ADVERTISING
;

914 i‡–
g≠Rﬁe_AdvîtOffTime
 != 0 )

916 i‡––
g≠Rﬁe_AdvE«bÀd
 ) )

918 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
, 
g≠Rﬁe_AdvîtOffTime
 );

927 
g≠Rﬁe_AdvE«bÀd
 = 
FALSE
;

931 
g≠Rﬁe_°©e
 = 
GAPROLE_WAITING
;

937 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

939 
nŸify
 = 
TRUE
;

943 
GAP_LINK_ESTABLISHED_EVENT
:

945 
g≠E°LökReqEvít_t
 *
pPkt
 = (g≠E°LökReqEvít_à*)
pMsg
;

947 i‡–
pPkt
->
hdr
.
°©us
 =
SUCCESS
 )

949 
VOID
 
	`oßl_mem˝y
–
g≠Rﬁe_C⁄√˘edDevAddr
, 
pPkt
->
devAddr
, 
B_ADDR_LEN
 );

950 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 = 
pPkt
->
c⁄√˘i⁄H™dÀ
;

951 
g≠Rﬁe_°©e
 = 
GAPROLE_CONNECTED
;

953 i‡–
g≠Rﬁe_RSSIRódR©e
 )

956 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
RSSI_READ_EVT
, 
g≠Rﬁe_RSSIRódR©e
 );

960 i‡––
g≠Rﬁe_P¨amUpd©eE«bÀ
 =
TRUE
 ) &&

961 –(
pPkt
->
c⁄nI¡îvÆ
 < 
g≠Rﬁe_MöC⁄nI¡îvÆ
) ||

962 (
pPkt
->
c⁄nI¡îvÆ
 > 
g≠Rﬁe_MaxC⁄nI¡îvÆ
) ||

963 (
pPkt
->
c⁄nL©ícy
 !
g≠Rﬁe_SœveL©ícy
) ||

964 (
pPkt
->
c⁄nTimeout
 !
g≠Rﬁe_TimeoutMu…ùlõr
) ))

966 
	`g≠Rﬁe_SídUpd©eP¨am
–
pPkt
->
c⁄nI¡îvÆ
,ÖPkt->
c⁄nL©ícy
 );

970 
VOID
 
	`GAPB⁄dMgr_LökE°
–
pPkt
->
devAddrTy≥
,ÖPkt->
devAddr
,ÖPkt->
c⁄√˘i⁄H™dÀ
, 
GAP_PROFILE_PERIPHERAL
 );

974 
g≠Rﬁe_°©e
 = 
GAPROLE_ERROR
;

976 
nŸify
 = 
TRUE
;

980 
GAP_LINK_TERMINATED_EVENT
:

982 
	`GAPB⁄dMgr_Pro˚ssGAPMsg
–(
g≠EvítHdr_t
 *)
pMsg
 );

983 
	`oßl_mem£t
–
g≠Rﬁe_C⁄√˘edDevAddr
, 0, 
B_ADDR_LEN
 );

985 i‡–
g≠Rﬁe_°©e
 =
GAPROLE_CONNECTED_ADV
 )

988 
	`GAP_EndDiscovîabÀ
–
g≠Rﬁe_TaskID
 );

989 
g≠Rﬁe_°©e
 = 
GAPROLE_CONNECTED
;

993 
g≠Tîmö©eLökEvít_t
 *
pPkt
 = (g≠Tîmö©eLökEvít_à*)
pMsg
;

994 if–
pPkt
->
ªas⁄
 =
LL_SUPERVISION_TIMEOUT_TERM
 )

996 
g≠Rﬁe_°©e
 = 
GAPROLE_WAITING_AFTER_TIMEOUT
;

1000 
g≠Rﬁe_°©e
 = 
GAPROLE_WAITING
;

1003 
nŸify
 = 
TRUE
;

1005 
VOID
 
	`oßl_£t_evít
–
g≠Rﬁe_TaskID
, 
START_ADVERTISING_EVT
 );

1008 
g≠Rﬁe_C⁄√˘i⁄H™dÀ
 = 
INVALID_CONNHANDLE
;

1012 
GAP_LINK_PARAM_UPDATE_EVENT
:

1014 
g≠LökUpd©eEvít_t
 *
pPkt
 = (g≠LökUpd©eEvít_à*)
pMsg
;

1016 i‡–(
pPkt
->
hdr
.
°©us
 !
SUCCESS
)

1017 || (
pPkt
->
c⁄nI¡îvÆ
 < 
g≠Rﬁe_MöC⁄nI¡îvÆ
)

1018 || (
pPkt
->
c⁄nI¡îvÆ
 > 
g≠Rﬁe_MaxC⁄nI¡îvÆ
) )

1021 
	`g≠Rﬁe_SídUpd©eP¨am
–
pPkt
->
c⁄nI¡îvÆ
,ÖPkt->
c⁄nL©ícy
 );

1026 
VOID
 
	`oßl_°›_timîEx
–
g≠Rﬁe_TaskID
, 
UPDATE_PARAMS_TIMEOUT_EVT
 );

1035 i‡–
nŸify
 =
TRUE
 )

1038 i‡–
pG≠Rﬁes_AµCGs
 &&ÖG≠Rﬁes_AµCGs->
p‚SèãCh™ge
 )

1040 
pG≠Rﬁes_AµCGs
->
	`p‚SèãCh™ge
–
g≠Rﬁe_°©e
 );

1043 
	}
}

1055 
	$g≠Rﬁe_SëupGAP
( )

1057 
VOID
 
	`GAP_Devi˚Inô
–
g≠Rﬁe_TaskID
,

1058 
g≠Rﬁe_¥ofûeRﬁe
, 0,

1059 
g≠Rﬁe_IRK
, 
g≠Rﬁe_SRK
,

1060 &
g≠Rﬁe_signCou¡î
 );

1061 
	}
}

1073 
	$g≠Rﬁe_SídUpd©eP¨am
–
uöt16
 
c⁄nI¡îvÆ
, uöt16 
c⁄nL©ícy
 )

1075 
l2ˇpP¨amUpd©eReq_t
 
upd©eReq
;

1076 
uöt32
 
timeout
;

1079 
uöt16
 
ef„˘iveOldI¡îvÆ
 = (
c⁄nI¡îvÆ
 * (
c⁄nL©ícy
 + 1));

1082 
uöt16
 
ef„˘iveNewMaxI¡îvÆ
 = (
g≠Rﬁe_MaxC⁄nI¡îvÆ
 * (
g≠Rﬁe_SœveL©ícy
 + 1));

1085 
upd©eReq
.
öãrvÆMö
 = 
g≠Rﬁe_MöC⁄nI¡îvÆ
;

1086 
upd©eReq
.
öãrvÆMax
 = 
g≠Rﬁe_MaxC⁄nI¡îvÆ
;

1087 
upd©eReq
.
¶aveL©ícy
 = 
g≠Rﬁe_SœveL©ícy
;

1088 
upd©eReq
.
timeoutMu…ùlõr
 = 
g≠Rﬁe_TimeoutMu…ùlõr
;

1090 
VOID
 
	`L2CAP_C⁄nP¨amUpd©eReq
–
g≠Rﬁe_C⁄√˘i⁄H™dÀ
, &
upd©eReq
, 
g≠Rﬁe_TaskID
 );

1093 if–
ef„˘iveOldI¡îvÆ
 > 
ef„˘iveNewMaxI¡îvÆ
 )

1095 
timeout
 = (
uöt32
)(
ef„˘iveOldI¡îvÆ
Ë* 
CONN_INTERVAL_MULTIPLIER
;

1099 
timeout
 = (
uöt32
)(
ef„˘iveNewMaxI¡îvÆ
Ë* 
CONN_INTERVAL_MULTIPLIER
;

1102 if–
timeout
 > 
MAX_TIMEOUT_VALUE
 )

1104 
timeout
 = 
MAX_TIMEOUT_VALUE
;

1107 
VOID
 
	`oßl_°¨t_timîEx
–
g≠Rﬁe_TaskID
, 
UPDATE_PARAMS_TIMEOUT_EVT
, (
uöt16
)(
timeout
) );

1108 
	}
}

	@Projects/ble/Profiles/Roles/peripheralBroadcaster.h

42 #i‚de‡
PERIPHERAL_BROADCASTER_H


43 
	#PERIPHERAL_BROADCASTER_H


	)

45 #ifde‡
__˝lu•lus


61 
	#GAPROLE_PROFILEROLE
 0x300

62 
	#GAPROLE_IRK
 0x301

63 
	#GAPROLE_SRK
 0x302

64 
	#GAPROLE_SIGNCOUNTER
 0x303

65 
	#GAPROLE_BD_ADDR
 0x304

66 
	#GAPROLE_ADVERT_ENABLED
 0x305

67 
	#GAPROLE_ADVERT_OFF_TIME
 0x306

68 
	#GAPROLE_ADVERT_DATA
 0x307

69 
	#GAPROLE_SCAN_RSP_DATA
 0x308

70 
	#GAPROLE_ADV_EVENT_TYPE
 0x309

71 
	#GAPROLE_ADV_DIRECT_TYPE
 0x30A

72 
	#GAPROLE_ADV_DIRECT_ADDR
 0x30B

73 
	#GAPROLE_ADV_CHANNEL_MAP
 0x30C

74 
	#GAPROLE_ADV_FILTER_POLICY
 0x30D

75 
	#GAPROLE_CONNHANDLE
 0x30E

76 
	#GAPROLE_RSSI_READ_RATE
 0x30F

77 
	#GAPROLE_PARAM_UPDATE_ENABLE
 0x310

78 
	#GAPROLE_MIN_CONN_INTERVAL
 0x311

79 
	#GAPROLE_MAX_CONN_INTERVAL
 0x312

80 
	#GAPROLE_SLAVE_LATENCY
 0x313

81 
	#GAPROLE_TIMEOUT_MULTIPLIER
 0x314

82 
	#GAPROLE_CONN_BD_ADDR
 0x315

83 

	)

94 
GAPROLE_INIT
 = 0,

95 
GAPROLE_STARTED
,

96 
GAPROLE_ADVERTISING
,

97 
GAPROLE_WAITING
,

98 
GAPROLE_WAITING_AFTER_TIMEOUT
,

99 
GAPROLE_CONNECTED
,

100 
GAPROLE_CONNECTED_ADV
,

101 
GAPROLE_ERROR


102 } 
	tg≠rﬁe_Sèãs_t
;

116 (*
g≠RﬁesSèãNŸify_t
)–
	tg≠rﬁe_Sèãs_t
 
	t√wSèã
 );

121 (*
g≠RﬁesRssiRód_t
)–
	töt8
 
	t√wRSSI
 );

128 
g≠RﬁesSèãNŸify_t
 
p‚SèãCh™ge
;

129 
g≠RﬁesRssiRód_t
 
p‚RssiRód
;

130 } 
	tg≠RﬁesCBs_t
;

159 
bSètus_t
 
GAPRﬁe_SëP¨amëî
–
uöt16
 
∑øm
, 
uöt8
 
Àn
, *
pVÆue
 );

176 
bSètus_t
 
GAPRﬁe_GëP¨amëî
–
uöt16
 
∑øm
, *
pVÆue
 );

185 
bSètus_t
 
GAPRﬁe_SèπDevi˚
–
g≠RﬁesCBs_t
 *
pAµCÆlbacks
 );

192 
bSètus_t
 
GAPRﬁe_Tîmö©eC⁄√˘i⁄
( );

217 
GAPRﬁe_Inô
–
uöt8
 
èsk_id
 );

233 
uöt16
 
GAPRﬁe_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

238 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/ScanParam/scanparamservice.c

42 
	~"bcomdef.h
"

43 
	~"OSAL.h
"

44 
	~"©t.h
"

45 
	~"g©t.h
"

46 
	~"g©t_uuid.h
"

47 
	~"g©t£rv≠p.h
"

48 
	~"g≠b⁄dmgr.h
"

49 
	~"lökdb.h
"

50 
	~"sˇ≈¨am£rvi˚.h
"

68 
CONST
 
uöt8
 
	gsˇnP¨amSîvUUID
[
ATT_BT_UUID_SIZE
] =

70 
LO_UINT16
(
SCAN_PARAM_SERVICE_UUID
), 
HI_UINT16
(SCAN_PARAM_SERVICE_UUID)

74 
CONST
 
uöt8
 
	gsˇnI¡îvÆWödowUUID
[
ATT_BT_UUID_SIZE
] =

76 
LO_UINT16
(
SCAN_INTERVAL_WINDOW_UUID
), 
HI_UINT16
(SCAN_INTERVAL_WINDOW_UUID)

80 
CONST
 
uöt8
 
	gsˇnP¨amRe‰eshUUID
[
ATT_BT_UUID_SIZE
] =

82 
LO_UINT16
(
SCAN_PARAM_REFRESH_UUID
), 
HI_UINT16
(SCAN_PARAM_REFRESH_UUID)

99 
sˇnP¨amSîvi˚CB_t
 
	gsˇnP¨amSîvi˚CB
;

106 
CONST
 
g©tAârTy≥_t
 
	gsˇnP¨amSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
sˇnP¨amSîvUUID
 };

109 
uöt8
 
	gsˇnI¡îvÆWödowPr›s
 = 
GATT_PROP_WRITE_NO_RSP
;

110 
uöt8
 
	gsˇnI¡îvÆWödow
[
SCAN_INTERVAL_WINDOW_CHAR_LEN
];

113 
uöt8
 
	gsˇnP¨amRe‰eshPr›s
 = 
GATT_PROP_NOTIFY
;

114 
uöt8
 
	gsˇnP¨amRe‰esh
[
SCAN_PARAM_REFRESH_LEN
];

115 
g©tCh¨Cfg_t
 
	gsˇnP¨amRe‰eshClõ¡Ch¨Cfg
[
GATT_MAX_NUM_CONN
];

121 
g©tAâribuã_t
 
	gsˇnP¨amAârTbl
[] =

125 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

126 
GATT_PERMIT_READ
,

128 (
uöt8
 *)&
sˇnP¨amSîvi˚


133 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

134 
GATT_PERMIT_READ
,

136 &
sˇnI¡îvÆWödowPr›s


141 { 
ATT_BT_UUID_SIZE
, 
sˇnI¡îvÆWödowUUID
 },

142 
GATT_PERMIT_WRITE
,

144 
sˇnI¡îvÆWödow


149 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

150 
GATT_PERMIT_READ
,

152 &
sˇnP¨amRe‰eshPr›s


157 { 
ATT_BT_UUID_SIZE
, 
sˇnP¨amRe‰eshUUID
 },

160 
sˇnP¨amRe‰esh


165 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

166 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

168 (
uöt8
 *Ë&
sˇnP¨amRe‰eshClõ¡Ch¨Cfg


175 
	mSCAN_PARAM_SERVICE_IDX
,

176 
	mSCAN_PARAM_INTERVAL_DECL_IDX
,

177 
	mSCAN_PARAM_INTERVAL_IDX
,

178 
	mSCAN_PARAM_REFRESH_DECL_IDX
,

179 
	mSCAN_PARAM_REFRESH_IDX
,

180 
	mSCAN_PARAM_REFRESH_CCCD_IDX


187 
bSètus_t
 
sˇnP¨amWrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

188 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

189 
uöt8
 
sˇnP¨amRódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

190 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

197 
CONST
 
g©tSîvi˚CBs_t
 
	gsˇnP¨amCBs
 =

199 
sˇnP¨amRódAârCB
,

200 
sˇnP¨amWrôeAârCB
,

201 
NULL


216 
bSètus_t
 
	$SˇnP¨am_AddSîvi˚
( )

218 
uöt8
 
°©us
 = 
SUCCESS
;

221 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
sˇnP¨amRe‰eshClõ¡Ch¨Cfg
 );

224 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
sˇnP¨amAârTbl
, 
	`GATT_NUM_ATTRS
( scanParamAttrTbl ),

225 &
sˇnP¨amCBs
 );

227  ( 
°©us
 );

228 
	}
}

239 
	$SˇnP¨am_Regi°î
–
sˇnP¨amSîvi˚CB_t
 
p‚Sîvi˚CB
 )

241 
sˇnP¨amSîvi˚CB
 = 
p‚Sîvi˚CB
;

242 
	}
}

258 
bSètus_t
 
	$SˇnP¨am_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

260 
bSètus_t
 
ªt
 = 
SUCCESS
;

262  
∑øm
 )

265 
ªt
 = 
INVALIDPARAMETER
;

269  ( 
ªt
 );

270 
	}
}

285 
bSètus_t
 
	$SˇnP¨am_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

287 
bSètus_t
 
ªt
 = 
SUCCESS
;

288  
∑øm
 )

290 
SCAN_PARAM_PARAM_INTERVAL
:

291 *((
uöt16
*)
vÆue
Ë
	`BUILD_UINT16
(
sˇnI¡îvÆWödow
[0],

292 
sˇnI¡îvÆWödow
[1]);

295 
SCAN_PARAM_PARAM_WINDOW
:

296 *((
uöt16
*)
vÆue
Ë
	`BUILD_UINT16
(
sˇnI¡îvÆWödow
[2],

297 
sˇnI¡îvÆWödow
[3]);

301 
ªt
 = 
INVALIDPARAMETER
;

305  ( 
ªt
 );

306 
	}
}

317 
	$SˇnP¨am_Re‰eshNŸify
–
uöt16
 
c⁄nH™dÀ
 )

319 
©tH™dÀVÆueNŸi_t
 
nŸi
;

320 
uöt16
 
vÆue
;

322 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
sˇnP¨amRe‰eshClõ¡Ch¨Cfg
 );

324 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

327 
nŸi
.
h™dÀ
 = 
sˇnP¨amAârTbl
[
SCAN_PARAM_REFRESH_CCCD_IDX
].handle;

328 
nŸi
.
Àn
 = 
SCAN_PARAM_REFRESH_LEN
;

329 
nŸi
.
vÆue
[0] = 
SCAN_PARAM_REFRESH_REQ
;

330 
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, &
nŸi
, 
FALSE
 );

332 
	}
}

348 
uöt8
 
	$sˇnP¨amRódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

349 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

351 
bSètus_t
 
°©us
 = 
SUCCESS
;

353  ( 
°©us
 );

354 
	}
}

369 
bSètus_t
 
	$sˇnP¨amWrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

370 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

372 
bSètus_t
 
°©us
 = 
SUCCESS
;

375 i‡–
off£t
 > 0 )

377  ( 
ATT_ERR_ATTR_NOT_LONG
 );

380 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

383 i‡–
uuid
 =
SCAN_INTERVAL_WINDOW_UUID
 )

386 i‡–
	`lökDB_En¸y±ed
–
c⁄nH™dÀ
 ) =
FALSE
 )

388  ( 
ATT_ERR_INSUFFICIENT_ENCRYPT
 );

391 i‡–
Àn
 =
SCAN_INTERVAL_WINDOW_CHAR_LEN
 )

393 
uöt16
 
öãrvÆ
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

394 
uöt16
 
wödow
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

397 i‡–
wödow
 <
öãrvÆ
 )

399 
	`oßl_mem˝y
–
pAâr
->
pVÆue
,ÖVÆue, 
Àn
 );

401 (*
sˇnP¨amSîvi˚CB
)–
SCAN_INTERVAL_WINDOW_SET
 );

405 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

410 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

413 i‡–
uuid
 =
GATT_CLIENT_CHAR_CFG_UUID
 )

415 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

416 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

420 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

423  ( 
°©us
 );

424 
	}
}

436 
	$SˇnP¨am_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

439 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

442 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

443 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

444 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

446 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
sˇnP¨amRe‰eshClõ¡Ch¨Cfg
 );

449 
	}
}

	@Projects/ble/Profiles/ScanParam/scanparamservice.h

40 #i‚de‡
SCANPARAMSERVICE_H


41 
	#SCANPARAMSERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#SCAN_PARAM_SERVICE_UUID
 0x1813

	)

58 
	#SCAN_INTERVAL_WINDOW_UUID
 0x2A4F

	)

59 
	#SCAN_PARAM_REFRESH_UUID
 0x2A31

	)

62 
	#SCAN_INTERVAL_WINDOW_CHAR_LEN
 4

	)

63 
	#SCAN_PARAM_REFRESH_LEN
 1

	)

66 
	#SCAN_PARAM_REFRESH_REQ
 0x00

	)

69 
	#SCAN_INTERVAL_WINDOW_SET
 1

	)

72 
	#SCAN_PARAM_PARAM_INTERVAL
 0

	)

73 
	#SCAN_PARAM_PARAM_WINDOW
 1

	)

88 (*
sˇnP¨amSîvi˚CB_t
)–
	tuöt8
 
	tevít
 );

102 
bSètus_t
 
SˇnP¨am_AddSîvi˚
( );

113 
SˇnP¨am_Regi°î
–
sˇnP¨amSîvi˚CB_t
 
p‚Sîvi˚CB
 );

129 
bSètus_t
 
SˇnP¨am_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

144 
bSètus_t
 
SˇnP¨am_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

155 
SˇnP¨am_Re‰eshNŸify
–
uöt16
 
c⁄nH™dÀ
 );

167 
SˇnP¨am_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

172 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/SensorProfile/accelerometerservice.c

43 
	~"bcomdef.h
"

44 
	~"lökdb.h
"

45 
	~"g©t.h
"

46 
	~"g©t_uuid.h
"

47 
	~"g©t£rv≠p.h
"

49 
	~"ac˚Àromëî£rvi˚.h
"

50 
	~"°_utû.h
"

69 
CONST
 
uöt8
 
	gac˚lSîvUUID
[
TI_UUID_SIZE
] =

71 
TI_UUID
(
ACCELEROMETER_SERV_UUID
),

75 
CONST
 
uöt8
 
	gac˚lD©aUUID
[
TI_UUID_SIZE
] =

77 
TI_UUID
(
ACCELEROMETER_DATA_UUID
),

81 
CONST
 
uöt8
 
	gac˚lCfgUUID
[
TI_UUID_SIZE
] =

83 
TI_UUID
(
ACCELEROMETER_CONF_UUID
),

87 
CONST
 
uöt8
 
	gac˚lPîiodUUID
[
TI_UUID_SIZE
] =

89 
TI_UUID
(
ACCELEROMETER_PERI_UUID
),

105 
ac˚lCBs_t
 *
	gac˚l_AµCBs
 = 
NULL
;

112 
CONST
 
g©tAârTy≥_t
 
	gac˚lSîvi˚
 = { 
TI_UUID_SIZE
, 
ac˚lSîvUUID
 };

115 
uöt8
 
	gac˚lD©aPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

117 
uöt8
 
	gac˚lD©a
[
ACCELEROMETER_DATA_LEN
] = { 0, 0, 0};

120 
g©tCh¨Cfg_t
 
	gac˚lD©aC⁄fig
[
GATT_MAX_NUM_CONN
];

123 
uöt8
 
	gac˚lD©aU£rDe•
[] = "Accel. Data";

126 
uöt8
 
	gac˚lCfgPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

129 
uöt8
 
	gac˚lCfg
 = 0;

132 
uöt8
 
	gac˚lCfgU£rDe•
[] = "Accel. Conf.";

135 
uöt8
 
	gaccPîPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

138 
uöt8
 
	gaccPî
 = 0;

141 
uöt8
 
	gaccPîU£rDe•
[] = "Acc. Period";

147 
g©tAâribuã_t
 
	gac˚lAârTbl
[] =

150 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

151 
GATT_PERMIT_READ
,

153 (
uöt8
 *)&
ac˚lSîvi˚


158 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

159 
GATT_PERMIT_READ
,

161 &
ac˚lD©aPr›s


166 { 
TI_UUID_SIZE
, 
ac˚lD©aUUID
 },

167 
GATT_PERMIT_READ
,

169 
ac˚lD©a


174 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

175 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

177 (
uöt8
 *)
ac˚lD©aC⁄fig


182 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

183 
GATT_PERMIT_READ
,

185 
ac˚lD©aU£rDe•


190 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

191 
GATT_PERMIT_READ
,

193 &
ac˚lCfgPr›s


198 { 
TI_UUID_SIZE
, 
ac˚lCfgUUID
 },

199 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

201 &
ac˚lCfg


206 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

207 
GATT_PERMIT_READ
,

209 
ac˚lCfgU£rDe•


213 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

214 
GATT_PERMIT_READ
,

216 &
accPîPr›s


221 { 
TI_UUID_SIZE
, 
ac˚lPîiodUUID
 },

222 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

224 &
accPî


229 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

230 
GATT_PERMIT_READ
,

232 
accPîU£rDe•


240 
uöt8
 
acc_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

241 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

242 
bSètus_t
 
acc_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

243 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

244 
acc_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

251 
CONST
 
g©tSîvi˚CBs_t
 
	gaccCBs
 =

253 
acc_RódAârCB
,

254 
acc_WrôeAârCB
,

255 
NULL


273 
bSètus_t
 
	$Ac˚l_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

275 
uöt8
 
°©us
 = 
SUCCESS
;

278 
VOID
 
	`lökDB_Regi°î
–
acc_H™dÀC⁄nSètusCB
 );

279 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ac˚lD©aC⁄fig
 );

281 i‡(
£rvi˚s
 & 
ACCELEROMETER_SERVICE
 )

284 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
ac˚lAârTbl
,

285 
	`GATT_NUM_ATTRS
–
ac˚lAârTbl
 ),

286 &
accCBs
 );

289  ( 
°©us
 );

290 
	}
}

303 
bSètus_t
 
	$Ac˚l_Regi°îAµCBs
–
ac˚lCBs_t
 *
≠pCÆlbacks
 )

305 i‡–
ac˚l_AµCBs
 =
NULL
 )

307 i‡–
≠pCÆlbacks
 !
NULL
 )

309 
ac˚l_AµCBs
 = 
≠pCÆlbacks
;

312  ( 
SUCCESS
 );

315  ( 
bÀAÃódyInReque°edMode
 );

316 
	}
}

332 
bSètus_t
 
	$Ac˚l_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

334 
bSètus_t
 
ªt
 = 
SUCCESS
;

336  
∑øm
 )

338 
ACCELEROMETER_DATA
:

339 i‡–
Àn
 =
ACCELEROMETER_DATA_LEN
 )

341 
VOID
 
	`oßl_mem˝y
–
ac˚lD©a
, 
vÆue
, 
ACCELEROMETER_DATA_LEN
 );

343 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
ac˚lD©aC⁄fig
, 
ac˚lD©a
, 
FALSE
,

344 
ac˚lAârTbl
, 
	`GATT_NUM_ATTRS
(áccelAttrTbl ),

345 
INVALID_TASK_ID
 );

349 
ªt
 = 
bÀInvÆidR™ge
;

353 
ACCELEROMETER_CONF
:

354 i‡–
Àn
 = ( 
uöt8
 ) )

356 
ac˚lCfg
 = *((
uöt8
*)
vÆue
);

360 
ªt
 = 
bÀInvÆidR™ge
;

364 
ACCELEROMETER_PERI
:

365 i‡–
Àn
 = ( 
uöt8
 ) )

367 
accPî
 = *((
uöt8
*)
vÆue
);

371 
ªt
 = 
bÀInvÆidR™ge
;

376 
ªt
 = 
INVALIDPARAMETER
;

380  ( 
ªt
 );

381 
	}
}

396 
bSètus_t
 
	$Ac˚l_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

398 
bSètus_t
 
ªt
 = 
SUCCESS
;

400  
∑øm
 )

402 
ACCELEROMETER_DATA
:

403 
VOID
 
	`oßl_mem˝y
–
vÆue
, 
ac˚lD©a
, 
ACCELEROMETER_DATA_LEN
 );

406 
ACCELEROMETER_CONF
:

407 *((
uöt8
*)
vÆue
Ë
ac˚lCfg
;

410 
ACCELEROMETER_PERI
:

411 *((
uöt8
*)
vÆue
Ë
accPî
;

415 
ªt
 = 
INVALIDPARAMETER
;

419  ( 
ªt
 );

420 
	}
}

436 
uöt8
 
	$acc_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

437 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

439 
uöt16
 
uuid
;

440 
bSètus_t
 
°©us
 = 
SUCCESS
;

443 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

446  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

450 i‡–
off£t
 > 0 )

452  ( 
ATT_ERR_ATTR_NOT_LONG
 );

455 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
) {

457 *
pLí
 = 0;

458  
ATT_ERR_INVALID_HANDLE
;

461  
uuid
 )

465 
ACCELEROMETER_DATA_UUID
:

466 *
pLí
 = 
ACCELEROMETER_DATA_LEN
;

467 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
ACCELEROMETER_DATA_LEN
 );

470 
ACCELEROMETER_CONF_UUID
:

471 
ACCELEROMETER_PERI_UUID
:

472 *
pLí
 = 1;

473 
pVÆue
[0] = *
pAâr
->pValue;

477 *
pLí
 = 0;

478 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

482  ( 
°©us
 );

483 
	}
}

498 
bSètus_t
 
	$acc_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

499 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

501 
bSètus_t
 
°©us
 = 
SUCCESS
;

502 
uöt8
 
nŸifyAµ
 = 0xFF;

503 
uöt16
 
uuid
;

506 i‡–
	`g©tPîmôAuth‹Wrôe
–
pAâr
->
≥rmissi⁄s
 ) )

509  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

512 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
) {

514  
ATT_ERR_INVALID_HANDLE
;

517  
uuid
 )

519 
ACCELEROMETER_DATA_UUID
:

523 
ACCELEROMETER_CONF_UUID
:

526 i‡–
off£t
 == 0 )

528 i‡–
Àn
 != 1 )

530 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

535 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

539 i‡–
°©us
 =
SUCCESS
 )

541 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

543 *
pCurVÆue
 = 
pVÆue
[0];

545 if–
pAâr
->
pVÆue
 =&
ac˚lCfg
 )

547 
nŸifyAµ
 = 
ACCELEROMETER_CONF
;

552 
ACCELEROMETER_PERI_UUID
:

555 i‡–
off£t
 == 0 )

557 i‡–
Àn
 != 1 )

559 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

564 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

567 i‡–
°©us
 =
SUCCESS
 )

569 i‡(
pVÆue
[0]>=(
ACCELEROMETER_MIN_PERIOD
/
ACCELEROMETER_TIME_UNIT
))

572 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

573 *
pCurVÆue
 = 
pVÆue
[0];

575 if–
pAâr
->
pVÆue
 =&
accPî
 )

577 
nŸifyAµ
 = 
ACCELEROMETER_PERI
;

582 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

587 
GATT_CLIENT_CHAR_CFG_UUID
:

588 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

589 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

594 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

599 i‡–(
nŸifyAµ
 !0xFF ) && 
ac˚l_AµCBs
 &&ác˚l_AµCBs->
p‚Ac˚lCh™ge
 )

601 
ac˚l_AµCBs
->
	`p‚Ac˚lCh™ge
–
nŸifyAµ
 );

604  ( 
°©us
 );

605 
	}
}

617 
	$acc_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

620 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

623 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

624 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

625 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

627 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ac˚lD©aC⁄fig
 );

630 
	}
}

	@Projects/ble/Profiles/SensorProfile/accelerometerservice.h

40 #i‚de‡
ACCELEROMETERSERVICE_H


41 
	#ACCELEROMETERSERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#ACCELEROMETER_DATA
 2

58 
	#ACCELEROMETER_CONF
 3

59 
	#ACCELEROMETER_PERI
 4

60 

	)

62 
	#ACCELEROMETER_SERV_UUID
 0xAA10

63 
	#ACCELEROMETER_DATA_UUID
 0xAA11

	)

64 
	#ACCELEROMETER_CONF_UUID
 0xAA12

	)

65 
	#ACCELEROMETER_PERI_UUID
 0xAA13

	)

68 
	#ACCELEROMETER_SERVICE
 0x00000002

	)

71 
	#ACCELEROMETER_DATA_LEN
 3

	)

74 
	#ACCELEROMETER_MIN_PERIOD
 100

	)

75 
	#ACCELEROMETER_TIME_UNIT
 10

76 

	)

90 
NULL_OK
 (*
	tac˚lCh™ge_t
)–
	tuöt8
 
	t∑ømID
 );

94 
ac˚lCh™ge_t
 
p‚Ac˚lCh™ge
;

95 } 
	tac˚lCBs_t
;

109 
bSètus_t
 
Ac˚l_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

117 
bSètus_t
 
Ac˚l_Regi°îAµCBs
–
ac˚lCBs_t
 *
≠pCÆlbacks
 );

129 
bSètus_t
 
Ac˚l_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

140 
bSètus_t
 
Ac˚l_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

146 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/SensorProfile/barometerservice.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"g≠b⁄dmgr.h
"

52 
	~"b¨omëî£rvi˚.h
"

53 
	~"°_utû.h
"

72 
CONST
 
uöt8
 
	gb¨SîvUUID
[
TI_UUID_SIZE
] =

74 
TI_UUID
(
BAROMETER_SERV_UUID
),

78 
CONST
 
uöt8
 
	gb¨D©aUUID
[
TI_UUID_SIZE
] =

80 
TI_UUID
(
BAROMETER_DATA_UUID
),

84 
CONST
 
uöt8
 
	gb¨CÆUUID
[
TI_UUID_SIZE
] =

86 
TI_UUID
(
BAROMETER_CALI_UUID
),

90 
CONST
 
uöt8
 
	gb¨CfgUUID
[
TI_UUID_SIZE
] =

92 
TI_UUID
(
BAROMETER_CONF_UUID
),

108 
b¨omëîCBs_t
 *
	gb¨omëî_AµCBs
 = 
NULL
;

115 
CONST
 
g©tAârTy≥_t
 
	gb¨Sîvi˚
 = { 
TI_UUID_SIZE
, 
b¨SîvUUID
 };

118 
uöt8
 
	gb¨D©aPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

120 
uöt8
 
	gb¨D©a
[
BAROMETER_DATA_LEN
] = { 0, 0, 0, 0};

123 
g©tCh¨Cfg_t
 
	gb¨D©aC⁄fig
[
GATT_MAX_NUM_CONN
];

126 
uöt8
 
	gb¨D©aU£rDe•
[] = "Barometer Data";

129 
uöt8
 
	gb¨CÆPr›s
 = 
GATT_PROP_READ
;

132 
uöt8
 
	gb¨CÆ
[
BAROMETER_CALI_LEN
] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

135 
g©tCh¨Cfg_t
 
	gb¨CÆC⁄fig
[
GATT_MAX_NUM_CONN
];

138 
uöt8
 
	gb¨CÆU£rDe•
[] = "Barometer Cali.";

141 
uöt8
 
	gb¨CfgPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

144 
uöt8
 
	gb¨Cfg
 = 0;

147 
uöt8
 
	gb¨CfgU£rDe•
[] = "Barometer Conf.";

153 
g©tAâribuã_t
 
	g£ns‹B¨omëîAârTbl
[] =

156 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

157 
GATT_PERMIT_READ
,

159 (
uöt8
 *)&
b¨Sîvi˚


164 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

165 
GATT_PERMIT_READ
,

167 &
b¨D©aPr›s


172 { 
TI_UUID_SIZE
, 
b¨D©aUUID
 },

173 
GATT_PERMIT_READ
,

175 
b¨D©a


180 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

181 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

183 (
uöt8
 *)
b¨D©aC⁄fig


188 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

189 
GATT_PERMIT_READ
,

191 
b¨D©aU£rDe•


196 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

197 
GATT_PERMIT_READ
,

199 &
b¨CfgPr›s


204 { 
TI_UUID_SIZE
, 
b¨CfgUUID
 },

205 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

207 &
b¨Cfg


212 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

213 
GATT_PERMIT_READ
,

215 
b¨CfgU£rDe•


221 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

222 
GATT_PERMIT_READ
,

224 &
b¨CÆPr›s


229 { 
TI_UUID_SIZE
, 
b¨CÆUUID
 },

230 
GATT_PERMIT_READ
,

232 
b¨CÆ


237 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

238 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

240 (
uöt8
 *)
b¨CÆC⁄fig


245 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

246 
GATT_PERMIT_READ
,

248 
b¨CÆU£rDe•


256 
uöt8
 
b¨omëî_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

257 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

258 
bSètus_t
 
b¨omëî_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

259 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

260 
b¨omëî_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

266 
CONST
 
g©tSîvi˚CBs_t
 
	g£ns‹ProfûeCBs
 =

268 
b¨omëî_RódAârCB
,

269 
b¨omëî_WrôeAârCB
,

270 
NULL


288 
bSètus_t
 
	$B¨omëî_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

290 
uöt8
 
°©us
 = 
SUCCESS
;

293 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
b¨D©aC⁄fig
 );

294 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
b¨CÆC⁄fig
 );

297 
VOID
 
	`lökDB_Regi°î
–
b¨omëî_H™dÀC⁄nSètusCB
 );

299 i‡–
£rvi˚s
 & 
BAROMETER_SERVICE
 )

302 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
£ns‹B¨omëîAârTbl
,

303 
	`GATT_NUM_ATTRS
–
£ns‹B¨omëîAârTbl
 ),

304 &
£ns‹ProfûeCBs
 );

307  ( 
°©us
 );

308 
	}
}

321 
bSètus_t
 
	$B¨omëî_Regi°îAµCBs
–
b¨omëîCBs_t
 *
≠pCÆlbacks
 )

323 i‡–
b¨omëî_AµCBs
 =
NULL
 )

325 i‡–
≠pCÆlbacks
 !
NULL
 )

327 
b¨omëî_AµCBs
 = 
≠pCÆlbacks
;

330  ( 
SUCCESS
 );

333  ( 
bÀAÃódyInReque°edMode
 );

334 
	}
}

350 
bSètus_t
 
	$B¨omëî_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

352 
bSètus_t
 
ªt
 = 
SUCCESS
;

354  
∑øm
 )

356 
BAROMETER_DATA
:

357 i‡–
Àn
 =
BAROMETER_DATA_LEN
 )

359 
VOID
 
	`oßl_mem˝y
–
b¨D©a
, 
vÆue
, 
BAROMETER_DATA_LEN
 );

362 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
b¨D©aC⁄fig
, 
b¨D©a
, 
FALSE
,

363 
£ns‹B¨omëîAârTbl
, 
	`GATT_NUM_ATTRS
( sensorBarometerAttrTbl ),

364 
INVALID_TASK_ID
 );

368 
ªt
 = 
bÀInvÆidR™ge
;

372 
BAROMETER_CALI
:

373 i‡–
Àn
 =
BAROMETER_CALI_LEN
 )

375 
VOID
 
	`oßl_mem˝y
–
b¨CÆ
, 
vÆue
, 
BAROMETER_CALI_LEN
 );

378 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
b¨CÆC⁄fig
, 
b¨CÆ
, 
FALSE
,

379 
£ns‹B¨omëîAârTbl
, 
	`GATT_NUM_ATTRS
( sensorBarometerAttrTbl ),

380 
INVALID_TASK_ID
 );

384 
ªt
 = 
bÀInvÆidR™ge
;

388 
BAROMETER_CONF
:

389 i‡–
Àn
 = ( 
uöt8
 ) )

391 
b¨Cfg
 = *((
uöt8
*)
vÆue
);

395 
ªt
 = 
bÀInvÆidR™ge
;

400 
ªt
 = 
INVALIDPARAMETER
;

404  ( 
ªt
 );

405 
	}
}

420 
bSètus_t
 
	$B¨omëî_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

422 
bSètus_t
 
ªt
 = 
SUCCESS
;

424  
∑øm
 )

426 
BAROMETER_DATA
:

427 
VOID
 
	`oßl_mem˝y
–
vÆue
, 
b¨D©a
, 
BAROMETER_DATA_LEN
 );

430 
BAROMETER_CALI
:

431 
VOID
 
	`oßl_mem˝y
–
vÆue
, 
b¨CÆ
, 
BAROMETER_CALI_LEN
 );

434 
BAROMETER_CONF
:

435 *((
uöt8
*)
vÆue
Ë
b¨Cfg
;

439 
ªt
 = 
INVALIDPARAMETER
;

443  ( 
ªt
 );

444 
	}
}

460 
uöt8
 
	$b¨omëî_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

461 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

463 
uöt16
 
uuid
;

464 
bSètus_t
 
°©us
 = 
SUCCESS
;

467 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

470  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

474 i‡–
off£t
 > 0 )

476  ( 
ATT_ERR_ATTR_NOT_LONG
 );

479 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
) {

481 *
pLí
 = 0;

482  
ATT_ERR_INVALID_HANDLE
;

486  
uuid
 )

490 
BAROMETER_DATA_UUID
:

491 *
pLí
 = 
BAROMETER_DATA_LEN
;

492 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
BAROMETER_DATA_LEN
 );

495 
BAROMETER_CALI_UUID
:

496 *
pLí
 = 
BAROMETER_CALI_LEN
;

497 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
BAROMETER_CALI_LEN
 );

500 
BAROMETER_CONF_UUID
:

501 *
pLí
 = 1;

502 
pVÆue
[0] = *
pAâr
->pValue;

506 *
pLí
 = 0;

507 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

511  ( 
°©us
 );

512 
	}
}

527 
bSètus_t
 
	$b¨omëî_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

528 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

530 
bSètus_t
 
°©us
 = 
SUCCESS
;

531 
uöt16
 
uuid
;

532 
uöt8
 
nŸifyAµ
 = 0xFF;

535 i‡–
	`g©tPîmôAuth‹Wrôe
–
pAâr
->
≥rmissi⁄s
 ) )

538  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

541 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
) {

543  
ATT_ERR_INVALID_HANDLE
;

546  
uuid
 )

548 
BAROMETER_DATA_UUID
:

552 
BAROMETER_CALI_UUID
:

556 
BAROMETER_CONF_UUID
:

559 i‡–
off£t
 == 0 )

561 i‡–
Àn
 != 1 )

563 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

568 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

572 i‡–
°©us
 =
SUCCESS
 )

574 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

575 *
pCurVÆue
 = 
pVÆue
[0];

577 if–
pAâr
->
pVÆue
 =&
b¨Cfg
 )

579 
nŸifyAµ
 = 
BAROMETER_CONF
;

585 
GATT_CLIENT_CHAR_CFG_UUID
:

586 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

587 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

592 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

597 i‡–(
nŸifyAµ
 !0xFF ) && 
b¨omëî_AµCBs
 && b¨omëî_AµCBs->
p‚B¨omëîCh™ge
 )

599 
b¨omëî_AµCBs
->
	`p‚B¨omëîCh™ge
–
nŸifyAµ
 );

602  ( 
°©us
 );

603 
	}
}

615 
	$b¨omëî_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

618 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

621 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

622 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

623 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

625 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
b¨D©aC⁄fig
 );

628 
	}
}

	@Projects/ble/Profiles/SensorProfile/barometerservice.h

39 #i‚de‡
BAROMETERSERVICE_H


40 
	#BAROMETERSERVICE_H


	)

42 #ifde‡
__˝lu•lus


56 
	#BAROMETER_DATA
 10

57 
	#BAROMETER_CALI
 11

58 
	#BAROMETER_CONF
 12

59 

	)

61 
	#BAROMETER_SERV_UUID
 0xAA40

62 
	#BAROMETER_DATA_UUID
 0xAA41

	)

63 
	#BAROMETER_CONF_UUID
 0xAA42

	)

64 
	#BAROMETER_CALI_UUID
 0xAA43

	)

67 
	#BAROMETER_SERVICE
 0x00000010

	)

70 
	#BAROMETER_DATA_LEN
 4

	)

71 
	#BAROMETER_CALI_LEN
 16

	)

86 
NULL_OK
 (*
	tb¨omëîCh™ge_t
)–
	tuöt8
 
	t∑ømID
 );

90 
b¨omëîCh™ge_t
 
p‚B¨omëîCh™ge
;

91 } 
	tb¨omëîCBs_t
;

105 
bSètus_t
 
B¨omëî_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

113 
bSètus_t
 
B¨omëî_Regi°îAµCBs
–
b¨omëîCBs_t
 *
≠pCÆlbacks
 );

125 
bSètus_t
 
B¨omëî_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

136 
bSètus_t
 
B¨omëî_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

141 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/SensorProfile/gyroservice.c

43 
	~"bcomdef.h
"

44 
	~"lökdb.h
"

45 
	~"g©t.h
"

46 
	~"g©t_uuid.h
"

47 
	~"g©t£rv≠p.h
"

49 
	~"gyro£rvi˚.h
"

50 
	~"°_utû.h
"

69 
CONST
 
uöt8
 
	ggyroSîvUUID
[
TI_UUID_SIZE
] =

71 
TI_UUID
(
GYROSCOPE_SERV_UUID
),

75 
CONST
 
uöt8
 
	ggyroD©aUUID
[
TI_UUID_SIZE
] =

77 
TI_UUID
(
GYROSCOPE_DATA_UUID
),

81 
CONST
 
uöt8
 
	ggyroCfgUUID
[
TI_UUID_SIZE
] =

83 
TI_UUID
(
GYROSCOPE_CONF_UUID
),

99 
gyroCBs_t
 *
	ggyro_AµCBs
 = 
NULL
;

107 
CONST
 
g©tAârTy≥_t
 
	ggyroSîvi˚
 = { 
TI_UUID_SIZE
, 
gyroSîvUUID
 };

110 
uöt8
 
	ggyroD©aPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

112 
uöt8
 
	ggyroD©a
[
GYROSCOPE_DATA_LEN
] = {0, 0, 0, 0, 0, 0};

115 
g©tCh¨Cfg_t
 
	ggyroD©aC⁄fig
[
GATT_MAX_NUM_CONN
];

118 
uöt8
 
	ggyroD©aU£rDe•
[] = "Gyro. Data";

121 
uöt8
 
	ggyroCfgPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

124 
uöt8
 
	ggyroCfg
 = 0;

127 
uöt8
 
	ggyroCfgU£rDe•
[] = "Gyro. Conf.";

134 
g©tAâribuã_t
 
	g£ns‹Gyrosc›eAârTbl
[] =

137 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

138 
GATT_PERMIT_READ
,

140 (
uöt8
 *)&
gyroSîvi˚


145 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

146 
GATT_PERMIT_READ
,

148 &
gyroD©aPr›s


153 { 
TI_UUID_SIZE
, 
gyroD©aUUID
 },

154 
GATT_PERMIT_READ
,

156 
gyroD©a


161 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

162 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

164 (
uöt8
 *)
gyroD©aC⁄fig


169 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

170 
GATT_PERMIT_READ
,

172 
gyroD©aU£rDe•


176 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

177 
GATT_PERMIT_READ
,

179 &
gyroCfgPr›s


184 { 
TI_UUID_SIZE
, 
gyroCfgUUID
 },

185 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

187 &
gyroCfg


192 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

193 
GATT_PERMIT_READ
,

195 
gyroCfgU£rDe•


203 
uöt8
 
gyro_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

204 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

205 
bSètus_t
 
gyro_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

206 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

207 
gyro_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

213 
CONST
 
g©tSîvi˚CBs_t
 
	ggyroCBs
 =

215 
gyro_RódAârCB
,

216 
gyro_WrôeAârCB
,

217 
NULL


235 
bSètus_t
 
	$Gyro_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

237 
uöt8
 
°©us
 = 
SUCCESS
;

240 
VOID
 
	`lökDB_Regi°î
–
gyro_H™dÀC⁄nSètusCB
 );

242 i‡(
£rvi˚s
 & 
GYROSCOPE_SERVICE
 )

246 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
£ns‹Gyrosc›eAârTbl
,

247 
	`GATT_NUM_ATTRS
–
£ns‹Gyrosc›eAârTbl
 ),

248 &
gyroCBs
 );

251  ( 
°©us
 );

252 
	}
}

265 
bSètus_t
 
	$Gyro_Regi°îAµCBs
–
gyroCBs_t
 *
≠pCÆlbacks
 )

267 i‡–
gyro_AµCBs
 =
NULL
 )

269 i‡–
≠pCÆlbacks
 !
NULL
 )

271 
gyro_AµCBs
 = 
≠pCÆlbacks
;

274  ( 
SUCCESS
 );

277  ( 
bÀAÃódyInReque°edMode
 );

278 
	}
}

294 
bSètus_t
 
	$Gyro_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

296 
bSètus_t
 
ªt
 = 
SUCCESS
;

298  
∑øm
 )

300 
GYROSCOPE_DATA
:

301 i‡–
Àn
 =
GYROSCOPE_DATA_LEN
 )

303 
VOID
 
	`oßl_mem˝y
–
gyroD©a
, 
vÆue
, 
GYROSCOPE_DATA_LEN
 );

306 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
gyroD©aC⁄fig
, 
gyroD©a
, 
FALSE
,

307 
£ns‹Gyrosc›eAârTbl
, 
	`GATT_NUM_ATTRS
( sensorGyroscopeAttrTbl ),

308 
INVALID_TASK_ID
 );

312 
ªt
 = 
bÀInvÆidR™ge
;

316 
GYROSCOPE_CONF
:

317 if(
Àn
 = ( 
uöt8
 ) )

319 
gyroCfg
 = *((
uöt8
*)
vÆue
);

323 
ªt
 = 
bÀInvÆidR™ge
;

328 
ªt
 = 
INVALIDPARAMETER
;

332  ( 
ªt
 );

333 
	}
}

348 
bSètus_t
 
	$Gyro_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

350 
bSètus_t
 
ªt
 = 
SUCCESS
;

352  
∑øm
 )

354 
GYROSCOPE_DATA
:

355 
VOID
 
	`oßl_mem˝y
 (
vÆue
, 
gyroD©a
, 
GYROSCOPE_DATA_LEN
 );

358 
GYROSCOPE_CONF
:

359 *((
uöt8
*)
vÆue
Ë
gyroCfg
;

363 
ªt
 = 
INVALIDPARAMETER
;

367  ( 
ªt
 );

368 
	}
}

384 
uöt8
 
	$gyro_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

385 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

387 
uöt16
 
uuid
;

388 
bSètus_t
 
°©us
 = 
SUCCESS
;

391 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

394  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

398 i‡–
off£t
 > 0 )

400  ( 
ATT_ERR_ATTR_NOT_LONG
 );

403 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
) {

405 *
pLí
 = 0;

406  
ATT_ERR_INVALID_HANDLE
;

409  
uuid
 )

413 
GYROSCOPE_DATA_UUID
:

414 *
pLí
 = 
GYROSCOPE_DATA_LEN
;

415 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
GYROSCOPE_DATA_LEN
 );

418 
GYROSCOPE_CONF_UUID
:

419 *
pLí
 = 1;

420 
pVÆue
[0] = *
pAâr
->pValue;

424 *
pLí
 = 0;

425 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

429  ( 
°©us
 );

430 
	}
}

445 
bSètus_t
 
	$gyro_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

446 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

448 
uöt16
 
uuid
;

449 
bSètus_t
 
°©us
 = 
SUCCESS
;

450 
uöt8
 
nŸifyAµ
 = 0xFF;

453 i‡–
	`g©tPîmôAuth‹Wrôe
–
pAâr
->
≥rmissi⁄s
 ) )

456  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

459 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
) {

461  
ATT_ERR_INVALID_HANDLE
;

464  
uuid
 )

466 
GYROSCOPE_DATA_UUID
:

470 
GYROSCOPE_CONF_UUID
:

473 i‡–
off£t
 == 0 )

475 i‡–
Àn
 != 1 )

477 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

482 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

486 i‡–
°©us
 =
SUCCESS
 )

488 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

489 *
pCurVÆue
 = 
pVÆue
[0];

491 if–
pAâr
->
pVÆue
 =&
gyroCfg
 )

493 
nŸifyAµ
 = 
GYROSCOPE_CONF
;

498 
GATT_CLIENT_CHAR_CFG_UUID
:

499 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

500 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

505 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

510 i‡–(
nŸifyAµ
 !0xFF ) && 
gyro_AµCBs
 && gyro_AµCBs->
p‚GyroCh™ge
 )

512 
gyro_AµCBs
->
	`p‚GyroCh™ge
–
nŸifyAµ
 );

515  ( 
°©us
 );

516 
	}
}

528 
	$gyro_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

531 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

534 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

535 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

536 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

538 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
gyroD©aC⁄fig
 );

541 
	}
}

	@Projects/ble/Profiles/SensorProfile/gyroservice.h

40 #i‚de‡
GYROSERVICE_H


41 
	#GYROSERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#GYROSCOPE_DATA
 12

58 
	#GYROSCOPE_CONF
 13

59 

	)

61 
	#GYROSCOPE_SERV_UUID
 0xAA50

62 
	#GYROSCOPE_DATA_UUID
 0xAA51

	)

63 
	#GYROSCOPE_CONF_UUID
 0xAA52

	)

66 
	#GYROSCOPE_SERVICE
 0x00000020

	)

69 
	#GYROSCOPE_DATA_LEN
 6

	)

84 
NULL_OK
 (*
	tgyroCh™ge_t
)–
	tuöt8
 
	t∑ømID
 );

88 
gyroCh™ge_t
 
p‚GyroCh™ge
;

89 } 
	tgyroCBs_t
;

104 
bSètus_t
 
Gyro_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

112 
bSètus_t
 
Gyro_Regi°îAµCBs
–
gyroCBs_t
 *
≠pCÆlbacks
 );

124 
bSètus_t
 
Gyro_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

135 
bSètus_t
 
Gyro_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

141 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/SensorProfile/humidityservice.c

43 
	~"bcomdef.h
"

44 
	~"lökdb.h
"

45 
	~"g©t.h
"

46 
	~"g©t_uuid.h
"

47 
	~"g©t£rv≠p.h
"

49 
	~"humidôy£rvi˚.h
"

50 
	~"°_utû.h
"

80 
humidôyCBs_t
 *
	ghumid_AµCBs
 = 
NULL
;

83 
CONST
 
uöt8
 
	ghumidSîvUUID
[
TI_UUID_SIZE
] =

85 
TI_UUID
(
HUMIDITY_SERV_UUID
),

89 
CONST
 
uöt8
 
	ghumidD©aUUID
[
TI_UUID_SIZE
] =

91 
TI_UUID
(
HUMIDITY_DATA_UUID
),

95 
CONST
 
uöt8
 
	ghumidCfgUUID
[
TI_UUID_SIZE
] =

97 
TI_UUID
(
HUMIDITY_CONF_UUID
),

106 
CONST
 
g©tAârTy≥_t
 
	ghumidSîvi˚
 = { 
TI_UUID_SIZE
, 
humidSîvUUID
 };

109 
uöt8
 
	ghumidD©aPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

111 
uöt8
 
	ghumidD©a
[
HUMIDITY_DATA_LEN
] = { 0, 0, 0, 0};

114 
g©tCh¨Cfg_t
 
	ghumidD©aC⁄fig
[
GATT_MAX_NUM_CONN
];

117 
uöt8
 
	ghumidD©aU£rDe•
[] = "Humid. Data";

120 
uöt8
 
	ghumidCfgPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

123 
uöt8
 
	ghumidCfg
 = 0;

126 
uöt8
 
	ghumidCfgU£rDe•
[] = "Humid. Conf.";

133 
g©tAâribuã_t
 
	ghumidAârTbl
[] =

136 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

137 
GATT_PERMIT_READ
,

139 (
uöt8
 *)&
humidSîvi˚


144 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

145 
GATT_PERMIT_READ
,

147 &
humidD©aPr›s


152 { 
TI_UUID_SIZE
, 
humidD©aUUID
 },

153 
GATT_PERMIT_READ
,

155 
humidD©a


160 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

161 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

163 (
uöt8
 *)
humidD©aC⁄fig


168 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

169 
GATT_PERMIT_READ
,

171 
humidD©aU£rDe•


176 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

177 
GATT_PERMIT_READ
,

179 &
humidCfgPr›s


184 { 
TI_UUID_SIZE
, 
humidCfgUUID
 },

185 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

187 &
humidCfg


192 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

193 
GATT_PERMIT_READ
,

195 
humidCfgU£rDe•


203 
uöt8
 
humid_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

204 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

205 
bSètus_t
 
humid_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

206 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

207 
humid_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

213 
CONST
 
g©tSîvi˚CBs_t
 
	ghumidCBs
 =

215 
humid_RódAârCB
,

216 
humid_WrôeAârCB
,

217 
NULL


235 
bSètus_t
 
	$Humidôy_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

237 
uöt8
 
°©us
 = 
SUCCESS
;

240 
VOID
 
	`lökDB_Regi°î
–
humid_H™dÀC⁄nSètusCB
 );

241 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
humidD©aC⁄fig
 );

243 i‡(
£rvi˚s
 & 
HUMIDITY_SERVICE
 )

246 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
humidAârTbl
,

247 
	`GATT_NUM_ATTRS
–
humidAârTbl
 ),

248 &
humidCBs
 );

251  ( 
°©us
 );

252 
	}
}

264 
bSètus_t
 
	$Humidôy_Regi°îAµCBs
–
humidôyCBs_t
 *
≠pCÆlbacks
 )

266 i‡–
humid_AµCBs
 =
NULL
 )

268 i‡–
≠pCÆlbacks
 !
NULL
 )

270 
humid_AµCBs
 = 
≠pCÆlbacks
;

273  ( 
SUCCESS
 );

276  ( 
bÀAÃódyInReque°edMode
 );

277 
	}
}

293 
bSètus_t
 
	$Humidôy_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

295 
bSètus_t
 
ªt
 = 
SUCCESS
;

297  
∑øm
 )

299 
HUMIDITY_DATA
:

300 i‡–
Àn
 =
HUMIDITY_DATA_LEN
 )

302 
VOID
 
	`oßl_mem˝y
–
humidD©a
, 
vÆue
, 
HUMIDITY_DATA_LEN
 );

305 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
humidD©aC⁄fig
, 
humidD©a
, 
FALSE
,

306 
humidAârTbl
, 
	`GATT_NUM_ATTRS
( humidAttrTbl ),

307 
INVALID_TASK_ID
 );

311 
ªt
 = 
bÀInvÆidR™ge
;

315 
HUMIDITY_CONF
:

316 i‡–
Àn
 = ( 
uöt8
 ) )

318 
humidCfg
 = *((
uöt8
*)
vÆue
);

322 
ªt
 = 
bÀInvÆidR™ge
;

327 
ªt
 = 
INVALIDPARAMETER
;

331  ( 
ªt
 );

332 
	}
}

347 
bSètus_t
 
	$Humidôy_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

349 
bSètus_t
 
ªt
 = 
SUCCESS
;

351  
∑øm
 )

353 
HUMIDITY_DATA
:

354 
VOID
 
	`oßl_mem˝y
–
vÆue
, 
humidD©a
, 
HUMIDITY_DATA_LEN
 );

357 
HUMIDITY_CONF
:

358 *((
uöt8
*)
vÆue
Ë
humidCfg
;

362 
ªt
 = 
INVALIDPARAMETER
;

366  ( 
ªt
 );

367 
	}
}

383 
uöt8
 
	$humid_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

384 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

386 
uöt16
 
uuid
;

387 
bSètus_t
 
°©us
 = 
SUCCESS
;

390 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

393  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

397 i‡–
off£t
 > 0 )

399  ( 
ATT_ERR_ATTR_NOT_LONG
 );

402 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
)

405 *
pLí
 = 0;

406  
ATT_ERR_INVALID_HANDLE
;

409  
uuid
 )

413 
HUMIDITY_DATA_UUID
:

414 *
pLí
 = 
HUMIDITY_DATA_LEN
;

415 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
HUMIDITY_DATA_LEN
 );

418 
HUMIDITY_CONF_UUID
:

419 *
pLí
 = 1;

420 
pVÆue
[0] = *
pAâr
->pValue;

424 *
pLí
 = 0;

425 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

429  ( 
°©us
 );

430 
	}
}

445 
bSètus_t
 
	$humid_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

446 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

448 
uöt16
 
uuid
;

449 
bSètus_t
 
°©us
 = 
SUCCESS
;

450 
uöt8
 
nŸifyAµ
 = 0xFF;

453 i‡–
	`g©tPîmôAuth‹Wrôe
–
pAâr
->
≥rmissi⁄s
 ) )

456  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

459 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
)

462  
ATT_ERR_INVALID_HANDLE
;

465  
uuid
 )

467 
HUMIDITY_DATA_UUID
:

471 
HUMIDITY_CONF_UUID
:

474 i‡–
off£t
 == 0 )

476 i‡–
Àn
 != 1 )

478 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

483 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

487 i‡–
°©us
 =
SUCCESS
 )

489 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

491 *
pCurVÆue
 = 
pVÆue
[0];

492 if–
pAâr
->
pVÆue
 =&
humidCfg
 )

494 
nŸifyAµ
 = 
HUMIDITY_CONF
;

499 
GATT_CLIENT_CHAR_CFG_UUID
:

500 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

501 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

506 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

511 i‡–(
nŸifyAµ
 !0xFF ) && 
humid_AµCBs
 && humid_AµCBs->
p‚IrTempCh™ge
 )

513 
humid_AµCBs
->
	`p‚IrTempCh™ge
–
nŸifyAµ
 );

516  ( 
°©us
 );

517 
	}
}

529 
	$humid_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

532 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

535 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

536 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

537 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

539 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
humidD©aC⁄fig
 );

542 
	}
}

	@Projects/ble/Profiles/SensorProfile/humidityservice.h

40 #i‚de‡
HUMIDITYSERVICE_H


41 
	#HUMIDITYSERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#HUMIDITY_DATA
 5

58 
	#HUMIDITY_CONF
 6

59 

	)

61 
	#HUMIDITY_SERV_UUID
 0xAA20

62 
	#HUMIDITY_DATA_UUID
 0xAA21

	)

63 
	#HUMIDITY_CONF_UUID
 0xAA22

	)

66 
	#HUMIDITY_SERVICE
 0x00000004

	)

69 
	#HUMIDITY_DATA_LEN
 4

	)

85 
NULL_OK
 (*
	thumidôyCh™ge_t
)–
	tuöt8
 
	t∑ømID
 );

89 
humidôyCh™ge_t
 
p‚IrTempCh™ge
;

90 } 
	thumidôyCBs_t
;

104 
bSètus_t
 
Humidôy_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

112 
bSètus_t
 
Humidôy_Regi°îAµCBs
–
humidôyCBs_t
 *
≠pCÆlbacks
 );

124 
bSètus_t
 
Humidôy_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

135 
bSètus_t
 
Humidôy_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

141 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/SensorProfile/irtempservice.c

43 
	~"bcomdef.h
"

44 
	~"lökdb.h
"

45 
	~"g©t.h
"

46 
	~"g©t_uuid.h
"

47 
	~"g©t£rv≠p.h
"

49 
	~"úãmp£rvi˚.h
"

50 
	~"°_utû.h
"

80 
úTempCBs_t
 *
	gúTemp_AµCBs
 = 
NULL
;

83 
CONST
 
uöt8
 
	gúTempSîvUUID
[
TI_UUID_SIZE
] =

85 
TI_UUID
(
IRTEMPERATURE_SERV_UUID
),

89 
CONST
 
uöt8
 
	gúTempD©aUUID
[
TI_UUID_SIZE
] =

91 
TI_UUID
(
IRTEMPERATURE_DATA_UUID
),

95 
CONST
 
uöt8
 
	gúTempC⁄fUUID
[
TI_UUID_SIZE
] =

97 
TI_UUID
(
IRTEMPERATURE_CONF_UUID
),

106 
CONST
 
g©tAârTy≥_t
 
	gúTempSîvi˚
 = { 
TI_UUID_SIZE
, 
úTempSîvUUID
 };

109 
uöt8
 
	gúTempD©aPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

112 
uöt8
 
	gúTempD©a
[
IRTEMPERATURE_DATA_LEN
] = { 0, 0, 0, 0};

115 
g©tCh¨Cfg_t
 
	gúTempD©aC⁄fig
[
GATT_MAX_NUM_CONN
];

118 
uöt8
 
	gúTempD©aU£rDe•
[] = "IR Temp. Data";

121 
uöt8
 
	gúTempCfgPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

124 
uöt8
 
	gúTempCfg
 = 0;

127 
uöt8
 
	gúTempCfgU£rDe•
[] = "IR Temp. Conf.";

134 
g©tAâribuã_t
 
	gúTempAârTbl
[] =

138 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

139 
GATT_PERMIT_READ
,

141 (
uöt8
 *)&
úTempSîvi˚


146 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

147 
GATT_PERMIT_READ
,

149 &
úTempD©aPr›s


154 { 
TI_UUID_SIZE
, 
úTempD©aUUID
 },

155 
GATT_PERMIT_READ
,

157 
úTempD©a


162 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

163 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

165 (
uöt8
 *)
úTempD©aC⁄fig


170 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

171 
GATT_PERMIT_READ
,

173 
úTempD©aU£rDe•


178 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

179 
GATT_PERMIT_READ
,

181 &
úTempCfgPr›s


186 { 
TI_UUID_SIZE
, 
úTempC⁄fUUID
 },

187 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

189 &
úTempCfg


194 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

195 
GATT_PERMIT_READ
,

197 
úTempCfgU£rDe•


205 
uöt8
 
úTemp_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

206 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

207 
bSètus_t
 
úTemp_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

208 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

209 
úTemp_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

216 
CONST
 
g©tSîvi˚CBs_t
 
	gúTempCBs
 =

218 
úTemp_RódAârCB
,

219 
úTemp_WrôeAârCB
,

220 
NULL


238 
bSètus_t
 
	$IRTemp_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

240 
uöt8
 
°©us
 = 
SUCCESS
;

243 
VOID
 
	`lökDB_Regi°î
–
úTemp_H™dÀC⁄nSètusCB
 );

244 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
úTempD©aC⁄fig
 );

246 i‡(
£rvi˚s
 & 
IRTEMPERATURE_SERVICE
 )

249 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
úTempAârTbl
,

250 
	`GATT_NUM_ATTRS
–
úTempAârTbl
 ),

251 &
úTempCBs
 );

254  ( 
°©us
 );

255 
	}
}

268 
bSètus_t
 
	$IRTemp_Regi°îAµCBs
–
úTempCBs_t
 *
≠pCÆlbacks
 )

270 i‡–
úTemp_AµCBs
 =
NULL
 )

272 i‡–
≠pCÆlbacks
 !
NULL
 )

274 
úTemp_AµCBs
 = 
≠pCÆlbacks
;

277  ( 
SUCCESS
 );

280  ( 
bÀAÃódyInReque°edMode
 );

282 
	}
}

299 
bSètus_t
 
	$IRTemp_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

301 
bSètus_t
 
ªt
 = 
SUCCESS
;

303  
∑øm
 )

305 
IRTEMPERATURE_DATA
:

306 i‡–
Àn
 =
IRTEMPERATURE_DATA_LEN
 )

308 
VOID
 
	`oßl_mem˝y
–
úTempD©a
, 
vÆue
, 
IRTEMPERATURE_DATA_LEN
 );

310 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
úTempD©aC⁄fig
, 
úTempD©a
, 
FALSE
,

311 
úTempAârTbl
, 
	`GATT_NUM_ATTRS
( irTempAttrTbl ),

312 
INVALID_TASK_ID
 );

316 
ªt
 = 
bÀInvÆidR™ge
;

320 
IRTEMPERATURE_CONF
:

321 i‡–
Àn
 = ( 
uöt8
 ) )

323 
úTempCfg
 = *((
uöt8
*)
vÆue
);

327 
ªt
 = 
bÀInvÆidR™ge
;

333 
ªt
 = 
INVALIDPARAMETER
;

337  ( 
ªt
 );

338 
	}
}

353 
bSètus_t
 
	$IRTemp_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

355 
bSètus_t
 
ªt
 = 
SUCCESS
;

357  
∑øm
 )

359 
IRTEMPERATURE_DATA
:

360 
VOID
 
	`oßl_mem˝y
 (
vÆue
, 
úTempD©a
, 
IRTEMPERATURE_DATA_LEN
 );

363 
IRTEMPERATURE_CONF
:

364 *((
uöt8
*)
vÆue
Ë
úTempCfg
;

368 
ªt
 = 
INVALIDPARAMETER
;

372  ( 
ªt
 );

373 
	}
}

389 
uöt8
 
	$úTemp_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

390 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

392 
uöt16
 
uuid
;

393 
bSètus_t
 
°©us
 = 
SUCCESS
;

396 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

399  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

403 i‡–
off£t
 > 0 )

405  ( 
ATT_ERR_ATTR_NOT_LONG
 );

408 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
)

411 *
pLí
 = 0;

412  
ATT_ERR_INVALID_HANDLE
;

415  
uuid
 )

419 
IRTEMPERATURE_DATA_UUID
:

420 *
pLí
 = 
IRTEMPERATURE_DATA_LEN
;

421 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
IRTEMPERATURE_DATA_LEN
 );

424 
IRTEMPERATURE_CONF_UUID
:

425 *
pLí
 = 1;

426 
pVÆue
[0] = *
pAâr
->pValue;

430 *
pLí
 = 0;

431 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

435  ( 
°©us
 );

436 
	}
}

451 
bSètus_t
 
	$úTemp_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

452 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

454 
uöt16
 
uuid
;

455 
bSètus_t
 
°©us
 = 
SUCCESS
;

456 
uöt8
 
nŸifyAµ
 = 0xFF;

459 i‡–
	`g©tPîmôAuth‹Wrôe
–
pAâr
->
≥rmissi⁄s
 ) )

462  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

465 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
)

468  
ATT_ERR_INVALID_HANDLE
;

471  
uuid
 )

473 
IRTEMPERATURE_DATA_UUID
:

477 
IRTEMPERATURE_CONF_UUID
:

480 i‡–
off£t
 == 0 )

482 i‡–
Àn
 != 1 )

484 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

489 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

493 i‡–
°©us
 =
SUCCESS
 )

495 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

496 *
pCurVÆue
 = 
pVÆue
[0];

498 if–
pAâr
->
pVÆue
 =&
úTempCfg
 )

500 
nŸifyAµ
 = 
IRTEMPERATURE_CONF
;

505 
GATT_CLIENT_CHAR_CFG_UUID
:

506 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

507 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

512 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

517 i‡–(
nŸifyAµ
 !0xFF ) && 
úTemp_AµCBs
 && irTemp_AµCBs->
p‚IrTempCh™ge
 )

519 
úTemp_AµCBs
->
	`p‚IrTempCh™ge
–
nŸifyAµ
 );

522  ( 
°©us
 );

523 
	}
}

535 
	$úTemp_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

538 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

541 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

542 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

543 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

545 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
úTempD©aC⁄fig
 );

548 
	}
}

	@Projects/ble/Profiles/SensorProfile/irtempservice.h

40 #i‚de‡
IRTEMPSERVICE_H


41 
	#IRTEMPSERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#IRTEMPERATURE_DATA
 0

58 
	#IRTEMPERATURE_CONF
 1

59 

	)

61 
	#IRTEMPERATURE_SERV_UUID
 0xAA00

62 
	#IRTEMPERATURE_DATA_UUID
 0xAA01

	)

63 
	#IRTEMPERATURE_CONF_UUID
 0xAA02

	)

66 
	#IRTEMPERATURE_SERVICE
 0x00000001

	)

69 
	#IRTEMPERATURE_DATA_LEN
 4

	)

84 
NULL_OK
 (*
	túTempCh™ge_t
)–
	tuöt8
 
	t∑ømID
 );

88 
úTempCh™ge_t
 
p‚IrTempCh™ge
;

89 } 
	túTempCBs_t
;

103 
bSètus_t
 
IRTemp_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

111 
bSètus_t
 
IRTemp_Regi°îAµCBs
–
úTempCBs_t
 *
≠pCÆlbacks
 );

123 
bSètus_t
 
IRTemp_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

134 
bSètus_t
 
IRTemp_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

140 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/SensorProfile/magnetometerservice.c

43 
	~"bcomdef.h
"

44 
	~"lökdb.h
"

45 
	~"g©t.h
"

46 
	~"g©t_uuid.h
"

47 
	~"g©t£rv≠p.h
"

49 
	~"mag√tomëî£rvi˚.h
"

50 
	~"°_utû.h
"

69 
CONST
 
uöt8
 
	gmag√tomëîSîvUUID
[
TI_UUID_SIZE
] =

71 
TI_UUID
(
MAGNETOMETER_SERV_UUID
),

75 
CONST
 
uöt8
 
	gmag√tomëîD©aUUID
[
TI_UUID_SIZE
] =

77 
TI_UUID
(
MAGNETOMETER_DATA_UUID
),

81 
CONST
 
uöt8
 
	gmag√tomëîCfgUUID
[
TI_UUID_SIZE
] =

83 
TI_UUID
(
MAGNETOMETER_CONF_UUID
),

87 
CONST
 
uöt8
 
	gmag√tomëîPîUUID
[
TI_UUID_SIZE
] =

89 
TI_UUID
(
MAGNETOMETER_PERI_UUID
),

104 
mag√tomëîCBs_t
 *
	gmag√tomëî_AµCBs
 = 
NULL
;

111 
CONST
 
g©tAârTy≥_t
 
	gmag√tomëîSîvi˚
 = { 
TI_UUID_SIZE
, 
mag√tomëîSîvUUID
 };

114 
uöt8
 
	gmag√tomëîD©aPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_NOTIFY
;

116 
uöt8
 
	gmag√tomëîD©a
[
MAGNETOMETER_DATA_LEN
] = { 0, 0, 0, 0, 0, 0};

119 
g©tCh¨Cfg_t
 
	gmag√tomëîD©aC⁄fig
[
GATT_MAX_NUM_CONN
];

122 
uöt8
 
	gmag√tomëîD©aU£rDe•
[] = "Mag. Data";

125 
uöt8
 
	gmag√tomëîCfgPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

128 
uöt8
 
	gmag√tomëîCfg
 = 0;

131 
uöt8
 
	gmag√tomëîCfgU£rDe•
[] = "Mag. Conf.";

134 
uöt8
 
	gmag√tomëîPîPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

137 
uöt8
 
	gmag√tomëîPî
 = 0;

140 
uöt8
 
	gmag√tomëîPîU£rDe•
[] = "Mag. Period";

148 
g©tAâribuã_t
 
	g£ns‹Mag√tomëîAârTbl
[] =

151 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

152 
GATT_PERMIT_READ
,

154 (
uöt8
 *)&
mag√tomëîSîvi˚


159 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

160 
GATT_PERMIT_READ
,

162 &
mag√tomëîD©aPr›s


167 { 
TI_UUID_SIZE
, 
mag√tomëîD©aUUID
 },

168 
GATT_PERMIT_READ
,

170 
mag√tomëîD©a


175 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

176 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

178 (
uöt8
 *)
mag√tomëîD©aC⁄fig


183 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

184 
GATT_PERMIT_READ
,

186 
mag√tomëîD©aU£rDe•


191 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

192 
GATT_PERMIT_READ
,

194 &
mag√tomëîCfgPr›s


199 { 
TI_UUID_SIZE
, 
mag√tomëîCfgUUID
 },

200 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

202 &
mag√tomëîCfg


207 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

208 
GATT_PERMIT_READ
,

210 
mag√tomëîCfgU£rDe•


215 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

216 
GATT_PERMIT_READ
,

218 &
mag√tomëîPîPr›s


223 { 
TI_UUID_SIZE
, 
mag√tomëîPîUUID
 },

224 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

226 &
mag√tomëîPî


231 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

232 
GATT_PERMIT_READ
,

234 
mag√tomëîPîU£rDe•


242 
uöt8
 
mag√tomëî_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

243 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

244 
bSètus_t
 
mag√tomëî_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

245 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

246 
mag√tomëî_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

252 
CONST
 
g©tSîvi˚CBs_t
 
	gmag√tomëîCBs
 =

254 
mag√tomëî_RódAârCB
,

255 
mag√tomëî_WrôeAârCB
,

256 
NULL


274 
bSètus_t
 
	$Mag√tomëî_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

276 
uöt8
 
°©us
 = 
SUCCESS
;

278 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
mag√tomëîD©aC⁄fig
 );

281 
VOID
 
	`lökDB_Regi°î
–
mag√tomëî_H™dÀC⁄nSètusCB
 );

283 i‡–
£rvi˚s
 & 
MAGNETOMETER_SERVICE
 )

286 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
£ns‹Mag√tomëîAârTbl
,

287 
	`GATT_NUM_ATTRS
–
£ns‹Mag√tomëîAârTbl
 ),

288 &
mag√tomëîCBs
 );

291  ( 
°©us
 );

292 
	}
}

305 
bSètus_t
 
	$Mag√tomëî_Regi°îAµCBs
–
mag√tomëîCBs_t
 *
≠pCÆlbacks
 )

307 i‡–
mag√tomëî_AµCBs
 =
NULL
 )

309 i‡–
≠pCÆlbacks
 !
NULL
 )

311 
mag√tomëî_AµCBs
 = 
≠pCÆlbacks
;

314  ( 
SUCCESS
 );

317  ( 
bÀAÃódyInReque°edMode
 );

318 
	}
}

335 
bSètus_t
 
	$Mag√tomëî_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

337 
bSètus_t
 
ªt
 = 
SUCCESS
;

339  
∑øm
 )

341 
MAGNETOMETER_DATA
:

342 i‡–
Àn
 =
MAGNETOMETER_DATA_LEN
 )

344 
VOID
 
	`oßl_mem˝y
–
mag√tomëîD©a
, 
vÆue
, 
MAGNETOMETER_DATA_LEN
 );

346 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
mag√tomëîD©aC⁄fig
, 
mag√tomëîD©a
, 
FALSE
,

347 
£ns‹Mag√tomëîAârTbl
, 
	`GATT_NUM_ATTRS
( sensorMagnetometerAttrTbl ),

348 
INVALID_TASK_ID
 );

352 
ªt
 = 
bÀInvÆidR™ge
;

356 
MAGNETOMETER_CONF
:

357 i‡–
Àn
 = ( 
uöt8
 ) )

359 
mag√tomëîCfg
 = *((
uöt8
*)
vÆue
);

363 
ªt
 = 
bÀInvÆidR™ge
;

367 
MAGNETOMETER_PERI
:

368 i‡–
Àn
 = ( 
uöt8
 ) )

370 
mag√tomëîPî
 = *((
uöt8
*)
vÆue
);

374 
ªt
 = 
bÀInvÆidR™ge
;

382  ( 
ªt
 );

383 
	}
}

398 
bSètus_t
 
	$Mag√tomëî_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

400 
bSètus_t
 
ªt
 = 
SUCCESS
;

402  
∑øm
 )

404 
MAGNETOMETER_DATA
:

405 
VOID
 
	`oßl_mem˝y
–
vÆue
, 
mag√tomëîD©a
, 
MAGNETOMETER_DATA_LEN
 );

408 
MAGNETOMETER_CONF
:

409 *((
uöt8
*)
vÆue
Ë
mag√tomëîCfg
;

412 
MAGNETOMETER_PERI
:

413 *((
uöt8
*)
vÆue
Ë
mag√tomëîPî
;

417  ( 
ªt
 );

418 
	}
}

434 
uöt8
 
	$mag√tomëî_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

435 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

437 
uöt16
 
uuid
;

438 
bSètus_t
 
°©us
 = 
SUCCESS
;

441 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

444  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

448 i‡–
off£t
 > 0 )

450  ( 
ATT_ERR_ATTR_NOT_LONG
 );

453 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
)

456 *
pLí
 = 0;

457  
ATT_ERR_INVALID_HANDLE
;

460  
uuid
 )

464 
MAGNETOMETER_DATA_UUID
:

465 *
pLí
 = 
MAGNETOMETER_DATA_LEN
;

466 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
MAGNETOMETER_DATA_LEN
 );

469 
MAGNETOMETER_CONF_UUID
:

470 *
pLí
 = 1;

471 
pVÆue
[0] = *
pAâr
->pValue;

474 
MAGNETOMETER_PERI_UUID
:

475 *
pLí
 = 1;

476 
pVÆue
[0] = *
pAâr
->pValue;

480 *
pLí
 = 0;

481 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

485  ( 
°©us
 );

486 
	}
}

501 
bSètus_t
 
	$mag√tomëî_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

502 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

504 
uöt16
 
uuid
;

505 
bSètus_t
 
°©us
 = 
SUCCESS
;

506 
uöt8
 
nŸifyAµ
 = 0xFF;

509 i‡–
	`g©tPîmôAuth‹Wrôe
–
pAâr
->
≥rmissi⁄s
 ) )

512  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

515 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
)

518  
ATT_ERR_INVALID_HANDLE
;

521  
uuid
 )

523 
MAGNETOMETER_DATA_UUID
:

527 
MAGNETOMETER_CONF_UUID
:

530 i‡–
off£t
 == 0 )

532 i‡–
Àn
 != 1 )

534 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

539 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

543 i‡–
°©us
 =
SUCCESS
 )

545 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

546 *
pCurVÆue
 = 
pVÆue
[0];

548 if–
pAâr
->
pVÆue
 =&
mag√tomëîCfg
 )

550 
nŸifyAµ
 = 
MAGNETOMETER_CONF
;

555 
MAGNETOMETER_PERI_UUID
:

558 i‡–
off£t
 == 0 )

560 i‡–
Àn
 != 1 )

562 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

567 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

571 i‡–
°©us
 =
SUCCESS
 )

573 i‡(
pVÆue
[0]>=(
MAGNETOMETER_PERIOD_MIN
/
MAGNETOMETER_TIME_UNIT
))

576 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

577 *
pCurVÆue
 = 
pVÆue
[0];

579 if–
pAâr
->
pVÆue
 =&
mag√tomëîPî
)

581 
nŸifyAµ
 = 
MAGNETOMETER_PERI
;

586 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

591 
GATT_CLIENT_CHAR_CFG_UUID
:

592 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

593 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

598 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

603 i‡–(
nŸifyAµ
 !0xFF ) && 
mag√tomëî_AµCBs
 && mag√tomëî_AµCBs->
p‚Mag√tomëîCh™ge
 )

605 
mag√tomëî_AµCBs
->
	`p‚Mag√tomëîCh™ge
–
nŸifyAµ
 );

608  ( 
°©us
 );

609 
	}
}

621 
	$mag√tomëî_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

624 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

627 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

628 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

629 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

631 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
mag√tomëîD©aC⁄fig
 );

634 
	}
}

	@Projects/ble/Profiles/SensorProfile/magnetometerservice.h

40 #i‚de‡
MAGNETOMETERSERVICE_H


41 
	#MAGNETOMETERSERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#MAGNETOMETER_DATA
 7

58 
	#MAGNETOMETER_CONF
 8

59 
	#MAGNETOMETER_PERI
 9

60 

	)

62 
	#MAGNETOMETER_SERV_UUID
 0xAA30

63 
	#MAGNETOMETER_DATA_UUID
 0xAA31

	)

64 
	#MAGNETOMETER_CONF_UUID
 0xAA32

	)

65 
	#MAGNETOMETER_PERI_UUID
 0xAA33

	)

68 
	#MAGNETOMETER_SERVICE
 0x00000008

	)

71 
	#MAGNETOMETER_DATA_LEN
 6

	)

74 
	#MAGNETOMETER_PERIOD_MIN
 100

	)

75 
	#MAGNETOMETER_TIME_UNIT
 10

76 

	)

91 
NULL_OK
 (*
	tmag√tomëîCh™ge_t
)–
	tuöt8
 
	t∑ømID
 );

95 
mag√tomëîCh™ge_t
 
p‚Mag√tomëîCh™ge
;

96 } 
	tmag√tomëîCBs_t
;

109 
bSètus_t
 
Mag√tomëî_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

117 
bSètus_t
 
Mag√tomëî_Regi°îAµCBs
–
mag√tomëîCBs_t
 *
≠pCÆlbacks
 );

129 
bSètus_t
 
Mag√tomëî_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

140 
bSètus_t
 
Mag√tomëî_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

146 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/SensorProfile/st_util.c

43 
	~"bcomdef.h
"

44 
	~"g©t.h
"

45 
	~"°_utû.h
"

62 
bSètus_t
 
	$utûExåa˘Uuid16
(
g©tAâribuã_t
 *
pAâr
, 
uöt16
 *
pUuid
)

64 
bSètus_t
 
°©us
 = 
SUCCESS
;

66 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

69 *
pUuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.
uuid
[0],ÖAttr->type.uuid[1]);

70 #ifde‡
GATT_TI_UUID_128_BIT


72 i‡(
pAâr
->
ty≥
.
Àn
 =
ATT_UUID_SIZE
)

75 *
pUuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.
uuid
[12],ÖAttr->type.uuid[13]);

78 *
pUuid
 = 0xFFFF;

79 
°©us
 = 
FAILURE
;

82  
°©us
;

83 
	}
}

	@Projects/ble/Profiles/SensorProfile/st_util.h

40 #i‚de‡
ST_UTIL_H


41 
	#ST_UTIL_H


	)

46 #ifde‡
GATT_TI_UUID_128_BIT


49 
	#TI_UUID_SIZE
 
ATT_UUID_SIZE


	)

50 
	#TI_UUID
(
uuid
Ë
	`TI_BASE_UUID_128
(uuid)

	)

55 
	#TI_UUID_SIZE
 
ATT_BT_UUID_SIZE


	)

56 
	#TI_UUID
(
uuid
Ë
	`LO_UINT16
(uuid), 
	`HI_UINT16
(uuid)

	)

76 
bSètus_t
 
utûExåa˘Uuid16
(
g©tAâribuã_t
 *
pAâr
, 
uöt16
 *
pVÆue
);

	@Projects/ble/Profiles/SensorProfile/testservice.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"g≠b⁄dmgr.h
"

52 
	~"ã°£rvi˚.h
"

53 
	~"°_utû.h
"

68 
CONST
 
uöt8
 
	gã°SîvUUID
[
TI_UUID_SIZE
] =

70 
TI_UUID
(
TEST_SERV_UUID
)

74 
CONST
 
uöt8
 
	gã°D©aUUID
[
TI_UUID_SIZE
] =

76 
TI_UUID
(
TEST_DATA_UUID
)

80 
CONST
 
uöt8
 
	gã°C⁄fUUID
[
TI_UUID_SIZE
] =

82 
TI_UUID
(
TEST_CONF_UUID
)

98 
ã°CBs_t
 *
	gã°_AµCBs
 = 
NULL
;

105 
CONST
 
g©tAârTy≥_t
 
	gã°Sîvi˚
 = { 
TI_UUID_SIZE
, 
ã°SîvUUID
 };

108 
uöt8
 
	gã°D©aPr›s
 = 
GATT_PROP_READ
;

111 
uöt8
 
	gã°D©a
[
TEST_DATA_LEN
] = {0,0};

114 
g©tCh¨Cfg_t
 
	gã°D©aC⁄fig
[
GATT_MAX_NUM_CONN
];

117 
uöt8
 
	gã°D©aU£rDe•
[] = "Test Data";

120 
uöt8
 
	gã°C⁄fPr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

123 
uöt8
 
	gã°C⁄f
 = 0x00;

126 
uöt8
 
	gã°C⁄fU£rDe•
[] = "Test Config";

132 
g©tAâribuã_t
 
	gã°AârTbl
[] =

136 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

137 
GATT_PERMIT_READ
,

139 (
uöt8
 *)&
ã°Sîvi˚


144 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

145 
GATT_PERMIT_READ
,

147 &
ã°D©aPr›s


152 { 
TI_UUID_SIZE
, 
ã°D©aUUID
 },

153 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

155 
ã°D©a


160 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

161 
GATT_PERMIT_READ
,

163 
ã°D©aU£rDe•


168 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

169 
GATT_PERMIT_READ
,

171 &
ã°C⁄fPr›s


176 { 
TI_UUID_SIZE
, 
ã°C⁄fUUID
 },

177 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

179 &
ã°C⁄f


184 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

185 
GATT_PERMIT_READ
,

187 
ã°C⁄fU£rDe•


195 
uöt8
 
ã°_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

196 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

197 
bSètus_t
 
ã°_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

198 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

199 
ã°_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

206 
CONST
 
g©tSîvi˚CBs_t
 
	gã°CBs
 =

208 
ã°_RódAârCB
,

209 
ã°_WrôeAârCB
,

210 
NULL


228 
bSètus_t
 
	$Te°_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

230 
uöt8
 
°©us
 = 
SUCCESS
;

233 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
ã°D©aC⁄fig
 );

236 
VOID
 
	`lökDB_Regi°î
–
ã°_H™dÀC⁄nSètusCB
 );

238 i‡–
£rvi˚s
 & 
TEST_SERVICE
 )

241 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
ã°AârTbl
,

242 
	`GATT_NUM_ATTRS
–
ã°AârTbl
 ),

243 &
ã°CBs
 );

246  ( 
°©us
 );

247 
	}
}

259 
bSètus_t
 
	$Te°_Regi°îAµCBs
–
ã°CBs_t
 *
≠pCÆlbacks
 )

261 i‡–
ã°_AµCBs
 =
NULL
 )

263 i‡–
≠pCÆlbacks
 !
NULL
 )

265 
ã°_AµCBs
 = 
≠pCÆlbacks
;

268  ( 
SUCCESS
 );

271  ( 
bÀAÃódyInReque°edMode
 );

273 
	}
}

289 
bSètus_t
 
	$Te°_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

291 
bSètus_t
 
ªt
 = 
SUCCESS
;

293  
∑øm
 )

295 
TEST_DATA_ATTR
:

296 i‡–
Àn
 =
TEST_DATA_LEN
 )

298 
VOID
 
	`oßl_mem˝y
–
ã°D©a
, 
vÆue
, 
TEST_DATA_LEN
 );

300 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
ã°D©aC⁄fig
, 
ã°D©a
, 
FALSE
,

301 
ã°AârTbl
, 
	`GATT_NUM_ATTRS
(ÅestAttrTbl ),

302 
INVALID_TASK_ID
 );

306 
ªt
 = 
bÀInvÆidR™ge
;

310 
TEST_CONF_ATTR
:

311 if(
Àn
 = ( 
uöt8
 ) )

313 
ã°C⁄f
 = *((
uöt8
*)
vÆue
);

317 
ªt
 = 
bÀInvÆidR™ge
;

322 
ªt
 = 
INVALIDPARAMETER
;

326  ( 
ªt
 );

327 
	}
}

342 
bSètus_t
 
	$Te°_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

344 
bSètus_t
 
ªt
 = 
SUCCESS
;

346  
∑øm
 )

348 
TEST_DATA_ATTR
:

349 
VOID
 
	`oßl_mem˝y
 (
vÆue
, 
ã°D©a
, 
TEST_DATA_LEN
 );

352 
TEST_CONF_ATTR
:

353 *((
uöt8
*)
vÆue
Ë
ã°C⁄f
;

357 
ªt
 = 
INVALIDPARAMETER
;

361  ( 
ªt
 );

362 
	}
}

378 
uöt8
 
	$ã°_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

379 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

381 
uöt16
 
uuid
;

382 
bSètus_t
 
°©us
 = 
SUCCESS
;

385 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

388  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

392 i‡–
off£t
 > 0 )

394  ( 
ATT_ERR_ATTR_NOT_LONG
 );

397 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
)

400  
ATT_ERR_INVALID_HANDLE
;

403  
uuid
 )

407 
TEST_DATA_UUID
:

408 *
pLí
 = 
TEST_DATA_LEN
;

409 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
TEST_DATA_LEN
 );

412 
TEST_CONF_UUID
:

413 *
pLí
 = 1;

414 
pVÆue
[0] = *
pAâr
->pValue;

419 *
pLí
 = 0;

420 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

424  ( 
°©us
 );

425 
	}
}

440 
bSètus_t
 
	$ã°_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

441 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

443 
bSètus_t
 
°©us
 = 
SUCCESS
;

444 
uöt8
 
nŸifyAµ
 = 0xFF;

445 
uöt16
 
uuid
;

448 i‡–
	`g©tPîmôAuth‹Wrôe
–
pAâr
->
≥rmissi⁄s
 ) )

451  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

454 i‡(
	`utûExåa˘Uuid16
(
pAâr
,&
uuid
Ë=
FAILURE
)

457  
ATT_ERR_INVALID_HANDLE
;

460  
uuid
 )

462 
TEST_CONF_UUID
:

465 i‡–
off£t
 == 0 )

467 i‡–
Àn
 != 1 )

469 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

474 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

478 i‡–
°©us
 =
SUCCESS
 )

480 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

481 *
pCurVÆue
 = 
pVÆue
[0];

483 if–
pAâr
->
pVÆue
 =&
ã°C⁄f
 )

485 
nŸifyAµ
 = 
TEST_CONF_ATTR
;

490 
GATT_CLIENT_CHAR_CFG_UUID
:

491 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

492 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

497 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

502 i‡–(
nŸifyAµ
 !0xFF ) && 
ã°_AµCBs
 &&Åe°_AµCBs->
p‚Te°Ch™ge
 )

504 
ã°_AµCBs
->
	`p‚Te°Ch™ge
–
nŸifyAµ
 );

507  ( 
°©us
 );

508 
	}
}

520 
	$ã°_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

523 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

526 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

527 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

528 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

530 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
ã°D©aC⁄fig
 );

533 
	}
}

	@Projects/ble/Profiles/SensorProfile/testservice.h

40 #i‚de‡
TESTSERVICE_H


41 
	#TESTSERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#TEST_DATA_ATTR
 0

58 
	#TEST_CONF_ATTR
 1

59 

	)

61 
	#TEST_SERV_UUID
 0xAA60

62 
	#TEST_DATA_UUID
 0xAA61

	)

63 
	#TEST_CONF_UUID
 0xAA62

	)

66 
	#TEST_SERVICE
 0x00000001

	)

69 
	#TEST_DATA_LEN
 2

	)

87 
NULL_OK
 (*
	tã°Ch™ge_t
)–
	tuöt8
 
	t∑ømID
 );

91 
ã°Ch™ge_t
 
p‚Te°Ch™ge
;

92 } 
	tã°CBs_t
;

106 
bSètus_t
 
Te°_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

114 
bSètus_t
 
Te°_Regi°îAµCBs
–
ã°CBs_t
 *
≠pCÆlbacks
 );

126 
bSètus_t
 
Te°_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
pVÆue
 );

137 
bSètus_t
 
Te°_GëP¨amëî
–
uöt8
 
∑øm
, *
pVÆue
 );

143 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/SimpleProfile/simpleGATTprofile.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"g≠b⁄dmgr.h
"

52 
	~"sim∂eGATT¥ofûe.h
"

62 
	#SERVAPP_NUM_ATTR_SUPPORTED
 17

	)

72 
CONST
 
uöt8
 
	gsim∂eProfûeSîvUUID
[
ATT_BT_UUID_SIZE
] =

74 
LO_UINT16
(
SIMPLEPROFILE_SERV_UUID
), 
HI_UINT16
(SIMPLEPROFILE_SERV_UUID)

78 
CONST
 
uöt8
 
	gsim∂eProfûech¨1UUID
[
ATT_BT_UUID_SIZE
] =

80 
LO_UINT16
(
SIMPLEPROFILE_CHAR1_UUID
), 
HI_UINT16
(SIMPLEPROFILE_CHAR1_UUID)

84 
CONST
 
uöt8
 
	gsim∂eProfûech¨2UUID
[
ATT_BT_UUID_SIZE
] =

86 
LO_UINT16
(
SIMPLEPROFILE_CHAR2_UUID
), 
HI_UINT16
(SIMPLEPROFILE_CHAR2_UUID)

90 
CONST
 
uöt8
 
	gsim∂eProfûech¨3UUID
[
ATT_BT_UUID_SIZE
] =

92 
LO_UINT16
(
SIMPLEPROFILE_CHAR3_UUID
), 
HI_UINT16
(SIMPLEPROFILE_CHAR3_UUID)

96 
CONST
 
uöt8
 
	gsim∂eProfûech¨4UUID
[
ATT_BT_UUID_SIZE
] =

98 
LO_UINT16
(
SIMPLEPROFILE_CHAR4_UUID
), 
HI_UINT16
(SIMPLEPROFILE_CHAR4_UUID)

102 
CONST
 
uöt8
 
	gsim∂eProfûech¨5UUID
[
ATT_BT_UUID_SIZE
] =

104 
LO_UINT16
(
SIMPLEPROFILE_CHAR5_UUID
), 
HI_UINT16
(SIMPLEPROFILE_CHAR5_UUID)

119 
sim∂eProfûeCBs_t
 *
	gsim∂eProfûe_AµCBs
 = 
NULL
;

126 
CONST
 
g©tAârTy≥_t
 
	gsim∂eProfûeSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
sim∂eProfûeSîvUUID
 };

130 
uöt8
 
	gsim∂eProfûeCh¨1Pr›s
 = 
GATT_PROP_READ
 | 
GATT_PROP_WRITE
;

133 
uöt8
 
	gsim∂eProfûeCh¨1
 = 0;

136 
uöt8
 
	gsim∂eProfûeCh¨1U£rDe•
[17] = "Characteristic 1\0";

140 
uöt8
 
	gsim∂eProfûeCh¨2Pr›s
 = 
GATT_PROP_READ
;

143 
uöt8
 
	gsim∂eProfûeCh¨2
 = 0;

146 
uöt8
 
	gsim∂eProfûeCh¨2U£rDe•
[17] = "Characteristic 2\0";

150 
uöt8
 
	gsim∂eProfûeCh¨3Pr›s
 = 
GATT_PROP_WRITE
;

153 
uöt8
 
	gsim∂eProfûeCh¨3
 = 0;

156 
uöt8
 
	gsim∂eProfûeCh¨3U£rDe•
[17] = "Characteristic 3\0";

160 
uöt8
 
	gsim∂eProfûeCh¨4Pr›s
 = 
GATT_PROP_NOTIFY
;

163 
uöt8
 
	gsim∂eProfûeCh¨4
 = 0;

169 
g©tCh¨Cfg_t
 
	gsim∂eProfûeCh¨4C⁄fig
[
GATT_MAX_NUM_CONN
];

172 
uöt8
 
	gsim∂eProfûeCh¨4U£rDe•
[17] = "Characteristic 4\0";

176 
uöt8
 
	gsim∂eProfûeCh¨5Pr›s
 = 
GATT_PROP_READ
;

179 
uöt8
 
	gsim∂eProfûeCh¨5
[
SIMPLEPROFILE_CHAR5_LEN
] = { 0, 0, 0, 0, 0 };

182 
uöt8
 
	gsim∂eProfûeCh¨5U£rDe•
[17] = "Characteristic 5\0";

189 
g©tAâribuã_t
 
	gsim∂eProfûeAârTbl
[
SERVAPP_NUM_ATTR_SUPPORTED
] =

193 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

194 
GATT_PERMIT_READ
,

196 (
uöt8
 *)&
sim∂eProfûeSîvi˚


201 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

202 
GATT_PERMIT_READ
,

204 &
sim∂eProfûeCh¨1Pr›s


209 { 
ATT_BT_UUID_SIZE
, 
sim∂eProfûech¨1UUID
 },

210 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

212 &
sim∂eProfûeCh¨1


217 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

218 
GATT_PERMIT_READ
,

220 
sim∂eProfûeCh¨1U£rDe•


225 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

226 
GATT_PERMIT_READ
,

228 &
sim∂eProfûeCh¨2Pr›s


233 { 
ATT_BT_UUID_SIZE
, 
sim∂eProfûech¨2UUID
 },

234 
GATT_PERMIT_READ
,

236 &
sim∂eProfûeCh¨2


241 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

242 
GATT_PERMIT_READ
,

244 
sim∂eProfûeCh¨2U£rDe•


249 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

250 
GATT_PERMIT_READ
,

252 &
sim∂eProfûeCh¨3Pr›s


257 { 
ATT_BT_UUID_SIZE
, 
sim∂eProfûech¨3UUID
 },

258 
GATT_PERMIT_WRITE
,

260 &
sim∂eProfûeCh¨3


265 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

266 
GATT_PERMIT_READ
,

268 
sim∂eProfûeCh¨3U£rDe•


273 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

274 
GATT_PERMIT_READ
,

276 &
sim∂eProfûeCh¨4Pr›s


281 { 
ATT_BT_UUID_SIZE
, 
sim∂eProfûech¨4UUID
 },

284 &
sim∂eProfûeCh¨4


289 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

290 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

292 (
uöt8
 *)
sim∂eProfûeCh¨4C⁄fig


297 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

298 
GATT_PERMIT_READ
,

300 
sim∂eProfûeCh¨4U£rDe•


305 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

306 
GATT_PERMIT_READ
,

308 &
sim∂eProfûeCh¨5Pr›s


313 { 
ATT_BT_UUID_SIZE
, 
sim∂eProfûech¨5UUID
 },

314 
GATT_PERMIT_AUTHEN_READ
,

316 
sim∂eProfûeCh¨5


321 { 
ATT_BT_UUID_SIZE
, 
ch¨U£rDescUUID
 },

322 
GATT_PERMIT_READ
,

324 
sim∂eProfûeCh¨5U£rDe•


334 
uöt8
 
sim∂eProfûe_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

335 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

336 
bSètus_t
 
sim∂eProfûe_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

337 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

339 
sim∂eProfûe_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

346 
CONST
 
g©tSîvi˚CBs_t
 
	gsim∂eProfûeCBs
 =

348 
sim∂eProfûe_RódAârCB
,

349 
sim∂eProfûe_WrôeAârCB
,

350 
NULL


368 
bSètus_t
 
	$Sim∂eProfûe_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

370 
uöt8
 
°©us
 = 
SUCCESS
;

373 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
sim∂eProfûeCh¨4C⁄fig
 );

376 
VOID
 
	`lökDB_Regi°î
–
sim∂eProfûe_H™dÀC⁄nSètusCB
 );

378 i‡–
£rvi˚s
 & 
SIMPLEPROFILE_SERVICE
 )

381 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
sim∂eProfûeAârTbl
,

382 
	`GATT_NUM_ATTRS
–
sim∂eProfûeAârTbl
 ),

383 &
sim∂eProfûeCBs
 );

386  ( 
°©us
 );

387 
	}
}

400 
bSètus_t
 
	$Sim∂eProfûe_Regi°îAµCBs
–
sim∂eProfûeCBs_t
 *
≠pCÆlbacks
 )

402 i‡–
≠pCÆlbacks
 )

404 
sim∂eProfûe_AµCBs
 = 
≠pCÆlbacks
;

406  ( 
SUCCESS
 );

410  ( 
bÀAÃódyInReque°edMode
 );

412 
	}
}

429 
bSètus_t
 
	$Sim∂eProfûe_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

431 
bSètus_t
 
ªt
 = 
SUCCESS
;

432  
∑øm
 )

434 
SIMPLEPROFILE_CHAR1
:

435 i‡–
Àn
 = ( 
uöt8
 ) )

437 
sim∂eProfûeCh¨1
 = *((
uöt8
*)
vÆue
);

441 
ªt
 = 
bÀInvÆidR™ge
;

445 
SIMPLEPROFILE_CHAR2
:

446 i‡–
Àn
 = ( 
uöt8
 ) )

448 
sim∂eProfûeCh¨2
 = *((
uöt8
*)
vÆue
);

452 
ªt
 = 
bÀInvÆidR™ge
;

456 
SIMPLEPROFILE_CHAR3
:

457 i‡–
Àn
 = ( 
uöt8
 ) )

459 
sim∂eProfûeCh¨3
 = *((
uöt8
*)
vÆue
);

463 
ªt
 = 
bÀInvÆidR™ge
;

467 
SIMPLEPROFILE_CHAR4
:

468 i‡–
Àn
 = ( 
uöt8
 ) )

470 
sim∂eProfûeCh¨4
 = *((
uöt8
*)
vÆue
);

473 
	`GATTSîvAµ_Pro˚ssCh¨Cfg
–
sim∂eProfûeCh¨4C⁄fig
, &
sim∂eProfûeCh¨4
, 
FALSE
,

474 
sim∂eProfûeAârTbl
, 
	`GATT_NUM_ATTRS
( simpleProfileAttrTbl ),

475 
INVALID_TASK_ID
 );

479 
ªt
 = 
bÀInvÆidR™ge
;

483 
SIMPLEPROFILE_CHAR5
:

484 i‡–
Àn
 =
SIMPLEPROFILE_CHAR5_LEN
 )

486 
VOID
 
	`oßl_mem˝y
–
sim∂eProfûeCh¨5
, 
vÆue
, 
SIMPLEPROFILE_CHAR5_LEN
 );

490 
ªt
 = 
bÀInvÆidR™ge
;

495 
ªt
 = 
INVALIDPARAMETER
;

499  ( 
ªt
 );

500 
	}
}

515 
bSètus_t
 
	$Sim∂eProfûe_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

517 
bSètus_t
 
ªt
 = 
SUCCESS
;

518  
∑øm
 )

520 
SIMPLEPROFILE_CHAR1
:

521 *((
uöt8
*)
vÆue
Ë
sim∂eProfûeCh¨1
;

524 
SIMPLEPROFILE_CHAR2
:

525 *((
uöt8
*)
vÆue
Ë
sim∂eProfûeCh¨2
;

528 
SIMPLEPROFILE_CHAR3
:

529 *((
uöt8
*)
vÆue
Ë
sim∂eProfûeCh¨3
;

532 
SIMPLEPROFILE_CHAR4
:

533 *((
uöt8
*)
vÆue
Ë
sim∂eProfûeCh¨4
;

536 
SIMPLEPROFILE_CHAR5
:

537 
VOID
 
	`oßl_mem˝y
–
vÆue
, 
sim∂eProfûeCh¨5
, 
SIMPLEPROFILE_CHAR5_LEN
 );

541 
ªt
 = 
INVALIDPARAMETER
;

545  ( 
ªt
 );

546 
	}
}

562 
uöt8
 
	$sim∂eProfûe_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

563 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

565 
bSètus_t
 
°©us
 = 
SUCCESS
;

568 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

571  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

575 i‡–
off£t
 > 0 )

577  ( 
ATT_ERR_ATTR_NOT_LONG
 );

580 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

583 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

584  
uuid
 )

594 
SIMPLEPROFILE_CHAR1_UUID
:

595 
SIMPLEPROFILE_CHAR2_UUID
:

596 
SIMPLEPROFILE_CHAR4_UUID
:

597 *
pLí
 = 1;

598 
pVÆue
[0] = *
pAâr
->pValue;

601 
SIMPLEPROFILE_CHAR5_UUID
:

602 *
pLí
 = 
SIMPLEPROFILE_CHAR5_LEN
;

603 
VOID
 
	`oßl_mem˝y
–
pVÆue
, 
pAâr
->pVÆue, 
SIMPLEPROFILE_CHAR5_LEN
 );

608 *
pLí
 = 0;

609 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

616 *
pLí
 = 0;

617 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

620  ( 
°©us
 );

621 
	}
}

636 
bSètus_t
 
	$sim∂eProfûe_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

637 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

639 
bSètus_t
 
°©us
 = 
SUCCESS
;

640 
uöt8
 
nŸifyAµ
 = 0xFF;

643 i‡–
	`g©tPîmôAuth‹Wrôe
–
pAâr
->
≥rmissi⁄s
 ) )

646  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

649 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

652 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

653  
uuid
 )

655 
SIMPLEPROFILE_CHAR1_UUID
:

656 
SIMPLEPROFILE_CHAR3_UUID
:

660 i‡–
off£t
 == 0 )

662 i‡–
Àn
 != 1 )

664 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

669 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

673 i‡–
°©us
 =
SUCCESS
 )

675 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

676 *
pCurVÆue
 = 
pVÆue
[0];

678 if–
pAâr
->
pVÆue
 =&
sim∂eProfûeCh¨1
 )

680 
nŸifyAµ
 = 
SIMPLEPROFILE_CHAR1
;

684 
nŸifyAµ
 = 
SIMPLEPROFILE_CHAR3
;

690 
GATT_CLIENT_CHAR_CFG_UUID
:

691 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

692 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

697 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

704 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

708 i‡–(
nŸifyAµ
 !0xFF ) && 
sim∂eProfûe_AµCBs
 && sim∂eProfûe_AµCBs->
p‚Sim∂eProfûeCh™ge
 )

710 
sim∂eProfûe_AµCBs
->
	`p‚Sim∂eProfûeCh™ge
–
nŸifyAµ
 );

713  ( 
°©us
 );

714 
	}
}

726 
	$sim∂eProfûe_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

729 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

732 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

733 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

734 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

736 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
sim∂eProfûeCh¨4C⁄fig
 );

739 
	}
}

	@Projects/ble/Profiles/SimpleProfile/simpleGATTprofile.h

40 #i‚de‡
SIMPLEGATTPROFILE_H


41 
	#SIMPLEGATTPROFILE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#SIMPLEPROFILE_CHAR1
 0

58 
	#SIMPLEPROFILE_CHAR2
 1

59 
	#SIMPLEPROFILE_CHAR3
 2

60 
	#SIMPLEPROFILE_CHAR4
 3

61 
	#SIMPLEPROFILE_CHAR5
 4

62 

	)

64 
	#SIMPLEPROFILE_SERV_UUID
 0xFFF0

	)

67 
	#SIMPLEPROFILE_CHAR1_UUID
 0xFFF1

	)

68 
	#SIMPLEPROFILE_CHAR2_UUID
 0xFFF2

	)

69 
	#SIMPLEPROFILE_CHAR3_UUID
 0xFFF3

	)

70 
	#SIMPLEPROFILE_CHAR4_UUID
 0xFFF4

	)

71 
	#SIMPLEPROFILE_CHAR5_UUID
 0xFFF5

	)

74 
	#SIMPLEPROFILE_SERVICE
 0x00000001

	)

77 
	#SIMPLEPROFILE_CHAR5_LEN
 5

	)

93 
NULL_OK
 (*
	tsim∂eProfûeCh™ge_t
)–
	tuöt8
 
	t∑ømID
 );

97 
sim∂eProfûeCh™ge_t
 
p‚Sim∂eProfûeCh™ge
;

98 } 
	tsim∂eProfûeCBs_t
;

115 
bSètus_t
 
Sim∂eProfûe_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

123 
bSètus_t
 
Sim∂eProfûe_Regi°îAµCBs
–
sim∂eProfûeCBs_t
 *
≠pCÆlbacks
 );

135 
bSètus_t
 
Sim∂eProfûe_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

146 
bSètus_t
 
Sim∂eProfûe_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

152 #ifde‡
__˝lu•lus


	@Projects/ble/Profiles/Thermometer/thermometerservice.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"lökdb.h
"

46 
	~"©t.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"g≠b⁄dmgr.h
"

51 
	~"thîmomëî£rvi˚.h
"

73 
CONST
 
uöt8
 
	gthîmomëîSîvUUID
[
ATT_BT_UUID_SIZE
] =

75 
LO_UINT16
(
THERMOMETER_SERV_UUID
), 
HI_UINT16
(THERMOMETER_SERV_UUID)

79 
CONST
 
uöt8
 
	gthîmomëîTempUUID
[
ATT_BT_UUID_SIZE
] =

81 
LO_UINT16
(
THERMOMETER_TEMP_UUID
), 
HI_UINT16
(THERMOMETER_TEMP_UUID)

85 
CONST
 
uöt8
 
	gthîmomëîTy≥UUID
[
ATT_BT_UUID_SIZE
] =

87 
LO_UINT16
(
THERMOMETER_TYPE_UUID
), 
HI_UINT16
(THERMOMETER_TYPE_UUID)

91 
CONST
 
uöt8
 
	gthîmomëîImósUUID
[
ATT_BT_UUID_SIZE
] =

93 
LO_UINT16
(
THERMOMETER_IMEAS_UUID
), 
HI_UINT16
(THERMOMETER_IMEAS_UUID)

97 
CONST
 
uöt8
 
	gthîmomëîI¡îvÆUUID
[
ATT_BT_UUID_SIZE
] =

99 
LO_UINT16
(
THERMOMETER_INTERVAL_UUID
), 
HI_UINT16
(THERMOMETER_INTERVAL_UUID)

103 
CONST
 
uöt8
 
	gthîmomëîIR™geUUID
[
ATT_BT_UUID_SIZE
] =

105 
LO_UINT16
(
THERMOMETER_IRANGE_UUID
), 
HI_UINT16
(THERMOMETER_IRANGE_UUID)

121 
thîmomëîSîvi˚CB_t
 
	gthîmomëîSîvi˚CB
;

128 
CONST
 
g©tAârTy≥_t
 
	gthîmomëîSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
thîmomëîSîvUUID
 };

136 
uöt8
 
	gthîmomëîTempPr›s
 = 
GATT_PROP_INDICATE
;

137 
uöt8
 
	gthîmomëîTemp
 = 0;

138 
g©tCh¨Cfg_t
 
	gthîmomëîTempC⁄fig
[
GATT_MAX_NUM_CONN
];

139 
uöt8
 
	gthîmomëîTempF‹m©
 = 12;

142 
uöt8
 
	gthîmomëîTy≥Pr›s
 = 
GATT_PROP_READ
;

143 
uöt8
 
	gthîmomëîTy≥
 = 0;

146 
uöt8
 
	gthîmomëîImósPr›s
 = 
GATT_PROP_NOTIFY
;

147 
uöt8
 
	gthîmomëîImós
=0;

148 
g©tCh¨Cfg_t
 
	gthîmomëîIMósC⁄fig
[
GATT_MAX_NUM_CONN
];

151 
uöt8
 
	gthîmomëîI¡îvÆPr›s
 = 
GATT_PROP_INDICATE
|
GATT_PROP_READ
|
GATT_PROP_WRITE
;

152 
uöt8
 
	gthîmomëîI¡îvÆ
=30;

153 
g©tCh¨Cfg_t
 
	gthîmomëîI¡îvÆC⁄fig
[
GATT_MAX_NUM_CONN
];

156 
thîmomëîIR™ge_t
 
	gthîmomëîIR™ge
 = {1,60};

162 
g©tAâribuã_t
 
	gthîmomëîAârTbl
[] =

166 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

167 
GATT_PERMIT_READ
,

169 (
uöt8
 *)&
thîmomëîSîvi˚


176 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

177 
GATT_PERMIT_READ
,

179 &
thîmomëîTempPr›s


184 { 
ATT_BT_UUID_SIZE
, 
thîmomëîTempUUID
 },

187 &
thîmomëîTemp


192 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

193 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

195 (
uöt8
 *)&
thîmomëîTempC⁄fig


199 { 
ATT_BT_UUID_SIZE
, 
ch¨F‹m©UUID
 },

200 
GATT_PERMIT_READ
,

202 (
uöt8
 *)&
thîmomëîTempF‹m©


209 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

210 
GATT_PERMIT_READ
,

212 &
thîmomëîTy≥Pr›s


217 { 
ATT_BT_UUID_SIZE
, 
thîmomëîTy≥UUID
 },

218 
GATT_PERMIT_READ
,

220 &
thîmomëîTy≥


227 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

228 
GATT_PERMIT_READ
,

230 &
thîmomëîImósPr›s


235 { 
ATT_BT_UUID_SIZE
, 
thîmomëîImósUUID
 },

238 &
thîmomëîImós


243 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

244 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

246 (
uöt8
 *)&
thîmomëîIMósC⁄fig


253 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

254 
GATT_PERMIT_READ
,

256 &
thîmomëîI¡îvÆPr›s


261 { 
ATT_BT_UUID_SIZE
, 
thîmomëîI¡îvÆUUID
 },

262 
GATT_PERMIT_READ
 | 
GATT_PERMIT_AUTHEN_WRITE
,

264 &
thîmomëîI¡îvÆ


268 { 
ATT_BT_UUID_SIZE
, 
˛õ¡Ch¨CfgUUID
 },

269 
GATT_PERMIT_READ
 | 
GATT_PERMIT_WRITE
,

271 (
uöt8
 *)&
thîmomëîI¡îvÆC⁄fig


275 { 
ATT_BT_UUID_SIZE
, 
thîmomëîIR™geUUID
 },

276 
GATT_PERMIT_READ
,

278 (
uöt8
 *)&
thîmomëîIR™ge


285 
uöt8
 
thîmomëî_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

286 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

287 
bSètus_t
 
thîmomëî_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

288 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 );

290 
thîmomëî_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 );

296 
CONST
 
g©tSîvi˚CBs_t
 
	gthîmomëîCBs
 =

298 
thîmomëî_RódAârCB
,

299 
thîmomëî_WrôeAârCB
,

300 
NULL


318 
bSètus_t
 
	$Thîmomëî_AddSîvi˚
–
uöt32
 
£rvi˚s
 )

320 
uöt8
 
°©us
 = 
SUCCESS
;

323 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
thîmomëîTempC⁄fig
 );

324 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
thîmomëîIMósC⁄fig
 );

325 
	`GATTSîvAµ_InôCh¨Cfg
–
INVALID_CONNHANDLE
, 
thîmomëîI¡îvÆC⁄fig
 );

328 
VOID
 
	`lökDB_Regi°î
–
thîmomëî_H™dÀC⁄nSètusCB
 );

330 i‡–
£rvi˚s
 & 
THERMOMETER_SERVICE
 )

333 
°©us
 = 
	`GATTSîvAµ_Regi°îSîvi˚
–
thîmomëîAârTbl
,

334 
	`GATT_NUM_ATTRS
–
thîmomëîAârTbl
 ),

335 &
thîmomëîCBs
 );

338  ( 
°©us
 );

339 
	}
}

350 
	$Thîmomëî_Regi°î
–
thîmomëîSîvi˚CB_t
 
p‚Sîvi˚CB
 )

352 
thîmomëîSîvi˚CB
 = 
p‚Sîvi˚CB
;

353 
	}
}

369 
bSètus_t
 
	$Thîmomëî_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

371 
bSètus_t
 
ªt
 = 
SUCCESS
;

372  
∑øm
 )

375 
THERMOMETER_TYPE
:

376 
thîmomëîTy≥
 = *((
uöt8
*)
vÆue
);

379 
THERMOMETER_INTERVAL
:

380 
thîmomëîI¡îvÆ
 = *((
uöt8
*)
vÆue
);

383 
THERMOMETER_TEMP_CHAR_CFG
:

388 
THERMOMETER_IMEAS_CHAR_CFG
:

393 
THERMOMETER_INTERVAL_CHAR_CFG
:

398 
THERMOMETER_IRANGE
:

399 
thîmomëîIR™ge
 = *((
thîmomëîIR™ge_t
*)
vÆue
);

403 
ªt
 = 
INVALIDPARAMETER
;

407  ( 
ªt
 );

408 
	}
}

423 
bSètus_t
 
	$Thîmomëî_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

425 
bSètus_t
 
ªt
 = 
SUCCESS
;

427  
∑øm
 )

429 
THERMOMETER_TYPE
:

430 *((
uöt8
*)
vÆue
Ë
thîmomëîTy≥
;

433 
THERMOMETER_INTERVAL
:

434 *((
uöt8
*)
vÆue
Ë
thîmomëîI¡îvÆ
;

437 
THERMOMETER_IRANGE
:

438 *((
thîmomëîIR™ge_t
*)
vÆue
Ë
thîmomëîIR™ge
;

441 
THERMOMETER_TEMP_CHAR_CFG
:

446 
THERMOMETER_IMEAS_CHAR_CFG
:

451 
THERMOMETER_INTERVAL_CHAR_CFG
:

457 
ªt
 = 
INVALIDPARAMETER
;

461  ( 
ªt
 );

462 
	}
}

475 
bSètus_t
 
	$Thîmomëî_TempIndiˇã
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pNŸi
,
uöt8
 
èskId
 )

477 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
thîmomëîTempC⁄fig
 );

480 i‡–
vÆue
 & 
GATT_CLIENT_CFG_INDICATE
 )

483 
pNŸi
->
h™dÀ
 = 
thîmomëîAârTbl
[pNoti->handle].handle;

486  
	`GATT_Indiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
, 
èskId
 );

489  
bÀInc‹ª˘Mode
;

490 
	}
}

502 
bSètus_t
 
	$Thîmomëî_I¡îvÆIndiˇã
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pNŸi
,
uöt8
 
èskId
 )

504 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
thîmomëîI¡îvÆC⁄fig
 );

507 i‡–
vÆue
 & 
GATT_CLIENT_CFG_INDICATE
 )

510 
pNŸi
->
h™dÀ
 = 
thîmomëîAârTbl
[pNoti->handle].handle;

513  
	`GATT_Indiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
, 
èskId
 );

516  
bÀInc‹ª˘Mode
;

517 
	}
}

530 
bSètus_t
 
	$Thîmomëî_IMósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
)

532 
uöt16
 
vÆue
 = 
	`GATTSîvAµ_RódCh¨Cfg
–
c⁄nH™dÀ
, 
thîmomëîIMósC⁄fig
 );

535 i‡–
vÆue
 & 
GATT_CLIENT_CFG_NOTIFY
 )

538 
pNŸi
->
h™dÀ
 = 
thîmomëîAârTbl
[
THERMOMETER_IMEAS_VALUE_POS
].handle;

541  
	`GATT_NŸifiˇti⁄
–
c⁄nH™dÀ
, 
pNŸi
, 
FALSE
 );

544  
bÀInc‹ª˘Mode
;

545 
	}
}

561 
uöt8
 
	$thîmomëî_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

562 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

564 
bSètus_t
 
°©us
 = 
SUCCESS
;

567 i‡–
	`g©tPîmôAuth‹Ród
–
pAâr
->
≥rmissi⁄s
 ) )

570  ( 
ATT_ERR_INSUFFICIENT_AUTHOR
 );

574 i‡–
off£t
 > 0 )

576  ( 
ATT_ERR_ATTR_NOT_LONG
 );

579 i‡–
pAâr
->
ty≥
.
Àn
 =
ATT_BT_UUID_SIZE
 )

582 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

583  
uuid
 )

585 
THERMOMETER_TYPE_UUID
:

586 *
pLí
 = 
THERMOMETER_TYPE_LEN
;

587 
VOID
 
	`oßl_mem˝y
–
pVÆue
, &
thîmomëîTy≥
, 
THERMOMETER_TYPE_LEN
 ) ;

590 
THERMOMETER_INTERVAL_UUID
:

591 *
pLí
 = 
THERMOMETER_INTERVAL_LEN
;

592 
VOID
 
	`oßl_mem˝y
–
pVÆue
, &
thîmomëîI¡îvÆ
, 
THERMOMETER_INTERVAL_LEN
 ) ;

595 
THERMOMETER_IRANGE_UUID
:

596 *
pLí
 = 
THERMOMETER_IRANGE_LEN
;

597 
VOID
 
	`oßl_mem˝y
–
pVÆue
, &
thîmomëîIR™ge
, 
THERMOMETER_IRANGE_LEN
 ) ;

601 *
pLí
 = 0;

602 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

607  ( 
°©us
 );

608 
	}
}

623 
bSètus_t
 
	$thîmomëî_WrôeAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

624 
uöt8
 *
pVÆue
, uöt8 
Àn
, 
uöt16
 
off£t
 )

626 
bSètus_t
 
°©us
 = 
SUCCESS
;

628 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

629  
uuid
 )

631 
GATT_CLIENT_CHAR_CFG_UUID
:

633 i‡–
pAâr
->
h™dÀ
 =
thîmomëîAârTbl
[
THERMOMETER_TEMP_CHAR_CONFIG_POS
].handle )

635 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

636 
off£t
, 
GATT_CLIENT_CFG_INDICATE
 );

637 i‡–
°©us
 =
SUCCESS
 )

639 
uöt16
 
vÆue
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

641 (*
thîmomëîSîvi˚CB
)–(
vÆue
 =
GATT_CFG_NO_OPERATION
) ?

642 
THERMOMETER_TEMP_IND_DISABLED
 :

643 
THERMOMETER_TEMP_IND_ENABLED
 );

647 i‡–
pAâr
->
h™dÀ
 =
thîmomëîAârTbl
[
THERMOMETER_IMEAS_CHAR_CONFIG_POS
].handle )

649 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

650 
off£t
, 
GATT_CLIENT_CFG_NOTIFY
 );

651 i‡–
°©us
 =
SUCCESS
 )

653 
uöt16
 
vÆue
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

656 (*
thîmomëîSîvi˚CB
)–(
vÆue
 =
GATT_CFG_NO_OPERATION
) ?

657 
THERMOMETER_IMEAS_NOTI_DISABLED
 :

658 
THERMOMETER_IMEAS_NOTI_ENABLED
);

662 i‡–
pAâr
->
h™dÀ
 =
thîmomëîAârTbl
[
THERMOMETER_INTERVAL_CHAR_CONFIG_POS
].handle )

664 
°©us
 = 
	`GATTSîvAµ_Pro˚ssCCCWrôeReq
–
c⁄nH™dÀ
, 
pAâr
, 
pVÆue
, 
Àn
,

665 
off£t
, 
GATT_CLIENT_CFG_INDICATE
 );

666 i‡–
°©us
 =
SUCCESS
 )

668 
uöt16
 
vÆue
 = 
	`BUILD_UINT16
–
pVÆue
[0],ÖValue[1] );

671 (*
thîmomëîSîvi˚CB
)–(
vÆue
 =
GATT_CFG_NO_OPERATION
) ?

672 
THERMOMETER_INTERVAL_IND_DISABLED
 :

673 
THERMOMETER_INTERVAL_IND_ENABLED
);

677 
°©us
 = 
ATT_ERR_INVALID_HANDLE
;

682 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

686 
THERMOMETER_INTERVAL_UUID
:

689 i‡–
off£t
 == 0 )

691 i‡–
Àn
 !
THERMOMETER_INTERVAL_LEN
 )

692 
°©us
 = 
ATT_ERR_INVALID_VALUE_SIZE
;

696 
°©us
 = 
ATT_ERR_ATTR_NOT_LONG
;

700 i‡((*
pVÆue
 >
thîmomëîIR™ge
.
high
Ë| ((*pVÆuê<thîmomëîIR™ge.
low
) & (*pValue != 0)))

702 
°©us
 = 
ATT_ERR_INVALID_VALUE
;

706 i‡–
°©us
 =
SUCCESS
 )

708 
uöt8
 *
pCurVÆue
 = (uöt8 *)
pAâr
->
pVÆue
;

710 
VOID
 
	`oßl_mem˝y
–
pCurVÆue
, 
pVÆue
, 
THERMOMETER_INTERVAL_LEN
 ) ;

713 (*
thîmomëîSîvi˚CB
)(
THERMOMETER_INTERVAL_SET
);

719 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

723  ( 
°©us
 );

724 
	}
}

737 
	$thîmomëî_H™dÀC⁄nSètusCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
ch™geTy≥
 )

740 i‡–
c⁄nH™dÀ
 !
LOOPBACK_CONNHANDLE
 )

743 i‡––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_REMOVED
 ) ||

744 ––
ch™geTy≥
 =
LINKDB_STATUS_UPDATE_STATEFLAGS
 ) &&

745 –!
	`lökDB_Up
–
c⁄nH™dÀ
 ) ) ) )

747 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
thîmomëîTempC⁄fig
 );

748 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
thîmomëîIMósC⁄fig
 );

749 
	`GATTSîvAµ_InôCh¨Cfg
–
c⁄nH™dÀ
, 
thîmomëîI¡îvÆC⁄fig
 );

752 
	}
}

	@Projects/ble/Profiles/Thermometer/thermometerservice.h

40 #i‚de‡
THERMOMETERSERVICE_H


41 
	#THERMOMETERSERVICE_H


	)

43 #ifde‡
__˝lu•lus


57 
	#THERMOMETER_TEMP
 0

	)

58 
	#THERMOMETER_TEMP_CHAR_CFG
 1

	)

59 
	#THERMOMETER_TYPE
 2

	)

60 
	#THERMOMETER_INTERVAL
 3

	)

61 
	#THERMOMETER_INTERVAL_CHAR_CFG
 4

	)

62 
	#THERMOMETER_IMEAS_CHAR_CFG
 5

	)

63 
	#THERMOMETER_IRANGE
 6

	)

67 
	#THERMOMETER_TEMP_VALUE_POS
 2

	)

68 
	#THERMOMETER_TEMP_CHAR_CONFIG_POS
 3

	)

69 
	#THERMOMETER_IMEAS_VALUE_POS
 8

	)

70 
	#THERMOMETER_IMEAS_CHAR_CONFIG_POS
 9

	)

71 
	#THERMOMETER_INTERVAL_VALUE_POS
 11

	)

72 
	#THERMOMETER_INTERVAL_CHAR_CONFIG_POS
 12

	)

75 
	#THERMOMETER_INTERVAL_LEN
 1

	)

76 
	#THERMOMETER_TYPE_LEN
 1

	)

77 
	#THERMOMETER_IRANGE_LEN
 2

	)

80 
	#THERMOMETER_SERV_UUID
 0x1809

81 
	#THERMOMETER_TEMP_UUID
 0x2A1C

82 
	#THERMOMETER_TYPE_UUID
 0x2A1D

83 
	#THERMOMETER_IMEAS_UUID
 0x2A1E

84 
	#THERMOMETER_INTERVAL_UUID
 0x2A21

85 
	#THERMOMETER_IRANGE_UUID
 0x2906

86 

	)

89 
	#THERMOMETER_MEAS_MAX
 (
ATT_MTU_SIZE
 -5)

	)

92 
	#THERMOMETER_FLAGS_CELCIUS
 0x00

	)

93 
	#THERMOMETER_FLAGS_FARENHEIT
 0x01

	)

94 
	#THERMOMETER_FLAGS_TIMESTAMP
 0x02

	)

95 
	#THERMOMETER_FLAGS_TYPE
 0x04

	)

98 
	#THERMOMETER_TYPE_ARMPIT
 0x01

	)

99 
	#THERMOMETER_TYPE_BODY
 0x02

	)

100 
	#THERMOMETER_TYPE_EAR
 0x03

	)

101 
	#THERMOMETER_TYPE_FINGER
 0x04

	)

102 
	#THERMOMETER_TYPE_GASTRO
 0x05

	)

103 
	#THERMOMETER_TYPE_MOUTH
 0x06

	)

104 
	#THERMOMETER_TYPE_RECTUM
 0x07

	)

105 
	#THERMOMETER_TYPE_TOE
 0x08

	)

106 
	#THERMOMETER_TYPE_TYMPNUM
 0x09

	)

109 
	#THERMOMETER_SERVICE
 0x00000001

	)

112 
	#THERMOMETER_TEMP_IND_ENABLED
 1

	)

113 
	#THERMOMETER_TEMP_IND_DISABLED
 2

	)

114 
	#THERMOMETER_IMEAS_NOTI_ENABLED
 3

	)

115 
	#THERMOMETER_IMEAS_NOTI_DISABLED
 4

	)

116 
	#THERMOMETER_INTERVAL_IND_ENABLED
 5

	)

117 
	#THERMOMETER_INTERVAL_IND_DISABLED
 6

	)

118 
	#THERMOMETER_INTERVAL_SET
 7

	)

119 
	#THERMOMETER_TESTCMD_C
 8

	)

120 
	#THERMOMETER_TESTCMD_F
 9

	)

127 (*
thîmomëîSîvi˚CB_t
)(
	tuöt8
 
	tevít
);

134 
uöt8
 
low
;

135 
uöt8
 
high
;

136 } 
	tthîmomëîIR™ge_t
;

159 
bSètus_t
 
Thîmomëî_AddSîvi˚
–
uöt32
 
£rvi˚s
 );

168 
Thîmomëî_Regi°î
–
thîmomëîSîvi˚CB_t
 
p‚Sîvi˚CB
 );

180 
bSètus_t
 
Thîmomëî_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

191 
bSètus_t
 
Thîmomëî_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

204 
bSètus_t
 
Thîmomëî_TempIndiˇã
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pNŸi
, 
uöt8
 
èskId
 );

216 
bSètus_t
 
Thîmomëî_I¡îvÆIndiˇã
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueInd_t
 *
pNŸi
,
uöt8
 
èskId
 );

228 
bSètus_t
 
Thîmomëî_IMósNŸify
–
uöt16
 
c⁄nH™dÀ
, 
©tH™dÀVÆueNŸi_t
 *
pNŸi
 );

234 #ifde‡
__˝lu•lus


	@Projects/ble/RunningSensor/Source/OSAL_runningSensor.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

70 
	~"g©t£rv≠p.h
"

73 
	~"≥rùhîÆ.h
"

74 
	~"ru¬ög£rvi˚.h
"

77 
	~"ru¬ögSís‹.h
"

84 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

86 
LL_Pro˚ssEvít
,

87 
HÆ_Pro˚ssEvít
,

88 
HCI_Pro˚ssEvít
,

89 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

90 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

92 
L2CAP_Pro˚ssEvít
,

93 
GAP_Pro˚ssEvít
,

94 
GATT_Pro˚ssEvít
,

95 
SM_Pro˚ssEvít
,

96 
GAPRﬁe_Pro˚ssEvít
,

97 
GAPB⁄dMgr_Pro˚ssEvít
,

98 
GATTSîvAµ_Pro˚ssEvít
,

99 
Ru¬ögSîvi˚_Pro˚ssEvít
,

100 
Ru¬ögSís‹_Pro˚ssEvít


103 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

104 
uöt16
 *
	gèsksEvíts
;

119 
	$oßlInôTasks
( )

121 
uöt8
 
èskID
 = 0;

123 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

124 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

127 
	`LL_Inô
–
èskID
++ );

130 
	`HÆ_Inô
–
èskID
++ );

133 
	`HCI_Inô
–
èskID
++ );

135 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

137 
	`oßl_CbTimîInô
–
èskID
 );

138 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

142 
	`L2CAP_Inô
–
èskID
++ );

145 
	`GAP_Inô
–
èskID
++ );

148 
	`GATT_Inô
–
èskID
++ );

151 
	`SM_Inô
–
èskID
++ );

154 
	`GAPRﬁe_Inô
–
èskID
++ );

155 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

157 
	`GATTSîvAµ_Inô
–
èskID
++ );

159 
	`Ru¬ögSîvi˚_Inô
–
èskID
++ );

162 
	`Ru¬ögSís‹_Inô
–
èskID
 );

163 
	}
}

	@Projects/ble/RunningSensor/Source/runningSensor.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

50 
	~"lökdb.h
"

51 
	~"g©t.h
"

52 
	~"hci.h
"

53 
	~"g≠g©t£rvî.h
"

54 
	~"g©t£rv≠p.h
"

55 
	~"≥rùhîÆ.h
"

56 
	~"g≠b⁄dmgr.h
"

58 
	~"ru¬ög£rvi˚.h
"

59 
	~"devöfo£rvi˚.h
"

61 
	~"ru¬ögSís‹.h
"

67 
	#DISTANCE_TRAVELED
–
•ìd
 ) ((•ìdË* ((
DEFAULT_RSC_PERIOD
Ë/ 1000))

	)

74 
	#DEFAULT_FAST_ADV_INTERVAL
 48

	)

77 
	#DEFAULT_FAST_ADV_DURATION
 20000

	)

80 
	#DEFAULT_WHITE_LIST_ADV_DURATION
 10000

	)

83 
	#DEFAULT_SLOW_ADV_INTERVAL
 1600

	)

86 
	#DEFAULT_SLOW_ADV_DURATION
 20000

	)

89 
	#DEFAULT_RSC_PERIOD
 2000

	)

92 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

95 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 200

	)

98 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 1600

	)

101 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 0

	)

104 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

106 
	#DEFAULT_PAIRING_PARAMETER
 
GAPBOND_PAIRING_MODE_INITIATE


	)

108 
	#USING_WHITE_LIST
 
TRUE


	)

110 
	#REQ_BONDING
 
TRUE


	)

112 
	#SVC_DISC_DELAY
 5000

	)

115 
	#NEGLECT_TIMEOUT_DELAY
 15000

	)

118 
	#USING_NEGLECT_TIMEOUT
 
TRUE


	)

121 
	#RSC_RESET_DELAY
 3000

122 

	)

124 
	#FLAGS_IDX_MAX
 4

	)

127 
	#STRIDE_LENGTH_RUNNING
 500

	)

128 
	#STRIDE_LENGTH_WALKING
 350

	)

131 
	#RUNNING_CADENCE
 180

	)

132 
	#WALKING_CADENCE
 85

	)

134 
	#RUNNING_SPEED
 180

	)

135 
	#WALKING_SPEED
 50

	)

138 
	#STANDING_STILL
 0

	)

139 
	#WALKING_MOTION
 1

	)

140 
	#RUNNING_MOTION
 2

	)

141 
	#MOTION_IDX_MAX
 3

	)

144 
	#MAX_INACTIVITY_DUR
 10000

	)

165 
uöt8
 
	g£ns‹_TaskID
;

167 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

169 
uöt8
 
	g£ns‹UsögWhôeLi°
 = 
FALSE
;

172 
uöt8
 
	gsˇnD©a
[] =

175 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

188 
uöt8
 
	gadvîtD©a
[] =

192 
GAP_ADTYPE_FLAGS
,

193 
GAP_ADTYPE_FLAGS_GENERAL
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

196 
GAP_ADTYPE_16BIT_MORE
,

197 
LO_UINT16
(
RSC_SERV_UUID
),

198 
HI_UINT16
(
RSC_SERV_UUID
),

202 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "RSC Sensor";

205 
uöt16
 
	gg≠C⁄nH™dÀ
;

208 
©tH™dÀVÆueNŸi_t
 
	g£ns‹Mós
;

211 c⁄° 
uöt8
 
	g£ns‹Fœgs
[
FLAGS_IDX_MAX
] =

213 
RSC_FLAGS_ALL
,

214 
RSC_FLAGS_AT_REST
,

215 
RSC_FLAGS_STRIDE
,

216 
RSC_FLAGS_DIST


219 c⁄° 
uöt8
 
	gmŸi⁄Cy˛e
[
MOTION_IDX_MAX
] =

221 
STANDING_STILL
,

222 
WALKING_MOTION
,

223 
RUNNING_MOTION
,

226 
uöt8
 
	gmŸi⁄Idx
 = 0;

229 
uöt8
 
	g£ns‹FœgsIdx
 = 0;

232 
boﬁ
 
	g£ns‹AdvC™˚Œed
 = 
FALSE
;

235 
uöt32
 
	gtŸÆDi°™˚
 = 0;

236 
uöt16
 
	gö°S≥ed
 = 0;

237 
uöt8
 
	gö°Cadí˚
 = 0;

238 
uöt16
 
	gö°SåideLígth
 = 0;

239 
uöt8
 
	g£ns‹Loˇti⁄
 = 
RSC_NO_SENSOR_LOC
;

240 
uöt8
 
	gmŸi⁄
 = 
STANDING_STILL
;

243 
uöt8
 
	gª£tInProgªss
 = 
FALSE
;

248 
£ns‹_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

249 
Sís‹G≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

250 
£ns‹PîiodicTask
( );

251 
£ns‹_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

252 
£ns‹MósNŸify
();

253 
bSètus_t
 
Sís‹CB
(
uöt8
 
evít
, 
uöt32
 *
pNewCummVÆ
);

260 
g≠RﬁesCBs_t
 
	gru¬ögPîùhîÆCB
 =

262 
Sís‹G≠SèãCB
,

263 
NULL


267 c⁄° 
g≠B⁄dCBs_t
 
	gru¬ögB⁄dCB
 =

269 
NULL
,

270 
NULL


291 
	$Ru¬ögSís‹_Inô
–
uöt8
 
èsk_id
 )

293 
£ns‹_TaskID
 = 
èsk_id
;

298 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

303 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

305 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

306 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

307 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

308 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

309 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

312 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

313 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

315 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnD©a
 ), scanData );

316 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

318 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

319 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

320 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

321 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

322 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

326 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
©tDevi˚Name
 );

330 
uöt32
 
∑sskey
 = 0;

331 
uöt8
 
∑úMode
 = 
DEFAULT_PAIRING_PARAMETER
;

332 
uöt8
 
môm
 = 
FALSE
;

333 
uöt8
 
ioC≠
 = 
GAPBOND_IO_CAP_NO_INPUT_NO_OUTPUT
;

334 
uöt8
 
b⁄dög
 = 
REQ_BONDING
;

335 
uöt8
 
autoSync
 = 
USING_WHITE_LIST
;

337 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
,  ( 
uöt32
 ), &
∑sskey
 );

338 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

339 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

340 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

341 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

342 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_AUTO_SYNC_WL
,  ( 
uöt8
 ), &
autoSync
 );

346 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

347 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

348 
	`Ru¬ög_AddSîvi˚
–
GATT_ALL_SERVICES
 );

349 
	`DevInfo_AddSîvi˚
( );

352 
	`Ru¬ög_Regi°î
–
Sís‹CB
 );

356 
uöt16
 
„©uªs
 = 
RSC_FULL_SUPPORT
;

357 
uöt8
 
£ns‹Loˇti⁄Cuºít
 = 
RSC_SENSOR_LOC_0
;

358 
uöt8
 
£ns‹Loˇti⁄1
 = 
RSC_SENSOR_LOC_0
;

359 
uöt8
 
£ns‹Loˇti⁄2
 = 
RSC_SENSOR_LOC_1
;

360 
uöt8
 
£ns‹Loˇti⁄3
 = 
RSC_SENSOR_LOC_2
;

361 
uöt8
 
£ns‹Loˇti⁄4
 = 
RSC_SENSOR_LOC_3
;

364 
	`Ru¬ög_SëP¨amëî
(
RSC_AVAIL_SENS_LOCS
, –
uöt8
 ), &
£ns‹Loˇti⁄1
);

365 
	`Ru¬ög_SëP¨amëî
(
RSC_AVAIL_SENS_LOCS
, –
uöt8
 ), &
£ns‹Loˇti⁄2
);

366 
	`Ru¬ög_SëP¨amëî
(
RSC_AVAIL_SENS_LOCS
, –
uöt8
 ), &
£ns‹Loˇti⁄3
);

367 
	`Ru¬ög_SëP¨amëî
(
RSC_AVAIL_SENS_LOCS
, –
uöt8
 ), &
£ns‹Loˇti⁄4
);

370 
	`Ru¬ög_SëP¨amëî
(
RSC_SENS_LOC
, –
uöt8
 ), &
£ns‹Loˇti⁄Cuºít
);

373 
	`Ru¬ög_SëP¨amëî
(
RSC_FEATURE
, –
uöt16
 ), &
„©uªs
);

377 
	`Regi°îF‹Keys
–
£ns‹_TaskID
 );

380 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

386 
P0SEL
 = 0;

387 
P1SEL
 = 0;

388 
P2SEL
 = 0;

390 
P0DIR
 = 0xFC;

392 
P1DIR
 = 0xFF;

393 
P2DIR
 = 0x1F;

395 
P0
 = 0x03;

396 
P1
 = 0;

397 
P2
 = 0;

400 
	`oßl_£t_evít
–
£ns‹_TaskID
, 
START_DEVICE_EVT
 );

401 
	}
}

416 
uöt16
 
	$Ru¬ögSís‹_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

419 
VOID
 
èsk_id
;

421 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

423 
uöt8
 *
pMsg
;

425 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
£ns‹_TaskID
 )Ë!
NULL
 )

427 
	`£ns‹_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

430 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

434  (
evíts
 ^ 
SYS_EVENT_MSG
);

437 i‡–
evíts
 & 
START_DEVICE_EVT
 )

440 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
ru¬ögPîùhîÆCB
 );

443 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
ru¬ögB⁄dCB
 );

445  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

448 i‡–
evíts
 & 
RSC_PERIODIC_EVT
 )

451 
	`£ns‹PîiodicTask
();

453  (
evíts
 ^ 
RSC_PERIODIC_EVT
);

456 i‡–
evíts
 & 
RSC_CONN_PARAM_UPDATE_EVT
 )

459 
	`GAPRﬁe_SídUpd©eP¨am
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
, 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
,

460 
DEFAULT_DESIRED_SLAVE_LATENCY
, 
DEFAULT_DESIRED_CONN_TIMEOUT
,

461 
GAPROLE_RESEND_PARAM_UPDATE
 );

464 i‡–
USING_NEGLECT_TIMEOUT
 )

466 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

469  (
evíts
 ^ 
RSC_CONN_PARAM_UPDATE_EVT
);

472 i‡–
evíts
 & 
RSC_NEGLECT_TIMEOUT_EVT
 )

475 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

477  ( 
evíts
 ^ 
RSC_NEGLECT_TIMEOUT_EVT
 );

480 i‡–
evíts
 & 
RSC_RESET_EVT
 )

482 i‡–
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 )

485 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

488 
g≠ProfûeSèã
 = 
GAPROLE_WAITING
;

491 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_RESET_EVT
, 500 );

493 i‡–
g≠ProfûeSèã
 =
GAPROLE_ADVERTISING
 )

495 
uöt8
 
vÆue
 = 
FALSE
;

498 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
vÆue
 );

501 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_RESET_EVT
, 500 );

503 i‡–
USING_WHITE_LIST
 =
TRUE
 )

506 
uöt8
 
vÆue
 = 
GAP_FILTER_POLICY_ALL
;

509 
	`GAPRﬁe_SëP¨amëî
(
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
vÆue
);

511 
£ns‹UsögWhôeLi°
 = 
FALSE
;

514 
	`HCI_LE_CÀ¨WhôeLi°Cmd
();

517 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_RESET_EVT
, 500 );

519 i‡–(
g≠ProfûeSèã
 =
GAPROLE_STARTED
) ||

520 (
g≠ProfûeSèã
 =
GAPROLE_WAITING
) ||

521 (
g≠ProfûeSèã
 =
GAPROLE_WAITING_AFTER_TIMEOUT
) )

523 
uöt8
 
îa£B⁄ds
 = 
TRUE
;

526 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_ERASE_ALLBONDS
, 0, &
îa£B⁄ds
 );

529 
	`HÆLedSë
–
HAL_LED_1
, 
HAL_LED_MODE_BLINK
 );

531  (
evíts
 ^ 
RSC_RESET_EVT
);

537 
	}
}

548 
	$£ns‹_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

550  
pMsg
->
evít
 )

552 
KEY_CHANGE
:

553 
	`£ns‹_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

556 
	}
}

570 
	$£ns‹_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

572 i‡–
keys
 =–
HAL_KEY_SW_1
 | 
HAL_KEY_SW_2
 ) )

575 
ª£tInProgªss
 = 
TRUE
;

578 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_RESET_EVT
, 
RSC_RESET_DELAY
 );

580 i‡–
keys
 & 
HAL_KEY_SW_1
 )

582 i‡–
ª£tInProgªss
 =
TRUE
 )

585 
ª£tInProgªss
 = 
FALSE
;

586 
	`oßl_°›_timîEx
 ( 
£ns‹_TaskID
, 
RSC_RESET_EVT
 );

590 i‡(++
£ns‹FœgsIdx
 =
FLAGS_IDX_MAX
)

592 
£ns‹FœgsIdx
 = 0;

595 i‡–
keys
 & 
HAL_KEY_SW_2
 )

597 i‡–
ª£tInProgªss
 =
TRUE
 )

600 
ª£tInProgªss
 = 
FALSE
;

601 
	`oßl_°›_timîEx
 ( 
£ns‹_TaskID
, 
RSC_RESET_EVT
 );

605 i‡–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

607 
uöt8
 
°©us
;

610 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

611 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

612 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_WHITE_LIST_ADV_DURATION
 );

615 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
°©us
 );

616 
°©us
 = !status;

620 i‡–
USING_WHITE_LIST
 && 
°©us
 =
TRUE
 )

622 
uöt8
 
b⁄dCou¡
 = 0;

624 
	`GAPB⁄dMgr_GëP¨amëî
–
GAPBOND_BOND_COUNT
, &
b⁄dCou¡
 );

626 i‡((
£ns‹UsögWhôeLi°
 =
FALSE
Ë&& (
b⁄dCou¡
 > 0) )

628 
uöt8
 
vÆue
 = 
GAP_FILTER_POLICY_WHITE
;

630 
	`GAPRﬁe_SëP¨amëî
(
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
vÆue
);

632 
£ns‹UsögWhôeLi°
 = 
TRUE
;

636 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
°©us
 );

639 i‡(
°©us
 =
FALSE
)

641 
£ns‹AdvC™˚Œed
 = 
TRUE
;

644 i‡–
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 )

647 if–(++
mŸi⁄Idx
Ë=
MOTION_IDX_MAX
 )

649 
mŸi⁄Idx
 = 0;

652 
mŸi⁄
 = 
mŸi⁄Cy˛e
[
mŸi⁄Idx
];

656 i‡–
keys
 == 0x00 )

658 i‡–
ª£tInProgªss
 =
TRUE
 )

660 
ª£tInProgªss
 = 
FALSE
;

662 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
RSC_RESET_EVT
 );

665 
	}
}

674 
	$£ns‹MósNŸify
()

676 
uöt16
 
˚¡imëîs
 = 0;

677 
uöt8
 *
p
 = 
£ns‹Mós
.
vÆue
;

678 
uöt8
 
Êags
 = 
£ns‹Fœgs
[
£ns‹FœgsIdx
];

680  
mŸi⁄
 )

682 
STANDING_STILL
:

683 
ö°S≥ed
 = 
ö°Cadí˚
 = 
ö°SåideLígth
 = 
STANDING_STILL
;

685 
Êags
 = flags & 0xFB;

688 
WALKING_MOTION
:

689 
ö°SåideLígth
 = 
STRIDE_LENGTH_WALKING
;

690 
ö°Cadí˚
 = 
WALKING_CADENCE
;

691 
ö°S≥ed
 = 
WALKING_SPEED
;

693 
Êags
 = flags & 0xFB;

696 
RUNNING_MOTION
:

697 
ö°SåideLígth
 = 
STRIDE_LENGTH_RUNNING
;

698 
ö°Cadí˚
 = 
RUNNING_CADENCE
;

699 
ö°S≥ed
 = 
RUNNING_SPEED
;

701 
Êags
 = flags | 0x04;

709 
˚¡imëîs
 +(
uöt16
)
	`DISTANCE_TRAVELED
–
ö°S≥ed
 );

712 i‡–
˚¡imëîs
 >= 100 )

715 
tŸÆDi°™˚
 +(
˚¡imëîs
 / 100);

717 
˚¡imëîs
 %= 100;

722 *
p
++ = 
Êags
;

725 *
p
++ = 
	`LO_UINT16
–
ö°S≥ed
 );

726 *
p
++ = 
	`HI_UINT16
–
ö°S≥ed
 );

727 *
p
++ = 
ö°Cadí˚
;

729 i‡(
Êags
 & 
RSC_FLAGS_STRIDE
)

731 *
p
++ = 
	`LO_UINT16
–
ö°SåideLígth
 );

732 *
p
++ = 
	`HI_UINT16
–
ö°SåideLígth
 );

735 i‡(
Êags
 & 
RSC_FLAGS_DIST
)

737 *
p
++ = 
	`BREAK_UINT32
(
tŸÆDi°™˚
, 0);

738 *
p
++ = 
	`BREAK_UINT32
(
tŸÆDi°™˚
, 1);

739 *
p
++ = 
	`BREAK_UINT32
(
tŸÆDi°™˚
, 2);

740 *
p
++ = 
	`BREAK_UINT32
(
tŸÆDi°™˚
, 3);

744 
£ns‹Mós
.
Àn
 = (
uöt8
Ë(
p
 - sís‹Mós.
vÆue
);

747 
	`Ru¬ög_MósNŸify
–
g≠C⁄nH™dÀ
, &
£ns‹Mós
 );

748 
	}
}

759 
	$Sís‹G≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

762 i‡(
√wSèã
 =
GAPROLE_CONNECTED
)

765 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_CONNHANDLE
, &
g≠C⁄nH™dÀ
);

769 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_CONN_PARAM_UPDATE_EVT
, 
SVC_DISC_DELAY
);

772 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 &&

773 
√wSèã
 !
GAPROLE_CONNECTED
)

775 
uöt8
 
advSèã
 = 
TRUE
;

776 
uöt8
 
b⁄dCou¡
 = 0;

779 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
RSC_PERIODIC_EVT
 );

782 
	`Ru¬ög_H™dÀC⁄nSètusCB
–
g≠C⁄nH™dÀ
, 
LINKDB_STATUS_UPDATE_REMOVED
 );

786 
	`GAPB⁄dMgr_GëP¨amëî
–
GAPBOND_BOND_COUNT
, &
b⁄dCou¡
 );

788 if(
USING_WHITE_LIST
 && 
£ns‹UsögWhôeLi°
 =
FALSE
 && 
b⁄dCou¡
 > 0 )

790 
uöt8
 
vÆue
 = 
GAP_FILTER_POLICY_WHITE
;

792 
	`GAPRﬁe_SëP¨amëî
(
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
 ), &
vÆue
);

794 
£ns‹UsögWhôeLi°
 = 
TRUE
;

797 i‡–
√wSèã
 =
GAPROLE_WAITING_AFTER_TIMEOUT
 )

800 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

801 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

802 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_WHITE_LIST_ADV_DURATION
 );

807 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

808 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

809 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_WHITE_LIST_ADV_DURATION
 );

813 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

816 i‡–
g≠ProfûeSèã
 =
GAPROLE_ADVERTISING
 &&

817 
√wSèã
 =
GAPROLE_WAITING
 )

819 
uöt8
 
whôeLi°U£d
 = 
FALSE
;

822 i‡–
£ns‹UsögWhôeLi°
 =
TRUE
 )

824 
uöt8
 
vÆue
 = 
GAP_FILTER_POLICY_ALL
;

826 
	`GAPRﬁe_SëP¨amëî
(
GAPROLE_ADV_FILTER_POLICY
, –
uöt8
), &
vÆue
);

828 
whôeLi°U£d
 = 
TRUE
;

830 
£ns‹UsögWhôeLi°
 = 
FALSE
;

834 i‡–
£ns‹AdvC™˚Œed
 )

836 
£ns‹AdvC™˚Œed
 = 
FALSE
;

839 i‡––(!
USING_WHITE_LIST
Ë|| 
whôeLi°U£d
) &&

840 (
	`GAP_GëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
 ) =
DEFAULT_FAST_ADV_INTERVAL
 ) )

842 
uöt8
 
advSèã
 = 
TRUE
;

844 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

845 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

846 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_FAST_ADV_DURATION
 );

847 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

850 i‡–((!
USING_WHITE_LIST
Ë|| 
whôeLi°U£d
) ||

851 (
	`GAP_GëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
 ) =
DEFAULT_FAST_ADV_INTERVAL
) )

853 
uöt8
 
advSèã
 = 
TRUE
;

855 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

856 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

857 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_SLOW_ADV_DURATION
 );

858 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

862 i‡(
√wSèã
 =
GAPROLE_STARTED
)

865 
uöt8
 
sy°emId
[
DEVINFO_SYSTEM_ID_LEN
];

866 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
sy°emId
);

869 
sy°emId
[7] = systemId[5];

870 
sy°emId
[6] = systemId[4];

871 
sy°emId
[5] = systemId[3];

874 
sy°emId
[4] = 0;

875 
sy°emId
[3] = 0;

877 
	`DevInfo_SëP¨amëî
(
DEVINFO_SYSTEM_ID
, 
DEVINFO_SYSTEM_ID_LEN
, 
sy°emId
);

880 
g≠ProfûeSèã
 = 
√wSèã
;

881 
	}
}

894 
bSètus_t
 
	$Sís‹CB
(
uöt8
 
evít
, 
uöt32
 *
pNewCummVÆ
)

896 
bSètus_t
 
°©us
 = 
SUCCESS
;

898  
evít
 )

900 
RSC_CMD_SET_CUMM_VAL
:

902 i‡–
USING_NEGLECT_TIMEOUT
 )

904 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
 );

908 
tŸÆDi°™˚
 = *
pNewCummVÆ
;

911 i‡–
USING_NEGLECT_TIMEOUT
 )

913 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

917 
RSC_CMD_START_SENS_CALIB
:

918 i‡–
£ns‹Fœgs
[
£ns‹FœgsIdx
] !
RSC_FLAGS_AT_REST
 )

921 
°©us
 = 
FAILURE
;

925 
RSC_CMD_UPDATE_SENS_LOC
:

927 i‡–
USING_NEGLECT_TIMEOUT
 )

929 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
 );

933 
	`Ru¬ög_GëP¨amëî
–
RSC_SENS_LOC
, &
£ns‹Loˇti⁄
 );

936 i‡–
USING_NEGLECT_TIMEOUT
 )

938 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

942 
RSC_MEAS_NOTI_ENABLED
:

944 i‡–
USING_NEGLECT_TIMEOUT
 )

946 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
 );

950 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

952 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_PERIODIC_EVT
, 
DEFAULT_RSC_PERIOD
 );

956 
RSC_MEAS_NOTI_DISABLED
:

958 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
RSC_PERIODIC_EVT
 );

961 i‡–
USING_NEGLECT_TIMEOUT
 )

963 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

967 
RSC_READ_ATTR
:

968 
RSC_WRITE_ATTR
:

969 i‡–
USING_NEGLECT_TIMEOUT
 )

972 
	`oßl_°›_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
 );

975 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_NEGLECT_TIMEOUT_EVT
, 
NEGLECT_TIMEOUT_DELAY
 );

983  ( 
°©us
 );

984 
	}
}

995 
	$£ns‹PîiodicTask
( )

997 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

1000 
	`£ns‹MósNŸify
();

1003 
	`oßl_°¨t_timîEx
–
£ns‹_TaskID
, 
RSC_PERIODIC_EVT
, 
DEFAULT_RSC_PERIOD
 );

1005 
	}
}

	@Projects/ble/RunningSensor/Source/runningSensor.h

40 #i‚de‡
RUNNINGSENSOR_H


41 
	#RUNNINGSENSOR_H


	)

43 #ifde‡
__˝lu•lus


57 
	#START_DEVICE_EVT
 0x0001

	)

58 
	#RSC_PERIODIC_EVT
 0x0002

	)

59 
	#RSC_CONN_PARAM_UPDATE_EVT
 0x0004

	)

60 
	#RSC_NEGLECT_TIMEOUT_EVT
 0x0008

	)

61 
	#RSC_RESET_EVT
 0x0010

	)

74 
Ru¬ögSís‹_Inô
–
uöt8
 
èsk_id
 );

79 
uöt16
 
Ru¬ögSís‹_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

84 #ifde‡
__˝lu•lus


	@Projects/ble/RunningSensor/Source/runningSensor_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

69 
	$maö
()

72 
	`HAL_BOARD_INIT
();

75 
	`InôBﬂrd
–
OB_COLD
 );

78 
	`HÆDrivîInô
();

81 
	`oßl_¢v_öô
();

86 
	`oßl_öô_sy°em
();

89 
	`HAL_ENABLE_INTERRUPTS
();

92 
	`InôBﬂrd
–
OB_READY
 );

94 #i‡
	`deföed
 ( 
POWER_SAVING
 )

95 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

99 
	`oßl_°¨t_sy°em
();

102 
	}
}

	@Projects/ble/SensorTag/Source/OSAL_SensorTag.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

75 
	~"≥rùhîÆBrﬂdˇ°î.h
"

77 
	~"≥rùhîÆ.h
"

81 
	~"£ns‹Tag.h
"

88 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

90 
LL_Pro˚ssEvít
,

91 
HÆ_Pro˚ssEvít
,

92 
HCI_Pro˚ssEvít
,

93 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

94 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

96 
L2CAP_Pro˚ssEvít
,

97 
GAP_Pro˚ssEvít
,

98 
GATT_Pro˚ssEvít
,

99 
SM_Pro˚ssEvít
,

100 
GAPRﬁe_Pro˚ssEvít
,

101 
GAPB⁄dMgr_Pro˚ssEvít
,

102 
GATTSîvAµ_Pro˚ssEvít
,

103 
Sís‹Tag_Pro˚ssEvít


106 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

107 
uöt16
 *
	gèsksEvíts
;

122 
	$oßlInôTasks
( )

124 
uöt8
 
èskID
 = 0;

126 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

127 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

130 
	`LL_Inô
–
èskID
++ );

133 
	`HÆ_Inô
–
èskID
++ );

136 
	`HCI_Inô
–
èskID
++ );

138 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

140 
	`oßl_CbTimîInô
–
èskID
 );

141 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

145 
	`L2CAP_Inô
–
èskID
++ );

148 
	`GAP_Inô
–
èskID
++ );

151 
	`GATT_Inô
–
èskID
++ );

154 
	`SM_Inô
–
èskID
++ );

157 
	`GAPRﬁe_Inô
–
èskID
++ );

158 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

159 
	`GATTSîvAµ_Inô
–
èskID
++ );

162 
	`Sís‹Tag_Inô
–
èskID
 );

163 
	}
}

	@Projects/ble/SensorTag/Source/SensorTag.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_PwrMgr.h
"

48 
	~"OnBﬂrd.h
"

49 
	~"hÆ_adc.h
"

50 
	~"hÆ_Àd.h
"

51 
	~"hÆ_keys.h
"

52 
	~"hÆ_i2c.h
"

54 
	~"g©t.h
"

55 
	~"hci.h
"

57 
	~"g≠g©t£rvî.h
"

58 
	~"g©t£rv≠p.h
"

60 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

61 
	~"≥rùhîÆBrﬂdˇ°î.h
"

63 
	~"≥rùhîÆ.h
"

66 
	~"g≠b⁄dmgr.h
"

68 #i‡
deföed
 
FEATURE_OAD


69 
	~"ﬂd.h
"

70 
	~"ﬂd_èrgë.h
"

74 
	~"devöfo£rvi˚-°.h
"

75 
	~"úãmp£rvi˚.h
"

76 
	~"ac˚Àromëî£rvi˚.h
"

77 
	~"humidôy£rvi˚.h
"

78 
	~"mag√tomëî£rvi˚.h
"

79 
	~"b¨omëî£rvi˚.h
"

80 
	~"gyro£rvi˚.h
"

81 
	~"ã°£rvi˚.h
"

82 
	~"sim∂ekeys.h
"

85 
	~"£ns‹Tag.h
"

86 
	~"hÆ_£ns‹.h
"

88 
	~"hÆ_úãmp.h
"

89 
	~"hÆ_acc.h
"

90 
	~"hÆ_humi.h
"

91 
	~"hÆ_mag.h
"

92 
	~"hÆ_b¨.h
"

93 
	~"hÆ_gyro.h
"

104 
	#TEMP_DEFAULT_PERIOD
 1000

	)

105 
	#HUM_DEFAULT_PERIOD
 1000

	)

106 
	#BAR_DEFAULT_PERIOD
 1000

	)

107 
	#MAG_DEFAULT_PERIOD
 2000

	)

108 
	#ACC_DEFAULT_PERIOD
 1000

	)

109 
	#GYRO_DEFAULT_PERIOD
 1000

	)

112 
	#TEMP_MEAS_DELAY
 275

113 
	#BAR_FSM_PERIOD
 80

	)

114 
	#ACC_FSM_PERIOD
 20

	)

115 
	#HUM_FSM_PERIOD
 20

	)

116 
	#GYRO_STARTUP_TIME
 60

117 

	)

119 
	#DEFAULT_ADVERTISING_INTERVAL
 160

	)

122 
	#DEFAULT_DISCOVERABLE_MODE
 
GAP_ADTYPE_FLAGS_LIMITED


	)

125 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 80

	)

128 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 800

	)

131 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 0

	)

134 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

137 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
TRUE


	)

140 
	#DEFAULT_CONN_PAUSE_PERIPHERAL
 8

	)

143 
	#TI_COMPANY_ID
 0x000D

	)

145 
	#INVALID_CONNHANDLE
 0xFFFF

	)

148 
	#B_ADDR_STR_LEN
 15

	)

150 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

151 
	#ADV_IN_CONN_WAIT
 500

153 

	)

155 
	#SK_KEY_SIDE
 0x04

	)

158 
	#TEST_MODE_ENABLE
 0x80

	)

161 
	#ST_CFG_SENSOR_DISABLE
 0x00

	)

162 
	#ST_CFG_SENSOR_ENABLE
 0x01

	)

163 
	#ST_CFG_CALIBRATE
 0x02

	)

164 
	#ST_CFG_ERROR
 0xFF

	)

167 
	#ST_SYS_RESET_DELAY
 3000

	)

188 
uöt8
 
	g£ns‹Tag_TaskID
;

190 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

193 
uöt8
 
	gsˇnR•D©a
[] =

197 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

210 
GAP_ADTYPE_SLAVE_CONN_INTERVAL_RANGE
,

211 
LO_UINT16
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
 ),

212 
HI_UINT16
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
 ),

213 
LO_UINT16
–
DEFAULT_DESIRED_MAX_CONN_INTERVAL
 ),

214 
HI_UINT16
–
DEFAULT_DESIRED_MAX_CONN_INTERVAL
 ),

218 
GAP_ADTYPE_POWER_LEVEL
,

224 
uöt8
 
	gadvîtD©a
[] =

230 
GAP_ADTYPE_FLAGS
,

231 
DEFAULT_DISCOVERABLE_MODE
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

235 
uöt8
 
	g©tDevi˚Name
[] = "TI BLE Sensor Tag";

238 
boﬁ
 
	gúTempE«bÀd
 = 
FALSE
;

239 
boﬁ
 
	gmagE«bÀd
 = 
FALSE
;

240 
boﬁ
 
	gaccE«bÀd
 = 
FALSE
;

241 
boﬁ
 
	gb¨E«bÀd
 = 
FALSE
;

242 
boﬁ
 
	ghumiE«bÀd
 = 
FALSE
;

243 
boﬁ
 
	ggyroE«bÀd
 = 
FALSE
;

245 
boﬁ
 
	gb¨Busy
 = 
FALSE
;

246 
uöt8
 
	ghumiSèã
 = 0;

248 
boﬁ
 
	gsysRe£tReque°
 = 
FALSE
;

250 
uöt16
 
	g£ns‹MagPîiod
 = 
MAG_DEFAULT_PERIOD
;

251 
uöt16
 
	g£ns‹AccPîiod
 = 
ACC_DEFAULT_PERIOD
;

252 
uöt8
 
	g£ns‹GyroAxes
 = 0;

253 
boﬁ
 
	g£ns‹GyroUpd©eAxes
 = 
FALSE
;

254 
uöt16
 
	g£lfTe°Resu…
 = 0;

255 
boﬁ
 
	gã°Mode
 = 
FALSE
;

260 
£ns‹Tag_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

261 
≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

263 
ªadIrTempD©a
( );

264 
ªadHumD©a
( );

265 
ªadAccD©a
( );

266 
ªadMagD©a
( );

267 
ªadB¨D©a
( );

268 
ªadB¨CÆibøti⁄
( );

269 
ªadGyroD©a
( );

271 
b¨omëîCh™geCB
–
uöt8
 
∑ømID
 );

272 
úTempCh™geCB
–
uöt8
 
∑ømID
 );

273 
ac˚lCh™geCB
–
uöt8
 
∑ømID
 );

274 
humidôyCh™geCB
–
uöt8
 
∑ømID
);

275 
mag√tomëîCh™geCB
–
uöt8
 
∑ømID
 );

276 
gyroCh™geCB
–
uöt8
 
∑ømID
 );

277 
ã°Ch™geCB
–
uöt8
 
∑ømID
 );

279 
ª£tSís‹Sëup
( );

280 
£ns‹Tag_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

281 
ª£tCh¨a˘îi°icVÆue
(
uöt16
 
£rvID
, 
uöt8
 
∑ømID
, uöt8 
vÆue
, uöt8 
∑ømLí
);

282 
ª£tCh¨a˘îi°icVÆues
();

289 
g≠RﬁesCBs_t
 
	g£ns‹Tag_PîùhîÆCBs
 =

291 
≥rùhîÆSèãNŸifiˇti⁄CB
,

292 
NULL


296 
g≠B⁄dCBs_t
 
	g£ns‹Tag_B⁄dMgrCBs
 =

298 
NULL
,

299 
NULL


303 
b¨omëîCBs_t
 
	g£ns‹Tag_B¨omëîCBs
 =

305 
b¨omëîCh™geCB
,

308 
úTempCBs_t
 
	g£ns‹Tag_IrTempCBs
 =

310 
úTempCh™geCB
,

313 
ac˚lCBs_t
 
	g£ns‹Tag_Ac˚lCBs
 =

315 
ac˚lCh™geCB
,

318 
humidôyCBs_t
 
	g£ns‹Tag_HumidCBs
 =

320 
humidôyCh™geCB
,

323 
mag√tomëîCBs_t
 
	g£ns‹Tag_Mag√tomëîCBs
 =

325 
mag√tomëîCh™geCB
,

328 
gyroCBs_t
 
	g£ns‹Tag_GyroCBs
 =

330 
gyroCh™geCB
,

333 
ã°CBs_t
 
	g£ns‹Tag_Te°CBs
 =

335 
ã°Ch™geCB
,

357 
	$Sís‹Tag_Inô
–
uöt8
 
èsk_id
 )

359 
£ns‹Tag_TaskID
 = 
èsk_id
;

362 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_PAUSE_PERIPHERAL
, 
DEFAULT_CONN_PAUSE_PERIPHERAL
 );

367 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

372 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

373 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

374 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

375 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

376 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

377 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

380 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

381 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

383 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnR•D©a
 ), scanRspData );

384 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

386 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

387 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

388 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

389 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

390 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

394 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, (
©tDevi˚Name
),áttDeviceName );

398 
uöt16
 
advI¡
 = 
DEFAULT_ADVERTISING_INTERVAL
;

400 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
advI¡
 );

401 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
advI¡
 );

402 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
advI¡
 );

403 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
advI¡
 );

408 
uöt32
 
∑sskey
 = 0;

409 
uöt8
 
∑úMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

410 
uöt8
 
môm
 = 
TRUE
;

411 
uöt8
 
ioC≠
 = 
GAPBOND_IO_CAP_DISPLAY_ONLY
;

412 
uöt8
 
b⁄dög
 = 
TRUE
;

414 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
,  ( 
uöt32
 ), &
∑sskey
 );

415 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

416 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

417 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

418 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

423 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

424 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

425 
	`DevInfo_AddSîvi˚
();

426 
	`IRTemp_AddSîvi˚
 (
GATT_ALL_SERVICES
 );

427 
	`Ac˚l_AddSîvi˚
 (
GATT_ALL_SERVICES
 );

428 
	`Humidôy_AddSîvi˚
 (
GATT_ALL_SERVICES
 );

429 
	`Mag√tomëî_AddSîvi˚
–
GATT_ALL_SERVICES
 );

430 
	`B¨omëî_AddSîvi˚
–
GATT_ALL_SERVICES
 );

431 
	`Gyro_AddSîvi˚
–
GATT_ALL_SERVICES
 );

432 
	`SK_AddSîvi˚
–
GATT_ALL_SERVICES
 );

433 
	`Te°_AddSîvi˚
–
GATT_ALL_SERVICES
 );

435 #i‡
deföed
 
FEATURE_OAD


436 
VOID
 
	`OADT¨gë_AddSîvi˚
();

440 
	`ª£tCh¨a˘îi°icVÆues
();

443 
	`Regi°îF‹Keys
–
£ns‹Tag_TaskID
 );

446 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

449 
	`HALIRTempInô
();

450 
	`HÆHumiInô
();

451 
	`HÆMagInô
();

452 
	`HÆAccInô
();

453 
	`HÆB¨Inô
();

454 
	`HÆGyroInô
();

457 
VOID
 
	`IRTemp_Regi°îAµCBs
–&
£ns‹Tag_IrTempCBs
 );

458 
VOID
 
	`Mag√tomëî_Regi°îAµCBs
–&
£ns‹Tag_Mag√tomëîCBs
 );

459 
VOID
 
	`Ac˚l_Regi°îAµCBs
–&
£ns‹Tag_Ac˚lCBs
 );

460 
VOID
 
	`Humidôy_Regi°îAµCBs
–&
£ns‹Tag_HumidCBs
 );

461 
VOID
 
	`B¨omëî_Regi°îAµCBs
–&
£ns‹Tag_B¨omëîCBs
 );

462 
VOID
 
	`Gyro_Regi°îAµCBs
–&
£ns‹Tag_GyroCBs
 );

463 
VOID
 
	`Te°_Regi°îAµCBs
–&
£ns‹Tag_Te°CBs
 );

468 
	`HCI_EXT_ClkDivOnHÆtCmd
–
HCI_EXT_ENABLE_CLK_DIVIDE_ON_HALT
 );

471 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_START_DEVICE_EVT
 );

472 
	}
}

487 
uöt16
 
	$Sís‹Tag_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

489 
VOID
 
èsk_id
;

491 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

493 
uöt8
 *
pMsg
;

495 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
£ns‹Tag_TaskID
 )Ë!
NULL
 )

497 
	`£ns‹Tag_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

500 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

504  (
evíts
 ^ 
SYS_EVENT_MSG
);

508 i‡–
evíts
 & 
ST_SYS_RESET_EVT
 )

510 i‡(
sysRe£tReque°
)

512 
	`HAL_SYSTEM_RESET
();

514  ( 
evíts
 ^ 
ST_SYS_RESET_EVT
 );

517 i‡–
evíts
 & 
ST_START_DEVICE_EVT
 )

520 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
£ns‹Tag_PîùhîÆCBs
 );

523 
VOID
 
	`GAPB⁄dMgr_Regi°î
–&
£ns‹Tag_B⁄dMgrCBs
 );

525  ( 
evíts
 ^ 
ST_START_DEVICE_EVT
 );

531 i‡–
evíts
 & 
ST_IRTEMPERATURE_READ_EVT
 )

533 i‡–
úTempE«bÀd
 )

535 i‡(
	`HÆIRTempSètus
(Ë=
TMP006_DATA_READY
)

537 
	`ªadIrTempD©a
();

538 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_IRTEMPERATURE_READ_EVT
, 
TEMP_DEFAULT_PERIOD
-
TEMP_MEAS_DELAY
 );

540 i‡(
	`HÆIRTempSètus
(Ë=
TMP006_OFF
)

542 
	`HÆIRTempTu∫On
();

543 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_IRTEMPERATURE_READ_EVT
, 
TEMP_MEAS_DELAY
 );

549 
VOID
 
	`HÆIRTempTu∫Off
();

550 
VOID
 
	`ª£tCh¨a˘îi°icVÆue
(
IRTEMPERATURE_SERV_UUID
,
IRTEMPERATURE_DATA
,0,
IRTEMPERATURE_DATA_LEN
);

551 
VOID
 
	`ª£tCh¨a˘îi°icVÆue
(
IRTEMPERATURE_SERV_UUID
,
IRTEMPERATURE_CONF
,
ST_CFG_SENSOR_DISABLE
, ( 
uöt8
 ));

554  (
evíts
 ^ 
ST_IRTEMPERATURE_READ_EVT
);

560 i‡–
evíts
 & 
ST_ACCELEROMETER_SENSOR_EVT
 )

562 if(
accE«bÀd
)

564 
	`ªadAccD©a
();

565 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_ACCELEROMETER_SENSOR_EVT
, 
£ns‹AccPîiod
 );

569 
VOID
 
	`ª£tCh¨a˘îi°icVÆue
–
ACCELEROMETER_SERV_UUID
, 
ACCELEROMETER_DATA
, 0, 
ACCELEROMETER_DATA_LEN
 );

570 
VOID
 
	`ª£tCh¨a˘îi°icVÆue
–
ACCELEROMETER_SERV_UUID
, 
ACCELEROMETER_CONF
, 
ST_CFG_SENSOR_DISABLE
,  ( 
uöt8
 ));

571 
VOID
 
	`ª£tCh¨a˘îi°icVÆue
–
ACCELEROMETER_SERV_UUID
, 
ACCELEROMETER_PERI
, 
ACC_DEFAULT_PERIOD
/
ACCELEROMETER_TIME_UNIT
,  ( 
uöt8
 ));

574  (
evíts
 ^ 
ST_ACCELEROMETER_SENSOR_EVT
);

580 i‡–
evíts
 & 
ST_HUMIDITY_SENSOR_EVT
 )

582 i‡(
humiE«bÀd
)

584 
	`HÆHumiExecMósuªmítSãp
(
humiSèã
);

585 i‡(
humiSèã
 == 2)

587 
	`ªadHumD©a
();

588 
humiSèã
 = 0;

589 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_HUMIDITY_SENSOR_EVT
, 
HUM_DEFAULT_PERIOD
 );

593 
humiSèã
++;

594 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_HUMIDITY_SENSOR_EVT
, 
HUM_FSM_PERIOD
 );

599 
	`ª£tCh¨a˘îi°icVÆue
–
HUMIDITY_SERV_UUID
, 
HUMIDITY_DATA
, 0, 
HUMIDITY_DATA_LEN
);

600 
	`ª£tCh¨a˘îi°icVÆue
–
HUMIDITY_SERV_UUID
, 
HUMIDITY_CONF
, 
ST_CFG_SENSOR_DISABLE
,  ( 
uöt8
 ));

603  (
evíts
 ^ 
ST_HUMIDITY_SENSOR_EVT
);

609 i‡–
evíts
 & 
ST_MAGNETOMETER_SENSOR_EVT
 )

611 if(
magE«bÀd
)

613 i‡(
	`HÆMagSètus
(Ë=
MAG3110_DATA_READY
)

615 
	`ªadMagD©a
();

617 i‡(
	`HÆMagSètus
(Ë=
MAG3110_OFF
)

619 
	`HÆMagTu∫On
();

622 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_MAGNETOMETER_SENSOR_EVT
, 
£ns‹MagPîiod
 );

626 
	`HÆMagTu∫Off
();

627 
	`ª£tCh¨a˘îi°icVÆue
–
MAGNETOMETER_SERV_UUID
, 
MAGNETOMETER_DATA
, 0, 
MAGNETOMETER_DATA_LEN
);

628 
	`ª£tCh¨a˘îi°icVÆue
–
MAGNETOMETER_SERV_UUID
, 
MAGNETOMETER_CONF
, 
ST_CFG_SENSOR_DISABLE
,  ( 
uöt8
 ));

629 
	`ª£tCh¨a˘îi°icVÆue
–
MAGNETOMETER_SERV_UUID
, 
MAGNETOMETER_PERI
, 
MAG_DEFAULT_PERIOD
/
MAGNETOMETER_TIME_UNIT
,

630  ( 
uöt8
 ));

633  (
evíts
 ^ 
ST_MAGNETOMETER_SENSOR_EVT
);

639 i‡–
evíts
 & 
ST_BAROMETER_SENSOR_EVT
 )

641 i‡(
b¨E«bÀd
)

643 i‡(
b¨Busy
)

645 
b¨Busy
 = 
FALSE
;

646 
	`ªadB¨D©a
();

647 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_BAROMETER_SENSOR_EVT
, 
BAR_DEFAULT_PERIOD
 );

651 
b¨Busy
 = 
TRUE
;

652 
	`HÆB¨SèπMósuªmít
();

653 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_BAROMETER_SENSOR_EVT
, 
BAR_FSM_PERIOD
 );

658 
	`ª£tCh¨a˘îi°icVÆue
–
BAROMETER_SERV_UUID
, 
BAROMETER_DATA
, 0, 
BAROMETER_DATA_LEN
);

659 
	`ª£tCh¨a˘îi°icVÆue
–
BAROMETER_SERV_UUID
, 
BAROMETER_CONF
, 
ST_CFG_SENSOR_DISABLE
,  ( 
uöt8
 ));

660 
	`ª£tCh¨a˘îi°icVÆue
–
BAROMETER_SERV_UUID
, 
BAROMETER_CALI
, 0, 
BAROMETER_CALI_LEN
);

663  (
evíts
 ^ 
ST_BAROMETER_SENSOR_EVT
);

669 i‡–
evíts
 & 
ST_GYROSCOPE_SENSOR_EVT
 )

671 
uöt8
 
°©us
;

673 
°©us
 = 
	`HÆGyroSètus
();

675 if(
gyroE«bÀd
)

677 i‡(
°©us
 =
HAL_GYRO_STOPPED
)

679 
	`HÆGyroSñe˘Axes
(
£ns‹GyroAxes
);

680 
	`HÆGyroTu∫On
();

681 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_GYROSCOPE_SENSOR_EVT
, 
GYRO_STARTUP_TIME
);

685 if(
£ns‹GyroUpd©eAxes
)

687 
	`HÆGyroSñe˘Axes
(
£ns‹GyroAxes
);

688 
£ns‹GyroUpd©eAxes
 = 
FALSE
;

691 i‡(
°©us
 =
HAL_GYRO_DATA_READY
)

693 
	`ªadGyroD©a
();

694 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_GYROSCOPE_SENSOR_EVT
, 
GYRO_DEFAULT_PERIOD
 - 
GYRO_STARTUP_TIME
);

699 
	`HÆGyroWakeUp
();

700 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_GYROSCOPE_SENSOR_EVT
, 
GYRO_STARTUP_TIME
);

706 
	`HÆGyroTu∫Off
();

707 i‡–
°©us
 =
HAL_GYRO_STOPPED
)

709 
	`ª£tCh¨a˘îi°icVÆue
–
GYROSCOPE_SERV_UUID
, 
GYROSCOPE_DATA
, 0, 
GYROSCOPE_DATA_LEN
);

710 
	`ª£tCh¨a˘îi°icVÆue
–
GYROSCOPE_SERV_UUID
, 
GYROSCOPE_CONF
, 
ST_CFG_SENSOR_DISABLE
, –
uöt8
 ));

715 
	`ª£tCh¨a˘îi°icVÆue
–
GYROSCOPE_SERV_UUID
, 
GYROSCOPE_DATA
, 
ST_CFG_ERROR
, 
GYROSCOPE_DATA_LEN
);

716 
	`ª£tCh¨a˘îi°icVÆue
–
GYROSCOPE_SERV_UUID
, 
GYROSCOPE_CONF
, 
ST_CFG_ERROR
, –
uöt8
 ));

720  (
evíts
 ^ 
ST_GYROSCOPE_SENSOR_EVT
);

723 #i‡
	`deföed
 ( 
PLUS_BROADCASTER
 )

724 i‡–
evíts
 & 
ST_ADV_IN_CONNECTION_EVT
 )

726 
uöt8
 
tu∫OnAdv
 = 
TRUE
;

728 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
tu∫OnAdv
 );

730  (
evíts
 ^ 
ST_ADV_IN_CONNECTION_EVT
);

736 
	}
}

747 
uöt16
 
	$£ns‹Tag_ã°
()

749 
£lfTe°Resu…
 = 
	`HÆSís‹Te°
();

750 
	`HÆLedSë
(
HAL_LED_2
,
HAL_LED_MODE_OFF
);

753 
	`Te°_SëP¨amëî
–
TEST_DATA_ATTR
, 
TEST_DATA_LEN
, &
£lfTe°Resu…
);

755  
£lfTe°Resu…
;

756 
	}
}

772 
	$£ns‹Tag_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

774  
pMsg
->
evít
 )

776 
KEY_CHANGE
:

777 
	`£ns‹Tag_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

784 
	}
}

798 
	$£ns‹Tag_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

800 
uöt8
 
SK_Keys
 = 0;

801 
VOID
 
shi·
;

803 i‡(
keys
 & 
HAL_KEY_SW_1
)

806 
sysRe£tReque°
 = 
TRUE
;

807 
	`oßl_°¨t_timîEx
–
£ns‹Tag_TaskID
, 
ST_SYS_RESET_EVT
, 
ST_SYS_RESET_DELAY
 );

809 i‡(!
ã°Mode
 )

813 i‡–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

815 
uöt8
 
cuºít_adv_íabÀd_°©us
;

816 
uöt8
 
√w_adv_íabÀd_°©us
;

819 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
cuºít_adv_íabÀd_°©us
 );

821 if–
cuºít_adv_íabÀd_°©us
 =
FALSE
 )

823 
√w_adv_íabÀd_°©us
 = 
TRUE
;

827 
√w_adv_íabÀd_°©us
 = 
FALSE
;

831 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
√w_adv_íabÀd_°©us
 );

834 i‡–
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 )

836 
uöt8
 
adv_íabÀd
 = 
TRUE
;

839 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

841 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
adv_íabÀd
 );

847 i‡–
keys
 & 
HAL_KEY_SW_1
 )

849 
SK_Keys
 |
SK_KEY_SIDE
;

854 i‡–
keys
 & 
HAL_KEY_SW_2
 )

856 
SK_Keys
 |
SK_KEY_LEFT
;

859 i‡–
keys
 & 
HAL_KEY_SW_3
 )

861 
SK_Keys
 |
SK_KEY_RIGHT
;

864 i‡(!(
keys
 & 
HAL_KEY_SW_1
))

867 
sysRe£tReque°
 = 
FALSE
;

872 
	`SK_SëP¨amëî
–
SK_KEY_ATTR
,  ( 
uöt8
 ), &
SK_Keys
 );

873 
	}
}

885 
	$ª£tSís‹Sëup
 ()

887 i‡(
	`HÆIRTempSètus
()!=
TMP006_OFF
 || 
úTempE«bÀd
)

889 
	`HÆIRTempTu∫Off
();

890 
úTempE«bÀd
 = 
FALSE
;

893 i‡(
accE«bÀd
)

895 
accE«bÀd
 = 
FALSE
;

898 i‡(
	`HÆMagSètus
()!=
MAG3110_OFF
 || 
magE«bÀd
)

900 
	`HÆMagTu∫Off
();

901 
magE«bÀd
 = 
FALSE
;

904 i‡(
gyroE«bÀd
)

906 
	`HÆGyroTu∫Off
();

907 
gyroE«bÀd
 = 
FALSE
;

910 i‡(
b¨E«bÀd
)

912 
	`HÆB¨Inô
();

913 
b¨E«bÀd
 = 
FALSE
;

916 i‡(
humiE«bÀd
)

918 
	`HÆHumiInô
();

919 
humiE«bÀd
 = 
FALSE
;

923 
£ns‹MagPîiod
 = 
MAG_DEFAULT_PERIOD
;

924 
£ns‹AccPîiod
 = 
ACC_DEFAULT_PERIOD
;

925 
£ns‹GyroAxes
 = 0;

926 
£ns‹GyroUpd©eAxes
 = 
FALSE
;

927 
ã°Mode
 = 
FALSE
;

930 
	`ª£tCh¨a˘îi°icVÆues
();

931 
	}
}

943 
	$≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

945  
√wSèã
 )

947 
GAPROLE_STARTED
:

949 
uöt8
 
ownAddªss
[
B_ADDR_LEN
];

950 
uöt8
 
sy°emId
[
DEVINFO_SYSTEM_ID_LEN
];

952 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
ownAddªss
);

955 
sy°emId
[0] = 
ownAddªss
[0];

956 
sy°emId
[1] = 
ownAddªss
[1];

957 
sy°emId
[2] = 
ownAddªss
[2];

960 
sy°emId
[4] = 0x00;

961 
sy°emId
[3] = 0x00;

964 
sy°emId
[7] = 
ownAddªss
[5];

965 
sy°emId
[6] = 
ownAddªss
[4];

966 
sy°emId
[5] = 
ownAddªss
[3];

968 
	`DevInfo_SëP¨amëî
(
DEVINFO_SYSTEM_ID
, 
DEVINFO_SYSTEM_ID_LEN
, 
sy°emId
);

972 
GAPROLE_ADVERTISING
:

973 
	`HÆLedSë
(
HAL_LED_1
, 
HAL_LED_MODE_ON
 );

976 
GAPROLE_CONNECTED
:

978 
	`HÆLedSë
(
HAL_LED_1
, 
HAL_LED_MODE_OFF
 );

981 
GAPROLE_WAITING
:

983 
	`ª£tSís‹Sëup
();

990 
g≠ProfûeSèã
 = 
√wSèã
;

991 
	}
}

1002 
	$ªadAccD©a
()

1004 
uöt8
 
aD©a
[
ACCELEROMETER_DATA_LEN
];

1006 i‡(
	`HÆAccRód
(
aD©a
))

1008 
	`Ac˚l_SëP¨amëî
–
ACCELEROMETER_DATA
, 
ACCELEROMETER_DATA_LEN
, 
aD©a
);

1010 
	}
}

1021 
	$ªadMagD©a
( )

1023 
uöt8
 
mD©a
[
MAGNETOMETER_DATA_LEN
];

1025 i‡(
	`HÆMagRód
(
mD©a
))

1027 
	`Mag√tomëî_SëP¨amëî
(
MAGNETOMETER_DATA
, 
MAGNETOMETER_DATA_LEN
, 
mD©a
);

1029 
	}
}

1040 
	$ªadHumD©a
()

1042 
uöt8
 
hD©a
[
HUMIDITY_DATA_LEN
];

1044 i‡(
	`HÆHumiRódMósuªmít
(
hD©a
))

1046 
	`Humidôy_SëP¨amëî
–
HUMIDITY_DATA
, 
HUMIDITY_DATA_LEN
, 
hD©a
);

1048 
	}
}

1059 
	$ªadB¨D©a
( )

1061 
uöt8
 
bD©a
[
BAROMETER_DATA_LEN
];

1063 i‡(
	`HÆB¨RódMósuªmít
(
bD©a
))

1065 
	`B¨omëî_SëP¨amëî
–
BAROMETER_DATA
, 
BAROMETER_DATA_LEN
, 
bD©a
);

1067 
	}
}

1078 
	$ªadB¨CÆibøti⁄
( )

1080 
uöt8
* 
cD©a
 = 
	`oßl_mem_Æloc
(
BAROMETER_CALI_LEN
);

1082 i‡(
cD©a
 !
NULL
 )

1084 
	`HÆB¨RódCÆibøti⁄
(
cD©a
);

1085 
	`B¨omëî_SëP¨amëî
–
BAROMETER_CALI
, 
BAROMETER_CALI_LEN
, 
cD©a
);

1086 
	`oßl_mem_‰ì
(
cD©a
);

1088 
	}
}

1099 
	$ªadIrTempD©a
( )

1101 
uöt8
 
tD©a
[
IRTEMPERATURE_DATA_LEN
];

1103 i‡(
	`HÆIRTempRód
(
tD©a
))

1105 
	`IRTemp_SëP¨amëî
–
IRTEMPERATURE_DATA
, 
IRTEMPERATURE_DATA_LEN
, 
tD©a
);

1107 
	}
}

1118 
	$ªadGyroD©a
( )

1120 
uöt8
 
gD©a
[
GYROSCOPE_DATA_LEN
];

1122 i‡(
	`HÆGyroRód
(
gD©a
))

1124 
	`Gyro_SëP¨amëî
–
GYROSCOPE_DATA
, 
GYROSCOPE_DATA_LEN
, 
gD©a
);

1126 
	}
}

1137 
	$b¨omëîCh™geCB
–
uöt8
 
∑ømID
 )

1139 
uöt8
 
√wVÆue
;

1141  
∑ømID
 )

1143 
BAROMETER_CONF
:

1144 
	`B¨omëî_GëP¨amëî
–
BAROMETER_CONF
, &
√wVÆue
 );

1146  
√wVÆue
)

1148 
ST_CFG_SENSOR_DISABLE
:

1149 i‡(
b¨E«bÀd
)

1151 
b¨E«bÀd
 = 
FALSE
;

1152 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_BAROMETER_SENSOR_EVT
);

1156 
ST_CFG_SENSOR_ENABLE
:

1157 if(!
b¨E«bÀd
)

1159 
b¨E«bÀd
 = 
TRUE
;

1160 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_BAROMETER_SENSOR_EVT
);

1164 
ST_CFG_CALIBRATE
:

1165 
	`ªadB¨CÆibøti⁄
();

1177 
	}
}

1188 
	$úTempCh™geCB
–
uöt8
 
∑ømID
 )

1190 i‡–
∑ømID
 =
IRTEMPERATURE_CONF
)

1192 
uöt8
 
√wVÆue
;

1194 
	`IRTemp_GëP¨amëî
–
IRTEMPERATURE_CONF
, &
√wVÆue
 );

1196 i‡–
√wVÆue
 =
ST_CFG_SENSOR_DISABLE
)

1199 i‡(
úTempE«bÀd
)

1201 
úTempE«bÀd
 = 
FALSE
;

1202 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_IRTEMPERATURE_READ_EVT
);

1205 i‡(
√wVÆue
 =
ST_CFG_SENSOR_ENABLE
)

1207 i‡(!
úTempE«bÀd
)

1209 
úTempE«bÀd
 = 
TRUE
;

1210 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
,
ST_IRTEMPERATURE_READ_EVT
);

1214 
	}
}

1225 
	$ac˚lCh™geCB
–
uöt8
 
∑ømID
 )

1227 
uöt8
 
√wVÆue
;

1229 
∑ømID
)

1231 
ACCELEROMETER_CONF
:

1232 
	`Ac˚l_GëP¨amëî
–
ACCELEROMETER_CONF
, &
√wVÆue
 );

1233 i‡–
√wVÆue
 =
ST_CFG_SENSOR_DISABLE
)

1236 i‡(
accE«bÀd
)

1238 
accE«bÀd
 = 
FALSE
;

1239 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_ACCELEROMETER_SENSOR_EVT
);

1242 i‡–
√wVÆue
 =
ST_CFG_SENSOR_ENABLE
)

1244 i‡(!
accE«bÀd
)

1246 
accE«bÀd
 = 
TRUE
;

1247 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_ACCELEROMETER_SENSOR_EVT
);

1252 
ACCELEROMETER_PERI
:

1253 
	`Ac˚l_GëP¨amëî
–
ACCELEROMETER_PERI
, &
√wVÆue
 );

1254 
£ns‹AccPîiod
 = 
√wVÆue
*
ACCELEROMETER_TIME_UNIT
;

1261 
	}
}

1272 
	$mag√tomëîCh™geCB
–
uöt8
 
∑ømID
 )

1274 
uöt8
 
√wVÆue
;

1276 
∑ømID
)

1278 
MAGNETOMETER_CONF
:

1279 
	`Mag√tomëî_GëP¨amëî
–
MAGNETOMETER_CONF
, &
√wVÆue
 );

1281 i‡–
√wVÆue
 =
ST_CFG_SENSOR_DISABLE
 )

1283 if(
magE«bÀd
)

1285 
magE«bÀd
 = 
FALSE
;

1286 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_MAGNETOMETER_SENSOR_EVT
);

1289 i‡–
√wVÆue
 =
ST_CFG_SENSOR_ENABLE
 )

1291 if(!
magE«bÀd
)

1293 
magE«bÀd
 = 
TRUE
;

1294 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_MAGNETOMETER_SENSOR_EVT
);

1299 
MAGNETOMETER_PERI
:

1300 
	`Mag√tomëî_GëP¨amëî
–
MAGNETOMETER_PERI
, &
√wVÆue
 );

1301 
£ns‹MagPîiod
 = 
√wVÆue
*
MAGNETOMETER_TIME_UNIT
;

1308 
	}
}

1319 
	$humidôyCh™geCB
–
uöt8
 
∑ømID
 )

1321 i‡–
∑ømID
 =
HUMIDITY_CONF
)

1323 
uöt8
 
√wVÆue
;

1325 
	`Humidôy_GëP¨amëî
–
HUMIDITY_CONF
, &
√wVÆue
 );

1327 i‡–
√wVÆue
 =
ST_CFG_SENSOR_DISABLE
)

1329 i‡(
humiE«bÀd
)

1331 
humiE«bÀd
 = 
FALSE
;

1332 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_HUMIDITY_SENSOR_EVT
);

1336 i‡–
√wVÆue
 =
ST_CFG_SENSOR_ENABLE
 )

1338 i‡(!
humiE«bÀd
)

1340 
humiE«bÀd
 = 
TRUE
;

1341 
humiSèã
 = 0;

1342 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_HUMIDITY_SENSOR_EVT
);

1346 
	}
}

1357 
	$gyroCh™geCB
–
uöt8
 
∑ømID
 )

1359 i‡(
∑ømID
 =
GYROSCOPE_CONF
)

1361 
uöt8
 
√wVÆue
;

1363 
	`Gyro_GëP¨amëî
–
GYROSCOPE_CONF
, &
√wVÆue
 );

1365 i‡(
√wVÆue
 == 0)

1368 i‡(
gyroE«bÀd
)

1370 
gyroE«bÀd
 = 
FALSE
;

1371 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_GYROSCOPE_SENSOR_EVT
);

1377 
gyroE«bÀd
 = 
TRUE
;

1378 
£ns‹GyroAxes
 = 
√wVÆue
 & 0x07;

1379 
£ns‹GyroUpd©eAxes
 = 
TRUE
;

1380 
	`oßl_£t_evít
–
£ns‹Tag_TaskID
, 
ST_GYROSCOPE_SENSOR_EVT
);

1383 
	}
}

1394 
	$ã°Ch™geCB
–
uöt8
 
∑ømID
 )

1396 if–
∑ømID
 =
TEST_CONF_ATTR
 )

1398 
uöt8
 
√wVÆue
;

1400 
	`Te°_GëP¨amëî
–
TEST_CONF_ATTR
, &
√wVÆue
 );

1402 i‡(
√wVÆue
 & 
TEST_MODE_ENABLE
)

1404 
ã°Mode
 = 
TRUE
;

1408 
ã°Mode
 = 
FALSE
;

1411 i‡(
ã°Mode
)

1415 i‡(
√wVÆue
 & 0x01)

1417 
	`HÆLedSë
(
HAL_LED_1
,
HAL_LED_MODE_ON
);

1421 
	`HÆLedSë
(
HAL_LED_1
,
HAL_LED_MODE_OFF
);

1424 i‡(
√wVÆue
 & 0x02)

1426 
	`HÆLedSë
(
HAL_LED_2
,
HAL_LED_MODE_ON
);

1430 
	`HÆLedSë
(
HAL_LED_2
,
HAL_LED_MODE_OFF
);

1436 
	`HÆLedSë
(
HAL_LED_1
,
HAL_LED_MODE_OFF
);

1437 
	`HÆLedSë
(
HAL_LED_2
,
HAL_LED_MODE_OFF
);

1438 
√wVÆue
 = 0x00;

1439 
	`Te°_SëP¨amëî
–
TEST_CONF_ATTR
, 1, &
√wVÆue
 );

1442 
	}
}

1460 
	$ª£tCh¨a˘îi°icVÆue
(
uöt16
 
£rvUuid
, 
uöt8
 
∑ømID
, uöt8 
vÆue
, uöt8 
∑ømLí
)

1462 
uöt8
* 
pD©a
 = 
	`oßl_mem_Æloc
(
∑ømLí
);

1464 i‡(
pD©a
 =
NULL
)

1469 
	`oßl_mem£t
(
pD©a
,
vÆue
,
∑ømLí
);

1471 
£rvUuid
)

1473 
IRTEMPERATURE_SERV_UUID
:

1474 
	`IRTemp_SëP¨amëî
–
∑ømID
, 
∑ømLí
, 
pD©a
);

1477 
ACCELEROMETER_SERV_UUID
:

1478 
	`Ac˚l_SëP¨amëî
–
∑ømID
, 
∑ømLí
, 
pD©a
);

1481 
MAGNETOMETER_SERV_UUID
:

1482 
	`Mag√tomëî_SëP¨amëî
–
∑ømID
, 
∑ømLí
, 
pD©a
);

1485 
HUMIDITY_SERV_UUID
:

1486 
	`Humidôy_SëP¨amëî
–
∑ømID
, 
∑ømLí
, 
pD©a
);

1489 
BAROMETER_SERV_UUID
:

1490 
	`B¨omëî_SëP¨amëî
–
∑ømID
, 
∑ømLí
, 
pD©a
);

1493 
GYROSCOPE_SERV_UUID
:

1494 
	`Gyro_SëP¨amëî
–
∑ømID
, 
∑ømLí
, 
pD©a
);

1502 
	`oßl_mem_‰ì
(
pD©a
);

1503 
	}
}

1512 
	$ª£tCh¨a˘îi°icVÆues
( )

1514 
	`ª£tCh¨a˘îi°icVÆue
–
IRTEMPERATURE_SERV_UUID
, 
IRTEMPERATURE_DATA
,0,
IRTEMPERATURE_DATA_LEN
);

1515 
	`ª£tCh¨a˘îi°icVÆue
–
IRTEMPERATURE_SERV_UUID
, 
IRTEMPERATURE_CONF
,
ST_CFG_SENSOR_DISABLE
, ( 
uöt8
 ));

1517 
	`ª£tCh¨a˘îi°icVÆue
–
ACCELEROMETER_SERV_UUID
, 
ACCELEROMETER_DATA
, 0, 
ACCELEROMETER_DATA_LEN
 );

1518 
	`ª£tCh¨a˘îi°icVÆue
–
ACCELEROMETER_SERV_UUID
, 
ACCELEROMETER_CONF
, 
ST_CFG_SENSOR_DISABLE
,  ( 
uöt8
 ));

1519 
	`ª£tCh¨a˘îi°icVÆue
–
ACCELEROMETER_SERV_UUID
, 
ACCELEROMETER_PERI
, 
ACC_DEFAULT_PERIOD
/
ACCELEROMETER_TIME_UNIT
,  ( 
uöt8
 ));

1521 
	`ª£tCh¨a˘îi°icVÆue
–
HUMIDITY_SERV_UUID
, 
HUMIDITY_DATA
, 0, 
HUMIDITY_DATA_LEN
);

1522 
	`ª£tCh¨a˘îi°icVÆue
–
HUMIDITY_SERV_UUID
, 
HUMIDITY_CONF
, 
ST_CFG_SENSOR_DISABLE
,  ( 
uöt8
 ));

1524 
	`ª£tCh¨a˘îi°icVÆue
–
MAGNETOMETER_SERV_UUID
, 
MAGNETOMETER_DATA
, 0, 
MAGNETOMETER_DATA_LEN
);

1525 
	`ª£tCh¨a˘îi°icVÆue
–
MAGNETOMETER_SERV_UUID
, 
MAGNETOMETER_CONF
, 
ST_CFG_SENSOR_DISABLE
,  ( 
uöt8
 ));

1526 
	`ª£tCh¨a˘îi°icVÆue
–
MAGNETOMETER_SERV_UUID
, 
MAGNETOMETER_PERI
, 
MAG_DEFAULT_PERIOD
/
MAGNETOMETER_TIME_UNIT
,  ( 
uöt8
 ));

1528 
	`ª£tCh¨a˘îi°icVÆue
–
BAROMETER_SERV_UUID
, 
BAROMETER_DATA
, 0, 
BAROMETER_DATA_LEN
);

1529 
	`ª£tCh¨a˘îi°icVÆue
–
BAROMETER_SERV_UUID
, 
BAROMETER_CONF
, 
ST_CFG_SENSOR_DISABLE
,  ( 
uöt8
 ));

1530 
	`ª£tCh¨a˘îi°icVÆue
–
BAROMETER_SERV_UUID
, 
BAROMETER_CALI
, 0, 
BAROMETER_CALI_LEN
);

1532 
	`ª£tCh¨a˘îi°icVÆue
–
GYROSCOPE_SERV_UUID
, 
GYROSCOPE_DATA
, 0, 
GYROSCOPE_DATA_LEN
);

1533 
	`ª£tCh¨a˘îi°icVÆue
–
GYROSCOPE_SERV_UUID
, 
GYROSCOPE_CONF
, 
ST_CFG_SENSOR_DISABLE
, –
uöt8
 ));

1534 
	}
}

	@Projects/ble/SensorTag/Source/SensorTag_Main.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"hÆ_key.h
"

46 
	~"hÆ_timî.h
"

47 
	~"hÆ_drivîs.h
"

48 
	~"hÆ_Àd.h
"

49 
	~"hÆ_as£π.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

59 
	~"Sís‹Tag.h
"

75 
	$maö
()

78 
	`HAL_BOARD_INIT
();

81 
	`InôBﬂrd
–
OB_COLD
 );

84 
	`HÆDrivîInô
();

87 
	`oßl_¢v_öô
();

90 
	`oßl_öô_sy°em
();

93 
	`HAL_ENABLE_INTERRUPTS
();

96 
	`InôBﬂrd
–
OB_READY
 );

98 #i‡
	`deföed
 ( 
POWER_SAVING
 )

99 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

103 
	`£ns‹Tag_ã°
();

106 
	`oßl_°¨t_sy°em
();

109 
	}
}

	@Projects/ble/SensorTag/Source/devinfoservice-st.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"lökdb.h
"

47 
	~"©t.h
"

48 
	~"g©t.h
"

49 
	~"g©t_uuid.h
"

50 
	~"g©t£rv≠p.h
"

52 
	~"devöfo£rvi˚-°.h
"

70 
CONST
 
uöt8
 
	gdevInfoSîvUUID
[
ATT_BT_UUID_SIZE
] =

72 
LO_UINT16
(
DEVINFO_SERV_UUID
), 
HI_UINT16
(DEVINFO_SERV_UUID)

76 
CONST
 
uöt8
 
	gdevInfoSy°emIdUUID
[
ATT_BT_UUID_SIZE
] =

78 
LO_UINT16
(
DEVINFO_SYSTEM_ID_UUID
), 
HI_UINT16
(DEVINFO_SYSTEM_ID_UUID)

82 
CONST
 
uöt8
 
	gdevInfoModñNumbîUUID
[
ATT_BT_UUID_SIZE
] =

84 
LO_UINT16
(
DEVINFO_MODEL_NUMBER_UUID
), 
HI_UINT16
(DEVINFO_MODEL_NUMBER_UUID)

88 
CONST
 
uöt8
 
	gdevInfoSîülNumbîUUID
[
ATT_BT_UUID_SIZE
] =

90 
LO_UINT16
(
DEVINFO_SERIAL_NUMBER_UUID
), 
HI_UINT16
(DEVINFO_SERIAL_NUMBER_UUID)

94 
CONST
 
uöt8
 
	gdevInfoFúmw¨eRevUUID
[
ATT_BT_UUID_SIZE
] =

96 
LO_UINT16
(
DEVINFO_FIRMWARE_REV_UUID
), 
HI_UINT16
(DEVINFO_FIRMWARE_REV_UUID)

100 
CONST
 
uöt8
 
	gdevInfoH¨dw¨eRevUUID
[
ATT_BT_UUID_SIZE
] =

102 
LO_UINT16
(
DEVINFO_HARDWARE_REV_UUID
), 
HI_UINT16
(DEVINFO_HARDWARE_REV_UUID)

106 
CONST
 
uöt8
 
	gdevInfoSo·w¨eRevUUID
[
ATT_BT_UUID_SIZE
] =

108 
LO_UINT16
(
DEVINFO_SOFTWARE_REV_UUID
), 
HI_UINT16
(DEVINFO_SOFTWARE_REV_UUID)

112 
CONST
 
uöt8
 
	gdevInfoM‰NameUUID
[
ATT_BT_UUID_SIZE
] =

114 
LO_UINT16
(
DEVINFO_MANUFACTURER_NAME_UUID
), 
HI_UINT16
(DEVINFO_MANUFACTURER_NAME_UUID)

118 
CONST
 
uöt8
 
	gdevInfo11073CîtUUID
[
ATT_BT_UUID_SIZE
] =

120 
LO_UINT16
(
DEVINFO_11073_CERT_DATA_UUID
), 
HI_UINT16
(DEVINFO_11073_CERT_DATA_UUID)

124 
CONST
 
uöt8
 
	gdevInfoP≈IdUUID
[
ATT_BT_UUID_SIZE
] =

126 
LO_UINT16
(
DEVINFO_PNP_ID_UUID
), 
HI_UINT16
(DEVINFO_PNP_ID_UUID)

147 
CONST
 
g©tAârTy≥_t
 
	gdevInfoSîvi˚
 = { 
ATT_BT_UUID_SIZE
, 
devInfoSîvUUID
 };

150 
uöt8
 
	gdevInfoSy°emIdPr›s
 = 
GATT_PROP_READ
;

151 
uöt8
 
	gdevInfoSy°emId
[
DEVINFO_SYSTEM_ID_LEN
] = {0, 0, 0, 0, 0, 0, 0, 0};

154 
uöt8
 
	gdevInfoModñNumbîPr›s
 = 
GATT_PROP_READ
;

155 c⁄° 
uöt8
 
	gdevInfoModñNumbî
[] = "N.A.";

158 
uöt8
 
	gdevInfoSîülNumbîPr›s
 = 
GATT_PROP_READ
;

159 c⁄° 
uöt8
 
	gdevInfoSîülNumbî
[] = "N.A.";

162 
uöt8
 
	gdevInfoSo·w¨eRevPr›s
 = 
GATT_PROP_READ
;

163 c⁄° 
uöt8
 
	gdevInfoSo·w¨eRev
[] = "N.A.";

166 
uöt8
 
	gdevInfoFúmw¨eRevPr›s
 = 
GATT_PROP_READ
;

167 c⁄° 
uöt8
 
	gdevInfoFúmw¨eRev
[] = "1.3 ("
__DATE__
")";

170 
uöt8
 
	gdevInfoH¨dw¨eRevPr›s
 = 
GATT_PROP_READ
;

171 c⁄° 
uöt8
 
	gdevInfoH¨dw¨eRev
[] = "N.A.";

174 
uöt8
 
	gdevInfoM‰NamePr›s
 = 
GATT_PROP_READ
;

175 c⁄° 
uöt8
 
	gdevInfoM‰Name
[] = "Texas Instruments";

179 
uöt8
 
	gdevInfo11073CîtPr›s
 = 
GATT_PROP_READ
;

180 c⁄° 
uöt8
 
	gdevInfo11073Cît
[] =

182 
DEVINFO_11073_BODY_EXP
,

189 
uöt8
 
	gdevInfoP≈IdPr›s
 = 
GATT_PROP_READ
;

190 
uöt8
 
	gdevInfoP≈Id
[
DEVINFO_PNP_ID_LEN
] =

193 
LO_UINT16
(0x000D), 
HI_UINT16
(0x000D),

194 
LO_UINT16
(0x0000), 
HI_UINT16
(0x0000),

195 
LO_UINT16
(0x0110), 
HI_UINT16
(0x0110)

202 
g©tAâribuã_t
 
	gdevInfoAârTbl
[] =

206 { 
ATT_BT_UUID_SIZE
, 
¥im¨ySîvi˚UUID
 },

207 
GATT_PERMIT_READ
,

209 (
uöt8
 *)&
devInfoSîvi˚


214 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

215 
GATT_PERMIT_READ
,

217 &
devInfoSy°emIdPr›s


222 { 
ATT_BT_UUID_SIZE
, 
devInfoSy°emIdUUID
 },

223 
GATT_PERMIT_READ
,

225 (
uöt8
 *Ë
devInfoSy°emId


230 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

231 
GATT_PERMIT_READ
,

233 &
devInfoModñNumbîPr›s


238 { 
ATT_BT_UUID_SIZE
, 
devInfoModñNumbîUUID
 },

239 
GATT_PERMIT_READ
,

241 (
uöt8
 *Ë
devInfoModñNumbî


246 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

247 
GATT_PERMIT_READ
,

249 &
devInfoSîülNumbîPr›s


254 { 
ATT_BT_UUID_SIZE
, 
devInfoSîülNumbîUUID
 },

255 
GATT_PERMIT_READ
,

257 (
uöt8
 *Ë
devInfoSîülNumbî


262 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

263 
GATT_PERMIT_READ
,

265 &
devInfoFúmw¨eRevPr›s


270 { 
ATT_BT_UUID_SIZE
, 
devInfoFúmw¨eRevUUID
 },

271 
GATT_PERMIT_READ
,

273 (
uöt8
 *Ë
devInfoFúmw¨eRev


278 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

279 
GATT_PERMIT_READ
,

281 &
devInfoH¨dw¨eRevPr›s


286 { 
ATT_BT_UUID_SIZE
, 
devInfoH¨dw¨eRevUUID
 },

287 
GATT_PERMIT_READ
,

289 (
uöt8
 *Ë
devInfoH¨dw¨eRev


294 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

295 
GATT_PERMIT_READ
,

297 &
devInfoSo·w¨eRevPr›s


302 { 
ATT_BT_UUID_SIZE
, 
devInfoSo·w¨eRevUUID
 },

303 
GATT_PERMIT_READ
,

305 (
uöt8
 *Ë
devInfoSo·w¨eRev


310 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

311 
GATT_PERMIT_READ
,

313 &
devInfoM‰NamePr›s


318 { 
ATT_BT_UUID_SIZE
, 
devInfoM‰NameUUID
 },

319 
GATT_PERMIT_READ
,

321 (
uöt8
 *Ë
devInfoM‰Name


326 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

327 
GATT_PERMIT_READ
,

329 &
devInfo11073CîtPr›s


334 { 
ATT_BT_UUID_SIZE
, 
devInfo11073CîtUUID
 },

335 
GATT_PERMIT_READ
,

337 (
uöt8
 *Ë
devInfo11073Cît


342 { 
ATT_BT_UUID_SIZE
, 
ch¨a˘îUUID
 },

343 
GATT_PERMIT_READ
,

345 &
devInfoP≈IdPr›s


350 { 
ATT_BT_UUID_SIZE
, 
devInfoP≈IdUUID
 },

351 
GATT_PERMIT_READ
,

353 (
uöt8
 *Ë
devInfoP≈Id


361 
uöt8
 
devInfo_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

362 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 );

368 
CONST
 
g©tSîvi˚CBs_t
 
	gdevInfoCBs
 =

370 
devInfo_RódAârCB
,

371 
NULL
,

372 
NULL


391 
bSètus_t
 
	$DevInfo_AddSîvi˚
( )

394  
	`GATTSîvAµ_Regi°îSîvi˚
–
devInfoAârTbl
,

395 
	`GATT_NUM_ATTRS
–
devInfoAârTbl
 ),

396 &
devInfoCBs
 );

397 
	}
}

413 
bSètus_t
 
	$DevInfo_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 )

415 
bSètus_t
 
ªt
 = 
SUCCESS
;

417  
∑øm
 )

419 
DEVINFO_SYSTEM_ID
:

420 
	`oßl_mem˝y
(
devInfoSy°emId
, 
vÆue
, 
Àn
);

424 
ªt
 = 
INVALIDPARAMETER
;

428  ( 
ªt
 );

429 
	}
}

444 
bSètus_t
 
	$DevInfo_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 )

446 
bSètus_t
 
ªt
 = 
SUCCESS
;

448  
∑øm
 )

450 
DEVINFO_SYSTEM_ID
:

451 
	`oßl_mem˝y
(
vÆue
, 
devInfoSy°emId
, (devInfoSystemId));

454 
DEVINFO_MODEL_NUMBER
:

455 
	`oßl_mem˝y
(
vÆue
, 
devInfoModñNumbî
, (devInfoModelNumber));

457 
DEVINFO_SERIAL_NUMBER
:

458 
	`oßl_mem˝y
(
vÆue
, 
devInfoSîülNumbî
, (devInfoSerialNumber));

461 
DEVINFO_FIRMWARE_REV
:

462 
	`oßl_mem˝y
(
vÆue
, 
devInfoFúmw¨eRev
, (devInfoFirmwareRev));

465 
DEVINFO_HARDWARE_REV
:

466 
	`oßl_mem˝y
(
vÆue
, 
devInfoH¨dw¨eRev
, (devInfoHardwareRev));

469 
DEVINFO_SOFTWARE_REV
:

470 
	`oßl_mem˝y
(
vÆue
, 
devInfoSo·w¨eRev
, (devInfoSoftwareRev));

473 
DEVINFO_MANUFACTURER_NAME
:

474 
	`oßl_mem˝y
(
vÆue
, 
devInfoM‰Name
, (devInfoMfrName));

477 
DEVINFO_11073_CERT_DATA
:

478 
	`oßl_mem˝y
(
vÆue
, 
devInfo11073Cît
, (devInfo11073Cert));

481 
DEVINFO_PNP_ID
:

482 
	`oßl_mem˝y
(
vÆue
, 
devInfoP≈Id
, (devInfoPnpId));

486 
ªt
 = 
INVALIDPARAMETER
;

490  ( 
ªt
 );

491 
	}
}

507 
uöt8
 
	$devInfo_RódAârCB
–
uöt16
 
c⁄nH™dÀ
, 
g©tAâribuã_t
 *
pAâr
,

508 
uöt8
 *
pVÆue
, uöt8 *
pLí
, 
uöt16
 
off£t
, uöt8 
maxLí
 )

510 
bSètus_t
 
°©us
 = 
SUCCESS
;

511 
uöt16
 
uuid
 = 
	`BUILD_UINT16
–
pAâr
->
ty≥
.uuid[0],ÖAttr->type.uuid[1]);

513 
uuid
)

515 
DEVINFO_SYSTEM_ID_UUID
:

517 i‡(
off£t
 >(
devInfoSy°emId
))

519 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

524 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoSy°emId
Ë- 
off£t
));

527 
	`oßl_mem˝y
(
pVÆue
, &
devInfoSy°emId
[
off£t
], *
pLí
);

531 
DEVINFO_MODEL_NUMBER_UUID
:

533 i‡(
off£t
 >(
devInfoModñNumbî
))

535 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

540 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoModñNumbî
Ë- 
off£t
));

543 
	`oßl_mem˝y
(
pVÆue
, &
devInfoModñNumbî
[
off£t
], *
pLí
);

547 
DEVINFO_SERIAL_NUMBER_UUID
:

549 i‡(
off£t
 >(
devInfoSîülNumbî
))

551 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

556 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoSîülNumbî
Ë- 
off£t
));

559 
	`oßl_mem˝y
(
pVÆue
, &
devInfoSîülNumbî
[
off£t
], *
pLí
);

563 
DEVINFO_FIRMWARE_REV_UUID
:

565 i‡(
off£t
 >(
devInfoFúmw¨eRev
))

567 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

572 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoFúmw¨eRev
Ë- 
off£t
));

575 
	`oßl_mem˝y
(
pVÆue
, &
devInfoFúmw¨eRev
[
off£t
], *
pLí
);

579 
DEVINFO_HARDWARE_REV_UUID
:

581 i‡(
off£t
 >(
devInfoH¨dw¨eRev
))

583 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

588 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoH¨dw¨eRev
Ë- 
off£t
));

591 
	`oßl_mem˝y
(
pVÆue
, &
devInfoH¨dw¨eRev
[
off£t
], *
pLí
);

595 
DEVINFO_SOFTWARE_REV_UUID
:

597 i‡(
off£t
 >(
devInfoSo·w¨eRev
))

599 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

604 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoSo·w¨eRev
Ë- 
off£t
));

607 
	`oßl_mem˝y
(
pVÆue
, &
devInfoSo·w¨eRev
[
off£t
], *
pLí
);

611 
DEVINFO_MANUFACTURER_NAME_UUID
:

613 i‡(
off£t
 >(
devInfoM‰Name
))

615 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

620 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoM‰Name
Ë- 
off£t
));

623 
	`oßl_mem˝y
(
pVÆue
, &
devInfoM‰Name
[
off£t
], *
pLí
);

627 
DEVINFO_11073_CERT_DATA_UUID
:

629 i‡(
off£t
 >(
devInfo11073Cît
))

631 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

636 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfo11073Cît
Ë- 
off£t
));

639 
	`oßl_mem˝y
(
pVÆue
, &
devInfo11073Cît
[
off£t
], *
pLí
);

643 
DEVINFO_PNP_ID_UUID
:

645 i‡(
off£t
 >(
devInfoP≈Id
))

647 
°©us
 = 
ATT_ERR_INVALID_OFFSET
;

652 *
pLí
 = 
	`MIN
(
maxLí
, ((
devInfoP≈Id
Ë- 
off£t
));

655 
	`oßl_mem˝y
(
pVÆue
, &
devInfoP≈Id
[
off£t
], *
pLí
);

660 *
pLí
 = 0;

661 
°©us
 = 
ATT_ERR_ATTR_NOT_FOUND
;

665  ( 
°©us
 );

666 
	}
}

	@Projects/ble/SensorTag/Source/devinfoservice-st.h

41 #i‚de‡
DEVINFOSERVICE_H


42 
	#DEVINFOSERVICE_H


	)

44 #ifde‡
__˝lu•lus


58 
	#DEVINFO_SYSTEM_ID
 0

	)

59 
	#DEVINFO_MODEL_NUMBER
 1

	)

60 
	#DEVINFO_SERIAL_NUMBER
 2

	)

61 
	#DEVINFO_FIRMWARE_REV
 3

	)

62 
	#DEVINFO_HARDWARE_REV
 4

	)

63 
	#DEVINFO_SOFTWARE_REV
 5

	)

64 
	#DEVINFO_MANUFACTURER_NAME
 6

	)

65 
	#DEVINFO_11073_CERT_DATA
 7

	)

66 
	#DEVINFO_PNP_ID
 8

	)

69 
	#DEVINFO_SERV_UUID
 0x180A

70 
	#DEVINFO_SYSTEM_ID_UUID
 0x2A23

71 
	#DEVINFO_MODEL_NUMBER_UUID
 0x2A24

72 
	#DEVINFO_SERIAL_NUMBER_UUID
 0x2A25

73 
	#DEVINFO_FIRMWARE_REV_UUID
 0x2A26

74 
	#DEVINFO_HARDWARE_REV_UUID
 0x2A27

75 
	#DEVINFO_SOFTWARE_REV_UUID
 0x2A28

76 
	#DEVINFO_MANUFACTURER_NAME_UUID
 0x2A29

77 
	#DEVINFO_11073_CERT_DATA_UUID
 0x2A2A

78 
	#DEVINFO_PNP_ID_UUID
 0x2A50

79 

	)

81 
	#DEVINFO_11073_BODY_EMPTY
 0

	)

82 
	#DEVINFO_11073_BODY_IEEE
 1

	)

83 
	#DEVINFO_11073_BODY_CONTINUA
 2

	)

84 
	#DEVINFO_11073_BODY_EXP
 254

	)

87 
	#DEVINFO_SYSTEM_ID_LEN
 8

	)

90 
	#DEVINFO_PNP_ID_LEN
 7

	)

115 
bSètus_t
 
DevInfo_AddSîvi˚
( );

131 
bSètus_t
 
DevInfo_SëP¨amëî
–
uöt8
 
∑øm
, uöt8 
Àn
, *
vÆue
 );

142 
bSètus_t
 
DevInfo_GëP¨amëî
–
uöt8
 
∑øm
, *
vÆue
 );

147 #ifde‡
__˝lu•lus


	@Projects/ble/SensorTag/Source/sensorTag.h

40 #i‚de‡
SENSORTAG_H


41 
	#SENSORTAG_H


	)

43 #ifde‡
__˝lu•lus


57 
	#ST_START_DEVICE_EVT
 0x0001

	)

58 
	#ST_IRTEMPERATURE_READ_EVT
 0x0002

	)

59 
	#ST_ACCELEROMETER_SENSOR_EVT
 0x0004

	)

60 
	#ST_HUMIDITY_SENSOR_EVT
 0x0008

	)

61 
	#ST_MAGNETOMETER_SENSOR_EVT
 0x0010

	)

62 
	#ST_BAROMETER_SENSOR_EVT
 0x0020

	)

63 
	#ST_GYROSCOPE_SENSOR_EVT
 0x0040

	)

64 
	#ST_SYS_RESET_EVT
 0x0080

	)

77 
Sís‹Tag_Inô
–
uöt8
 
èsk_id
 );

82 
uöt16
 
Sís‹Tag_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

87 
uöt16
 
£ns‹Tag_ã°
();

92 #ifde‡
__˝lu•lus


	@Projects/ble/SimpleBLEBroadcaster/Source/OSAL_SimpleBLEBroadcaster.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"g≠.h
"

64 
	~"brﬂdˇ°î.h
"

67 
	~"sim∂eBLEBrﬂdˇ°î.h
"

74 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

76 
LL_Pro˚ssEvít
,

77 
HÆ_Pro˚ssEvít
,

78 
HCI_Pro˚ssEvít
,

79 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

80 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

82 
GAP_Pro˚ssEvít
,

83 
GAPRﬁe_Pro˚ssEvít
,

84 
Sim∂eBLEBrﬂdˇ°î_Pro˚ssEvít


87 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

88 
uöt16
 *
	gèsksEvíts
;

103 
	$oßlInôTasks
( )

105 
uöt8
 
èskID
 = 0;

107 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

108 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

111 
	`LL_Inô
–
èskID
++ );

114 
	`HÆ_Inô
–
èskID
++ );

117 
	`HCI_Inô
–
èskID
++ );

119 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

121 
	`oßl_CbTimîInô
–
èskID
 );

122 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

126 
	`GAP_Inô
–
èskID
++ );

129 
	`GAPRﬁe_Inô
–
èskID
++ );

132 
	`Sim∂eBLEBrﬂdˇ°î_Inô
–
èskID
 );

133 
	}
}

	@Projects/ble/SimpleBLEBroadcaster/Source/SimpleBLEBroadcaster_Main.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"hÆ_key.h
"

46 
	~"hÆ_timî.h
"

47 
	~"hÆ_drivîs.h
"

48 
	~"hÆ_Àd.h
"

51 
	~"OSAL.h
"

52 
	~"OSAL_Tasks.h
"

53 
	~"OSAL_PwrMgr.h
"

54 
	~"oßl_¢v.h
"

55 
	~"OnBﬂrd.h
"

62 
MSA_Maö_KeyCÆlback
(
uöt8
 
keys
, uöt8 
°©e
);

74 
	$maö
()

77 
	`HAL_BOARD_INIT
();

80 
	`InôBﬂrd
–
OB_COLD
 );

83 
	`HÆDrivîInô
();

86 
	`oßl_¢v_öô
();

91 
	`oßl_öô_sy°em
();

94 
	`HAL_ENABLE_INTERRUPTS
();

97 
	`InôBﬂrd
–
OB_READY
 );

99 #i‡
	`deföed
 ( 
POWER_SAVING
 )

100 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

104 
	`oßl_°¨t_sy°em
();

107 
	}
}

	@Projects/ble/SimpleBLEBroadcaster/Source/simpleBLEBroadcaster.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_PwrMgr.h
"

48 
	~"OnBﬂrd.h
"

49 
	~"hÆ_adc.h
"

50 
	~"hÆ_Àd.h
"

51 
	~"hÆ_key.h
"

52 
	~"hÆ_lcd.h
"

54 
	~"hci.h
"

55 
	~"g≠.h
"

57 
	~"devöfo£rvi˚.h
"

58 
	~"brﬂdˇ°î.h
"

60 
	~"sim∂eBLEBrﬂdˇ°î.h
"

71 
	#DEFAULT_ADVERTISING_INTERVAL
 160

	)

74 
	#TI_COMPANY_ID
 0x000D

	)

77 
	#B_ADDR_STR_LEN
 15

	)

98 
uöt8
 
	gsim∂eBLEBrﬂdˇ°î_TaskID
;

101 
uöt8
 
	gsˇnR•D©a
[] =

105 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

129 
GAP_ADTYPE_POWER_LEVEL
,

135 
uöt8
 
	gadvîtD©a
[] =

141 
GAP_ADTYPE_FLAGS
,

142 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

146 
GAP_ADTYPE_MANUFACTURER_SPECIFIC
,

155 
sim∂eBLEBrﬂdˇ°î_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

156 
≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

158 #i‡
deföed
–
CC2540_MINIDK
 )

159 
sim∂eBLEBrﬂdˇ°î_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

162 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

163 *
bdAddr2Så
 ( 
uöt8
 *
pAddr
 );

171 
g≠RﬁesCBs_t
 
	gsim∂eBLEBrﬂdˇ°î_Brﬂdˇ°îCBs
 =

173 
≥rùhîÆSèãNŸifiˇti⁄CB
,

174 
NULL


195 
	$Sim∂eBLEBrﬂdˇ°î_Inô
–
uöt8
 
èsk_id
 )

197 
sim∂eBLEBrﬂdˇ°î_TaskID
 = 
èsk_id
;

201 #i‡
	`deföed
–
CC2540_MINIDK
 )

203 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

206 
uöt8
 
öôül_advîtisög_íabÀ
 = 
TRUE
;

212 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

215 
uöt8
 
advTy≥
 = 
GAP_ADTYPE_ADV_DISCOVER_IND
;

218 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

219 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

221 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnR•D©a
 ), scanRspData );

222 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

224 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADV_EVENT_TYPE
, –
uöt8
 ), &
advTy≥
 );

229 
uöt16
 
advI¡
 = 
DEFAULT_ADVERTISING_INTERVAL
;

231 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
advI¡
 );

232 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
advI¡
 );

233 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
advI¡
 );

234 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
advI¡
 );

237 #i‡
	`deföed
–
CC2540_MINIDK
 )

240 
	`Regi°îF‹Keys
–
sim∂eBLEBrﬂdˇ°î_TaskID
 );

243 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

249 
P0SEL
 = 0;

250 
P1SEL
 = 0;

251 
P2SEL
 = 0;

253 
P0DIR
 = 0xFC;

255 
P1DIR
 = 0xFF;

256 
P2DIR
 = 0x1F;

258 
P0
 = 0x03;

259 
P1
 = 0;

260 
P2
 = 0;

264 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

266 
	`HÆLcdWrôeSåög
–"BLE Brﬂdˇ°î", 
HAL_LCD_LINE_1
 );

271 
	`oßl_£t_evít
–
sim∂eBLEBrﬂdˇ°î_TaskID
, 
SBP_START_DEVICE_EVT
 );

272 
	}
}

287 
uöt16
 
	$Sim∂eBLEBrﬂdˇ°î_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

290 
VOID
 
èsk_id
;

292 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

294 
uöt8
 *
pMsg
;

296 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
sim∂eBLEBrﬂdˇ°î_TaskID
 )Ë!
NULL
 )

298 
	`sim∂eBLEBrﬂdˇ°î_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

301 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

305  (
evíts
 ^ 
SYS_EVENT_MSG
);

308 i‡–
evíts
 & 
SBP_START_DEVICE_EVT
 )

311 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
sim∂eBLEBrﬂdˇ°î_Brﬂdˇ°îCBs
 );

313  ( 
evíts
 ^ 
SBP_START_DEVICE_EVT
 );

318 
	}
}

329 
	$sim∂eBLEBrﬂdˇ°î_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

331  
pMsg
->
evít
 )

333 #i‡
	`deföed
–
CC2540_MINIDK
 )

334 
KEY_CHANGE
:

335 
	`sim∂eBLEBrﬂdˇ°î_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

343 
	}
}

345 #i‡
deföed
–
CC2540_MINIDK
 )

358 
	$sim∂eBLEBrﬂdˇ°î_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

360 
VOID
 
shi·
;

362 i‡–
keys
 & 
HAL_KEY_SW_2
 )

365 
uöt8
 
cuºít_adv_íabÀd_°©us
;

366 
uöt8
 
√w_adv_íabÀd_°©us
;

369 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
cuºít_adv_íabÀd_°©us
 );

371 if–
cuºít_adv_íabÀd_°©us
 =
FALSE
 )

373 
√w_adv_íabÀd_°©us
 = 
TRUE
;

377 
√w_adv_íabÀd_°©us
 = 
FALSE
;

381 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
√w_adv_íabÀd_°©us
 );

383 
	}
}

395 
	$≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

397  
√wSèã
 )

399 
GAPROLE_STARTED
:

401 
uöt8
 
ownAddªss
[
B_ADDR_LEN
];

403 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
ownAddªss
);

405 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

407 
	`HÆLcdWrôeSåög
–
	`bdAddr2Så
–
ownAddªss
 ), 
HAL_LCD_LINE_2
 );

408 
	`HÆLcdWrôeSåög
–"Inôülized", 
HAL_LCD_LINE_3
 );

413 
GAPROLE_ADVERTISING
:

415 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

416 
	`HÆLcdWrôeSåög
–"Advîtisög", 
HAL_LCD_LINE_3
 );

421 
GAPROLE_WAITING
:

423 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

424 
	`HÆLcdWrôeSåög
–"Waôög", 
HAL_LCD_LINE_3
 );

429 
GAPROLE_ERROR
:

431 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

432 
	`HÆLcdWrôeSåög
–"Eº‹", 
HAL_LCD_LINE_3
 );

439 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

440 
	`HÆLcdWrôeSåög
–"", 
HAL_LCD_LINE_3
 );

445 
	}
}

447 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

456 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

458 
uöt8
 
i
;

459 
hex
[] = "0123456789ABCDEF";

460 
°r
[
B_ADDR_STR_LEN
];

461 *
pSå
 = 
°r
;

463 *
pSå
++ = '0';

464 *
pSå
++ = 'x';

467 
pAddr
 +
B_ADDR_LEN
;

469  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

471 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

472 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

475 *
pSå
 = 0;

477  
°r
;

478 
	}
}

	@Projects/ble/SimpleBLEBroadcaster/Source/simpleBLEBroadcaster.h

40 #i‚de‡
SIMPLEBLEBROADCASTER_H


41 
	#SIMPLEBLEBROADCASTER_H


	)

43 #ifde‡
__˝lu•lus


57 
	#SBP_START_DEVICE_EVT
 0x0001

	)

58 
	#SBP_PERIODIC_EVT
 0x0002

	)

59 
	#SBP_ADV_IN_CONNECTION_EVT
 0x0004

	)

72 
Sim∂eBLEBrﬂdˇ°î_Inô
–
uöt8
 
èsk_id
 );

77 
uöt16
 
Sim∂eBLEBrﬂdˇ°î_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

82 #ifde‡
__˝lu•lus


	@Projects/ble/SimpleBLECentral/Source/OSAL_simpleBLECentral.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 
	~"˚¡øl.h
"

77 
	~"sim∂eBLECíåÆ.h
"

84 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

86 
LL_Pro˚ssEvít
,

87 
HÆ_Pro˚ssEvít
,

88 
HCI_Pro˚ssEvít
,

89 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

90 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

92 
L2CAP_Pro˚ssEvít
,

93 
GAP_Pro˚ssEvít
,

94 
GATT_Pro˚ssEvít
,

95 
SM_Pro˚ssEvít
,

96 
GAPCíåÆRﬁe_Pro˚ssEvít
,

97 
GAPB⁄dMgr_Pro˚ssEvít
,

98 
GATTSîvAµ_Pro˚ssEvít
,

99 
Sim∂eBLECíåÆ_Pro˚ssEvít


102 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

103 
uöt16
 *
	gèsksEvíts
;

118 
	$oßlInôTasks
( )

120 
uöt8
 
èskID
 = 0;

122 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

123 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

126 
	`LL_Inô
–
èskID
++ );

129 
	`HÆ_Inô
–
èskID
++ );

132 
	`HCI_Inô
–
èskID
++ );

134 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

136 
	`oßl_CbTimîInô
–
èskID
 );

137 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

141 
	`L2CAP_Inô
–
èskID
++ );

144 
	`GAP_Inô
–
èskID
++ );

147 
	`GATT_Inô
–
èskID
++ );

150 
	`SM_Inô
–
èskID
++ );

153 
	`GAPCíåÆRﬁe_Inô
–
èskID
++ );

154 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

156 
	`GATTSîvAµ_Inô
–
èskID
++ );

159 
	`Sim∂eBLECíåÆ_Inô
–
èskID
 );

160 
	}
}

	@Projects/ble/SimpleBLECentral/Source/simpleBLECentral.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_PwrMgr.h
"

47 
	~"OnBﬂrd.h
"

48 
	~"hÆ_Àd.h
"

49 
	~"hÆ_key.h
"

50 
	~"hÆ_lcd.h
"

51 
	~"g©t.h
"

52 
	~"Œ.h
"

53 
	~"hci.h
"

54 
	~"g≠g©t£rvî.h
"

55 
	~"g©t£rv≠p.h
"

56 
	~"˚¡øl.h
"

57 
	~"g≠b⁄dmgr.h
"

58 
	~"sim∂eGATT¥ofûe.h
"

59 
	~"sim∂eBLECíåÆ.h
"

66 
	#B_ADDR_STR_LEN
 15

	)

73 
	#DEFAULT_MAX_SCAN_RES
 8

	)

76 
	#DEFAULT_SCAN_DURATION
 4000

	)

79 
	#DEFAULT_DISCOVERY_MODE
 
DEVDISC_MODE_ALL


	)

82 
	#DEFAULT_DISCOVERY_ACTIVE_SCAN
 
TRUE


	)

85 
	#DEFAULT_DISCOVERY_WHITE_LIST
 
FALSE


	)

88 
	#DEFAULT_LINK_HIGH_DUTY_CYCLE
 
FALSE


	)

91 
	#DEFAULT_LINK_WHITE_LIST
 
FALSE


	)

94 
	#DEFAULT_RSSI_PERIOD
 1000

	)

97 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

100 
	#DEFAULT_UPDATE_MIN_CONN_INTERVAL
 400

	)

103 
	#DEFAULT_UPDATE_MAX_CONN_INTERVAL
 800

	)

106 
	#DEFAULT_UPDATE_SLAVE_LATENCY
 0

	)

109 
	#DEFAULT_UPDATE_CONN_TIMEOUT
 600

	)

112 
	#DEFAULT_PASSCODE
 19655

	)

115 
	#DEFAULT_PAIRING_MODE
 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ


	)

118 
	#DEFAULT_MITM_MODE
 
FALSE


	)

121 
	#DEFAULT_BONDING_MODE
 
TRUE


	)

124 
	#DEFAULT_IO_CAPABILITIES
 
GAPBOND_IO_CAP_DISPLAY_ONLY


	)

127 
	#DEFAULT_SVC_DISCOVERY_DELAY
 1000

	)

130 
	#DEFAULT_DEV_DISC_BY_SVC_UUID
 
TRUE


	)

135 
	mBLE_STATE_IDLE
,

136 
	mBLE_STATE_CONNECTING
,

137 
	mBLE_STATE_CONNECTED
,

138 
	mBLE_STATE_DISCONNECTING


144 
	mBLE_DISC_STATE_IDLE
,

145 
	mBLE_DISC_STATE_SVC
,

146 
	mBLE_DISC_STATE_CHAR


170 
uöt8
 
	gsim∂eBLETaskId
;

173 c⁄° 
uöt8
 
	gsim∂eBLEDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "Simple BLE Central";

176 
uöt8
 
	gsim∂eBLESˇnRes
;

177 
uöt8
 
	gsim∂eBLESˇnIdx
;

180 
g≠DevRec_t
 
	gsim∂eBLEDevLi°
[
DEFAULT_MAX_SCAN_RES
];

183 
uöt8
 
	gsim∂eBLESˇ¬ög
 = 
FALSE
;

186 
uöt8
 
	gsim∂eBLERssi
 = 
FALSE
;

189 
uöt16
 
	gsim∂eBLEC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

192 
uöt8
 
	gsim∂eBLESèã
 = 
BLE_STATE_IDLE
;

195 
uöt8
 
	gsim∂eBLEDiscSèã
 = 
BLE_DISC_STATE_IDLE
;

198 
uöt16
 
	gsim∂eBLESvcSèπHdl
 = 0;

199 
uöt16
 
	gsim∂eBLESvcEndHdl
 = 0;

202 
uöt16
 
	gsim∂eBLECh¨Hdl
 = 0;

205 
uöt8
 
	gsim∂eBLECh¨VÆ
 = 0;

208 
boﬁ
 
	gsim∂eBLEDoWrôe
 = 
FALSE
;

211 
boﬁ
 
	gsim∂eBLEPro˚duªInProgªss
 = 
FALSE
;

216 
sim∂eBLECíåÆPro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 );

217 
sim∂eBLECíåÆRssiCB
–
uöt16
 
c⁄nH™dÀ
, 
öt8
 
rssi
 );

218 
sim∂eBLECíåÆEvítCB
–
g≠CíåÆRﬁeEvít_t
 *
pEvít
 );

219 
sim∂eBLECíåÆPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

220 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 );

221 
sim∂eBLECíåÆPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 );

222 
sim∂eBLECíåÆ_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

223 
sim∂eBLECíåÆ_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

224 
sim∂eBLEGATTDiscovîyEvít
–
g©tMsgEvít_t
 *
pMsg
 );

225 
sim∂eBLECíåÆSèπDiscovîy
( );

226 
boﬁ
 
sim∂eBLEFödSvcUuid
–
uöt16
 
uuid
, 
uöt8
 *
pD©a
, uöt8 
d©aLí
 );

227 
sim∂eBLEAddDevi˚Info
–
uöt8
 *
pAddr
, uöt8 
addrTy≥
 );

228 *
bdAddr2Så
 ( 
uöt8
 *
pAddr
 );

235 c⁄° 
g≠CíåÆRﬁeCB_t
 
	gsim∂eBLERﬁeCB
 =

237 
sim∂eBLECíåÆRssiCB
,

238 
sim∂eBLECíåÆEvítCB


242 c⁄° 
g≠B⁄dCBs_t
 
	gsim∂eBLEB⁄dCB
 =

244 
sim∂eBLECíåÆPasscodeCB
,

245 
sim∂eBLECíåÆPaúSèãCB


266 
	$Sim∂eBLECíåÆ_Inô
–
uöt8
 
èsk_id
 )

268 
sim∂eBLETaskId
 = 
èsk_id
;

272 
uöt8
 
sˇnRes
 = 
DEFAULT_MAX_SCAN_RES
;

273 
	`GAPCíåÆRﬁe_SëP¨amëî
 ( 
GAPCENTRALROLE_MAX_SCAN_RES
, –
uöt8
 ), &
sˇnRes
 );

277 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

278 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

279 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, (
uöt8
 *Ë
sim∂eBLEDevi˚Name
 );

283 
uöt32
 
∑sskey
 = 
DEFAULT_PASSCODE
;

284 
uöt8
 
∑úMode
 = 
DEFAULT_PAIRING_MODE
;

285 
uöt8
 
môm
 = 
DEFAULT_MITM_MODE
;

286 
uöt8
 
ioC≠
 = 
DEFAULT_IO_CAPABILITIES
;

287 
uöt8
 
b⁄dög
 = 
DEFAULT_BONDING_MODE
;

288 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
, –
uöt32
 ), &
∑sskey
 );

289 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
, –
uöt8
 ), &
∑úMode
 );

290 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
, –
uöt8
 ), &
môm
 );

291 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
, –
uöt8
 ), &
ioC≠
 );

292 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
, –
uöt8
 ), &
b⁄dög
 );

296 
VOID
 
	`GATT_InôClõ¡
();

299 
	`GATT_Regi°îF‹Ind
–
sim∂eBLETaskId
 );

302 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

303 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

306 
	`Regi°îF‹Keys
–
sim∂eBLETaskId
 );

309 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

312 
	`oßl_£t_evít
–
sim∂eBLETaskId
, 
START_DEVICE_EVT
 );

313 
	}
}

328 
uöt16
 
	$Sim∂eBLECíåÆ_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

331 
VOID
 
èsk_id
;

333 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

335 
uöt8
 *
pMsg
;

337 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
sim∂eBLETaskId
 )Ë!
NULL
 )

339 
	`sim∂eBLECíåÆ_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

342 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

346  (
evíts
 ^ 
SYS_EVENT_MSG
);

349 i‡–
evíts
 & 
START_DEVICE_EVT
 )

352 
VOID
 
	`GAPCíåÆRﬁe_SèπDevi˚
–(
g≠CíåÆRﬁeCB_t
 *Ë&
sim∂eBLERﬁeCB
 );

355 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
sim∂eBLEB⁄dCB
 );

357  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

360 i‡–
evíts
 & 
START_DISCOVERY_EVT
 )

362 
	`sim∂eBLECíåÆSèπDiscovîy
( );

364  ( 
evíts
 ^ 
START_DISCOVERY_EVT
 );

369 
	}
}

380 
	$sim∂eBLECíåÆ_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

382  
pMsg
->
evít
 )

384 
KEY_CHANGE
:

385 
	`sim∂eBLECíåÆ_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

388 
GATT_MSG_EVENT
:

389 
	`sim∂eBLECíåÆPro˚ssGATTMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

392 
	}
}

406 
uöt8
 
	ggSètus
;

407 
	$sim∂eBLECíåÆ_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

409 ()
shi·
;

411 i‡–
keys
 & 
HAL_KEY_UP
 )

414 i‡–
sim∂eBLESèã
 !
BLE_STATE_CONNECTED
 )

416 i‡–!
sim∂eBLESˇ¬ög
 )

418 
sim∂eBLESˇ¬ög
 = 
TRUE
;

419 
sim∂eBLESˇnRes
 = 0;

421 
	`LCD_WRITE_STRING
–"Discovîög...", 
HAL_LCD_LINE_1
 );

422 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

424 
	`GAPCíåÆRﬁe_SèπDiscovîy
–
DEFAULT_DISCOVERY_MODE
,

425 
DEFAULT_DISCOVERY_ACTIVE_SCAN
,

426 
DEFAULT_DISCOVERY_WHITE_LIST
 );

430 
	`GAPCíåÆRﬁe_C™˚lDiscovîy
();

433 i‡–
sim∂eBLESèã
 =
BLE_STATE_CONNECTED
 &&

434 
sim∂eBLECh¨Hdl
 != 0 &&

435 
sim∂eBLEPro˚duªInProgªss
 =
FALSE
 )

437 
uöt8
 
°©us
;

440 i‡–
sim∂eBLEDoWrôe
 )

443 
©tWrôeReq_t
 
ªq
;

445 
ªq
.
h™dÀ
 = 
sim∂eBLECh¨Hdl
;

446 
ªq
.
Àn
 = 1;

447 
ªq
.
vÆue
[0] = 
sim∂eBLECh¨VÆ
;

448 
ªq
.
sig
 = 0;

449 
ªq
.
cmd
 = 0;

450 
°©us
 = 
	`GATT_WrôeCh¨VÆue
–
sim∂eBLEC⁄nH™dÀ
, &
ªq
, 
sim∂eBLETaskId
 );

455 
©tRódReq_t
 
ªq
;

457 
ªq
.
h™dÀ
 = 
sim∂eBLECh¨Hdl
;

458 
°©us
 = 
	`GATT_RódCh¨VÆue
–
sim∂eBLEC⁄nH™dÀ
, &
ªq
, 
sim∂eBLETaskId
 );

461 i‡–
°©us
 =
SUCCESS
 )

463 
sim∂eBLEPro˚duªInProgªss
 = 
TRUE
;

464 
sim∂eBLEDoWrôe
 = !simpleBLEDoWrite;

469 i‡–
keys
 & 
HAL_KEY_LEFT
 )

472 i‡–!
sim∂eBLESˇ¬ög
 && 
sim∂eBLESˇnRes
 > 0 )

475 
sim∂eBLESˇnIdx
++;

476 i‡–
sim∂eBLESˇnIdx
 >
sim∂eBLESˇnRes
 )

478 
sim∂eBLESˇnIdx
 = 0;

481 
	`LCD_WRITE_STRING_VALUE
–"Devi˚", 
sim∂eBLESˇnIdx
 + 1,

482 10, 
HAL_LCD_LINE_1
 );

483 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
sim∂eBLEDevLi°
[
sim∂eBLESˇnIdx
].
addr
 ),

484 
HAL_LCD_LINE_2
 );

488 i‡–
keys
 & 
HAL_KEY_RIGHT
 )

491 i‡–
sim∂eBLESèã
 =
BLE_STATE_CONNECTED
 )

493 
	`GAPCíåÆRﬁe_Upd©eLök
–
sim∂eBLEC⁄nH™dÀ
,

494 
DEFAULT_UPDATE_MIN_CONN_INTERVAL
,

495 
DEFAULT_UPDATE_MAX_CONN_INTERVAL
,

496 
DEFAULT_UPDATE_SLAVE_LATENCY
,

497 
DEFAULT_UPDATE_CONN_TIMEOUT
 );

501 i‡–
keys
 & 
HAL_KEY_CENTER
 )

503 
uöt8
 
addrTy≥
;

504 
uöt8
 *
≥îAddr
;

507 i‡–
sim∂eBLESèã
 =
BLE_STATE_IDLE
 )

510 i‡–
sim∂eBLESˇnRes
 > 0 )

513 
≥îAddr
 = 
sim∂eBLEDevLi°
[
sim∂eBLESˇnIdx
].
addr
;

514 
addrTy≥
 = 
sim∂eBLEDevLi°
[
sim∂eBLESˇnIdx
].addrType;

516 
sim∂eBLESèã
 = 
BLE_STATE_CONNECTING
;

518 
	`GAPCíåÆRﬁe_E°ablishLök
–
DEFAULT_LINK_HIGH_DUTY_CYCLE
,

519 
DEFAULT_LINK_WHITE_LIST
,

520 
addrTy≥
, 
≥îAddr
 );

522 
	`LCD_WRITE_STRING
–"C⁄√˘ög", 
HAL_LCD_LINE_1
 );

523 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
≥îAddr
 ), 
HAL_LCD_LINE_2
 );

526 i‡–
sim∂eBLESèã
 =
BLE_STATE_CONNECTING
 ||

527 
sim∂eBLESèã
 =
BLE_STATE_CONNECTED
 )

530 
sim∂eBLESèã
 = 
BLE_STATE_DISCONNECTING
;

532 
gSètus
 = 
	`GAPCíåÆRﬁe_Tîmö©eLök
–
sim∂eBLEC⁄nH™dÀ
 );

534 
	`LCD_WRITE_STRING
–"Disc⁄√˘ög", 
HAL_LCD_LINE_1
 );

538 i‡–
keys
 & 
HAL_KEY_DOWN
 )

541 i‡–
sim∂eBLESèã
 =
BLE_STATE_CONNECTED
 )

543 i‡–!
sim∂eBLERssi
 )

545 
sim∂eBLERssi
 = 
TRUE
;

546 
	`GAPCíåÆRﬁe_SèπRssi
–
sim∂eBLEC⁄nH™dÀ
, 
DEFAULT_RSSI_PERIOD
 );

550 
sim∂eBLERssi
 = 
FALSE
;

551 
	`GAPCíåÆRﬁe_C™˚lRssi
–
sim∂eBLEC⁄nH™dÀ
 );

553 
	`LCD_WRITE_STRING
–"RSSI C™˚Œed", 
HAL_LCD_LINE_1
 );

557 
	}
}

566 
	$sim∂eBLECíåÆPro˚ssGATTMsg
–
g©tMsgEvít_t
 *
pMsg
 )

568 i‡–
sim∂eBLESèã
 !
BLE_STATE_CONNECTED
 )

575 i‡––
pMsg
->
mëhod
 =
ATT_READ_RSP
 ) ||

576 ––
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) &&

577 –
pMsg
->
msg
.
îr‹R•
.
ªqOpcode
 =
ATT_READ_REQ
 ) ) )

579 i‡–
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 )

581 
uöt8
 
°©us
 = 
pMsg
->
msg
.
îr‹R•
.
îrCode
;

583 
	`LCD_WRITE_STRING_VALUE
–"Ród Eº‹", 
°©us
, 10, 
HAL_LCD_LINE_1
 );

588 
uöt8
 
vÆueRód
 = 
pMsg
->
msg
.
ªadR•
.
vÆue
[0];

590 
	`LCD_WRITE_STRING_VALUE
–"RódÑ•:", 
vÆueRód
, 10, 
HAL_LCD_LINE_1
 );

593 
sim∂eBLEPro˚duªInProgªss
 = 
FALSE
;

595 i‡––
pMsg
->
mëhod
 =
ATT_WRITE_RSP
 ) ||

596 ––
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) &&

597 –
pMsg
->
msg
.
îr‹R•
.
ªqOpcode
 =
ATT_WRITE_REQ
 ) ) )

600 i‡–
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 == ATT_ERROR_RSP )

602 
uöt8
 
°©us
 = 
pMsg
->
msg
.
îr‹R•
.
îrCode
;

604 
	`LCD_WRITE_STRING_VALUE
–"WrôêEº‹", 
°©us
, 10, 
HAL_LCD_LINE_1
 );

609 
	`LCD_WRITE_STRING_VALUE
–"Wrôê£¡:", 
sim∂eBLECh¨VÆ
++, 10, 
HAL_LCD_LINE_1
 );

612 
sim∂eBLEPro˚duªInProgªss
 = 
FALSE
;

615 i‡–
sim∂eBLEDiscSèã
 !
BLE_DISC_STATE_IDLE
 )

617 
	`sim∂eBLEGATTDiscovîyEvít
–
pMsg
 );

620 
	}
}

632 
	$sim∂eBLECíåÆRssiCB
–
uöt16
 
c⁄nH™dÀ
, 
öt8
 
rssi
 )

634 
	`LCD_WRITE_STRING_VALUE
–"RSSI -dB:", (
uöt8
Ë(-
rssi
), 10, 
HAL_LCD_LINE_1
 );

635 
	}
}

646 
	$sim∂eBLECíåÆEvítCB
–
g≠CíåÆRﬁeEvít_t
 *
pEvít
 )

648  
pEvít
->
g≠
.
›code
 )

650 
GAP_DEVICE_INIT_DONE_EVENT
:

652 
	`LCD_WRITE_STRING
–"BLE CíåÆ", 
HAL_LCD_LINE_1
 );

653 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
pEvít
->
öôD⁄e
.
devAddr
 ), 
HAL_LCD_LINE_2
 );

657 
GAP_DEVICE_INFO_EVENT
:

660 i‡–
DEFAULT_DEV_DISC_BY_SVC_UUID
 =
TRUE
 )

662 i‡–
	`sim∂eBLEFödSvcUuid
–
SIMPLEPROFILE_SERV_UUID
,

663 
pEvít
->
devi˚Info
.
pEvtD©a
,

664 
pEvít
->
devi˚Info
.
d©aLí
 ) )

666 
	`sim∂eBLEAddDevi˚Info
–
pEvít
->
devi˚Info
.
addr
,ÖEvít->devi˚Info.
addrTy≥
 );

672 
GAP_DEVICE_DISCOVERY_EVENT
:

675 
sim∂eBLESˇ¬ög
 = 
FALSE
;

678 i‡–
DEFAULT_DEV_DISC_BY_SVC_UUID
 =
FALSE
 )

681 
sim∂eBLESˇnRes
 = 
pEvít
->
discCm∂
.
numDevs
;

682 
	`oßl_mem˝y
–
sim∂eBLEDevLi°
, 
pEvít
->
discCm∂
.
pDevLi°
,

683 (–
g≠DevRec_t
 ) * 
pEvít
->
discCm∂
.
numDevs
) );

686 
	`LCD_WRITE_STRING_VALUE
–"Devi˚†Found", 
sim∂eBLESˇnRes
,

687 10, 
HAL_LCD_LINE_1
 );

688 i‡–
sim∂eBLESˇnRes
 > 0 )

690 
	`LCD_WRITE_STRING
–"<- TÿSñe˘", 
HAL_LCD_LINE_2
 );

694 
sim∂eBLESˇnIdx
 = 
sim∂eBLESˇnRes
;

699 
GAP_LINK_ESTABLISHED_EVENT
:

701 i‡–
pEvít
->
g≠
.
hdr
.
°©us
 =
SUCCESS
 )

703 
sim∂eBLESèã
 = 
BLE_STATE_CONNECTED
;

704 
sim∂eBLEC⁄nH™dÀ
 = 
pEvít
->
lökCm∂
.
c⁄√˘i⁄H™dÀ
;

705 
sim∂eBLEPro˚duªInProgªss
 = 
TRUE
;

708 i‡–
sim∂eBLECh¨Hdl
 == 0 )

710 
	`oßl_°¨t_timîEx
–
sim∂eBLETaskId
, 
START_DISCOVERY_EVT
, 
DEFAULT_SVC_DISCOVERY_DELAY
 );

713 
	`LCD_WRITE_STRING
–"C⁄√˘ed", 
HAL_LCD_LINE_1
 );

714 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
pEvít
->
lökCm∂
.
devAddr
 ), 
HAL_LCD_LINE_2
 );

718 
sim∂eBLESèã
 = 
BLE_STATE_IDLE
;

719 
sim∂eBLEC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

720 
sim∂eBLERssi
 = 
FALSE
;

721 
sim∂eBLEDiscSèã
 = 
BLE_DISC_STATE_IDLE
;

723 
	`LCD_WRITE_STRING
–"C⁄√˘ Faûed", 
HAL_LCD_LINE_1
 );

724 
	`LCD_WRITE_STRING_VALUE
–"Rós⁄:", 
pEvít
->
g≠
.
hdr
.
°©us
, 10, 
HAL_LCD_LINE_2
 );

729 
GAP_LINK_TERMINATED_EVENT
:

731 
sim∂eBLESèã
 = 
BLE_STATE_IDLE
;

732 
sim∂eBLEC⁄nH™dÀ
 = 
GAP_CONNHANDLE_INIT
;

733 
sim∂eBLERssi
 = 
FALSE
;

734 
sim∂eBLEDiscSèã
 = 
BLE_DISC_STATE_IDLE
;

735 
sim∂eBLECh¨Hdl
 = 0;

736 
sim∂eBLEPro˚duªInProgªss
 = 
FALSE
;

738 
	`LCD_WRITE_STRING
–"Disc⁄√˘ed", 
HAL_LCD_LINE_1
 );

739 
	`LCD_WRITE_STRING_VALUE
–"Rós⁄:", 
pEvít
->
lökTîmö©e
.
ªas⁄
,

740 10, 
HAL_LCD_LINE_2
 );

744 
GAP_LINK_PARAM_UPDATE_EVENT
:

746 
	`LCD_WRITE_STRING
–"P¨am Upd©e", 
HAL_LCD_LINE_1
 );

753 
	}
}

762 
	$sim∂eBLECíåÆPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 )

764 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_STARTED
 )

766 
	`LCD_WRITE_STRING
–"Paúög sèπed", 
HAL_LCD_LINE_1
 );

768 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_COMPLETE
 )

770 i‡–
°©us
 =
SUCCESS
 )

772 
	`LCD_WRITE_STRING
–"Paúög suc˚ss", 
HAL_LCD_LINE_1
 );

776 
	`LCD_WRITE_STRING_VALUE
–"Paúög faû", 
°©us
, 10, 
HAL_LCD_LINE_1
 );

779 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_BONDED
 )

781 i‡–
°©us
 =
SUCCESS
 )

783 
	`LCD_WRITE_STRING
–"B⁄dög suc˚ss", 
HAL_LCD_LINE_1
 );

786 
	}
}

795 
	$sim∂eBLECíåÆPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

796 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 )

798 #i‡(
HAL_LCD
 =
TRUE
)

800 
uöt32
 
∑sscode
;

801 
uöt8
 
°r
[7];

804 
	`LL_R™d
–((
uöt8
 *Ë&
∑sscode
), –
uöt32
 ));

805 
∑sscode
 %= 1000000;

808 i‡–
uiOuçuts
 != 0 )

810 
	`LCD_WRITE_STRING
–"Passcode:", 
HAL_LCD_LINE_1
 );

811 
	`LCD_WRITE_STRING
–(*Ë
	`_…ﬂ
(
∑sscode
, 
°r
, 10), 
HAL_LCD_LINE_2
 );

815 
	`GAPB⁄dMgr_PasscodeR•
–
c⁄√˘i⁄H™dÀ
, 
SUCCESS
, 
∑sscode
 );

817 
	}
}

826 
	$sim∂eBLECíåÆSèπDiscovîy
( )

828 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
SIMPLEPROFILE_SERV_UUID
),

829 
	`HI_UINT16
(
SIMPLEPROFILE_SERV_UUID
) };

832 
sim∂eBLESvcSèπHdl
 = 
sim∂eBLESvcEndHdl
 = 
sim∂eBLECh¨Hdl
 = 0;

834 
sim∂eBLEDiscSèã
 = 
BLE_DISC_STATE_SVC
;

837 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
sim∂eBLEC⁄nH™dÀ
,

838 
uuid
,

839 
ATT_BT_UUID_SIZE
,

840 
sim∂eBLETaskId
 );

841 
	}
}

850 
	$sim∂eBLEGATTDiscovîyEvít
–
g©tMsgEvít_t
 *
pMsg
 )

852 
©tRódByTy≥Req_t
 
ªq
;

854 i‡–
sim∂eBLEDiscSèã
 =
BLE_DISC_STATE_SVC
 )

857 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

858 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

860 
sim∂eBLESvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

861 
sim∂eBLESvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

865 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

866 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

867 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

869 i‡–
sim∂eBLESvcSèπHdl
 != 0 )

872 
sim∂eBLEDiscSèã
 = 
BLE_DISC_STATE_CHAR
;

874 
ªq
.
°¨tH™dÀ
 = 
sim∂eBLESvcSèπHdl
;

875 
ªq
.
ídH™dÀ
 = 
sim∂eBLESvcEndHdl
;

876 
ªq
.
ty≥
.
Àn
 = 
ATT_BT_UUID_SIZE
;

877 
ªq
.
ty≥
.
uuid
[0] = 
	`LO_UINT16
(
SIMPLEPROFILE_CHAR1_UUID
);

878 
ªq
.
ty≥
.
uuid
[1] = 
	`HI_UINT16
(
SIMPLEPROFILE_CHAR1_UUID
);

880 
	`GATT_RódUsögCh¨UUID
–
sim∂eBLEC⁄nH™dÀ
, &
ªq
, 
sim∂eBLETaskId
 );

884 i‡–
sim∂eBLEDiscSèã
 =
BLE_DISC_STATE_CHAR
 )

887 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

888 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 )

890 
sim∂eBLECh¨Hdl
 = 
	`BUILD_UINT16
–
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
[0],

891 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
[1] );

893 
	`LCD_WRITE_STRING
–"Sim∂êSv¯Found", 
HAL_LCD_LINE_1
 );

894 
sim∂eBLEPro˚duªInProgªss
 = 
FALSE
;

897 
sim∂eBLEDiscSèã
 = 
BLE_DISC_STATE_IDLE
;

901 
	}
}

911 
boﬁ
 
	$sim∂eBLEFödSvcUuid
–
uöt16
 
uuid
, 
uöt8
 *
pD©a
, uöt8 
d©aLí
 )

913 
uöt8
 
adLí
;

914 
uöt8
 
adTy≥
;

915 
uöt8
 *
pEnd
;

917 
pEnd
 = 
pD©a
 + 
d©aLí
 - 1;

920  
pD©a
 < 
pEnd
 )

923 
adLí
 = *
pD©a
++;

924 i‡–
adLí
 > 0 )

926 
adTy≥
 = *
pD©a
;

929 i‡–
adTy≥
 =
GAP_ADTYPE_16BIT_MORE
 ||ádTy≥ =
GAP_ADTYPE_16BIT_COMPLETE
 )

931 
pD©a
++;

932 
adLí
--;

935  
adLí
 >2 && 
pD©a
 < 
pEnd
 )

938 i‡–
pD©a
[0] =
	`LO_UINT16
(
uuid
Ë&&ÖD©a[1] =
	`HI_UINT16
(uuid) )

941  
TRUE
;

945 
pD©a
 += 2;

946 
adLí
 -= 2;

950 i‡–
adLí
 == 1 )

952 
pD©a
++;

958 
pD©a
 +
adLí
;

964  
FALSE
;

965 
	}
}

974 
	$sim∂eBLEAddDevi˚Info
–
uöt8
 *
pAddr
, uöt8 
addrTy≥
 )

976 
uöt8
 
i
;

979 i‡–
sim∂eBLESˇnRes
 < 
DEFAULT_MAX_SCAN_RES
 )

982  
i
 = 0; i < 
sim∂eBLESˇnRes
; i++ )

984 i‡–
	`oßl_memcmp
–
pAddr
, 
sim∂eBLEDevLi°
[
i
].
addr
 , 
B_ADDR_LEN
 ) )

991 
	`oßl_mem˝y
–
sim∂eBLEDevLi°
[
sim∂eBLESˇnRes
].
addr
, 
pAddr
, 
B_ADDR_LEN
 );

992 
sim∂eBLEDevLi°
[
sim∂eBLESˇnRes
].
addrTy≥
 =áddrType;

995 
sim∂eBLESˇnRes
++;

997 
	}
}

1006 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

1008 
uöt8
 
i
;

1009 
hex
[] = "0123456789ABCDEF";

1010 
°r
[
B_ADDR_STR_LEN
];

1011 *
pSå
 = 
°r
;

1013 *
pSå
++ = '0';

1014 *
pSå
++ = 'x';

1017 
pAddr
 +
B_ADDR_LEN
;

1019  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

1021 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

1022 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

1025 *
pSå
 = 0;

1027  
°r
;

1028 
	}
}

	@Projects/ble/SimpleBLECentral/Source/simpleBLECentral.h

40 #i‚de‡
SIMPLEBLECENTRAL_H


41 
	#SIMPLEBLECENTRAL_H


	)

43 #ifde‡
__˝lu•lus


58 
	#START_DEVICE_EVT
 0x0001

	)

59 
	#START_DISCOVERY_EVT
 0x0002

	)

66 #i‡
HAL_LCD
 =
TRUE


67 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
Ë
	`HÆLcdWrôeSåög
–(°r), (›ti⁄))

	)

68 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
Ë
	`HÆLcdWrôeS¸ìn
–÷öe1), (löe2Ë)

	)

69 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
Ë
	`HÆLcdWrôeSåögVÆue
–—ôÀ), (vÆue), (f‹m©), (löeË)

	)

71 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
)

	)

72 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
)

	)

73 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
)

	)

83 
Sim∂eBLECíåÆ_Inô
–
uöt8
 
èsk_id
 );

88 
uöt16
 
Sim∂eBLECíåÆ_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

93 #ifde‡
__˝lu•lus


	@Projects/ble/SimpleBLECentral/Source/simpleBLECentral_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

72 
	$maö
()

75 
	`HAL_BOARD_INIT
();

78 
	`InôBﬂrd
–
OB_COLD
 );

81 
	`HÆDrivîInô
();

84 
	`oßl_¢v_öô
();

89 
	`oßl_öô_sy°em
();

92 
	`HAL_ENABLE_INTERRUPTS
();

95 
	`InôBﬂrd
–
OB_READY
 );

97 #i‡
	`deföed
 ( 
POWER_SAVING
 )

98 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

102 
	`oßl_°¨t_sy°em
();

105 
	}
}

	@Projects/ble/SimpleBLEObserver/Source/OSAL_SimpleBLEObserver.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

63 
	~"g≠.h
"

68 
	~"ob£rvî.h
"

71 
	~"sim∂eBLEOb£rvî.h
"

78 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

80 
LL_Pro˚ssEvít
,

81 
HÆ_Pro˚ssEvít
,

82 
HCI_Pro˚ssEvít
,

83 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

84 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

87 
GAP_Pro˚ssEvít
,

90 
GAPOb£rvîRﬁe_Pro˚ssEvít
,

93 
Sim∂eBLEOb£rvî_Pro˚ssEvít


96 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

97 
uöt16
 *
	gèsksEvíts
;

112 
	$oßlInôTasks
( )

114 
uöt8
 
èskID
 = 0;

116 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

117 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

120 
	`LL_Inô
–
èskID
++ );

123 
	`HÆ_Inô
–
èskID
++ );

126 
	`HCI_Inô
–
èskID
++ );

128 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

130 
	`oßl_CbTimîInô
–
èskID
 );

131 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

138 
	`GAP_Inô
–
èskID
++ );

147 
	`GAPOb£rvîRﬁe_Inô
–
èskID
++ );

153 
	`Sim∂eBLEOb£rvî_Inô
–
èskID
 );

154 
	}
}

	@Projects/ble/SimpleBLEObserver/Source/simpleBLEObserver.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_PwrMgr.h
"

47 
	~"OnBﬂrd.h
"

48 
	~"hÆ_Àd.h
"

49 
	~"hÆ_key.h
"

50 
	~"hÆ_lcd.h
"

51 
	~"Œ.h
"

52 
	~"hci.h
"

54 
	~"ob£rvî.h
"

56 
	~"sim∂eBLEOb£rvî.h
"

63 
	#B_ADDR_STR_LEN
 15

	)

70 
	#DEFAULT_MAX_SCAN_RES
 8

	)

73 
	#DEFAULT_SCAN_DURATION
 4000

	)

76 
	#DEFAULT_DISCOVERY_MODE
 
DEVDISC_MODE_ALL


	)

79 
	#DEFAULT_DISCOVERY_ACTIVE_SCAN
 
FALSE


	)

82 
	#DEFAULT_DISCOVERY_WHITE_LIST
 
FALSE


	)

105 
uöt8
 
	gsim∂eBLETaskId
;

111 
uöt8
 
	gsim∂eBLESˇnRes
;

112 
uöt8
 
	gsim∂eBLESˇnIdx
;

115 
g≠DevRec_t
 
	gsim∂eBLEDevLi°
[
DEFAULT_MAX_SCAN_RES
];

118 
uöt8
 
	gsim∂eBLESˇ¬ög
 = 
FALSE
;

123 
sim∂eBLEOb£rvîEvítCB
–
g≠Ob£rvîRﬁeEvít_t
 *
pEvít
 );

124 
sim∂eBLEOb£rvî_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

125 
sim∂eBLEOb£rvî_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

126 
sim∂eBLEAddDevi˚Info
–
uöt8
 *
pAddr
, uöt8 
addrTy≥
 );

127 *
bdAddr2Så
 ( 
uöt8
 *
pAddr
 );

134 c⁄° 
g≠Ob£rvîRﬁeCB_t
 
	gsim∂eBLERﬁeCB
 =

136 
NULL
,

137 
sim∂eBLEOb£rvîEvítCB


158 
	$Sim∂eBLEOb£rvî_Inô
–
uöt8
 
èsk_id
 )

160 
sim∂eBLETaskId
 = 
èsk_id
;

164 
uöt8
 
sˇnRes
 = 
DEFAULT_MAX_SCAN_RES
;

165 
	`GAPOb£rvîRﬁe_SëP¨amëî
 ( 
GAPOBSERVERROLE_MAX_SCAN_RES
, –
uöt8
 ), &
sˇnRes
 );

169 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

170 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_SCAN
, 
DEFAULT_SCAN_DURATION
 );

173 
	`Regi°îF‹Keys
–
sim∂eBLETaskId
 );

176 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

179 
	`oßl_£t_evít
–
sim∂eBLETaskId
, 
START_DEVICE_EVT
 );

180 
	}
}

195 
uöt16
 
	$Sim∂eBLEOb£rvî_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

198 
VOID
 
èsk_id
;

200 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

202 
uöt8
 *
pMsg
;

204 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
sim∂eBLETaskId
 )Ë!
NULL
 )

206 
	`sim∂eBLEOb£rvî_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

209 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

213  (
evíts
 ^ 
SYS_EVENT_MSG
);

216 i‡–
evíts
 & 
START_DEVICE_EVT
 )

219 
VOID
 
	`GAPOb£rvîRﬁe_SèπDevi˚
–(
g≠Ob£rvîRﬁeCB_t
 *Ë&
sim∂eBLERﬁeCB
 );

221  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

226 
	}
}

237 
	$sim∂eBLEOb£rvî_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

239  
pMsg
->
evít
 )

241 
KEY_CHANGE
:

242 
	`sim∂eBLEOb£rvî_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

245 
GATT_MSG_EVENT
:

248 
	}
}

262 
uöt8
 
	ggSètus
;

263 
	$sim∂eBLEOb£rvî_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

265 ()
shi·
;

267 i‡–
keys
 & 
HAL_KEY_UP
 )

270 i‡–!
sim∂eBLESˇ¬ög
 )

272 
sim∂eBLESˇ¬ög
 = 
TRUE
;

273 
sim∂eBLESˇnRes
 = 0;

275 
	`LCD_WRITE_STRING
–"Discovîög...", 
HAL_LCD_LINE_1
 );

276 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

278 
	`GAPOb£rvîRﬁe_SèπDiscovîy
–
DEFAULT_DISCOVERY_MODE
,

279 
DEFAULT_DISCOVERY_ACTIVE_SCAN
,

280 
DEFAULT_DISCOVERY_WHITE_LIST
 );

284 
	`GAPOb£rvîRﬁe_C™˚lDiscovîy
();

288 i‡–
keys
 & 
HAL_KEY_LEFT
 )

291 i‡–!
sim∂eBLESˇ¬ög
 && 
sim∂eBLESˇnRes
 > 0 )

294 
sim∂eBLESˇnIdx
++;

295 i‡–
sim∂eBLESˇnIdx
 >
sim∂eBLESˇnRes
 )

297 
sim∂eBLESˇnIdx
 = 0;

300 
	`LCD_WRITE_STRING_VALUE
–"Devi˚", 
sim∂eBLESˇnIdx
 + 1,

301 10, 
HAL_LCD_LINE_1
 );

302 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
sim∂eBLEDevLi°
[
sim∂eBLESˇnIdx
].
addr
 ),

303 
HAL_LCD_LINE_2
 );

307 i‡–
keys
 & 
HAL_KEY_RIGHT
 )

311 i‡–
keys
 & 
HAL_KEY_CENTER
 )

315 i‡–
keys
 & 
HAL_KEY_DOWN
 )

318 
	}
}

329 
	$sim∂eBLEOb£rvîEvítCB
–
g≠Ob£rvîRﬁeEvít_t
 *
pEvít
 )

331  
pEvít
->
g≠
.
›code
 )

333 
GAP_DEVICE_INIT_DONE_EVENT
:

335 
	`LCD_WRITE_STRING
–"BLE Ob£rvî", 
HAL_LCD_LINE_1
 );

336 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
pEvít
->
öôD⁄e
.
devAddr
 ), 
HAL_LCD_LINE_2
 );

340 
GAP_DEVICE_INFO_EVENT
:

342 
	`sim∂eBLEAddDevi˚Info
–
pEvít
->
devi˚Info
.
addr
,ÖEvít->devi˚Info.
addrTy≥
 );

346 
GAP_DEVICE_DISCOVERY_EVENT
:

349 
sim∂eBLESˇ¬ög
 = 
FALSE
;

352 
sim∂eBLESˇnRes
 = 
pEvít
->
discCm∂
.
numDevs
;

353 
	`oßl_mem˝y
–
sim∂eBLEDevLi°
, 
pEvít
->
discCm∂
.
pDevLi°
,

354 (–
g≠DevRec_t
 ) * 
pEvít
->
discCm∂
.
numDevs
) );

356 
	`LCD_WRITE_STRING_VALUE
–"Devi˚†Found", 
sim∂eBLESˇnRes
,

357 10, 
HAL_LCD_LINE_1
 );

358 i‡–
sim∂eBLESˇnRes
 > 0 )

360 
	`LCD_WRITE_STRING
–"<- TÿSñe˘", 
HAL_LCD_LINE_2
 );

364 
sim∂eBLESˇnIdx
 = 
sim∂eBLESˇnRes
;

371 
	}
}

380 
	$sim∂eBLEAddDevi˚Info
–
uöt8
 *
pAddr
, uöt8 
addrTy≥
 )

382 
uöt8
 
i
;

385 i‡–
sim∂eBLESˇnRes
 < 
DEFAULT_MAX_SCAN_RES
 )

388  
i
 = 0; i < 
sim∂eBLESˇnRes
; i++ )

390 i‡–
	`oßl_memcmp
–
pAddr
, 
sim∂eBLEDevLi°
[
i
].
addr
 , 
B_ADDR_LEN
 ) )

397 
	`oßl_mem˝y
–
sim∂eBLEDevLi°
[
sim∂eBLESˇnRes
].
addr
, 
pAddr
, 
B_ADDR_LEN
 );

398 
sim∂eBLEDevLi°
[
sim∂eBLESˇnRes
].
addrTy≥
 =áddrType;

401 
sim∂eBLESˇnRes
++;

403 
	}
}

412 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

414 
uöt8
 
i
;

415 
hex
[] = "0123456789ABCDEF";

416 
°r
[
B_ADDR_STR_LEN
];

417 *
pSå
 = 
°r
;

419 *
pSå
++ = '0';

420 *
pSå
++ = 'x';

423 
pAddr
 +
B_ADDR_LEN
;

425  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

427 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

428 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

431 *
pSå
 = 0;

433  
°r
;

434 
	}
}

	@Projects/ble/SimpleBLEObserver/Source/simpleBLEObserver.h

40 #i‚de‡
SIMPLEBLEOBSERVER_H


41 
	#SIMPLEBLEOBSERVER_H


	)

43 #ifde‡
__˝lu•lus


58 
	#START_DEVICE_EVT
 0x0001

	)

59 
	#START_DISCOVERY_EVT
 0x0002

	)

66 #i‡
HAL_LCD
 =
TRUE


67 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
Ë
	`HÆLcdWrôeSåög
–(°r), (›ti⁄))

	)

68 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
Ë
	`HÆLcdWrôeS¸ìn
–÷öe1), (löe2Ë)

	)

69 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
Ë
	`HÆLcdWrôeSåögVÆue
–—ôÀ), (vÆue), (f‹m©), (löeË)

	)

71 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
)

	)

72 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
)

	)

73 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
)

	)

83 
Sim∂eBLEOb£rvî_Inô
–
uöt8
 
èsk_id
 );

88 
uöt16
 
Sim∂eBLEOb£rvî_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

93 #ifde‡
__˝lu•lus


	@Projects/ble/SimpleBLEObserver/Source/simpleBLEObserver_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

72 
	$maö
()

75 
	`HAL_BOARD_INIT
();

78 
	`InôBﬂrd
–
OB_COLD
 );

81 
	`HÆDrivîInô
();

84 
	`oßl_¢v_öô
();

89 
	`oßl_öô_sy°em
();

92 
	`HAL_ENABLE_INTERRUPTS
();

95 
	`InôBﬂrd
–
OB_READY
 );

97 #i‡
	`deföed
 ( 
POWER_SAVING
 )

98 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

102 
	`oßl_°¨t_sy°em
();

105 
	}
}

	@Projects/ble/SimpleBLEPeripheral/Source/OSAL_SimpleBLEPeripheral.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

75 
	~"≥rùhîÆBrﬂdˇ°î.h
"

77 
	~"≥rùhîÆ.h
"

81 
	~"sim∂eBLEPîùhîÆ.h
"

88 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

90 
LL_Pro˚ssEvít
,

91 
HÆ_Pro˚ssEvít
,

92 
HCI_Pro˚ssEvít
,

93 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

94 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

96 
L2CAP_Pro˚ssEvít
,

97 
GAP_Pro˚ssEvít
,

98 
GATT_Pro˚ssEvít
,

99 
SM_Pro˚ssEvít
,

100 
GAPRﬁe_Pro˚ssEvít
,

101 
GAPB⁄dMgr_Pro˚ssEvít
,

102 
GATTSîvAµ_Pro˚ssEvít
,

103 
Sim∂eBLEPîùhîÆ_Pro˚ssEvít


106 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

107 
uöt16
 *
	gèsksEvíts
;

122 
	$oßlInôTasks
( )

124 
uöt8
 
èskID
 = 0;

126 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

127 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

130 
	`LL_Inô
–
èskID
++ );

133 
	`HÆ_Inô
–
èskID
++ );

136 
	`HCI_Inô
–
èskID
++ );

138 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

140 
	`oßl_CbTimîInô
–
èskID
 );

141 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

145 
	`L2CAP_Inô
–
èskID
++ );

148 
	`GAP_Inô
–
èskID
++ );

151 
	`GATT_Inô
–
èskID
++ );

154 
	`SM_Inô
–
èskID
++ );

157 
	`GAPRﬁe_Inô
–
èskID
++ );

158 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

160 
	`GATTSîvAµ_Inô
–
èskID
++ );

163 
	`Sim∂eBLEPîùhîÆ_Inô
–
èskID
 );

164 
	}
}

	@Projects/ble/SimpleBLEPeripheral/Source/SimpleBLEPeripheral_Main.c

44 
	~"hÆ_ty≥s.h
"

45 
	~"hÆ_key.h
"

46 
	~"hÆ_timî.h
"

47 
	~"hÆ_drivîs.h
"

48 
	~"hÆ_Àd.h
"

51 
	~"OSAL.h
"

52 
	~"OSAL_Tasks.h
"

53 
	~"OSAL_PwrMgr.h
"

54 
	~"oßl_¢v.h
"

55 
	~"OnBﬂrd.h
"

62 
MSA_Maö_KeyCÆlback
(
uöt8
 
keys
, uöt8 
°©e
);

74 
	$maö
()

77 
	`HAL_BOARD_INIT
();

80 
	`InôBﬂrd
–
OB_COLD
 );

83 
	`HÆDrivîInô
();

86 
	`oßl_¢v_öô
();

91 
	`oßl_öô_sy°em
();

94 
	`HAL_ENABLE_INTERRUPTS
();

97 
	`InôBﬂrd
–
OB_READY
 );

99 #i‡
	`deföed
 ( 
POWER_SAVING
 )

100 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

104 
	`oßl_°¨t_sy°em
();

107 
	}
}

	@Projects/ble/SimpleBLEPeripheral/Source/simpleBLEPeripheral.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_PwrMgr.h
"

48 
	~"OnBﬂrd.h
"

49 
	~"hÆ_adc.h
"

50 
	~"hÆ_Àd.h
"

51 
	~"hÆ_key.h
"

52 
	~"hÆ_lcd.h
"

54 
	~"g©t.h
"

56 
	~"hci.h
"

58 
	~"g≠g©t£rvî.h
"

59 
	~"g©t£rv≠p.h
"

60 
	~"devöfo£rvi˚.h
"

61 
	~"sim∂eGATT¥ofûe.h
"

63 #i‡
deföed
–
CC2540_MINIDK
 )

64 
	~"sim∂ekeys.h
"

67 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

68 
	~"≥rùhîÆBrﬂdˇ°î.h
"

70 
	~"≥rùhîÆ.h
"

73 
	~"g≠b⁄dmgr.h
"

75 
	~"sim∂eBLEPîùhîÆ.h
"

77 #i‡
deföed
 
FEATURE_OAD


78 
	~"ﬂd.h
"

79 
	~"ﬂd_èrgë.h
"

91 
	#SBP_PERIODIC_EVT_PERIOD
 5000

	)

94 
	#DEFAULT_ADVERTISING_INTERVAL
 160

	)

99 #i‡
deföed
 ( 
CC2540_MINIDK
 )

100 
	#DEFAULT_DISCOVERABLE_MODE
 
GAP_ADTYPE_FLAGS_LIMITED


	)

102 
	#DEFAULT_DISCOVERABLE_MODE
 
GAP_ADTYPE_FLAGS_GENERAL


	)

106 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 80

	)

109 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 800

	)

112 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 0

	)

115 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

118 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
TRUE


	)

121 
	#DEFAULT_CONN_PAUSE_PERIPHERAL
 6

	)

124 
	#TI_COMPANY_ID
 0x000D

	)

126 
	#INVALID_CONNHANDLE
 0xFFFF

	)

129 
	#B_ADDR_STR_LEN
 15

	)

131 #i‡
deföed
 ( 
PLUS_BROADCASTER
 )

132 
	#ADV_IN_CONN_WAIT
 500

134 

	)

154 
uöt8
 
	gsim∂eBLEPîùhîÆ_TaskID
;

156 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

159 
uöt8
 
	gsˇnR•D©a
[] =

163 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

186 
GAP_ADTYPE_SLAVE_CONN_INTERVAL_RANGE
,

187 
LO_UINT16
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
 ),

188 
HI_UINT16
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
 ),

189 
LO_UINT16
–
DEFAULT_DESIRED_MAX_CONN_INTERVAL
 ),

190 
HI_UINT16
–
DEFAULT_DESIRED_MAX_CONN_INTERVAL
 ),

194 
GAP_ADTYPE_POWER_LEVEL
,

200 
uöt8
 
	gadvîtD©a
[] =

206 
GAP_ADTYPE_FLAGS
,

207 
DEFAULT_DISCOVERABLE_MODE
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

212 
GAP_ADTYPE_16BIT_MORE
,

213 
LO_UINT16
–
SIMPLEPROFILE_SERV_UUID
 ),

214 
HI_UINT16
–
SIMPLEPROFILE_SERV_UUID
 ),

219 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "Simple BLE Peripheral";

224 
sim∂eBLEPîùhîÆ_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

225 
≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

226 
≥rf‹mPîiodicTask
( );

227 
sim∂eProfûeCh™geCB
–
uöt8
 
∑ømID
 );

229 #i‡
deföed
–
CC2540_MINIDK
 )

230 
sim∂eBLEPîùhîÆ_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

233 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

234 *
bdAddr2Så
 ( 
uöt8
 *
pAddr
 );

244 
g≠RﬁesCBs_t
 
	gsim∂eBLEPîùhîÆ_PîùhîÆCBs
 =

246 
≥rùhîÆSèãNŸifiˇti⁄CB
,

247 
NULL


251 
g≠B⁄dCBs_t
 
	gsim∂eBLEPîùhîÆ_B⁄dMgrCBs
 =

253 
NULL
,

254 
NULL


258 
sim∂eProfûeCBs_t
 
	gsim∂eBLEPîùhîÆ_Sim∂eProfûeCBs
 =

260 
sim∂eProfûeCh™geCB


281 
	$Sim∂eBLEPîùhîÆ_Inô
–
uöt8
 
èsk_id
 )

283 
sim∂eBLEPîùhîÆ_TaskID
 = 
èsk_id
;

286 
VOID
 
	`GAP_SëP¨amVÆue
–
TGAP_CONN_PAUSE_PERIPHERAL
, 
DEFAULT_CONN_PAUSE_PERIPHERAL
 );

290 #i‡
	`deföed
–
CC2540_MINIDK
 )

292 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

295 
uöt8
 
öôül_advîtisög_íabÀ
 = 
TRUE
;

301 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

303 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

304 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

305 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

306 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

307 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

310 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

311 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

313 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnR•D©a
 ), scanRspData );

314 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

316 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

317 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

318 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

319 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

320 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

324 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
©tDevi˚Name
 );

328 
uöt16
 
advI¡
 = 
DEFAULT_ADVERTISING_INTERVAL
;

330 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MIN
, 
advI¡
 );

331 
	`GAP_SëP¨amVÆue
–
TGAP_LIM_DISC_ADV_INT_MAX
, 
advI¡
 );

332 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
advI¡
 );

333 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
advI¡
 );

338 
uöt32
 
∑sskey
 = 0;

339 
uöt8
 
∑úMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

340 
uöt8
 
môm
 = 
TRUE
;

341 
uöt8
 
ioC≠
 = 
GAPBOND_IO_CAP_DISPLAY_ONLY
;

342 
uöt8
 
b⁄dög
 = 
TRUE
;

343 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
,  ( 
uöt32
 ), &
∑sskey
 );

344 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

345 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

346 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

347 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

351 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

352 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

353 
	`DevInfo_AddSîvi˚
();

354 
	`Sim∂eProfûe_AddSîvi˚
–
GATT_ALL_SERVICES
 );

355 #i‡
deföed
 
FEATURE_OAD


356 
VOID
 
	`OADT¨gë_AddSîvi˚
();

361 
uöt8
 
ch¨VÆue1
 = 1;

362 
uöt8
 
ch¨VÆue2
 = 2;

363 
uöt8
 
ch¨VÆue3
 = 3;

364 
uöt8
 
ch¨VÆue4
 = 4;

365 
uöt8
 
ch¨VÆue5
[
SIMPLEPROFILE_CHAR5_LEN
] = { 1, 2, 3, 4, 5 };

366 
	`Sim∂eProfûe_SëP¨amëî
–
SIMPLEPROFILE_CHAR1
,  ( 
uöt8
 ), &
ch¨VÆue1
 );

367 
	`Sim∂eProfûe_SëP¨amëî
–
SIMPLEPROFILE_CHAR2
,  ( 
uöt8
 ), &
ch¨VÆue2
 );

368 
	`Sim∂eProfûe_SëP¨amëî
–
SIMPLEPROFILE_CHAR3
,  ( 
uöt8
 ), &
ch¨VÆue3
 );

369 
	`Sim∂eProfûe_SëP¨amëî
–
SIMPLEPROFILE_CHAR4
,  ( 
uöt8
 ), &
ch¨VÆue4
 );

370 
	`Sim∂eProfûe_SëP¨amëî
–
SIMPLEPROFILE_CHAR5
, 
SIMPLEPROFILE_CHAR5_LEN
, 
ch¨VÆue5
 );

374 #i‡
	`deföed
–
CC2540_MINIDK
 )

376 
	`SK_AddSîvi˚
–
GATT_ALL_SERVICES
 );

379 
	`Regi°îF‹Keys
–
sim∂eBLEPîùhîÆ_TaskID
 );

382 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

388 
P0SEL
 = 0;

389 
P1SEL
 = 0;

390 
P2SEL
 = 0;

392 
P0DIR
 = 0xFC;

394 
P1DIR
 = 0xFF;

395 
P2DIR
 = 0x1F;

397 
P0
 = 0x03;

398 
P1
 = 0;

399 
P2
 = 0;

403 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

405 #i‡
deföed
 
FEATURE_OAD


406 #i‡
	`deföed
 (
HAL_IMAGE_A
)

407 
	`HÆLcdWrôeSåögVÆue
–"BLE Pîi-A", 
	`OAD_VER_NUM
–
_imgHdr
.
vî
 ), 16, 
HAL_LCD_LINE_1
 );

409 
	`HÆLcdWrôeSåögVÆue
–"BLE Pîi-B", 
	`OAD_VER_NUM
–
_imgHdr
.
vî
 ), 16, 
HAL_LCD_LINE_1
 );

412 
	`HÆLcdWrôeSåög
–"BLE PîùhîÆ", 
HAL_LCD_LINE_1
 );

418 
VOID
 
	`Sim∂eProfûe_Regi°îAµCBs
–&
sim∂eBLEPîùhîÆ_Sim∂eProfûeCBs
 );

423 
	`HCI_EXT_ClkDivOnHÆtCmd
–
HCI_EXT_ENABLE_CLK_DIVIDE_ON_HALT
 );

425 #i‡
	`deföed
 ( 
DC_DC_P0_7
 )

428 
	`HCI_EXT_M≠PmIoP‹tCmd
–
HCI_EXT_PM_IO_PORT_P0
, 
HCI_EXT_PM_IO_PORT_PIN7
 );

433 
	`oßl_£t_evít
–
sim∂eBLEPîùhîÆ_TaskID
, 
SBP_START_DEVICE_EVT
 );

435 
	}
}

450 
uöt16
 
	$Sim∂eBLEPîùhîÆ_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

453 
VOID
 
èsk_id
;

455 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

457 
uöt8
 *
pMsg
;

459 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
sim∂eBLEPîùhîÆ_TaskID
 )Ë!
NULL
 )

461 
	`sim∂eBLEPîùhîÆ_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

464 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

468  (
evíts
 ^ 
SYS_EVENT_MSG
);

471 i‡–
evíts
 & 
SBP_START_DEVICE_EVT
 )

474 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
sim∂eBLEPîùhîÆ_PîùhîÆCBs
 );

477 
VOID
 
	`GAPB⁄dMgr_Regi°î
–&
sim∂eBLEPîùhîÆ_B⁄dMgrCBs
 );

480 
	`oßl_°¨t_timîEx
–
sim∂eBLEPîùhîÆ_TaskID
, 
SBP_PERIODIC_EVT
, 
SBP_PERIODIC_EVT_PERIOD
 );

482  ( 
evíts
 ^ 
SBP_START_DEVICE_EVT
 );

485 i‡–
evíts
 & 
SBP_PERIODIC_EVT
 )

488 i‡–
SBP_PERIODIC_EVT_PERIOD
 )

490 
	`oßl_°¨t_timîEx
–
sim∂eBLEPîùhîÆ_TaskID
, 
SBP_PERIODIC_EVT
, 
SBP_PERIODIC_EVT_PERIOD
 );

494 
	`≥rf‹mPîiodicTask
();

496  (
evíts
 ^ 
SBP_PERIODIC_EVT
);

499 #i‡
	`deföed
 ( 
PLUS_BROADCASTER
 )

500 i‡–
evíts
 & 
SBP_ADV_IN_CONNECTION_EVT
 )

502 
uöt8
 
tu∫OnAdv
 = 
TRUE
;

504 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
tu∫OnAdv
 );

506  (
evíts
 ^ 
SBP_ADV_IN_CONNECTION_EVT
);

512 
	}
}

523 
	$sim∂eBLEPîùhîÆ_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

525  
pMsg
->
evít
 )

527 #i‡
	`deföed
–
CC2540_MINIDK
 )

528 
KEY_CHANGE
:

529 
	`sim∂eBLEPîùhîÆ_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

537 
	}
}

539 #i‡
deföed
–
CC2540_MINIDK
 )

552 
	$sim∂eBLEPîùhîÆ_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

554 
uöt8
 
SK_Keys
 = 0;

556 
VOID
 
shi·
;

558 i‡–
keys
 & 
HAL_KEY_SW_1
 )

560 
SK_Keys
 |
SK_KEY_LEFT
;

563 i‡–
keys
 & 
HAL_KEY_SW_2
 )

566 
SK_Keys
 |
SK_KEY_RIGHT
;

570 if–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

572 
uöt8
 
cuºít_adv_íabÀd_°©us
;

573 
uöt8
 
√w_adv_íabÀd_°©us
;

576 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
cuºít_adv_íabÀd_°©us
 );

578 if–
cuºít_adv_íabÀd_°©us
 =
FALSE
 )

580 
√w_adv_íabÀd_°©us
 = 
TRUE
;

584 
√w_adv_íabÀd_°©us
 = 
FALSE
;

588 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
√w_adv_íabÀd_°©us
 );

595 
	`SK_SëP¨amëî
–
SK_KEY_ATTR
,  ( 
uöt8
 ), &
SK_Keys
 );

596 
	}
}

608 
	$≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

610  
√wSèã
 )

612 
GAPROLE_STARTED
:

614 
uöt8
 
ownAddªss
[
B_ADDR_LEN
];

615 
uöt8
 
sy°emId
[
DEVINFO_SYSTEM_ID_LEN
];

617 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
ownAddªss
);

620 
sy°emId
[0] = 
ownAddªss
[0];

621 
sy°emId
[1] = 
ownAddªss
[1];

622 
sy°emId
[2] = 
ownAddªss
[2];

625 
sy°emId
[4] = 0x00;

626 
sy°emId
[3] = 0x00;

629 
sy°emId
[7] = 
ownAddªss
[5];

630 
sy°emId
[6] = 
ownAddªss
[4];

631 
sy°emId
[5] = 
ownAddªss
[3];

633 
	`DevInfo_SëP¨amëî
(
DEVINFO_SYSTEM_ID
, 
DEVINFO_SYSTEM_ID_LEN
, 
sy°emId
);

635 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

637 
	`HÆLcdWrôeSåög
–
	`bdAddr2Så
–
ownAddªss
 ), 
HAL_LCD_LINE_2
 );

638 
	`HÆLcdWrôeSåög
–"Inôülized", 
HAL_LCD_LINE_3
 );

643 
GAPROLE_ADVERTISING
:

645 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

646 
	`HÆLcdWrôeSåög
–"Advîtisög", 
HAL_LCD_LINE_3
 );

651 
GAPROLE_CONNECTED
:

653 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

654 
	`HÆLcdWrôeSåög
–"C⁄√˘ed", 
HAL_LCD_LINE_3
 );

659 
GAPROLE_WAITING
:

661 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

662 
	`HÆLcdWrôeSåög
–"Disc⁄√˘ed", 
HAL_LCD_LINE_3
 );

667 
GAPROLE_WAITING_AFTER_TIMEOUT
:

669 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

670 
	`HÆLcdWrôeSåög
–"Timed Out", 
HAL_LCD_LINE_3
 );

675 
GAPROLE_ERROR
:

677 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

678 
	`HÆLcdWrôeSåög
–"Eº‹", 
HAL_LCD_LINE_3
 );

685 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

686 
	`HÆLcdWrôeSåög
–"", 
HAL_LCD_LINE_3
 );

693 
g≠ProfûeSèã
 = 
√wSèã
;

695 #i‡!
	`deföed
–
CC2540_MINIDK
 )

696 
VOID
 
g≠ProfûeSèã
;

701 
	}
}

717 
	$≥rf‹mPîiodicTask
( )

719 
uöt8
 
vÆueToC›y
;

720 
uöt8
 
°©
;

723 
°©
 = 
	`Sim∂eProfûe_GëP¨amëî
–
SIMPLEPROFILE_CHAR3
, &
vÆueToC›y
);

725 if–
°©
 =
SUCCESS
 )

733 
	`Sim∂eProfûe_SëP¨amëî
–
SIMPLEPROFILE_CHAR4
, (
uöt8
), &
vÆueToC›y
);

735 
	}
}

746 
	$sim∂eProfûeCh™geCB
–
uöt8
 
∑ømID
 )

748 
uöt8
 
√wVÆue
;

750  
∑ømID
 )

752 
SIMPLEPROFILE_CHAR1
:

753 
	`Sim∂eProfûe_GëP¨amëî
–
SIMPLEPROFILE_CHAR1
, &
√wVÆue
 );

755 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

756 
	`HÆLcdWrôeSåögVÆue
–"Ch¨ 1:", (
uöt16
)(
√wVÆue
), 10, 
HAL_LCD_LINE_3
 );

761 
SIMPLEPROFILE_CHAR3
:

762 
	`Sim∂eProfûe_GëP¨amëî
–
SIMPLEPROFILE_CHAR3
, &
√wVÆue
 );

764 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

765 
	`HÆLcdWrôeSåögVÆue
–"Ch¨ 3:", (
uöt16
)(
√wVÆue
), 10, 
HAL_LCD_LINE_3
 );

774 
	}
}

776 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

785 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

787 
uöt8
 
i
;

788 
hex
[] = "0123456789ABCDEF";

789 
°r
[
B_ADDR_STR_LEN
];

790 *
pSå
 = 
°r
;

792 *
pSå
++ = '0';

793 *
pSå
++ = 'x';

796 
pAddr
 +
B_ADDR_LEN
;

798  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

800 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

801 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

804 *
pSå
 = 0;

806  
°r
;

807 
	}
}

	@Projects/ble/SimpleBLEPeripheral/Source/simpleBLEPeripheral.h

40 #i‚de‡
SIMPLEBLEPERIPHERAL_H


41 
	#SIMPLEBLEPERIPHERAL_H


	)

43 #ifde‡
__˝lu•lus


58 
	#SBP_START_DEVICE_EVT
 0x0001

	)

59 
	#SBP_PERIODIC_EVT
 0x0002

	)

60 
	#SBP_ADV_IN_CONNECTION_EVT
 0x0004

	)

73 
Sim∂eBLEPîùhîÆ_Inô
–
uöt8
 
èsk_id
 );

78 
uöt16
 
Sim∂eBLEPîùhîÆ_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

83 #ifde‡
__˝lu•lus


	@Projects/ble/Thermometer/Source/OSAL_Thermometer.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 
	~"≥rùhîÆ.h
"

77 
	~"thîmomëî.h
"

84 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

86 
LL_Pro˚ssEvít
,

87 
HÆ_Pro˚ssEvít
,

88 
HCI_Pro˚ssEvít
,

89 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

90 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

92 
L2CAP_Pro˚ssEvít
,

93 
GAP_Pro˚ssEvít
,

94 
GATT_Pro˚ssEvít
,

95 
SM_Pro˚ssEvít
,

96 
GAPRﬁe_Pro˚ssEvít
,

97 
GAPB⁄dMgr_Pro˚ssEvít
,

98 
GATTSîvAµ_Pro˚ssEvít
,

99 
Thîmomëî_Pro˚ssEvít


102 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

103 
uöt16
 *
	gèsksEvíts
;

118 
	$oßlInôTasks
( )

120 
uöt8
 
èskID
 = 0;

122 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

123 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

126 
	`LL_Inô
–
èskID
++ );

129 
	`HÆ_Inô
–
èskID
++ );

132 
	`HCI_Inô
–
èskID
++ );

134 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

136 
	`oßl_CbTimîInô
–
èskID
 );

137 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

141 
	`L2CAP_Inô
–
èskID
++ );

144 
	`GAP_Inô
–
èskID
++ );

147 
	`GATT_Inô
–
èskID
++ );

150 
	`SM_Inô
–
èskID
++ );

153 
	`GAPRﬁe_Inô
–
èskID
++ );

154 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

156 
	`GATTSîvAµ_Inô
–
èskID
++ );

159 
	`Thîmomëî_Inô
–
èskID
 );

160 
	}
}

	@Projects/ble/Thermometer/Source/Thermometer_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

69 
	$maö
()

72 
	`HAL_BOARD_INIT
();

75 
	`InôBﬂrd
–
OB_COLD
 );

78 
	`HÆDrivîInô
();

81 
	`oßl_¢v_öô
();

86 
	`oßl_öô_sy°em
();

89 
	`HAL_ENABLE_INTERRUPTS
();

92 
	`InôBﬂrd
–
OB_READY
 );

94 #i‡
	`deföed
 ( 
POWER_SAVING
 )

95 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

99 
	`oßl_°¨t_sy°em
();

102 
	}
}

	@Projects/ble/Thermometer/Source/thermometer.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OSAL_PwrMgr.h
"

47 
	~"OnBﬂrd.h
"

48 
	~"hÆ_adc.h
"

49 
	~"hÆ_Àd.h
"

50 
	~"hÆ_lcd.h
"

51 
	~"hÆ_key.h
"

52 
	~"g©t.h
"

53 
	~"hci.h
"

54 
	~"g≠g©t£rvî.h
"

55 
	~"g©t£rv≠p.h
"

56 
	~"lökdb.h
"

57 
	~"≥rùhîÆ.h
"

58 
	~"g≠b⁄dmgr.h
"

59 
	~"thîmomëî£rvi˚.h
"

60 
	~"devöfo£rvi˚.h
"

61 
	~"thîmomëî.h
"

62 
	~"timóµ.h
"

63 
	~"OSAL_Clock.h
"

75 
	#DEFAULT_DISCOVERABLE_MODE
 
GAP_ADTYPE_FLAGS_LIMITED


	)

79 
	#PERIODIC_EVT_PERIOD
 1000

	)

82 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

85 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 200

	)

88 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 1600

	)

91 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 1

	)

94 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

97 
	#FLAGS_IDX_MAX
 7

98 

	)

100 
	#B_ADDR_STR_LEN
 15

	)

103 
	#DEFAULT_DISCOVERY_DELAY
 1000

	)

105 
	#TH_STORE_MAX
 3

106 

	)

116 
uöt8
 
	gthîmomëîTaskId
;

119 
uöt16
 
	gg≠C⁄nH™dÀ
;

121 
uöt8
 
	gtimeC⁄figD⁄e
;

136 
g≠rﬁe_Sèãs_t
 
	gg≠ProfûeSèã
 = 
GAPROLE_INIT
;

139 
uöt8
 
	gtimeAµDiscSèã
 = 
DISC_IDLE
;

142 
uöt8
 
	gtimeAµDiscovîyCm∂
 = 
FALSE
;

145 
uöt8
 
	gtimeAµC⁄figSèã
 = 
TIMEAPP_CONFIG_START
;

148 
uöt8
 
	gsˇnRe•⁄£D©a
[] =

151 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

171 
GAP_ADTYPE_SLAVE_CONN_INTERVAL_RANGE
,

172 
LO_UINT16
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
 ),

173 
HI_UINT16
–
DEFAULT_DESIRED_MIN_CONN_INTERVAL
 ),

174 
LO_UINT16
–
DEFAULT_DESIRED_MAX_CONN_INTERVAL
 ),

175 
HI_UINT16
–
DEFAULT_DESIRED_MAX_CONN_INTERVAL
 ),

178 
GAP_ADTYPE_POWER_LEVEL
,

183 
uöt8
 
	gadvîtD©a
[] =

189 
GAP_ADTYPE_FLAGS
,

190 
DEFAULT_DISCOVERABLE_MODE
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

194 
GAP_ADTYPE_16BIT_MORE
,

195 
LO_UINT16
–
THERMOMETER_SERV_UUID
 ),

196 
HI_UINT16
–
THERMOMETER_SERV_UUID
 ),

201 
uöt8
 
	g©tDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "Thermometer Sensor";

204 
uöt8
 
	gtimeAµB⁄dedAddr
[
B_ADDR_LEN
];

207 
uöt8
 
	gœ°C⁄nAddr
[
B_ADDR_LEN
] = {0xf,0xf,0xf,0xf,0xf,0xe};;

209 
boﬁ
 
	gc⁄√˘edToLa°Addªss
 = 
Ál£
;

212 
uöt16
 
	gg≠C⁄nH™dÀ
;

215 
©tH™dÀVÆueInd_t
 
	gthîmomëîMós
;

217 
©tH™dÀVÆueInd_t
 
	gthSt‹eMós
[10];

218 
uöt8
 
	gthSt‹eSèπIndex
 =0;

219 
uöt8
 
	gthSt‹eIndex
 = 0;

221 
©tH™dÀVÆueNŸi_t
 
	gthîmomëîIMós
;

222 
uöt32
 
	gthîmomëîCñcius
 = 0X000173;

223 
boﬁ
 
	gãm≥øtuªMósCh¨C⁄fig
 = 
Ál£
;

224 
boﬁ
 
	gãm≥øtuªIMósCh¨C⁄fig
 = 
Ál£
;

225 
boﬁ
 
	gãm≥øtuªI¡îvÆC⁄fig
 = 
Ál£
;

226 
boﬁ
 
	gthMósTimîRu¬ög
 = 
FALSE
;

229 c⁄° 
uöt8
 
	gthîmomëîFœgs
[
FLAGS_IDX_MAX
] =

231 
THERMOMETER_FLAGS_CELCIUS
 | 
THERMOMETER_FLAGS_TIMESTAMP
 |
THERMOMETER_FLAGS_TYPE
,

232 
THERMOMETER_FLAGS_CELCIUS
 | 
THERMOMETER_FLAGS_TIMESTAMP
,

233 
THERMOMETER_FLAGS_CELCIUS
,

234 
THERMOMETER_FLAGS_FARENHEIT
,

235 
THERMOMETER_FLAGS_FARENHEIT
 | 
THERMOMETER_FLAGS_TIMESTAMP
,

236 
THERMOMETER_FLAGS_FARENHEIT
 | 
THERMOMETER_FLAGS_TIMESTAMP
 | 
THERMOMETER_FLAGS_TYPE
,

241 
uöt8
 
	gthîmomëîFœgsIdx
 = 0;

244 
uöt8
 
	gtimeAµPaúögSèπed
 = 
FALSE
;

247 
boﬁ
 
	gtimeAµB⁄ded
 = 
FALSE
;

250 
uöt8
 
	gtimeAµDiscPo°p⁄ed
 = 
FALSE
;

252 
timeAµPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

253 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 );

254 
timeAµPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 );

256 
thîmomëî_Advîti£
( );

258 
thîmomëîSídSt‹edMós
();

265 
thîmomëîPro˚ssG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

266 
thîmomëî_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

267 
≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

268 
≥rf‹mPîiodicTask
( );

269 
≥rf‹mPîiodicImósTask
( );

270 
thîmomëî_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

271 
thîmomëîMósIndiˇã
();

272 
thîmomëîCB
(
uöt8
 
evít
);

273 
thîmomëîSt‹eIndiˇti⁄s
(
©tH™dÀVÆueInd_t
* 
pInd
);

274 
upd©eUI
( );

281 
g≠RﬁesCBs_t
 
	gthîmomëî_PîùhîÆCBs
 =

283 
≥rùhîÆSèãNŸifiˇti⁄CB
,

284 
NULL


288 
g≠B⁄dCBs_t
 
	gthîmomëî_B⁄dMgrCBs
 =

290 
timeAµPasscodeCB
,

291 
timeAµPaúSèãCB


312 
	$Thîmomëî_Inô
–
uöt8
 
èsk_id
 )

314 
thîmomëîTaskId
 = 
èsk_id
;

324 
uöt8
 
öôül_advîtisög_íabÀ
 = 
FALSE
;

329 
uöt16
 
g≠Rﬁe_AdvîtOffTime
 = 0;

331 
uöt8
 
íabÀ_upd©e_ªque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

332 
uöt16
 
desúed_mö_öãrvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

333 
uöt16
 
desúed_max_öãrvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

334 
uöt16
 
desúed_¶ave_œãncy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

335 
uöt16
 
desúed_c⁄n_timeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

338 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
öôül_advîtisög_íabÀ
 );

339 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
g≠Rﬁe_AdvîtOffTime
 );

341 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
sˇnRe•⁄£D©a
 ), scanResponseData );

342 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
advîtD©a
 ),ádvertData );

344 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
íabÀ_upd©e_ªque°
 );

345 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
desúed_mö_öãrvÆ
 );

346 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
desúed_max_öãrvÆ
 );

347 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
desúed_¶ave_œãncy
 );

348 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
desúed_c⁄n_timeout
 );

352 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
©tDevi˚Name
 );

356 
uöt32
 
∑sskey
 = 0;

357 
uöt8
 
∑úMode
 = 
GAPBOND_PAIRING_MODE_WAIT_FOR_REQ
;

358 
uöt8
 
môm
 = 
FALSE
;

359 
uöt8
 
ioC≠
 = 
GAPBOND_IO_CAP_DISPLAY_ONLY
;

360 
uöt8
 
b⁄dög
 = 
TRUE
;

361 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
,  ( 
uöt32
 ), &
∑sskey
 );

362 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
,  ( 
uöt8
 ), &
∑úMode
 );

363 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
,  ( 
uöt8
 ), &
môm
 );

364 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
,  ( 
uöt8
 ), &
ioC≠
 );

365 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
,  ( 
uöt8
 ), &
b⁄dög
 );

370 
uöt8
 
thîmomëîSôe
 = 
THERMOMETER_TYPE_MOUTH
;

371 
	`Thîmomëî_SëP¨amëî
–
THERMOMETER_TYPE
,  ( 
uöt8
 ), &
thîmomëîSôe
 );

373 
thîmomëîIR™ge_t
 
thîmomëîIR™ge
= {4,60};

374 
	`Thîmomëî_SëP¨amëî
–
THERMOMETER_IRANGE
,  ( 
uöt16
 ), &
thîmomëîIR™ge
 );

378 
timeC⁄figD⁄e
 = 
FALSE
;

381 
VOID
 
	`GATT_InôClõ¡
();

384 
	`GATT_Regi°îF‹Ind
–
thîmomëîTaskId
 );

387 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

388 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

389 
	`Thîmomëî_AddSîvi˚
–
GATT_ALL_SERVICES
 );

390 
	`DevInfo_AddSîvi˚
( );

393 
	`Thîmomëî_Regi°î
 ( 
thîmomëîCB
 );

396 
	`Regi°îF‹Keys
–
thîmomëîTaskId
 );

398 #i‡
	`deföed
–
CC2540_MINIDK
 )

400 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

406 
P0SEL
 = 0;

407 
P1SEL
 = 0;

408 
P2SEL
 = 0;

410 
P0DIR
 = 0xFC;

412 
P1DIR
 = 0xFF;

413 
P2DIR
 = 0x1F;

415 
P0
 = 0x03;

416 
P1
 = 0;

417 
P2
 = 0;

422 
	`oßl_£t_evít
–
thîmomëîTaskId
, 
TH_START_DEVICE_EVT
 );

423 
	}
}

438 
uöt16
 
	$Thîmomëî_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

441 
VOID
 
èsk_id
;

442 
uöt8
 
nŸify_öãrvÆ
;

443 
öt32
 
n32
;

445 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

447 
uöt8
 *
pMsg
;

449 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
thîmomëîTaskId
 )Ë!
NULL
 )

451 
	`thîmomëî_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

454 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

458  (
evíts
 ^ 
SYS_EVENT_MSG
);

461 i‡–
evíts
 & 
TH_START_DEVICE_EVT
 )

464 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
thîmomëî_PîùhîÆCBs
 );

467 
VOID
 
	`GAPB⁄dMgr_Regi°î
–&
thîmomëî_B⁄dMgrCBs
 );

469 
	`upd©eUI
();

471  ( 
evíts
 ^ 
TH_START_DEVICE_EVT
 );

474 i‡–
evíts
 & 
TH_START_DISCOVERY_EVT
 )

476 i‡–
timeAµPaúögSèπed
 )

479 
timeAµDiscPo°p⁄ed
 = 
TRUE
;

483 
timeAµDiscSèã
 = 
	`timeAµDiscSèπ
();

486 
timeAµDiscSèã
 = 
	`timeAµDiscSèπ
();

488  ( 
evíts
 ^ 
TH_START_DISCOVERY_EVT
 );

492 i‡–
evíts
 & 
TH_PERIODIC_MEAS_EVT
 )

495 
	`≥rf‹mPîiodicTask
();

496  (
evíts
 ^ 
TH_PERIODIC_MEAS_EVT
);

499 i‡–
evíts
 & 
TH_PERIODIC_IMEAS_EVT
 )

502 
	`≥rf‹mPîiodicImósTask
();

503  (
evíts
 ^ 
TH_PERIODIC_IMEAS_EVT
);

507 i‡–
evíts
 & 
TH_DISCONNECT_EVT
 )

510 
uöt8
 
advE«bÀ
 = 
FALSE
;

513 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advE«bÀ
 );

516 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

518  (
evíts
 ^ 
TH_DISCONNECT_EVT
);

521 i‡–
evíts
 & 
TH_CCC_UPDATE_EVT
 )

524 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

526 
ãm≥øtuªMósCh¨C⁄fig
 = 
åue
;

529 if–
c⁄√˘edToLa°Addªss
 =
åue
)

532 
	`thîmomëîSídSt‹edMós
();

536 if(
thMósTimîRu¬ög
 =
FALSE
)

539 
	`Thîmomëî_GëP¨amëî
–
THERMOMETER_INTERVAL
, &
nŸify_öãrvÆ
 );

540 
n32
 = ((
uöt32
)(
nŸify_öãrvÆ
)) * (1000);

543 i‡(
n32
 !=0)

546 
	`oßl_°¨t_timîEx
–
thîmomëîTaskId
, 
TH_PERIODIC_MEAS_EVT
, 
n32
 );

547 
thMósTimîRu¬ög
 = 
TRUE
;

550  (
evíts
 ^ 
TH_CCC_UPDATE_EVT
);

554 
	}
}

565 
	$thîmomëî_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

567  
pMsg
->
evít
 )

569 
KEY_CHANGE
:

570 
	`thîmomëî_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

572 
GATT_MSG_EVENT
:

573 
	`thîmomëîPro˚ssG©tMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

579 
	}
}

593 
	$thîmomëî_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

596 
bSètus_t
 
°©us
;

597 
uöt8
 
nŸify_öãrvÆ
;

599 i‡–
keys
 & 
HAL_KEY_SW_1
 )

602 
thîmomëîFœgsIdx
+=1;

604 i‡(
thîmomëîFœgsIdx
 =
FLAGS_IDX_MAX
)

606 
thîmomëîFœgsIdx
 = 0;

612 
	`Thîmomëî_GëP¨amëî
–
THERMOMETER_INTERVAL
, &
nŸify_öãrvÆ
 );

614 if(
nŸify_öãrvÆ
 == 0)

616 
thMósTimîRu¬ög
 = 
FALSE
;

619 i‡–
keys
 & 
HAL_KEY_SW_2
 )

623 if((
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
Ë&& (
thMósTimîRu¬ög
 =
FALSE
))

625 
uöt8
 
cuºít_adv_íabÀd_°©us
;

626 
uöt8
 
√w_adv_íabÀd_°©us
;

629 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
cuºít_adv_íabÀd_°©us
 );

631 if–
cuºít_adv_íabÀd_°©us
 =
FALSE
 )

633 
√w_adv_íabÀd_°©us
 = 
TRUE
;

637 
√w_adv_íabÀd_°©us
 = 
FALSE
;

641 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
√w_adv_íabÀd_°©us
 );

646 if((
thîmomëîCñcius
) < 0X000175)

648 
thîmomëîCñcius
 +=1;

652 
uöt8
 
thI¡îvÆ
 = 30;

653 
©tH™dÀVÆueInd_t
 
öãrvÆIndiˇti⁄
;

655 
thîmomëîCñcius
 = 0X000173;

658 
	`Thîmomëî_SëP¨amëî
–
THERMOMETER_INTERVAL
, 
THERMOMETER_INTERVAL_LEN
, &
thI¡îvÆ
 );

660 if(
ãm≥øtuªI¡îvÆC⁄fig
 =
åue
)

662 
öãrvÆIndiˇti⁄
.
vÆue
[0] = 
thI¡îvÆ
;

663 
öãrvÆIndiˇti⁄
.
h™dÀ
 = 
THERMOMETER_INTERVAL_VALUE_POS
;

665 
°©us
 = 
	`Thîmomëî_I¡îvÆIndiˇã
–
g≠C⁄nH™dÀ
, &
öãrvÆIndiˇti⁄
, 
thîmomëîTaskId
 );

668 i‡(
°©us
 !
SUCCESS
)

671 
	`thîmomëîSt‹eIndiˇti⁄s
(&
öãrvÆIndiˇti⁄
);

677 
	}
}

687 
	$thîmomëî_Advîti£
( )

691 if–
g≠ProfûeSèã
 !
GAPROLE_CONNECTED
 )

693 
uöt8
 
cuºít_adv_íabÀd_°©us
;

694 
uöt8
 
√w_adv_íabÀd_°©us
;

697 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
cuºít_adv_íabÀd_°©us
 );

699 if–
cuºít_adv_íabÀd_°©us
 =
FALSE
 )

701 
√w_adv_íabÀd_°©us
 = 
TRUE
;

705 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
√w_adv_íabÀd_°©us
 );

707 
	}
}

716 
	$thîmomëîPro˚ssG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

721 if–
pMsg
->
mëhod
 ==
ATT_HANDLE_VALUE_CFM
)

723 
	`thîmomëîSídSt‹edMós
();

726 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_NOTI
 ||

727 
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_IND
 )

729 
	`timeAµIndG©tMsg
–
pMsg
 );

731 i‡–
pMsg
->
mëhod
 =
ATT_READ_RSP
 ||

732 
pMsg
->
mëhod
 =
ATT_WRITE_RSP
 )

734 
timeAµC⁄figSèã
 = 
	`timeAµC⁄figG©tMsg
 (ÅimeAµC⁄figSèã, 
pMsg
 );

735 i‡–
timeAµC⁄figSèã
 =
TIMEAPP_CONFIG_CMPL
 )

737 
timeAµDiscovîyCm∂
 = 
TRUE
;

742 
timeAµDiscSèã
 = 
	`timeAµDiscG©tMsg
–timeAµDiscSèã, 
pMsg
 );

743 i‡–
timeAµDiscSèã
 =
DISC_IDLE
 )

746 
timeAµC⁄figSèã
 = 
	`timeAµC⁄figNext
–
TIMEAPP_CONFIG_START
 );

749 
	}
}

758 
	$timeAµDisc⁄√˘ed
( )

761 
timeAµDiscSèã
 = 
DISC_IDLE
;

762 
timeAµPaúögSèπed
 = 
FALSE
;

763 
timeAµDiscPo°p⁄ed
 = 
FALSE
;

764 
	}
}

775 
	$≥rùhîÆSèãNŸifiˇti⁄CB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

779 i‡–
√wSèã
 =
GAPROLE_CONNECTED
 )

781 
lökDBIãm_t
 *
pIãm
;

784 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_CONNHANDLE
, &
g≠C⁄nH™dÀ
 );

787 i‡–(
pIãm
 = 
	`lökDB_Föd
–
g≠C⁄nH™dÀ
 )Ë!
NULL
)

790 i‡–!
	`oßl_memcmp
–
pIãm
->
addr
, 
timeAµB⁄dedAddr
, 
B_ADDR_LEN
 ) )

792 
timeAµDiscovîyCm∂
 = 
FALSE
;

796 
timeAµDiscovîyCm∂
 = 
TRUE
;

800 if(
	`oßl_memcmp
–
pIãm
->
addr
, 
œ°C⁄nAddr
, 
B_ADDR_LEN
 ))

802 
timeAµDiscovîyCm∂
 = 
TRUE
;

803 
c⁄√˘edToLa°Addªss
 = 
åue
;

808 
	`oßl_mem˝y
(
œ°C⁄nAddr
, 
pIãm
->
addr
, 
B_ADDR_LEN
 );

812 i‡–
timeAµDiscovîyCm∂
 =
FALSE
 )

814 
	`oßl_°¨t_timîEx
–
thîmomëîTaskId
, 
TH_START_DISCOVERY_EVT
, 
DEFAULT_DISCOVERY_DELAY
 );

818 
	`oßl_°¨t_timîEx
–
thîmomëîTaskId
, 
TH_DISCONNECT_EVT
, 20000 );

823 i‡–
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
 &&

824 
√wSèã
 !
GAPROLE_CONNECTED
 )

826 
	`timeAµDisc⁄√˘ed
();

829 
	`oßl_°›_timîEx
–
thîmomëîTaskId
, 
TH_PERIODIC_IMEAS_EVT
 );

833 i‡–
√wSèã
 =
GAPROLE_STARTED
 )

836 
	`timeAµClockInô
();

839 
g≠ProfûeSèã
 = 
√wSèã
;

841 
	`upd©eUI
();

843 
	}
}

852 
	$thîmomëîSídSt‹edMós
()

854 
bSètus_t
 
°©us
;

857 if(
thSt‹eSèπIndex
 !
thSt‹eIndex
 )

860 
°©us
 = 
	`Thîmomëî_TempIndiˇã
–
g≠C⁄nH™dÀ
, &
thSt‹eMós
[
thSt‹eSèπIndex
], 
thîmomëîTaskId
);

862 if(
°©us
 =
SUCCESS
)

864 
thSt‹eSèπIndex
 =ÅhStoreStartIndex +1;

867 if(
thSt‹eSèπIndex
 > 
TH_STORE_MAX
)

869 
thSt‹eSèπIndex
 = 0;

873 
	}
}

882 
	$thîmomëîMósIndiˇã
()

886 
uöt8
 *
p
 = 
thîmomëîMós
.
vÆue
;

889 
uöt32
 
ãm≥øtuª
;

892 
uöt8
 
Êags
 = 
thîmomëîFœgs
[
thîmomëîFœgsIdx
];

895 *
p
++ = 
Êags
;

897 if(
Êags
 & 
THERMOMETER_FLAGS_FARENHEIT
)

899 
ãm≥øtuª
 = (
thîmomëîCñcius
 *9/5) +320;

903 
ãm≥øtuª
 = 
thîmomëîCñcius
;

906 
ãm≥øtuª
 = 0xFF000000 |Åemperature;

909 
	`oßl_buf„r_uöt32
–
p
, 
ãm≥øtuª
 );

912 *
p
++;

913 *
p
++;

914 *
p
++;

915 *
p
++;

918 i‡(
Êags
 & 
THERMOMETER_FLAGS_TIMESTAMP
)

921 
UTCTimeSåu˘
 
time
;

924 
	`oßl_C⁄vîtUTCTime
–&
time
, 
	`oßl_gëClock
() );

926 *
p
++ = (
time
.
yór
 & 0x00FF);

927 *
p
++ = (
time
.
yór
 & 0xFF00)>>8;

931 *
p
++=
time
.
m⁄th
;

932 *
p
++=
time
.
day
;

933 *
p
++=
time
.
hour
;

934 *
p
++=
time
.
möuãs
;

935 *
p
++=
time
.
£c⁄ds
;

938 if(
Êags
 & 
THERMOMETER_FLAGS_TYPE
)

940 
uöt8
 
sôe
;

941 
	`Thîmomëî_GëP¨amëî
–
THERMOMETER_TYPE
, &
sôe
 );

942 *
p
++ = 
sôe
;

945 
thîmomëîMós
.
Àn
 = (
uöt8
Ë(
p
 -ÅhîmomëîMós.
vÆue
);

946 
thîmomëîMós
.
h™dÀ
 = 
THERMOMETER_TEMP_VALUE_POS
;

949 
	`thîmomëîSt‹eIndiˇti⁄s
–&
thîmomëîMós
);

952 
	`thîmomëî_Advîti£
();

953 
	}
}

963 
	$thîmomëîSt‹eIndiˇti⁄s
(
©tH™dÀVÆueInd_t
* 
pInd
)

967 
	`oßl_mem˝y
–&
thSt‹eMós
[
thSt‹eIndex
], 
pInd
, –
©tH™dÀVÆueInd_t
 ) );

970 
thSt‹eIndex
 =ÅhStoreIndex +1;

971 if(
thSt‹eIndex
 > 
TH_STORE_MAX
)

973 
thSt‹eIndex
 = 0;

976 if(
thSt‹eIndex
 =
thSt‹eSèπIndex
)

978 
thSt‹eSèπIndex
 =ÅhStoreStartIndex +1;

979 if(
thSt‹eSèπIndex
 > 
TH_STORE_MAX
)

981 
thSt‹eSèπIndex
 = 0;

984 
	}
}

993 
	$thîmomëîImósNŸify
()

997 
uöt8
 *
p
 = 
thîmomëîIMós
.
vÆue
;

1000 
uöt32
 
ãm≥øtuª
;

1003 
uöt8
 
Êags
 = 
thîmomëîFœgs
[
thîmomëîFœgsIdx
];

1006 *
p
++ = 
Êags
;

1008 if(
Êags
 & 
THERMOMETER_FLAGS_FARENHEIT
)

1010 
ãm≥øtuª
 = (
thîmomëîCñcius
 *9/5) +320;

1014 
ãm≥øtuª
 = 
thîmomëîCñcius
;

1017 
ãm≥øtuª
 = 0xFF000000 |Åemperature;

1020 
	`oßl_buf„r_uöt32
–
p
, 
ãm≥øtuª
 );

1023 
p
+=4;

1025 if(
Êags
 & 
THERMOMETER_FLAGS_TYPE
)

1027 
uöt8
 
sôe
;

1028 
	`Thîmomëî_GëP¨amëî
–
THERMOMETER_TYPE
, &
sôe
 );

1029 *
p
++ = 
sôe
;

1032 
thîmomëîIMós
.
Àn
 = (
uöt8
Ë(
p
 -ÅhîmomëîIMós.
vÆue
);

1034 if(
ãm≥øtuªIMósCh¨C⁄fig
 =
åue
)

1036 
	`Thîmomëî_IMósNŸify
–
g≠C⁄nH™dÀ
, &
thîmomëîIMós
);

1038 
	}
}

1049 
	$thîmomëîCB
(
uöt8
 
evít
)

1053 
evít
)

1055 
THERMOMETER_TEMP_IND_ENABLED
:

1056 
	`oßl_£t_evít
–
thîmomëîTaskId
, 
TH_CCC_UPDATE_EVT
 );

1059 
THERMOMETER_TEMP_IND_DISABLED
:

1060 
ãm≥øtuªMósCh¨C⁄fig
 = 
Ál£
;

1061 
	`oßl_°›_timîEx
–
thîmomëîTaskId
, 
TH_PERIODIC_MEAS_EVT
 );

1062 
thMósTimîRu¬ög
 = 
FALSE
;

1065 
THERMOMETER_IMEAS_NOTI_ENABLED
:

1066 
ãm≥øtuªIMósCh¨C⁄fig
 = 
åue
;

1067 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

1069 
	`oßl_°¨t_timîEx
–
thîmomëîTaskId
, 
TH_PERIODIC_IMEAS_EVT
, 1000 );

1073 
THERMOMETER_IMEAS_NOTI_DISABLED
:

1074 
ãm≥øtuªIMósCh¨C⁄fig
 = 
Ál£
;

1075 
	`oßl_°›_timîEx
–
thîmomëîTaskId
, 
TH_PERIODIC_IMEAS_EVT
 );

1078 
THERMOMETER_INTERVAL_IND_ENABLED
:

1079 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

1081 
ãm≥øtuªI¡îvÆC⁄fig
 = 
åue
;

1085 
THERMOMETER_INTERVAL_IND_DISABLED
:

1086 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

1088 
ãm≥øtuªI¡îvÆC⁄fig
 = 
Ál£
;

1095 
	}
}

1106 
	$≥rf‹mPîiodicTask
( )

1108 
uöt8
 
nŸify_öãrvÆ
;

1109 
öt32
 
n32
;

1112 if(
ãm≥øtuªMósCh¨C⁄fig
 =
åue
)

1115 
	`Thîmomëî_GëP¨amëî
–
THERMOMETER_INTERVAL
, &
nŸify_öãrvÆ
 );

1117 
n32
 = ((
uöt32
)(
nŸify_öãrvÆ
)) * (1000);

1120 if–
n32
 != 0)

1123 
	`thîmomëîMósIndiˇã
();

1126 
	`oßl_°¨t_timîEx
–
thîmomëîTaskId
, 
TH_PERIODIC_MEAS_EVT
, 
n32
 );

1129 
	}
}

1139 
	$≥rf‹mPîiodicImósTask
( )

1142 i‡(
g≠ProfûeSèã
 =
GAPROLE_CONNECTED
)

1145 
	`thîmomëîImósNŸify
();

1148 
	`oßl_°¨t_timîEx
–
thîmomëîTaskId
, 
TH_PERIODIC_IMEAS_EVT
, 1000 );

1150 
	}
}

1159 
	$timeAµPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

1160 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 )

1163 
	`GAPB⁄dMgr_PasscodeR•
–
c⁄√˘i⁄H™dÀ
, 
SUCCESS
, 0 );

1164 
	}
}

1173 
	$timeAµPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 )

1175 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_STARTED
 )

1177 
timeAµPaúögSèπed
 = 
TRUE
;

1179 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_COMPLETE
 )

1181 
timeAµPaúögSèπed
 = 
FALSE
;

1183 i‡–
°©us
 =
SUCCESS
 )

1185 
lökDBIãm_t
 *
pIãm
;

1187 i‡–(
pIãm
 = 
	`lökDB_Föd
–
g≠C⁄nH™dÀ
 )Ë!
NULL
 )

1190 
timeAµB⁄ded
 = ( (
pIãm
->
°©eFœgs
 & 
LINK_BOUND
) == LINK_BOUND );

1192 i‡–
timeAµB⁄ded
 )

1194 
	`oßl_mem˝y
–
timeAµB⁄dedAddr
, 
pIãm
->
addr
, 
B_ADDR_LEN
 );

1199 i‡–
timeAµDiscPo°p⁄ed
 && 
timeAµDiscovîyCm∂
 =
FALSE
 )

1201 
timeAµDiscPo°p⁄ed
 = 
FALSE
;

1202 
	`oßl_£t_evít
–
thîmomëîTaskId
, 
TH_START_DISCOVERY_EVT
 );

1207 
	}
}

1210 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

1219 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

1221 
uöt8
 
i
;

1222 
hex
[] = "0123456789ABCDEF";

1223 
°r
[
B_ADDR_STR_LEN
];

1224 *
pSå
 = 
°r
;

1226 *
pSå
++ = '0';

1227 *
pSå
++ = 'x';

1230 
pAddr
 +
B_ADDR_LEN
;

1232  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

1234 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

1235 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

1238 *
pSå
 = 0;

1240  
°r
;

1241 
	}
}

1253 
	$upd©eUI
( )

1256 
	`LCD_WRITE_STRING
–"Thîmomëî", 
HAL_LCD_LINE_1
 );

1258 
uöt8
 
ownAddªss
[
B_ADDR_LEN
];

1260 #i‡(
deföed
 
HAL_LCD
Ë&& (HAL_LCD =
TRUE
)

1262 
uöt16
 
cou¡
 =0;

1265 if–
thSt‹eIndex
 > 
thSt‹eSèπIndex
 )

1267 
cou¡
 = 
thSt‹eIndex
 - 
thSt‹eSèπIndex
;

1270 if–
thSt‹eSèπIndex
 > 
thSt‹eIndex
 )

1272 
cou¡
 = ( 
TH_STORE_MAX
-
thSt‹eSèπIndex
 ) + 
thSt‹eIndex
+1;

1277 
g≠ProfûeSèã
)

1279 
GAPROLE_INIT
:

1280 
	`LCD_WRITE_STRING
–"Inôülized", 
HAL_LCD_LINE_2
 );

1282 
GAPROLE_STARTED
:

1283 
	`LCD_WRITE_STRING
–"Sèπed", 
HAL_LCD_LINE_2
 );

1284 
	`GAPRﬁe_GëP¨amëî
(
GAPROLE_BD_ADDR
, 
ownAddªss
);

1285 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
ownAddªss
 ), 
HAL_LCD_LINE_3
 );

1287 
GAPROLE_ADVERTISING
:

1288 
	`LCD_WRITE_STRING
–"Advîtisög", 
HAL_LCD_LINE_2
 );

1289 
	`LCD_WRITE_STRING
–" ", 
HAL_LCD_LINE_3
 );

1290 
	`LCD_WRITE_STRING_VALUE
("St‹ed", 
cou¡
, 10, 
HAL_LCD_LINE_3
 );

1292 
GAPROLE_WAITING
:

1293 
GAPROLE_WAITING_AFTER_TIMEOUT
:

1294 
	`LCD_WRITE_STRING
–"Waôög ", 
HAL_LCD_LINE_2
 );

1295 
	`LCD_WRITE_STRING_VALUE
("St‹ed", 
cou¡
, 10, 
HAL_LCD_LINE_3
 );

1297 
GAPROLE_CONNECTED
:

1298 
	`LCD_WRITE_STRING
–"C⁄√˘ed ", 
HAL_LCD_LINE_2
 );

1300 
GAPROLE_ERROR
:

1301 
	`LCD_WRITE_STRING
–"Eº‹ ", 
HAL_LCD_LINE_2
 );

1307 
	}
}

	@Projects/ble/Thermometer/Source/thermometer.h

40 #i‚de‡
THERMOMETER_H


41 
	#THERMOMETER_H


	)

43 #ifde‡
__˝lu•lus


58 
	#TH_START_DEVICE_EVT
 0x0001

	)

59 
	#TH_PERIODIC_MEAS_EVT
 0x0002

	)

60 
	#TH_ADV_IN_CONNECTION_EVT
 0x0004

	)

61 
	#TH_PERIODIC_IMEAS_EVT
 0x0008

	)

62 
	#TH_START_DISCOVERY_EVT
 0x0010

	)

63 
	#TH_CLOCK_UPDATE_EVT
 0x0020

	)

64 
	#TH_DISCONNECT_EVT
 0x0040

	)

65 
	#TH_CCC_UPDATE_EVT
 0x0080

	)

71 #i‡
HAL_LCD
 =
TRUE


72 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
Ë
	`HÆLcdWrôeSåög
–(°r), (›ti⁄))

	)

73 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
Ë
	`HÆLcdWrôeS¸ìn
–÷öe1), (löe2Ë)

	)

74 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
Ë
	`HÆLcdWrôeSåögVÆue
–—ôÀ), (vÆue), (f‹m©), (löeË)

	)

76 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
)

	)

77 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
)

	)

78 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
)

	)

93 
Thîmomëî_Inô
–
uöt8
 
èsk_id
 );

98 
uöt16
 
Thîmomëî_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

105 #ifde‡
__˝lu•lus


	@Projects/ble/Thermometer/Source/timeapp.h

40 #i‚de‡
TIMEAPP_H


41 
	#TIMEAPP_H


	)

43 
	~"g©t.h
"

45 #ifde‡
__˝lu•lus


61 
DISC_IDLE
 = 0x00,

62 
DISC_CURR_TIME_START
 = 0x10,

63 
DISC_CURR_TIME_SVC
,

64 
DISC_CURR_TIME_CHAR
,

65 
DISC_CURR_TIME_CT_TIME_CCCD
,

66 
DISC_FAILED
 = 0xFF

72 
HDL_CURR_TIME_CT_TIME_START
,

73 
HDL_CURR_TIME_CT_TIME_END
,

74 
HDL_CURR_TIME_CT_TIME_CCCD
,

75 
HDL_CACHE_LEN


79 
	#TIMEAPP_CONFIG_START
 0x00

	)

80 
	#TIMEAPP_CONFIG_CMPL
 0xFF

	)

92 
uöt8
 
thîmomëîTaskId
;

95 
uöt16
 
g≠C⁄nH™dÀ
;

98 
uöt16
 
timeAµHdlCache
[
HDL_CACHE_LEN
];

101 
uöt8
 
timeC⁄figD⁄e
;

110 
TimeAµ_Inô
–
uöt8
 
èsk_id
 );

115 
uöt16
 
TimeAµ_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

120 
timeAµClockInô
( );

121 
timeAµClockSë
–
uöt8
 *
pD©a
 );

126 
uöt8
 
timeAµDiscSèπ
( );

127 
uöt8
 
timeAµDiscG©tMsg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

132 
uöt8
 
timeAµC⁄figNext
–uöt8 
°©e
 );

133 
uöt8
 
timeAµC⁄figG©tMsg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

138 
timeAµIndG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

143 #ifde‡
__˝lu•lus


	@Projects/ble/Thermometer/Source/timeapp_clock.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Clock.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"timóµ.h
"

92 
	$timeAµClockInô
( )

96 
	}
}

107 
	$timeAµClockSë
–
uöt8
 *
pD©a
 )

109 
UTCTimeSåu˘
 
time
;

112 
time
.
yór
 = 
	`BUILD_UINT16
(
pD©a
[0],ÖData[1]);

113 i‡–
time
.
yór
 == 0 )

115 
time
.
yór
 = 2000;

117 
pD©a
 += 2;

118 
time
.
m⁄th
 = *
pD©a
++;

119 i‡–
time
.
m⁄th
 > 0 )

123 
time
.
day
 = *
pD©a
++;

124 i‡–
time
.
day
 > 0 )

128 
time
.
hour
 = *
pD©a
++;

129 
time
.
möuãs
 = *
pD©a
++;

130 
time
.
£c⁄ds
 = *
pD©a
;

133 
	`oßl_£tClock
–
	`oßl_C⁄vîtUTCSecs
–&
time
 ) );

135 
	}
}

	@Projects/ble/Thermometer/Source/timeapp_config.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OnBﬂrd.h
"

46 
	~"g©t.h
"

47 
	~"g©t_uuid.h
"

48 
	~"g©t£rv≠p.h
"

49 
	~"timóµ.h
"

56 
	#TIMEAPP_CONFIG_MAX
 ( (
timeAµC⁄figLi°
Ë/ (
uöt8
Ë)

	)

64 c⁄° 
uöt8
 
	gtimeAµC⁄figLi°
[] =

66 
HDL_CURR_TIME_CT_TIME_START
,

67 
HDL_CURR_TIME_CT_TIME_CCCD
,

91 
uöt8
 
	gtimeC⁄figD⁄e
;

107 
uöt8
 
	$timeAµC⁄figNext
–
uöt8
 
°©e
 )

109 
©tRódReq_t
 
ªadReq
;

110 
©tWrôeReq_t
 
wrôeReq
;

111 
boﬁ
 
ªad
;

114  
°©e
 < 
TIMEAPP_CONFIG_MAX
 &&

115 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]] == 0 )

117 
°©e
++;

121 i‡–
°©e
 =
TIMEAPP_CONFIG_MAX
 )

123  
TIMEAPP_CONFIG_CMPL
;

127  
timeAµC⁄figLi°
[
°©e
] )

130 
HDL_CURR_TIME_CT_TIME_START
:

131 
ªad
 = 
TRUE
;

135 
HDL_CURR_TIME_CT_TIME_CCCD
:

137 
ªad
 = 
FALSE
;

138 
wrôeReq
.
Àn
 = 2;

139 
wrôeReq
.
vÆue
[0] = 
	`LO_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

140 
wrôeReq
.
vÆue
[1] = 
	`HI_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

141 
wrôeReq
.
sig
 = 0;

142 
wrôeReq
.
cmd
 = 0;

149 if(
timeC⁄figD⁄e
==
TRUE
)

151  
°©e
;

155 i‡–
ªad
 )

157 
ªadReq
.
h™dÀ
 = 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]];

158 
	`GATT_RódCh¨VÆue
–
g≠C⁄nH™dÀ
, &
ªadReq
, 
thîmomëîTaskId
 );

161 
timeC⁄figD⁄e
 = 
TRUE
;

165 
wrôeReq
.
h™dÀ
 = 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]];

166 
	`GATT_WrôeCh¨VÆue
–
g≠C⁄nH™dÀ
, &
wrôeReq
, 
thîmomëîTaskId
 );

169  
°©e
;

170 
	}
}

182 
uöt8
 
	$timeAµC⁄figG©tMsg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

185 i‡–(
pMsg
->
mëhod
 =
ATT_READ_RSP
 ||ÖMsg->mëhod =
ATT_WRITE_RSP
) &&

186 (
pMsg
->
hdr
.
°©us
 =
SUCCESS
) )

189  
timeAµC⁄figLi°
[
°©e
] )

191 
HDL_CURR_TIME_CT_TIME_START
:

193 
	`timeAµClockSë
–
pMsg
->
msg
.
ªadR•
.
vÆue
 );

200  
	`timeAµC⁄figNext
–
°©e
 + 1 );

201 
	}
}

	@Projects/ble/Thermometer/Source/timeapp_discovery.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OnBﬂrd.h
"

46 
	~"g©t.h
"

47 
	~"g©t_uuid.h
"

48 
	~"timóµ.h
"

49 
	~"b©t£rvi˚.h
"

56 
	#CURRENT_TIME_SVC_UUID
 0x1805

	)

59 
	#CT_TIME_UUID
 0x2A2B

60 

	)

62 
	#CHAR_DESC_HDL_UUID16_LEN
 7

	)

81 
uöt16
 
	gtimeAµHdlCache
[
HDL_CACHE_LEN
];

92 
uöt16
 
	gtimeAµSvcSèπHdl
;

93 
uöt16
 
	gtimeAµSvcEndHdl
;

94 
uöt8
 
	gtimeAµEndHdlIdx
;

100 
uöt8
 
TimeAµDiscCuºTime
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

110 
uöt8
 
	$timeAµDiscSèπ
( )

113 
	`oßl_mem£t
–
timeAµHdlCache
, 0, (timeAppHdlCache) );

116  
	`timeAµDiscG©tMsg
–
DISC_CURR_TIME_START
, 
NULL
 );

117 
	}
}

129 
uöt8
 
	$timeAµDiscG©tMsg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

134  
°©e
 & 0xF0 )

137 
DISC_CURR_TIME_START
:

138 
°©e
 = 
	`TimeAµDiscCuºTime
–°©e, 
pMsg
 );

139 i‡–
°©e
 =
DISC_FAILED
 )

141 
°©e
 = 
DISC_FAILED
;

143 i‡–
°©e
 =
DISC_IDLE
 )

145 
°©e
 = 
DISC_IDLE
;

153 }  (
°©e
 != 0) && ((state & 0x0F) == 0) );

155  
°©e
;

156 
	}
}

168 
uöt8
 
	$TimeAµDiscCuºTime
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

170 
uöt8
 
√wSèã
 = 
°©e
;

172  
°©e
 )

174 
DISC_CURR_TIME_START
:

176 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
CURRENT_TIME_SVC_UUID
),

177 
	`HI_UINT16
(
CURRENT_TIME_SVC_UUID
) };

180 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

181 
timeAµEndHdlIdx
 = 0;

184 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
g≠C⁄nH™dÀ
, 
uuid
,

185 
ATT_BT_UUID_SIZE
, 
thîmomëîTaskId
 );

187 
√wSèã
 = 
DISC_CURR_TIME_SVC
;

191 
DISC_CURR_TIME_SVC
:

193 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

194 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

196 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

197 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

201 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

202 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

203 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

206 i‡–
timeAµSvcSèπHdl
 != 0 )

209 
	`GATT_DiscAŒCh¨s
–
g≠C⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

210 
timeAµSvcEndHdl
, 
thîmomëîTaskId
 );

212 
√wSèã
 = 
DISC_CURR_TIME_CHAR
;

217 
√wSèã
 = 
DISC_FAILED
;

222 
DISC_CURR_TIME_CHAR
:

225 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

226 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

227 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
)

229 
uöt8
 
i
;

230 
uöt8
 *
p
;

231 
uöt16
 
h™dÀ
;

232 
uöt16
 
uuid
;

234 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

235  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

238 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

239 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

242 i‡–
timeAµEndHdlIdx
 != 0 )

245 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
	`BUILD_UINT16
(
p
[0],Ö[1]) - 1;

247 
timeAµEndHdlIdx
 = 0;

251  
uuid
 )

253 
CT_TIME_UUID
:

254 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] = 
h™dÀ
;

255 
timeAµEndHdlIdx
 = 
HDL_CURR_TIME_CT_TIME_END
;

262 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

268 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

269 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

270 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

273 i‡–
timeAµEndHdlIdx
 != 0 )

275 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
timeAµSvcEndHdl
;

276 
timeAµEndHdlIdx
 = 0;

280 i‡–
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] == 0 )

282 
√wSèã
 = 
DISC_FAILED
;

285 i‡–
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] <timeAµHdlCache[
HDL_CURR_TIME_CT_TIME_END
] )

288 
	`GATT_DiscAŒCh¨Descs
–
g≠C⁄nH™dÀ
,

289 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] + 1,

290 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_END
],

291 
thîmomëîTaskId
 );

293 
√wSèã
 = 
DISC_CURR_TIME_CT_TIME_CCCD
;

297 
√wSèã
 = 
DISC_IDLE
;

303 
DISC_CURR_TIME_CT_TIME_CCCD
:

306 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

307 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

308 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

310 
uöt8
 
i
;

312  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

315 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

316 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

317 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

318 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

321 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_CCCD
] =

322 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

330 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

331 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

332 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

334 
√wSèã
 = 
DISC_IDLE
;

343  
√wSèã
;

344 
	}
}

	@Projects/ble/Thermometer/Source/timeapp_ind.c

43 
	~"°rög.h
"

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"timóµ.h
"

57 
	#ALERT_CAT_ID_MAX
 9

	)

60 
	#ALERT_MAJOR_CAT
(
x
Ë–(xË>> 3 )

	)

63 
	#ALERT_SUBCAT
(
x
Ë–(xË& 0x07 )

	)

103 
	$timeAµIndG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

105 
uöt8
 
i
;

108  
i
 = 0; i < 
HDL_CACHE_LEN
; i++ )

110 i‡–
pMsg
->
msg
.
h™dÀVÆueNŸi
.
h™dÀ
 =
timeAµHdlCache
[
i
] )

117  
i
 )

119 
HDL_CURR_TIME_CT_TIME_START
:

121 
	`timeAµClockSë
–
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
 );

130 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_IND
 )

132 
	`ATT_H™dÀVÆueCfm
–
pMsg
->
c⁄nH™dÀ
 );

134 
	}
}

	@Projects/ble/TimeApp/Source/OSAL_timeapp.c

43 
	~"hÆ_ty≥s.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Tasks.h
"

48 
	~"hÆ_drivîs.h
"

51 
	~"Œ.h
"

54 
	~"hci_é.h
"

56 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

57 
	~"oßl_cbTimî.h
"

61 
	~"l2ˇp.h
"

64 
	~"g≠.h
"

65 
	~"g≠g©t£rvî.h
"

66 
	~"g≠b⁄dmgr.h
"

69 
	~"g©t.h
"

71 
	~"g©t£rv≠p.h
"

74 
	~"≥rùhîÆ.h
"

77 
	~"timóµ.h
"

84 c⁄° 
pTaskEvítH™dÀrFn
 
	gèsksAº
[] =

86 
LL_Pro˚ssEvít
,

87 
HÆ_Pro˚ssEvít
,

88 
HCI_Pro˚ssEvít
,

89 #i‡
deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

90 
OSAL_CBTIMER_PROCESS_EVENT
–
oßl_CbTimîPro˚ssEvít
 ),

92 
L2CAP_Pro˚ssEvít
,

93 
GAP_Pro˚ssEvít
,

94 
GATT_Pro˚ssEvít
,

95 
SM_Pro˚ssEvít
,

96 
GAPRﬁe_Pro˚ssEvít
,

97 
GAPB⁄dMgr_Pro˚ssEvít
,

98 
GATTSîvAµ_Pro˚ssEvít
,

99 
TimeAµ_Pro˚ssEvít


102 c⁄° 
uöt8
 
	gèsksC¡
 = –
èsksAº
 ) / (ÅasksArr[0] );

103 
uöt16
 *
	gèsksEvíts
;

118 
	$oßlInôTasks
( )

120 
uöt8
 
èskID
 = 0;

122 
èsksEvíts
 = (
uöt16
 *)
	`oßl_mem_Æloc
––uöt16 ) * 
èsksC¡
);

123 
	`oßl_mem£t
–
èsksEvíts
, 0, (–
uöt16
 ) * 
èsksC¡
));

126 
	`LL_Inô
–
èskID
++ );

129 
	`HÆ_Inô
–
èskID
++ );

132 
	`HCI_Inô
–
èskID
++ );

134 #i‡
	`deföed
 ( 
OSAL_CBTIMER_NUM_TASKS
 )

136 
	`oßl_CbTimîInô
–
èskID
 );

137 
èskID
 +
OSAL_CBTIMER_NUM_TASKS
;

141 
	`L2CAP_Inô
–
èskID
++ );

144 
	`GAP_Inô
–
èskID
++ );

147 
	`GATT_Inô
–
èskID
++ );

150 
	`SM_Inô
–
èskID
++ );

153 
	`GAPRﬁe_Inô
–
èskID
++ );

154 
	`GAPB⁄dMgr_Inô
–
èskID
++ );

156 
	`GATTSîvAµ_Inô
–
èskID
++ );

159 
	`TimeAµ_Inô
–
èskID
 );

160 
	}
}

	@Projects/ble/TimeApp/Source/timeapp.c

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"hÆ_lcd.h
"

50 
	~"Œ.h
"

51 
	~"lökdb.h
"

52 
	~"g©t.h
"

53 
	~"g≠g©t£rvî.h
"

54 
	~"g©t£rv≠p.h
"

55 
	~"≥rùhîÆ.h
"

56 
	~"g≠b⁄dmgr.h
"

57 
	~"timóµ.h
"

58 
	~"b©t£rvi˚.h
"

65 
	#B_ADDR_STR_LEN
 15

	)

72 
	#DEFAULT_FAST_ADV_INTERVAL
 32

	)

75 
	#DEFAULT_FAST_ADV_DURATION
 30000

	)

78 
	#DEFAULT_SLOW_ADV_INTERVAL
 1600

	)

81 
	#DEFAULT_SLOW_ADV_DURATION
 0

	)

84 
	#DEFAULT_ENABLE_UPDATE_REQUEST
 
FALSE


	)

87 
	#DEFAULT_DESIRED_MIN_CONN_INTERVAL
 200

	)

90 
	#DEFAULT_DESIRED_MAX_CONN_INTERVAL
 1600

	)

93 
	#DEFAULT_DESIRED_SLAVE_LATENCY
 1

	)

96 
	#DEFAULT_DESIRED_CONN_TIMEOUT
 1000

	)

99 
	#DEFAULT_PASSCODE
 19655

	)

102 
	#DEFAULT_PAIRING_MODE
 
GAPBOND_PAIRING_MODE_INITIATE


	)

105 
	#DEFAULT_MITM_MODE
 
FALSE


	)

108 
	#DEFAULT_BONDING_MODE
 
TRUE


	)

111 
	#DEFAULT_IO_CAPABILITIES
 
GAPBOND_IO_CAP_DISPLAY_ONLY


	)

114 
	#DEFAULT_DISCOVERY_DELAY
 1000

	)

117 
	#DEFAULT_CLOCK_UPDATE_PERIOD
 10000

	)

122 
	mBLE_STATE_IDLE
,

123 
	mBLE_STATE_CONNECTED
,

124 
	mBLE_STATE_DISCONNECTING


128 
	#REF_TIME_UPDATE_GET
 0x01

129 
	#REF_TIME_UPDATE_CANCEL
 0x02

130 

	)

132 
	#RINGER_SILENT_MODE
 1

133 
	#RINGER_MUTE_ONCE
 2

134 
	#RINGER_CANCEL_SILENT
 3

135 

	)

145 
uöt8
 
	gtimeAµTaskId
;

148 
uöt16
 
	gtimeAµC⁄nH™dÀ
;

162 
g≠rﬁe_Sèãs_t
 
	gtimeAµG≠Sèã
 = 
GAPROLE_INIT
;

165 
uöt8
 
	gtimeAµDiscSèã
 = 
DISC_IDLE
;

168 
uöt8
 
	gtimeAµDiscovîyCm∂
 = 
FALSE
;

171 
uöt8
 
	gtimeAµC⁄figSèã
 = 
TIMEAPP_CONFIG_START
;

174 
uöt8
 
	gtimeAµPaúögSèπed
 = 
FALSE
;

177 
uöt8
 
	gtimeAµDiscPo°p⁄ed
 = 
FALSE
;

180 
uöt8
 
	gtimeAµSˇnD©a
[] =

184 
GAP_ADTYPE_LOCAL_NAME_COMPLETE
,

195 
uöt8
 
	gtimeAµAdvD©a
[] =

199 
GAP_ADTYPE_FLAGS
,

200 
GAP_ADTYPE_FLAGS_GENERAL
 | 
GAP_ADTYPE_FLAGS_BREDR_NOT_SUPPORTED
,

203 
GAP_ADTYPE_SERVICES_LIST_16BIT
,

204 
LO_UINT16
(
CURRENT_TIME_SVC_UUID
),

205 
HI_UINT16
(
CURRENT_TIME_SVC_UUID
),

206 
LO_UINT16
(
REF_TIME_UPDATE_SVC_UUID
),

207 
HI_UINT16
(
REF_TIME_UPDATE_SVC_UUID
),

208 
LO_UINT16
(
DST_CHANGE_SVC_UUID
),

209 
HI_UINT16
(
DST_CHANGE_SVC_UUID
),

210 
LO_UINT16
(
NWA_SVC_UUID
),

211 
HI_UINT16
(
NWA_SVC_UUID
),

212 
LO_UINT16
(
ALERT_NOTIF_SVC_UUID
),

213 
HI_UINT16
(
ALERT_NOTIF_SVC_UUID
),

214 
LO_UINT16
(
BATT_SERVICE_UUID
),

215 
HI_UINT16
(
BATT_SERVICE_UUID
)

219 
uöt8
 
	gtimeAµDevi˚Name
[
GAP_DEVICE_NAME_LEN
] = "Time App";

222 
boﬁ
 
	gtimeAµB⁄ded
 = 
FALSE
;

225 
uöt8
 
	gtimeAµB⁄dedAddr
[
B_ADDR_LEN
];

228 
uöt8
 
	gtimeAµRefUpd©eVÆ
 = 
REF_TIME_UPDATE_GET
;

231 c⁄° 
uöt8
 
	gtimeAµAÀπCmd
[] =

233 
ALERT_NOTIF_ENABLE_NEW
,

234 
ALERT_NOTIF_ENABLE_UNREAD
,

235 
ALERT_NOTIF_NOTIFY_NEW
,

236 
ALERT_NOTIF_NOTIFY_UNREAD
,

237 
ALERT_NOTIF_DISABLE_NEW
,

238 
ALERT_NOTIF_DISABLE_UNREAD


242 
uöt8
 c⁄° *
	gpTimeAµAÀπCmd
 = 
timeAµAÀπCmd
;

245 
boﬁ
 
	gtimeAµAdvC™˚Œed
 = 
FALSE
;

248 
uöt8
 
	gtimeAµRögîCmd
 = 
RINGER_SILENT_MODE
;

253 
timeAµPro˚ssG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

254 
timeAµG≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 );

255 
timeAµPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

256 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 );

257 
timeAµPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 );

258 
timeAµ_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 );

259 
timeAµ_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 );

261 #i‚de‡
CC2540_MINIDK


262 *
bdAddr2Så
–
uöt8
 *
pAddr
 );

269 
g≠RﬁesCBs_t
 
	gtimeAµPîùhîÆCB
 =

271 
timeAµG≠SèãCB
,

272 
NULL


276 c⁄° 
g≠B⁄dCBs_t
 
	gtimeAµB⁄dCB
 =

278 
timeAµPasscodeCB
,

279 
timeAµPaúSèãCB


300 
	$TimeAµ_Inô
–
uöt8
 
èsk_id
 )

302 
timeAµTaskId
 = 
èsk_id
;

306 
uöt8
 
advE«bÀ
 = 
FALSE
;

307 
uöt16
 
advîtOffTime
 = 0;

308 
uöt8
 
upd©eReque°
 = 
DEFAULT_ENABLE_UPDATE_REQUEST
;

309 
uöt16
 
möI¡îvÆ
 = 
DEFAULT_DESIRED_MIN_CONN_INTERVAL
;

310 
uöt16
 
maxI¡îvÆ
 = 
DEFAULT_DESIRED_MAX_CONN_INTERVAL
;

311 
uöt16
 
¶aveL©ícy
 = 
DEFAULT_DESIRED_SLAVE_LATENCY
;

312 
uöt16
 
c⁄nTimeout
 = 
DEFAULT_DESIRED_CONN_TIMEOUT
;

314 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advE«bÀ
 );

315 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_OFF_TIME
, –
uöt16
 ), &
advîtOffTime
 );

317 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_PARAM_UPDATE_ENABLE
, –
uöt8
 ), &
upd©eReque°
 );

318 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MIN_CONN_INTERVAL
, –
uöt16
 ), &
möI¡îvÆ
 );

319 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_MAX_CONN_INTERVAL
, –
uöt16
 ), &
maxI¡îvÆ
 );

320 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SLAVE_LATENCY
, –
uöt16
 ), &
¶aveL©ícy
 );

321 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_TIMEOUT_MULTIPLIER
, –
uöt16
 ), &
c⁄nTimeout
 );

323 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_SCAN_RSP_DATA
,  ( 
timeAµSˇnD©a
 ),ÅimeAppScanData );

324 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_DATA
, –
timeAµAdvD©a
 ),ÅimeAppAdvData );

328 
	`GGS_SëP¨amëî
–
GGS_DEVICE_NAME_ATT
, 
GAP_DEVICE_NAME_LEN
, 
timeAµDevi˚Name
 );

332 
uöt32
 
∑sskey
 = 
DEFAULT_PASSCODE
;

333 
uöt8
 
∑úMode
 = 
DEFAULT_PAIRING_MODE
;

334 
uöt8
 
môm
 = 
DEFAULT_MITM_MODE
;

335 
uöt8
 
ioC≠
 = 
DEFAULT_IO_CAPABILITIES
;

336 
uöt8
 
b⁄dög
 = 
DEFAULT_BONDING_MODE
;

337 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_DEFAULT_PASSCODE
, –
uöt32
 ), &
∑sskey
 );

338 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_PAIRING_MODE
, –
uöt8
 ), &
∑úMode
 );

339 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_MITM_PROTECTION
, –
uöt8
 ), &
môm
 );

340 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_IO_CAPABILITIES
, –
uöt8
 ), &
ioC≠
 );

341 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_BONDING_ENABLED
, –
uöt8
 ), &
b⁄dög
 );

345 
VOID
 
	`GATT_InôClõ¡
();

348 
	`GATT_Regi°îF‹Ind
–
timeAµTaskId
 );

351 
	`GGS_AddSîvi˚
–
GATT_ALL_SERVICES
 );

352 
	`GATTSîvAµ_AddSîvi˚
–
GATT_ALL_SERVICES
 );

355 
	`Regi°îF‹Keys
–
timeAµTaskId
 );

358 
	`HÆLedSë
–(
HAL_LED_1
 | 
HAL_LED_2
), 
HAL_LED_MODE_OFF
 );

361 i‡–
	`HÆKeyRód
(Ë& 
HAL_KEY_CENTER
 )

363 
	`GAPB⁄dMgr_SëP¨amëî
–
GAPBOND_ERASE_ALLBONDS
, 0, 0 );

367 
	`oßl_°¨t_timîEx
–
timeAµTaskId
, 
CLOCK_UPDATE_EVT
, 
DEFAULT_CLOCK_UPDATE_PERIOD
 );

370 
	`oßl_£t_evít
–
timeAµTaskId
, 
START_DEVICE_EVT
 );

371 
	}
}

386 
uöt16
 
	$TimeAµ_Pro˚ssEvít
–
uöt8
 
èsk_id
, 
uöt16
 
evíts
 )

389 
VOID
 
èsk_id
;

391 i‡–
evíts
 & 
SYS_EVENT_MSG
 )

393 
uöt8
 *
pMsg
;

395 i‡–(
pMsg
 = 
	`oßl_msg_ª˚ive
–
timeAµTaskId
 )Ë!
NULL
 )

397 
	`timeAµ_Pro˚ssOSALMsg
–(
oßl_evít_hdr_t
 *)
pMsg
 );

400 
VOID
 
	`oßl_msg_dóŒoˇã
–
pMsg
 );

404  ( 
evíts
 ^ 
SYS_EVENT_MSG
 );

407 i‡–
evíts
 & 
START_DEVICE_EVT
 )

410 
VOID
 
	`GAPRﬁe_SèπDevi˚
–&
timeAµPîùhîÆCB
 );

413 
	`GAPB⁄dMgr_Regi°î
–(
g≠B⁄dCBs_t
 *Ë&
timeAµB⁄dCB
 );

415  ( 
evíts
 ^ 
START_DEVICE_EVT
 );

418 i‡–
evíts
 & 
START_DISCOVERY_EVT
 )

420 i‡–
timeAµPaúögSèπed
 )

423 
timeAµDiscPo°p⁄ed
 = 
TRUE
;

427 
timeAµDiscSèã
 = 
	`timeAµDiscSèπ
();

429  ( 
evíts
 ^ 
START_DISCOVERY_EVT
 );

432 i‡–
evíts
 & 
CLOCK_UPDATE_EVT
 )

434 
	`timeAµClockDi•œy
();

437 
	`oßl_°¨t_timîEx
–
timeAµTaskId
, 
CLOCK_UPDATE_EVT
, 
DEFAULT_CLOCK_UPDATE_PERIOD
 );

439  ( 
evíts
 ^ 
CLOCK_UPDATE_EVT
 );

444 
	}
}

455 
	$timeAµ_Pro˚ssOSALMsg
–
oßl_evít_hdr_t
 *
pMsg
 )

457  
pMsg
->
evít
 )

459 
KEY_CHANGE
:

460 
	`timeAµ_H™dÀKeys
–((
keyCh™ge_t
 *)
pMsg
)->
°©e
, ((keyCh™ge_à*ÌMsg)->
keys
 );

463 
GATT_MSG_EVENT
:

464 
	`timeAµPro˚ssG©tMsg
–(
g©tMsgEvít_t
 *Ë
pMsg
 );

470 
	}
}

484 
	$timeAµ_H™dÀKeys
–
uöt8
 
shi·
, uöt8 
keys
 )

486 i‡–
keys
 & 
HAL_KEY_UP
 )

489 i‡–
timeAµG≠Sèã
 !
GAPROLE_CONNECTED
 )

491 
uöt8
 
advSèã
;

494 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

495 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

496 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_FAST_ADV_DURATION
 );

499 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, &
advSèã
 );

500 
advSèã
 = !advState;

501 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

504 i‡(
advSèã
 =
FALSE
)

506 
timeAµAdvC™˚Œed
 = 
TRUE
;

511 i‡–
keys
 & 
HAL_KEY_LEFT
 )

513 
©tWrôeReq_t
 
ªq
;

516 i‡––
timeAµG≠Sèã
 =
GAPROLE_CONNECTED
 ) &&

517 –
timeAµHdlCache
[
HDL_ALERT_NTF_CTRL
] != 0 ) )

520 
ªq
.
Àn
 = 2;

521 
ªq
.
vÆue
[0] = *
pTimeAµAÀπCmd
;

522 
ªq
.
vÆue
[1] = 
ALERT_NOTIF_CAT_ALL
;

523 
ªq
.
sig
 = 0;

524 
ªq
.
cmd
 = 0;

525 
ªq
.
h™dÀ
 = 
timeAµHdlCache
[
HDL_ALERT_NTF_CTRL
];

526 
	`GATT_WrôeCh¨VÆue
–
timeAµC⁄nH™dÀ
, &
ªq
, 
timeAµTaskId
 );

527 
	`LCD_WRITE_STRING_VALUE
–"AÀπ cmd:", *
pTimeAµAÀπCmd
, 10, 
HAL_LCD_LINE_1
);

531 i‡–*
pTimeAµAÀπCmd
 =
ALERT_NOTIF_DISABLE_UNREAD
 )

533 
pTimeAµAÀπCmd
 = 
timeAµAÀπCmd
;

537 
pTimeAµAÀπCmd
++;

541 i‡–
keys
 & 
HAL_KEY_RIGHT
 )

543 
©tWrôeReq_t
 
ªq
;

546 i‡––
timeAµG≠Sèã
 =
GAPROLE_CONNECTED
 ) &&

547 –
timeAµHdlCache
[
HDL_REF_TIME_UPD_CTRL
] != 0 ) )

550 
ªq
.
Àn
 = 1;

551 
ªq
.
vÆue
[0] = 
timeAµRefUpd©eVÆ
;

552 
ªq
.
sig
 = 0;

553 
ªq
.
cmd
 = 1;

554 
ªq
.
h™dÀ
 = 
timeAµHdlCache
[
HDL_REF_TIME_UPD_CTRL
];

555 
	`GATT_WrôeNoR•
–
timeAµC⁄nH™dÀ
, &
ªq
 );

557 
	`LCD_WRITE_STRING_VALUE
–"Timêupd©e:", 
timeAµRefUpd©eVÆ
, 10, 
HAL_LCD_LINE_1
);

560 i‡–
timeAµRefUpd©eVÆ
 =
REF_TIME_UPDATE_GET
 )

562 
timeAµRefUpd©eVÆ
 = 
REF_TIME_UPDATE_CANCEL
;

566 
timeAµRefUpd©eVÆ
 = 
REF_TIME_UPDATE_GET
;

571 i‡–
keys
 & 
HAL_KEY_CENTER
 )

574 i‡–
timeAµG≠Sèã
 =
GAPROLE_CONNECTED
 )

576 
	`GAPRﬁe_Tîmö©eC⁄√˘i⁄
();

580 i‡–
keys
 & 
HAL_KEY_DOWN
 )

582 
©tWrôeReq_t
 
ªq
;

585 i‡––
timeAµG≠Sèã
 =
GAPROLE_CONNECTED
 ) &&

586 –
timeAµHdlCache
[
HDL_PAS_CTRL
] != 0 ) )

589 
ªq
.
Àn
 = 1;

590 
ªq
.
vÆue
[0] = 
timeAµRögîCmd
;

591 
ªq
.
sig
 = 0;

592 
ªq
.
cmd
 = 1;

593 
ªq
.
h™dÀ
 = 
timeAµHdlCache
[
HDL_PAS_CTRL
];

594 
	`GATT_WrôeNoR•
–
timeAµC⁄nH™dÀ
, &
ªq
 );

596 
	`LCD_WRITE_STRING_VALUE
–"Rögî cål:", 
timeAµRögîCmd
, 10, 
HAL_LCD_LINE_1
);

599 i‡–++
timeAµRögîCmd
 > 
RINGER_CANCEL_SILENT
 )

601 
timeAµRögîCmd
 = 
RINGER_SILENT_MODE
;

606 i‡–
keys
 & 
HAL_KEY_SW_6
 )

611 
	}
}

620 
	$timeAµPro˚ssG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

622 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_NOTI
 ||

623 
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_IND
 )

625 
	`timeAµIndG©tMsg
–
pMsg
 );

627 i‡––
pMsg
->
mëhod
 =
ATT_READ_RSP
 ||ÖMsg->mëhod =
ATT_WRITE_RSP
 ) ||

628 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 &&

629 –
pMsg
->
msg
.
îr‹R•
.
ªqOpcode
 =
ATT_READ_REQ
 ||

630 
pMsg
->
msg
.
îr‹R•
.
ªqOpcode
 =
ATT_WRITE_REQ
 ) ) )

632 
timeAµC⁄figSèã
 = 
	`timeAµC⁄figG©tMsg
 (ÅimeAµC⁄figSèã, 
pMsg
 );

633 i‡–
timeAµC⁄figSèã
 =
TIMEAPP_CONFIG_CMPL
 )

635 
timeAµDiscovîyCm∂
 = 
TRUE
;

640 
timeAµDiscSèã
 = 
	`timeAµDiscG©tMsg
–timeAµDiscSèã, 
pMsg
 );

641 i‡–
timeAµDiscSèã
 =
DISC_IDLE
 )

644 
timeAµC⁄figSèã
 = 
	`timeAµC⁄figNext
–
TIMEAPP_CONFIG_START
 );

647 
	}
}

656 
	$timeAµDisc⁄√˘ed
( )

659 
timeAµDiscSèã
 = 
DISC_IDLE
;

660 
timeAµPaúögSèπed
 = 
FALSE
;

661 
timeAµDiscPo°p⁄ed
 = 
FALSE
;

662 
	}
}

673 
	$timeAµG≠SèãCB
–
g≠rﬁe_Sèãs_t
 
√wSèã
 )

676 i‡–
√wSèã
 =
GAPROLE_CONNECTED
 )

678 
lökDBIãm_t
 *
pIãm
;

681 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_CONNHANDLE
, &
timeAµC⁄nH™dÀ
 );

684 i‡–(
pIãm
 = 
	`lökDB_Föd
–
timeAµC⁄nH™dÀ
 )Ë!
NULL
)

687 i‡–!
	`oßl_memcmp
–
pIãm
->
addr
, 
timeAµB⁄dedAddr
, 
B_ADDR_LEN
 ) )

689 
timeAµDiscovîyCm∂
 = 
FALSE
;

693 i‡–
timeAµDiscovîyCm∂
 =
FALSE
 )

695 
	`oßl_°¨t_timîEx
–
timeAµTaskId
, 
START_DISCOVERY_EVT
, 
DEFAULT_DISCOVERY_DELAY
 );

700 
timeAµC⁄figSèã
 = 
	`timeAµC⁄figNext
–
TIMEAPP_CONFIG_CONN_START
 );

705 
	`LCD_WRITE_STRING
–"C⁄√˘ed", 
HAL_LCD_LINE_1
 );

706 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

709 i‡–
timeAµG≠Sèã
 =
GAPROLE_CONNECTED
 &&

710 
√wSèã
 !
GAPROLE_CONNECTED
 )

712 
uöt8
 
advSèã
 = 
TRUE
;

714 
	`timeAµDisc⁄√˘ed
();

716 i‡–
√wSèã
 =
GAPROLE_WAITING_AFTER_TIMEOUT
 )

719 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_FAST_ADV_INTERVAL
 );

720 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_FAST_ADV_INTERVAL
 );

721 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_FAST_ADV_DURATION
 );

726 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

727 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

728 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_SLOW_ADV_DURATION
 );

732 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

734 
	`LCD_WRITE_STRING
–"Disc⁄√˘ed", 
HAL_LCD_LINE_1
 );

735 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

738 i‡–
timeAµG≠Sèã
 =
GAPROLE_ADVERTISING
 &&

739 
√wSèã
 =
GAPROLE_WAITING
 )

742 i‡–
timeAµAdvC™˚Œed
 )

744 
timeAµAdvC™˚Œed
 = 
FALSE
;

747 i‡–
	`GAP_GëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
 ) =
DEFAULT_FAST_ADV_INTERVAL
 )

749 
uöt8
 
advSèã
 = 
TRUE
;

751 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MIN
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

752 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_INT_MAX
, 
DEFAULT_SLOW_ADV_INTERVAL
 );

753 
	`GAP_SëP¨amVÆue
–
TGAP_GEN_DISC_ADV_MIN
, 
DEFAULT_SLOW_ADV_DURATION
 );

754 
	`GAPRﬁe_SëP¨amëî
–
GAPROLE_ADVERT_ENABLED
, –
uöt8
 ), &
advSèã
 );

758 i‡–
√wSèã
 =
GAPROLE_STARTED
 )

761 #i‚de‡
CC2540_MINIDK


762 
uöt8
 
bdAddr
[
B_ADDR_LEN
];

764 
	`GAPRﬁe_GëP¨amëî
–
GAPROLE_BD_ADDR
, &
bdAddr
 );

765 
	`LCD_WRITE_STRING
–"TimêAµ", 
HAL_LCD_LINE_1
 );

766 
	`LCD_WRITE_STRING
–
	`bdAddr2Så
–
bdAddr
 ), 
HAL_LCD_LINE_2
 );

770 
	`timeAµClockInô
();

773 
timeAµG≠Sèã
 = 
√wSèã
;

774 
	}
}

783 
	$timeAµPaúSèãCB
–
uöt16
 
c⁄nH™dÀ
, 
uöt8
 
°©e
, uöt8 
°©us
 )

785 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_STARTED
 )

787 
timeAµPaúögSèπed
 = 
TRUE
;

789 
	`LCD_WRITE_STRING
–"Paúög sèπed", 
HAL_LCD_LINE_1
 );

791 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_COMPLETE
 )

793 
timeAµPaúögSèπed
 = 
FALSE
;

795 i‡–
°©us
 =
SUCCESS
 )

797 
lökDBIãm_t
 *
pIãm
;

799 i‡–(
pIãm
 = 
	`lökDB_Föd
–
timeAµC⁄nH™dÀ
 )Ë!
NULL
 )

802 
timeAµB⁄ded
 = ( (
pIãm
->
°©eFœgs
 & 
LINK_BOUND
) == LINK_BOUND );

804 i‡–
timeAµB⁄ded
 )

806 
	`oßl_mem˝y
–
timeAµB⁄dedAddr
, 
pIãm
->
addr
, 
B_ADDR_LEN
 );

811 i‡–
timeAµDiscPo°p⁄ed
 && 
timeAµDiscovîyCm∂
 =
FALSE
 )

813 
timeAµDiscPo°p⁄ed
 = 
FALSE
;

814 
	`oßl_£t_evít
–
timeAµTaskId
, 
START_DISCOVERY_EVT
 );

817 
	`LCD_WRITE_STRING
–"Paúög suc˚ss", 
HAL_LCD_LINE_1
 );

821 
	`LCD_WRITE_STRING_VALUE
–"Paúög faû", 
°©us
, 10, 
HAL_LCD_LINE_1
 );

824 i‡–
°©e
 =
GAPBOND_PAIRING_STATE_BONDED
 )

826 i‡–
°©us
 =
SUCCESS
 )

828 
	`LCD_WRITE_STRING
–"B⁄dög suc˚ss", 
HAL_LCD_LINE_1
 );

831 
	}
}

840 
	$timeAµPasscodeCB
–
uöt8
 *
devi˚Addr
, 
uöt16
 
c⁄√˘i⁄H™dÀ
,

841 
uöt8
 
uiI≈uts
, uöt8 
uiOuçuts
 )

843 #i‡(
HAL_LCD
 =
TRUE
)

845 
uöt32
 
∑sscode
;

846 
uöt8
 
°r
[7];

849 
	`LL_R™d
–((
uöt8
 *Ë&
∑sscode
), –
uöt32
 ) );

850 
∑sscode
 %= 1000000;

853 i‡–
uiOuçuts
 != 0 )

855 
	`LCD_WRITE_STRING
–"Passcode:", 
HAL_LCD_LINE_1
 );

856 
	`LCD_WRITE_STRING
–(*Ë
	`_…ﬂ
–
∑sscode
, 
°r
, 10 ), 
HAL_LCD_LINE_2
 );

860 
	`GAPB⁄dMgr_PasscodeR•
–
c⁄√˘i⁄H™dÀ
, 
SUCCESS
, 
∑sscode
 );

862 
	}
}

871 #i‚de‡
CC2540_MINIDK


872 *
	$bdAddr2Så
–
uöt8
 *
pAddr
 )

874 
uöt8
 
i
;

875 
hex
[] = "0123456789ABCDEF";

876 
°r
[
B_ADDR_STR_LEN
];

877 *
pSå
 = 
°r
;

879 *
pSå
++ = '0';

880 *
pSå
++ = 'x';

883 
pAddr
 +
B_ADDR_LEN
;

885  
i
 = 
B_ADDR_LEN
; i > 0; i-- )

887 *
pSå
++ = 
hex
[*--
pAddr
 >> 4];

888 *
pSå
++ = 
hex
[*
pAddr
 & 0x0F];

891 *
pSå
 = 0;

893  
°r
;

894 
	}
}

	@Projects/ble/TimeApp/Source/timeapp.h

40 #i‚de‡
TIMEAPP_H


41 
	#TIMEAPP_H


	)

43 
	~"g©t.h
"

45 #ifde‡
__˝lu•lus


60 
	#START_DEVICE_EVT
 0x0001

	)

61 
	#START_DISCOVERY_EVT
 0x0002

	)

62 
	#CLOCK_UPDATE_EVT
 0x0004

	)

67 
DISC_IDLE
 = 0x00,

69 
DISC_CURR_TIME_START
 = 0x10,

70 
DISC_CURR_TIME_SVC
,

71 
DISC_CURR_TIME_CHAR
,

72 
DISC_CURR_TIME_CT_TIME_CCCD
,

74 
DISC_DST_CHG_START
 = 0x20,

75 
DISC_DST_CHG_SVC
,

76 
DISC_DST_CHG_CHAR
,

78 
DISC_REF_TIME_START
 = 0x30,

79 
DISC_REF_TIME_SVC
,

80 
DISC_REF_TIME_CHAR
,

82 
DISC_NWA_START
 = 0x40,

83 
DISC_NWA_SVC
,

84 
DISC_NWA_CHAR
,

85 
DISC_NWA_NWA_CCCD
,

87 
DISC_ALERT_NTF_START
 = 0x50,

88 
DISC_ALERT_NTF_SVC
,

89 
DISC_ALERT_NTF_CHAR
,

90 
DISC_ALERT_NTF_NEW_CCCD
,

91 
DISC_ALERT_NTF_UNREAD_CCCD
,

93 
DISC_BATT_START
 = 0x60,

94 
DISC_BATT_SVC
,

95 
DISC_BATT_CHAR
,

96 
DISC_BATT_LVL_CCCD
,

98 
DISC_PAS_START
 = 0x70,

99 
DISC_PAS_SVC
,

100 
DISC_PAS_CHAR
,

101 
DISC_PAS_ALERT_CCCD
,

102 
DISC_PAS_RINGER_CCCD
,

104 
DISC_FAILED
 = 0xFF

110 
HDL_CURR_TIME_CT_TIME_START
,

111 
HDL_CURR_TIME_CT_TIME_END
,

112 
HDL_CURR_TIME_CT_TIME_CCCD
,

113 
HDL_CURR_TIME_LOC_INFO
,

114 
HDL_CURR_TIME_REF_INFO
,

116 
HDL_DST_CHG_TIME_DST
,

118 
HDL_REF_TIME_UPD_CTRL
,

119 
HDL_REF_TIME_UPD_STATE
,

121 
HDL_NWA_NWA_START
,

122 
HDL_NWA_NWA_END
,

123 
HDL_NWA_NWA_CCCD
,

125 
HDL_ALERT_NTF_NEW_START
,

126 
HDL_ALERT_NTF_NEW_END
,

127 
HDL_ALERT_NTF_UNREAD_START
,

128 
HDL_ALERT_NTF_UNREAD_END
,

129 
HDL_ALERT_NTF_CTRL
,

130 
HDL_ALERT_NTF_NEW_CAT
,

131 
HDL_ALERT_NTF_UNREAD_CAT
,

132 
HDL_ALERT_NTF_NEW_CCCD
,

133 
HDL_ALERT_NTF_UNREAD_CCCD
,

135 
HDL_BATT_LEVEL_START
,

136 
HDL_BATT_LEVEL_END
,

137 
HDL_BATT_LEVEL_CCCD
,

139 
HDL_PAS_ALERT_START
,

140 
HDL_PAS_ALERT_END
,

141 
HDL_PAS_RINGER_START
,

142 
HDL_PAS_RINGER_END
,

143 
HDL_PAS_CTRL
,

144 
HDL_PAS_ALERT_CCCD
,

145 
HDL_PAS_RINGER_CCCD
,

147 
HDL_CACHE_LEN


151 
	#TIMEAPP_CONFIG_START
 0x00

	)

152 
	#TIMEAPP_CONFIG_CMPL
 0xFF

	)

155 
	#CURRENT_TIME_SVC_UUID
 0x1805

	)

156 
	#REF_TIME_UPDATE_SVC_UUID
 0x1806

	)

157 
	#DST_CHANGE_SVC_UUID
 0x1807

	)

158 
	#NWA_SVC_UUID
 0x180B

	)

159 
	#ALERT_NOTIF_SVC_UUID
 0x1811

	)

160 
	#PHONE_ALERT_STS_SVC_UUID
 0x180E

	)

163 
	#ALERT_NOTIF_ENABLE_NEW
 0

164 
	#ALERT_NOTIF_ENABLE_UNREAD
 1

165 
	#ALERT_NOTIF_DISABLE_NEW
 2

166 
	#ALERT_NOTIF_DISABLE_UNREAD
 3

167 
	#ALERT_NOTIF_NOTIFY_NEW
 4

168 
	#ALERT_NOTIF_NOTIFY_UNREAD
 5

169 

	)

171 
	#ALERT_NOTIF_CAT_ALL
 0xFF

	)

174 
	#TIMEAPP_CONFIG_CONN_START
 15

	)

181 #i‡
HAL_LCD
 =
TRUE


182 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
Ë
	`HÆLcdWrôeSåög
–(°r), (›ti⁄))

	)

183 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
Ë
	`HÆLcdWrôeS¸ìn
–÷öe1), (löe2Ë)

	)

184 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
Ë
	`HÆLcdWrôeSåögVÆue
–—ôÀ), (vÆue), (f‹m©), (löeË)

	)

186 
	#LCD_WRITE_STRING
(
°r
, 
›ti⁄
)

	)

187 
	#LCD_WRITE_SCREEN
(
löe1
, 
löe2
)

	)

188 
	#LCD_WRITE_STRING_VALUE
(
tôÀ
, 
vÆue
, 
f‹m©
, 
löe
)

	)

196 
uöt8
 
timeAµTaskId
;

199 
uöt16
 
timeAµC⁄nH™dÀ
;

202 
uöt16
 
timeAµHdlCache
[
HDL_CACHE_LEN
];

211 
TimeAµ_Inô
–
uöt8
 
èsk_id
 );

216 
uöt16
 
TimeAµ_Pro˚ssEvít
–
uöt8
 
èsk_id
, uöt16 
evíts
 );

221 
timeAµClockInô
( );

222 
timeAµClockDi•œy
( );

223 
timeAµClockSë
–
uöt8
 *
pD©a
 );

228 
uöt8
 
timeAµDiscSèπ
( );

229 
uöt8
 
timeAµDiscG©tMsg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

234 
uöt8
 
timeAµC⁄figNext
–uöt8 
°©e
 );

235 
uöt8
 
timeAµC⁄figG©tMsg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

240 
timeAµIndG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 );

245 #ifde‡
__˝lu•lus


	@Projects/ble/TimeApp/Source/timeapp_Main.c

45 
	~"hÆ_ty≥s.h
"

46 
	~"hÆ_key.h
"

47 
	~"hÆ_timî.h
"

48 
	~"hÆ_drivîs.h
"

49 
	~"hÆ_Àd.h
"

52 
	~"OSAL.h
"

53 
	~"OSAL_Tasks.h
"

54 
	~"OSAL_PwrMgr.h
"

55 
	~"oßl_¢v.h
"

56 
	~"OnBﬂrd.h
"

69 
	$maö
()

72 
	`HAL_BOARD_INIT
();

75 
	`InôBﬂrd
–
OB_COLD
 );

78 
	`HÆDrivîInô
();

81 
	`oßl_¢v_öô
();

86 
	`oßl_öô_sy°em
();

89 
	`HAL_ENABLE_INTERRUPTS
();

92 
	`InôBﬂrd
–
OB_READY
 );

94 #i‡
	`deföed
 ( 
POWER_SAVING
 )

95 
	`oßl_pwrmgr_devi˚
–
PWRMGR_BATTERY
 );

99 
	`oßl_°¨t_sy°em
();

102 
	}
}

	@Projects/ble/TimeApp/Source/timeapp_clock.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OSAL_Clock.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_Àd.h
"

48 
	~"hÆ_key.h
"

49 
	~"hÆ_lcd.h
"

50 
	~"timóµ.h
"

82 c⁄° 
	gtimeAµM⁄thSå
[12][3] =

102 *
num2Så
–*
pSå
, 
uöt8
 
num
 );

111 *
	$num2Så
–*
pSå
, 
uöt8
 
num
 )

113 *
pSå
++ = (
num
 / 10) + '0';

114 *
pSå
++ = (
num
 % 10) + '0';

116  
pSå
;

117 
	}
}

126 
	$timeAµClockDi•œy
( )

128 
di•œyBuf
[
HAL_LCD_MAX_CHARS
];

129 *
p
 = 
di•œyBuf
;

130 
UTCTimeSåu˘
 
time
;

133 
	`oßl_C⁄vîtUTCTime
–&
time
, 
	`oßl_gëClock
() );

138 
p
 = 
	`num2Så
–p, 
time
.
hour
 );

139 *
p
++ = ':';

140 
p
 = 
	`num2Så
–p, 
time
.
möuãs
 );

141 *
p
++ = ' ';

143 *
p
++ = 
timeAµM⁄thSå
[
time
.
m⁄th
][0];

144 *
p
++ = 
timeAµM⁄thSå
[
time
.
m⁄th
][1];

145 *
p
++ = 
timeAµM⁄thSå
[
time
.
m⁄th
][2];

147 
p
 = 
	`num2Så
–p, 
time
.
day
 + 1 );

148 *
p
++ = ' ';

150 
	`_…ﬂ
–
time
.
yór
, (
uöt8
 *Ë
p
, 10 );

152 
	`LCD_WRITE_STRING
–
di•œyBuf
, 
HAL_LCD_LINE_3
 );

153 
	}
}

162 
	$timeAµClockInô
( )

165 
	`timeAµClockDi•œy
();

166 
	}
}

177 
	$timeAµClockSë
–
uöt8
 *
pD©a
 )

179 
UTCTimeSåu˘
 
time
;

182 
time
.
yór
 = 
	`BUILD_UINT16
(
pD©a
[0],ÖData[1]);

183 i‡–
time
.
yór
 == 0 )

185 
time
.
yór
 = 2000;

187 
pD©a
 += 2;

188 
time
.
m⁄th
 = *
pD©a
++;

189 i‡–
time
.
m⁄th
 > 0 )

191 
time
.
m⁄th
--;

193 
time
.
day
 = *
pD©a
++;

194 i‡–
time
.
day
 > 0 )

196 
time
.
day
--;

198 
time
.
hour
 = *
pD©a
++;

199 
time
.
möuãs
 = *
pD©a
++;

200 
time
.
£c⁄ds
 = *
pD©a
;

203 
	`oßl_£tClock
–
	`oßl_C⁄vîtUTCSecs
–&
time
 ) );

205 
	`timeAµClockDi•œy
();

206 
	}
}

	@Projects/ble/TimeApp/Source/timeapp_config.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OnBﬂrd.h
"

46 
	~"hÆ_lcd.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"g©t£rv≠p.h
"

50 
	~"timóµ.h
"

57 
	#TIMEAPP_CONFIG_MAX
 ( (
timeAµC⁄figLi°
Ë/ (
uöt8
Ë)

	)

65 c⁄° 
uöt8
 
	gtimeAµC⁄figLi°
[] =

67 
HDL_CURR_TIME_CT_TIME_START
,

68 
HDL_CURR_TIME_LOC_INFO
,

69 
HDL_CURR_TIME_REF_INFO
,

70 
HDL_DST_CHG_TIME_DST
,

71 
HDL_NWA_NWA_START
,

72 
HDL_BATT_LEVEL_START
,

73 
HDL_PAS_RINGER_START
,

74 
HDL_REF_TIME_UPD_STATE
,

75 
HDL_CURR_TIME_CT_TIME_CCCD
,

76 
HDL_NWA_NWA_CCCD
,

77 
HDL_ALERT_NTF_UNREAD_CCCD
,

78 
HDL_ALERT_NTF_NEW_CCCD
,

79 
HDL_BATT_LEVEL_CCCD
,

80 
HDL_PAS_ALERT_CCCD
,

81 
HDL_PAS_RINGER_CCCD
,

84 
HDL_PAS_ALERT_START
,

85 
HDL_ALERT_NTF_NEW_CAT
,

86 
HDL_ALERT_NTF_UNREAD_CAT
,

87 
HDL_ALERT_NTF_CTRL
,

88 
HDL_ALERT_NTF_CTRL
,

89 
HDL_ALERT_NTF_CTRL
,

90 
HDL_ALERT_NTF_CTRL


94 
	#TIMEAPP_ALERT_NTF_CTRL_START
 18

	)

130 
uöt8
 
	$timeAµC⁄figNext
–
uöt8
 
°©e
 )

132 
©tRódReq_t
 
ªadReq
;

133 
©tWrôeReq_t
 
wrôeReq
;

134 
boﬁ
 
ªad
;

135 
uöt8
 
ÆîtNtfCålCmd
;

138  
°©e
 < 
TIMEAPP_CONFIG_MAX
 &&

139 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]] == 0 )

141 
°©e
++;

145 i‡–
°©e
 =
TIMEAPP_CONFIG_MAX
 )

147  
TIMEAPP_CONFIG_CMPL
;

151  
timeAµC⁄figLi°
[
°©e
] )

154 
HDL_CURR_TIME_LOC_INFO
:

155 
HDL_CURR_TIME_REF_INFO
:

156 
HDL_DST_CHG_TIME_DST
:

157 
HDL_NWA_NWA_START
:

158 
HDL_CURR_TIME_CT_TIME_START
:

159 
HDL_ALERT_NTF_NEW_CAT
:

160 
HDL_ALERT_NTF_UNREAD_CAT
:

161 
HDL_PAS_ALERT_START
:

162 
HDL_PAS_RINGER_START
:

163 
HDL_REF_TIME_UPD_STATE
:

164 
ªad
 = 
TRUE
;

168 
HDL_CURR_TIME_CT_TIME_CCCD
:

169 
HDL_ALERT_NTF_UNREAD_CCCD
:

170 
HDL_ALERT_NTF_NEW_CCCD
:

171 
HDL_BATT_LEVEL_CCCD
:

172 
HDL_PAS_ALERT_CCCD
:

173 
HDL_PAS_RINGER_CCCD
:

174 
ªad
 = 
FALSE
;

175 
wrôeReq
.
Àn
 = 2;

176 
wrôeReq
.
vÆue
[0] = 
	`LO_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

177 
wrôeReq
.
vÆue
[1] = 
	`HI_UINT16
(
GATT_CLIENT_CFG_NOTIFY
);

178 
wrôeReq
.
sig
 = 0;

179 
wrôeReq
.
cmd
 = 0;

183 
HDL_NWA_NWA_CCCD
:

184 
ªad
 = 
FALSE
;

185 
wrôeReq
.
Àn
 = 2;

186 
wrôeReq
.
vÆue
[0] = 
	`LO_UINT16
(
GATT_CLIENT_CFG_INDICATE
);

187 
wrôeReq
.
vÆue
[1] = 
	`HI_UINT16
(
GATT_CLIENT_CFG_INDICATE
);

188 
wrôeReq
.
sig
 = 0;

189 
wrôeReq
.
cmd
 = 0;

193 
HDL_ALERT_NTF_CTRL
:

195 i‡(
°©e
 =
TIMEAPP_ALERT_NTF_CTRL_START
)

197 
ÆîtNtfCålCmd
 = 
ALERT_NOTIF_ENABLE_NEW
;

200 
ªad
 = 
FALSE
;

201 
wrôeReq
.
Àn
 = 2;

202 
wrôeReq
.
vÆue
[0] = 
ÆîtNtfCålCmd
;

203 
wrôeReq
.
vÆue
[1] = 
ALERT_NOTIF_CAT_ALL
;

204 
wrôeReq
.
sig
 = 0;

205 
wrôeReq
.
cmd
 = 0;

208 i‡(
ÆîtNtfCålCmd
 =
ALERT_NOTIF_ENABLE_NEW
)

210 
ÆîtNtfCålCmd
 = 
ALERT_NOTIF_NOTIFY_NEW
;

212 i‡(
ÆîtNtfCålCmd
 =
ALERT_NOTIF_NOTIFY_NEW
)

214 
ÆîtNtfCålCmd
 = 
ALERT_NOTIF_ENABLE_UNREAD
;

216 i‡(
ÆîtNtfCålCmd
 =
ALERT_NOTIF_ENABLE_UNREAD
)

218 
ÆîtNtfCålCmd
 = 
ALERT_NOTIF_NOTIFY_UNREAD
;

227 i‡–
ªad
 )

229 
ªadReq
.
h™dÀ
 = 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]];

230 
	`GATT_RódCh¨VÆue
–
timeAµC⁄nH™dÀ
, &
ªadReq
, 
timeAµTaskId
 );

234 
wrôeReq
.
h™dÀ
 = 
timeAµHdlCache
[
timeAµC⁄figLi°
[
°©e
]];

235 
	`GATT_WrôeCh¨VÆue
–
timeAµC⁄nH™dÀ
, &
wrôeReq
, 
timeAµTaskId
 );

238  
°©e
;

239 
	}
}

251 
uöt8
 
	$timeAµC⁄figG©tMsg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

253 i‡–
°©e
 > 
TIMEAPP_CONFIG_MAX
 )

255  
TIMEAPP_CONFIG_CMPL
;

258 i‡–(
pMsg
->
mëhod
 =
ATT_READ_RSP
 ||ÖMsg->mëhod =
ATT_WRITE_RSP
) &&

259 (
pMsg
->
hdr
.
°©us
 =
SUCCESS
) )

262  
timeAµC⁄figLi°
[
°©e
] )

264 
HDL_CURR_TIME_CT_TIME_START
:

266 
	`timeAµClockSë
–
pMsg
->
msg
.
ªadR•
.
vÆue
 );

269 
HDL_CURR_TIME_LOC_INFO
:

272 
HDL_CURR_TIME_REF_INFO
:

275 
HDL_DST_CHG_TIME_DST
:

278 
HDL_NWA_NWA_START
:

280 i‡–
pMsg
->
msg
.
ªadR•
.
vÆue
[0] == 1 )

282 
	`LCD_WRITE_STRING
–"Nëw‹k: Yes", 
HAL_LCD_LINE_1
 );

286 
	`LCD_WRITE_STRING
–"Nëw‹k: N⁄e", 
HAL_LCD_LINE_1
 );

290 
HDL_BATT_LEVEL_START
:

292 
	`LCD_WRITE_STRING_VALUE
–"B©ãry%", 
pMsg
->
msg
.
ªadR•
.
vÆue
[0], 10, 
HAL_LCD_LINE_2
 );

295 
HDL_CURR_TIME_CT_TIME_CCCD
:

298 
HDL_ALERT_NTF_NEW_CAT
:

301 
HDL_ALERT_NTF_UNREAD_CAT
:

304 
HDL_ALERT_NTF_UNREAD_CCCD
:

307 
HDL_ALERT_NTF_NEW_CCCD
:

310 
HDL_NWA_NWA_CCCD
:

313 
HDL_PAS_ALERT_START
:

315 
	`LCD_WRITE_STRING_VALUE
–"Ph⁄êAÀπ:", 
pMsg
->
msg
.
ªadR•
.
vÆue
[0], 16, 
HAL_LCD_LINE_1
 );

318 
HDL_PAS_RINGER_START
:

320 i‡–
pMsg
->
msg
.
ªadR•
.
vÆue
[0] == 0 )

322 
	`LCD_WRITE_STRING
–"Rögî Off", 
HAL_LCD_LINE_2
 );

326 
	`LCD_WRITE_STRING
–"Rögî On", 
HAL_LCD_LINE_2
 );

335  
	`timeAµC⁄figNext
–
°©e
 + 1 );

336 
	}
}

	@Projects/ble/TimeApp/Source/timeapp_discovery.c

43 
	~"bcomdef.h
"

44 
	~"OSAL.h
"

45 
	~"OnBﬂrd.h
"

46 
	~"hÆ_lcd.h
"

47 
	~"g©t.h
"

48 
	~"g©t_uuid.h
"

49 
	~"timóµ.h
"

50 
	~"b©t£rvi˚.h
"

57 
	#CT_TIME_UUID
 0x2A2B

58 
	#LOCAL_TIME_INFO_UUID
 0x2A0F

59 
	#TIME_WITH_DST_UUID
 0x2A11

60 
	#REF_TIME_INFO_UUID
 0x2A14

61 
	#TIME_UPDATE_CTRL_UUID
 0x2A16

62 
	#TIME_UPDATE_STATE_UUID
 0x2A17

63 
	#NETWORK_AVAIL_UUID
 0x2A3E

64 
	#ALERT_STATUS_UUID
 0x2A3F

65 
	#RINGER_CP_UUID
 0x2A40

66 
	#RINGER_SETTING_UUID
 0x2A41

67 
	#ALERT_NOTIF_CP_UUID
 0x2A44

68 
	#UNREAD_ALERT_STATUS_UUID
 0x2A45

69 
	#NEW_ALERT_UUID
 0x2A46

70 
	#SUP_NEW_ALERT_CAT_UUID
 0x2A47

71 
	#SUP_UNREAD_ALERT_CAT_UUID
 0x2A48

72 

	)

74 
	#CHAR_DESC_HDL_UUID16_LEN
 7

	)

94 
uöt16
 
	gtimeAµHdlCache
[
HDL_CACHE_LEN
];

105 
uöt16
 
	gtimeAµSvcSèπHdl
;

106 
uöt16
 
	gtimeAµSvcEndHdl
;

107 
uöt8
 
	gtimeAµEndHdlIdx
;

113 
uöt8
 
TimeAµDiscCuºTime
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

114 
uöt8
 
TimeAµDiscD°Chg
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

115 
uöt8
 
TimeAµDiscRefTime
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

116 
uöt8
 
TimeAµDiscNwa
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

117 
uöt8
 
TimeAµDiscAÀπNtf
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

118 
uöt8
 
TimeAµDiscB©t
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

119 
uöt8
 
TimeAµDiscPh⁄eAÀπ
–uöt8 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 );

129 
uöt8
 
	$timeAµDiscSèπ
( )

132 
	`oßl_mem£t
–
timeAµHdlCache
, 0, (timeAppHdlCache) );

135  
	`timeAµDiscG©tMsg
–
DISC_CURR_TIME_START
, 
NULL
 );

136 
	}
}

148 
uöt8
 
	$timeAµDiscG©tMsg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

153  
°©e
 & 0xF0 )

156 
DISC_CURR_TIME_START
:

157 
°©e
 = 
	`TimeAµDiscCuºTime
–°©e, 
pMsg
 );

158 i‡–
°©e
 =
DISC_FAILED
 )

160 
°©e
 = 
DISC_NWA_START
;

162 i‡–
°©e
 =
DISC_IDLE
 )

164 
°©e
 = 
DISC_DST_CHG_START
;

169 
DISC_DST_CHG_START
:

170 
°©e
 = 
	`TimeAµDiscD°Chg
–°©e, 
pMsg
 );

171 i‡–
°©e
 =
DISC_FAILED
 )

173 
°©e
 = 
DISC_NWA_START
;

175 i‡–
°©e
 =
DISC_IDLE
 )

177 
°©e
 = 
DISC_REF_TIME_START
;

182 
DISC_REF_TIME_START
:

183 
°©e
 = 
	`TimeAµDiscRefTime
–°©e, 
pMsg
 );

184 i‡–
°©e
 =
DISC_FAILED
 || sèã =
DISC_IDLE
 )

186 
°©e
 = 
DISC_NWA_START
;

191 
DISC_NWA_START
:

192 
°©e
 = 
	`TimeAµDiscNwa
–°©e, 
pMsg
 );

193 i‡–
°©e
 =
DISC_FAILED
 || sèã =
DISC_IDLE
 )

195 
°©e
 = 
DISC_ALERT_NTF_START
;

200 
DISC_ALERT_NTF_START
:

201 
°©e
 = 
	`TimeAµDiscAÀπNtf
–°©e, 
pMsg
 );

202 i‡–
°©e
 =
DISC_FAILED
 || sèã =
DISC_IDLE
 )

204 
°©e
 = 
DISC_BATT_START
;

209 
DISC_BATT_START
:

210 
°©e
 = 
	`TimeAµDiscB©t
–°©e, 
pMsg
 );

211 i‡–
°©e
 =
DISC_FAILED
 || sèã =
DISC_IDLE
 )

213 
°©e
 = 
DISC_PAS_START
;

218 
DISC_PAS_START
:

219 
°©e
 = 
	`TimeAµDiscPh⁄eAÀπ
–°©e, 
pMsg
 );

220 i‡–
°©e
 =
DISC_FAILED
 )

222 
°©e
 = 
DISC_IDLE
;

229 }  (
°©e
 != 0) && ((state & 0x0F) == 0) );

231  
°©e
;

232 
	}
}

244 
uöt8
 
	$TimeAµDiscCuºTime
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

246 
uöt8
 
√wSèã
 = 
°©e
;

248  
°©e
 )

250 
DISC_CURR_TIME_START
:

252 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
CURRENT_TIME_SVC_UUID
),

253 
	`HI_UINT16
(
CURRENT_TIME_SVC_UUID
) };

256 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

257 
timeAµEndHdlIdx
 = 0;

260 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
timeAµC⁄nH™dÀ
, 
uuid
,

261 
ATT_BT_UUID_SIZE
, 
timeAµTaskId
 );

263 
√wSèã
 = 
DISC_CURR_TIME_SVC
;

267 
DISC_CURR_TIME_SVC
:

269 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

270 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

272 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

273 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

277 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

278 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

279 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

282 i‡–
timeAµSvcSèπHdl
 != 0 )

285 
	`GATT_DiscAŒCh¨s
–
timeAµC⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

286 
timeAµSvcEndHdl
, 
timeAµTaskId
 );

288 
√wSèã
 = 
DISC_CURR_TIME_CHAR
;

293 
√wSèã
 = 
DISC_FAILED
;

298 
DISC_CURR_TIME_CHAR
:

300 
uöt8
 
i
;

301 
uöt8
 *
p
;

302 
uöt16
 
h™dÀ
;

303 
uöt16
 
uuid
;

306 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

307 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

308 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
)

311 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

312  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

315 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

316 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

319 i‡–
timeAµEndHdlIdx
 != 0 )

322 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
	`BUILD_UINT16
(
p
[0],Ö[1]) - 1;

324 
timeAµEndHdlIdx
 = 0;

328  
uuid
 )

330 
CT_TIME_UUID
:

331 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] = 
h™dÀ
;

332 
timeAµEndHdlIdx
 = 
HDL_CURR_TIME_CT_TIME_END
;

335 
LOCAL_TIME_INFO_UUID
:

336 
timeAµHdlCache
[
HDL_CURR_TIME_LOC_INFO
] = 
h™dÀ
;

339 
REF_TIME_INFO_UUID
:

340 
timeAµHdlCache
[
HDL_CURR_TIME_REF_INFO
] = 
h™dÀ
;

347 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

353 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

354 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

355 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

358 i‡–
timeAµEndHdlIdx
 != 0 )

360 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
timeAµSvcEndHdl
;

361 
timeAµEndHdlIdx
 = 0;

365 i‡–
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] == 0 )

367 
√wSèã
 = 
DISC_FAILED
;

369 i‡–
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] <

370 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_END
] )

373 
	`GATT_DiscAŒCh¨Descs
–
timeAµC⁄nH™dÀ
,

374 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_START
] + 1,

375 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_END
],

376 
timeAµTaskId
 );

378 
√wSèã
 = 
DISC_CURR_TIME_CT_TIME_CCCD
;

382 
√wSèã
 = 
DISC_IDLE
;

388 
DISC_CURR_TIME_CT_TIME_CCCD
:

390 
uöt8
 
i
;

393 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

394 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

395 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

398  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

401 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

402 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

403 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

404 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

407 
timeAµHdlCache
[
HDL_CURR_TIME_CT_TIME_CCCD
] =

408 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

416 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

417 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

418 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

420 
√wSèã
 = 
DISC_IDLE
;

429  
√wSèã
;

430 
	}
}

442 
uöt8
 
	$TimeAµDiscD°Chg
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

444 
uöt8
 
√wSèã
 = 
°©e
;

446  
°©e
 )

448 
DISC_DST_CHG_START
:

450 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
DST_CHANGE_SVC_UUID
),

451 
	`HI_UINT16
(
DST_CHANGE_SVC_UUID
) };

454 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

455 
timeAµEndHdlIdx
 = 0;

458 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
timeAµC⁄nH™dÀ
, 
uuid
,

459 
ATT_BT_UUID_SIZE
, 
timeAµTaskId
 );

461 
√wSèã
 = 
DISC_DST_CHG_SVC
;

465 
DISC_DST_CHG_SVC
:

467 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

468 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

470 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

471 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

475 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

476 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

477 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

480 i‡–
timeAµSvcSèπHdl
 != 0 )

483 
	`GATT_DiscAŒCh¨s
–
timeAµC⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

484 
timeAµSvcEndHdl
, 
timeAµTaskId
 );

486 
√wSèã
 = 
DISC_DST_CHG_CHAR
;

491 
√wSèã
 = 
DISC_FAILED
;

496 
DISC_DST_CHG_CHAR
:

498 
uöt8
 
i
;

499 
uöt8
 *
p
;

500 
uöt16
 
h™dÀ
;

501 
uöt16
 
uuid
;

504 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

505 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

506 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
)

509 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

510  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

513 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

514 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

517  
uuid
 )

519 
TIME_WITH_DST_UUID
:

520 
timeAµHdlCache
[
HDL_DST_CHG_TIME_DST
] = 
h™dÀ
;

527 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

533 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

534 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

535 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

538 i‡–
timeAµHdlCache
[
HDL_DST_CHG_TIME_DST
] == 0 )

540 
√wSèã
 = 
DISC_FAILED
;

544 
√wSèã
 = 
DISC_IDLE
;

554  
√wSèã
;

555 
	}
}

567 
uöt8
 
	$TimeAµDiscRefTime
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

569 
uöt8
 
√wSèã
 = 
°©e
;

571  
°©e
 )

573 
DISC_REF_TIME_START
:

575 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
REF_TIME_UPDATE_SVC_UUID
),

576 
	`HI_UINT16
(
REF_TIME_UPDATE_SVC_UUID
) };

579 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

580 
timeAµEndHdlIdx
 = 0;

583 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
timeAµC⁄nH™dÀ
, 
uuid
,

584 
ATT_BT_UUID_SIZE
, 
timeAµTaskId
 );

586 
√wSèã
 = 
DISC_REF_TIME_SVC
;

590 
DISC_REF_TIME_SVC
:

592 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

593 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

595 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

596 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

600 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

601 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

602 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

605 i‡–
timeAµSvcSèπHdl
 != 0 )

608 
	`GATT_DiscAŒCh¨s
–
timeAµC⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

609 
timeAµSvcEndHdl
, 
timeAµTaskId
 );

611 
√wSèã
 = 
DISC_REF_TIME_CHAR
;

616 
√wSèã
 = 
DISC_FAILED
;

621 
DISC_REF_TIME_CHAR
:

623 
uöt8
 
i
;

624 
uöt8
 *
p
;

625 
uöt16
 
h™dÀ
;

626 
uöt16
 
uuid
;

629 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

630 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

631 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
)

634 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

635  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

638 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

639 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

642  
uuid
 )

644 
TIME_UPDATE_CTRL_UUID
:

645 
timeAµHdlCache
[
HDL_REF_TIME_UPD_CTRL
] = 
h™dÀ
;

648 
TIME_UPDATE_STATE_UUID
:

649 
timeAµHdlCache
[
HDL_REF_TIME_UPD_STATE
] = 
h™dÀ
;

656 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

662 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

663 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

664 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

667 i‡–
timeAµHdlCache
[
HDL_REF_TIME_UPD_CTRL
] == 0 ||

668 
timeAµHdlCache
[
HDL_REF_TIME_UPD_STATE
] == 0 )

670 
√wSèã
 = 
DISC_FAILED
;

674 
√wSèã
 = 
DISC_IDLE
;

684  
√wSèã
;

685 
	}
}

697 
uöt8
 
	$TimeAµDiscNwa
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

699 
uöt8
 
√wSèã
 = 
°©e
;

701  
°©e
 )

703 
DISC_NWA_START
:

705 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
NWA_SVC_UUID
),

706 
	`HI_UINT16
(
NWA_SVC_UUID
) };

709 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

710 
timeAµEndHdlIdx
 = 0;

713 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
timeAµC⁄nH™dÀ
, 
uuid
,

714 
ATT_BT_UUID_SIZE
, 
timeAµTaskId
 );

716 
√wSèã
 = 
DISC_NWA_SVC
;

720 
DISC_NWA_SVC
:

722 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

723 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

725 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

726 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

730 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

731 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

732 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

735 i‡–
timeAµSvcSèπHdl
 != 0 )

738 
	`GATT_DiscAŒCh¨s
–
timeAµC⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

739 
timeAµSvcEndHdl
, 
timeAµTaskId
 );

741 
√wSèã
 = 
DISC_NWA_CHAR
;

746 
√wSèã
 = 
DISC_FAILED
;

751 
DISC_NWA_CHAR
:

753 
uöt8
 
i
;

754 
uöt8
 *
p
;

755 
uöt16
 
h™dÀ
;

756 
uöt16
 
uuid
;

759 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

760 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

761 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
)

764 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

765  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

768 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

769 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

772 i‡–
timeAµEndHdlIdx
 != 0 )

775 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
	`BUILD_UINT16
(
p
[0],Ö[1]) - 1;

777 
timeAµEndHdlIdx
 = 0;

781  
uuid
 )

783 
NETWORK_AVAIL_UUID
:

784 
timeAµHdlCache
[
HDL_NWA_NWA_START
] = 
h™dÀ
;

785 
timeAµEndHdlIdx
 = 
HDL_NWA_NWA_END
;

792 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

798 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

799 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

800 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

803 i‡–
timeAµEndHdlIdx
 != 0 )

805 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
timeAµSvcEndHdl
;

806 
timeAµEndHdlIdx
 = 0;

810 i‡–
timeAµHdlCache
[
HDL_NWA_NWA_START
] == 0 )

812 
√wSèã
 = 
DISC_FAILED
;

814 i‡–
timeAµHdlCache
[
HDL_NWA_NWA_START
] <

815 
timeAµHdlCache
[
HDL_NWA_NWA_END
] )

818 
	`GATT_DiscAŒCh¨Descs
–
timeAµC⁄nH™dÀ
,

819 
timeAµHdlCache
[
HDL_NWA_NWA_START
] + 1,

820 
timeAµHdlCache
[
HDL_NWA_NWA_END
],

821 
timeAµTaskId
 );

823 
√wSèã
 = 
DISC_NWA_NWA_CCCD
;

827 
√wSèã
 = 
DISC_IDLE
;

833 
DISC_NWA_NWA_CCCD
:

835 
uöt8
 
i
;

838 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

839 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

840 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

843  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

846 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

847 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

848 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

849 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

852 
timeAµHdlCache
[
HDL_NWA_NWA_CCCD
] =

853 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

861 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

862 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

863 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

865 
√wSèã
 = 
DISC_IDLE
;

874  
√wSèã
;

875 
	}
}

887 
uöt8
 
	$TimeAµDiscAÀπNtf
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

889 
uöt8
 
√wSèã
 = 
°©e
;

891  
°©e
 )

893 
DISC_ALERT_NTF_START
:

895 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
ALERT_NOTIF_SVC_UUID
),

896 
	`HI_UINT16
(
ALERT_NOTIF_SVC_UUID
) };

899 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

900 
timeAµEndHdlIdx
 = 0;

903 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
timeAµC⁄nH™dÀ
, 
uuid
,

904 
ATT_BT_UUID_SIZE
, 
timeAµTaskId
 );

906 
√wSèã
 = 
DISC_ALERT_NTF_SVC
;

910 
DISC_ALERT_NTF_SVC
:

912 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

913 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

915 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

916 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

920 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

921 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

922 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

925 i‡–
timeAµSvcSèπHdl
 != 0 )

928 
	`GATT_DiscAŒCh¨s
–
timeAµC⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

929 
timeAµSvcEndHdl
, 
timeAµTaskId
 );

931 
√wSèã
 = 
DISC_ALERT_NTF_CHAR
;

936 
√wSèã
 = 
DISC_FAILED
;

941 
DISC_ALERT_NTF_CHAR
:

943 
uöt8
 
i
;

944 
uöt8
 *
p
;

945 
uöt16
 
h™dÀ
;

946 
uöt16
 
uuid
;

949 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

950 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

951 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
 )

954 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

955  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

958 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

959 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

962 i‡–
timeAµEndHdlIdx
 != 0 )

965 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
	`BUILD_UINT16
(
p
[0],Ö[1]) - 1;

967 
timeAµEndHdlIdx
 = 0;

971  
uuid
 )

973 
ALERT_NOTIF_CP_UUID
:

974 
timeAµHdlCache
[
HDL_ALERT_NTF_CTRL
] = 
h™dÀ
;

977 
UNREAD_ALERT_STATUS_UUID
:

978 
timeAµHdlCache
[
HDL_ALERT_NTF_UNREAD_START
] = 
h™dÀ
;

979 
timeAµEndHdlIdx
 = 
HDL_ALERT_NTF_UNREAD_END
;

982 
NEW_ALERT_UUID
:

983 
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_START
] = 
h™dÀ
;

984 
timeAµEndHdlIdx
 = 
HDL_ALERT_NTF_NEW_END
;

987 
SUP_NEW_ALERT_CAT_UUID
:

988 
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_CAT
] = 
h™dÀ
;

991 
SUP_UNREAD_ALERT_CAT_UUID
:

992 
timeAµHdlCache
[
HDL_ALERT_NTF_UNREAD_CAT
] = 
h™dÀ
;

999 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

1005 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

1006 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1007 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1010 i‡–
timeAµEndHdlIdx
 != 0 )

1012 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
timeAµSvcEndHdl
;

1013 
timeAµEndHdlIdx
 = 0;

1017 i‡–
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_START
] == 0 )

1019 
√wSèã
 = 
DISC_FAILED
;

1021 i‡–
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_START
] <

1022 
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_END
] )

1025 
	`GATT_DiscAŒCh¨Descs
–
timeAµC⁄nH™dÀ
,

1026 
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_START
] + 1,

1027 
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_END
],

1028 
timeAµTaskId
 );

1030 
√wSèã
 = 
DISC_ALERT_NTF_NEW_CCCD
;

1035 
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_START
] = 0;

1036 
√wSèã
 = 
DISC_FAILED
;

1042 
DISC_ALERT_NTF_NEW_CCCD
:

1044 
uöt8
 
i
;

1047 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1048 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

1049 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

1052  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

1055 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

1056 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

1057 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

1058 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

1061 
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_CCCD
] =

1062 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

1070 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1071 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1072 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1075 i‡–
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_CCCD
] != 0 )

1078 i‡–
timeAµHdlCache
[
HDL_ALERT_NTF_UNREAD_START
] <

1079 
timeAµHdlCache
[
HDL_ALERT_NTF_UNREAD_END
] )

1082 
	`GATT_DiscAŒCh¨Descs
–
timeAµC⁄nH™dÀ
,

1083 
timeAµHdlCache
[
HDL_ALERT_NTF_UNREAD_START
] + 1,

1084 
timeAµHdlCache
[
HDL_ALERT_NTF_UNREAD_END
],

1085 
timeAµTaskId
 );

1087 
√wSèã
 = 
DISC_ALERT_NTF_UNREAD_CCCD
;

1092 
√wSèã
 = 
DISC_IDLE
;

1098 
timeAµHdlCache
[
HDL_ALERT_NTF_NEW_START
] = 0;

1099 
√wSèã
 = 
DISC_FAILED
;

1105 
DISC_ALERT_NTF_UNREAD_CCCD
:

1107 
uöt8
 
i
;

1110 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1111 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

1112 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

1115  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

1118 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

1119 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

1120 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

1121 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

1124 
timeAµHdlCache
[
HDL_ALERT_NTF_UNREAD_CCCD
] =

1125 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

1133 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1134 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1135 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1137 
√wSèã
 = 
DISC_IDLE
;

1146  
√wSèã
;

1147 
	}
}

1159 
uöt8
 
	$TimeAµDiscB©t
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

1161 
uöt8
 
√wSèã
 = 
°©e
;

1163  
°©e
 )

1165 
DISC_BATT_START
:

1167 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
BATT_SERVICE_UUID
),

1168 
	`HI_UINT16
(
BATT_SERVICE_UUID
) };

1171 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

1172 
timeAµEndHdlIdx
 = 0;

1175 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
timeAµC⁄nH™dÀ
, 
uuid
,

1176 
ATT_BT_UUID_SIZE
, 
timeAµTaskId
 );

1178 
√wSèã
 = 
DISC_BATT_SVC
;

1182 
DISC_BATT_SVC
:

1184 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

1185 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

1187 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

1188 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

1192 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

1193 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1194 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1197 i‡–
timeAµSvcSèπHdl
 != 0 )

1200 
	`GATT_DiscAŒCh¨s
–
timeAµC⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

1201 
timeAµSvcEndHdl
, 
timeAµTaskId
 );

1203 
√wSèã
 = 
DISC_BATT_CHAR
;

1208 
√wSèã
 = 
DISC_FAILED
;

1213 
DISC_BATT_CHAR
:

1215 
uöt8
 
i
;

1216 
uöt8
 *
p
;

1217 
uöt16
 
h™dÀ
;

1218 
uöt16
 
uuid
;

1221 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

1222 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

1223 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
 )

1226 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

1227  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

1230 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

1231 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

1234 i‡–
timeAµEndHdlIdx
 != 0 )

1237 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
	`BUILD_UINT16
(
p
[0],Ö[1]) - 1;

1239 
timeAµEndHdlIdx
 = 0;

1243  
uuid
 )

1245 
BATT_LEVEL_UUID
:

1246 
timeAµHdlCache
[
HDL_BATT_LEVEL_START
] = 
h™dÀ
;

1247 
timeAµEndHdlIdx
 = 
HDL_BATT_LEVEL_END
;

1254 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

1260 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

1261 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1262 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1265 i‡–
timeAµEndHdlIdx
 != 0 )

1267 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
timeAµSvcEndHdl
;

1268 
timeAµEndHdlIdx
 = 0;

1272 i‡–
timeAµHdlCache
[
HDL_BATT_LEVEL_START
] == 0 )

1274 
√wSèã
 = 
DISC_FAILED
;

1276 i‡–
timeAµHdlCache
[
HDL_BATT_LEVEL_START
] <

1277 
timeAµHdlCache
[
HDL_BATT_LEVEL_END
] )

1280 
	`GATT_DiscAŒCh¨Descs
–
timeAµC⁄nH™dÀ
,

1281 
timeAµHdlCache
[
HDL_BATT_LEVEL_START
] + 1,

1282 
timeAµHdlCache
[
HDL_BATT_LEVEL_END
],

1283 
timeAµTaskId
 );

1285 
√wSèã
 = 
DISC_BATT_LVL_CCCD
;

1289 
√wSèã
 = 
DISC_IDLE
;

1295 
DISC_BATT_LVL_CCCD
:

1297 
uöt8
 
i
;

1300 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1301 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

1302 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

1305  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

1308 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

1309 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

1310 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

1311 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

1314 
timeAµHdlCache
[
HDL_BATT_LEVEL_CCCD
] =

1315 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

1323 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1324 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1325 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1327 
√wSèã
 = 
DISC_IDLE
;

1336  
√wSèã
;

1337 
	}
}

1349 
uöt8
 
	$TimeAµDiscPh⁄eAÀπ
–
uöt8
 
°©e
, 
g©tMsgEvít_t
 *
pMsg
 )

1351 
uöt8
 
√wSèã
 = 
°©e
;

1353  
°©e
 )

1355 
DISC_PAS_START
:

1357 
uöt8
 
uuid
[
ATT_BT_UUID_SIZE
] = { 
	`LO_UINT16
(
PHONE_ALERT_STS_SVC_UUID
),

1358 
	`HI_UINT16
(
PHONE_ALERT_STS_SVC_UUID
) };

1361 
timeAµSvcSèπHdl
 = 
timeAµSvcEndHdl
 = 0;

1362 
timeAµEndHdlIdx
 = 0;

1365 
	`GATT_DiscPrim¨ySîvi˚ByUUID
–
timeAµC⁄nH™dÀ
, 
uuid
,

1366 
ATT_BT_UUID_SIZE
, 
timeAµTaskId
 );

1368 
√wSèã
 = 
DISC_PAS_SVC
;

1372 
DISC_PAS_SVC
:

1374 i‡–
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

1375 
pMsg
->
msg
.
födByTy≥VÆueR•
.
numInfo
 > 0 )

1377 
timeAµSvcSèπHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
h™dÀ
;

1378 
timeAµSvcEndHdl
 = 
pMsg
->
msg
.
födByTy≥VÆueR•
.
h™dÀsInfo
[0].
gΩEndH™dÀ
;

1382 i‡––
pMsg
->
mëhod
 =
ATT_FIND_BY_TYPE_VALUE_RSP
 &&

1383 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1384 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1387 i‡–
timeAµSvcSèπHdl
 != 0 )

1390 
	`GATT_DiscAŒCh¨s
–
timeAµC⁄nH™dÀ
, 
timeAµSvcSèπHdl
,

1391 
timeAµSvcEndHdl
, 
timeAµTaskId
 );

1393 
√wSèã
 = 
DISC_PAS_CHAR
;

1398 
√wSèã
 = 
DISC_FAILED
;

1403 
DISC_PAS_CHAR
:

1405 
uöt8
 
i
;

1406 
uöt8
 *
p
;

1407 
uöt16
 
h™dÀ
;

1408 
uöt16
 
uuid
;

1411 i‡–
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

1412 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
 > 0 &&

1413 
pMsg
->
msg
.
ªadByTy≥R•
.
Àn
 =
CHAR_DESC_HDL_UUID16_LEN
 )

1416 
p
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
d©aLi°
;

1417  
i
 = 
pMsg
->
msg
.
ªadByTy≥R•
.
numPaús
; i > 0; i-- )

1420 
h™dÀ
 = 
	`BUILD_UINT16
(
p
[3],Ö[4]);

1421 
uuid
 = 
	`BUILD_UINT16
(
p
[5],Ö[6]);

1424 i‡–
timeAµEndHdlIdx
 != 0 )

1427 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
	`BUILD_UINT16
(
p
[0],Ö[1]) - 1;

1429 
timeAµEndHdlIdx
 = 0;

1433  
uuid
 )

1435 
RINGER_CP_UUID
:

1436 
timeAµHdlCache
[
HDL_PAS_CTRL
] = 
h™dÀ
;

1439 
ALERT_STATUS_UUID
:

1440 
timeAµHdlCache
[
HDL_PAS_ALERT_START
] = 
h™dÀ
;

1441 
timeAµEndHdlIdx
 = 
HDL_PAS_ALERT_END
;

1444 
RINGER_SETTING_UUID
:

1445 
timeAµHdlCache
[
HDL_PAS_RINGER_START
] = 
h™dÀ
;

1446 
timeAµEndHdlIdx
 = 
HDL_PAS_RINGER_END
;

1453 
p
 +
CHAR_DESC_HDL_UUID16_LEN
;

1459 i‡––
pMsg
->
mëhod
 =
ATT_READ_BY_TYPE_RSP
 &&

1460 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1461 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1464 i‡–
timeAµEndHdlIdx
 != 0 )

1466 
timeAµHdlCache
[
timeAµEndHdlIdx
] = 
timeAµSvcEndHdl
;

1467 
timeAµEndHdlIdx
 = 0;

1471 i‡–
timeAµHdlCache
[
HDL_PAS_ALERT_START
] == 0 )

1473 
√wSèã
 = 
DISC_FAILED
;

1475 i‡–
timeAµHdlCache
[
HDL_PAS_ALERT_START
] <

1476 
timeAµHdlCache
[
HDL_PAS_ALERT_END
] )

1479 
	`GATT_DiscAŒCh¨Descs
–
timeAµC⁄nH™dÀ
,

1480 
timeAµHdlCache
[
HDL_PAS_ALERT_START
] + 1,

1481 
timeAµHdlCache
[
HDL_PAS_ALERT_END
],

1482 
timeAµTaskId
 );

1484 
√wSèã
 = 
DISC_PAS_ALERT_CCCD
;

1489 
timeAµHdlCache
[
HDL_PAS_ALERT_START
] = 0;

1490 
√wSèã
 = 
DISC_FAILED
;

1496 
DISC_PAS_ALERT_CCCD
:

1498 
uöt8
 
i
;

1501 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1502 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

1503 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

1506  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

1509 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

1510 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

1511 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

1512 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

1515 
timeAµHdlCache
[
HDL_PAS_ALERT_CCCD
] =

1516 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

1524 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1525 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1526 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1529 i‡–
timeAµHdlCache
[
HDL_PAS_ALERT_CCCD
] != 0 )

1532 i‡–
timeAµHdlCache
[
HDL_PAS_RINGER_START
] <

1533 
timeAµHdlCache
[
HDL_PAS_RINGER_END
] )

1536 
	`GATT_DiscAŒCh¨Descs
–
timeAµC⁄nH™dÀ
,

1537 
timeAµHdlCache
[
HDL_PAS_RINGER_START
] + 1,

1538 
timeAµHdlCache
[
HDL_PAS_RINGER_END
],

1539 
timeAµTaskId
 );

1541 
√wSèã
 = 
DISC_PAS_RINGER_CCCD
;

1546 
timeAµHdlCache
[
HDL_PAS_RINGER_START
] = 0;

1547 
√wSèã
 = 
DISC_FAILED
;

1553 
timeAµHdlCache
[
HDL_PAS_ALERT_START
] = 0;

1554 
√wSèã
 = 
DISC_FAILED
;

1560 
DISC_PAS_RINGER_CCCD
:

1562 
uöt8
 
i
;

1565 i‡–
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1566 
pMsg
->
msg
.
födInfoR•
.
numInfo
 > 0 &&

1567 
pMsg
->
msg
.
födInfoR•
.
f‹m©
 =
ATT_HANDLE_BT_UUID_TYPE
 )

1570  
i
 = 0; i < 
pMsg
->
msg
.
födInfoR•
.
numInfo
; i++ )

1573 i‡–(
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[0] ==

1574 
	`LO_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) &&

1575 (
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
uuid
[1] ==

1576 
	`HI_UINT16
(
GATT_CLIENT_CHAR_CFG_UUID
)) )

1579 
timeAµHdlCache
[
HDL_PAS_RINGER_CCCD
] =

1580 
pMsg
->
msg
.
födInfoR•
.
öfo
.
btPaú
[
i
].
h™dÀ
;

1588 i‡––
pMsg
->
mëhod
 =
ATT_FIND_INFO_RSP
 &&

1589 
pMsg
->
hdr
.
°©us
 =
bÀPro˚duªCom∂ëe
 ) ||

1590 –
pMsg
->
mëhod
 =
ATT_ERROR_RSP
 ) )

1593 i‡–
timeAµHdlCache
[
HDL_PAS_RINGER_CCCD
] != 0 )

1595 
√wSèã
 = 
DISC_IDLE
;

1600 
timeAµHdlCache
[
HDL_PAS_RINGER_START
] = 0;

1601 
√wSèã
 = 
DISC_FAILED
;

1611  
√wSèã
;

1612 
	}
}

	@Projects/ble/TimeApp/Source/timeapp_ind.c

43 
	~"°rög.h
"

44 
	~"bcomdef.h
"

45 
	~"OSAL.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"hÆ_lcd.h
"

48 
	~"g©t.h
"

49 
	~"g©t_uuid.h
"

50 
	~"g©t£rv≠p.h
"

51 
	~"timóµ.h
"

58 
	#ALERT_CAT_ID_MAX
 9

	)

84 #i‚de‡
CC2540_MINIDK


86 c⁄° *
	gtimeAµAÀπC©Så
[] =

104 
timeAµDi•œyAÀπ
–
uöt8
 *
pVÆue
, uöt8 
Àn
 );

115 
	$timeAµIndG©tMsg
–
g©tMsgEvít_t
 *
pMsg
 )

117 
uöt8
 
i
;

120  
i
 = 0; i < 
HDL_CACHE_LEN
; i++ )

122 i‡–
pMsg
->
msg
.
h™dÀVÆueNŸi
.
h™dÀ
 =
timeAµHdlCache
[
i
] )

129  
i
 )

131 
HDL_CURR_TIME_CT_TIME_START
:

133 
	`timeAµClockSë
–
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
 );

136 
HDL_NWA_NWA_START
:

138 i‡–
pMsg
->
msg
.
h™dÀVÆueInd
.
vÆue
[0] == 1 )

140 
	`LCD_WRITE_STRING
–"Nëw‹k: Yes", 
HAL_LCD_LINE_1
 );

144 
	`LCD_WRITE_STRING
–"Nëw‹k: N⁄e", 
HAL_LCD_LINE_1
 );

148 
HDL_ALERT_NTF_UNREAD_START
:

151 
uöt8
 *
p
 = 
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
;

152 
uöt8
 
Àn
 = 
pMsg
->
msg
.
h™dÀVÆueNŸi
.len;

154 i‡–
p
[0] <
ALERT_CAT_ID_MAX
 && 
Àn
 == 2 )

156 
	`LCD_WRITE_STRING_VALUE
–(*Ë
timeAµAÀπC©Så
[
p
[0]],Ö[1], 10, 
HAL_LCD_LINE_1
 );

157 
	`LCD_WRITE_STRING
–"", 
HAL_LCD_LINE_2
 );

162 
HDL_ALERT_NTF_NEW_START
:

164 
	`timeAµDi•œyAÀπ
–
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
,

165 
pMsg
->
msg
.
h™dÀVÆueNŸi
.
Àn
 );

168 
HDL_BATT_LEVEL_START
:

170 
	`LCD_WRITE_STRING_VALUE
–"B©ãry%", 
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
[0], 10, 
HAL_LCD_LINE_2
 );

173 
HDL_PAS_ALERT_START
:

175 
	`LCD_WRITE_STRING_VALUE
–"Ph⁄êAÀπ:", 
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
[0], 16, 
HAL_LCD_LINE_1
 );

178 
HDL_PAS_RINGER_START
:

180 i‡–
pMsg
->
msg
.
h™dÀVÆueNŸi
.
vÆue
[0] == 0 )

182 
	`LCD_WRITE_STRING
–"Rögî Off", 
HAL_LCD_LINE_2
 );

186 
	`LCD_WRITE_STRING
–"Rögî On", 
HAL_LCD_LINE_2
 );

195 i‡–
pMsg
->
mëhod
 =
ATT_HANDLE_VALUE_IND
 )

197 
	`ATT_H™dÀVÆueCfm
–
pMsg
->
c⁄nH™dÀ
 );

199 
	}
}

212 
	$timeAµDi•œyAÀπ
–
uöt8
 *
pVÆue
, uöt8 
Àn
 )

214 
buf
[
HAL_LCD_MAX_CHARS
 + 1];

215 
uöt8
 
buÊí
;

218 i‡–
pVÆue
[0] <
ALERT_CAT_ID_MAX
 && 
Àn
 >= 2 )

221 
	`LCD_WRITE_STRING_VALUE
–(*Ë
timeAµAÀπC©Så
[
pVÆue
[0]],ÖVÆue[1], 10, 
HAL_LCD_LINE_1
 );

222 
pVÆue
 += 2;

223 
Àn
 -= 2;

226 
buÊí
 = 
	`MIN
–
HAL_LCD_MAX_CHARS
, 
Àn
 );

227 
	`mem˝y
–
buf
, 
pVÆue
, 
buÊí
 );

228 
buf
[
buÊí
] = '\0';

229 
	`LCD_WRITE_STRING
–
buf
, 
HAL_LCD_LINE_2
 );

231 
	}
}

	@Projects/ble/common/cc2540/OnBoard.c

45 
	~"bcomdef.h
"

46 
	~"OnBﬂrd.h
"

47 
	~"OSAL.h
"

48 
	~"OnBﬂrd.h
"

50 
	~"hÆ_Àd.h
"

51 
	~"hÆ_key.h
"

63 
	#NO_TASK_ID
 0xFF

	)

73 
uöt8
 
	gOnbﬂrdKeyI¡E«bÀ
;

83 
uöt8
 
LL_P£udoR™d
–uöt8 *
øndD©a
, uöt8 
d©aLí
 );

85 #i‡ 
deföed
 
FEATURE_ABL


86 
	~"..\..\utû\ABL\≠p\sbl_≠p.c
"

87 #ñi‡
deföed
 
FEATURE_SBL


88 
	~"..\..\utû\SBL\≠p\sbl_≠p.c
"

89 #ñi‡
deföed
 
FEATURE_EBL


90 
	~"..\..\utû\EBL\≠p\sbl_≠p.c
"

91 #ñi‡
deföed
 
FEATURE_UBL_MSD


92 
	~"..\..\utû\UBL\soc_8051\usb_msd\≠p\ubl_≠p.c
"

94 
≠pF‹˚BoŸ
();

102 
uöt8
 
	gªgi°îedKeysTaskID
 = 
NO_TASK_ID
;

110 
	$InôBﬂrd
–
uöt8
 
Àvñ
 )

112 i‡–
Àvñ
 =
OB_COLD
 )

115 
	`oßl_öt_dißbÀ
–
INTS_ALL
 );

117 
	`HÆLedSë
–
HAL_LED_ALL
, 
HAL_LED_MODE_OFF
 );

124 
OnbﬂrdKeyI¡E«bÀ
 = 
HAL_KEY_INTERRUPT_ENABLE
;

126 
	`HÆKeyC⁄fig
–
OnbﬂrdKeyI¡E«bÀ
, 
OnBﬂrd_KeyCÆlback
);

128 
	}
}

140 
uöt16
 
	$Onbﬂrd_ønd
( )

142 
uöt16
 
øndNum
;

144 
	`LL_P£udoR™d
–(
uöt8
 *)&
øndNum
, 2 );

146  ( 
øndNum
 );

147 
	}
}

161 
	$_ôﬂ
(
uöt16
 
num
, 
uöt8
 *
buf
, uöt8 
ødix
)

163 
c
,
i
;

164 
uöt8
 *
p
, 
r°
[5];

166 
p
 = 
r°
;

167  
i
=0; i<5; i++,
p
++ )

169 
c
 = 
num
 % 
ødix
;

170 *
p
 = 
c
 + (( c < 10 ) ? '0' : '7');

171 
num
 /
ødix
;

172 i‡–!
num
 )

176  
c
=0 ; c<=
i
; c++ )

177 *
buf
++ = *
p
--;

179 *
buf
 = '\0';

180 
	}
}

195 
uöt8
 
	$Regi°îF‹Keys
–
uöt8
 
èsk_id
 )

198 i‡–
ªgi°îedKeysTaskID
 =
NO_TASK_ID
 )

200 
ªgi°îedKeysTaskID
 = 
èsk_id
;

201  ( 
åue
 );

204  ( 
Ál£
 );

205 
	}
}

217 
uöt8
 
	$OnBﬂrd_SídKeys
–
uöt8
 
keys
, uöt8 
°©e
 )

219 
keyCh™ge_t
 *
msgPå
;

221 i‡–
ªgi°îedKeysTaskID
 !
NO_TASK_ID
 )

224 
msgPå
 = (
keyCh™ge_t
 *)
	`oßl_msg_Æloˇã
( (keyChange_t) );

225 i‡–
msgPå
 )

227 
msgPå
->
hdr
.
evít
 = 
KEY_CHANGE
;

228 
msgPå
->
°©e
 = state;

229 
msgPå
->
keys
 = keys;

231 
	`oßl_msg_£nd
–
ªgi°îedKeysTaskID
, (
uöt8
 *)
msgPå
 );

233  ( 
SUCCESS
 );

236  ( 
FAILURE
 );

237 
	}
}

249 
	$OnBﬂrd_KeyCÆlback
 ( 
uöt8
 
keys
, uöt8 
°©e
 )

251 
uöt8
 
shi·
;

252 ()
°©e
;

256 
shi·
 = (
OnbﬂrdKeyI¡E«bÀ
 =
HAL_KEY_INTERRUPT_ENABLE
Ë? 
Ál£
 : ((
keys
 & 
HAL_KEY_SW_6
Ë? 
åue
 : false);

258 i‡–
	`OnBﬂrd_SídKeys
–
keys
, 
shi·
 ) !
SUCCESS
 )

261 i‡–
keys
 & 
HAL_KEY_SW_1
 )

265 i‡–
keys
 & 
HAL_KEY_SW_2
 )

269 i‡–
keys
 & 
HAL_KEY_SW_3
 )

273 i‡–
keys
 & 
HAL_KEY_SW_4
 )

277 i‡–
keys
 & 
HAL_KEY_SW_5
 )

281 i‡–
keys
 & 
HAL_KEY_SW_6
 )

288 if–
keys
 != 0 )

290 if–
OnbﬂrdKeyI¡E«bÀ
 =
HAL_KEY_INTERRUPT_ENABLE
 )

292 
OnbﬂrdKeyI¡E«bÀ
 = 
HAL_KEY_INTERRUPT_DISABLE
;

293 
	`HÆKeyC⁄fig
–
OnbﬂrdKeyI¡E«bÀ
, 
OnBﬂrd_KeyCÆlback
);

300 if–
OnbﬂrdKeyI¡E«bÀ
 =
HAL_KEY_INTERRUPT_DISABLE
 )

302 
OnbﬂrdKeyI¡E«bÀ
 = 
HAL_KEY_INTERRUPT_ENABLE
;

303 
	`HÆKeyC⁄fig
–
OnbﬂrdKeyI¡E«bÀ
, 
OnBﬂrd_KeyCÆlback
);

306 
	}
}

318 
__√¨_func
 
	$Onbﬂrd_so·_ª£t
( )

320 
	`HAL_DISABLE_INTERRUPTS
();

321 
	`asm
("LJMP 0x0");

322 
	}
}

324 #i‡ 
deföed
 
FEATURE_ABL


325 #ñi‡
deföed
 
FEATURE_SBL


326 #ñi‡
deföed
 
FEATURE_EBL


327 #ñi‡
deföed
 
FEATURE_UBL_MSD


338 
	$≠pF‹˚BoŸ
()

341 
	}
}

	@Projects/ble/common/cc2540/OnBoard.h

41 #i‚de‡
ONBOARD_H


42 
	#ONBOARD_H


	)

44 
	~"hÆ_mcu.h
"

45 
	~"hÆ_¶ìp.h
"

46 
	~"oßl.h
"

51 
	#MCU_RAM_BEG
 0x0100

	)

52 
	#MCU_RAM_END
 
RAMEND


	)

53 
	#MCU_RAM_LEN
 (
MCU_RAM_END
 - 
MCU_RAM_BEG
 + 1)

	)

56 #i‡!
deföed
–
INT_HEAP_LEN
 )

57 
	#INT_HEAP_LEN
 1024

59 

	)

61 #i‡
deföed
–
EXTERNAL_RAM
 )

62 
	#MAXMEMHEAP
 
EXT_RAM_LEN


63 #ñ£

	)

64 
	#MAXMEMHEAP
 
INT_HEAP_LEN


66 

	)

68 
	#OB_COLD
 0

	)

69 
	#OB_WARM
 1

	)

70 
	#OB_READY
 2

	)

72 
	#Sy°emRe£tSo·
(Ë
	`Onbﬂrd_so·_ª£t
()

	)

76 
oßl_evít_hdr_t
 
	mhdr
;

77 
uöt8
 
	m°©e
;

78 
uöt8
 
	mkeys
;

79 } 
	tkeyCh™ge_t
;

82 
	#TIMER_DECR_TIME
 1

83 
	#RETUNE_THRESHOLD
 1

84 

	)

86 
	#TICK_TIME
 1000

	)

87 
	#TICK_COUNT
 1

	)

88 
	#OSAL_TIMER
 
HAL_TIMER_3


	)

90 #i‚de‡
_WIN32


91 
_ôﬂ
(
uöt16
 
num
, 
uöt8
 *
buf
, uöt8 
ødix
);

94 #i‚de‡
RAMEND


95 
	#RAMEND
 0x1000

	)

99 
	#MT_UART_THRESHOLD
 5

	)

100 
	#MT_UART_TX_BUFF_MAX
 170

	)

101 
	#MT_UART_RX_BUFF_MAX
 128

	)

102 
	#MT_UART_IDLE_TIMEOUT
 5

	)

107 #i‡
_löt


108 
	#Sy°emRe£t
()

	)

110 
	#Sy°emRe£t
(Ë
	`HAL_SYSTEM_RESET
();

	)

113 
	#BoŸLﬂdî
()

	)

116 
	#Re£tRós⁄
(Ë((
SLEEPSTA
 >> 3Ë& 0x03)

	)

119 #i‡
deföed
 (
ZAPP_P1
)

120 
	#ZAPP_PORT
 
HAL_UART_PORT_0


121 #ñi‡
	`deföed
 (
ZAPP_P2
)

	)

122 
	#ZAPP_PORT
 
HAL_UART_PORT_1


123 #ñ£

	)

124 #unde‡
ZAPP_PORT


126 #i‡
deföed
 (
ZTOOL_P1
)

127 
	#ZTOOL_PORT
 
HAL_UART_PORT_0


128 #ñi‡
	`deföed
 (
ZTOOL_P2
)

	)

129 
	#ZTOOL_PORT
 
HAL_UART_PORT_1


130 #ñ£

	)

131 #unde‡
ZTOOL_PORT


135 
	#SLEEP_DEEP
 0

	)

136 
	#SLEEP_LITE
 0

	)

137 
	#MIN_SLEEP_TIME
 14

	)

138 
	#OSAL_SET_CPU_INTO_SLEEP
(
m
Ë
	`hÆSÀï
(mË

	)

141 
uöt8
 
OnBﬂrd_SídKeys
–uöt8 
keys
, uöt8 
°©e
 );

146 
uöt16
 
Onbﬂrd_ønd
( );

152 
uöt32
 
TimîEœp£d
( );

158 
InôBﬂrd
–
uöt8
 
Àvñ
 );

163 
uöt8
 
Regi°îF‹Keys
–uöt8 
èsk_id
 );

170 
uöt8
 
OnBﬂrd_SídKeys
–uöt8 
keys
, uöt8 
shi·
);

175 
OnBﬂrd_KeyCÆlback
 ( 
uöt8
 
keys
, uöt8 
°©e
 );

180 
__√¨_func
 
Onbﬂrd_so·_ª£t
( );

	@Projects/ble/common/npi/npi_np/npi.c

47 
	~"hÆ_ty≥s.h
"

48 
	~"hÆ_bﬂrd.h
"

49 
	~"≈i.h
"

96 
	$NPI_InôTøn•‹t
–
≈iCBack_t
 
≈iCBack
 )

98 
hÆUARTCfg_t
 
u¨tC⁄fig
;

101 
u¨tC⁄fig
.
c⁄figuªd
 = 
TRUE
;

102 
u¨tC⁄fig
.
baudR©e
 = 
NPI_UART_BR
;

103 
u¨tC⁄fig
.
ÊowC⁄åﬁ
 = 
NPI_UART_FC
;

104 
u¨tC⁄fig
.
ÊowC⁄åﬁThªshﬁd
 = 
NPI_UART_FC_THRESHOLD
;

105 
u¨tC⁄fig
.
rx
.
maxBufSize
 = 
NPI_UART_RX_BUF_SIZE
;

106 
u¨tC⁄fig
.
tx
.
maxBufSize
 = 
NPI_UART_TX_BUF_SIZE
;

107 
u¨tC⁄fig
.
idÀTimeout
 = 
NPI_UART_IDLE_TIMEOUT
;

108 
u¨tC⁄fig
.
ötE«bÀ
 = 
NPI_UART_INT_ENABLE
;

109 
u¨tC⁄fig
.
ˇŒBackFunc
 = (
hÆUARTCBack_t
)
≈iCBack
;

113 ()
	`HÆUARTO≥n
–
NPI_UART_PORT
, &
u¨tC⁄fig
 );

116 
	}
}

136 
uöt16
 
	$NPI_RódTøn•‹t
–
uöt8
 *
buf
, 
uöt16
 
Àn
 )

138 –
	`HÆUARTRód
–
NPI_UART_PORT
, 
buf
, 
Àn
 ) );

139 
	}
}

158 
uöt16
 
	$NPI_WrôeTøn•‹t
–
uöt8
 *
buf
, 
uöt16
 
Àn
 )

160 –
	`HÆUARTWrôe
–
NPI_UART_PORT
, 
buf
, 
Àn
 ) );

161 
	}
}

179 
uöt16
 
	$NPI_RxBufLí
( )

181 –
	`HÆ_UART_RxBufLí
–
NPI_UART_PORT
 ) );

182 
	}
}

200 
uöt16
 
	$NPI_GëMaxRxBufSize
( )

202 –
NPI_UART_RX_BUF_SIZE
 );

203 
	}
}

221 
uöt16
 
	$NPI_GëMaxTxBufSize
( )

223 –
NPI_UART_TX_BUF_SIZE
 );

224 
	}
}

	@Projects/ble/common/npi/npi_np/npi.h

43 #i‚de‡
NPI_H


44 
	#NPI_H


	)

46 #ifde‡
__˝lu•lus


55 
	~"hÆ_ty≥s.h
"

56 
	~"hÆ_bﬂrd.h
"

57 
	~"hÆ_u¨t.h
"

68 #i‡!
deföed
 
NPI_UART_PORT


69 #i‡((
deföed
 
HAL_UART_SPI
) && (HAL_UART_SPI != 0))

70 
	#NPI_UART_PORT
 
HAL_UART_PORT_1


	)

72 
	#NPI_UART_PORT
 
HAL_UART_PORT_0


	)

76 #i‡!
deföed
–
NPI_UART_FC
 )

77 
	#NPI_UART_FC
 
TRUE


	)

80 
	#NPI_UART_FC_THRESHOLD
 48

	)

81 
	#NPI_UART_RX_BUF_SIZE
 128

	)

82 
	#NPI_UART_TX_BUF_SIZE
 128

	)

83 
	#NPI_UART_IDLE_TIMEOUT
 6

	)

84 
	#NPI_UART_INT_ENABLE
 
TRUE


	)

86 #i‡!
deföed
–
NPI_UART_BR
 )

87 
	#NPI_UART_BR
 
HAL_UART_BR_115200


	)

94 (*
≈iCBack_t
Ë–
	tuöt8
 
	tp‹t
, uöt8 
	tevít
 );

112 
NPI_InôTøn•‹t
–
≈iCBack_t
 
≈iCBack
 );

113 
uöt16
 
NPI_RódTøn•‹t
–
uöt8
 *
buf
, uöt16 
Àn
 );

114 
uöt16
 
NPI_WrôeTøn•‹t
–
uöt8
 *, uint16 );

115 
uöt16
 
NPI_RxBufLí
( );

116 
uöt16
 
NPI_GëMaxRxBufSize
( );

117 
uöt16
 
NPI_GëMaxTxBufSize
( );

122 #ifde‡
__˝lu•lus


	@Projects/ble/util/BEM/app/bem_main.c

47 
	~<°ddef.h
>

48 
	~<°rög.h
>

50 
	~"hÆ_´s.h
"

51 
	~"hÆ_dma.h
"

52 
	~"hÆ_Êash.h
"

53 
	~"hÆ_ty≥s.h
"

60 
	#BEM_IMG_A_PAGE
 1

	)

61 
	#BEM_IMG_A_AREA
 62

	)

63 
	#BEM_IMG_B_PAGE
 8

	)

64 
	#BEM_IMG_B_AREA
 (124 - 
BEM_IMG_A_AREA
)

	)

66 c⁄° 
uöt8
 
	gImgPageBeg
[2] = { 
BEM_IMG_A_PAGE
, 
BEM_IMG_B_PAGE
 };

67 c⁄° 
uöt8
 
	gImgPageLí
[2] = { 
BEM_IMG_A_AREA
, 
BEM_IMG_B_AREA
 };

69 
	#BEM_AES_OSET
 0x10

	)

71 c⁄° 
uöt8
 
	g´sKey
[
KEY_BLENGTH
] = {

76 
	#BEM_PAGE_LEN
 (
uöt16
)(
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
)

	)

79 
	#SBL_RW_BUF_LEN
 64

	)

89 
uöt16
 
	m¸c0
;

90 
uöt16
 
	m¸c1
;

92 
uöt16
 
	mvî
;

93 
uöt16
 
	mÀn
;

94 
uöt8
 
	muid
[4];

95 
uöt8
 
	mªs
[4];

96 } 
	timg_hdr_t
;

97 
°©ic_as£π
(((
img_hdr_t
Ë=
BEM_AES_OSET
), "img_hdr_t size mismatch with BEM_AES_OSET");

101 
uöt8
 
	msig«tuª
[
KEY_BLENGTH
];

102 
uöt8
 
	mn⁄˚12
[12];

103 
uöt8
 
	m•¨e
[4];

104 } 
	t´s_hdr_t
;

112 
	#BEM_NVM_GET
(
PG
, 
PBUF
, 
BYTE_CNT
Ë
	`HÆFœshRód
((PG), 0, (*)(PBUF), (BYTE_CNT))

	)

115 
	#BEM_NVM_SET
(
PG
, 
PBUF
, 
BYTE_CNT
Ë
	`HÆFœshWrôe
( \

116 (
PG
Ë* (
uöt16
)(
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
), (*)(
PBUF
), (
BYTE_CNT
) /\

117 
HAL_FLASH_WORD_SIZE
)

	)

121 
	#BEM_IMG_HDR_LEN_2_PG_CNT
(
LEN
Ë((LENË/ 
BEM_PAGE_LEN
)

	)

123 
	#BEM_IMG_R2R
(
IMG_HDR
) \

124 ((((
IMG_HDR
).
¸c0
 != 0) && \

125 ((
IMG_HDR
).
¸c0
 != 0xFFFF) && \

126 ((
IMG_HDR
).
¸c0
 =(IMG_HDR).
¸c1
)Ë? 1 : 0)

	)

133 
__no_öô
 
hÆDMADesc_t
 
	gdmaCh0
;

140 
__no_öô
 
uöt8
 
	g∑geBuf
[
HAL_FLASH_PAGE_SIZE
];

142 
__no_öô
 
__d©a
 
uöt8
 
	gJumpToImageA‹B
 @ 0x09;

149 #¥agm®
loˇti⁄
 = "ALIGNED_CODE"

150 
hÆSÀïExec
();

173 #¥agm®
›timize
=
n⁄e


174 
	$hÆSÀïExec
()

176 
PCON
 = 0x01;

177 
ASM_NOP
;

178 
	}
}

195 
	$´sLﬂdKey
()

198 
uöt8
 *
keyPå
 = (uöt8 *)
´sKey
;

200 
ENCCS
 = 
ECB
 | 
AES_LOAD_KEY
 | 0x01;

204 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

206 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

208 
ENCDI
 = *
keyPå
++;

210 
	}
}

227 
	$´sInôSig
(
´s_hdr_t
 *
´sHdr
)

229 
ENCCS
 = 
CBC_MAC
 | 
AES_LOAD_IV
 | 0x01;

233 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

235 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

237 
ENCDI
 = 0;

240 
ENCCS
 = 
CBC_MAC
 | 
AES_ENCRYPT
 | 0x01;

244 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

246 
ENCDI
 = 0x3A;

248 
uöt8
 
idx
 = 0; idx < 12; idx++)

250 
ENCDI
 = 
´sHdr
->
n⁄˚12
[
idx
];

254 
ENCDI
 = 
´sHdr
->
•¨e
[2];

255 
ENCDI
 = 
´sHdr
->
•¨e
[1];

256 
ENCDI
 = 
´sHdr
->
•¨e
[0];

258 (
ENCCS
 & 
	`BV
(3)) == 0);

259 
	}
}

277 
	$´sCry±
(
uöt8
 
skùC¡
, uöt8 *
pBuf
)

280 
uöt8
 
ivN⁄˚
[
KEY_BLENGTH
] = { 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 };

282 
ENCCS
 = 
CTR
 | 
AES_LOAD_IV
 | 0x01;

286 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

288 
uöt8
 
idx
 = 0; idx < 
KEY_BLENGTH
; idx++)

290 
ENCDI
 = 
ivN⁄˚
[
idx
];

292 (
ENCCS
 & 
	`BV
(3)) == 0);

294 
uöt8
 
˙t
 = 0; c¡ < (
SBL_RW_BUF_LEN
 / 
KEY_BLENGTH
); cnt++)

296 i‡(
skùC¡
 == 0)

298 
ENCCS
 = 
CTR
 | 
AES_ENCRYPT
 | 0x01;

302 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

304 
uöt8
 
blk
 = 0; blk < 4; blk++)

306 
uöt8
 
idx
 = 0; idx < 4; idx++)

308 
ENCDI
 = 
pBuf
[
idx
];

311 
	`HAL_AES_DELAY
();

313 
uöt8
 
idx
 = 0; idx < 4; idx++)

315 
pBuf
[
idx
] = 
ENCDO
;

318 
pBuf
 += 4;

323 
skùC¡
--;

324 
pBuf
 +
KEY_BLENGTH
;

327 
	}
}

346 
uöt8
 
	$´sSig«tuª
(
uöt8
 
imgSñ
, 
´s_hdr_t
 *
´sHdr
)

348 
uöt8
 
sigBuf
[
KEY_BLENGTH
];

349 
	`´sInôSig
(
´sHdr
);

351 
uöt8
 
pgEnd
 = 
ImgPageBeg
[
imgSñ
] + 
´sHdr
->
•¨e
[3] - 1;

353 i‡(
imgSñ
 == 0)

355 
pgEnd
 +
ImgPageLí
[1];

358 
uöt8
 
pgNum
 = 
ImgPageBeg
[
imgSñ
];ÖgNum <
pgEnd
; )

360 
	`BEM_NVM_GET
(
pgNum
, 
∑geBuf
, 
HAL_FLASH_PAGE_SIZE
);

362 
uöt16
 
o£t
 = 0; o£à< 
HAL_FLASH_PAGE_SIZE
; )

364 i‡((
pgNum
 =
ImgPageBeg
[
imgSñ
]Ë&& (
o£t
 =(
img_hdr_t
)))

366 
o£t
 +
KEY_BLENGTH
;

368 i‡((
pgNum
 =
pgEnd
Ë&& (
o£t
 =(
HAL_FLASH_PAGE_SIZE
 - 
KEY_BLENGTH
)))

373 
ENCCS
 |= 0x01;

374 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

376 
ENCDI
 = 
∑geBuf
[
o£t
++];

378 (
ENCCS
 & 
	`BV
(3)) == 0);

381 
pgNum
++;

383 i‡((
imgSñ
 =0Ë&& (
pgNum
 =
ImgPageBeg
[1]))

385 
pgNum
 +
ImgPageLí
[1];

389 
ENCCS
 = 
CBC
 | 
AES_ENCRYPT
 | 0x01;

393 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

395 
uöt16
 
o£t
 = (
HAL_FLASH_PAGE_SIZE
 - 
KEY_BLENGTH
); oset < HAL_FLASH_PAGE_SIZE; oset++)

397 
ENCDI
 = 
∑geBuf
[
o£t
];

399 
	`HAL_AES_DELAY
();

402 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

404 
sigBuf
[
˙t
] = 
ENCDO
;

407  ((
	`memcmp
(
sigBuf
, 
´sHdr
->
sig«tuª
, 
KEY_BLENGTH
Ë=0Ë? 
TRUE
 : 
FALSE
);

408 
	}
}

428 
uöt8
 
	$imgAuth
(
uöt8
 
imgSñ
, 
img_hdr_t
 *
imgHdr
)

430 i‡((
imgHdr
->
¸c0
 == 0) || (imgHdr->crc0 == 0xFFFF))

432  
FALSE
;

435 i‡(
imgHdr
->
¸c0
 !imgHdr->
¸c1
)

437 
	`´sLﬂdKey
();

439 
´s_hdr_t
 
´sHdr
;

440 
	`HÆFœshRód
(
ImgPageBeg
[
imgSñ
], 
BEM_AES_OSET
, (
uöt8
 *)&
´sHdr
, (
´s_hdr_t
));

443 
uöt32
 
imageLí
 = (uöt32)
HAL_FLASH_PAGE_SIZE
 * 
imgHdr
->
ªs
[0] - 
KEY_BLENGTH
;

445 
´sHdr
.
•¨e
[0] = ((
uöt8
 *)&
imageLí
)[0];

446 
´sHdr
.
•¨e
[1] = ((
uöt8
 *)&
imageLí
)[1];

447 
´sHdr
.
•¨e
[2] = ((
uöt8
 *)&
imageLí
)[2];

448 
´sHdr
.
•¨e
[3] = 
imgHdr
->
ªs
[0];

450 i‡(
	`´sSig«tuª
(
imgSñ
, &
´sHdr
))

452 
uöt16
 
¸c
[2] = { 0xFFFF, 
imgHdr
->
¸c0
 };

454 
	`BEM_NVM_SET
(
ImgPageBeg
[
imgSñ
], (
uöt8
 *)
¸c
, 4);

455 
	`BEM_NVM_GET
(
ImgPageBeg
[
imgSñ
], (
uöt8
 *)&
imgHdr
, 4);

459  (
imgHdr
->
¸c0
 =imgHdr->
¸c1
);

460 
	}
}

478 
	$imgCry±
(
uöt8
 
imgSñ
, 
img_hdr_t
 *
imgHdr
)

480 
	`´sLﬂdKey
();

482 
uöt8
 
pgEnd
 = 
imgHdr
->
ªs
[0] + 
ImgPageBeg
[
imgSñ
];

484 i‡(
imgSñ
 == 0)

486 
pgEnd
 +
ImgPageLí
[1];

489 
uöt8
 
pgNum
 = 
ImgPageBeg
[
imgSñ
];ÖgNum < 
pgEnd
; )

491 
	`BEM_NVM_GET
(
pgNum
, 
∑geBuf
, 
HAL_FLASH_PAGE_SIZE
);

494 
uöt8
 
blk
 = 0; blk < (
HAL_FLASH_PAGE_SIZE
 / 
SBL_RW_BUF_LEN
); blk++)

496 i‡((
pgNum
 =
ImgPageBeg
[
imgSñ
]Ë&& (
blk
 == 0))

498 
	`´sCry±
(1, 
∑geBuf
 + ((
uöt16
)
SBL_RW_BUF_LEN
 * 
blk
));

502 
	`´sCry±
(0, 
∑geBuf
 + ((
uöt16
)
SBL_RW_BUF_LEN
 * 
blk
));

506 
	`HÆFœshEø£
(
pgNum
);

507 
	`BEM_NVM_SET
(
pgNum
, 
∑geBuf
, 
HAL_FLASH_PAGE_SIZE
);

509 
pgNum
++;

511 i‡((
imgSñ
 =0Ë&& (
pgNum
 =
ImgPageBeg
[1]))

513 
pgNum
 +
ImgPageLí
[1];

516 
	}
}

533 #¥agm®
›timize
=
n⁄e


534 
	$imgRun
(
uöt8
 
imgSñe˘
)

537 i‡((
JumpToImageA‹B
 = 
imgSñe˘
) == 0)

539 
	`asm
("LJMP 0x0830");

543 
	`asm
("LJMP 0x4030");

546 
	`HAL_SYSTEM_RESET
();

547 
	}
}

565 
	$imgSñe˘
()

567 
img_hdr_t
 
imgHdr
[2];

569 
uöt8
 
idx
 = 0; idx < 2; idx++)

571 
	`BEM_NVM_GET
(
ImgPageBeg
[
idx
], (
uöt8
 *)&
imgHdr
[idx], (
img_hdr_t
));

574 
imgHdr
[
idx
].
ªs
[0] = 
	`BEM_IMG_HDR_LEN_2_PG_CNT
(imgHdr[idx].
Àn
);

576 i‡(
imgHdr
[
idx
].
ªs
[0] > 
ImgPageLí
[idx])

578 
imgHdr
[
idx
].
¸c0
 = 0;

583 i‡((
imgHdr
[0].
¸c0
 !0xFFFFË&& (imgHdr[0].¸c0 !0x0000Ë&& (imgHdr[0].
¸c1
 == 0xFFFF))

585 
	`imgCry±
(0, 
imgHdr
+0);

587 i‡(
	`imgAuth
(0, 
imgHdr
+0))

590 
uöt16
 
¸c
[2] = { 0x0000, 0xFFFF };

591 
	`BEM_NVM_SET
(
ImgPageBeg
[1], (
uöt8
 *)
¸c
, (crc));

593 
	`imgRun
(0);

598 
uöt16
 
¸c
[2] = { 0x0000, 0xFFFF };

599 
	`BEM_NVM_SET
(
ImgPageBeg
[0], (
uöt8
 *)
¸c
, (crc));

603 i‡(
	`BEM_IMG_R2R
(
imgHdr
[1]))

605 
	`imgRun
(1);

609 i‡((
imgHdr
[1].
¸c0
 !0xFFFFË&& (imgHdr[1].¸c0 !0x0000Ë&& (imgHdr[1].
¸c1
 == 0xFFFF))

611 
	`imgCry±
(1, 
imgHdr
+1);

613 i‡(
	`imgAuth
(1, 
imgHdr
+1))

615 
	`imgRun
(1);

620 
uöt16
 
¸c
[2] = { 0x0000, 0xFFFF };

621 
	`BEM_NVM_SET
(
ImgPageBeg
[1], (
uöt8
 *)
¸c
, (crc));

625 i‡(
	`BEM_IMG_R2R
(
imgHdr
[0]))

627 
	`imgRun
(0);

629 
	}
}

646 
	$vddWaô
()

648 
uöt8
 
˙t
 = 16;

652 
ADCCON3
 = 0x0F;

653 !(
ADCCON1
 & 0x80));

654 } 
ADCH
 < 
VDD_MIN_RUN
);

655 } --
˙t
);

656 
	}
}

674 
	$maö
()

676 
	`vddWaô
();

678 
	`HAL_BOARD_INIT
();

683 
	`HAL_DMA_SET_ADDR_DESC0
(&
dmaCh0
);

686 
MEMCTR
 = (MEMCTR & 0xF8) | 0x07;

688 
	`imgSñe˘
();

690 
SLEEPCMD
 |= 0x03;

691 
	`hÆSÀïExec
();

692 
	`HAL_SYSTEM_RESET
();

693 
	}
}

	@Projects/ble/util/BIM/app/bim_main.c

47 
	~"hÆ_dma.h
"

48 
	~"hÆ_Êash.h
"

49 
	~"hÆ_ty≥s.h
"

56 
	#BIM_IMG_A_PAGE
 1

	)

57 
	#BIM_IMG_A_AREA
 62

	)

59 
	#BIM_IMG_B_PAGE
 8

	)

60 
	#BIM_IMG_B_AREA
 (124 - 
BIM_IMG_A_AREA
)

	)

62 
	#BIM_CRC_OSET
 0x00

	)

63 
	#BIM_HDR_OSET
 0x00

	)

73 
uöt16
 
	m¸c0
;

74 
uöt16
 
	m¸c1
;

76 
uöt16
 
	mvî
;

77 
uöt16
 
	mÀn
;

78 
uöt8
 
	muid
[4];

79 
uöt8
 
	mªs
[4];

80 } 
	timg_hdr_t
;

87 
__no_öô
 
hÆDMADesc_t
 
	gdmaCh0
;

94 
__no_öô
 
uöt8
 
	gpgBuf
[
HAL_FLASH_PAGE_SIZE
];

96 
__no_öô
 
__d©a
 
uöt8
 
	gJumpToImageA‹B
 @ 0x09;

98 #¥agm®
loˇti⁄
 = "ALIGNED_CODE"

99 
hÆSÀïExec
();

122 #¥agm®
›timize
=
n⁄e


123 
	$hÆSÀïExec
()

125 
PCON
 = 0x01;

126 
ASM_NOP
;

127 
	}
}

145 
uöt16
 
	$¸cCÆc
(
uöt8
 
∑ge
)

147 
	`HÆFœshRód
(
∑ge
, 0, 
pgBuf
, 
HAL_FLASH_PAGE_SIZE
);

149 c⁄° 
img_hdr_t
 *
pImgHdr
 = (c⁄° img_hdr_à*)(
pgBuf
 + 
BIM_HDR_OSET
);

151 
uöt8
 
∑geBeg
 = 
∑ge
;

152 
uöt8
 
∑geEnd
 = 
pImgHdr
->
Àn
 / (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
);

153 
uöt16
 
o£tEnd
 = (
pImgHdr
->
Àn
 - (
∑geEnd
 * (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
)))

154 * 
HAL_FLASH_WORD_SIZE
;

155 
∑geEnd
 +
∑geBeg
;

156 i‡(
∑geBeg
 =
BIM_IMG_A_PAGE
)

158 
∑geEnd
 +
BIM_IMG_B_AREA
;

161 
ADCCON1
 &= 0xF3;

164 
RNDL
 = 0x00;

165 
RNDL
 = 0x00;

169 
uöt16
 
o£t
 = 0; o£à< 
HAL_FLASH_PAGE_SIZE
; oset++)

171 i‡((
∑ge
 =
∑geBeg
Ë&& (
o£t
 =
BIM_CRC_OSET
))

173 
o£t
 += 3;

175 i‡((
∑ge
 =
∑geEnd
Ë&& (
o£t
 =
o£tEnd
))

177 
uöt16
 
¸c
 = 
RNDH
;

178 
¸c
 = (¸¯<< 8Ë| 
RNDL
;

180  
¸c
;

184 
RNDH
 = 
pgBuf
[
o£t
];

188 i‡(++
∑ge
 =
BIM_IMG_B_PAGE
)

190 
∑ge
 +
BIM_IMG_B_AREA
;

192 
	`HÆFœshRód
(
∑ge
, 0, 
pgBuf
, 
HAL_FLASH_PAGE_SIZE
);

194 
	}
}

212 
	$¸cCheck
(
uöt8
 
∑ge
, 
uöt16
 *
¸c
)

214 
	`HAL_BOARD_INIT
();

219 
	`HAL_DMA_SET_ADDR_DESC0
(&
dmaCh0
);

221 i‡(
¸c
[0] =
	`¸cCÆc
(
∑ge
))

223 
uöt16
 
addr
 = 
∑ge
 * (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
) +

224 
BIM_CRC_OSET
 / 
HAL_FLASH_WORD_SIZE
;

225 
¸c
[1] = crc[0];

226 
¸c
[0] = 0xFFFF;

228 
	`HÆFœshWrôe
(
addr
, (
uöt8
 *)
¸c
, 1);

229 
	`HAL_SYSTEM_RESET
();

231 
	}
}

249 
	$maö
()

251 
uöt16
 
¸c
[2];

254 
	`HÆFœshRód
(
BIM_IMG_B_PAGE
, 
BIM_CRC_OSET
, (
uöt8
 *)
¸c
, 4);

256 i‡((
¸c
[0] != 0xFFFF) && (crc[0] != 0x0000))

258 i‡(
¸c
[0] == crc[1])

260 
JumpToImageA‹B
 = 1;

262 
	`asm
("LJMP 0x4030");

263 
	`HAL_SYSTEM_RESET
();

273 
	`HÆFœshRód
(
BIM_IMG_A_PAGE
, 
BIM_CRC_OSET
, (
uöt8
 *)
¸c
, 4);

275 i‡((
¸c
[0] != 0xFFFF) && (crc[0] != 0x0000))

277 i‡(
¸c
[0] == crc[1])

279 
JumpToImageA‹B
 = 0;

281 
	`asm
("LJMP 0x0830");

282 
	`HAL_SYSTEM_RESET
();

284 i‡(
¸c
[1] == 0xFFFF)

286 
	`¸cCheck
(
BIM_IMG_A_PAGE
, 
¸c
);

290 
SLEEPCMD
 |= 0x03;

291 
	`hÆSÀïExec
();

292 
	`HAL_SYSTEM_RESET
();

293 
	}
}

	@Projects/ble/util/EBL/app/cc254x/_sbl_spi.c

47 
	~"hÆ_dma.h
"

48 
	~"hÆ_ty≥s.h
"

49 
	~"hÆ_u¨t.h
"

50 
	~"sbl_exec.h
"

57 
hÆDMADesc_t
 
	gdmaCh1234
[4];

64 
uöt8
 
	gsblRe£t
;

71 
	~"_hÆ_u¨t_•i.c
"

89 
	$sblRxCB
(
uöt8
 
p‹t
, uöt8 
evít
)

91 ()
p‹t
;

92 ()
evít
;

94 
sblRe£t
 = 
	`sblPﬁl
();

95 
	}
}

112 
	$sblRun
()

114 
hÆUARTCfg_t
 
u¨tC⁄fig
;

115 
u¨tC⁄fig
.
ˇŒBackFunc
 = 
sblRxCB
;

117 
	`HAL_DMA_SET_ADDR_DESC1234
(
dmaCh1234
);

119 
	`HÆUARTInôSPI
();

120 
	`HÆUARTO≥nSPI
(&
u¨tC⁄fig
);

124 i‡(
PxIFG
 & 
SPI_RDYIn_BIT
)

126 
	`•iRdyIn
();

129 
	`HÆUARTPﬁlSPI
();

131 i‡(
	`HAL_DMA_CHECK_IRQ
(
HAL_SPI_CH_TX
))

133 
	`HAL_DMA_CLEAR_IRQ
(
HAL_SPI_CH_TX
);

134 
	`HÆUART_DMAI§SPI
();

136 i‡(
sblRe£t
)

138 
	`HAL_SYSTEM_RESET
();

142 
	}
}

159 
uöt8
 
	$sblWaô
()

161  
FALSE
;

162 
	}
}

165 
uöt16
 
	$HÆUARTRód
(
uöt8
 
p‹t
, uöt8 *
pBuf„r
, 
uöt16
 
Àngth
)

167 ()
p‹t
;

169  
	`HÆUARTRódSPI
(
pBuf„r
, 
Àngth
);

170 
	}
}

172 
uöt16
 
	$HÆUARTWrôe
(
uöt8
 
p‹t
, uöt8 *
pBuf„r
, 
uöt16
 
Àngth
)

174 ()
p‹t
;

176  
	`HÆUARTWrôeSPI
(
pBuf„r
, 
Àngth
);

177 
	}
}

	@Projects/ble/util/EBL/app/cc254x/_sbl_uart.c

47 
	~"hÆ_bﬂrd.h
"

48 
	~"hÆ_mcu.h
"

49 
	~"hÆ_Ωc.h
"

50 
	~"hÆ_ty≥s.h
"

51 
	~"hÆ_u¨t.h
"

59 
	#CSR_MODE
 0x80

	)

60 
	#CSR_RE
 0x40

	)

61 
	#CSR_SLAVE
 0x20

	)

62 
	#CSR_FE
 0x10

	)

63 
	#CSR_ERR
 0x08

	)

64 
	#CSR_RX_BYTE
 0x04

	)

65 
	#CSR_TX_BYTE
 0x02

	)

66 
	#CSR_ACTIVE
 0x01

	)

69 
	#UCR_FLUSH
 0x80

	)

70 
	#UCR_FLOW
 0x40

	)

71 
	#UCR_D9
 0x20

	)

72 
	#UCR_BIT9
 0x10

	)

73 
	#UCR_PARITY
 0x08

	)

74 
	#UCR_SPB
 0x04

	)

75 
	#UCR_STOP
 0x02

	)

76 
	#UCR_START
 0x01

	)

78 
	#P2DIR_PRIPO
 0xC0

	)

80 #unde‡
UxCSR


81 #unde‡
UxUCR


82 #unde‡
UxDBUF


83 #unde‡
UxBAUD


84 #unde‡
UxGCR


85 #i‡ (
HAL_UART_SBL
 == 1)

86 
	#UxCSR
 
U0CSR


	)

87 
	#UxUCR
 
U0UCR


	)

88 
	#UxDBUF
 
U0DBUF


	)

89 
	#UxBAUD
 
U0BAUD


	)

90 
	#UxGCR
 
U0GCR


	)

91 #ñi‡ (
HAL_UART_SBL
 == 2)

92 
	#UxCSR
 
U1CSR


	)

93 
	#UxUCR
 
U1UCR


	)

94 
	#UxDBUF
 
U1DBUF


	)

95 
	#UxBAUD
 
U1BAUD


	)

96 
	#UxGCR
 
U1GCR


	)

99 #unde‡
PxSEL


100 #unde‡
HAL_UART_PERCFG_BIT


101 #unde‡
HAL_UART_PRIPO


102 #unde‡
HAL_UART_Px_SEL


103 #i‡ (
HAL_UART_SBL
 == 1)

104 
	#PxSEL
 
P0SEL


	)

105 
	#HAL_UART_PERCFG_BIT
 0x01

106 
	#HAL_UART_PRIPO
 0x00

107 
	#HAL_UART_Px_SEL
 0x0C

108 #ñi‡ (
HAL_UART_SBL
 =2)

	)

109 
	#PxSEL
 
P1SEL


	)

110 
	#HAL_UART_PERCFG_BIT
 0x02

111 
	#HAL_UART_PRIPO
 0x40

112 
	#HAL_UART_Px_SEL
 0xC0

114 

	)

115 #i‡
deföed
 
POWER_SAVING


116 #unde‡
PxDIR


117 #i‡ (
HAL_UART_SBL
 == 1)

118 
	#PxDIR
 
P0DIR


	)

119 
	#DMA_RDYIn
 
P0_4


	)

120 
	#DMA_RDYOut
 
P0_5


	)

121 
	#DMA_RDYOut_BIT
 
	`BV
(5)

122 #ñi‡ (
HAL_UART_SBL
 =2)

	)

123 
	#PxDIR
 
P1DIR


	)

124 
	#DMA_RDYIn
 
P1_4


	)

125 
	#DMA_RDYOut
 
P1_5


	)

126 
	#DMA_RDYOut_BIT
 
	`BV
(5)

128 

	)

134 
	#HAL_UART_SBL_CLR_RDY_OUT
(Ë(
DMA_RDYOut
 = 1)

	)

135 
	#HAL_UART_SBL_SET_RDY_OUT
(Ë(
DMA_RDYOut
 = 0)

	)

137 
	#HAL_UART_SBL_RDY_IN
(Ë(
DMA_RDYIn
 =0)

	)

145 
uöt8
 
	gtxIdx
, 
	gtxLí
, *
	gpTxBuf
;

167 
	$u¨tInô
()

169 #i‡
deföed
 
POWER_SAVING


173 
	`HAL_UART_SBL_SET_RDY_OUT
();

174 
PxDIR
 |
DMA_RDYOut_BIT
;

177 
UxCSR
 = 
CSR_MODE
;

178 
UxUCR
 = 
UCR_FLUSH
;

179 #i‡(
HAL_UART_SBL
 == 1)

180 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

182 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

184 
PxSEL
 |
HAL_UART_Px_SEL
;

186 
P2DIR
 &~
P2DIR_PRIPO
;

187 
P2DIR
 |
HAL_UART_PRIPO
;

190 
UxBAUD
 = 216;

191 
UxGCR
 = 11;

193 
UxUCR
 = 
UCR_STOP
;

194 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

195 
	}
}

212 
	$sblRun
()

214 
uöt8
 
ª£tF
 = 0;

215 
	`u¨tInô
();

219 i‡(
txLí
 == 0)

221 i‡((
ª£tF
 !0Ë&& ((
UxCSR
 & 
CSR_ACTIVE
) == 0))

223 
	`HAL_SYSTEM_RESET
();

226 i‡(
UxCSR
 & 
CSR_TX_BYTE
)

228 
UxCSR
 &~
CSR_TX_BYTE
;

229 
UxDBUF
 = 
pTxBuf
[
txIdx
];

231 i‡(++
txIdx
 =
txLí
)

233 
txLí
 = 0;

236 #i‡
deföed
 
POWER_SAVING


237 i‡(!
	`HAL_UART_SBL_RDY_IN
())

240 
	`HAL_UART_SBL_CLR_RDY_OUT
();

241 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP;

242 
	`HAL_UART_SBL_SET_RDY_OUT
();

246 i‡(
UxCSR
 & 
CSR_RX_BYTE
)

248 
ª£tF
 |
	`sblPﬁl
();

251 
	}
}

268 
uöt8
 
	$sblWaô
()

270 
	`u¨tInô
();

272 
uöt32
 
dñay
 = 0; delay < 0x00100000; delay++)

274 i‡(
UxCSR
 & 
CSR_RX_BYTE
)

276 
uöt8
 
ch
 = 
UxDBUF
;

278 i‡(
ch
 =
SBL_FORCE_BOOT
)

280  
TRUE
;

282 i‡(
ch
 =
SBL_FORCE_RUN
)

284  
FALSE
;

289  
FALSE
;

290 
	}
}

293 
uöt16
 
	$HÆUARTRód
(
uöt8
 
p‹t
, uöt8 *
pBuf„r
, 
uöt16
 
Àngth
)

295 ()
p‹t
;

296 ()
Àngth
;

298 i‡(
UxCSR
 & 
CSR_RX_BYTE
)

300 *
pBuf„r
 = 
UxDBUF
;

305 
	}
}

307 
uöt16
 
	$HÆUARTWrôe
(
uöt8
 
p‹t
, uöt8 *
pBuf„r
, 
uöt16
 
Àngth
)

309 ()
p‹t
;

310 
pTxBuf
 = 
pBuf„r
;

311 
txLí
 = 
Àngth
;

312 
txIdx
 = 1;

313 
UxCSR
 &~
CSR_TX_BYTE
;

314 
UxDBUF
 = *
pBuf„r
;

316  
Àngth
;

317 
	}
}

	@Projects/ble/util/EBL/app/sbl_app.c

51 
	~"hÆ_Êash.h
"

52 
	~"hÆ_ty≥s.h
"

53 
	~"sbl_≠p.h
"

60 #¥agm®
loˇti⁄
="IMAGE_HEADER"

61 c⁄° 
__code
 
img_hdr_t
 
	g_imgHdr
 = {

64 
SBL_FULL_LEN
,

68 #¥agm®
ªquúed
=
_imgHdr


70 #¥agm®
loˇti⁄
="AES_HEADER"

71 c⁄° 
__code
 
´s_hdr_t
 
	g_´sHdr
 = {

76 #¥agm®
ªquúed
=
_´sHdr


93 
	$≠pF‹˚BoŸ
()

95 
uöt16
 
¸c
[2];

96 
	`SBL_NVM_GET
(
SBL_ADDR_CRC
, 
¸c
, (crc));

99 i‡((
¸c
[0] == 0xFFFF) || (crc[0] == 0x0000) ||

100 (
¸c
[1] == 0xFFFF) || (crc[1] == 0x0000) ||

101 (
¸c
[1] != crc[0]))

106 
	`HAL_DISABLE_INTERRUPTS
();

108 
¸c
[0] ^= 0xFFFF;

109 
¸c
[1] = 0xFFFF;

110 
	`SBL_NVM_SET
(
SBL_ADDR_CRC
, 
¸c
, (crc));

112 
	`HAL_SYSTEM_RESET
();

113 
	}
}

	@Projects/ble/util/EBL/app/sbl_app.h

46 #i‚de‡
SBL_APP_H


47 
	#SBL_APP_H


	)

54 
	~"hÆ_´s.h
"

55 
	~"hÆ_bﬂrd_cfg.h
"

56 
	~"hÆ_ty≥s.h
"

65 
	#SBL_PAGE_BEG
 1

66 
	#SBL_PAGE_END
 124

67 

	)

69 
	#SBL_PAGE_LEN
 (
uöt16
)(
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
)

	)

76 
	#SBL_ADDR_MIN
 (
SBL_PAGE_BEG
 * 
SBL_PAGE_LEN
)

	)

77 
	#SBL_ADDR_MAX
 (
SBL_PAGE_END
 * 
SBL_PAGE_LEN
 + SBL_PAGE_LEN)

	)

79 
	#SBL_ADDR_IMG_HDR
 
SBL_ADDR_MIN


	)

80 
	#SBL_ADDR_CRC
 
SBL_ADDR_IMG_HDR


	)

82 
	#SBL_ADDR_AES_HDR
 (
SBL_ADDR_IMG_HDR
 + (16 / 
HAL_FLASH_WORD_SIZE
))

	)

84 
	#SBL_ADDR_BEG
 
SBL_ADDR_MIN


	)

87 
	#SBL_ADDR_END
 (
imgHdr
.
Àn
 + \

88 (
SBL_ADDR_MIN
 - (
SBL_RW_BUF_LEN
 / 
HAL_FLASH_WORD_SIZE
)))

	)

90 
	#SBL_FULL_LEN
 (
SBL_ADDR_MAX
 - 
SBL_ADDR_MIN
)

	)

93 
	#SBL_NVM_GET
(
SBL_ADDR
, 
PBUF
, 
BYTE_CNT
) \

94 
	`HÆFœshRód
((
SBL_ADDR
Ë/ 
SBL_PAGE_LEN
, ((SBL_ADDR) % SBL_PAGE_LEN) << 2,\

95 (*)(
PBUF
), (
BYTE_CNT
))

	)

98 
	#SBL_NVM_SET
(
SBL_ADDR
, 
PBUF
, 
BYTE_CNT
) \

99 
	`HÆFœshWrôe
((
SBL_ADDR
), (*)(
PBUF
), ((
BYTE_CNT
Ë/ 
HAL_FLASH_WORD_SIZE
))

	)

101 
	#SBL_READ_IMG_HDR
(Ë
	`°
 ( \

102 
	`SBL_NVM_GET
(
SBL_ADDR_IMG_HDR
, &
imgHdr
, (
img_hdr_t
)); \

104 i‡((
imgHdr
.
Àn
 =0Ë|| (imgHdr.À¿> 
SBL_FULL_LEN
)) \

106 
imgHdr
.
Àn
 = 
SBL_FULL_LEN
; \

108 )

	)

117 
uöt16
 
	m¸c
[2];

119 
uöt16
 
	mvî
;

120 
uöt16
 
	mÀn
;

121 
uöt8
 
	muid
[4];

122 
uöt8
 
	mªs
[4];

123 } 
	timg_hdr_t
;

124 
°©ic_as£π
(((
img_hdr_t
) == 16), "Bad SBL_ADDR_AES_HDR definition.");

125 
°©ic_as£π
((((
img_hdr_t
Ë% 
KEY_BLENGTH
) == 0),

130 
uöt8
 
	msig«tuª
[
KEY_BLENGTH
];

131 
uöt8
 
	mn⁄˚12
[12];

132 
uöt8
 
	m•¨e
[4];

133 } 
	t´s_hdr_t
;

155 
≠pF‹˚BoŸ
();

	@Projects/ble/util/EBL/app/sbl_exec.c

45 
	~<°rög.h
>

47 
	~"hÆ_adc.h
"

48 
	~"hÆ_´s.h
"

49 
	~"hÆ_bﬂrd_cfg.h
"

50 
	~"hÆ_Êash.h
"

51 
	~"hÆ_Ωc.h
"

52 
	~"hÆ_ty≥s.h
"

53 
	~"hÆ_u¨t.h
"

54 
	~"sbl_≠p.h
"

55 
	~"sbl_exec.h
"

64 c⁄° 
uöt8
 
	g´sKey
[
KEY_BLENGTH
] = {

65 #i‡
deföed
 
AES_TEST_VECS


73 #i‡
deföed
 
AES_TEST_VECS


74 c⁄° 
uöt8
 
	gã°N⁄˚
[13] = {

79 
	#SBL_RW_BUF_LEN
 64

	)

82 
	#SBL_WRITE_CMD
 0x01

	)

83 
	#SBL_READ_CMD
 0x02

	)

84 
	#SBL_ENABLE_CMD
 0x03

	)

85 
	#SBL_HANDSHAKE_CMD
 0x04

	)

88 
	#SBL_TGT_BOOTLOAD
 0x10

89 

	)

90 
	#SBL_SIGNATURE_CMD
 0x20

	)

94 
	#SBL_RSP_MASK
 0x80

	)

97 
	#SBL_SUCCESS
 0

	)

98 
	#SBL_FAILURE
 1

	)

99 
	#SBL_INVALID_FCS
 2

	)

100 
	#SBL_INVALID_FILE
 3

	)

101 
	#SBL_FILESYSTEM_ERROR
 4

	)

102 
	#SBL_ALREADY_STARTED
 5

	)

103 
	#SBL_NO_RESPOSNE
 6

	)

104 
	#SBL_VALIDATE_FAILED
 7

	)

105 
	#SBL_CANCELED
 8

	)

106 
	#SBL_IGNORED
 9

	)

109 
	#SBL_REQ_ADDR_LSB
 
RPC_POS_DAT0


	)

110 
	#SBL_REQ_ADDR_MSB
 (
SBL_REQ_ADDR_LSB
+1)

	)

111 
	#SBL_REQ_DAT0
 (
SBL_REQ_ADDR_MSB
+1)

	)

112 
	#SBL_RSP_STATUS
 
RPC_POS_DAT0


	)

113 
	#SBL_RSP_ADDR_LSB
 (
SBL_RSP_STATUS
+1)

	)

114 
	#SBL_RSP_ADDR_MSB
 (
SBL_RSP_ADDR_LSB
+1)

	)

115 
	#SBL_RSP_DAT0
 (
SBL_RSP_ADDR_MSB
+1)

	)

116 
	#SBL_READ_HDR_LEN
 (
SBL_RSP_DAT0
 - 
SBL_RSP_STATUS
)

	)

118 #i‡!
deföed
 
SBL_UART_PORT


119 
	#SBL_UART_PORT
 
HAL_UART_PORT_0


	)

124 #i‡!
deföed
 
SBL_SECURE


125 
	#SBL_SECURE
 
TRUE


	)

131 #i‡!
deföed
 
SBL_SIGNER


132 
	#SBL_SIGNER
 
FALSE


	)

136 
	#SBL_BUF_SIZE
 256

	)

137 
	#SBL_MAX_SIZE
 (
SBL_BUF_SIZE
 - 
RPC_FRAME_HDR_SZ
 - 
RPC_UART_FRAME_OVHD
)

	)

146 
	mΩcSãSOF
,

147 
	mΩcSãLí
,

148 
	mΩcSãD©a
,

149 
	mΩcSãFcs


150 } 
	tΩcSã_t
;

157 
uöt8
 
	gΩcBuf
[
SBL_BUF_SIZE
], 
	gsbFcs
, 
	gsbIdx
, 
	gsbLí
;

158 
uöt8
 *c⁄° 
	gsbBuf
 = 
ΩcBuf
+1;

159 
ΩcSã_t
 
	gΩcSã
;

162 
__no_öô
 
img_hdr_t
 
	gimgHdr
;

164 
__no_öô
 
uöt8
 
	g∑geBuf
[
HAL_FLASH_PAGE_SIZE
];

167 
boﬁ
 
	gsignMode
;

169 #i‡
deföed
 
AES_TEST_VECS


170 
uöt8
 
	gã°Sig
[
KEY_BLENGTH
];

178 
sblProc
();

179 
uöt8
 
sblRe•
();

181 
´sLﬂdKey
();

182 
´sInôSig
();

183 
´sCry±
(
uöt8
 
skùC¡
, uöt8 *
pBuf
);

184 
uöt8
 
´sSig«tuª
(*
pBuf
);

186 
uöt8
 
imgHdrCheck
(*
pBuf
);

187 
uöt8
 
checkRC
();

188 
uöt8
 
¥ocSig«tuªCmd
(*
pBuf
);

205 
uöt8
 
	$sblInô
()

207 
	`´sLﬂdKey
();

209 #i‡
deföed
 
AES_TEST_VECS


210 
uöt8
 
checkSig
[
KEY_BLENGTH
] = {

213 
imgHdr
.
Àn
 = 1;

217 
	`´sSig«tuª
(
ã°Sig
);

219 i‡(
	`memcmp
(
ã°Sig
, 
checkSig
, 
KEY_BLENGTH
))

221 
ASM_NOP
;

225 
	`SBL_READ_IMG_HDR
();

227  
	`checkRC
();

229 
	}
}

246 
uöt8
 
	$sblPﬁl
()

248 
uöt8
 
ch
;

250 
	`HÆUARTRód
(0, &
ch
, 1))

252 
ΩcSã
)

254 
ΩcSãSOF
:

255 i‡(
RPC_UART_SOF
 =
ch
)

257 
ΩcSã
 = 
ΩcSãLí
;

261 
ΩcSãLí
:

262 i‡(
ch
 > 
SBL_MAX_SIZE
)

264 
ΩcSã
 = 
ΩcSãSOF
;

269 
ΩcSã
 = 
ΩcSãD©a
;

270 
sbFcs
 = 
sbIdx
 = 0;

271 
sbLí
 = 
ch
 + 3;

275 
ΩcSãD©a
:

276 
sbFcs
 ^
ch
;

277 
sbBuf
[
sbIdx
] = 
ch
;

279 i‡(++
sbIdx
 =
sbLí
)

281 
ΩcSã
 = 
ΩcSãFcs
;

285 
ΩcSãFcs
:

286 
ΩcSã
 = 
ΩcSãSOF
;

288 i‡((
sbFcs
 =
ch
Ë&& ((
sbBuf
[
RPC_POS_CMD0
] & 
RPC_SUBSYSTEM_MASK
Ë=
RPC_SYS_BOOT
))

290 
	`sblProc
();

291  
	`sblRe•
();

296 
	`HAL_SYSTEM_RESET
();

301  
FALSE
;

302 
	}
}

319 
	$sblProc
()

321 
uöt16
 
t16
 = 
	`BUILD_UINT16
(
sbBuf
[
SBL_REQ_ADDR_LSB
], sbBuf[
SBL_REQ_ADDR_MSB
]Ë+ 
SBL_ADDR_BEG
;

322 
uöt8
 
Àn
 = 1, 
r•
 = 
SBL_SUCCESS
;

324 
sbBuf
[
RPC_POS_CMD1
])

326 
SBL_WRITE_CMD
:

327 i‡((
t16
 >
SBL_ADDR_BEG
Ë&& (t16 <
SBL_ADDR_END
))

329 i‡((
t16
 % 
SBL_PAGE_LEN
) == 0)

331 
	`HÆFœshEø£
(
t16
 / 
SBL_PAGE_LEN
);

334 i‡(
SBL_SECURE
)

336 i‡(
t16
 =
SBL_ADDR_IMG_HDR
)

338 i‡(!
	`imgHdrCheck
(
sbBuf
 + 
SBL_REQ_DAT0
))

340 
r•
 = 
SBL_FAILURE
;

344 
	`´sCry±
(1, 
sbBuf
 + 
SBL_REQ_DAT0
);

348 
	`´sCry±
(0, 
sbBuf
 + 
SBL_REQ_DAT0
);

352 
	`SBL_NVM_SET
(
t16
, (
sbBuf
 + 
SBL_REQ_DAT0
), 
SBL_RW_BUF_LEN
);

355 i‡(
t16
 =
SBL_ADDR_IMG_HDR
)

357 
	`SBL_READ_IMG_HDR
();

362 
r•
 = 
SBL_FAILURE
;

366 
SBL_READ_CMD
:

367 i‡((
t16
 >
SBL_ADDR_BEG
Ë&& (t16 <
SBL_ADDR_END
))

369 
Àn
 = 
SBL_RW_BUF_LEN
 + 
SBL_READ_HDR_LEN
;

370 
sbBuf
[
SBL_RSP_ADDR_MSB
] = sbBuf[
SBL_REQ_ADDR_MSB
];

371 
sbBuf
[
SBL_RSP_ADDR_LSB
] = sbBuf[
SBL_REQ_ADDR_LSB
];

373 
	`SBL_NVM_GET
(
t16
, (
sbBuf
 + 
SBL_RSP_DAT0
), 
SBL_RW_BUF_LEN
);

375 i‡(
SBL_SECURE
 || (
SBL_SIGNER
 && 
signMode
))

377 i‡(
t16
 =
SBL_ADDR_IMG_HDR
)

379 
	`´sCry±
(1, 
sbBuf
 + 
SBL_RSP_DAT0
);

383 
	`´sCry±
(0, 
sbBuf
 + 
SBL_RSP_DAT0
);

389 
r•
 = 
SBL_FAILURE
;

393 
SBL_ENABLE_CMD
:

394 i‡(
SBL_SIGNER
)

396 
signMode
 = 
FALSE
;

398 i‡(!
SBL_SECURE
)

400 
imgHdr
.
¸c
[1] = imgHdr.crc[0];

401 
imgHdr
.
¸c
[0] = 0xFFFF;

402 
	`SBL_NVM_SET
(
SBL_ADDR_CRC
, 
imgHdr
.
¸c
, (imgHdr.crc));

403 
	`SBL_READ_IMG_HDR
();

405 i‡(!
	`checkRC
())

407 
r•
 = 
SBL_VALIDATE_FAILED
;

411 
SBL_HANDSHAKE_CMD
:

414 
SBL_SIGNATURE_CMD
:

415 
Àn
 = ((
r•
 = 
	`¥ocSig«tuªCmd
((
sbBuf
 + 
RPC_POS_DAT0
 + 1))Ë=
SBL_SUCCESS
) ? 17 : 1;

419 
r•
 = 
SBL_FAILURE
;

423 
sbBuf
[
RPC_POS_LEN
] = 
Àn
;

424 
sbBuf
[
RPC_POS_CMD1
] |
SBL_RSP_MASK
;

425 
sbBuf
[
RPC_POS_DAT0
] = 
r•
;

426 
	}
}

443 
uöt8
 
	$sblRe•
()

445 
uöt8
 
fcs
 = 0, 
Àn
 = 
sbBuf
[
RPC_POS_LEN
] + 
RPC_FRAME_HDR_SZ
;

446 
uöt8
 
π∫
 = 
FALSE
;

448 
uöt8
 
idx
 = 
RPC_POS_LEN
; idx < 
Àn
; idx++)

450 
fcs
 ^
sbBuf
[
idx
];

452 
sbBuf
[
Àn
] = 
fcs
;

454 i‡((
sbBuf
[
RPC_POS_CMD1
] =(
SBL_ENABLE_CMD
 | 
SBL_RSP_MASK
)) &&

455 (
sbBuf
[
RPC_POS_DAT0
] =
SBL_SUCCESS
))

457 
Àn
++;

458 
π∫
 = 
TRUE
;

461 
ΩcBuf
[0] = 
RPC_UART_SOF
;

462 ()
	`HÆUARTWrôe
(0, 
ΩcBuf
, 
Àn
 + 
RPC_UART_FRAME_OVHD
);

464  
π∫
;

465 
	}
}

482 
	$´sLﬂdKey
()

485 
uöt8
 *
keyPå
 = (uöt8 *)
´sKey
;

487 
ENCCS
 = 
ECB
 | 
AES_LOAD_KEY
 | 0x01;

491 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

493 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

495 
ENCDI
 = *
keyPå
++;

497 
	}
}

514 
	$´sInôSig
()

516 
ENCCS
 = 
CBC_MAC
 | 
AES_LOAD_IV
 | 0x01;

520 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

522 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

524 
ENCDI
 = 0;

527 
ENCCS
 = 
CBC_MAC
 | 
AES_ENCRYPT
 | 0x01;

531 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

533 #i‡
deföed
 
AES_TEST_VECS


534 
ENCDI
 = 0x59;

536 
uöt8
 
idx
 = 0; idx < 13; idx++)

538 
ENCDI
 = 
ã°N⁄˚
[
idx
];

541 
´s_hdr_t
 
´sHdr
;

542 
	`SBL_NVM_GET
(
SBL_ADDR_AES_HDR
, &
´sHdr
, (
´s_hdr_t
));

544 
ENCDI
 = 0x3A;

546 
uöt8
 
idx
 = 0; idx < 12; idx++)

548 
ENCDI
 = 
´sHdr
.
n⁄˚12
[
idx
];

552 #i‡
deföed
 
AES_TEST_VECS


553 
ENCDI
 = 0x00;

554 
ENCDI
 = 0x17;

557 
uöt32
 
imageLí
 = (uöt32)
HAL_FLASH_WORD_SIZE
 * 
imgHdr
.
Àn
 - 
KEY_BLENGTH
;

558 
ENCDI
 = ((
uöt8
 *)&
imageLí
)[2];

559 
ENCDI
 = ((
uöt8
 *)&
imageLí
)[1];

560 
ENCDI
 = ((
uöt8
 *)&
imageLí
)[0];

563 (
ENCCS
 & 
	`BV
(3)) == 0);

564 
	}
}

582 
	$´sCry±
(
uöt8
 
skùC¡
, uöt8 *
pBuf
)

585 
uöt8
 
ivN⁄˚
[
KEY_BLENGTH
] = { 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 };

587 
ENCCS
 = 
CTR
 | 
AES_LOAD_IV
 | 0x01;

591 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

593 
uöt8
 
idx
 = 0; idx < 
KEY_BLENGTH
; idx++)

595 
ENCDI
 = 
ivN⁄˚
[
idx
];

597 (
ENCCS
 & 
	`BV
(3)) == 0);

599 
uöt8
 
˙t
 = 0; c¡ < (
SBL_RW_BUF_LEN
 / 
KEY_BLENGTH
); cnt++)

601 i‡(
skùC¡
 == 0)

603 
ENCCS
 = 
CTR
 | 
AES_ENCRYPT
 | 0x01;

607 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

609 
uöt8
 
blk
 = 0; blk < 4; blk++)

611 
uöt8
 
idx
 = 0; idx < 4; idx++)

613 
ENCDI
 = 
pBuf
[
idx
];

616 
	`HAL_AES_DELAY
();

618 
uöt8
 
idx
 = 0; idx < 4; idx++)

620 
pBuf
[
idx
] = 
ENCDO
;

623 
pBuf
 += 4;

628 
skùC¡
--;

629 
pBuf
 +
KEY_BLENGTH
;

632 
	}
}

650 
uöt8
 
	$´sSig«tuª
(*
pBuf
)

652 
	`´sInôSig
();

654 #i‡
deföed
 
AES_TEST_VECS


655 
uöt8
 
ã°I≈ut
[48] = {

660 
	`mem˝y
(
∑geBuf
+
HAL_FLASH_PAGE_SIZE
-48, 
ã°I≈ut
, 48);

662 
uöt8
 
idx
 = 0;

663 
uöt8
 
lo›
 = 0;Üoop < 2;Üoop++)

665 
ENCCS
 |= 0x01;

666 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

668 
ENCDI
 = 
ã°I≈ut
[
idx
++];

670 (
ENCCS
 & 
	`BV
(3)) == 0);

673 c⁄° 
uöt8
 
œ°Pg
 = 
imgHdr
.
Àn
 / 
SBL_PAGE_LEN
 + 
SBL_PAGE_BEG
 - 1;

675 
uöt8
 
pg
 = 
SBL_PAGE_BEG
;Ög <
œ°Pg
;Ög++)

677 
	`HÆFœshRód
(
pg
, 0, 
∑geBuf
, 
HAL_FLASH_PAGE_SIZE
);

679 
uöt16
 
o£t
 = 0; o£à< 
HAL_FLASH_PAGE_SIZE
; )

681 i‡((
pg
 =
SBL_PAGE_BEG
Ë&& (
o£t
 =(
img_hdr_t
)))

683 
o£t
 +
KEY_BLENGTH
;

685 i‡((
pg
 =
œ°Pg
Ë&& (
o£t
 =(
HAL_FLASH_PAGE_SIZE
 - 
KEY_BLENGTH
)))

690 
ENCCS
 |= 0x01;

691 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

693 
ENCDI
 = 
∑geBuf
[
o£t
++];

695 (
ENCCS
 & 
	`BV
(3)) == 0);

700 
ENCCS
 = 
CBC
 | 
AES_ENCRYPT
 | 0x01;

704 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

706 
uöt16
 
o£t
 = (
HAL_FLASH_PAGE_SIZE
 - 
KEY_BLENGTH
); oset < HAL_FLASH_PAGE_SIZE; oset++)

708 
ENCDI
 = 
∑geBuf
[
o£t
];

710 
	`HAL_AES_DELAY
();

713 
uöt8
 
˙t
 = 0, *
pSig
 = (uöt8 *)
pBuf
; c¡ < 
KEY_BLENGTH
; cnt++)

715 *
pSig
++ = 
ENCDO
;

718  
TRUE
;

719 
	}
}

736 
uöt8
 
	$imgHdrCheck
(*
pBuf
)

738 
uöt8
 
sigBuf
[
KEY_BLENGTH
] =

740 c⁄° 
img_hdr_t
 *
pHdr
 = (c⁄° img_hdr_à*)
pBuf
;

741 c⁄° 
uöt8
 *
pSig
 = (c⁄° uöt8 *)((uöt8 *)
pBuf
 + (
img_hdr_t
));

743 i‡(!
	`memcmp
(
pSig
, 
sigBuf
, (sigBuf))

744 || (
pHdr
->
¸c
[0] == 0)

745 || (
pHdr
->
¸c
[0] == 0xFFFF)

746 || (
pHdr
->
¸c
[1] != 0xFFFF)

747 || (
pHdr
->
Àn
 == 0)

748 || (
pHdr
->
Àn
 > 
SBL_FULL_LEN
))

750  
FALSE
;

753  
TRUE
;

754 
	}
}

771 
uöt8
 
	$checkRC
()

773 i‡((
imgHdr
.
¸c
[0] == 0) || (imgHdr.crc[0] == 0xFFFF))

775  
FALSE
;

778 i‡(
SBL_SECURE
 && (
imgHdr
.
¸c
[0] != imgHdr.crc[1]) && (imgHdr.crc[1] == 0xFFFF))

780 
uöt8
 
pBuf
[
KEY_BLENGTH
];

782 i‡(
	`´sSig«tuª
(
pBuf
))

784 
uöt8
 
sBuf
[
KEY_BLENGTH
];

785 
	`SBL_NVM_GET
(
SBL_ADDR_AES_HDR
, 
sBuf
, 
KEY_BLENGTH
);

787 i‡(!
	`memcmp
(
sBuf
, 
pBuf
, 
KEY_BLENGTH
))

789 
	`mem£t
(
pBuf
, 0x00, 
KEY_BLENGTH
);

790 
	`mem£t
(
sBuf
, 0x00, 
KEY_BLENGTH
);

791 
imgHdr
.
¸c
[1] = imgHdr.crc[0];

792 
imgHdr
.
¸c
[0] = 0xFFFF;

793 !
	`HÆAdcCheckVdd
(
VDD_MIN_NV
));

794 
	`SBL_NVM_SET
(
SBL_ADDR_CRC
, 
imgHdr
.
¸c
, (imgHdr.crc));

795 
	`SBL_READ_IMG_HDR
();

797 
	`mem£t
(
sBuf
, 0x00, 
KEY_BLENGTH
);

799 
	`mem£t
(
pBuf
, 0x00, 
KEY_BLENGTH
);

802  (
imgHdr
.
¸c
[0] == imgHdr.crc[1]);

803 
	}
}

822 
uöt8
 
	$¥ocSig«tuªCmd
(*
pBuf
)

824 
uöt8
 
sBuf
[
KEY_BLENGTH
];

826 i‡(!
SBL_SIGNER
 || !
	`´sSig«tuª
(
pBuf
))

828  
SBL_FAILURE
;

831 
	`SBL_NVM_GET
(
SBL_ADDR_AES_HDR
, 
sBuf
, 
KEY_BLENGTH
);

832 i‡(
	`memcmp
(
sBuf
, 
pBuf
, 
KEY_BLENGTH
))

834 
	`SBL_NVM_SET
(
SBL_ADDR_AES_HDR
, 
pBuf
, 
KEY_BLENGTH
);

835 
	`SBL_NVM_GET
(
SBL_ADDR_AES_HDR
, 
sBuf
, 
KEY_BLENGTH
);

838 
signMode
 = 
TRUE
;

840  ((
	`memcmp
(
sBuf
, 
pBuf
, 
KEY_BLENGTH
Ë=0Ë? 
SBL_SUCCESS
 : 
SBL_FAILURE
);

841 
	}
}

	@Projects/ble/util/EBL/app/sbl_exec.h

41 #i‚de‡
SBL_EXEC_H


42 
	#SBL_EXEC_H


	)

49 
	~"hÆ_ty≥s.h
"

56 
	#SBL_FORCE_BOOT
 0xF8

	)

57 
	#SBL_FORCE_RUN
 (
SBL_FORCE_BOOT
 ^ 0xFF)

	)

79 
uöt8
 
sblInô
();

96 
uöt8
 
sblPﬁl
();

	@Projects/ble/util/EBL/app/sbl_main.c

47 
	~"hÆ_adc.h
"

48 
	~"hÆ_as£π.h
"

49 
	~"hÆ_dma.h
"

50 
	~"hÆ_¶ìp.h
"

51 
	~"hÆ_ty≥s.h
"

52 
	~"sbl_exec.h
"

59 
hÆDMADesc_t
 
	gdmaCh0
;

66 #i‡
HAL_UART_SPI


67 
	~"_sbl_•i.c
"

68 #ñi‡
HAL_UART_SBL


69 
	~"_sbl_u¨t.c
"

71 #îr‹ 
No
 
vÆid
 
å™•‹t
 
c⁄figuªd
.

90 
	$maö
()

92 
	`HAL_BOARD_INIT
();

95 
MEMCTR
 = (MEMCTR & 0xF8) | 0x07;

100 
	`HAL_DMA_SET_ADDR_DESC0
(&
dmaCh0
);

102 i‡(
	`sblInô
(Ë=
TRUE
)

109 
	`asm
("LJMP 0x0830");

110 
	`HAL_SYSTEM_RESET
();

114 !
	`HÆAdcCheckVdd
(
VDD_MIN_NV
));

115 
	`sblRun
();

116 
	`HAL_SYSTEM_RESET
();

117 
	}
}

138 #¥agm®
›timize
=
n⁄e


139 
	$hÆSÀïWaô
(
uöt16
 
duøti⁄
)

141 
duøti⁄
 >>= 1;

143 
duøti⁄
-- > 0)

145 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

146 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

147 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

149 
	}
}

151 
	$hÆAs£πH™dÀr
()

153 
	`HAL_SYSTEM_RESET
();

154 
	}
}

	@Projects/ble/util/SBL/app/cc254x/_sbl_spi.c

47 
	~"hÆ_dma.h
"

48 
	~"hÆ_ty≥s.h
"

49 
	~"hÆ_u¨t.h
"

50 
	~"sbl_exec.h
"

57 
hÆDMADesc_t
 
	gdmaCh1234
[4];

64 
uöt8
 
	gsblRe£t
;

71 
	~"_hÆ_u¨t_•i.c
"

89 
	$sblRxCB
(
uöt8
 
p‹t
, uöt8 
evít
)

91 ()
p‹t
;

92 ()
evít
;

94 
sblRe£t
 |
	`sblPﬁl
();

95 
	}
}

112 
	$sblRun
()

114 
hÆUARTCfg_t
 
u¨tC⁄fig
;

115 
u¨tC⁄fig
.
ˇŒBackFunc
 = 
sblRxCB
;

117 
	`HAL_DMA_SET_ADDR_DESC1234
(
dmaCh1234
);

119 
	`HÆUARTInôSPI
();

120 
	`HÆUARTO≥nSPI
(&
u¨tC⁄fig
);

124 i‡(
PxIFG
 & 
SPI_RDYIn_BIT
)

126 
	`•iRdyIn
();

129 
	`HÆUARTPﬁlSPI
();

131 i‡(
	`HAL_DMA_CHECK_IRQ
(
HAL_SPI_CH_TX
))

133 
	`HAL_DMA_CLEAR_IRQ
(
HAL_SPI_CH_TX
);

134 
	`HÆUART_DMAI§SPI
();

136 i‡(
sblRe£t
)

138 
	`HAL_SYSTEM_RESET
();

142 
	}
}

159 
uöt8
 
	$sblWaô
()

161  
FALSE
;

162 
	}
}

165 
uöt16
 
	$HÆUARTRód
(
uöt8
 
p‹t
, uöt8 *
pBuf„r
, 
uöt16
 
Àngth
)

167 ()
p‹t
;

169  
	`HÆUARTRódSPI
(
pBuf„r
, 
Àngth
);

170 
	}
}

172 
uöt16
 
	$HÆUARTWrôe
(
uöt8
 
p‹t
, uöt8 *
pBuf„r
, 
uöt16
 
Àngth
)

174 ()
p‹t
;

176  
	`HÆUARTWrôeSPI
(
pBuf„r
, 
Àngth
);

177 
	}
}

	@Projects/ble/util/SBL/app/cc254x/_sbl_uart.c

47 
	~"hÆ_bﬂrd.h
"

48 
	~"hÆ_mcu.h
"

49 
	~"hÆ_Ωc.h
"

50 
	~"hÆ_ty≥s.h
"

51 
	~"hÆ_u¨t.h
"

59 
	#CSR_MODE
 0x80

	)

60 
	#CSR_RE
 0x40

	)

61 
	#CSR_SLAVE
 0x20

	)

62 
	#CSR_FE
 0x10

	)

63 
	#CSR_ERR
 0x08

	)

64 
	#CSR_RX_BYTE
 0x04

	)

65 
	#CSR_TX_BYTE
 0x02

	)

66 
	#CSR_ACTIVE
 0x01

	)

69 
	#UCR_FLUSH
 0x80

	)

70 
	#UCR_FLOW
 0x40

	)

71 
	#UCR_D9
 0x20

	)

72 
	#UCR_BIT9
 0x10

	)

73 
	#UCR_PARITY
 0x08

	)

74 
	#UCR_SPB
 0x04

	)

75 
	#UCR_STOP
 0x02

	)

76 
	#UCR_START
 0x01

	)

78 
	#P2DIR_PRIPO
 0xC0

	)

80 #unde‡
UxCSR


81 #unde‡
UxUCR


82 #unde‡
UxDBUF


83 #unde‡
UxBAUD


84 #unde‡
UxGCR


85 #i‡ (
HAL_UART_SBL
 == 1)

86 
	#UxCSR
 
U0CSR


	)

87 
	#UxUCR
 
U0UCR


	)

88 
	#UxDBUF
 
U0DBUF


	)

89 
	#UxBAUD
 
U0BAUD


	)

90 
	#UxGCR
 
U0GCR


	)

91 #ñi‡ (
HAL_UART_SBL
 == 2)

92 
	#UxCSR
 
U1CSR


	)

93 
	#UxUCR
 
U1UCR


	)

94 
	#UxDBUF
 
U1DBUF


	)

95 
	#UxBAUD
 
U1BAUD


	)

96 
	#UxGCR
 
U1GCR


	)

99 #unde‡
PxSEL


100 #unde‡
HAL_UART_PERCFG_BIT


101 #unde‡
HAL_UART_PRIPO


102 #unde‡
HAL_UART_Px_SEL


103 #i‡ (
HAL_UART_SBL
 == 1)

104 
	#PxSEL
 
P0SEL


	)

105 
	#HAL_UART_PERCFG_BIT
 0x01

106 
	#HAL_UART_PRIPO
 0x00

107 
	#HAL_UART_Px_SEL
 0x0C

108 #ñi‡ (
HAL_UART_SBL
 =2)

	)

109 
	#PxSEL
 
P1SEL


	)

110 
	#HAL_UART_PERCFG_BIT
 0x02

111 
	#HAL_UART_PRIPO
 0x40

112 
	#HAL_UART_Px_SEL
 0xC0

114 

	)

115 #i‡
deföed
 
POWER_SAVING


116 #unde‡
PxDIR


117 #i‡ (
HAL_UART_SBL
 == 1)

118 
	#PxDIR
 
P0DIR


	)

119 
	#DMA_RDYIn
 
P0_4


	)

120 
	#DMA_RDYOut
 
P0_5


	)

121 
	#DMA_RDYOut_BIT
 
	`BV
(5)

122 #ñi‡ (
HAL_UART_SBL
 =2)

	)

123 
	#PxDIR
 
P1DIR


	)

124 
	#DMA_RDYIn
 
P1_4


	)

125 
	#DMA_RDYOut
 
P1_5


	)

126 
	#DMA_RDYOut_BIT
 
	`BV
(5)

128 

	)

134 
	#HAL_UART_SBL_CLR_RDY_OUT
(Ë(
DMA_RDYOut
 = 1)

	)

135 
	#HAL_UART_SBL_SET_RDY_OUT
(Ë(
DMA_RDYOut
 = 0)

	)

137 
	#HAL_UART_SBL_RDY_IN
(Ë(
DMA_RDYIn
 =0)

	)

145 
uöt8
 
	gtxIdx
, 
	gtxLí
, *
	gpTxBuf
;

167 
	$u¨tInô
()

169 #i‡
deföed
 
POWER_SAVING


173 
	`HAL_UART_SBL_SET_RDY_OUT
();

174 
PxDIR
 |
DMA_RDYOut_BIT
;

177 
UxCSR
 = 
CSR_MODE
;

178 
UxUCR
 = 
UCR_FLUSH
;

179 #i‡(
HAL_UART_SBL
 == 1)

180 
PERCFG
 &~
HAL_UART_PERCFG_BIT
;

182 
PERCFG
 |
HAL_UART_PERCFG_BIT
;

184 
PxSEL
 |
HAL_UART_Px_SEL
;

186 
P2DIR
 &~
P2DIR_PRIPO
;

187 
P2DIR
 |
HAL_UART_PRIPO
;

190 
UxBAUD
 = 216;

191 
UxGCR
 = 11;

193 
UxUCR
 = 
UCR_STOP
;

194 
UxCSR
 = (
CSR_MODE
 | 
CSR_RE
);

195 
	}
}

212 
	$sblRun
()

214 
uöt8
 
ª£tF
 = 0;

215 
	`u¨tInô
();

219 i‡(
txLí
 == 0)

221 i‡((
ª£tF
 !0Ë&& ((
UxCSR
 & 
CSR_ACTIVE
) == 0))

223 
	`HAL_SYSTEM_RESET
();

226 i‡(
UxCSR
 & 
CSR_TX_BYTE
)

228 
UxCSR
 &~
CSR_TX_BYTE
;

229 
UxDBUF
 = 
pTxBuf
[
txIdx
];

231 i‡(++
txIdx
 =
txLí
)

233 
txLí
 = 0;

236 #i‡
deföed
 
POWER_SAVING


237 i‡(!
	`HAL_UART_SBL_RDY_IN
())

240 
	`HAL_UART_SBL_CLR_RDY_OUT
();

241 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP;

242 
	`HAL_UART_SBL_SET_RDY_OUT
();

246 i‡(
UxCSR
 & 
CSR_RX_BYTE
)

248 
ª£tF
 |
	`sblPﬁl
();

251 
	}
}

268 
uöt8
 
	$sblWaô
()

270 
	`u¨tInô
();

272 
uöt32
 
dñay
 = 0; delay < 0x00100000; delay++)

274 i‡(
UxCSR
 & 
CSR_RX_BYTE
)

276 
uöt8
 
ch
 = 
UxDBUF
;

278 i‡(
ch
 =
SBL_FORCE_BOOT
)

280  
TRUE
;

282 i‡(
ch
 =
SBL_FORCE_RUN
)

284  
FALSE
;

289  
FALSE
;

290 
	}
}

293 
uöt16
 
	$HÆUARTRód
(
uöt8
 
p‹t
, uöt8 *
pBuf„r
, 
uöt16
 
Àngth
)

295 ()
p‹t
;

296 ()
Àngth
;

298 i‡(
UxCSR
 & 
CSR_RX_BYTE
)

300 *
pBuf„r
 = 
UxDBUF
;

305 
	}
}

307 
uöt16
 
	$HÆUARTWrôe
(
uöt8
 
p‹t
, uöt8 *
pBuf„r
, 
uöt16
 
Àngth
)

309 ()
p‹t
;

310 
pTxBuf
 = 
pBuf„r
;

311 
txLí
 = 
Àngth
;

312 
txIdx
 = 1;

313 
UxCSR
 &~
CSR_TX_BYTE
;

314 
UxDBUF
 = *
pBuf„r
;

316  
Àngth
;

317 
	}
}

	@Projects/ble/util/SBL/app/sbl_app.c

51 
	~"hÆ_Êash.h
"

52 
	~"hÆ_ty≥s.h
"

53 
	~"sbl_≠p.h
"

61 
	#SBL_CRC_PAGE
 (
HAL_SBL_IMG_CRC
 * 
HAL_FLASH_WORD_SIZE
 / 
HAL_FLASH_PAGE_SIZE
)

	)

62 
	#SBL_CRC_OFFSET
 (
HAL_SBL_IMG_CRC
 * 
HAL_FLASH_WORD_SIZE
 % 
HAL_FLASH_PAGE_SIZE
)

	)

79 
	$≠pF‹˚BoŸ
()

81 
uöt16
 
¸c
[2];

84 
	`HÆFœshRód
(
SBL_CRC_PAGE
, 
SBL_CRC_OFFSET
, (
uöt8
 *)
¸c
, 4);

86 i‡((
¸c
[0] == 0xFFFF) || (crc[0] == 0x0000) ||

87 (
¸c
[1] == 0xFFFF) || (crc[1] == 0x0000) ||

88 (
¸c
[1] != crc[0]))

93 
	`HAL_DISABLE_INTERRUPTS
();

95 
¸c
[0] ^= 0xFFFF;

96 
¸c
[1] = 0xFFFF;

97 
	`HÆFœshWrôe
(
HAL_SBL_IMG_CRC
, (
uöt8
 *)
¸c
, 1);

99 
	`HAL_SYSTEM_RESET
();

100 
	}
}

	@Projects/ble/util/SBL/app/sbl_app.h

46 #i‚de‡
SBL_APP_H


47 
	#SBL_APP_H


	)

54 
	~"hÆ_ty≥s.h
"

61 
	#HAL_SBL_IMG_BEG
 (
uöt16
)(0x800 / 
HAL_FLASH_WORD_SIZE
)

	)

62 
	#HAL_SBL_IMG_CRC
 (
uöt16
)(0x890 / 
HAL_FLASH_WORD_SIZE
)

	)

63 
	#HAL_SBL_IMG_END
 (
uöt16
)((
uöt32
)
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
 * 
HAL_NV_PAGE_BEG
)

	)

85 
≠pF‹˚BoŸ
();

	@Projects/ble/util/SBL/app/sbl_exec.c

45 
	~"hÆ_adc.h
"

46 
	~"hÆ_bﬂrd_cfg.h
"

47 
	~"hÆ_Êash.h
"

48 
	~"hÆ_Ωc.h
"

49 
	~"hÆ_ty≥s.h
"

50 
	~"hÆ_u¨t.h
"

51 
	~"sbl_≠p.h
"

52 
	~"sbl_exec.h
"

59 
	#SBL_RW_BUF_LEN
 64

	)

62 
	#SBL_WRITE_CMD
 0x01

	)

63 
	#SBL_READ_CMD
 0x02

	)

64 
	#SBL_ENABLE_CMD
 0x03

	)

65 
	#SBL_HANDSHAKE_CMD
 0x04

	)

68 
	#SBL_TGT_BOOTLOAD
 0x10

69 

	)

72 
	#SBL_RSP_MASK
 0x80

	)

75 
	#SBL_SUCCESS
 0

	)

76 
	#SBL_FAILURE
 1

	)

77 
	#SBL_INVALID_FCS
 2

	)

78 
	#SBL_INVALID_FILE
 3

	)

79 
	#SBL_FILESYSTEM_ERROR
 4

	)

80 
	#SBL_ALREADY_STARTED
 5

	)

81 
	#SBL_NO_RESPOSNE
 6

	)

82 
	#SBL_VALIDATE_FAILED
 7

	)

83 
	#SBL_CANCELED
 8

	)

84 
	#SBL_IGNORED
 9

	)

87 
	#SBL_REQ_ADDR_LSB
 
RPC_POS_DAT0


	)

88 
	#SBL_REQ_ADDR_MSB
 (
SBL_REQ_ADDR_LSB
+1)

	)

89 
	#SBL_REQ_DAT0
 (
SBL_REQ_ADDR_MSB
+1)

	)

90 
	#SBL_RSP_STATUS
 
RPC_POS_DAT0


	)

91 
	#SBL_RSP_ADDR_LSB
 (
SBL_RSP_STATUS
+1)

	)

92 
	#SBL_RSP_ADDR_MSB
 (
SBL_RSP_ADDR_LSB
+1)

	)

93 
	#SBL_RSP_DAT0
 (
SBL_RSP_ADDR_MSB
+1)

	)

94 
	#SBL_READ_HDR_LEN
 (
SBL_RSP_DAT0
 - 
SBL_RSP_STATUS
)

	)

96 #i‡!
deföed
 
SBL_UART_PORT


97 
	#SBL_UART_PORT
 
HAL_UART_PORT_0


	)

101 #i‡!
deföed
 
SBL_CALC_CRC


102 
	#SBL_CALC_CRC
 
FALSE


	)

106 
	#SBL_BUF_SIZE
 256

	)

107 
	#SBL_MAX_SIZE
 (
SBL_BUF_SIZE
 - 
RPC_FRAME_HDR_SZ
 - 
RPC_UART_FRAME_OVHD
)

	)

111 
	#SBL_PAGE_SIZE
 (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
)

	)

120 
	mΩcSãSOF
,

121 
	mΩcSãLí
,

122 
	mΩcSãD©a
,

123 
	mΩcSãFcs


124 } 
	tΩcSã_t
;

131 
uöt8
 
	gΩcBuf
[
SBL_BUF_SIZE
], 
	gsbFcs
, 
	gsbIdx
, 
	gsbLí
;

132 
uöt8
 *c⁄° 
	gsbBuf
 = 
ΩcBuf
+1;

133 
ΩcSã_t
 
	gΩcSã
;

140 
sblProc
();

141 
uöt8
 
sblRe•
();

142 
uöt16
 
ˇlcCRC
();

143 
uöt8
 
checkRC
();

144 
uöt16
 
¸c16
(uöt16 
¸c
, 
uöt8
 
vÆ
);

161 
uöt8
 
	$sblInô
()

163  
	`checkRC
();

164 
	}
}

181 
uöt8
 
	$sblPﬁl
()

183 
uöt8
 
ch
;

185 
	`HÆUARTRód
(0, &
ch
, 1))

187 
ΩcSã
)

189 
ΩcSãSOF
:

190 i‡(
RPC_UART_SOF
 =
ch
)

192 
ΩcSã
 = 
ΩcSãLí
;

196 
ΩcSãLí
:

197 i‡(
ch
 > 
SBL_MAX_SIZE
)

199 
ΩcSã
 = 
ΩcSãSOF
;

204 
ΩcSã
 = 
ΩcSãD©a
;

205 
sbFcs
 = 
sbIdx
 = 0;

206 
sbLí
 = 
ch
 + 3;

210 
ΩcSãD©a
:

211 
sbFcs
 ^
ch
;

212 
sbBuf
[
sbIdx
] = 
ch
;

214 i‡(++
sbIdx
 =
sbLí
)

216 
ΩcSã
 = 
ΩcSãFcs
;

220 
ΩcSãFcs
:

221 
ΩcSã
 = 
ΩcSãSOF
;

223 i‡((
sbFcs
 =
ch
Ë&& ((
sbBuf
[
RPC_POS_CMD0
] & 
RPC_SUBSYSTEM_MASK
Ë=
RPC_SYS_BOOT
))

225 
	`sblProc
();

226  
	`sblRe•
();

231 
	`HAL_SYSTEM_RESET
();

236  
FALSE
;

237 
	}
}

254 
	$sblProc
()

256 
uöt16
 
t16
 = 
	`BUILD_UINT16
(
sbBuf
[
SBL_REQ_ADDR_LSB
], sbBuf[
SBL_REQ_ADDR_MSB
]Ë+ 
HAL_SBL_IMG_BEG
;

257 
uöt8
 
Àn
 = 1, 
r•
 = 
SBL_SUCCESS
;

258 
uöt16
 
¸c
[2];

260 
sbBuf
[
RPC_POS_CMD1
])

262 
SBL_WRITE_CMD
:

263 i‡((
t16
 % 
SBL_PAGE_SIZE
) == 0)

265 
	`HÆFœshEø£
(
t16
 / 
SBL_PAGE_SIZE
);

267 
	`HÆFœshWrôe
(
t16
, (
sbBuf
 + 
SBL_REQ_DAT0
), (
SBL_RW_BUF_LEN
 / 
HAL_FLASH_WORD_SIZE
));

270 
SBL_READ_CMD
:

271 
Àn
 = 
SBL_RW_BUF_LEN
 + 
SBL_READ_HDR_LEN
;

272 
sbBuf
[
SBL_RSP_ADDR_MSB
] = sbBuf[
SBL_REQ_ADDR_MSB
];

273 
sbBuf
[
SBL_RSP_ADDR_LSB
] = sbBuf[
SBL_REQ_ADDR_LSB
];

275 
	`HÆFœshRód
(
t16
 / 
SBL_PAGE_SIZE
,

276 (
t16
 % 
SBL_PAGE_SIZE
Ë<< 2, (
sbBuf
 + 
SBL_RSP_DAT0
), 
SBL_RW_BUF_LEN
);

279 
SBL_ENABLE_CMD
:

280 
	`HÆFœshRód
(
HAL_SBL_IMG_CRC
 / 
SBL_PAGE_SIZE
,

281 (
HAL_SBL_IMG_CRC
 % 
SBL_PAGE_SIZE
Ë<< 2, (
uöt8
 *)
¸c
, (crc));

285 i‡(
¸c
[1] != crc[0])

287 
¸c
[1] = crc[0];

288 
¸c
[0] = 0xFFFF;

289 
	`HÆFœshWrôe
(
HAL_SBL_IMG_CRC
, (
uöt8
 *)
¸c
, 1);

290 
	`HÆFœshRód
(
HAL_SBL_IMG_CRC
 / 
SBL_PAGE_SIZE
,

291 (
HAL_SBL_IMG_CRC
 % 
SBL_PAGE_SIZE
Ë<< 2, (
uöt8
 *)
¸c
, (crc));

296 i‡(
¸c
[0] != crc[1])

298 
r•
 = 
SBL_VALIDATE_FAILED
;

302 
SBL_HANDSHAKE_CMD
:

306 
r•
 = 
SBL_FAILURE
;

310 
sbBuf
[
RPC_POS_LEN
] = 
Àn
;

311 
sbBuf
[
RPC_POS_CMD1
] |
SBL_RSP_MASK
;

312 
sbBuf
[
RPC_POS_DAT0
] = 
r•
;

313 
	}
}

330 
uöt8
 
	$sblRe•
()

332 
uöt8
 
fcs
 = 0, 
Àn
 = 
sbBuf
[
RPC_POS_LEN
] + 
RPC_FRAME_HDR_SZ
;

333 
uöt8
 
π∫
 = 
FALSE
;

335 
uöt8
 
idx
 = 
RPC_POS_LEN
; idx < 
Àn
; idx++)

337 
fcs
 ^
sbBuf
[
idx
];

339 
sbBuf
[
Àn
] = 
fcs
;

341 i‡((
sbBuf
[
RPC_POS_CMD1
] =(
SBL_ENABLE_CMD
 | 
SBL_RSP_MASK
)) &&

342 (
sbBuf
[
RPC_POS_DAT0
] =
SBL_SUCCESS
))

344 
Àn
++;

345 
π∫
 = 
TRUE
;

348 
ΩcBuf
[0] = 
RPC_UART_SOF
;

349 ()
	`HÆUARTWrôe
(0, 
ΩcBuf
, 
Àn
 + 
RPC_UART_FRAME_OVHD
);

351  
π∫
;

352 
	}
}

369 
uöt16
 
	$ˇlcCRC
()

371 
uöt16
 
addr
, 
¸c
 = 0;

373 
addr
 = 
HAL_SBL_IMG_BEG
;ádd∏< 
HAL_SBL_IMG_END
;áddr++)

375 i‡(
addr
 !
HAL_SBL_IMG_CRC
)

377 
uöt8
 
buf
[
HAL_FLASH_WORD_SIZE
];

378 
	`HÆFœshRód
(
addr
 / 
SBL_PAGE_SIZE
,

379 (
addr
 % 
SBL_PAGE_SIZE
Ë<< 2, 
buf
, 
HAL_FLASH_WORD_SIZE
);

380 
uöt8
 
idx
 = 0; idx < 
HAL_FLASH_WORD_SIZE
; idx++)

382 
¸c
 = 
	`¸c16
(¸c, 
buf
[
idx
]);

388 
¸c
 = 
	`¸c16
(crc, 0);

389 
¸c
 = 
	`¸c16
(crc, 0);

391  
¸c
;

392 
	}
}

409 
uöt8
 
	$checkRC
()

411 
uöt16
 
¸c
[2];

412 
	`HÆFœshRód
(
HAL_SBL_IMG_CRC
 / 
SBL_PAGE_SIZE
,

413 (
HAL_SBL_IMG_CRC
 % 
SBL_PAGE_SIZE
Ë<< 2, (
uöt8
 *)
¸c
, 
HAL_FLASH_WORD_SIZE
);

415 i‡((
¸c
[0] == 0) || (crc[0] == 0xFFFF))

417  
FALSE
;

420 i‡(
SBL_CALC_CRC
 && (
¸c
[0] != crc[1])&& (crc[1] == 0xFFFF))

422 
¸c
[1] = 
	`ˇlcCRC
();

423 
¸c
[0] = 0xFFFF;

424 !
	`HÆAdcCheckVdd
(
VDD_MIN_NV
));

425 
	`HÆFœshWrôe
(
HAL_SBL_IMG_CRC
, (
uöt8
 *)
¸c
, 1);

426 
	`HÆFœshRód
(
HAL_SBL_IMG_CRC
 / 
SBL_PAGE_SIZE
,

427 (
HAL_SBL_IMG_CRC
 % 
SBL_PAGE_SIZE
Ë<< 2, (
uöt8
 *)
¸c
, 
HAL_FLASH_WORD_SIZE
);

430  (
¸c
[0] == crc[1]);

431 
	}
}

450 
uöt16
 
	$¸c16
(
uöt16
 
¸c
, 
uöt8
 
vÆ
)

452 c⁄° 
uöt16
 
pﬁy
 = 0x1021;

453 
uöt8
 
˙t
;

455 
˙t
 = 0; c¡ < 8; c¡++, 
vÆ
 <<= 1)

457 
uöt8
 
msb
 = (
¸c
 & 0x8000) ? 1 : 0;

459 
¸c
 <<= 1;

460 i‡(
vÆ
 & 0x80Ë
¸c
 |= 0x0001;

461 i‡(
msb
Ë
¸c
 ^
pﬁy
;

464  
¸c
;

465 
	}
}

	@Projects/ble/util/SBL/app/sbl_exec.h

41 #i‚de‡
SBL_EXEC_H


42 
	#SBL_EXEC_H


	)

49 
	~"hÆ_ty≥s.h
"

56 
	#SBL_FORCE_BOOT
 0xF8

	)

57 
	#SBL_FORCE_RUN
 (
SBL_FORCE_BOOT
 ^ 0xFF)

	)

79 
uöt8
 
sblInô
();

96 
uöt8
 
sblPﬁl
();

	@Projects/ble/util/SBL/app/sbl_main.c

47 
	~"hÆ_adc.h
"

48 
	~"hÆ_as£π.h
"

49 
	~"hÆ_dma.h
"

50 
	~"hÆ_¶ìp.h
"

51 
	~"hÆ_ty≥s.h
"

52 
	~"sbl_exec.h
"

59 
hÆDMADesc_t
 
	gdmaCh0
;

66 #i‡
HAL_UART_SPI


67 
	~"_sbl_•i.c
"

68 #ñi‡
HAL_UART_SBL


69 
	~"_sbl_u¨t.c
"

71 #îr‹ 
No
 
vÆid
 
å™•‹t
 
c⁄figuªd
.

90 
	$maö
()

92 
	`HAL_BOARD_INIT
();

97 
	`HAL_DMA_SET_ADDR_DESC0
(&
dmaCh0
);

99 i‡(
	`sblInô
(Ë=
TRUE
)

106 
	`asm
("LJMP 0x0800");

107 
	`HAL_SYSTEM_RESET
();

111 !
	`HÆAdcCheckVdd
(
VDD_MIN_NV
));

112 
	`sblRun
();

113 
	`HAL_SYSTEM_RESET
();

114 
	}
}

135 #¥agm®
›timize
=
n⁄e


136 
	$hÆSÀïWaô
(
uöt16
 
duøti⁄
)

138 
duøti⁄
 >>= 1;

140 
duøti⁄
-- > 0)

142 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

143 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

144 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

146 
	}
}

148 
	$hÆAs£πH™dÀr
()

150 
	`HAL_SYSTEM_RESET
();

151 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_app.c

50 
	~"hÆ_Êash.h
"

51 
	~"hÆ_ty≥s.h
"

52 #i‡
deföed
 
MT_UBL_FUNC


53 
	~"mt.h
"

54 
	~"mt_Ωc.h
"

56 
	~"ubl_≠p.h
"

63 #i‡
deföed
 
HAL_DONGLE_NANO
 && !deföed 
MT_UBL_FUNC


64 #w¨nög 
Ensuª
 
th©
 
Aµliˇti⁄
 
code
 
has
 
a
 
way
 
of
 
beög
 
åiggîed
 
to
 
övoke
 
ublAµF‹˚BoŸ
().

68 
	#UBL_MD_PG_OFFSET
 0x069C

	)

70 #¥agm®
loˇti⁄
="AES_CTRL_BLK"

71 c⁄° 
__code
 
´s_˘æ_blk_t
 
	g_´sCålBlk
 = {

78 #¥agm®
ªquúed
=
_´sCålBlk


85 #¥agm®
loˇti⁄
="UBL_FILENAME_SPACE"

86 c⁄° 
uöt8
 
	g_ublFûeName
[256] = {

104 #¥agm®
ªquúed
=
_ublFûeName


106 #¥agm®
loˇti⁄
="UBL_METADATA_SPACE"

107 c⁄° 
ublMëaD©a_t
 
	g_ublMëaD©a
 = {

108 #i‡
deföed
 
HAL_DONGLE_NANO


114 #w¨nög 
Put
 
a
 
mónögful
 
£curôy
 
key
 
hîe
 
to
 
¥Ÿe˘
 
your
 
√tw‹k
 securôy 
keys
.

132 #w¨nög 
Put
 
a
 
n⁄
-
zîo
 
cou¡down
 
hîe
 
u¡û
 
the
 
code
 
has
 
bìn
 
¥oví
 
to
 
nŸ
 
lock
-
out
Åhê
UBL
.

175 #¥agm®
ªquúed
=
_ublMëaD©a


192 
	$≠pF‹˚BoŸ
()

194 
uöt16
 
¸c
[2];

197 
	`HÆFœshRód
(
UBL_PAGE_FIRST
, 
UBL_MD_PG_OFFSET
, (
uöt8
 *)
¸c
, 4);

199 i‡((
¸c
[0] == 0xFFFF) || (crc[0] == 0x0000) ||

200 (
¸c
[1] == 0xFFFF) || (crc[1] == 0x0000) ||

201 (
¸c
[1] != crc[0]))

206 
	`HAL_DISABLE_INTERRUPTS
();

208 
¸c
[1] ^= 0xFFFF;

209 
¸c
[0] = 0xFFFF;

210 
	`HÆFœshWrôe
(((
uöt16
)&
_ublMëaD©a
Ë/ 
HAL_FLASH_WORD_SIZE
, (
uöt8
 *)
¸c
, 1);

212 
	`HAL_SYSTEM_RESET
();

213 
	}
}

215 #i‡
deföed
 
MT_UBL_FUNC


231 
uöt8
 
	$MT_UblComm™dPro˚ssög
(
uöt8
 *
pBuf
)

233 i‡(
pBuf
[
MT_RPC_POS_CMD1
] =
MT_UBL_FORCE
)

235 
	`ublAµF‹˚BoŸ
();

238  
MT_RPC_ERR_COMMAND_ID
;

239 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_app.h

45 #i‚de‡
UBL_APP_H


46 
	#UBL_APP_H


	)

53 
	~"hÆ_´s.h
"

54 
	~"hÆ_ty≥s.h
"

63 
	#UBL_PAGE_SIZE
 (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
)

	)

65 
	#UBL_ADDR_OSET
 (
uöt16
)(
UBL_PAGE_FIRST
 * 
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
)

	)

67 
	#UBL_ADDR_CTRL
 (
UBL_ADDR_OSET
 + 0x00)

68 
	#UBL_ADDR_CRC
 (
UBL_ADDR_OSET
 + 0x10)

69 
	#UBL_ADDR_IMG_LEN
 (
UBL_ADDR_OSET
 + 0x14)

70 

	)

74 
	#UBL_PAGE_FIRST
 1

	)

76 
	#UBL_PAGE_LAST
 119

	)

86 
	#UBL_RW_ADDR_END
 ((
˘æBlk
.
imageLí
 * 
UBL_PAGE_SIZE
Ë+ 
UBL_ADDR_OSET
 - 
UBL_RW_BUF_LEN
/4)

	)

87 
	#UBL_RW_ADDR_BEG
 
UBL_ADDR_OSET


	)

90 
	#UBL_NVM_GET
(
UBL_ADDR
, 
PBUF
, 
BYTE_CNT
) \

91 
	`HÆFœshRód
((
UBL_ADDR
Ë/ 
UBL_PAGE_SIZE
, ((UBL_ADDR) % UBL_PAGE_SIZE) << 2,\

92 (*)(
PBUF
), (
BYTE_CNT
))

	)

95 
	#UBL_NVM_SET
(
UBL_ADDR
, 
PBUF
, 
BYTE_CNT
) \

96 
	`HÆFœshWrôe
((
UBL_ADDR
), (*)(
PBUF
), ((
BYTE_CNT
Ë/ 
HAL_FLASH_WORD_SIZE
))

	)

104 
uöt8
 
	msig«tuª
[
KEY_BLENGTH
];

105 
uöt16
 
	m•¨e
[2];

106 
uöt8
 
	mimageLí
;

107 
uöt8
 
	mÆlowSignCmd
;

108 
uöt8
 
	mn⁄˚10
[10];

109 } 
	t´s_˘æ_blk_t
;

111 
°©ic_as£π
((((
´s_˘æ_blk_t
Ë% 
KEY_BLENGTH
) == 0),

115 
uöt16
 
	m¸cRC
;

116 
uöt16
 
	m¸cShdw
;

117 
uöt16
 
	mchkMD
;

118 
uöt16
 
	mdlyJmp
;

119 
uöt8
 
	m£cKey
[32];

120 
uöt8
 
	mîa£En
[16];

121 
uöt8
 
	mwrôeEn
[16];

122 
uöt8
 
	mªadLock
[16];

123 
uöt8
 
	mcfgDiscs
[1];

124 
uöt8
 
	mgpioP‹t
;

125 
uöt8
 
	mcfgS∑ª
[2];

128 
uöt8
 
	m˙tDnF‹˚d
;

129 
uöt8
 
	mw‹dPad1
[3];

132 
uöt8
 
	m˙tDnSecKey
;

133 
uöt8
 
	mw‹dPad2
[3];

134 } 
	tublMëaD©a_t
;

135 
°©ic_as£π
(((
ublMëaD©a_t
) == 100), "ChangingÅhe ublMetaData_t structureÑequires \
 changesÅoÜinker filesándÑe-buildingÅhe USB-MSDÜibrary.");

139 
	mgpioU£NŸ
,

140 
	mgpioPﬁ¨ôy
,

141 
	mgpioPuŒTri
,

142 
	mgpioPuŒUpDn
,

143 
	mcfgDisc0_4
,

144 
	mcfgDisc0_5
,

145 
	mcfgDisc0_6
,

146 
	mcfgDisc0_7


147 } 
	tcfgDisc0_t
;

169 
≠pF‹˚BoŸ
();

171 #i‡
deföed
 
MT_UBL_FUNC


187 
uöt8
 
MT_UblComm™dPro˚ssög
(uöt8 *
pBuf
);

	@Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_exec.c

48 
	~<°ddef.h
>

49 
	~<°rög.h
>

51 
	~"hÆ_bﬂrd_cfg.h
"

52 
	~"hÆ_dma.h
"

53 
	~"hÆ_Êash.h
"

54 
	~"hÆ_ty≥s.h
"

55 
	~"ubl_≠p.h
"

56 
	~"ubl_exec.h
"

57 
	~"usb_msd.h
"

64 #i‡!
deföed
 
HAL_DONGLE_NANO


65 
	#UBL_GPIO_USE


	)

70 
	#UBL_MD_CHKLEN
 (
	`off£tof
(
ublMëaD©a_t
, 
˙tDnF‹˚d
Ë- off£tof(ublMëaD©a_t, 
chkMD
))

	)

72 c⁄° 
uöt8
 
	gu∆ockedSecKey
[32] =

79 
	#UBL_META_DATA_ADDR_WR
 \

80 ((
uöt16
)(
UBL_META_DATA_PAGE
 * ((uöt16)(
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
))) + \

81 (
uöt16
)(
UBL_META_DATA_IDX
 / 
HAL_FLASH_WORD_SIZE
))

	)

83 
	#UBL_CNTDN_FORCED_ADDR
 (
UBL_META_DATA_ADDR_WR
 + \

84 (
	`off£tof
(
ublMëaD©a_t
, 
˙tDnF‹˚d
Ë/ 
HAL_FLASH_WORD_SIZE
))

	)

85 
	#UBL_CNTDN_SECKEY_ADDR
 (
UBL_META_DATA_ADDR_WR
 + \

86 (
	`off£tof
(
ublMëaD©a_t
, 
˙tDnSecKey
Ë/ 
HAL_FLASH_WORD_SIZE
))

	)

91 #i‡!
deföed
 
UBL_SECURE


92 
	#UBL_SECURE
 
FALSE


	)

95 #i‡
UBL_SECURE


96 c⁄° 
uöt8
 
	g´sKey
[
KEY_BLENGTH
] = {

105 #i‡!
deföed
 
UBL_SIGNER


106 
	#UBL_SIGNER
 
FALSE


	)

109 #i‡
UBL_SIGNER


110 #i‡!
UBL_SECURE


111 #îr‹ 
Mism©ched
 
deföôi⁄s
 
UBL_SIGNER
 
™d
 
UBL_SECURE
.

113 #w¨nög 
You
 
buût
 
a
 
•ecül
 "Signög" 
boŸ
 
lﬂdî
 - dÿ
nŸ
 
ªÀa£
 
to
 
m¨kë
 ... 
öã∫Æ
 
u£
 
⁄ly
.

122 
	#UBL_READ_ST
(
STCNT
Ë
	`°
 ( \

124 ((
uöt8
 *Ë&(
STCNT
))[0] = 
ST0
; \

125 } ((
uöt8
 *Ë&(
STCNT
))[0] !
ST0
); \

126 ((
uöt8
 *Ë&(
STCNT
))[1] = 
ST1
; \

127 ((
uöt8
 *Ë&(
STCNT
))[2] = 
ST2
; \

128 ((
uöt8
 *Ë&(
STCNT
))[3] = 0; \

129 )

	)

136 c⁄° 
uöt8
 
	gUBL_RC_IMG_PG_BEG
 = 
UBL_PAGE_FIRST
;

137 c⁄° 
uöt8
 
	gUBL_RC_IMG_PG_END
 = 
UBL_PAGE_LAST
;

144 
__no_öô
 
uöt8
 
	gpgBuf
[
HAL_FLASH_PAGE_SIZE
];

145 
__no_öô
 
ublMëaD©a_t
 
	gublMD
;

152 #i‡
deföed
 
UBL_GPIO_USE


153 
__no_öô
 vﬁ©ûê
uöt8
 *
	gpF‹˚P‹t
;

154 
__no_öô
 
uöt8
 
	gf‹˚Pö
;

156 
__no_öô
 
uöt32
 
	g°Sèπ
, 
	g°Dñay
;

158 #i‡
UBL_SECURE


160 
boﬁ
 
	gsignMode
;

168 #i‡
UBL_SECURE


169 
uöt8
 
´sCheckCål
(*
pBuf
);

170 
´sLﬂdKey
();

171 
´sInôSig
();

174 
boﬁ
 
˙tDnF‹˚dDe¸
();

175 #i‡
deföed
 
UBL_GPIO_USE


176 
boﬁ
 
gpioInô
();

178 
vddWaô
();

197 
uöt8
 
	$ublAesAuth
()

199 #i‡
UBL_SECURE


200 
uöt8
 
pgC¡
 = 0;

201 
uöt8
 
sigBuf
[
KEY_BLENGTH
];

203 
´s_˘æ_blk_t
 
˘æBlk
;

204 
	`UBL_NVM_GET
(
UBL_ADDR_CTRL
, &
˘æBlk
, (
´s_˘æ_blk_t
));

206 
	`´sInôSig
();

208 
uöt8
 
pgNum
 = 
UBL_PAGE_FIRST
;ÖgNum <
UBL_PAGE_LAST
;ÖgNum++)

210 i‡(!
	`GET_BIT
(
ublMD
.
wrôeEn
, 
pgNum
))

215 
pgC¡
++;

217 
	`HÆFœshRód
(
pgNum
, 0, 
pgBuf
, 
HAL_FLASH_PAGE_SIZE
);

219 
uöt16
 
o£t
 = 0; o£à< 
HAL_FLASH_PAGE_SIZE
; )

221 i‡((
pgC¡
 =1Ë&& (
o£t
 == 0))

223 
o£t
 +
KEY_BLENGTH
;

225 i‡((
pgC¡
 =
˘æBlk
.
imageLí
Ë&& (
o£t
 =(
HAL_FLASH_PAGE_SIZE
 - 
KEY_BLENGTH
)))

230 
ENCCS
 |= 0x01;

231 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

233 
ENCDI
 = 
pgBuf
[
o£t
++];

235 (
ENCCS
 & 
	`BV
(3)) == 0);

238 i‡(
pgC¡
 >
˘æBlk
.
imageLí
)

244 
ENCCS
 = 
CBC
 | 
AES_ENCRYPT
 | 0x01;

248 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

250 
uöt16
 
o£t
 = (
HAL_FLASH_PAGE_SIZE
 - 
KEY_BLENGTH
); oset < HAL_FLASH_PAGE_SIZE; oset++)

252 
ENCDI
 = 
pgBuf
[
o£t
];

254 
	`HAL_AES_DELAY
();

257 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

259 
sigBuf
[
˙t
] = 
ENCDO
;

262 i‡(
˘æBlk
.
ÆlowSignCmd
 != 0)

264 
˘æBlk
.
ÆlowSignCmd
 = 0;

265 ()
	`mem˝y
(
˘æBlk
.
sig«tuª
, 
sigBuf
, 
KEY_BLENGTH
);

266 
	`UBL_NVM_SET
(
UBL_ADDR_CTRL
, &
˘æBlk
, (
´s_˘æ_blk_t
));

267 
	`UBL_NVM_GET
(
UBL_ADDR_CTRL
, &
˘æBlk
, (
´s_˘æ_blk_t
));

270 #i‡
UBL_SIGNER


271 
signMode
 = 
TRUE
;

273 i‡(
	`memcmp
(
˘æBlk
.
sig«tuª
, 
sigBuf
, 
KEY_BLENGTH
))

276  
FALSE
;

280 
	`HÆFœshRód
(
UBL_META_DATA_PAGE
, 
UBL_META_DATA_IDX
, (
uöt8
 *)&
ublMD
.
¸cRC
, 4);

282 
ublMD
.
¸cShdw
 = ublMD.
¸cRC
;

283 
ublMD
.
¸cRC
 = 
UBL_CRC_ERASED
;

284 
	`HÆFœshWrôe
(
UBL_META_DATA_ADDR_WR
, (
uöt8
 *)&
ublMD
.
¸cRC
, 1);

286  
TRUE
;

287 
	}
}

306 
uöt8
 
	$ublAesCry±
(
uöt8
 
pgNum
, uöt8 *
pgBuf
)

308 #i‡
UBL_SECURE


309 i‡(!
UBL_SIGNER
 || 
signMode
)

312 
uöt8
 
ivN⁄˚
[
KEY_BLENGTH
] = { 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1 };

313 
uöt8
 *
pBuf
 = 
pgBuf
;

315 
ENCCS
 = 
CTR
 | 
AES_LOAD_IV
 | 0x01;

319 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

321 
uöt8
 
idx
 = 0; idx < 
KEY_BLENGTH
; idx++)

323 
ENCDI
 = 
ivN⁄˚
[
idx
];

325 (
ENCCS
 & 
	`BV
(3)) == 0);

327 
uöt8
 
˙t
 = 0; c¡ < (
HAL_FLASH_PAGE_SIZE
 / 
KEY_BLENGTH
); cnt++)

329 
ENCCS
 = 
CTR
 | 
AES_ENCRYPT
 | 0x01;

333 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

335 
uöt8
 
blk
 = 0; blk < 4; blk++)

337 
uöt8
 
idx
 = 0; idx < 4; idx++)

339 
ENCDI
 = 
pBuf
[
idx
];

342 
	`HAL_AES_DELAY
();

344 
uöt8
 
idx
 = 0; idx < 4; idx++)

346 
pBuf
[
idx
] = 
ENCDO
;

349 
pBuf
 += 4;

353 i‡((
pgNum
 =
UBL_PAGE_FIRST
Ë&& !
	`´sCheckCål
(
pgBuf
))

355  
FALSE
;

359 ()
pgNum
;

360 ()
pgBuf
;

363  
TRUE
;

364 
	}
}

381 
boﬁ
 
	$ublCfg
(
ublMëaD©a_t
 *
pMD
)

384 i‡(!
UBL_UNLOCKED
 && (
	`memcmp
(&
ublMD
.
£cKey
, &
pMD
->secKey, (ublMD.secKey)) != 0))

386 i‡(
ublMD
.
˙tDnSecKey
 == 0)

388 
	`ublMassEø£
(
TRUE
);

389 
	`HAL_SYSTEM_RESET
();

393 
uöt8
 
mask
 = 0x01;

395 (
mask
 & 
ublMD
.
˙tDnSecKey
) == 0)

397 
mask
 <<= 1;

399 
ublMD
.
˙tDnSecKey
 ^
mask
;

402 
uöt8
 
£cKeyAndPad
[4] = { 0xFF, 0xFF, 0xFF, 0xFF };

403 
£cKeyAndPad
[0] ^
mask
;

404 
	`HÆFœshWrôe
(
UBL_CNTDN_SECKEY_ADDR
, 
£cKeyAndPad
, 1);

409 
	`UBL_UNLOCK
();

410 ()
	`mem˝y
(&
ublMD
.
chkMD
, &
pMD
->chkMD, 
UBL_MD_CHKLEN
);

411 
ublMD
.
¸cShdw
 = 
UBL_CRC_ZEROED
;

412  
TRUE
;

415  
FALSE
;

416 
	}
}

433 
	$ublExec
()

440 i‡(
	`usb_msd_pﬁl
(Ë=
TRUE
)

445 i‡(
UBL_RC_VALID
 && (
ublMD
.
dlyJmp
 != 0))

447 #i‡
deföed
 
UBL_GPIO_USE


448 i‡(!
	`GET_BIT
(
ublMD
.
cfgDiscs
+0, 
gpioU£NŸ
) &&

449 (
	`GET_BIT
(
ublMD
.
cfgDiscs
+0, 
gpioPﬁ¨ôy
Ë=((*
pF‹˚P‹t
 & 
	`BV
(
f‹˚Pö
)) != 0)))

451 
ublMD
.
¸cShdw
 = 
UBL_CRC_ZEROED
;

456 
uöt32
 
°Dñè
;

457 
	`UBL_READ_ST
(
°Dñè
);

458 
°Dñè
 -
°Sèπ
;

459 ((
uöt8
 *)&
°Dñè
)[3] = 0;

461 i‡(
°Dñè
 > 
°Dñay
)

469 i‡(
UBL_RC_VALID
)

471 
	`usb_msd_unöô
();

472 
	`ublJump
();

474 
	}
}

491 
	$ublInô
()

493 
	`HÆFœshRód
(
UBL_META_DATA_PAGE
, 
UBL_META_DATA_IDX
, (
uöt8
 *)&
ublMD
, (
ublMëaD©a_t
));

496 i‡(
	`memcmp
(
ublMD
.
£cKey
, 
u∆ockedSecKey
, (unlockedSecKey)) == 0)

498 
	`UBL_UNLOCK
();

501 i‡(
UBL_RC_VALID
)

503 i‡((
ublMD
.
˙tDnF‹˚d
 =0Ë|| (
	`˙tDnF‹˚dDe¸
(Ë=
FALSE
))

505 #i‡
deföed
 
UBL_GPIO_USE


506 i‡(
	`GET_BIT
(
ublMD
.
cfgDiscs
+0, 
gpioU£NŸ
Ë|| (
	`gpioInô
(Ë=
FALSE
))

509 i‡(
ublMD
.
dlyJmp
 == 0)

511 
	`ublJump
();

515 
°Dñay
 = (
ublMD
.
dlyJmp
 * 4096UL) / 125;

516 
	`UBL_READ_ST
(
°Sèπ
);

522 
	`vddWaô
();

524 #i‡
UBL_SECURE


525 
	`´sLﬂdKey
();

527 
´s_˘æ_blk_t
 
˘æBlk
;

528 
	`UBL_NVM_GET
(
UBL_ADDR_CTRL
, &
˘æBlk
, (
´s_˘æ_blk_t
));

530 i‡((
˘æBlk
.
ÆlowSignCmd
 !0Ë&& (˘æBlk.
imageLí
 != 0xFF))

533 ()
	`ublAesAuth
();

536 #i‡
UBL_SIGNER


537 
uöt8
 
idx
 = 0; idx < 16; idx++)

539 
ublMD
.
ªadLock
[
idx
] = ublMD.
wrôeEn
[idx] ^ 0xFF;

544 
	`usb_msd_öô
();

545 
	}
}

562 
	$ublJump
()

564 
	`asm
("LJMP 0x820\n");

565 
	`HAL_SYSTEM_RESET
();

566 
	}
}

583 
	$ublMassEø£
(
boﬁ
 
îa£AŒ
)

585 
uöt8
 
pg
 = 
UBL_RC_IMG_PG_BEG
+1;Ög <
UBL_PAGE_LAST
;Ög++)

587 i‡(
îa£AŒ
 || 
	`GET_BIT
(
ublMD
.
îa£En
, 
pg
))

589 
FADDRH
 = 
pg
 * (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
 / 256);

590 
FCTL
 |= 0x01;

595 
FADDRH
 = 
UBL_RC_IMG_PG_BEG
 * (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
 / 256);

596 
FCTL
 |= 0x01;

597 
	}
}

599 #i‡
UBL_SECURE


615 
uöt8
 
	$´sCheckCål
(*
pBuf
)

617 
uöt8
 
sigBuf
[
KEY_BLENGTH
] =

619 
´s_˘æ_blk_t
 *
pCé
 = (´s_˘æ_blk_à*)
pBuf
;

621 #i‡
UBL_SIGNER


622 i‡–
	`memcmp
(
pCé
->
sig«tuª
, 
sigBuf
, (sigBuf))

623 || (
pCé
->
imageLí
 == 0)

624 || (
pCé
->
imageLí
 > 
UBL_PAGE_LAST
)

625 || (
pCé
->
ÆlowSignCmd
 == 0))

627 i‡(!
	`memcmp
(
pCé
->
sig«tuª
, 
sigBuf
, (sigBuf))

628 || (
pCé
->
imageLí
 == 0)

629 || (
pCé
->
imageLí
 > 
UBL_PAGE_LAST
)

630 || (
pCé
->
ÆlowSignCmd
 != 0))

633  
FALSE
;

636  
TRUE
;

637 
	}
}

654 
	$´sLﬂdKey
()

657 
uöt8
 *
keyPå
 = (uöt8 *)
´sKey
;

659 
ENCCS
 = 
ECB
 | 
AES_LOAD_KEY
 | 0x01;

663 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

665 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

667 
ENCDI
 = *
keyPå
++;

669 
	}
}

686 
	$´sInôSig
()

688 
´s_˘æ_blk_t
 
˘æBlk
;

689 
	`UBL_NVM_GET
(
UBL_ADDR_CTRL
, &
˘æBlk
, (
´s_˘æ_blk_t
));

691 
ENCCS
 = 
CBC_MAC
 | 
AES_LOAD_IV
 | 0x01;

695 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

697 
uöt8
 
˙t
 = 0; c¡ < 
KEY_BLENGTH
; cnt++)

699 
ENCDI
 = 0;

702 
ENCCS
 = 
CBC_MAC
 | 
AES_ENCRYPT
 | 0x01;

706 
ASM_NOP
; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP; ASM_NOP;

708 
ENCDI
 = 0x3A;

710 
ENCDI
 = 
	`LO_UINT16
(
˘æBlk
.
•¨e
[0]);

711 
ENCDI
 = 
	`HI_UINT16
(
˘æBlk
.
•¨e
[0]);

712 
uöt8
 
idx
 = 0; idx < 10; idx++)

714 
ENCDI
 = 
˘æBlk
.
n⁄˚10
[
idx
];

718 
uöt32
 
imageLí
 = 2048UL * 
˘æBlk
.imageLí - 
KEY_BLENGTH
;

719 
ENCDI
 = ((
uöt8
 *)&
imageLí
)[2];

720 
ENCDI
 = ((
uöt8
 *)&
imageLí
)[1];

721 
ENCDI
 = ((
uöt8
 *)&
imageLí
)[0];

723 (
ENCCS
 & 
	`BV
(3)) == 0);

724 
	}
}

742 
boﬁ
 
	$˙tDnF‹˚dDe¸
()

744 
uöt8
 
mask
 = 0x01;

746 (
mask
 & 
ublMD
.
˙tDnF‹˚d
) == 0)

748 
mask
 <<= 1;

750 
ublMD
.
˙tDnF‹˚d
 ^
mask
;

752 i‡(
ublMD
.
˙tDnF‹˚d
 == 0)

756 
ublMD
.
¸cShdw
 = 
UBL_CRC_ZEROED
;

757  
TRUE
;

762 
uöt8
 
f‹˚dAndPad
[4] = { 0xFF, 0xFF, 0xFF, 0xFF };

763 
f‹˚dAndPad
[0] ^
mask
;

764 
	`HÆFœshWrôe
(
UBL_CNTDN_FORCED_ADDR
, 
f‹˚dAndPad
, 1);

765  
FALSE
;

767 
	}
}

769 #i‡
deföed
 
UBL_GPIO_USE


785 
boﬁ
 
	$gpioInô
()

787 vﬁ©ûê
uöt8
 *
±r
;

788 
uöt8
 
p‹t
 = 
ublMD
.
gpioP‹t
 / 8;

789 
uöt8
 
pö
 = 
ublMD
.
gpioP‹t
 % 8;

791 
±r
 = ((
p‹t
 =0Ë? &
X_P0SEL
 : (’‹à=1Ë? &
X_P1SEL
 : &
X_P2SEL
));

792 *
±r
 &~
	`BV
(
pö
);

794 
±r
 = ((
p‹t
 =0Ë? &
X_P0DIR
 : (’‹à=1Ë? &
X_P1DIR
 : &
X_P2DIR
));

795 *
±r
 &~
	`BV
(
pö
);

797 
±r
 = ((
p‹t
 =0Ë? &
X_P0INP
 : (’‹à=1Ë? &
X_P1INP
 : &
X_P2INP
));

798 i‡(
	`GET_BIT
(
ublMD
.
cfgDiscs
+0, 
gpioPuŒTri
))

800 i‡(
	`GET_BIT
(
ublMD
.
cfgDiscs
+0, 
gpioPuŒUpDn
))

802 
P2INP
 &~
	`BV
(
p‹t
 + 5);

806 
P2INP
 |
	`BV
(
p‹t
 + 5); \

808 *
±r
 &~
	`BV
(
pö
);

812 *
±r
 |
	`BV
(
pö
);

815 
f‹˚Pö
 = 
pö
;

816 
pF‹˚P‹t
 = ((
p‹t
 =0Ë? &
X_P0
 : (’‹à=1Ë? &
X_P1
 : &
X_P2
));

818 i‡(
	`GET_BIT
(
ublMD
.
cfgDiscs
+0, 
gpioPﬁ¨ôy
Ë=((*
pF‹˚P‹t
 & 
	`BV
(
f‹˚Pö
)) != 0))

820 
ublMD
.
¸cShdw
 = 
UBL_CRC_ZEROED
;

821  
TRUE
;

824  
FALSE
;

825 
	}
}

843 
	$vddWaô
()

845 
uöt8
 
˙t
 = 16;

849 
ADCCON3
 = 0x0F;

850 !(
ADCCON1
 & 0x80));

851 } 
ADCH
 < 
VDD_MIN_NV
);

852 } --
˙t
);

853 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_exec.h

42 #i‚de‡
UBL_EXEC_H


43 
	#UBL_EXEC_H


	)

50 
	~"hÆ_ty≥s.h
"

51 
	~"ubl_≠p.h
"

52 
	~"usb_msd.h
"

60 
	#UBL_FILE_NAME_PAGE
 
UBL_RC_IMG_PG_BEG


	)

61 
	#UBL_FILE_NAME_IDX
 (
HAL_FLASH_PAGE_SIZE
 - 
USB_MSD_FILENAME_MAX
)

	)

64 
	#UBL_META_DATA_PAGE
 
UBL_FILE_NAME_PAGE


	)

65 
	#UBL_META_DATA_IDX
 (
UBL_FILE_NAME_IDX
 - (
ublMëaD©a_t
))

	)

67 
	#UBL_META_DATA_ADDR
 \

68 ((
uöt16
)(
UBL_META_DATA_PAGE
 * 
HAL_FLASH_PAGE_SIZE
Ë+ 
UBL_META_DATA_IDX
)

	)

71 
	#UBL_CRC_ERASED
 0xFFFF

	)

72 
	#UBL_CRC_ZEROED
 0x0000

	)

79 
	#UBL_RC_VALID
 ( \

80 (((
ublMD
.
¸cRC
 =ublMD.
¸cShdw
) && \

81 (
ublMD
.
¸cRC
 !
UBL_CRC_ERASED
) && \

82 (
ublMD
.
¸cRC
 !
UBL_CRC_ZEROED
)Ë? 
TRUE
 : 
FALSE
) \

83 )

	)

85 
	#UBL_UNLOCKED
 (
ublMD
.
w‹dPad2
[2] =0)

	)

86 
	#UBL_UNLOCK
(Ë
ublMD
.
w‹dPad2
[2] = 0

	)

87 
	#UBL_LOCK
(Ë
ublMD
.
w‹dPad2
[2] = 255

	)

94 c⁄° 
uöt8
 
UBL_RC_IMG_PG_BEG
;

95 c⁄° 
uöt8
 
UBL_RC_IMG_PG_END
;

97 
uöt8
 
pgBuf
[
HAL_FLASH_PAGE_SIZE
];

98 
ublMëaD©a_t
 
ublMD
;

122 
uöt8
 
ublAesAuth
();

141 
uöt8
 
ublAesCry±
(uöt8 
pgNum
, uöt8 *
pgBuf
);

158 
boﬁ
 
ublCfg
(
ublMëaD©a_t
 *
pMD
);

175 
ublExec
();

192 
ublInô
();

209 
ublJump
();

226 
ublMassEø£
(
boﬁ
 
îa£AŒ
);

	@Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_main.c

48 
	~"hÆ_bﬂrd_cfg.h
"

49 
	~"hÆ_dma.h
"

50 
	~"hÆ_Êash.h
"

51 
	~"ubl_≠p.h
"

52 
	~"ubl_exec.h
"

53 
	~"usb_öãºu±.h
"

60 
__no_öô
 
hÆDMADesc_t
 
	gdmaCh0
;

67 
vddWaô
();

72 #i‡(
__CODE_MODEL__
 == 2)

73 
__√¨_func
 
__roŸ
 

75 
__roŸ
 

77 
__low_Àvñ_öô
();

96 #i‡(
__CODE_MODEL__
 == 2)

97 
__√¨_func
 
__roŸ
 

99 
__roŸ
 

101 
	$__low_Àvñ_öô
()

104 
MEMCTR
 = (MEMCTR & 0xF8) | 0x07;

106 i‡(
Re£tWasW©chDog
)

109 
	`HÆFœshRód
(
UBL_META_DATA_PAGE
, 
UBL_META_DATA_IDX
, (
uöt8
 *)&
ublMD
.
¸cRC
, 4);

111 i‡(
UBL_RC_VALID
)

113 
	`ublJump
();

117 
	`vddWaô
();

118 
	`HAL_BOARD_INIT
();

122 
	}
}

139 
	$maö
()

144 
	`HAL_DMA_SET_ADDR_DESC0
(&
dmaCh0
);

146 
	`ublInô
();

147 
	`ublExec
();

149 
	`HAL_SYSTEM_RESET
();

150 
	}
}

167 
	$vddWaô
()

169 
uöt8
 
˙t
 = 16;

173 
ADCCON3
 = 0x0F;

174 !(
ADCCON1
 & 0x80));

175 } 
ADCH
 < 
VDD_MIN_RUN
);

176 } --
˙t
);

177 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_aes.h

39 #i‚de‡
HAL_AES_H_


40 
	#HAL_AES_H_


	)

42 
	~"hÆ_ty≥s.h
"

44 
	#STATE_BLENGTH
 16

45 
	#KEY_BLENGTH
 16

46 
	#KEY_EXP_LENGTH
 176

47 

	)

52 #i‡((
deföed
 
SOFTWARE_AES
Ë&& (SOFTWARE_AES =
TRUE
)Ë&& ((deföed 
SW_AES_AND_KEY_EXP
) && (SW_AES_AND_KEY_EXP == TRUE))

56 
HÆAesInô
( );

57 
AesLﬂdBlock
–
uöt8
 * );

58 
AesSèπBlock
–
uöt8
 *, uint8 * );

59 
AesSèπSh‹tBlock
–
uöt8
 *, uint8 * );

60 
AesLﬂdIV
(
uöt8
 *);

61 
AesDmaSëup
–
uöt8
 *, 
uöt16
, uint8 *, uint16 );

62 
AesLﬂdKey
–
uöt8
 * );

64 (*
pS•AesEn¸y±
)–
uöt8
 *, uint8 * );

65 
	`s•_HW_KeyInô
 (
uöt8
 *);

66 
	`s•KeyEx∑nsi⁄
 (
uöt8
 *, uint8 *);

68 
	`s•AesEn¸y±HW
 (
uöt8
 *, uint8 *);

69 
	`s•AesEn¸y±KeyExp
 (
uöt8
 *, uint8 *);

70 
	`s•AesEn¸y±Basic
 (
uöt8
 *, uint8 *);

72 
	`s•AesDe¸y±HW
–
uöt8
 *, uint8 * );

73 
	`s•AesDe¸y±
–
uöt8
 *
key
, uöt8 *
buf
 );

76 
	#AES_BUSY
 0x08

	)

77 
	#ENCRYPT
 0x00

	)

78 
	#DECRYPT
 0x01

	)

81 
	#AES_SETMODE
(
mode
) \

83 
ENCCS
 = (ENCCS & ~0x70Ë| (
mode
); \

84 
	}
} 0)

	)

87 
	#CBC
 0x00

	)

88 
	#CFB
 0x10

	)

89 
	#OFB
 0x20

	)

90 
	#CTR
 0x30

	)

91 
	#ECB
 0x40

	)

92 
	#CBC_MAC
 0x50

	)

95 
	#AES_SET_ENCR_DECR_KEY_IV
(
cmd
) \

97 
ENCCS
 = (ENCCS & ~0x07Ë| (
cmd
); \

98 } 0)

	)

101 
	#AES_ENCRYPT
 0x00

	)

102 
	#AES_DECRYPT
 0x02

	)

103 
	#AES_LOAD_KEY
 0x04

	)

104 
	#AES_LOAD_IV
 0x06

	)

108 
	#AES_START
(Ë
ENCCS
 |0x01

	)

111 
	#HAL_DMA_AES_IN
 1

	)

112 
	#HAL_DMA_AES_OUT
 2

	)

115 
	#HAL_AES_IN_ADDR
 0x70B1

	)

116 
	#HAL_AES_OUT_ADDR
 0x70B2

	)

118 #i‡!
deföed
 (
HAL_AES_DMA
Ë|| (HAL_AES_DMA =
FALSE
)

119 
	#HAL_AES_DELAY
() \

121 vﬁ©ûê
uöt8
 
dñay
 = 15; \

122 
dñay
--); \

123 } 0)

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_board.h

1 
	~"hÆ_bﬂrd_cfg.h
"

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_board_cfg.h

42 #i‚de‡
HAL_BOARD_CFG_H


43 
	#HAL_BOARD_CFG_H


	)

50 #i‡
deföed
 
HAL_DONGLE_NANO


51 
	~"hÆ_bﬂrd_cfg_«no.h
"

53 
	~"hÆ_mcu.h
"

60 
	#OSC32K_CRYSTAL_INSTALLED
 
FALSE


	)

63 #i‡!
deföed
 (
OSC32K_CRYSTAL_INSTALLED
Ë|| (deföed (OSC32K_CRYSTAL_INSTALLEDË&& (OSC32K_CRYSTAL_INSTALLED =
TRUE
))

64 
	#OSC_32KHZ
 0x00

	)

66 
	#OSC_32KHZ
 0x80

	)

75 
	#HAL_FLASH_PAGE_PER_BANK
 16

	)

77 
	#HAL_FLASH_PAGE_SIZE
 2048

	)

78 
	#HAL_FLASH_WORD_SIZE
 4

	)

81 
	#HAL_FLASH_PAGE_MAP
 0x8000

	)

84 
	#HAL_FLASH_IEEE_SIZE
 8

	)

85 
	#HAL_FLASH_LOCK_BITS
 16

	)

86 
	#HAL_FLASH_IEEE_PAGE
 127

	)

87 
	#HAL_FLASH_IEEE_OSET
 (
HAL_FLASH_PAGE_SIZE
 - 
HAL_FLASH_LOCK_BITS
 - 
HAL_FLASH_IEEE_SIZE
)

	)

88 
	#HAL_INFOP_IEEE_OSET
 0xC

	)

90 
	#HAL_NV_DMA_CH
 0

	)

91 
	#HAL_NV_DMA_GET_DESC
(Ë
	`HAL_DMA_GET_DESC0
()

	)

92 
	#HAL_NV_DMA_SET_ADDR
(
a
Ë
	`HAL_DMA_SET_ADDR_DESC0
(◊))

	)

99 
	#PREFETCH_ENABLE
(Ë
	`°
–
FCTL
 = 0x08; )

	)

100 
	#PREFETCH_DISABLE
(Ë
	`°
–
FCTL
 = 0x04; )

	)

102 
	#HAL_BOARD_INIT
() \

104 
IEN0
 = 0; \

105 
IEN1
 = 0; \

106 
IEN2
 = 0; \

108 
CLKCONCMD
 = 0x80; \

111 
	`PREFETCH_ENABLE
(); \

112 }

	)

117 
	#VDD_2_0
 74

118 

	)

119 
	#VDD_MIN_RUN
 
VDD_2_0


	)

120 
	#VDD_MIN_NV
 (
VDD_2_0
+4)

121 

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_board_cfg_nano.h

42 #i‚de‡
HAL_BOARD_CFG_NANO_H


43 
	#HAL_BOARD_CFG_NANO_H


	)

50 
	~"hÆ_mcu.h
"

57 
	#OSC32K_CRYSTAL_INSTALLED
 
FALSE


	)

60 #i‡!
deföed
 (
OSC32K_CRYSTAL_INSTALLED
Ë|| (deföed (OSC32K_CRYSTAL_INSTALLEDË&& (OSC32K_CRYSTAL_INSTALLED =
TRUE
))

61 
	#OSC_32KHZ
 0x00

	)

63 
	#OSC_32KHZ
 0x80

	)

72 
	#HAL_FLASH_PAGE_PER_BANK
 16

	)

74 
	#HAL_FLASH_PAGE_SIZE
 2048

	)

75 
	#HAL_FLASH_WORD_SIZE
 4

	)

78 
	#HAL_FLASH_PAGE_MAP
 0x8000

	)

81 
	#HAL_FLASH_IEEE_SIZE
 8

	)

82 
	#HAL_FLASH_LOCK_BITS
 16

	)

83 
	#HAL_FLASH_IEEE_PAGE
 127

	)

84 
	#HAL_FLASH_IEEE_OSET
 (
HAL_FLASH_PAGE_SIZE
 - 
HAL_FLASH_LOCK_BITS
 - 
HAL_FLASH_IEEE_SIZE
)

	)

85 
	#HAL_INFOP_IEEE_OSET
 0xC

	)

87 
	#HAL_NV_DMA_CH
 0

	)

88 
	#HAL_NV_DMA_GET_DESC
(Ë
	`HAL_DMA_GET_DESC0
()

	)

89 
	#HAL_NV_DMA_SET_ADDR
(
a
Ë
	`HAL_DMA_SET_ADDR_DESC0
(◊))

	)

96 
	#PREFETCH_ENABLE
(Ë
	`°
–
FCTL
 = 0x08; )

	)

97 
	#PREFETCH_DISABLE
(Ë
	`°
–
FCTL
 = 0x04; )

	)

99 
	#HAL_BOARD_INIT
() \

101 
IEN0
 = 0; \

102 
IEN1
 = 0; \

103 
IEN2
 = 0; \

105 
CLKCONCMD
 = 0x80; \

108 
	`PREFETCH_ENABLE
(); \

109 
	`MCU_IO_INPUT_P0_PULLDOWN
(0,0); \

110 
	`MCU_IO_INPUT_P0_PULLDOWN
(0,1); \

111 
	`MCU_IO_INPUT_P0_PULLDOWN
(0,2); \

112 
	`MCU_IO_INPUT_P0_PULLDOWN
(0,3); \

113 
	`MCU_IO_INPUT_P0_PULLDOWN
(0,4); \

114 
	`MCU_IO_INPUT_P0_PULLDOWN
(0,5); \

115 
	`MCU_IO_INPUT_P0_PULLDOWN
(0,6); \

116 
	`MCU_IO_INPUT_P0_PULLDOWN
(0,7); \

118 
	`MCU_IO_INPUT_P1_PULLDOWN
(1,1); \

119 
	`MCU_IO_INPUT_P1_PULLDOWN
(1,2); \

120 
	`MCU_IO_INPUT_P1_PULLDOWN
(1,3); \

121 
	`MCU_IO_INPUT_P1_PULLDOWN
(1,4); \

122 
	`MCU_IO_INPUT_P1_PULLDOWN
(1,5); \

123 
	`MCU_IO_INPUT_P1_PULLDOWN
(1,6); \

124 
	`MCU_IO_INPUT_P1_PULLDOWN
(1,7); \

126 
	`MCU_IO_INPUT_P2_PULLDOWN
(2,3); \

127 
	`MCU_IO_INPUT_P2_PULLDOWN
(2,4); \

128 
P2INP
 |= 0x6; \

129 }

	)

131 
	#MCU_IO_INPUT_P0_PULLDOWN
(
p‹t
, 
pö
Ë
	`°
–
P0SEL
 &~
	`BV
(pin); \

132 
P0DIR
 &~
	`BV
(
pö
); \

133 
P0INP
 &~
	`BV
(
pö
); \

134 
P2INP
 |
	`BV
(
p‹t
 + 5); \

135 )

	)

136 
	#MCU_IO_INPUT_P1_PULLDOWN
(
p‹t
, 
pö
Ë
	`°
–
P1SEL
 &~
	`BV
(pin); \

137 
P1DIR
 &~
	`BV
(
pö
); \

138 
P1INP
 &~
	`BV
(
pö
); \

139 
P2INP
 |
	`BV
(
p‹t
 + 5); \

140 )

	)

141 
	#MCU_IO_INPUT_P2_PULLDOWN
(
p‹t
, 
pö
Ë
	`°
–
P2SEL
 &~
	`BV
(pin); \

142 
P2DIR
 &~
	`BV
(
pö
); \

143 
P2INP
 &~
	`BV
(
pö
); \

144 
P2INP
 |
	`BV
(
p‹t
 + 5); \

145 )

	)

150 
	#VDD_2_0
 74

151 

	)

152 
	#VDD_MIN_RUN
 
VDD_2_0


	)

153 
	#VDD_MIN_NV
 (
VDD_2_0
+4)

154 
	#VDD_MIN_XNV
 (
VDD_2_7
+5)

155 

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_defs.h

40 #i‚de‡
HAL_DEFS_H


41 
	#HAL_DEFS_H


	)

49 #i‚de‡
BV


50 
	#BV
(
n
Ë(1 << (n))

	)

53 #i‚de‡
BF


54 
	#BF
(
x
,
b
,
s
Ë(((xË& (b)Ë>> (s))

	)

57 #i‚de‡
MIN


58 
	#MIN
(
n
,
m
Ë((“Ë< (m)Ë? (nË: (m))

	)

61 #i‚de‡
MAX


62 
	#MAX
(
n
,
m
Ë((“Ë< (m)Ë? (mË: (n))

	)

65 #i‚de‡
ABS


66 
	#ABS
(
n
Ë((“Ë< 0Ë? -“Ë: (n))

	)

71 
	#BREAK_UINT32
–
v¨
, 
ByãNum
 ) \

72 (
uöt8
)((
uöt32
)(((
v¨
Ë>>((
ByãNum
Ë* 8)Ë& 0x00FF))

	)

74 
	#BUILD_UINT32
(
Byã0
, 
Byã1
, 
Byã2
, 
Byã3
) \

75 ((
uöt32
)((uöt32)((
Byã0
) & 0x00FF) \

76 + ((
uöt32
)((
Byã1
) & 0x00FF) << 8) \

77 + ((
uöt32
)((
Byã2
) & 0x00FF) << 16) \

78 + ((
uöt32
)((
Byã3
Ë& 0x00FFË<< 24)))

	)

80 
	#BUILD_UINT16
(
loByã
, 
hiByã
) \

81 ((
uöt16
)(((
loByã
Ë& 0x00FFË+ (((
hiByã
Ë& 0x00FFË<< 8)))

	)

83 
	#HI_UINT16
(
a
Ë((◊Ë>> 8Ë& 0xFF)

	)

84 
	#LO_UINT16
(
a
Ë(◊Ë& 0xFF)

	)

86 
	#BUILD_UINT8
(
hiByã
, 
loByã
) \

87 ((
uöt8
)(((
loByã
Ë& 0x0FË+ (((
hiByã
Ë& 0x0FË<< 4)))

	)

89 
	#HI_UINT8
(
a
Ë((◊Ë>> 4Ë& 0x0F)

	)

90 
	#LO_UINT8
(
a
Ë(◊Ë& 0x0F)

	)

92 #i‚de‡
GET_BIT


93 
	#GET_BIT
(
DISCS
, 
IDX
Ë(((DISCS)[((IDXË/ 8)] & 
	`BV
((IDXË% 8)Ë? 
TRUE
 : 
FALSE
)

	)

95 #i‚de‡
SET_BIT


96 
	#SET_BIT
(
DISCS
, 
IDX
Ë(((DISCS)[((IDXË/ 8)] |
	`BV
((IDXË% 8)))

	)

98 #i‚de‡
CLR_BIT


99 
	#CLR_BIT
(
DISCS
, 
IDX
Ë(((DISCS)[((IDXË/ 8)] &(
	`BV
((IDXË% 8Ë^ 0xFF)))

	)

125 
	#°
(
x
Ëdÿ{ x } 
__LINE__
 =-1)

	)

130 #ifde‡
ccs


131 
	#ASM_NOP
 
	`asm
(" NOP")

	)

132 #ñi‡
deföed
 
rvmdk


133 
	#ASM_NOP
 
	`__n›
()

	)

135 
	#ASM_NOP
 
	`asm
("NOP")

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_dma.h

40 #i‚de‡
HAL_DMA_H


41 
	#HAL_DMA_H


	)

43 #ifde‡
__˝lu•lus


52 
	~"hÆ_bﬂrd.h
"

53 
	~"hÆ_ty≥s.h
"

59 
	#HAL_DMA_SET_ADDR_DESC0
–
a
 ) \

60 
	`°
( \

61 
DMA0CFGH
 = (
uöt8
)–(
uöt16
)(
a
) >> 8 ); \

62 
DMA0CFGL
 = (
uöt8
)–(
uöt16
)(
a
) & 0xFF ); \

63 )

	)

65 
	#HAL_DMA_SET_ADDR_DESC1234
–
a
 ) \

66 
	`°
( \

67 
DMA1CFGH
 = (
uöt8
)–(
uöt16
)(
a
) >> 8 ); \

68 
DMA1CFGL
 = (
uöt8
)–(
uöt16
)(
a
) & 0xFF ); \

69 )

	)

71 
	#HAL_DMA_GET_DESC0
(Ë&
dmaCh0


	)

73 
	#HAL_DMA_GET_DESC1234
–
a
 ) (
dmaCh1234
+(◊)-1))

	)

75 
	#HAL_DMA_ARM_CH
–
ch
 ) 
DMAARM
 = (0x01 << (ch))

	)

77 
	#HAL_DMA_CH_ARMED
–
ch
 ) (
DMAARM
 & (0x01 << (ch)))

	)

79 
	#HAL_DMA_ABORT_CH
–
ch
 ) 
DMAARM
 = (0x80 | (0x01 << (ch)))

	)

80 
	#HAL_DMA_MAN_TRIGGER
–
ch
 ) 
DMAREQ
 = (0x01 << (ch))

	)

81 
	#HAL_DMA_START_CH
–
ch
 ) 
	`HAL_DMA_MAN_TRIGGER
–(chË)

	)

83 
	#HAL_DMA_CLEAR_IRQ
–
ch
 ) 
DMAIRQ
 = ((0x01 << (ch)Ë^ 0xFF)

	)

85 
	#HAL_DMA_CHECK_IRQ
–
ch
 ) (
DMAIRQ
 & (0x01 << (ch)))

	)

88 
	#HAL_DMA_SET_SOURCE
–
pDesc
, 
§c
 ) \

89 
	`°
( \

90 
pDesc
->
§cAddrH
 = (
uöt8
)–(
uöt16
)(
§c
) >> 8 ); \

91 
pDesc
->
§cAddrL
 = (
uöt8
)–(
uöt16
)(
§c
) & 0xFF ); \

92 )

	)

95 
	#HAL_DMA_SET_DEST
–
pDesc
, 
d°
 ) \

96 
	`°
( \

97 
pDesc
->
d°AddrH
 = (
uöt8
)–(
uöt16
)(
d°
) >> 8 ); \

98 
pDesc
->
d°AddrL
 = (
uöt8
)–(
uöt16
)(
d°
) & 0xFF ); \

99 )

	)

103 
	#HAL_DMA_SET_LEN
–
pDesc
, 
Àn
 ) \

104 
	`°
( \

105 
pDesc
->
x„rLíL
 = (
uöt8
)–(
uöt16
)(
Àn
) & 0xFF); \

106 
pDesc
->
x„rLíV
 &~
HAL_DMA_LEN_H
; \

107 
pDesc
->
x„rLíV
 |(
uöt8
)((
uöt16
)(
Àn
) >> 8); \

108 )

	)

110 
	#HAL_DMA_GET_LEN
–
pDesc
 ) \

111 (((
uöt16
)(
pDesc
->
x„rLíV
 & 
HAL_DMA_LEN_H
Ë<< 8Ë|ÖDesc->
x„rLíL
)

	)

113 
	#HAL_DMA_SET_VLEN
–
pDesc
, 
vMode
 ) \

114 
	`°
( \

115 
pDesc
->
x„rLíV
 &~
HAL_DMA_LEN_V
; \

116 
pDesc
->
x„rLíV
 |(
vMode
 << 5); \

117 )

	)

119 
	#HAL_DMA_SET_WORD_SIZE
–
pDesc
, 
xSz
 ) \

120 
	`°
( \

121 
pDesc
->
˘æA
 &~
HAL_DMA_WORD_SIZE
; \

122 
pDesc
->
˘æA
 |(
xSz
 << 7); \

123 )

	)

125 
	#HAL_DMA_SET_TRIG_MODE
–
pDesc
, 
tMode
 ) \

126 
	`°
( \

127 
pDesc
->
˘æA
 &~
HAL_DMA_TRIG_MODE
; \

128 
pDesc
->
˘æA
 |(
tMode
 << 5); \

129 )

	)

131 
	#HAL_DMA_GET_TRIG_MODE
–
pDesc
 ) (’Desc->
˘æA
 >> 5Ë& 0x3)

	)

133 
	#HAL_DMA_SET_TRIG_SRC
–
pDesc
, 
tSrc
 ) \

134 
	`°
( \

135 
pDesc
->
˘æA
 &~
HAL_DMA_TRIG_SRC
; \

136 
pDesc
->
˘æA
 |
tSrc
; \

137 )

	)

139 
	#HAL_DMA_SET_SRC_INC
–
pDesc
, 
§cInc
 ) \

140 
	`°
( \

141 
pDesc
->
˘æB
 &~
HAL_DMA_SRC_INC
; \

142 
pDesc
->
˘æB
 |(
§cInc
 << 6); \

143 )

	)

145 
	#HAL_DMA_SET_DST_INC
–
pDesc
, 
d°Inc
 ) \

146 
	`°
( \

147 
pDesc
->
˘æB
 &~
HAL_DMA_DST_INC
; \

148 
pDesc
->
˘æB
 |(
d°Inc
 << 4); \

149 )

	)

151 
	#HAL_DMA_SET_IRQ
–
pDesc
, 
íabÀ
 ) \

152 
	`°
( \

153 
pDesc
->
˘æB
 &~
HAL_DMA_IRQ_MASK
; \

154 
pDesc
->
˘æB
 |(
íabÀ
 << 3); \

155 )

	)

157 
	#HAL_DMA_SET_M8
–
pDesc
, 
m8
 ) \

158 
	`°
( \

159 
pDesc
->
˘æB
 &~
HAL_DMA_M8
; \

160 
pDesc
->
˘æB
 |(
m8
 << 2); \

161 )

	)

163 
	#HAL_DMA_SET_PRIORITY
–
pDesc
, 
¥i
 ) \

164 
	`°
( \

165 
pDesc
->
˘æB
 &~
HAL_DMA_PRIORITY
; \

166 
pDesc
->
˘æB
 |
¥i
; \

167 )

	)

174 
	#HAL_DMA_VLEN_USE_LEN
 0x00

	)

176 
	#HAL_DMA_VLEN_1_P_VALOFFIRST
 0x01

	)

178 
	#HAL_DMA_VLEN_VALOFFIRST
 0x02

	)

180 
	#HAL_DMA_VLEN_1_P_VALOFFIRST_P_1
 0x03

	)

182 
	#HAL_DMA_VLEN_1_P_VALOFFIRST_P_2
 0x04

	)

184 
	#HAL_DMA_WORDSIZE_BYTE
 0x00

	)

185 
	#HAL_DMA_WORDSIZE_WORD
 0x01

	)

187 
	#HAL_DMA_TMODE_SINGLE
 0x00

	)

188 
	#HAL_DMA_TMODE_BLOCK
 0x01

	)

189 
	#HAL_DMA_TMODE_SINGLE_REPEATED
 0x02

	)

190 
	#HAL_DMA_TMODE_BLOCK_REPEATED
 0x03

	)

192 
	#HAL_DMA_TRIG_NONE
 0

	)

193 
	#HAL_DMA_TRIG_PREV
 1

	)

194 
	#HAL_DMA_TRIG_T1_CH0
 2

	)

195 
	#HAL_DMA_TRIG_T1_CH1
 3

	)

196 
	#HAL_DMA_TRIG_T1_CH2
 4

	)

197 
	#HAL_DMA_TRIG_T2_COMP
 5

	)

198 
	#HAL_DMA_TRIG_T2_OVFL
 6

	)

199 
	#HAL_DMA_TRIG_T3_CH0
 7

	)

200 
	#HAL_DMA_TRIG_T3_CH1
 8

	)

201 
	#HAL_DMA_TRIG_T4_CH0
 9

	)

202 
	#HAL_DMA_TRIG_T4_CH1
 10

	)

203 
	#HAL_DMA_TRIG_ST
 11

	)

204 
	#HAL_DMA_TRIG_IOC_0
 12

	)

205 
	#HAL_DMA_TRIG_IOC_1
 13

	)

206 
	#HAL_DMA_TRIG_URX0
 14

	)

207 
	#HAL_DMA_TRIG_UTX0
 15

	)

208 
	#HAL_DMA_TRIG_URX1
 16

	)

209 
	#HAL_DMA_TRIG_UTX1
 17

	)

210 
	#HAL_DMA_TRIG_FLASH
 18

	)

211 
	#HAL_DMA_TRIG_RADIO
 19

	)

212 
	#HAL_DMA_TRIG_ADC_CHALL
 20

	)

213 
	#HAL_DMA_TRIG_ADC_CH0
 21

	)

214 
	#HAL_DMA_TRIG_ADC_CH1
 22

	)

215 
	#HAL_DMA_TRIG_ADC_CH2
 23

	)

216 
	#HAL_DMA_TRIG_ADC_CH3
 24

	)

217 
	#HAL_DMA_TRIG_ADC_CH4
 25

	)

218 
	#HAL_DMA_TRIG_ADC_CH5
 26

	)

219 
	#HAL_DMA_TRIG_ADC_CH6
 27

	)

220 
	#HAL_DMA_TRIG_ADC_CH7
 28

	)

221 
	#HAL_DMA_TRIG_ENC_DW
 29

	)

222 
	#HAL_DMA_TRIG_ENC_UP
 30

	)

224 
	#HAL_DMA_SRCINC_0
 0x00

	)

225 
	#HAL_DMA_SRCINC_1
 0x01

	)

226 
	#HAL_DMA_SRCINC_2
 0x02

	)

227 
	#HAL_DMA_SRCINC_M1
 0x03

	)

229 
	#HAL_DMA_DSTINC_0
 0x00

	)

230 
	#HAL_DMA_DSTINC_1
 0x01

	)

231 
	#HAL_DMA_DSTINC_2
 0x02

	)

232 
	#HAL_DMA_DSTINC_M1
 0x03

	)

234 
	#HAL_DMA_IRQMASK_DISABLE
 0x00

	)

235 
	#HAL_DMA_IRQMASK_ENABLE
 0x01

	)

237 
	#HAL_DMA_M8_USE_8_BITS
 0x00

	)

238 
	#HAL_DMA_M8_USE_7_BITS
 0x01

	)

240 
	#HAL_DMA_PRI_LOW
 0x00

	)

241 
	#HAL_DMA_PRI_GUARANTEED
 0x01

	)

242 
	#HAL_DMA_PRI_HIGH
 0x02

	)

243 
	#HAL_DMA_PRI_ABSOLUTE
 0x03

	)

245 
	#HAL_DMA_MAX_ARM_CLOCKS
 45

246 

	)

252 
	#HAL_DMA_LEN_V
 0xE0

	)

253 
	#HAL_DMA_LEN_H
 0x1F

	)

256 
	#HAL_DMA_WORD_SIZE
 0x80

	)

257 
	#HAL_DMA_TRIG_MODE
 0x60

	)

258 
	#HAL_DMA_TRIG_SRC
 0x1F

	)

261 
	#HAL_DMA_SRC_INC
 0xC0

	)

262 
	#HAL_DMA_DST_INC
 0x30

	)

263 
	#HAL_DMA_IRQ_MASK
 0x08

	)

264 
	#HAL_DMA_M8
 0x04

	)

265 
	#HAL_DMA_PRIORITY
 0x03

	)

268 
uöt8
 
§cAddrH
;

269 
uöt8
 
§cAddrL
;

270 
uöt8
 
d°AddrH
;

271 
uöt8
 
d°AddrL
;

272 
uöt8
 
x„rLíV
;

273 
uöt8
 
x„rLíL
;

274 
uöt8
 
˘æA
;

275 
uöt8
 
˘æB
;

276 } 
	thÆDMADesc_t
;

282 
hÆDMADesc_t
 
dmaCh0
;

283 
hÆDMADesc_t
 
dmaCh1234
[4];

289 
HÆDmaInô
( );

291 #ifde‡
__˝lu•lus


	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_flash.c

45 
	~"hÆ_bﬂrd_cfg.h
"

46 
	~"hÆ_dma.h
"

47 
	~"hÆ_Êash.h
"

48 
	~"hÆ_mcu.h
"

49 
	~"hÆ_ty≥s.h
"

70 
	$HÆFœshRód
(
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
buf
, uöt16 
˙t
)

73 
uöt8
 *
pD©a
 = (uöt8 *)(
off£t
 + 
HAL_FLASH_PAGE_MAP
) +

74 ((
pg
 % 
HAL_FLASH_PAGE_PER_BANK
Ë* 
HAL_FLASH_PAGE_SIZE
);

75 
uöt8
 
mem˘r
 = 
MEMCTR
;

77 #i‡(!
deföed
 
HAL_OAD_BOOT_CODE
Ë&& (!deföed 
HAL_OTA_BOOT_CODE
)

78 
hÆI¡Sèã_t
 
is
;

81 
pg
 /
HAL_FLASH_PAGE_PER_BANK
;

83 #i‡(!
deföed
 
HAL_OAD_BOOT_CODE
Ë&& (!deföed 
HAL_OTA_BOOT_CODE
)

84 
	`HAL_ENTER_CRITICAL_SECTION
(
is
);

88 
MEMCTR
 = (MEMCTR & 0xF8Ë| 
pg
;

90 
˙t
--)

92 *
buf
++ = *
pD©a
++;

95 
MEMCTR
 = 
mem˘r
;

97 #i‡(!
deföed
 
HAL_OAD_BOOT_CODE
Ë&& (!deföed 
HAL_OTA_BOOT_CODE
)

98 
	`HAL_EXIT_CRITICAL_SECTION
(
is
);

100 
	}
}

120 
	$HÆFœshWrôe
(
uöt16
 
addr
, 
uöt8
 *
buf
, uöt16 
˙t
)

122 
hÆDMADesc_t
 *
ch
 = 
	`HAL_NV_DMA_GET_DESC
();

124 
	`HAL_DMA_SET_SOURCE
(
ch
, 
buf
);

125 
	`HAL_DMA_SET_DEST
(
ch
, &
FWDATA
);

126 
	`HAL_DMA_SET_VLEN
(
ch
, 
HAL_DMA_VLEN_USE_LEN
);

127 
	`HAL_DMA_SET_LEN
(
ch
, (
˙t
 * 
HAL_FLASH_WORD_SIZE
));

128 
	`HAL_DMA_SET_WORD_SIZE
(
ch
, 
HAL_DMA_WORDSIZE_BYTE
);

129 
	`HAL_DMA_SET_TRIG_MODE
(
ch
, 
HAL_DMA_TMODE_SINGLE
);

130 
	`HAL_DMA_SET_TRIG_SRC
(
ch
, 
HAL_DMA_TRIG_FLASH
);

131 
	`HAL_DMA_SET_SRC_INC
(
ch
, 
HAL_DMA_SRCINC_1
);

132 
	`HAL_DMA_SET_DST_INC
(
ch
, 
HAL_DMA_DSTINC_0
);

134 
	`HAL_DMA_SET_IRQ
(
ch
, 
HAL_DMA_IRQMASK_DISABLE
);

135 
	`HAL_DMA_SET_M8
–
ch
, 
HAL_DMA_M8_USE_8_BITS
);

136 
	`HAL_DMA_SET_PRIORITY
(
ch
, 
HAL_DMA_PRI_HIGH
);

137 
	`HAL_DMA_CLEAR_IRQ
(
HAL_NV_DMA_CH
);

138 
	`HAL_DMA_ARM_CH
(
HAL_NV_DMA_CH
);

140 
FADDRL
 = (
uöt8
)
addr
;

141 
FADDRH
 = (
uöt8
)(
addr
 >> 8);

142 
FCTL
 |= 0x02;

143 
FCTL
 & 0x80);

144 
	}
}

162 
	$HÆFœshEø£
(
uöt8
 
pg
)

164 
FADDRH
 = 
pg
 * (
HAL_FLASH_PAGE_SIZE
 / 
HAL_FLASH_WORD_SIZE
 / 256);

165 
FCTL
 |= 0x01;

166 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_flash.h

40 #i‚de‡
HAL_FLASH_H


41 
	#HAL_FLASH_H


	)

43 #ifde‡
__˝lu•lus


53 
	~"hÆ_bﬂrd.h
"

54 
	~"hÆ_ty≥s.h
"

75 
HÆFœshRód
(
uöt8
 
pg
, 
uöt16
 
off£t
, uöt8 *
buf
, uöt16 
˙t
);

95 
HÆFœshWrôe
(
uöt16
 
addr
, 
uöt8
 *
buf
, uöt16 
˙t
);

113 
HÆFœshEø£
(
uöt8
 
pg
);

115 #ifde‡
__˝lu•lus


	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_mcu.h

40 #i‚de‡
_HAL_MCU_H


41 
	#_HAL_MCU_H


	)

53 
	~"hÆ_defs.h
"

54 
	~"hÆ_ty≥s.h
"

61 
	#HAL_MCU_CC2530


	)

70 #ifde‡
__IAR_SYSTEMS_ICC__


71 
	~<ioCC2530.h
>

72 
	#HAL_COMPILER_IAR


	)

73 
	#HAL_MCU_LITTLE_ENDIAN
(Ë
__LITTLE_ENDIAN__


	)

74 
	#_PRAGMA
(
x
Ë
	`_Pøgma
(#x)

	)

75 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

76 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`_PRAGMA
(
ve˘‹
=vË
__√¨_func
 
__öãºu±
 
	`f
()

	)

77 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

80 #ñi‡
deföed
 
__KEIL__


81 
	~<CC2530.h
>

82 
	#HAL_COMPILER_KEIL


	)

83 
	#HAL_MCU_LITTLE_ENDIAN
(Ë0

	)

84 
	#HAL_ISR_FUNC_DECLARATION
(
f
,
v
Ë
	`f
(Ë
öãºu±
 
	)
v

85 
	#HAL_ISR_FUNC_PROTOTYPE
(
f
,
v
Ë
	`f
()

	)

86 
	#HAL_ISR_FUNCTION
(
f
,
v
Ë
	`HAL_ISR_FUNC_PROTOTYPE
(f,v); 
	`HAL_ISR_FUNC_DECLARATION
(f,v)

	)

98 
	#HAL_ENABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 1; )

	)

99 
	#HAL_DISABLE_INTERRUPTS
(Ë
	`°
–
EA
 = 0; )

	)

100 
	#HAL_INTERRUPTS_ARE_ENABLED
(Ë(
EA
)

	)

102 
	thÆI¡Sèã_t
;

103 
	#HAL_ENTER_CRITICAL_SECTION
(
x
Ë
	`°
–x = 
EA
; 
	`HAL_DISABLE_INTERRUPTS
(); )

	)

104 
	#HAL_EXIT_CRITICAL_SECTION
(
x
Ë
	`°
–
EA
 = x; )

	)

105 
	#HAL_CRITICAL_STATEMENT
(
x
Ë
	`°
–
hÆI¡Sèã_t
 
_s
; 
	`HAL_ENTER_CRITICAL_SECTION
(_s); x; 
	`HAL_EXIT_CRITICAL_SECTION
(_s); )

	)

107 #ifde‡
__IAR_SYSTEMS_ICC__


113 
	#HAL_ENTER_ISR
(Ë{ 
hÆI¡Sèã_t
 
_i§I¡Sèã
 = 
EA
; 
	`HAL_ENABLE_INTERRUPTS
();

	)

114 
	#HAL_EXIT_ISR
(Ë
EA
 = 
_i§I¡Sèã
; }

	)

116 
	#HAL_ENTER_ISR
()

	)

117 
	#HAL_EXIT_ISR
()

	)

124 
	#WD_EN
 
	`BV
(3)

	)

125 
	#WD_MODE
 
	`BV
(2)

	)

126 
	#WD_INT_1900_USEC
 (
	`BV
(0Ë| BV(1))

	)

127 
	#WD_RESET1
 (0xA0 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

128 
	#WD_RESET2
 (0x50 | 
WD_EN
 | 
WD_INT_1900_USEC
)

	)

129 
	#WD_KICK
(Ë
	`°
–
WDCTL
 = (0xA0 | WDCTL & 0x0F); WDCTL = (0x50 | WDCTL & 0x0F); )

	)

132 
	#HAL_SYSTEM_RESET
(Ë
	`°
–
	`HAL_DISABLE_INTERRUPTS
(); 
WDCTL
 = 
WD_RESET1
; WDCTL = 
WD_RESET2
; ;;); )

	)

138 
	#REV_A
 0x00

	)

139 
	#REV_B
 0x11

	)

140 
	#REV_C
 0x20

	)

141 
	#REV_D
 0x21

	)

149 
	#PCON_IDLE
 
	`BV
(0Ë

	)

152 
	#OSC_PD
 
	`BV
(2Ë

	)

153 
	#PMODE
 (
	`BV
(1Ë| BV(0)Ë

	)

156 
	#XOSC_STB
 
	`BV
(6Ë

	)

157 
	#HFRC_STB
 
	`BV
(5Ë

	)

160 
	#OSC_PD
 
	`BV
(2Ë

	)

164 
	#OSC
 
	`BV
(6)

	)

165 
	#TICKSPD
(
x
Ë(x << 3)

	)

166 
	#CLKSPD
(
x
Ë(x << 0)

	)

167 
	#CLKCONCMD_32MHZ
 (0)

	)

168 
	#CLKCONCMD_16MHZ
 (
	`CLKSPD
(1Ë| 
	`TICKSPD
(1Ë| 
OSC
)

	)

171 
	#LDRDY
 
	`BV
(0Ë

	)

175 #ifde‡
POWER_SAVING


176 vﬁ©ûê
__d©a
 
uöt8
 
hÆSÀïPc⁄VÆue
;

181 
	#CLEAR_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 0; )

	)

182 
	#ALLOW_SLEEP_MODE
(Ë
	`°
–
hÆSÀïPc⁄VÆue
 = 
PCON_IDLE
; )

	)

184 
	#CLEAR_SLEEP_MODE
()

	)

185 
	#ALLOW_SLEEP_MODE
()

	)

188 
	#Re£tRós⁄
(Ë((
SLEEPSTA
 >> 3Ë& 0x03)

	)

189 
	#Re£tWasW©chDog
 ((
SLEEPSTA
 & 0x18Ë=0x10)

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_startup.c

42 
	~"hÆ_bﬂrd.h
"

43 
	~"hÆ_ty≥s.h
"

45 #ifde‡
__˝lu•lus


49 #¥agm®
œnguage
=
exãnded


54 #¥agm®
loˇti⁄
="CSTART"

59 #i‡(
__CODE_MODEL__
 == 2)

60 
__√¨_func
 
__roŸ
 

62 
__roŸ
 

64 
__low_Àvñ_öô
();

77 #i‡(
__CODE_MODEL__
 == 2)

78 
__√¨_func
 
__roŸ
 

80 
__roŸ
 

82 
__low_Àvñ_öô
()

88 
MEMCTR
 = (MEMCTR & 0xF8) | 0x07;

99 #¥agm®
œnguage
=

101 #ifde‡
__˝lu•lus


	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_types.h

40 #i‚de‡
_HAL_TYPES_H


41 
	#_HAL_TYPES_H


	)

49 sig√d 
	töt8
;

50 
	tuöt8
;

52 sig√d 
	töt16
;

53 
	tuöt16
;

55 sig√d 
	töt32
;

56 
	tuöt32
;

58 
	tboﬁ
;

60 
uöt8
 
	thÆD©aAlign_t
;

69 #ifde‡
__IAR_SYSTEMS_ICC__


70 
	#CODE
 
__code


	)

71 
	#XDATA
 
__xd©a


	)

72 
	#ASM_NOP
 
	`asm
("NOP")

	)

75 #ñi‡
deföed
 
__KEIL__


76 
	#CODE
 
code


	)

77 
	#XDATA
 
xd©a


	)

78 
	#ASM_NOP
 
	`__n›
()

	)

81 #ñi‡
__TI_COMPILER_VERSION


82 
	#ASM_NOP
 
	`asm
(" NOP")

	)

85 #ñi‡
deföed
 
__GCC__


86 
	#ASM_NOP
 
__asm__
 
	`__vﬁ©ûe__
 ("n›")

	)

89 #ñi‡
_MSC_VER


90 
	#ASM_NOP
 
__asm
 
NOP


	)

102 #i‚de‡
TRUE


103 
	#TRUE
 1

	)

106 #i‚de‡
FALSE


107 
	#FALSE
 0

	)

110 #i‚de‡
NULL


111 
	#NULL
 0

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/class_msd/usb_firmware_library_config.h

8 #i‚de‡
USBFIRMWARELIBRARYCONFIG_H


9 
	#USBFIRMWARELIBRARYCONFIG_H


10 

	)

26 
	#USB_SETUP_MAX_NUMBER_OF_INTERFACES
 5

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/class_msd/usb_firmware_library_headers.h

9 #i‚de‡
USB_FIRMWARE_LIBRARY_HEADERS_H


10 
	#USB_FIRMWARE_LIBRARY_HEADERS_H


	)

20 
	~"usb_fúmw¨e_libøry_c⁄fig.h
"

21 
	~"usb_des¸ùt‹.h
"

22 
	~"usb_des¸ùt‹_∑r£r.h
"

23 
	~"usb_öãºu±.h
"

24 
	~"usb_‰amew‹k.h
"

25 
	~"usb_ªg.h
"

26 
	~"usb_°™d¨d_ªque°s.h
"

27 
	~"usb_su•íd.h
"

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/class_msd/usb_msd.h

39 #i‚de‡
USB_MSD_H


40 
	#USB_MSD_H


	)

42 #ifde‡
__˝lu•lus


51 
	~"hÆ_ty≥s.h
"

60 
	#USB_MSD_FILENAME_MAX
 256

	)

82 
usb_msd_öô
();

99 
uöt8
 
usb_msd_pﬁl
();

116 
usb_msd_unöô
();

118 #ifde‡
__˝lu•lus


	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_descriptor.h

8 #i‚de‡
USBDESCRIPTOR_H


9 
	#USBDESCRIPTOR_H


	)

12 #i‚de‡
ASM_FILE


13 
	~"usb_‰amew‹k_°ru˘s.h
"

87 #ifde‡
EXTERN


88 #unde‡
EXTERN


90 #ifde‡
USBDESCRIPTORPARSER_C


91 
	#EXTERN


92 #ñ£

	)

93 
	#EXTERN
 

95 

	)

100 
	#EP0_PACKET_SIZE
 32

102 

	)

105 
	#DESC_TYPE_DEVICE
 0x01

106 
	#DESC_TYPE_CONFIG
 0x02

107 
	#DESC_TYPE_STRING
 0x03

108 
	#DESC_TYPE_INTERFACE
 0x04

109 
	#DESC_TYPE_ENDPOINT
 0x05

111 

	)

114 
	#DESC_TYPE_HID
 0x21

115 
	#DESC_TYPE_HIDREPORT
 0x22

117 

	)

120 
	#EP_ATTR_CTRL
 0x00

121 
	#EP_ATTR_ISO
 0x01

122 
	#EP_ATTR_BULK
 0x02

123 
	#EP_ATTR_INT
 0x03

124 
	#EP_ATTR_TYPE_BM
 0x03

127 

	)

129 #i‚de‡
ASM_FILE


136 
uöt8
 
__code
* c⁄° 
pUsbDescSèπ
;

137 
uöt8
 
__code
* c⁄° 
pUsbDescEnd
;

138 
DESC_LUT_INFO
 
__code
* c⁄° 
pUsbDescLut
;

139 
DESC_LUT_INFO
 
__code
* c⁄° 
pUsbDescLutEnd
;

140 
DBLBUF_LUT_INFO
 
__code
* c⁄° 
pUsbDblbufLut
;

141 
DBLBUF_LUT_INFO
 
__code
* c⁄° 
pUsbDblbufLutEnd
;

142 } 
	tUSB_DESCRIPTOR_MARKER
;

144 
USB_DESCRIPTOR_MARKER
 
__xd©a
 
usbDes¸ùt‹M¨kî
;

152 
__code
* 
usbDescSèπ
;

153 
__code
* 
usbDescEnd
;

154 
__code
* 
usbDescLut
;

155 
__code
* 
usbDescLutEnd
;

156 
__code
* 
usbDblbufLut
;

157 
__code
* 
usbDblbufLutEnd
;

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_descriptor_parser.c

11 
	#USBDESCRIPTORPARSER_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

13 
	~"hÆ_Êash.h
"

17 
USBDP_DATA
 
__xd©a
 
	gusbdpD©a
;

23 c⁄° 
uöt8
 
	gœnguageId
[4] = {

25 
DESC_TYPE_STRING
,

30 c⁄° 
uöt8
 
	gm™uÁ˘uªr
[36] = {

32 
DESC_TYPE_STRING
,

53 #i‡
deföed
 
HAL_SB_BOOT_CODE


54 c⁄° 
uöt8
 
	g¥odu˘
[36] = {

56 
DESC_TYPE_STRING
,

76 c⁄° 
uöt8
 
	g¥odu˘
[36] = {

78 
DESC_TYPE_STRING
,

100 
uöt8
 
	g£rülNumbî
[42] = {

102 
DESC_TYPE_STRING
,

110 c⁄° 
uöt8
 
	ghexDigô
[16] = {

117 
	$usbdpInô
()

119 
usbdpD©a
.
pDesc
 = (c⁄° 
uöt8
 
__code
 *Ë
usbDes¸ùt‹M¨kî
.
pUsbDescSèπ
;

120 
	}
}

147 
__code
* 
	$usbdpFödNext
(
uöt8
 
w™ãdTy≥
, uöt8 
hÆtAtTy≥
)

149 
__code
 *
pResu…
;

150 
pResu…
 = 
NULL
;

153 
usbdpD©a
.
pDesc
 !(
__code
 *Ë
usbDes¸ùt‹M¨kî
.
pUsbDescEnd
) {

156 i‡(
usbdpD©a
.
pDesc
[
DESC_TYPE_IDX
] =
w™ãdTy≥
) {

157 
pResu…
 = (
__code
*Ë
usbdpD©a
.
pDesc
;

158 
usbdpD©a
.
pDesc
 +usbdpD©a.pDesc[
DESC_LENGTH_IDX
];

162 } i‡(
usbdpD©a
.
pDesc
[
DESC_TYPE_IDX
] =
hÆtAtTy≥
) {

163 i‡(
hÆtAtTy≥
) ;

167 
usbdpD©a
.
pDesc
 +usbdpD©a.pDesc[
DESC_LENGTH_IDX
];

170  
pResu…
;

171 
	}
}

183 
USB_DEVICE_DESCRIPTOR
 
__code
* 
	$usbdpGëDevi˚Desc
()

185 
	`usbdpInô
();

186  
	`usbdpFödNext
(
DESC_TYPE_DEVICE
, 0);

187 
	}
}

209 
USB_CONFIGURATION_DESCRIPTOR
 
__code
* 
	$usbdpGëC⁄figuøti⁄Desc
(
uöt8
 
cfgVÆue
, uöt8 
cfgIndex
)

211 
USB_CONFIGURATION_DESCRIPTOR
 
__code
 *
pC⁄figuøti⁄Desc
;

212 
	`usbdpInô
();

215 
pC⁄figuøti⁄Desc
 = 
	`usbdpFödNext
(
DESC_TYPE_CONFIG
, 0)) {

218 i‡(
cfgVÆue
) {

219 i‡(
cfgVÆue
 =
pC⁄figuøti⁄Desc
->
bC⁄figuøti⁄VÆue
) ;

222 } i‡(!
cfgIndex
--) {

227  
pC⁄figuøti⁄Desc
;

228 
	}
}

251 
USB_INTERFACE_DESCRIPTOR
 
__code
* 
	$usbdpGëI¡îÁ˚Desc
(
uöt8
 
cfgVÆue
, uöt8 
ötNumbî
, uöt8 
ÆtSëtög
)

253 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚Desc
;

256 
	`usbdpGëC⁄figuøti⁄Desc
(
cfgVÆue
, 0);

259 
pI¡îÁ˚Desc
 = 
	`usbdpFödNext
(
DESC_TYPE_INTERFACE
, 
DESC_TYPE_CONFIG
)) {

260 i‡((
pI¡îÁ˚Desc
->
bI¡îÁ˚Numbî
 =
ötNumbî
Ë&& (pI¡îÁ˚Desc->
bA…î«ãSëtög
 =
ÆtSëtög
)) {

265  
pI¡îÁ˚Desc
;

266 
	}
}

281 
USB_STRING_DESCRIPTOR
* 
	$usbdpGëSåögDesc
(
uöt8
 
°rIndex
)

283 
USB_STRING_DESCRIPTOR
 *
pSåögDesc
 = 
NULL
;

285 #ifde‡
MS_EXT_C_ID


298 
°rIndex
)

301 
pSåögDesc
 = (
USB_STRING_DESCRIPTOR
 *)
œnguageId
;

305 
pSåögDesc
 = (
USB_STRING_DESCRIPTOR
 *)
m™uÁ˘uªr
;

309 
pSåögDesc
 = (
USB_STRING_DESCRIPTOR
 *)
¥odu˘
;

313 i‡(
£rülNumbî
[0] == 0)

315 #i‡(
deföed
 
HAL_SB_BOOT_CODE
 || deföed 
CC253X_MACNP
 || deföed 
CC2531DK
)

316 
	~<°rög.h
>

317 
uöt8
 
aExãndedAddªss
[
HAL_FLASH_IEEE_SIZE
] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};

336 
uöt8
 
idx
 = (
£rülNumbî
)-2, 
˙t
=0; c¡ < 
HAL_FLASH_IEEE_SIZE
; cnt++, idx -= 4)

338 
£rülNumbî
[
idx
] = 
hexDigô
[
aExãndedAddªss
[
˙t
] & 0x0F];

339 
£rülNumbî
[
idx
-2] = 
hexDigô
[
aExãndedAddªss
[
˙t
] / 16];

341 
£rülNumbî
[0] = (serialNumber);

343 
pSåögDesc
 = (
USB_STRING_DESCRIPTOR
 *)
£rülNumbî
;

351  
pSåögDesc
;

352 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_descriptor_parser.h

9 #i‚de‡
USBDESCRIPTORPARSER_H


10 
	#USBDESCRIPTORPARSER_H


	)

56 
	~"usb_des¸ùt‹.h
"

65 
	#DESC_LENGTH_IDX
 0

66 
	#DESC_TYPE_IDX
 1

67 
	#DESC_CONFIG_LENGTH_LSB_IDX
 2

68 
	#DESC_CONFIG_LENGTH_MSB_IDX
 3

71 

	)

75 
usbdpInô
();

76 
__code
 *
usbdpFödNext
(
uöt8
 
w™ãdTy≥
, uöt8 
hÆtAtTy≥
);

78 
USB_DEVICE_DESCRIPTOR
 
__code
* 
usbdpGëDevi˚Desc
();

79 
USB_CONFIGURATION_DESCRIPTOR
 
__code
* 
usbdpGëC⁄figuøti⁄Desc
(
uöt8
 
cfgVÆue
, uöt8 
cfgIndex
);

80 
USB_INTERFACE_DESCRIPTOR
 
__code
* 
usbdpGëI¡îÁ˚Desc
(
uöt8
 
cfgVÆue
, uöt8 
ötNumbî
, uöt8 
ÆtSëtög
);

81 
USB_STRING_DESCRIPTOR
* 
usbdpGëSåögDesc
(
uöt8
 
°rIndex
);

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_framework.c

11 
	#USBFRAMEWORK_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

13 
	~"usb_bﬂrd_cfg.h
"

16 
VFPTR
 
__d©a
 
	gPro˚ssFunc
;

25 
	$usbfwInô
()

28 
usbfwD©a
.
£lfPowîed
 = (
	`usbdpGëC⁄figuøti⁄Desc
(1, 0)->
bmAâribuãs
 & 0x40Ë? 
TRUE
 : 
FALSE
;

29 
usbfwD©a
.
ªmŸeWakeup
 = 
FALSE
;

31 
	`HAL_USB_ENABLE
();

34 
	`HAL_USB_RESUME_INT_ENABLE
();

36 
	}
}

48 
	$usbfwRe£tH™dÀr
()

52 
usbfwD©a
.
usbSèã
 = 
DEV_DEFAULT
;

53 
usbfwD©a
.
c⁄figuøti⁄VÆue
 = 0;

56 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

57 
	`usbfwSëAŒEpSètus
(
EP_HALT
);

60 
Pro˚ssFunc
 = 
NULL
;

62 
	}
}

77 
	$usbfwSëupH™dÀr
()

79 
uöt8
 
c⁄åﬁReg
;

80 
uöt8
 
byãsNow
;

81 
uöt8
 
ﬁdEndpoöt
;

84 
ﬁdEndpoöt
 = 
	`USBFW_GET_SELECTED_ENDPOINT
();

85 
	`USBFW_SELECT_ENDPOINT
(0);

86 
c⁄åﬁReg
 = 
USBCS0
;

89 i‡(
c⁄åﬁReg
 & 
USBCS0_SETUP_END
) {

90 
USBCS0
 = 
USBCS0_CLR_SETUP_END
;

91 
usbfwD©a
.
ï0Sètus
 = 
EP_CANCEL
;

92 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

93 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

97 i‡(
c⁄åﬁReg
 & 
USBCS0_SENT_STALL
) {

98 
USBCS0
 = 0x00;

99 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

103 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_RX
) {

106 
byãsNow
 = 
USBCNT0
;

107 
	`usbfwRódFifo
(&
USBF0
, 
byãsNow
, 
usbSëupD©a
.
pBuf„r
);

108 
usbSëupD©a
.
byãsLe·
 -
byãsNow
;

109 
usbSëupD©a
.
pBuf„r
 +
byãsNow
;

112 
USBCS0
 = 
usbSëupD©a
.
byãsLe·
 ? 
USBCS0_CLR_OUTPKT_RDY
 : (USBCS0_CLR_OUTPKT_RDY | 
USBCS0_DATA_END
);

115 i‡(
usbSëupD©a
.
byãsLe·
 == 0) {

116 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

117 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

121 
	`USBFW_SELECT_ENDPOINT
(
ﬁdEndpoöt
);

125 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_MANUAL_RX
) {

126 
	`Pro˚ssFunc
();

130 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_IDLE
) {

131 i‡(
c⁄åﬁReg
 & 
USBCS0_OUTPKT_RDY
) {

132 
	`usbfwRódFifo
(&
USBF0
, 8, (
uöt8
 
__xd©a
 *Ë&
usbSëupHódî
);

135 
Pro˚ssFunc
 = 
NULL
;

136 
usbSëupHódî
.
ªque°Ty≥
 & (
RT_MASK_TYPE
 | 
RT_MASK_DIR
)) {

139 
RT_STD_OUT
:

140 
usbSëupHódî
.
ªque°
) {

141 
SET_ADDRESS
: 
	`usb§SëAddªss
(); ;

142 
SET_FEATURE
: 
	`usb§SëFótuª
(); ;

143 
CLEAR_FEATURE
: 
	`usb§CÀ¨Fótuª
(); ;

144 
SET_CONFIGURATION
: 
	`usb§SëC⁄figuøti⁄
(); ;

145 
SET_INTERFACE
: 
	`usb§SëI¡îÁ˚
(); ;

146 
SET_DESCRIPTOR
:

147 : 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; ;

152 
RT_STD_IN
:

153 
usbSëupHódî
.
ªque°
) {

154 
GET_STATUS
: 
	`usb§GëSètus
(); ;

155 
GET_DESCRIPTOR
: 
	`usb§GëDes¸ùt‹
(); ;

156 
GET_CONFIGURATION
: 
	`usb§GëC⁄figuøti⁄
(); ;

157 
GET_INTERFACE
: 
	`usb§GëI¡îÁ˚
(); ;

158 
SYNCH_FRAME
:

159 : 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
; ;

164 
RT_VEND_OUT
:

165 
Pro˚ssFunc
 = 
usbvrHookPro˚ssOut
; 
	`usbvrHookPro˚ssOut
();

167 
RT_VEND_IN
:

168 
Pro˚ssFunc
 = 
usbvrHookPro˚ssIn
; 
	`usbvrHookPro˚ssIn
();

172 
RT_CLASS_OUT
:

173 
Pro˚ssFunc
 = 
usb¸HookPro˚ssOut
; 
	`usb¸HookPro˚ssOut
();

175 
RT_CLASS_IN
:

176 
Pro˚ssFunc
 = 
usb¸HookPro˚ssIn
; 
	`usb¸HookPro˚ssIn
();

181 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

186 
USBCS0
 = (
usbfwD©a
.
ï0Sètus
 =
EP_STALL
Ë? (
USBCS0_CLR_OUTPKT_RDY
 | 
USBCS0_SEND_STALL
) : USBCS0_CLR_OUTPKT_RDY;

191 i‡(
usbfwD©a
.
ï0Sètus
 =
EP_TX
) {

192 
c⁄åﬁReg
 = 
USBCS0_INPKT_RDY
;

195 i‡(
usbSëupD©a
.
byãsLe·
 < 
EP0_PACKET_SIZE
) {

196 
byãsNow
 = 
usbSëupD©a
.
byãsLe·
;

197 
c⁄åﬁReg
 |
USBCS0_DATA_END
;

201 
byãsNow
 = 
EP0_PACKET_SIZE
;

205 
	`usbfwWrôeFifo
(&
USBF0
, 
byãsNow
, 
usbSëupD©a
.
pBuf„r
);

206 
usbSëupD©a
.
pBuf„r
 +
byãsNow
;

207 
usbSëupD©a
.
byãsLe·
 -
byãsNow
;

210 
USBCS0
 = 
c⁄åﬁReg
;

213 i‡(
byãsNow
 < 
EP0_PACKET_SIZE
) {

214 i‡(
Pro˚ssFunc
Ë
	`Pro˚ssFunc
();

215 
usbfwD©a
.
ï0Sètus
 = 
EP_IDLE
;

219 } i‡(
usbfwD©a
.
ï0Sètus
 =
EP_MANUAL_TX
) {

220 
	`Pro˚ssFunc
();

224 
	`USBFW_SELECT_ENDPOINT
(
ﬁdEndpoöt
);

226 
	}
}

238 
	$usbfwSëAŒEpSètus
(
EP_STATUS
 
°©us
)

240 
uöt8
 
n
;

241 
n
 = 0;Ç < (
usbfwD©a
.
pEpInSètus
);Ç++)

242 
usbfwD©a
.
pEpInSètus
[
n
] = 
°©us
;

243 
n
 = 0;Ç < (
usbfwD©a
.
pEpOutSètus
);Ç++)

244 
usbfwD©a
.
pEpOutSètus
[
n
] = 
°©us
;

245 
	}
}

262 
	$usbfwRódFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
)

264 
uöt8
 
__gíîic
 *
pTemp
 = 
pD©a
;

265 i‡(
cou¡
) {

267 *(
pTemp
++Ë*
pFifo
;

268 } --
cou¡
);

270 
	}
}

287 
	$usbfwWrôeFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
)

289 
uöt8
 
__gíîic
 *
pTemp
 = 
pD©a
;

290 i‡(
cou¡
) {

292 *
pFifo
 = *(
pTemp
++);

293 } --
cou¡
);

295 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_framework.h

9 #i‚de‡
USBFRAMEWORK_H


10 
	#USBFRAMEWORK_H


	)

182 
	~"usb_bﬂrd_cfg.h
"

183 
	~"usb_‰amew‹k_°ru˘s.h
"

185 #ifde‡
EXTERN


186 #unde‡
EXTERN


188 #ifde‡
USBFRAMEWORK_C


189 
	#EXTERN


190 #ñ£

	)

191 
	#EXTERN
 

193 

	)

198 
EXTERN
 
USBFW_DATA
 
__xd©a
 
usbfwD©a
;

206 
EXTERN
 
USB_SETUP_DATA
 
__xd©a
 
	gusbSëupD©a
;

207 
EXTERN
 
USB_SETUP_HEADER
 
__xd©a
 
	gusbSëupHódî
;

217 
	#RT_MASK_DIR
 0x80

218 
	#RT_MASK_TYPE
 0x60

219 
	#RT_MASK_RECIP
 0x1F

220 

	)

222 
	#RT_DIR_IN
 0x80

223 
	#RT_DIR_OUT
 0x00

224 

	)

226 
	#RT_TYPE_STD
 0x00

227 
	#RT_TYPE_CLASS
 0x20

228 
	#RT_TYPE_VEND
 0x40

229 

	)

231 
	#RT_RECIP_DEV
 0x00

232 
	#RT_RECIP_IF
 0x01

233 
	#RT_RECIP_EP
 0x02

234 
	#RT_RECIP_OTHER
 0x03

235 

	)

237 
	#RT_STD_OUT
 (
RT_TYPE_STD
 | 
RT_DIR_OUT
)

238 
	#RT_STD_IN
 (
RT_TYPE_STD
 | 
RT_DIR_IN
)

239 
	#RT_VEND_OUT
 (
RT_TYPE_VEND
 | 
RT_DIR_OUT
)

240 
	#RT_VEND_IN
 (
RT_TYPE_VEND
 | 
RT_DIR_IN
)

241 
	#RT_CLASS_OUT
 (
RT_TYPE_CLASS
 | 
RT_DIR_OUT
)

242 
	#RT_CLASS_IN
 (
RT_TYPE_CLASS
 | 
RT_DIR_IN
)

243 

	)

245 
	#RT_OUT_DEVICE
 (
RT_DIR_OUT
 | 
RT_RECIP_DEV
)

246 
	#RT_IN_DEVICE
 (
RT_DIR_IN
 | 
RT_RECIP_DEV
)

247 
	#RT_OUT_INTERFACE
 (
RT_DIR_OUT
 | 
RT_RECIP_IF
)

248 
	#RT_IN_INTERFACE
 (
RT_DIR_IN
 | 
RT_RECIP_IF
)

249 
	#RT_OUT_ENDPOINT
 (
RT_DIR_OUT
 | 
RT_RECIP_EP
)

250 
	#RT_IN_ENDPOINT
 (
RT_DIR_IN
 | 
RT_RECIP_EP
)

253 

	)

261 
usb¸HookPro˚ssOut
();

263 
usb¸HookPro˚ssIn
();

265 
usbvrHookPro˚ssOut
();

267 
usbvrHookPro˚ssIn
();

281 
	#USBFW_SELECT_ENDPOINT
(
n
Ë(
USBINDEX
 = (n))

	)

283 
	#USBFW_GET_SELECTED_ENDPOINT
(Ë(
USBINDEX
)

	)

286 
	#USBFW_STALL_IN_ENDPOINT
(Ë
	`°
 (\

287 
USBCSIL
 = 
USBCSIL_SEND_STALL
; \

288 
usbfwD©a
.
pEpInSètus
[
USBINDEX
 - 1] = 
EP_HALT
; )

	)

291 
	#USBFW_IN_ENDPOINT_STALLED
(Ë(
USBCSIL
 & 
USBCSIL_SEND_STALL
)

	)

293 
	#USBFW_FLUSH_IN_ENDPOINT
(Ë
	`°
 (\

294 
USBCSIL
 = 
USBCSIL_FLUSH_PACKET
; \

295 
USBCSIL
 & 
USBCSIL_FLUSH_PACKET
); )

	)

298 
	#USBFW_ARM_IN_ENDPOINT
(Ë(
USBCSIL
 = 
USBCSIL_INPKT_RDY
)

	)

300 
	#USBFW_IN_ENDPOINT_DISARMED
(Ë!(
USBCSIL
 & 
USBCSIL_INPKT_RDY
)

	)

302 
	#USBFW_IN_ENDPOINT_FIFO_EMPTY
(Ë!(
USBCSIL
 & 
USBCSIL_PKT_PRESENT
)

	)

305 
	#USBFW_STALL_OUT_ENDPOINT
(Ë
	`°
 ( \

306 
USBCSOL
 = 
USBCSOL_SEND_STALL
; \

307 
usbfwD©a
.
pEpOutSètus
[
USBINDEX
 - 1] = 
EP_HALT
; \

308 }

	)

311 
	#USBFW_OUT_ENDPOINT_STALLED
(Ë(
USBCSOL
 & 
USBCSOL_SEND_STALL
)

	)

313 
	#USBFW_FLUSH_OUT_ENDPOINT
(Ë
	`°
(\

314 
USBCSOL
 = 
USBCSOL_FLUSH_PACKET
; \

315 
USBCSOL
 & 
USBCSOL_FLUSH_PACKET
); )

	)

318 
	#USBFW_ARM_OUT_ENDPOINT
(Ë(
USBCSOL
 = 0)

	)

320 
	#USBFW_OUT_ENDPOINT_DISARMED
(Ë(
USBCSOL
 & 
USBCSOL_OUTPKT_RDY
)

	)

322 
	#USBFW_GET_OUT_ENDPOINT_COUNT_LOW
(Ë(
USBCNTL
)

	)

324 
	#USBFW_GET_OUT_ENDPOINT_COUNT_HIGH
(Ë(
USBCNTH
)

	)

330 
	#LOBYTEPTR
(
w
Ë–(
uöt8
 
__gíîic
 *)(&(w)Ë+ 1 )

	)

338 
usbfwInô
();

339 
usbfwRe£tH™dÀr
();

340 
usbfwSëupH™dÀr
();

341 
usbfwSëAŒEpSètus
(
EP_STATUS
 
°©us
);

342 
usbfwWrôeFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
);

343 
usbfwRódFifo
(
uöt8
 vﬁ©ûê
__xd©a
 *
pFifo
, uöt8 
cou¡
, 
__gíîic
 *
pD©a
);

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_framework_structs.h

9 #i‚de‡
USBFRAMEWORKSTRUCTS_H


10 
	#USBFRAMEWORKSTRUCTS_H


	)

17 
	~"hÆ_ty≥s.h
"

18 
	~"usb_fúmw¨e_libøry_c⁄fig.h
"

20 #ifde‡
EXTERN


21 #unde‡
EXTERN


23 #ifde‡
USBFRAMEWORK_C


24 
	#EXTERN


25 #ñ£

	)

26 
	#EXTERN
 

28 

	)

36 
EP_IDLE
 = 0x00,

37 
EP_TX
 = 0x01,

38 
EP_RX
 = 0x02,

39 
EP_HALT
 = 0x03,

40 
EP_STALL
 = 0x04,

41 
EP_MANUAL_TX
 = 0x05,

42 
EP_MANUAL_RX
 = 0x06,

43 
EP_CANCEL
 = 0x07

44 } 
	tEP_STATUS
;

48 
	mDEV_ATTACHED
 = 0x00,

49 
	mDEV_POWERED
 = 0x01,

50 
	mDEV_DEFAULT
 = 0x02,

51 
	mDEV_ADDRESS
 = 0x03,

52 
	mDEV_CONFIGURED
 = 0x04,

53 
	mDEV_SUSPENDED
 = 0x05

54 } 
	tUSB_STATE
;

58 
USB_STATE
 
	musbSèã
;

59 
uöt8
 
	mc⁄figuøti⁄VÆue
;

60 
uöt8
 
	mpA…î«ãSëtög
[
USB_SETUP_MAX_NUMBER_OF_INTERFACES
];

61 
EP_STATUS
 
	mï0Sètus
;

62 
EP_STATUS
 
	mpEpInSètus
[5];

63 
EP_STATUS
 
	mpEpOutSètus
[5];

64 
uöt8
 
	mªmŸeWakeup
;

65 
uöt8
 
	m£lfPowîed
;

66 } 
	tUSBFW_DATA
;

71 
uöt8
 
	mªque°Ty≥
;

72 
uöt8
 
	mªque°
;

73 
uöt16
 
	mvÆue
;

74 
uöt16
 
	mödex
;

75 
uöt16
 
	mÀngth
;

76 } 
	tUSB_SETUP_HEADER
;

80 
uöt8
 
__gíîic
 *
	mpBuf„r
;

81 
uöt16
 
	mbyãsLe·
;

82 } 
	tUSB_SETUP_DATA
;

93 
uöt8
 
	mbLígth
;

94 
uöt8
 
	mbDes¸ùt‹Ty≥
;

95 
uöt16
 
	mbcdUSB
;

96 
uöt8
 
	mbDevi˚Cœss
;

97 
uöt8
 
	mbDevi˚SubCœss
;

98 
uöt8
 
	mbDevi˚PrŸocﬁ
;

99 
uöt8
 
	mbMaxPackëSize0
;

100 
uöt16
 
	midVíd‹
;

101 
uöt16
 
	midProdu˘
;

102 
uöt16
 
	mbcdDevi˚
;

103 
uöt8
 
	miM™uÁ˘uªr
;

104 
uöt8
 
	miProdu˘
;

105 
uöt8
 
	miSîülNumbî
;

106 
uöt8
 
	mbNumC⁄figuøti⁄s
;

107 } 
	tUSB_DEVICE_DESCRIPTOR
;

111 
uöt8
 
	mbLígth
;

112 
uöt8
 
	mbDes¸ùt‹Ty≥
;

113 
uöt16
 
	mwTŸÆLígth
;

114 
uöt8
 
	mbNumI¡îÁ˚s
;

115 
uöt8
 
	mbC⁄figuøti⁄VÆue
;

116 
uöt8
 
	miC⁄figuøti⁄
;

117 
uöt8
 
	mbmAâribuãs
;

118 
uöt8
 
	mbMaxPowî
;

119 } 
	tUSB_CONFIGURATION_DESCRIPTOR
;

123 
uöt8
 
	mbLígth
;

124 
uöt8
 
	mbDes¸ùt‹Ty≥
;

125 
uöt8
 
	mbI¡îÁ˚Numbî
;

126 
uöt8
 
	mbA…î«ãSëtög
;

127 
uöt8
 
	mbNumEndpoöts
;

128 
uöt8
 
	mbI¡îÁ˚Cœss
;

129 
uöt8
 
	mbI¡îÁ˚SubCœss
;

130 
uöt8
 
	mbI¡îÁ˚PrŸocﬁ
;

131 
uöt8
 
	miI¡îÁ˚
;

132 } 
	tUSB_INTERFACE_DESCRIPTOR
;

136 
uöt8
 
	mbLígth
;

137 
uöt8
 
	mbDes¸ùt‹Ty≥
;

138 
uöt8
 
	mbEndpoötAddªss
;

139 
uöt8
 
	mbmAâribuãs
;

140 
uöt16
 
	mwMaxPackëSize
;

141 
uöt8
 
	mbI¡îvÆ
;

142 } 
	tUSB_ENDPOINT_DESCRIPTOR
;

146 
uöt8
 
	mbLígth
;

147 
uöt8
 
	mbDes¸ùt‹Ty≥
;

148 
uöt16
 
	mpSåög
[1];

149 } 
	tUSB_STRING_DESCRIPTOR
;

153 
uöt8
 
	mbLígth
;

154 
uöt8
 
	mbDes¸ùt‹Ty≥
;

155 
uöt16
 
	mbscHID
;

156 
uöt8
 
	mbCou¡ryCode
;

157 
uöt8
 
	mbNumDes¸ùt‹s
;

158 
uöt8
 
	mbRDes¸ùt‹Ty≥
;

159 
uöt16
 
	mwDes¸ùt‹Lígth
;

160 } 
	tUSB_HID_DESCRIPTOR
;

167 
uöt8
 
	mvÆueMsb
;

168 
uöt8
 
	mvÆueLsb
;

169 
uöt8
 
	mödexMsb
;

170 
uöt8
 
	mödexLsb
;

171 
uöt8
 
__code
 *
	mpDescSèπ
;

172 
uöt16
 
	mÀngth
;

173 } 
	tDESC_LUT_INFO
;

177 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
	mpI¡îÁ˚
;

178 
uöt8
 
	möMask
;

179 
uöt8
 
	moutMask
;

180 } 
	tDBLBUF_LUT_INFO
;

186 
uöt16
 
	mevítMask
;

187 
uöt8
 
	möSu•íd
;

188 
uöt16
 
	múqMask
;

189 } 
	tUSBIRQ_DATA
;

194 c⁄° 
uöt8
 
__code
 *
	mpDesc
;

195 } 
	tUSBDP_DATA
;

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_interrupt.h

9 #i‚de‡
USBINTERRUPT_H


10 
	#USBINTERRUPT_H


	)

76 
	~"usb_‰amew‹k_°ru˘s.h
"

78 #ifde‡
EXTERN


79 #unde‡
EXTERN


81 #ifde‡
USBINTERRUPT_C


82 
	#EXTERN


83 #ñ£

	)

84 
	#EXTERN
 

86 

	)

95 #ifde‡
USBIRQ_DATA_ADDR


96 
EXTERN
 
__no_öô
 
__d©a
 
USBIRQ_DATA
 
usbúqD©a
 @ 
USBIRQ_DATA_ADDR
;

98 
EXTERN
 
USBIRQ_DATA
 
__d©a
 
	gusbúqD©a
;

109 
	#USBIRQ_EVENT_SUSPEND
 0x0001

	)

111 
	#USBIRQ_EVENT_RESUME
 0x0002

	)

113 
	#USBIRQ_EVENT_RESET
 0x0004

	)

115 
	#USBIRQ_EVENT_START_OF_FRAME
 0x0008

	)

117 
	#USBIRQ_EVENT_SETUP
 0x0010

	)

119 
	#USBIRQ_EVENT_EP1IN
 0x0020

	)

121 
	#USBIRQ_EVENT_EP2IN
 0x0040

	)

123 
	#USBIRQ_EVENT_EP3IN
 0x0080

	)

125 
	#USBIRQ_EVENT_EP4IN
 0x0100

	)

127 
	#USBIRQ_EVENT_EP5IN
 0x0200

	)

129 
	#USBIRQ_EVENT_EP1OUT
 0x0400

	)

131 
	#USBIRQ_EVENT_EP2OUT
 0x0800

	)

133 
	#USBIRQ_EVENT_EP3OUT
 0x1000

	)

135 
	#USBIRQ_EVENT_EP4OUT
 0x2000

	)

137 
	#USBIRQ_EVENT_EP5OUT
 0x4000

	)

147 
	#USBIRQ_CLEAR_EVENTS
(
mask
Ë(
usbúqD©a
.
evítMask
 &(mask ^ 0xFFFF))

	)

149 
	#USBIRQ_GET_EVENT_MASK
(Ë(
usbúqD©a
.
evítMask
)

	)

159 
usbúqHookPro˚ssEvíts
();

167 
usbúqInô
(
uöt16
 
úqMask
);

168 #i‡
deföed
 
HAL_SB_BOOT_CODE


169 
usbúqH™dÀr
();

171 
__öãºu±
 
usbúqH™dÀr
();

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_reg.h

9 #i‚de‡
USBREG_H


10 
	#USBREG_H


	)

14 
	#USBADDR_UPDATE
 0x80

	)

15 
	#USBADDR_USBADDR
 0x7F

	)

18 
	#USBPOW_ISO_WAIT_SOF
 0x80

	)

19 
	#USBPOW_RST
 0x08

	)

20 
	#USBPOW_RESUME
 0x04

	)

21 
	#USBPOW_SUSPEND
 0x02

	)

22 
	#USBPOW_SUSPEND_EN
 0x01

	)

25 
	#USBIIF_INEP5IF
 0x20

	)

26 
	#USBIIF_INEP4IF
 0x10

	)

27 
	#USBIIF_INEP3IF
 0x08

	)

28 
	#USBIIF_INEP2IF
 0x04

	)

29 
	#USBIIF_INEP1IF
 0x02

	)

30 
	#USBIIF_EP0IF
 0x01

	)

33 
	#USBOIF_OUTEP5IF
 0x20

	)

34 
	#USBOIF_OUTEP4IF
 0x10

	)

35 
	#USBOIF_OUTEP3IF
 0x08

	)

36 
	#USBOIF_OUTEP2IF
 0x04

	)

37 
	#USBOIF_OUTEP1IF
 0x02

	)

40 
	#USBCIF_SOFIF
 0x08

	)

41 
	#USBCIF_RSTIF
 0x04

	)

42 
	#USBCIF_RESUMEIF
 0x02

	)

43 
	#USBCIF_SUSPENDIF
 0x01

	)

46 
	#USBIIE_INEP5IE
 0x20

	)

47 
	#USBIIE_INEP4IE
 0x10

	)

48 
	#USBIIE_INEP3IE
 0x08

	)

49 
	#USBIIE_INEP2IE
 0x04

	)

50 
	#USBIIE_INEP1IE
 0x02

	)

51 
	#USBIIE_EP0IE
 0x01

	)

54 
	#USBOIE_OUTEP5IE
 0x20

	)

55 
	#USBOIE_OUTEP4IE
 0x10

	)

56 
	#USBOIE_OUTEP3IE
 0x08

	)

57 
	#USBOIE_OUTEP2IE
 0x04

	)

58 
	#USBOIE_OUTEP1IE
 0x02

	)

61 
	#USBCIE_SOFIE
 0x08

	)

62 
	#USBCIE_RSTIE
 0x04

	)

63 
	#USBCIE_RESUMEIE
 0x02

	)

64 
	#USBCIE_SUSPENDIE
 0x01

	)

67 
	#USBCS0_CLR_SETUP_END
 0x80

	)

68 
	#USBCS0_CLR_OUTPKT_RDY
 0x40

	)

69 
	#USBCS0_SEND_STALL
 0x20

	)

70 
	#USBCS0_SETUP_END
 0x10

	)

71 
	#USBCS0_DATA_END
 0x08

	)

72 
	#USBCS0_SENT_STALL
 0x04

	)

73 
	#USBCS0_INPKT_RDY
 0x02

	)

74 
	#USBCS0_OUTPKT_RDY
 0x01

	)

77 
	#USBCSIL_CLR_DATA_TOG
 0x40

	)

78 
	#USBCSIL_SENT_STALL
 0x20

	)

79 
	#USBCSIL_SEND_STALL
 0x10

	)

80 
	#USBCSIL_FLUSH_PACKET
 0x08

	)

81 
	#USBCSIL_UNDERRUN
 0x04

	)

82 
	#USBCSIL_PKT_PRESENT
 0x02

	)

83 
	#USBCSIL_INPKT_RDY
 0x01

	)

86 
	#USBCSIH_AUTOSET
 0x80

	)

87 
	#USBCSIH_ISO
 0x40

	)

88 
	#USBCSIH_FORCE_DATA_TOG
 0x08

	)

89 
	#USBCSIH_IN_DBL_BUF
 0x01

	)

92 
	#USBCSOL_CLR_DATA_TOG
 0x80

	)

93 
	#USBCSOL_SENT_STALL
 0x40

	)

94 
	#USBCSOL_SEND_STALL
 0x20

	)

95 
	#USBCSOL_FLUSH_PACKET
 0x10

	)

96 
	#USBCSOL_DATA_ERROR
 0x08

	)

97 
	#USBCSOL_OVERRUN
 0x04

	)

98 
	#USBCSOL_FIFO_FULL
 0x02

	)

99 
	#USBCSOL_OUTPKT_RDY
 0x01

	)

102 
	#USBCSOH_AUTOCLEAR
 0x80

	)

103 
	#USBCSOH_ISO
 0x40

	)

104 
	#USBCSOH_OUT_DBL_BUF
 0x01

	)

106 
	#SLEEP_USB_EN
 0x80

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_standard_requests.c

11 
	~"usb_fúmw¨e_libøry_hódîs.h
"

12 
	~"hÆ_ty≥s.h
"

13 
	~"hÆ_bﬂrd.h
"

37 
	$usb§GëSètus
()

39 
uöt8
 
ídpoöt
;

40 
uöt16
 
__xd©a
 
°©us
;

43 i‡(
usbSëupHódî
.
vÆue
 || 
	`HI_UINT16
(usbSëupHódî.
ödex
Ë|| (usbSëupHódî.
Àngth
 != 2)) {

44 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

48 
usbSëupHódî
.
ªque°Ty≥
) {

53 
RT_IN_DEVICE
:

56 i‡(
	`LO_UINT16
(
usbSëupHódî
.
ödex
)) {

57 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

63 
°©us
 = 
usbfwD©a
.
£lfPowîed
 ? 0x0001 : 0x0000;

66 i‡(
usbfwD©a
.
ªmŸeWakeup
Ë
°©us
 |= 0x0002;

72 
RT_IN_INTERFACE
:

75 i‡(
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
) {

76 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

78 
°©us
 = 0x0000;

84 
RT_IN_ENDPOINT
:

85 
ídpoöt
 = 
	`LO_UINT16
(
usbSëupHódî
.
ödex
) & 0x7F;

88 i‡((
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
Ë|| (
ídpoöt
 > 5)) {

89 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

95 i‡(
	`LO_UINT16
(
usbSëupHódî
.
ödex
) & 0x80) {

96 
°©us
 = (
usbfwD©a
.
pEpInSètus
[
ídpoöt
 - 1] =
EP_HALT
) ? 0x0001 : 0x0000;

100 
°©us
 = (
usbfwD©a
.
pEpOutSètus
[
ídpoöt
 - 1] =
EP_HALT
) ? 0x0001 : 0x0000;

106 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

110 i‡(
usbfwD©a
.
ï0Sètus
 !
EP_STALL
) {

112 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__gíîic
 *)&
°©us
;

113 
usbSëupD©a
.
byãsLe·
 = 2;

114 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

117 
	}
}

133 
uöt8
 
	$Ch™geFótuª
(
uöt8
 
£t
)

135 
uöt8
 
ídpoöt
;

138 i‡(
usbSëupHódî
.
Àngth
 || (
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
Ë&& (usbSëupHódî.
ödex
 != 0)) {

139 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

143 
usbSëupHódî
.
ªque°Ty≥
 & 
RT_MASK_RECIP
) {

146 
RT_RECIP_DEV
:

149 i‡(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
Ë!
DEVICE_REMOTE_WAKEUP
) {

150  
FALSE
;

152 
usbfwD©a
.
ªmŸeWakeup
 = 
£t
;

153 
	`usb§HookPro˚ssEvít
(
£t
 ? 
USBSR_EVENT_REMOTE_WAKEUP_ENABLED
 : 
USBSR_EVENT_REMOTE_WAKEUP_DISABLED
, 0);

158 
RT_RECIP_IF
:

159  
FALSE
;

162 
RT_RECIP_EP
:

163 
ídpoöt
 = 
	`LO_UINT16
(
usbSëupHódî
.
ödex
) & 0x7F;

166 i‡(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
Ë!
ENDPOINT_HALT
) {

167  
FALSE
;

168 } i‡(
ídpoöt
 > 5) {

169 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

171 
	`USBFW_SELECT_ENDPOINT
(
ídpoöt
);

174 i‡(
	`LO_UINT16
(
usbSëupHódî
.
ödex
) & 0x80) {

175 
USBCSIL
 = 
£t
 ? 
USBCSIL_SEND_STALL
 : 
USBCSIL_CLR_DATA_TOG
;

176 
usbfwD©a
.
pEpInSètus
[
ídpoöt
 - 1] = 
£t
 ? 
EP_HALT
 : 
EP_IDLE
;

177 
	`usb§HookPro˚ssEvít
(
£t
 ? 
USBSR_EVENT_EPIN_STALL_SET
 : 
USBSR_EVENT_EPIN_STALL_CLEARED
, 
ídpoöt
);

181 
USBCSOL
 = 
£t
 ? 
USBCSOL_SEND_STALL
 : 
USBCSOL_CLR_DATA_TOG
;

182 
usbfwD©a
.
pEpOutSètus
[
ídpoöt
 - 1] = 
£t
 ? 
EP_HALT
 : 
EP_IDLE
;

183 
	`usb§HookPro˚ssEvít
(
£t
 ? 
USBSR_EVENT_EPOUT_STALL_SET
 : 
USBSR_EVENT_EPOUT_STALL_CLEARED
, 
ídpoöt
);

185 
	`USBFW_SELECT_ENDPOINT
(0);

190 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

194  
TRUE
;

195 
	}
}

214 
	$usb§CÀ¨Fótuª
()

216 i‡(!
	`Ch™geFótuª
(
FALSE
)) {

217 
	`usb§HookCÀ¨Fótuª
();

219 
	}
}

238 
	$usb§SëFótuª
()

240 i‡(!
	`Ch™geFótuª
(
TRUE
)) {

241 
	`usb§HookSëFótuª
();

243 
	}
}

262 
	$usb§SëAddªss
()

266 i‡(
usbSëupHódî
.
ödex
 || usbSëupHódî.
Àngth
 || 
	`HI_UINT16
(usbSëupHódî.
vÆue
Ë|| (
	`LO_UINT16
(usbSetupHeader.value) & 0x80)) {

267 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

271 
USBADDR
 = 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
);

272 i‡(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
) != 0) {

273 i‡(
usbfwD©a
.
usbSèã
 =
DEV_DEFAULT
ËusbfwD©a.usbSèã = 
DEV_ADDRESS
;

275 i‡(
usbfwD©a
.
usbSèã
 =
DEV_ADDRESS
ËusbfwD©a.usbSèã = 
DEV_DEFAULT
;

279 
	}
}

305 
	$usb§GëDes¸ùt‹
()

307 
uöt8
 
n
;

310 
	`HI_UINT16
(
usbSëupHódî
.
vÆue
)) {

313 
DESC_TYPE_DEVICE
:

314 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__code
*Ë
	`usbdpGëDevi˚Desc
();

315 
usbSëupD©a
.
byãsLe·
 = usbSëupD©a.
pBuf„r
[
DESC_LENGTH_IDX
];

319 
DESC_TYPE_CONFIG
:

320 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 
__code
*Ë
	`usbdpGëC⁄figuøti⁄Desc
(0, 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
));

321 
usbSëupD©a
.
byãsLe·
 = usbSëupD©a.
pBuf„r
[
DESC_CONFIG_LENGTH_LSB_IDX
] +

322 
usbSëupD©a
.
pBuf„r
[
DESC_CONFIG_LENGTH_MSB_IDX
] * 256;

326 
DESC_TYPE_STRING
:

328 
usbSëupD©a
.
pBuf„r
 = (
uöt8
 *)
	`usbdpGëSåögDesc
(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
));

329 
usbSëupD©a
.
byãsLe·
 = usbSëupD©a.
pBuf„r
[
DESC_LENGTH_IDX
];

335 
usbSëupD©a
.
pBuf„r
 = 
NULL
;

336 
n
 = 0;Ç < ((
uöt16
)
usbDes¸ùt‹M¨kî
.
pUsbDescLutEnd
 - (uöt16)usbDes¸ùt‹M¨kî.
pUsbDescLut
Ë/ (
DESC_LUT_INFO
);Ç++) {

337 i‡((
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
vÆueMsb
 =
	`HI_UINT16
(
usbSëupHódî
.
vÆue
))

338 && (
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
vÆueLsb
 =
	`LO_UINT16
(
usbSëupHódî
.
vÆue
))

339 && (
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
ödexMsb
 =
	`HI_UINT16
(
usbSëupHódî
.
ödex
))

340 && (
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
ödexLsb
 =
	`LO_UINT16
(
usbSëupHódî
.
ödex
)) )

342 
usbSëupD©a
.
pBuf„r
 = 
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
pDescSèπ
;

343 
usbSëupD©a
.
byãsLe·
 = 
usbDes¸ùt‹M¨kî
.
pUsbDescLut
[
n
].
Àngth
;

349 i‡(
usbSëupD©a
.
pBuf„r
 =
NULL
Ë
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

351 i‡(
usbfwD©a
.
ï0Sètus
 !
EP_STALL
) {

355 i‡(
usbSëupD©a
.
byãsLe·
 > 
usbSëupHódî
.
Àngth
) {

356 
usbSëupD©a
.
byãsLe·
 = 
usbSëupHódî
.
Àngth
;

359 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

362 
	}
}

376 
	$C⁄figuªEndpoöts
(
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚
)

378 
uöt8
 
n
;

379 
uöt16
 
maxpRegVÆue
;

380 
uöt8
 
csRegVÆue
;

381 
uöt8
 
ídpoöt
;

382 
USB_ENDPOINT_DESCRIPTOR
 
__code
 *
pEndpoöt
;

383 
DBLBUF_LUT_INFO
 
__code
 *
pUsbDblbufLutInfo
;

386 i‡(
pI¡îÁ˚
->
bNumEndpoöts
) {

387 
pUsbDblbufLutInfo
 = (
DBLBUF_LUT_INFO
 
__code
*Ë
usbDes¸ùt‹M¨kî
.
pUsbDblbufLut
;

388 
pUsbDblbufLutInfo
->
pI¡îÁ˚
 !=ÖInterface) {

389 
pUsbDblbufLutInfo
++;

394 
n
 = 0;Ç < 
pI¡îÁ˚
->
bNumEndpoöts
;Ç++) {

395 i‡(
pEndpoöt
 = 
	`usbdpFödNext
(
DESC_TYPE_ENDPOINT
, 0)) {

398 
ídpoöt
 = 
pEndpoöt
->
bEndpoötAddªss
 & 0x0F;

399 
	`USBFW_SELECT_ENDPOINT
(
ídpoöt
);

401 
csRegVÆue
 = 0x00;

402 
maxpRegVÆue
 = (
pEndpoöt
->
wMaxPackëSize
 + 7) >> 3;

405 i‡(
pEndpoöt
->
bEndpoötAddªss
 & 0x80) {

408 
USBCSIL
 = 
USBCSIL_CLR_DATA_TOG
 | 
USBCSIL_FLUSH_PACKET
;

409 
USBCSIL
 = 
USBCSIL_FLUSH_PACKET
;

412 i‡((
pEndpoöt
->
bmAâribuãs
 & 
EP_ATTR_TYPE_BM
Ë=
EP_ATTR_ISO
Ë
csRegVÆue
 |
USBCSIH_ISO
;

413 i‡(
pUsbDblbufLutInfo
->
öMask
 & (1 << 
ídpoöt
)Ë
csRegVÆue
 |
USBCSIH_IN_DBL_BUF
;

414 
USBCSIH
 = 
csRegVÆue
;

417 
USBMAXI
 = 
maxpRegVÆue
;

420 
usbfwD©a
.
pEpInSètus
[
ídpoöt
 - 1] = 
EP_IDLE
;

426 
USBCSOL
 = 
USBCSOL_CLR_DATA_TOG
 | 
USBCSOL_FLUSH_PACKET
;

427 
USBCSOL
 = 
USBCSOL_FLUSH_PACKET
;

430 i‡((
pEndpoöt
->
bmAâribuãs
 & 
EP_ATTR_TYPE_BM
Ë=
EP_ATTR_ISO
Ë
csRegVÆue
 |
USBCSOH_ISO
;

431 i‡(
pUsbDblbufLutInfo
->
outMask
 & (1 << 
ídpoöt
)Ë
csRegVÆue
 |
USBCSOH_OUT_DBL_BUF
;

432 
USBCSOH
 = 
csRegVÆue
;

435 
USBMAXO
 = 
maxpRegVÆue
;

438 
usbfwD©a
.
pEpOutSètus
[
ídpoöt
 - 1] = 
EP_IDLE
;

440 
	`USBFW_SELECT_ENDPOINT
(0);

443 
	}
}

461 
	$usb§GëC⁄figuøti⁄
()

465 i‡(
usbSëupHódî
.
vÆue
 || usbSëupHódî.
ödex
 || (usbSëupHódî.
Àngth
 != 1)) {

466 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

470 
usbSëupD©a
.
pBuf„r
 = &
usbfwD©a
.
c⁄figuøti⁄VÆue
;

471 
usbSëupD©a
.
byãsLe·
 = 1;

472 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

475 
	}
}

494 
	$usb§SëC⁄figuøti⁄
()

496 
uöt8
 
n
;

497 
USB_CONFIGURATION_DESCRIPTOR
 
__code
 *
pC⁄figuøti⁄
;

498 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚
;

501 i‡((
usbfwD©a
.
usbSèã
 =
DEV_DEFAULT
Ë|| 
usbSëupHódî
.
ödex
 || usbSëupHódî.
Àngth
 || 
	`HI_UINT16
(usbSëupHódî.
vÆue
)) {

502 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

506 
	`usb§HookPro˚ssEvít
(
USBSR_EVENT_CONFIGURATION_CHANGING
, 0);

509 i‡(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
)) {

512 
pC⁄figuøti⁄
 = 
	`usbdpGëC⁄figuøti⁄Desc
(
	`LO_UINT16
(
usbSëupHódî
.
vÆue
), 0);

515 i‡(
pC⁄figuøti⁄
) {

516 
usbfwD©a
.
usbSèã
 = 
DEV_CONFIGURED
;

517 
usbfwD©a
.
c⁄figuøti⁄VÆue
 = 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
);

520 
n
 = 0;Ç < 
pC⁄figuøti⁄
->
bNumI¡îÁ˚s
;Ç++) {

521 
usbfwD©a
.
pA…î«ãSëtög
[
n
] = 0x00;

525 
pI¡îÁ˚
 = 
	`usbdpFödNext
(
DESC_TYPE_INTERFACE
, 0);

526 } 
pI¡îÁ˚
->
bA…î«ãSëtög
 !
usbfwD©a
.
pA…î«ãSëtög
[
n
]);

529 
	`C⁄figuªEndpoöts
(
pI¡îÁ˚
);

534 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

539 
usbfwD©a
.
c⁄figuøti⁄VÆue
 = 
	`LO_UINT16
(
usbSëupHódî
.
vÆue
);

540 
usbfwD©a
.
usbSèã
 = 
DEV_ADDRESS
;

541 
	`usbfwSëAŒEpSètus
(
EP_HALT
);

543 
	`usb§HookPro˚ssEvít
(
USBSR_EVENT_CONFIGURATION_CHANGED
, 0);

546 
	}
}

565 
	$usb§GëI¡îÁ˚
()

569 i‡((
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
Ë|| (
usbSëupHódî
.
ªque°Ty≥
 !
RT_IN_INTERFACE
Ë|| usbSëupHódî.
vÆue
 || (usbSëupHódî.
Àngth
 != 1)) {

570 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

574 
usbSëupD©a
.
pBuf„r
 = &
usbfwD©a
.
pA…î«ãSëtög
[
usbSëupHódî
.
ödex
];

575 
usbSëupD©a
.
byãsLe·
 = 1;

576 
usbfwD©a
.
ï0Sètus
 = 
EP_TX
;

579 
	}
}

598 
	$usb§SëI¡îÁ˚
()

600 
USB_INTERFACE_DESCRIPTOR
 
__code
 *
pI¡îÁ˚
;

603 i‡((
usbfwD©a
.
usbSèã
 !
DEV_CONFIGURED
Ë|| (
usbSëupHódî
.
ªque°Ty≥
 !
RT_OUT_INTERFACE
Ë|| usbSëupHódî.
Àngth
) {

604 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

608 i‡(
pI¡îÁ˚
 = 
	`usbdpGëI¡îÁ˚Desc
(
usbfwD©a
.
c⁄figuøti⁄VÆue
, 
usbSëupHódî
.
ödex
, usbSëupHódî.
vÆue
)) {

609 
	`usb§HookPro˚ssEvít
(
USBSR_EVENT_INTERFACE_CHANGING
, 
usbSëupHódî
.
ödex
);

610 
usbfwD©a
.
pA…î«ãSëtög
[
usbSëupHódî
.
ödex
] = usbSëupHódî.
vÆue
;

613 
	`C⁄figuªEndpoöts
(
pI¡îÁ˚
);

614 
	`usb§HookPro˚ssEvít
(
USBSR_EVENT_INTERFACE_CHANGED
, 
usbSëupHódî
.
ödex
);

618 
usbfwD©a
.
ï0Sètus
 = 
EP_STALL
;

622 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_standard_requests.h

9 #i‚de‡
USBSTANDARDREQUESTS_H


10 
	#USBSTANDARDREQUESTS_H


	)

61 
	#GET_STATUS
 0x00

	)

63 
	#CLEAR_FEATURE
 0x01

	)

65 
	#SET_FEATURE
 0x03

	)

67 
	#SET_ADDRESS
 0x05

	)

69 
	#GET_DESCRIPTOR
 0x06

	)

71 
	#SET_DESCRIPTOR
 0x07

	)

73 
	#GET_CONFIGURATION
 0x08

	)

75 
	#SET_CONFIGURATION
 0x09

	)

77 
	#GET_INTERFACE
 0x0A

	)

79 
	#SET_INTERFACE
 0x0B

	)

81 
	#SYNCH_FRAME
 0x0C

	)

91 
	#ENDPOINT_HALT
 0x00

	)

93 
	#DEVICE_REMOTE_WAKEUP
 0x01

	)

103 
	#USBSR_EVENT_CONFIGURATION_CHANGING
 0x01

	)

105 
	#USBSR_EVENT_CONFIGURATION_CHANGED
 0x02

	)

107 
	#USBSR_EVENT_INTERFACE_CHANGING
 0x03

	)

109 
	#USBSR_EVENT_INTERFACE_CHANGED
 0x04

	)

111 
	#USBSR_EVENT_REMOTE_WAKEUP_ENABLED
 0x05

	)

113 
	#USBSR_EVENT_REMOTE_WAKEUP_DISABLED
 0x06

	)

115 
	#USBSR_EVENT_EPIN_STALL_CLEARED
 0x07

	)

117 
	#USBSR_EVENT_EPIN_STALL_SET
 0x08

	)

119 
	#USBSR_EVENT_EPOUT_STALL_CLEARED
 0x09

	)

121 
	#USBSR_EVENT_EPOUT_STALL_SET
 0x0A

	)

133 
usb§HookSëDes¸ùt‹
();

135 
usb§HookSynchFøme
();

137 
usb§HookCÀ¨Fótuª
();

139 
usb§HookSëFótuª
();

141 
usb§HookModifyGëSètus
(
uöt8
 
ªcùõ¡
, uöt8 
ödex
, 
uöt16
 
__xd©a
 *
pSètus
);

143 
usb§HookPro˚ssEvít
(
uöt8
 
evít
, uöt8 
ödex
);

151 
usb§GëSètus
();

152 
usb§CÀ¨Fótuª
();

153 
usb§SëFótuª
();

154 
usb§SëAddªss
();

155 
usb§GëDes¸ùt‹
();

156 
usb§GëC⁄figuøti⁄
();

157 
usb§SëC⁄figuøti⁄
();

158 
usb§GëI¡îÁ˚
();

159 
usb§SëI¡îÁ˚
();

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_suspend.h

9 #i‚de‡
USBSUSPEND_H


10 
	#USBSUSPEND_H


	)

90 
	~"usb_fúmw¨e_libøry_hódîs.h
"

92 (*
	tVFPTR
)();

96 
__xd©a
 
VFPTR
 
pFnSu•ídE¡îHook
;

97 
__xd©a
 
VFPTR
 
pFnSu•ídExôHook
;

101 
	`usbsu•E¡î
();

102 
uöt8
 
	`usbsu•DoRemŸeWakeup
();

103 
	`usbsu•St›Pm1
();

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/usb_board_cfg.h

41 #i‚de‡
USB_BOARD_CFG_H


42 
	#USB_BOARD_CFG_H


	)

49 
	~"hÆ_bﬂrd_cfg.h
"

50 
	~"hÆ_mcu.h
"

51 
	~"ioCC2531.h
"

52 
	~"usb_ªg.h
"

59 
	#HAL_BOARD_IO_USB_ENABLE_PORT
 1

60 
	#HAL_BOARD_IO_USB_ENABLE_PIN
 0

	)

62 
	#BIT0
 0x01

	)

63 
	#BIT1
 0x02

	)

64 
	#BIT2
 0x04

	)

65 
	#BIT3
 0x08

	)

66 
	#BIT4
 0x10

	)

67 
	#BIT5
 0x20

	)

68 
	#BIT6
 0x40

	)

69 
	#BIT7
 0x80

	)

71 #i‡!
deföed
 
HAL_UART_USB_SUSPEND


72 
	#HAL_UART_USB_SUSPEND
 
FALSE


	)

80 
	#HAL_USB_ENABLE
(Ë
	`°
–
USBCTRL

USBCTRL_PLL_EN
 | 
USBCTRL_USB_EN
; \

81 !(
USBCTRL
&
USBCTRL_PLL_LOCKED
)); )

	)

82 
	#HAL_USB_PLL_DISABLE
(Ë
	`°
–
USBCTRL
&~
USBCTRL_PLL_EN
; \

83 
USBCTRL
&
USBCTRL_PLL_LOCKED
); )

	)

84 
	#HAL_USB_DISABLE
 
	`°
–
USBCTRL
 = 0; USBCTRL & 0x80); )

	)

86 
	#HAL_USB_PULLUP_ENABLE
() \

87 
	`MCU_IO_OUTPUT
(
HAL_BOARD_IO_USB_ENABLE_PORT
, 
HAL_BOARD_IO_USB_ENABLE_PIN
, 1)

	)

88 
	#HAL_USB_PULLUP_DISABLE
() \

89 
	`MCU_IO_OUTPUT
(
HAL_BOARD_IO_USB_ENABLE_PORT
, 
HAL_BOARD_IO_USB_ENABLE_PIN
, 0)

	)

91 
	#HAL_USB_INT_ENABLE
(Ë

	)

92 
	#HAL_USB_INT_DISABLE
(Ë
	`°
–
P2IEN
&~0x20; )

	)

93 
	#HAL_USB_INT_CLEAR
(Ë
	`°
–
P2IFG
0; 
P2IF
0; )

	)

95 
	#HAL_USB_RESUME_INT_ENABLE
(Ë

	)

96 
	#HAL_USB_RESUME_INT_DISABLE
(Ë
	`°
 ( 
USBCIE
 &~0x02; )

	)

98 
	#USBCTRL_PLL_LOCKED
 0x80

	)

99 
	#USBCTRL_PLL_EN
 0x02

	)

100 
	#USBCTRL_USB_EN
 0x01

	)

102 
	#P2IFG_DPIF
 0x20

	)

104 
	#CC2530_IS_XOSC_STABLE
(Ë(
SLEEPSTA
 & 
XOSC_STB
)

	)

106 
	#NOP
(Ë
	`asm
("NOP")

	)

107 
	#MCU_IO_TRISTATE
 1

108 
	#MCU_IO_PULLUP
 2

	)

109 
	#MCU_IO_PULLDOWN
 3

	)

114 
	#MCU_IO_PERIPHERAL
(
p‹t
, 
pö
Ë
	`MCU_IO_PERIPHERAL_PREP
’‹t,Öö)

	)

115 
	#MCU_IO_INPUT
(
p‹t
, 
pö
, 
func
Ë
	`MCU_IO_INPUT_PREP
’‹t,Öö, func)

	)

116 
	#MCU_IO_OUTPUT
(
p‹t
, 
pö
, 
vÆ
Ë
	`MCU_IO_OUTPUT_PREP
’‹t,Öö, vÆ)

	)

117 
	#MCU_IO_SET
(
p‹t
, 
pö
, 
vÆ
Ë
	`MCU_IO_SET_PREP
’‹t,Öö, vÆ)

	)

118 
	#MCU_IO_SET_HIGH
(
p‹t
, 
pö
Ë
	`MCU_IO_SET_HIGH_PREP
’‹t,Öö)

	)

119 
	#MCU_IO_SET_LOW
(
p‹t
, 
pö
Ë
	`MCU_IO_SET_LOW_PREP
’‹t,Öö)

	)

120 
	#MCU_IO_TGL
(
p‹t
, 
pö
Ë
	`MCU_IO_TGL_PREP
’‹t,Öö)

	)

121 
	#MCU_IO_GET
(
p‹t
, 
pö
Ë
	`MCU_IO_GET_PREP
’‹t,Öö)

	)

123 
	#MCU_IO_DIR_INPUT
(
p‹t
, 
pö
Ë
	`MCU_IO_DIR_INPUT_PREP
’‹t,Öö)

	)

124 
	#MCU_IO_DIR_OUTPUT
(
p‹t
, 
pö
Ë
	`MCU_IO_DIR_OUTPUT_PREP
’‹t,Öö)

	)

129 
	#MCU_IO_PERIPHERAL_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
SEL
 |
	`BV
’ö); )

	)

131 
	#MCU_IO_INPUT_PREP
(
p‹t
, 
pö
, 
func
Ë
	`°
–
P
##p‹t##
SEL
 &~
	`BV
(pin); \

132 
P
##
p‹t
##
DIR
 &~
	`BV
(
pö
); \

133 
func
) { \

134 
MCU_IO_PULLUP
: \

135 
P
##
p‹t
##
INP
 &~
	`BV
(
pö
); \

136 
P2INP
 &~
	`BV
(
p‹t
 + 5); \

138 
MCU_IO_PULLDOWN
: \

139 
P
##
p‹t
##
INP
 &~
	`BV
(
pö
); \

140 
P2INP
 |
	`BV
(
p‹t
 + 5); \

143 
P
##
p‹t
##
INP
 |
	`BV
(
pö
); \

144 ; } )

	)

146 
	#MCU_IO_OUTPUT_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
SEL
 &~
	`BV
(pin); \

147 
P
##
p‹t
##
_
##
pö
## = 
vÆ
; \

148 
P
##
p‹t
##
DIR
 |
	`BV
(
pö
); )

	)

150 
	#MCU_IO_SET_HIGH_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## = 1; )

	)

151 
	#MCU_IO_SET_LOW_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## = 0; )

	)

153 
	#MCU_IO_SET_PREP
(
p‹t
, 
pö
, 
vÆ
Ë
	`°
–
P
##p‹t##
_
##pö## = vÆ; )

	)

154 
	#MCU_IO_TGL_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
_
##pö## ^1; )

	)

155 
	#MCU_IO_GET_PREP
(
p‹t
, 
pö
Ë(
P
##p‹t## & 
	`BV
’ö))

	)

157 
	#MCU_IO_DIR_INPUT_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
DIR
 &~
	`BV
’ö); )

	)

158 
	#MCU_IO_DIR_OUTPUT_PREP
(
p‹t
, 
pö
Ë
	`°
–
P
##p‹t##
DIR
 |
	`BV
’ö); )

	)

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/usb_interrupt.c

11 
	#USBINTERRUPT_C


12 
	~"usb_fúmw¨e_libøry_hódîs.h
"

	)

13 
	~"usb_bﬂrd_cfg.h
"

14 
	~"hÆ_Êash.h
"

25 
	$usbúqInô
(
uöt16
 
úqMask
)

28 
usbúqD©a
.
evítMask
 = 0x0000;

29 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

30 
usbúqD©a
.
úqMask
 = irqMask;

33 
USBCIE
 = 
úqMask
;

34 
USBIIE
 = 
úqMask
 >> 4;

35 
USBOIE
 = (
úqMask
 >> 9) & 0x3E;

37 
	`HAL_USB_INT_CLEAR
();

38 
	`HAL_USB_INT_ENABLE
();

40 
	}
}

49 #i‡
deföed
 
HAL_SB_BOOT_CODE


50 
	$usbúqH™dÀr
()

52 #¥agm®
ve˘‹
=
P2INT_VECTOR


53 
__öãºu±
 
	$usbúqH™dÀr
()

56 
uöt8
 
usbcif
;

59 !
	`CC2530_IS_XOSC_STABLE
());

62 
usbcif
 = 
USBCIF
;

63 i‡(
usbcif
 & 
USBCIF_RSTIF
) {

67 
USBCIE
 = 
usbúqD©a
.
úqMask
;

68 
USBIIE
 = 
usbúqD©a
.
úqMask
 >> 4;

69 
USBOIE
 = (
usbúqD©a
.
úqMask
 >> 9) & 0x3E;

72 
USBPOW
 |
USBPOW_SUSPEND_EN
;

76 
usbúqD©a
.
evítMask
 |(
uöt16
Ë
usbcif
;

77 
usbúqD©a
.
evítMask
 |(
uöt16
Ë
USBIIF
 << 4;

78 
usbúqD©a
.
evítMask
 |(
uöt16
Ë
USBOIF
 << 9;

83 i‡(
usbcif
 & 
USBCIF_SUSPENDIF
) {

84 
usbúqD©a
.
öSu•íd
 = 
TRUE
;

86 i‡(
usbcif
 & (
USBCIF_RSTIF
 | 
USBCIF_RESUMEIF
)) {

87 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

89 i‡(
P2IFG
 & 
P2IFG_DPIF
) {

91 
P2IFG
 = (
P2IFG_DPIF
 ^ 0xFF);

92 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

96 
	`usbúqHookPro˚ssEvíts
();

99 
	`HAL_USB_INT_CLEAR
();

101 
	}
}

	@Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/usb_suspend.c

11 
	~"usb_fúmw¨e_libøry_hódîs.h
"

12 
	~"hÆ_bﬂrd.h
"

13 
	~"hÆ_mcu.h
"

15 
__xd©a
 
VFPTR
 
	gpFnSu•ídE¡îHook

NULL
;

16 
__xd©a
 
VFPTR
 
	gpFnSu•ídExôHook

NULL
;

18 #i‡
HAL_UART_USB_SUSPEND


19 
hÆE¡îPowîMode
();

29 
	$usbsu•E¡î
()

31 i‡(
pFnSu•ídE¡îHook
!=
NULL
)

32 
	`pFnSu•ídE¡îHook
();

34 
	`HAL_USB_INT_CLEAR
();

35 
	`HAL_USB_INT_ENABLE
();

38 
	`HAL_USB_PLL_DISABLE
();

40 
	`HAL_LED_CLR_1
();

44 
SLEEPCMD
 = 0x05;

45 
	`hÆE¡îPowîMode
();

46 }  
usbúqD©a
.
öSu•íd
 );

51 !
	`CC2530_IS_XOSC_STABLE
());

54 
	`HAL_USB_ENABLE
();

56 i‡(
pFnSu•ídExôHook
!=
NULL
)

57 
	`pFnSu•ídExôHook
();

58 
	}
}

75 
uöt8
 
	$usbsu•DoRemŸeWakeup
()

77 
	`hÆMcuWaôMs
(
uöt16
 
m£c
);

78 
hÆI¡Sèã_t
 
ötSèã
;

81 i‡(!
usbfwD©a
.
ªmŸeWakeup
Ë 
FALSE
;

83 
	`HAL_ENTER_CRITICAL_SECTION
(
ötSèã
);

86 
usbúqD©a
.
öSu•íd
 = 
FALSE
;

89 
USBPOW
 |
USBPOW_RESUME
;

90 
	`hÆMcuWaôMs
(10);

91 
USBPOW
 &~
USBPOW_RESUME
;

94 
	`HAL_USB_INT_CLEAR
();

96 
	`HAL_EXIT_CRITICAL_SECTION
(
ötSèã
);

98  
TRUE
;

100 
	}
}

	@
1
.
0
419
20071
Components/ble/controller/include/ll.h
Components/ble/controller/include/ll_math.h
Components/ble/controller/include/ll_sleep.h
Components/ble/controller/include/ll_timer2.h
Components/ble/controller/include/phy.h
Components/ble/controller/include/phy_image.h
Components/ble/hci/hci_data.h
Components/ble/hci/hci_event.h
Components/ble/hci/hci_tl.h
Components/ble/host/gatt_uuid.c
Components/ble/host/linkdb.h
Components/ble/include/att.h
Components/ble/include/bcomdef.h
Components/ble/include/gap.h
Components/ble/include/gatt.h
Components/ble/include/gatt_uuid.h
Components/ble/include/hci.h
Components/ble/include/l2cap.h
Components/ble/include/sm.h
Components/hal/common/hal_assert.c
Components/hal/common/hal_drivers.c
Components/hal/include/hal_adc.h
Components/hal/include/hal_assert.h
Components/hal/include/hal_board.h
Components/hal/include/hal_defs.h
Components/hal/include/hal_drivers.h
Components/hal/include/hal_flash.h
Components/hal/include/hal_key.h
Components/hal/include/hal_lcd.h
Components/hal/include/hal_led.h
Components/hal/include/hal_rpc.h
Components/hal/include/hal_sleep.h
Components/hal/include/hal_timer.h
Components/hal/include/hal_uart.h
Components/hal/target/CC2540EB/_hal_uart_dma.c
Components/hal/target/CC2540EB/_hal_uart_isr.c
Components/hal/target/CC2540EB/_hal_uart_spi.c
Components/hal/target/CC2540EB/hal_adc.c
Components/hal/target/CC2540EB/hal_aes.c
Components/hal/target/CC2540EB/hal_aes.h
Components/hal/target/CC2540EB/hal_board_cfg.h
Components/hal/target/CC2540EB/hal_ccm.h
Components/hal/target/CC2540EB/hal_crc.c
Components/hal/target/CC2540EB/hal_crc.h
Components/hal/target/CC2540EB/hal_dma.c
Components/hal/target/CC2540EB/hal_dma.h
Components/hal/target/CC2540EB/hal_flash.c
Components/hal/target/CC2540EB/hal_key.c
Components/hal/target/CC2540EB/hal_lcd.c
Components/hal/target/CC2540EB/hal_led.c
Components/hal/target/CC2540EB/hal_mcu.h
Components/hal/target/CC2540EB/hal_sleep.c
Components/hal/target/CC2540EB/hal_startup.c
Components/hal/target/CC2540EB/hal_timer.c
Components/hal/target/CC2540EB/hal_types.h
Components/hal/target/CC2540EB/hal_uart.c
Components/hal/target/CC2540USB/_hal_uart_dma.c
Components/hal/target/CC2540USB/_hal_uart_isr.c
Components/hal/target/CC2540USB/_hal_uart_spi.c
Components/hal/target/CC2540USB/_hal_uart_usb.c
Components/hal/target/CC2540USB/hal_adc.c
Components/hal/target/CC2540USB/hal_aes.c
Components/hal/target/CC2540USB/hal_aes.h
Components/hal/target/CC2540USB/hal_board_cfg.h
Components/hal/target/CC2540USB/hal_crc.c
Components/hal/target/CC2540USB/hal_crc.h
Components/hal/target/CC2540USB/hal_dma.c
Components/hal/target/CC2540USB/hal_dma.h
Components/hal/target/CC2540USB/hal_flash.c
Components/hal/target/CC2540USB/hal_key.c
Components/hal/target/CC2540USB/hal_lcd.c
Components/hal/target/CC2540USB/hal_led.c
Components/hal/target/CC2540USB/hal_mcu.h
Components/hal/target/CC2540USB/hal_sleep.c
Components/hal/target/CC2540USB/hal_startup.c
Components/hal/target/CC2540USB/hal_timer.c
Components/hal/target/CC2540USB/hal_types.h
Components/hal/target/CC2540USB/hal_uart.c
Components/hal/target/CC2540USB/usb/class_cdc/usb_cdc.h
Components/hal/target/CC2540USB/usb/class_cdc/usb_cdc_hooks.c
Components/hal/target/CC2540USB/usb/class_cdc/usb_cdc_hooks.h
Components/hal/target/CC2540USB/usb/class_cdc/usb_firmware_library_config.c
Components/hal/target/CC2540USB/usb/class_cdc/usb_firmware_library_config.h
Components/hal/target/CC2540USB/usb/class_cdc/usb_firmware_library_headers.h
Components/hal/target/CC2540USB/usb/class_hid/usb_class_requests.c
Components/hal/target/CC2540USB/usb/class_hid/usb_class_requests.h
Components/hal/target/CC2540USB/usb/class_hid/usb_firmware_library_config.c
Components/hal/target/CC2540USB/usb/class_hid/usb_firmware_library_config.h
Components/hal/target/CC2540USB/usb/class_hid/usb_firmware_library_headers.h
Components/hal/target/CC2540USB/usb/class_hid/usb_hid.c
Components/hal/target/CC2540USB/usb/class_hid/usb_hid.h
Components/hal/target/CC2540USB/usb/class_hid/usb_hid_hooks.c
Components/hal/target/CC2540USB/usb/class_hid/usb_hid_reports.c
Components/hal/target/CC2540USB/usb/class_hid/usb_hid_reports.h
Components/hal/target/CC2540USB/usb/library/cc2540/usb_board_cfg.h
Components/hal/target/CC2540USB/usb/library/cc2540/usb_interrupt.c
Components/hal/target/CC2540USB/usb/library/cc2540/usb_suspend.c
Components/hal/target/CC2540USB/usb/library/cc2540_hid/usb_board_cfg.h
Components/hal/target/CC2540USB/usb/library/cc2540_hid/usb_interrupt.c
Components/hal/target/CC2540USB/usb/library/cc2540_hid/usb_suspend.c
Components/hal/target/CC2540USB/usb/library/usb/usb_descriptor_parser.c
Components/hal/target/CC2540USB/usb/library/usb/usb_descriptor_parser.h
Components/hal/target/CC2540USB/usb/library/usb/usb_framework.c
Components/hal/target/CC2540USB/usb/library/usb/usb_framework_structs.h
Components/hal/target/CC2540USB/usb/library/usb/usb_interrupt.h
Components/hal/target/CC2540USB/usb/library/usb_descriptor.h
Components/hal/target/CC2540USB/usb/library/usb_framework.h
Components/hal/target/CC2540USB/usb/library/usb_hid/usb_descriptor_parser.c
Components/hal/target/CC2540USB/usb/library/usb_hid/usb_descriptor_parser.h
Components/hal/target/CC2540USB/usb/library/usb_hid/usb_framework.c
Components/hal/target/CC2540USB/usb/library/usb_hid/usb_framework_structs.h
Components/hal/target/CC2540USB/usb/library/usb_hid/usb_interrupt.h
Components/hal/target/CC2540USB/usb/library/usb_reg.h
Components/hal/target/CC2540USB/usb/library/usb_standard_requests.c
Components/hal/target/CC2540USB/usb/library/usb_standard_requests.h
Components/hal/target/CC2540USB/usb/library/usb_suspend.h
Components/hal/target/CC2541ARC/AIR_MOTION_Lib.h
Components/hal/target/CC2541ARC/hal_accel.c
Components/hal/target/CC2541ARC/hal_accel.h
Components/hal/target/CC2541ARC/hal_aes.c
Components/hal/target/CC2541ARC/hal_aes.h
Components/hal/target/CC2541ARC/hal_buzzer.c
Components/hal/target/CC2541ARC/hal_buzzer.h
Components/hal/target/CC2541ARC/hal_drivers.c
Components/hal/target/CC2541ARC/hal_drivers.h
Components/hal/target/CC2541ARC/hal_gyro.c
Components/hal/target/CC2541ARC/hal_gyro.h
Components/hal/target/CC2541ARC/hal_i2c.c
Components/hal/target/CC2541ARC/hal_i2c.h
Components/hal/target/CC2541ARC/hal_key.c
Components/hal/target/CC2541ARC/hal_mcu.h
Components/hal/target/CC2541ARC/hal_motion.c
Components/hal/target/CC2541ARC/hal_motion.h
Components/hal/target/CC2541ARC/hal_sleep.c
Components/hal/target/CC2541ARC/hal_types.h
Components/hal/target/CC2541ARC/stdbool.h
Components/hal/target/CC2541ARC/stdint.h
Components/hal/target/CC2541ST/hal_acc.c
Components/hal/target/CC2541ST/hal_acc.h
Components/hal/target/CC2541ST/hal_aes.c
Components/hal/target/CC2541ST/hal_aes.h
Components/hal/target/CC2541ST/hal_assert.c
Components/hal/target/CC2541ST/hal_bar.c
Components/hal/target/CC2541ST/hal_bar.h
Components/hal/target/CC2541ST/hal_board_cfg.h
Components/hal/target/CC2541ST/hal_crc.c
Components/hal/target/CC2541ST/hal_crc.h
Components/hal/target/CC2541ST/hal_dma.c
Components/hal/target/CC2541ST/hal_dma.h
Components/hal/target/CC2541ST/hal_flash.c
Components/hal/target/CC2541ST/hal_gyro.c
Components/hal/target/CC2541ST/hal_gyro.h
Components/hal/target/CC2541ST/hal_humi.c
Components/hal/target/CC2541ST/hal_humi.h
Components/hal/target/CC2541ST/hal_i2c.c
Components/hal/target/CC2541ST/hal_i2c.h
Components/hal/target/CC2541ST/hal_interrupt.c
Components/hal/target/CC2541ST/hal_irtemp.c
Components/hal/target/CC2541ST/hal_irtemp.h
Components/hal/target/CC2541ST/hal_keys.c
Components/hal/target/CC2541ST/hal_keys.h
Components/hal/target/CC2541ST/hal_led.c
Components/hal/target/CC2541ST/hal_mag.c
Components/hal/target/CC2541ST/hal_mag.h
Components/hal/target/CC2541ST/hal_mcu.h
Components/hal/target/CC2541ST/hal_sensor.c
Components/hal/target/CC2541ST/hal_sensor.h
Components/hal/target/CC2541ST/hal_sleep.c
Components/hal/target/CC2541ST/hal_startup.c
Components/hal/target/CC2541ST/hal_timer.c
Components/hal/target/CC2541ST/hal_types.h
Components/osal/common/OSAL.c
Components/osal/common/OSAL_ClockBLE.c
Components/osal/common/OSAL_Memory.c
Components/osal/common/OSAL_PwrMgr.c
Components/osal/common/OSAL_Timers.c
Components/osal/common/osal_bufmgr.c
Components/osal/common/osal_cbtimer.c
Components/osal/include/OSAL.h
Components/osal/include/OSAL_Clock.h
Components/osal/include/OSAL_Memory.h
Components/osal/include/OSAL_Nv.h
Components/osal/include/OSAL_PwrMgr.h
Components/osal/include/OSAL_Tasks.h
Components/osal/include/OSAL_Timers.h
Components/osal/include/ZComDef.h
Components/osal/include/comdef.h
Components/osal/include/osal_bufmgr.h
Components/osal/include/osal_cbtimer.h
Components/osal/include/osal_snv.h
Components/osal/mcu/cc2540/osal_snv.c
Components/services/saddr/saddr.h
Projects/ble/BloodPressure/Source/BloodPressure_Main.c
Projects/ble/BloodPressure/Source/OSAL_BloodPressure.c
Projects/ble/BloodPressure/Source/bloodPressure.c
Projects/ble/BloodPressure/Source/bloodPressure.h
Projects/ble/BloodPressure/Source/timeapp.h
Projects/ble/BloodPressure/Source/timeapp_clock.c
Projects/ble/BloodPressure/Source/timeapp_config.c
Projects/ble/BloodPressure/Source/timeapp_discovery.c
Projects/ble/BloodPressure/Source/timeapp_ind.c
Projects/ble/CyclingSensor/Source/OSAL_cyclingSensor.c
Projects/ble/CyclingSensor/Source/cyclingSensor.c
Projects/ble/CyclingSensor/Source/cyclingSensor.h
Projects/ble/CyclingSensor/Source/cyclingSensor_Main.c
Projects/ble/GlucoseCollector/Source/OSAL_glucoseCollector.c
Projects/ble/GlucoseCollector/Source/glucoseCollector.c
Projects/ble/GlucoseCollector/Source/glucoseCollector.h
Projects/ble/GlucoseCollector/Source/glucoseCollector_Main.c
Projects/ble/GlucoseCollector/Source/glucose_config.c
Projects/ble/GlucoseCollector/Source/glucose_ctlpnt.c
Projects/ble/GlucoseCollector/Source/glucose_discovery.c
Projects/ble/GlucoseCollector/Source/glucose_ind.c
Projects/ble/GlucoseSensor/Source/Glucose_Main.c
Projects/ble/GlucoseSensor/Source/OSAL_Glucose.c
Projects/ble/GlucoseSensor/Source/glucose.c
Projects/ble/GlucoseSensor/Source/glucose.h
Projects/ble/HIDAdvRemote/Source/OSAL_hidAdvRemote.c
Projects/ble/HIDAdvRemote/Source/hidAdvRemote.c
Projects/ble/HIDAdvRemote/Source/hidAdvRemote.h
Projects/ble/HIDAdvRemote/Source/hidAdvRemote_main.c
Projects/ble/HIDAdvRemoteDongle/Source/Hidapp_Main.c
Projects/ble/HIDAdvRemoteDongle/Source/OSAL_Hidapp.c
Projects/ble/HIDAdvRemoteDongle/Source/hidapp.c
Projects/ble/HIDAdvRemoteDongle/Source/hidapp.h
Projects/ble/HIDEmuKbd/Source/OSAL_hidemukbd.c
Projects/ble/HIDEmuKbd/Source/hidemukbd.c
Projects/ble/HIDEmuKbd/Source/hidemukbd.h
Projects/ble/HIDEmuKbd/Source/hidemukbd_Main.c
Projects/ble/HeartRate/Source/OSAL_heartrate.c
Projects/ble/HeartRate/Source/heartrate.c
Projects/ble/HeartRate/Source/heartrate.h
Projects/ble/HeartRate/Source/heartrate_Main.c
Projects/ble/HostTestApp/Source/HostTest_Main.c
Projects/ble/HostTestApp/Source/OSAL_HostTest.c
Projects/ble/HostTestApp/Source/hci_ext_app.c
Projects/ble/HostTestApp/Source/hci_ext_app.h
Projects/ble/Include/gapgattserver.h
Projects/ble/Include/gattservapp.h
Projects/ble/KeyFob/Source/KeyFob_Main.c
Projects/ble/KeyFob/Source/OSAL_KeyFobDemo.c
Projects/ble/KeyFob/Source/bma250.c
Projects/ble/KeyFob/Source/bma250.h
Projects/ble/KeyFob/Source/buzzer.c
Projects/ble/KeyFob/Source/buzzer.h
Projects/ble/KeyFob/Source/cma3000d.c
Projects/ble/KeyFob/Source/cma3000d.h
Projects/ble/KeyFob/Source/keyfobdemo.c
Projects/ble/KeyFob/Source/keyfobdemo.h
Projects/ble/OADManager/Source/_hal_uart_isr_sbl.c
Projects/ble/OADManager/Source/oad_mgr_app.c
Projects/ble/OADManager/Source/oad_mgr_app.h
Projects/ble/OADManager/Source/oad_mgr_main.c
Projects/ble/OADManager/Source/osal_oad_mgr.c
Projects/ble/OADManager/Source/sbl_exec.h
Projects/ble/OADManager/Source/sbl_exec_uart.c
Projects/ble/Profiles/Accelerometer/accelerometer.c
Projects/ble/Profiles/Accelerometer/accelerometer.h
Projects/ble/Profiles/Batt/battservice.c
Projects/ble/Profiles/Batt/battservice.h
Projects/ble/Profiles/BloodPressure/bpservice.c
Projects/ble/Profiles/BloodPressure/bpservice.h
Projects/ble/Profiles/CSC/cyclingservice.c
Projects/ble/Profiles/CSC/cyclingservice.h
Projects/ble/Profiles/DevInfo/devinfoservice.c
Projects/ble/Profiles/DevInfo/devinfoservice.h
Projects/ble/Profiles/Glucose/glucservice.c
Projects/ble/Profiles/Glucose/glucservice.h
Projects/ble/Profiles/HIDDev/hid_uuid.h
Projects/ble/Profiles/HIDDev/hiddev.c
Projects/ble/Profiles/HIDDev/hiddev.h
Projects/ble/Profiles/HIDDevKbM/hidkbmservice.c
Projects/ble/Profiles/HIDDevKbM/hidkbmservice.h
Projects/ble/Profiles/HIDDevKbd/hidkbdservice.c
Projects/ble/Profiles/HIDDevKbd/hidkbdservice.h
Projects/ble/Profiles/HeartRate/heartrateservice.c
Projects/ble/Profiles/HeartRate/heartrateservice.h
Projects/ble/Profiles/Keys/simplekeys.c
Projects/ble/Profiles/Keys/simplekeys.h
Projects/ble/Profiles/OAD/oad.h
Projects/ble/Profiles/OAD/oad_target.c
Projects/ble/Profiles/OAD/oad_target.h
Projects/ble/Profiles/Proximity/proxreporter.c
Projects/ble/Profiles/Proximity/proxreporter.h
Projects/ble/Profiles/RSC/runningservice.c
Projects/ble/Profiles/RSC/runningservice.h
Projects/ble/Profiles/Roles/broadcaster.c
Projects/ble/Profiles/Roles/broadcaster.h
Projects/ble/Profiles/Roles/central.c
Projects/ble/Profiles/Roles/central.h
Projects/ble/Profiles/Roles/gap.c
Projects/ble/Profiles/Roles/gapbondmgr.c
Projects/ble/Profiles/Roles/gapbondmgr.h
Projects/ble/Profiles/Roles/gapperiphbondmgr.c
Projects/ble/Profiles/Roles/gapperiphbondmgr.h
Projects/ble/Profiles/Roles/observer.c
Projects/ble/Profiles/Roles/observer.h
Projects/ble/Profiles/Roles/peripheral.c
Projects/ble/Profiles/Roles/peripheral.h
Projects/ble/Profiles/Roles/peripheralBroadcaster.c
Projects/ble/Profiles/Roles/peripheralBroadcaster.h
Projects/ble/Profiles/ScanParam/scanparamservice.c
Projects/ble/Profiles/ScanParam/scanparamservice.h
Projects/ble/Profiles/SensorProfile/accelerometerservice.c
Projects/ble/Profiles/SensorProfile/accelerometerservice.h
Projects/ble/Profiles/SensorProfile/barometerservice.c
Projects/ble/Profiles/SensorProfile/barometerservice.h
Projects/ble/Profiles/SensorProfile/gyroservice.c
Projects/ble/Profiles/SensorProfile/gyroservice.h
Projects/ble/Profiles/SensorProfile/humidityservice.c
Projects/ble/Profiles/SensorProfile/humidityservice.h
Projects/ble/Profiles/SensorProfile/irtempservice.c
Projects/ble/Profiles/SensorProfile/irtempservice.h
Projects/ble/Profiles/SensorProfile/magnetometerservice.c
Projects/ble/Profiles/SensorProfile/magnetometerservice.h
Projects/ble/Profiles/SensorProfile/st_util.c
Projects/ble/Profiles/SensorProfile/st_util.h
Projects/ble/Profiles/SensorProfile/testservice.c
Projects/ble/Profiles/SensorProfile/testservice.h
Projects/ble/Profiles/SimpleProfile/simpleGATTprofile.c
Projects/ble/Profiles/SimpleProfile/simpleGATTprofile.h
Projects/ble/Profiles/Thermometer/thermometerservice.c
Projects/ble/Profiles/Thermometer/thermometerservice.h
Projects/ble/RunningSensor/Source/OSAL_runningSensor.c
Projects/ble/RunningSensor/Source/runningSensor.c
Projects/ble/RunningSensor/Source/runningSensor.h
Projects/ble/RunningSensor/Source/runningSensor_Main.c
Projects/ble/SensorTag/Source/OSAL_SensorTag.c
Projects/ble/SensorTag/Source/SensorTag.c
Projects/ble/SensorTag/Source/SensorTag_Main.c
Projects/ble/SensorTag/Source/devinfoservice-st.c
Projects/ble/SensorTag/Source/devinfoservice-st.h
Projects/ble/SensorTag/Source/sensorTag.h
Projects/ble/SimpleBLEBroadcaster/Source/OSAL_SimpleBLEBroadcaster.c
Projects/ble/SimpleBLEBroadcaster/Source/SimpleBLEBroadcaster_Main.c
Projects/ble/SimpleBLEBroadcaster/Source/simpleBLEBroadcaster.c
Projects/ble/SimpleBLEBroadcaster/Source/simpleBLEBroadcaster.h
Projects/ble/SimpleBLECentral/Source/OSAL_simpleBLECentral.c
Projects/ble/SimpleBLECentral/Source/simpleBLECentral.c
Projects/ble/SimpleBLECentral/Source/simpleBLECentral.h
Projects/ble/SimpleBLECentral/Source/simpleBLECentral_Main.c
Projects/ble/SimpleBLEObserver/Source/OSAL_SimpleBLEObserver.c
Projects/ble/SimpleBLEObserver/Source/simpleBLEObserver.c
Projects/ble/SimpleBLEObserver/Source/simpleBLEObserver.h
Projects/ble/SimpleBLEObserver/Source/simpleBLEObserver_Main.c
Projects/ble/SimpleBLEPeripheral/Source/OSAL_SimpleBLEPeripheral.c
Projects/ble/SimpleBLEPeripheral/Source/SimpleBLEPeripheral_Main.c
Projects/ble/SimpleBLEPeripheral/Source/simpleBLEPeripheral.c
Projects/ble/SimpleBLEPeripheral/Source/simpleBLEPeripheral.h
Projects/ble/Thermometer/Source/OSAL_Thermometer.c
Projects/ble/Thermometer/Source/Thermometer_Main.c
Projects/ble/Thermometer/Source/thermometer.c
Projects/ble/Thermometer/Source/thermometer.h
Projects/ble/Thermometer/Source/timeapp.h
Projects/ble/Thermometer/Source/timeapp_clock.c
Projects/ble/Thermometer/Source/timeapp_config.c
Projects/ble/Thermometer/Source/timeapp_discovery.c
Projects/ble/Thermometer/Source/timeapp_ind.c
Projects/ble/TimeApp/Source/OSAL_timeapp.c
Projects/ble/TimeApp/Source/timeapp.c
Projects/ble/TimeApp/Source/timeapp.h
Projects/ble/TimeApp/Source/timeapp_Main.c
Projects/ble/TimeApp/Source/timeapp_clock.c
Projects/ble/TimeApp/Source/timeapp_config.c
Projects/ble/TimeApp/Source/timeapp_discovery.c
Projects/ble/TimeApp/Source/timeapp_ind.c
Projects/ble/common/cc2540/OnBoard.c
Projects/ble/common/cc2540/OnBoard.h
Projects/ble/common/npi/npi_np/npi.c
Projects/ble/common/npi/npi_np/npi.h
Projects/ble/util/BEM/app/bem_main.c
Projects/ble/util/BIM/app/bim_main.c
Projects/ble/util/EBL/app/cc254x/_sbl_spi.c
Projects/ble/util/EBL/app/cc254x/_sbl_uart.c
Projects/ble/util/EBL/app/sbl_app.c
Projects/ble/util/EBL/app/sbl_app.h
Projects/ble/util/EBL/app/sbl_exec.c
Projects/ble/util/EBL/app/sbl_exec.h
Projects/ble/util/EBL/app/sbl_main.c
Projects/ble/util/SBL/app/cc254x/_sbl_spi.c
Projects/ble/util/SBL/app/cc254x/_sbl_uart.c
Projects/ble/util/SBL/app/sbl_app.c
Projects/ble/util/SBL/app/sbl_app.h
Projects/ble/util/SBL/app/sbl_exec.c
Projects/ble/util/SBL/app/sbl_exec.h
Projects/ble/util/SBL/app/sbl_main.c
Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_app.c
Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_app.h
Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_exec.c
Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_exec.h
Projects/ble/util/UBL/soc_8051/usb_msd/app/ubl_main.c
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_aes.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_board.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_board_cfg.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_board_cfg_nano.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_defs.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_dma.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_flash.c
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_flash.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_mcu.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_startup.c
Projects/ble/util/UBL/soc_8051/usb_msd/hal/hal_types.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/class_msd/usb_firmware_library_config.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/class_msd/usb_firmware_library_headers.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/class_msd/usb_msd.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_descriptor.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_descriptor_parser.c
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_descriptor_parser.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_framework.c
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_framework.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_framework_structs.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_interrupt.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_reg.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_standard_requests.c
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_standard_requests.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/library/usb_suspend.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/usb_board_cfg.h
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/usb_interrupt.c
Projects/ble/util/UBL/soc_8051/usb_msd/hal/usb/usb_suspend.c
